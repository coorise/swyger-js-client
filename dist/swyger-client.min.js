var V1=Object.defineProperty,K1=Object.defineProperties,W1=Object.getOwnPropertyDescriptors,Df=Object.getOwnPropertySymbols,z1=Object.prototype.hasOwnProperty,H1=Object.prototype.propertyIsEnumerable,hu=(n,e,t)=>e in n?V1(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,X=(n,e)=>{for(var t in e||(e={}))z1.call(e,t)&&hu(n,t,e[t]);if(Df)for(var t of Df(e))H1.call(e,t)&&hu(n,t,e[t]);return n},qe=(n,e)=>K1(n,W1(e)),J1=(n,e,t)=>(hu(n,typeof e!="symbol"?e+"":e,t),t),fg=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)},ke=(n,e,t)=>(fg(n,e,"read from private field"),t?t.call(n):e.get(n)),yn=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)},qr=(n,e,t,r)=>(fg(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t),V=(n,e,t)=>new Promise((r,i)=>{var o=c=>{try{a(t.next(c))}catch(l){i(l)}},s=c=>{try{a(t.throw(c))}catch(l){i(l)}},a=c=>c.done?r(c.value):Promise.resolve(c.value).then(o,s);a((t=t.apply(n,e)).next())});const ur=Object.create(null);ur.open="0";ur.close="1";ur.ping="2";ur.pong="3";ur.message="4";ur.upgrade="5";ur.noop="6";const aa=Object.create(null);Object.keys(ur).forEach(n=>{aa[ur[n]]=n});const Y1={type:"error",data:"parser error"},G1=typeof Blob=="function"||typeof Blob!="undefined"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",X1=typeof ArrayBuffer=="function",Z1=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n&&n.buffer instanceof ArrayBuffer,pg=({type:n,data:e},t,r)=>G1&&e instanceof Blob?t?r(e):qf(e,r):X1&&(e instanceof ArrayBuffer||Z1(e))?t?r(e):qf(new Blob([e]),r):r(ur[n]+(e||"")),qf=(n,e)=>{const t=new FileReader;return t.onload=function(){const r=t.result.split(",")[1];e("b"+(r||""))},t.readAsDataURL(n)},Uf="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",No=typeof Uint8Array=="undefined"?[]:new Uint8Array(256);for(let n=0;n<Uf.length;n++)No[Uf.charCodeAt(n)]=n;const Q1=n=>{let e=n.length*.75,t=n.length,r,i=0,o,s,a,c;n[n.length-1]==="="&&(e--,n[n.length-2]==="="&&e--);const l=new ArrayBuffer(e),u=new Uint8Array(l);for(r=0;r<t;r+=4)o=No[n.charCodeAt(r)],s=No[n.charCodeAt(r+1)],a=No[n.charCodeAt(r+2)],c=No[n.charCodeAt(r+3)],u[i++]=o<<2|s>>4,u[i++]=(s&15)<<4|a>>2,u[i++]=(a&3)<<6|c&63;return l},ek=typeof ArrayBuffer=="function",yg=(n,e)=>{if(typeof n!="string")return{type:"message",data:gg(n,e)};const t=n.charAt(0);return t==="b"?{type:"message",data:tk(n.substring(1),e)}:aa[t]?n.length>1?{type:aa[t],data:n.substring(1)}:{type:aa[t]}:Y1},tk=(n,e)=>{if(ek){const t=Q1(n);return gg(t,e)}else return{base64:!0,data:n}},gg=(n,e)=>{switch(e){case"blob":return n instanceof ArrayBuffer?new Blob([n]):n;case"arraybuffer":default:return n}},mg=String.fromCharCode(30),nk=(n,e)=>{const t=n.length,r=new Array(t);let i=0;n.forEach((o,s)=>{pg(o,!1,a=>{r[s]=a,++i===t&&e(r.join(mg))})})},rk=(n,e)=>{const t=n.split(mg),r=[];for(let i=0;i<t.length;i++){const o=yg(t[i],e);if(r.push(o),o.type==="error")break}return r},vg=4;function dt(n){if(n)return ik(n)}function ik(n){for(var e in dt.prototype)n[e]=dt.prototype[e];return n}dt.prototype.on=dt.prototype.addEventListener=function(n,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+n]=this._callbacks["$"+n]||[]).push(e),this};dt.prototype.once=function(n,e){function t(){this.off(n,t),e.apply(this,arguments)}return t.fn=e,this.on(n,t),this};dt.prototype.off=dt.prototype.removeListener=dt.prototype.removeAllListeners=dt.prototype.removeEventListener=function(n,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+n];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+n],this;for(var r,i=0;i<t.length;i++)if(r=t[i],r===e||r.fn===e){t.splice(i,1);break}return t.length===0&&delete this._callbacks["$"+n],this};dt.prototype.emit=function(n){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+n],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(t){t=t.slice(0);for(var r=0,i=t.length;r<i;++r)t[r].apply(this,e)}return this};dt.prototype.emitReserved=dt.prototype.emit;dt.prototype.listeners=function(n){return this._callbacks=this._callbacks||{},this._callbacks["$"+n]||[]};dt.prototype.hasListeners=function(n){return!!this.listeners(n).length};const Pn=(()=>typeof self!="undefined"?self:typeof window!="undefined"?window:Function("return this")())();function bg(n,...e){return e.reduce((t,r)=>(n.hasOwnProperty(r)&&(t[r]=n[r]),t),{})}const ok=Pn.setTimeout,sk=Pn.clearTimeout;function lc(n,e){e.useNativeTimers?(n.setTimeoutFn=ok.bind(Pn),n.clearTimeoutFn=sk.bind(Pn)):(n.setTimeoutFn=Pn.setTimeout.bind(Pn),n.clearTimeoutFn=Pn.clearTimeout.bind(Pn))}const ak=1.33;function ck(n){return typeof n=="string"?lk(n):Math.ceil((n.byteLength||n.size)*ak)}function lk(n){let e=0,t=0;for(let r=0,i=n.length;r<i;r++)e=n.charCodeAt(r),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(r++,t+=4);return t}class uk extends Error{constructor(e,t,r){super(e),this.description=t,this.context=r,this.type="TransportError"}}class wg extends dt{constructor(e){super(),this.writable=!1,lc(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,r){return super.emitReserved("error",new uk(e,t,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=yg(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}}const kg="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),du=64,hk={};let Mf=0,qs=0,Ff;function Vf(n){let e="";do e=kg[n%du]+e,n=Math.floor(n/du);while(n>0);return e}function xg(){const n=Vf(+new Date);return n!==Ff?(Mf=0,Ff=n):n+"."+Vf(Mf++)}for(;qs<du;qs++)hk[kg[qs]]=qs;function Eg(n){let e="";for(let t in n)n.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(n[t]));return e}function dk(n){let e={},t=n.split("&");for(let r=0,i=t.length;r<i;r++){let o=t[r].split("=");e[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return e}let _g=!1;try{_g=typeof XMLHttpRequest!="undefined"&&"withCredentials"in new XMLHttpRequest}catch(n){}const fk=_g;function $g(n){const e=n.xdomain;try{if(typeof XMLHttpRequest!="undefined"&&(!e||fk))return new XMLHttpRequest}catch(t){}if(!e)try{return new Pn[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch(t){}}function pk(){}const yk=function(){return new $g({xdomain:!1}).responseType!=null}();class gk extends wg{constructor(e){if(super(e),this.polling=!1,typeof location!="undefined"){const r=location.protocol==="https:";let i=location.port;i||(i=r?"443":"80"),this.xd=typeof location!="undefined"&&e.hostname!==location.hostname||i!==e.port,this.xs=e.secure!==r}const t=e&&e.forceBase64;this.supportsBinary=yk&&!t}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let r=0;this.polling&&(r++,this.once("pollComplete",function(){--r||t()})),this.writable||(r++,this.once("drain",function(){--r||t()}))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const t=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)};rk(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,nk(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let e=this.query||{};const t=this.opts.secure?"https":"http";let r="";this.opts.timestampRequests!==!1&&(e[this.opts.timestampParam]=xg()),!this.supportsBinary&&!e.sid&&(e.b64=1),this.opts.port&&(t==="https"&&Number(this.opts.port)!==443||t==="http"&&Number(this.opts.port)!==80)&&(r=":"+this.opts.port);const i=Eg(e),o=this.opts.hostname.indexOf(":")!==-1;return t+"://"+(o?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(i.length?"?"+i:"")}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new ar(this.uri(),e)}doWrite(e,t){const r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",(i,o)=>{this.onError("xhr post error",i,o)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,r)=>{this.onError("xhr poll error",t,r)}),this.pollXhr=e}}class ar extends dt{constructor(e,t){super(),lc(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.async=t.async!==!1,this.data=t.data!==void 0?t.data:null,this.create()}create(){const e=bg(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;const t=this.xhr=new $g(e);try{t.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(let r in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(r)&&t.setRequestHeader(r,this.opts.extraHeaders[r])}}catch(r){}if(this.method==="POST")try{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(r){}try{t.setRequestHeader("Accept","*/*")}catch(r){}"withCredentials"in t&&(t.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(t.timeout=this.opts.requestTimeout),t.onreadystatechange=()=>{t.readyState===4&&(t.status===200||t.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof t.status=="number"?t.status:0)},0))},t.send(this.data)}catch(r){this.setTimeoutFn(()=>{this.onError(r)},0);return}typeof document!="undefined"&&(this.index=ar.requestsCount++,ar.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr=="undefined"||this.xhr===null)){if(this.xhr.onreadystatechange=pk,e)try{this.xhr.abort()}catch(t){}typeof document!="undefined"&&delete ar.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}ar.requestsCount=0;ar.requests={};if(typeof document!="undefined"){if(typeof attachEvent=="function")attachEvent("onunload",Kf);else if(typeof addEventListener=="function"){const n="onpagehide"in Pn?"pagehide":"unload";addEventListener(n,Kf,!1)}}function Kf(){for(let n in ar.requests)ar.requests.hasOwnProperty(n)&&ar.requests[n].abort()}const Og=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?n=>Promise.resolve().then(n):(n,e)=>e(n,0))(),Us=Pn.WebSocket||Pn.MozWebSocket,Wf=!0,mk="arraybuffer",zf=typeof navigator!="undefined"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class vk extends wg{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,r=zf?{}:bg(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=Wf&&!zf?t?new Us(e,t):new Us(e):new Us(e,t,r)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType||mk,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],i=t===e.length-1;pg(r,this.supportsBinary,o=>{try{Wf&&this.ws.send(o)}catch(s){}i&&Og(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws!="undefined"&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{};const t=this.opts.secure?"wss":"ws";let r="";this.opts.port&&(t==="wss"&&Number(this.opts.port)!==443||t==="ws"&&Number(this.opts.port)!==80)&&(r=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=xg()),this.supportsBinary||(e.b64=1);const i=Eg(e),o=this.opts.hostname.indexOf(":")!==-1;return t+"://"+(o?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(i.length?"?"+i:"")}check(){return!!Us}}const bk={websocket:vk,polling:gk},wk=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,kk=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function fu(n){const e=n,t=n.indexOf("["),r=n.indexOf("]");t!=-1&&r!=-1&&(n=n.substring(0,t)+n.substring(t,r).replace(/:/g,";")+n.substring(r,n.length));let i=wk.exec(n||""),o={},s=14;for(;s--;)o[kk[s]]=i[s]||"";return t!=-1&&r!=-1&&(o.source=e,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=xk(o,o.path),o.queryKey=Ek(o,o.query),o}function xk(n,e){const t=/\/{2,9}/g,r=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&r.splice(0,1),e.slice(-1)=="/"&&r.splice(r.length-1,1),r}function Ek(n,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,i,o){i&&(t[i]=o)}),t}class Qr extends dt{constructor(e,t={}){super(),this.writeBuffer=[],e&&typeof e=="object"&&(t=e,e=null),e?(e=fu(e),t.hostname=e.host,t.secure=e.protocol==="https"||e.protocol==="wss",t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=fu(t.host).host),lc(this,t),this.secure=t.secure!=null?t.secure:typeof location!="undefined"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location!="undefined"?location.hostname:"localhost"),this.port=t.port||(typeof location!="undefined"&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=dk(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=vg,t.transport=e,this.id&&(t.sid=this.id);const r=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new bk[e](r)}open(){let e;if(this.opts.rememberUpgrade&&Qr.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch(t){this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",t=>this.onClose("transport close",t))}probe(e){let t=this.createTransport(e),r=!1;Qr.priorWebsocketSuccess=!1;const i=()=>{r||(t.send([{type:"ping",data:"probe"}]),t.once("packet",h=>{if(!r)if(h.type==="pong"&&h.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;Qr.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{r||this.readyState!=="closed"&&(u(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const y=new Error("probe error");y.transport=t.name,this.emitReserved("upgradeError",y)}}))};function o(){r||(r=!0,u(),t.close(),t=null)}const s=h=>{const y=new Error("probe error: "+h);y.transport=t.name,o(),this.emitReserved("upgradeError",y)};function a(){s("transport closed")}function c(){s("socket closed")}function l(h){t&&h.name!==t.name&&o()}const u=()=>{t.removeListener("open",i),t.removeListener("error",s),t.removeListener("close",a),this.off("close",c),this.off("upgrading",l)};t.once("open",i),t.once("error",s),t.once("close",a),this.once("close",c),this.once("upgrading",l),t.open()}onOpen(){if(this.readyState="open",Qr.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let t=0;t<this.writeBuffer.length;t++){const r=this.writeBuffer[t].data;if(r&&(e+=ck(r)),t>0&&e>this.maxPayload)return this.writeBuffer.slice(0,t);e+=2}return this.writeBuffer}write(e,t,r){return this.sendPacket("message",e,t,r),this}send(e,t,r){return this.sendPacket("message",e,t,r),this}sendPacket(e,t,r,i){if(typeof t=="function"&&(i=t,t=void 0),typeof r=="function"&&(i=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;const o={type:e,data:t,options:r};this.emitReserved("packetCreate",o),this.writeBuffer.push(o),i&&this.once("flush",i),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},r=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():e()}):this.upgrading?r():e()),this}onError(e){Qr.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let r=0;const i=e.length;for(;r<i;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}}Qr.protocol=vg;function _k(n,e="",t){let r=n;t=t||typeof location!="undefined"&&location,n==null&&(n=t.protocol+"//"+t.host),typeof n=="string"&&(n.charAt(0)==="/"&&(n.charAt(1)==="/"?n=t.protocol+n:n=t.host+n),/^(https?|wss?):\/\//.test(n)||(typeof t!="undefined"?n=t.protocol+"//"+n:n="https://"+n),r=fu(n)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const i=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+i+":"+r.port+e,r.href=r.protocol+"://"+i+(t&&t.port===r.port?"":":"+r.port),r}const $k=typeof ArrayBuffer=="function",Ok=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n.buffer instanceof ArrayBuffer,Ag=Object.prototype.toString,Ak=typeof Blob=="function"||typeof Blob!="undefined"&&Ag.call(Blob)==="[object BlobConstructor]",Sk=typeof File=="function"||typeof File!="undefined"&&Ag.call(File)==="[object FileConstructor]";function Lh(n){return $k&&(n instanceof ArrayBuffer||Ok(n))||Ak&&n instanceof Blob||Sk&&n instanceof File}function ca(n,e){if(!n||typeof n!="object")return!1;if(Array.isArray(n)){for(let t=0,r=n.length;t<r;t++)if(ca(n[t]))return!0;return!1}if(Lh(n))return!0;if(n.toJSON&&typeof n.toJSON=="function"&&arguments.length===1)return ca(n.toJSON(),!0);for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)&&ca(n[t]))return!0;return!1}function Tk(n){const e=[],t=n.data,r=n;return r.data=pu(t,e),r.attachments=e.length,{packet:r,buffers:e}}function pu(n,e){if(!n)return n;if(Lh(n)){const t={_placeholder:!0,num:e.length};return e.push(n),t}else if(Array.isArray(n)){const t=new Array(n.length);for(let r=0;r<n.length;r++)t[r]=pu(n[r],e);return t}else if(typeof n=="object"&&!(n instanceof Date)){const t={};for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=pu(n[r],e));return t}return n}function Pk(n,e){return n.data=yu(n.data,e),delete n.attachments,n}function yu(n,e){if(!n)return n;if(n&&n._placeholder===!0){if(typeof n.num=="number"&&n.num>=0&&n.num<e.length)return e[n.num];throw new Error("illegal attachments")}else if(Array.isArray(n))for(let t=0;t<n.length;t++)n[t]=yu(n[t],e);else if(typeof n=="object")for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&(n[t]=yu(n[t],e));return n}const jk=5;var Be;(function(n){n[n.CONNECT=0]="CONNECT",n[n.DISCONNECT=1]="DISCONNECT",n[n.EVENT=2]="EVENT",n[n.ACK=3]="ACK",n[n.CONNECT_ERROR=4]="CONNECT_ERROR",n[n.BINARY_EVENT=5]="BINARY_EVENT",n[n.BINARY_ACK=6]="BINARY_ACK"})(Be||(Be={}));class Rk{constructor(e){this.replacer=e}encode(e){return(e.type===Be.EVENT||e.type===Be.ACK)&&ca(e)?this.encodeAsBinary({type:e.type===Be.EVENT?Be.BINARY_EVENT:Be.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===Be.BINARY_EVENT||e.type===Be.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=Tk(e),r=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(r),i}}class Dh extends dt{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const r=t.type===Be.BINARY_EVENT;r||t.type===Be.BINARY_ACK?(t.type=r?Be.EVENT:Be.ACK,this.reconstructor=new Ik(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(Lh(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const r={type:Number(e.charAt(0))};if(Be[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===Be.BINARY_EVENT||r.type===Be.BINARY_ACK){const o=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const s=e.substring(o,t);if(s!=Number(s)||e.charAt(t)!=="-")throw new Error("Illegal attachments");r.attachments=Number(s)}if(e.charAt(t+1)==="/"){const o=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););r.nsp=e.substring(o,t)}else r.nsp="/";const i=e.charAt(t+1);if(i!==""&&Number(i)==i){const o=t+1;for(;++t;){const s=e.charAt(t);if(s==null||Number(s)!=s){--t;break}if(t===e.length)break}r.id=Number(e.substring(o,t+1))}if(e.charAt(++t)){const o=this.tryParse(e.substr(t));if(Dh.isPayloadValid(r.type,o))r.data=o;else throw new Error("invalid payload")}return r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(t){return!1}}static isPayloadValid(e,t){switch(e){case Be.CONNECT:return typeof t=="object";case Be.DISCONNECT:return t===void 0;case Be.CONNECT_ERROR:return typeof t=="string"||typeof t=="object";case Be.EVENT:case Be.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="string"||typeof t[0]=="number");case Be.ACK:case Be.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Ik{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=Pk(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const Ck=Object.freeze(Object.defineProperty({__proto__:null,protocol:jk,get PacketType(){return Be},Encoder:Rk,Decoder:Dh},Symbol.toStringTag,{value:"Module"}));function Mn(n,e,t){return n.on(e,t),function(){n.off(e,t)}}const Nk=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Sg extends dt{constructor(e,t,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Mn(e,"open",this.onopen.bind(this)),Mn(e,"packet",this.onpacket.bind(this)),Mn(e,"error",this.onerror.bind(this)),Mn(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(Nk.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const r={type:Be.EVENT,data:t};if(r.options={},r.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const o=this.ids++,s=t.pop();this._registerAckCallback(o,s),r.id=o}const i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!i||!this.connected)||(this.connected?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(e,t){var r;const i=(r=this.flags.timeout)!==null&&r!==void 0?r:this._opts.ackTimeout;if(i===void 0){this.acks[e]=t;return}const o=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let s=0;s<this.sendBuffer.length;s++)this.sendBuffer[s].id===e&&this.sendBuffer.splice(s,1);t.call(this,new Error("operation has timed out"))},i);this.acks[e]=(...s)=>{this.io.clearTimeoutFn(o),t.apply(this,[null,...s])}}emitWithAck(e,...t){const r=this.flags.timeout!==void 0||this._opts.ackTimeout!==void 0;return new Promise((i,o)=>{t.push((s,a)=>r?s?o(s):i(a):i(s)),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((i,...o)=>r!==this._queue[0]?void 0:(i!==null?r.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(i)):(this._queue.shift(),t&&t(null,...o)),r.pending=!1,this._drainQueue())),this._queue.push(r),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:Be.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case Be.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Be.EVENT:case Be.BINARY_EVENT:this.onevent(e);break;case Be.ACK:case Be.BINARY_ACK:this.onack(e);break;case Be.DISCONNECT:this.ondisconnect();break;case Be.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const r of t)r.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let r=!1;return function(...i){r||(r=!0,t.packet({type:Be.ACK,id:e,data:i}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Be.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const r of t)r.apply(this,e.data)}}}function po(n){n=n||{},this.ms=n.min||100,this.max=n.max||1e4,this.factor=n.factor||2,this.jitter=n.jitter>0&&n.jitter<=1?n.jitter:0,this.attempts=0}po.prototype.duration=function(){var n=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*n);n=(Math.floor(e*10)&1)==0?n-t:n+t}return Math.min(n,this.max)|0};po.prototype.reset=function(){this.attempts=0};po.prototype.setMin=function(n){this.ms=n};po.prototype.setMax=function(n){this.max=n};po.prototype.setJitter=function(n){this.jitter=n};class gu extends dt{constructor(e,t){var r;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,lc(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((r=t.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new po({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const i=t.parser||Ck;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Qr(this.uri,this.opts);const t=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const i=Mn(t,"open",function(){r.onopen(),e&&e()}),o=Mn(t,"error",s=>{r.cleanup(),r._readyState="closed",this.emitReserved("error",s),e?e(s):r.maybeReconnectOnOpen()});if(this._timeout!==!1){const s=this._timeout;s===0&&i();const a=this.setTimeoutFn(()=>{i(),t.close(),t.emit("error",new Error("timeout"))},s);this.opts.autoUnref&&a.unref(),this.subs.push(function(){clearTimeout(a)})}return this.subs.push(i),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Mn(e,"ping",this.onping.bind(this)),Mn(e,"data",this.ondata.bind(this)),Mn(e,"error",this.onerror.bind(this)),Mn(e,"close",this.onclose.bind(this)),Mn(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){Og(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new Sg(this,e,t),this.nsps[e]=r),r}_destroy(e){const t=Object.keys(this.nsps);for(const r of t)if(this.nsps[r].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let r=0;r<t.length;r++)this.engine.write(t[r],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(i=>{i?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",i)):e.onreconnect()}))},t);this.opts.autoUnref&&r.unref(),this.subs.push(function(){clearTimeout(r)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const $o={};function la(n,e){typeof n=="object"&&(e=n,n=void 0),e=e||{};const t=_k(n,e.path||"/socket.io"),r=t.source,i=t.id,o=t.path,s=$o[i]&&o in $o[i].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||s;let c;return a?c=new gu(r,e):($o[i]||($o[i]=new gu(r,e)),c=$o[i]),t.query&&!e.query&&(e.query=t.queryKey),c.socket(t.path,e)}Object.assign(la,{Manager:gu,Socket:Sg,io:la,connect:la});const Bk={init:({API_KEY:n,HOST_SERVER:e,CURRENT:t,ENV:r,API_VERSION:i})=>{var o,s;let a={};const c=localStorage.getItem("accessToken");try{const l={Accept:"application/json","Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Key":n,"Access-Control-Allow-Methods":"POST, GET, OPTIONS, PUT, DELETE, HEAD,PATCH","Access-Control-Allow-Headers":"X-PINGOTHER, Origin, X-Requested-With, Content-Type, Accept","Access-Control-Max-Age":"1728000"};return c&&(l.Authorization="Bearer "+c),a.auth=la(e.AUTH,{extraHeaders:l}),(o=a==null?void 0:a.auth)==null||o.on("connect",()=>{var u,h,y,d,f;r==="dev"&&console.log("Swyger Auth Client JS is connected with Swyger Server!!!");let g=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");g.uid&&(u=a.auth)!=null&&u.id&&(r==="dev"&&console.log("The socket device id is: ",(h=a.auth)==null?void 0:h.id),(d=a==null?void 0:a.auth)==null||d.emit((i==null?void 0:i.AUTH)+"/user/join",{socketId:(y=a.auth)==null?void 0:y.id,currentUserId:g.uid}),(f=a==null?void 0:a.auth)==null||f.on((i==null?void 0:i.AUTH)+"/user/status",_=>{if(g.status!=="online"){let A;_.from===g.uid&&(A=_==null?void 0:_.value),A!=null&&A.status&&(r==="dev"&&console.log("user is online: ",A),g.status=A.status,localStorage.setItem("userInfo",JSON.stringify(g)))}}))}),(s=a==null?void 0:a.auth)==null||s.on("disconnect",u=>{r==="dev"&&console.log("The device is disconnected from Auth server!");let h=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");h.uid&&h.status!=="offline"&&(h.status="offline",localStorage.setItem("userInfo",JSON.stringify(h)))}),a}catch(l){}}};function mu(n){this.message=n}mu.prototype=new Error,mu.prototype.name="InvalidCharacterError";var Hf=typeof window!="undefined"&&window.atob&&window.atob.bind(window)||function(n){var e=String(n).replace(/=+$/,"");if(e.length%4==1)throw new mu("'atob' failed: The string to be decoded is not correctly encoded.");for(var t,r,i=0,o=0,s="";r=e.charAt(o++);~r&&(t=i%4?64*t+r:r,i++%4)?s+=String.fromCharCode(255&t>>(-2*i&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return s};function Lk(n){var e=n.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw"Illegal base64url string!"}try{return function(t){return decodeURIComponent(Hf(t).replace(/(.)/g,function(r,i){var o=i.charCodeAt(0).toString(16).toUpperCase();return o.length<2&&(o="0"+o),"%"+o}))}(e)}catch(t){return Hf(e)}}function Wa(n){this.message=n}function Jf(n,e){if(typeof n!="string")throw new Wa("Invalid token specified");var t=(e=e||{}).header===!0?0:1;try{return JSON.parse(Lk(n.split(".")[t]))}catch(r){throw new Wa("Invalid token specified: "+r.message)}}Wa.prototype=new Error,Wa.prototype.name="InvalidTokenError";function Tg(n,e){return function(){return n.apply(e,arguments)}}const{toString:Dk}=Object.prototype,{getPrototypeOf:qh}=Object,uc=(n=>e=>{const t=Dk.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),fr=n=>(n=n.toLowerCase(),e=>uc(e)===n),hc=n=>e=>typeof e===n,{isArray:yo}=Array,Jo=hc("undefined");function qk(n){return n!==null&&!Jo(n)&&n.constructor!==null&&!Jo(n.constructor)&&In(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const Pg=fr("ArrayBuffer");function Uk(n){let e;return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&Pg(n.buffer),e}const Mk=hc("string"),In=hc("function"),jg=hc("number"),dc=n=>n!==null&&typeof n=="object",Fk=n=>n===!0||n===!1,ua=n=>{if(uc(n)!=="object")return!1;const e=qh(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},Vk=fr("Date"),Kk=fr("File"),Wk=fr("Blob"),zk=fr("FileList"),Hk=n=>dc(n)&&In(n.pipe),Jk=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||In(n.append)&&((e=uc(n))==="formdata"||e==="object"&&In(n.toString)&&n.toString()==="[object FormData]"))},Yk=fr("URLSearchParams"),Gk=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function vs(n,e,{allOwnKeys:t=!1}={}){if(n===null||typeof n=="undefined")return;let r,i;if(typeof n!="object"&&(n=[n]),yo(n))for(r=0,i=n.length;r<i;r++)e.call(null,n[r],r,n);else{const o=t?Object.getOwnPropertyNames(n):Object.keys(n),s=o.length;let a;for(r=0;r<s;r++)a=o[r],e.call(null,n[a],a,n)}}function Rg(n,e){e=e.toLowerCase();const t=Object.keys(n);let r=t.length,i;for(;r-- >0;)if(i=t[r],e===i.toLowerCase())return i;return null}const Ig=(()=>typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:global)(),Cg=n=>!Jo(n)&&n!==Ig;function vu(){const{caseless:n}=Cg(this)&&this||{},e={},t=(r,i)=>{const o=n&&Rg(e,i)||i;ua(e[o])&&ua(r)?e[o]=vu(e[o],r):ua(r)?e[o]=vu({},r):yo(r)?e[o]=r.slice():e[o]=r};for(let r=0,i=arguments.length;r<i;r++)arguments[r]&&vs(arguments[r],t);return e}const Xk=(n,e,t,{allOwnKeys:r}={})=>(vs(e,(i,o)=>{t&&In(i)?n[o]=Tg(i,t):n[o]=i},{allOwnKeys:r}),n),Zk=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),Qk=(n,e,t,r)=>{n.prototype=Object.create(e.prototype,r),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),t&&Object.assign(n.prototype,t)},ex=(n,e,t,r)=>{let i,o,s;const a={};if(e=e||{},n==null)return e;do{for(i=Object.getOwnPropertyNames(n),o=i.length;o-- >0;)s=i[o],(!r||r(s,n,e))&&!a[s]&&(e[s]=n[s],a[s]=!0);n=t!==!1&&qh(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e},tx=(n,e,t)=>{n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;const r=n.indexOf(e,t);return r!==-1&&r===t},nx=n=>{if(!n)return null;if(yo(n))return n;let e=n.length;if(!jg(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=n[e];return t},rx=(n=>e=>n&&e instanceof n)(typeof Uint8Array!="undefined"&&qh(Uint8Array)),ix=(n,e)=>{const t=(n&&n[Symbol.iterator]).call(n);let r;for(;(r=t.next())&&!r.done;){const i=r.value;e.call(n,i[0],i[1])}},ox=(n,e)=>{let t;const r=[];for(;(t=n.exec(e))!==null;)r.push(t);return r},sx=fr("HTMLFormElement"),ax=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,r){return t.toUpperCase()+r}),Yf=(({hasOwnProperty:n})=>(e,t)=>n.call(e,t))(Object.prototype),cx=fr("RegExp"),Ng=(n,e)=>{const t=Object.getOwnPropertyDescriptors(n),r={};vs(t,(i,o)=>{e(i,o,n)!==!1&&(r[o]=i)}),Object.defineProperties(n,r)},lx=n=>{Ng(n,(e,t)=>{if(In(n)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const r=n[t];if(In(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},ux=(n,e)=>{const t={},r=i=>{i.forEach(o=>{t[o]=!0})};return yo(n)?r(n):r(String(n).split(e)),t},hx=()=>{},dx=(n,e)=>(n=+n,Number.isFinite(n)?n:e),dl="abcdefghijklmnopqrstuvwxyz",Gf="0123456789",Bg={DIGIT:Gf,ALPHA:dl,ALPHA_DIGIT:dl+dl.toUpperCase()+Gf},fx=(n=16,e=Bg.ALPHA_DIGIT)=>{let t="";const{length:r}=e;for(;n--;)t+=e[Math.random()*r|0];return t};function px(n){return!!(n&&In(n.append)&&n[Symbol.toStringTag]==="FormData"&&n[Symbol.iterator])}const yx=n=>{const e=new Array(10),t=(r,i)=>{if(dc(r)){if(e.indexOf(r)>=0)return;if(!("toJSON"in r)){e[i]=r;const o=yo(r)?[]:{};return vs(r,(s,a)=>{const c=t(s,i+1);!Jo(c)&&(o[a]=c)}),e[i]=void 0,o}}return r};return t(n,0)},gx=fr("AsyncFunction"),mx=n=>n&&(dc(n)||In(n))&&In(n.then)&&In(n.catch),Z={isArray:yo,isArrayBuffer:Pg,isBuffer:qk,isFormData:Jk,isArrayBufferView:Uk,isString:Mk,isNumber:jg,isBoolean:Fk,isObject:dc,isPlainObject:ua,isUndefined:Jo,isDate:Vk,isFile:Kk,isBlob:Wk,isRegExp:cx,isFunction:In,isStream:Hk,isURLSearchParams:Yk,isTypedArray:rx,isFileList:zk,forEach:vs,merge:vu,extend:Xk,trim:Gk,stripBOM:Zk,inherits:Qk,toFlatObject:ex,kindOf:uc,kindOfTest:fr,endsWith:tx,toArray:nx,forEachEntry:ix,matchAll:ox,isHTMLForm:sx,hasOwnProperty:Yf,hasOwnProp:Yf,reduceDescriptors:Ng,freezeMethods:lx,toObjectSet:ux,toCamelCase:ax,noop:hx,toFiniteNumber:dx,findKey:Rg,global:Ig,isContextDefined:Cg,ALPHABET:Bg,generateString:fx,isSpecCompliantForm:px,toJSONObject:yx,isAsyncFn:gx,isThenable:mx};function Ve(n,e,t,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),r&&(this.request=r),i&&(this.response=i)}Z.inherits(Ve,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Z.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const Lg=Ve.prototype,Dg={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{Dg[n]={value:n}});Object.defineProperties(Ve,Dg);Object.defineProperty(Lg,"isAxiosError",{value:!0});Ve.from=(n,e,t,r,i,o)=>{const s=Object.create(Lg);return Z.toFlatObject(n,s,function(a){return a!==Error.prototype},a=>a!=="isAxiosError"),Ve.call(s,n.message,e,t,r,i),s.cause=n,s.name=n.name,o&&Object.assign(s,o),s};const vx=null;function bu(n){return Z.isPlainObject(n)||Z.isArray(n)}function qg(n){return Z.endsWith(n,"[]")?n.slice(0,-2):n}function Xf(n,e,t){return n?n.concat(e).map(function(r,i){return r=qg(r),!t&&i?"["+r+"]":r}).join(t?".":""):e}function bx(n){return Z.isArray(n)&&!n.some(bu)}const wx=Z.toFlatObject(Z,{},null,function(n){return/^is[A-Z]/.test(n)});function fc(n,e,t){if(!Z.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,t=Z.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(d,f){return!Z.isUndefined(f[d])});const r=t.metaTokens,i=t.visitor||l,o=t.dots,s=t.indexes,a=(t.Blob||typeof Blob!="undefined"&&Blob)&&Z.isSpecCompliantForm(e);if(!Z.isFunction(i))throw new TypeError("visitor must be a function");function c(d){if(d===null)return"";if(Z.isDate(d))return d.toISOString();if(!a&&Z.isBlob(d))throw new Ve("Blob is not supported. Use a Buffer instead.");return Z.isArrayBuffer(d)||Z.isTypedArray(d)?a&&typeof Blob=="function"?new Blob([d]):Buffer.from(d):d}function l(d,f,g){let _=d;if(d&&!g&&typeof d=="object"){if(Z.endsWith(f,"{}"))f=r?f:f.slice(0,-2),d=JSON.stringify(d);else if(Z.isArray(d)&&bx(d)||(Z.isFileList(d)||Z.endsWith(f,"[]"))&&(_=Z.toArray(d)))return f=qg(f),_.forEach(function(A,P){!(Z.isUndefined(A)||A===null)&&e.append(s===!0?Xf([f],P,o):s===null?f:f+"[]",c(A))}),!1}return bu(d)?!0:(e.append(Xf(g,f,o),c(d)),!1)}const u=[],h=Object.assign(wx,{defaultVisitor:l,convertValue:c,isVisitable:bu});function y(d,f){if(!Z.isUndefined(d)){if(u.indexOf(d)!==-1)throw Error("Circular reference detected in "+f.join("."));u.push(d),Z.forEach(d,function(g,_){(!(Z.isUndefined(g)||g===null)&&i.call(e,g,Z.isString(_)?_.trim():_,f,h))===!0&&y(g,f?f.concat(_):[_])}),u.pop()}}if(!Z.isObject(n))throw new TypeError("data must be an object");return y(n),e}function Zf(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(t){return e[t]})}function Uh(n,e){this._pairs=[],n&&fc(n,this,e)}const Ug=Uh.prototype;Ug.append=function(n,e){this._pairs.push([n,e])};Ug.toString=function(n){const e=n?function(t){return n.call(this,t,Zf)}:Zf;return this._pairs.map(function(t){return e(t[0])+"="+e(t[1])},"").join("&")};function kx(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Mg(n,e,t){if(!e)return n;const r=t&&t.encode||kx,i=t&&t.serialize;let o;if(i?o=i(e,t):o=Z.isURLSearchParams(e)?e.toString():new Uh(e,t).toString(r),o){const s=n.indexOf("#");s!==-1&&(n=n.slice(0,s)),n+=(n.indexOf("?")===-1?"?":"&")+o}return n}class xx{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Z.forEach(this.handlers,function(t){t!==null&&e(t)})}}const Qf=xx,Fg={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Ex=typeof URLSearchParams!="undefined"?URLSearchParams:Uh,_x=typeof FormData!="undefined"?FormData:null,$x=typeof Blob!="undefined"?Blob:null,Ox=(()=>{let n;return typeof navigator!="undefined"&&((n=navigator.product)==="ReactNative"||n==="NativeScript"||n==="NS")?!1:typeof window!="undefined"&&typeof document!="undefined"})(),Ax=(()=>typeof WorkerGlobalScope!="undefined"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),ir={isBrowser:!0,classes:{URLSearchParams:Ex,FormData:_x,Blob:$x},isStandardBrowserEnv:Ox,isStandardBrowserWebWorkerEnv:Ax,protocols:["http","https","file","blob","url","data"]};function Sx(n,e){return fc(n,new ir.classes.URLSearchParams,Object.assign({visitor:function(t,r,i,o){return ir.isNode&&Z.isBuffer(t)?(this.append(r,t.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},e))}function Tx(n){return Z.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Px(n){const e={},t=Object.keys(n);let r;const i=t.length;let o;for(r=0;r<i;r++)o=t[r],e[o]=n[o];return e}function Vg(n){function e(t,r,i,o){let s=t[o++];const a=Number.isFinite(+s),c=o>=t.length;return s=!s&&Z.isArray(i)?i.length:s,c?(Z.hasOwnProp(i,s)?i[s]=[i[s],r]:i[s]=r,!a):((!i[s]||!Z.isObject(i[s]))&&(i[s]=[]),e(t,r,i[s],o)&&Z.isArray(i[s])&&(i[s]=Px(i[s])),!a)}if(Z.isFormData(n)&&Z.isFunction(n.entries)){const t={};return Z.forEachEntry(n,(r,i)=>{e(Tx(r),i,t,0)}),t}return null}const jx={"Content-Type":void 0};function Rx(n,e,t){if(Z.isString(n))try{return(e||JSON.parse)(n),Z.trim(n)}catch(r){if(r.name!=="SyntaxError")throw r}return(t||JSON.stringify)(n)}const pc={transitional:Fg,adapter:["xhr","http"],transformRequest:[function(n,e){const t=e.getContentType()||"",r=t.indexOf("application/json")>-1,i=Z.isObject(n);if(i&&Z.isHTMLForm(n)&&(n=new FormData(n)),Z.isFormData(n))return r&&r?JSON.stringify(Vg(n)):n;if(Z.isArrayBuffer(n)||Z.isBuffer(n)||Z.isStream(n)||Z.isFile(n)||Z.isBlob(n))return n;if(Z.isArrayBufferView(n))return n.buffer;if(Z.isURLSearchParams(n))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),n.toString();let o;if(i){if(t.indexOf("application/x-www-form-urlencoded")>-1)return Sx(n,this.formSerializer).toString();if((o=Z.isFileList(n))||t.indexOf("multipart/form-data")>-1){const s=this.env&&this.env.FormData;return fc(o?{"files[]":n}:n,s&&new s,this.formSerializer)}}return i||r?(e.setContentType("application/json",!1),Rx(n)):n}],transformResponse:[function(n){const e=this.transitional||pc.transitional,t=e&&e.forcedJSONParsing,r=this.responseType==="json";if(n&&Z.isString(n)&&(t&&!this.responseType||r)){const i=!(e&&e.silentJSONParsing)&&r;try{return JSON.parse(n)}catch(o){if(i)throw o.name==="SyntaxError"?Ve.from(o,Ve.ERR_BAD_RESPONSE,this,null,this.response):o}}return n}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ir.classes.FormData,Blob:ir.classes.Blob},validateStatus:function(n){return n>=200&&n<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};Z.forEach(["delete","get","head"],function(n){pc.headers[n]={}});Z.forEach(["post","put","patch"],function(n){pc.headers[n]=Z.merge(jx)});const Mh=pc,Ix=Z.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Cx=n=>{const e={};let t,r,i;return n&&n.split(`
`).forEach(function(o){i=o.indexOf(":"),t=o.substring(0,i).trim().toLowerCase(),r=o.substring(i+1).trim(),!(!t||e[t]&&Ix[t])&&(t==="set-cookie"?e[t]?e[t].push(r):e[t]=[r]:e[t]=e[t]?e[t]+", "+r:r)}),e},ep=Symbol("internals");function Oo(n){return n&&String(n).trim().toLowerCase()}function ha(n){return n===!1||n==null?n:Z.isArray(n)?n.map(ha):String(n)}function Nx(n){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=t.exec(n);)e[r[1]]=r[2];return e}const Bx=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function fl(n,e,t,r,i){if(Z.isFunction(r))return r.call(this,e,t);if(i&&(e=t),!!Z.isString(e)){if(Z.isString(r))return e.indexOf(r)!==-1;if(Z.isRegExp(r))return r.test(e)}}function Lx(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,r)=>t.toUpperCase()+r)}function Dx(n,e){const t=Z.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(n,r+t,{value:function(i,o,s){return this[r].call(this,e,i,o,s)},configurable:!0})})}class yc{constructor(e){e&&this.set(e)}set(e,t,r){const i=this;function o(a,c,l){const u=Oo(c);if(!u)throw new Error("header name must be a non-empty string");const h=Z.findKey(i,u);(!h||i[h]===void 0||l===!0||l===void 0&&i[h]!==!1)&&(i[h||c]=ha(a))}const s=(a,c)=>Z.forEach(a,(l,u)=>o(l,u,c));return Z.isPlainObject(e)||e instanceof this.constructor?s(e,t):Z.isString(e)&&(e=e.trim())&&!Bx(e)?s(Cx(e),t):e!=null&&o(t,e,r),this}get(e,t){if(e=Oo(e),e){const r=Z.findKey(this,e);if(r){const i=this[r];if(!t)return i;if(t===!0)return Nx(i);if(Z.isFunction(t))return t.call(this,i,r);if(Z.isRegExp(t))return t.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Oo(e),e){const r=Z.findKey(this,e);return!!(r&&this[r]!==void 0&&(!t||fl(this,this[r],r,t)))}return!1}delete(e,t){const r=this;let i=!1;function o(s){if(s=Oo(s),s){const a=Z.findKey(r,s);a&&(!t||fl(r,r[a],a,t))&&(delete r[a],i=!0)}}return Z.isArray(e)?e.forEach(o):o(e),i}clear(e){const t=Object.keys(this);let r=t.length,i=!1;for(;r--;){const o=t[r];(!e||fl(this,this[o],o,e,!0))&&(delete this[o],i=!0)}return i}normalize(e){const t=this,r={};return Z.forEach(this,(i,o)=>{const s=Z.findKey(r,o);if(s){t[s]=ha(i),delete t[o];return}const a=e?Lx(o):String(o).trim();a!==o&&delete t[o],t[a]=ha(i),r[a]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return Z.forEach(this,(r,i)=>{r!=null&&r!==!1&&(t[i]=e&&Z.isArray(r)?r.join(", "):r)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const r=new this(e);return t.forEach(i=>r.set(i)),r}static accessor(e){const t=(this[ep]=this[ep]={accessors:{}}).accessors,r=this.prototype;function i(o){const s=Oo(o);t[s]||(Dx(r,o),t[s]=!0)}return Z.isArray(e)?e.forEach(i):i(e),this}}yc.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Z.freezeMethods(yc.prototype);Z.freezeMethods(yc);const xr=yc;function pl(n,e){const t=this||Mh,r=e||t,i=xr.from(r.headers);let o=r.data;return Z.forEach(n,function(s){o=s.call(t,o,i.normalize(),e?e.status:void 0)}),i.normalize(),o}function Kg(n){return!!(n&&n.__CANCEL__)}function bs(n,e,t){Ve.call(this,n==null?"canceled":n,Ve.ERR_CANCELED,e,t),this.name="CanceledError"}Z.inherits(bs,Ve,{__CANCEL__:!0});function qx(n,e,t){const r=t.config.validateStatus;!t.status||!r||r(t.status)?n(t):e(new Ve("Request failed with status code "+t.status,[Ve.ERR_BAD_REQUEST,Ve.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}const Ux=ir.isStandardBrowserEnv?function(){return{write:function(n,e,t,r,i,o){const s=[];s.push(n+"="+encodeURIComponent(e)),Z.isNumber(t)&&s.push("expires="+new Date(t).toGMTString()),Z.isString(r)&&s.push("path="+r),Z.isString(i)&&s.push("domain="+i),o===!0&&s.push("secure"),document.cookie=s.join("; ")},read:function(n){const e=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(n){this.write(n,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}();function Mx(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function Fx(n,e){return e?n.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):n}function Wg(n,e){return n&&!Mx(e)?Fx(n,e):e}const Vx=ir.isStandardBrowserEnv?function(){const n=/(msie|trident)/i.test(navigator.userAgent),e=document.createElement("a");let t;function r(i){let o=i;return n&&(e.setAttribute("href",o),o=e.href),e.setAttribute("href",o),{href:e.href,protocol:e.protocol?e.protocol.replace(/:$/,""):"",host:e.host,search:e.search?e.search.replace(/^\?/,""):"",hash:e.hash?e.hash.replace(/^#/,""):"",hostname:e.hostname,port:e.port,pathname:e.pathname.charAt(0)==="/"?e.pathname:"/"+e.pathname}}return t=r(window.location.href),function(i){const o=Z.isString(i)?r(i):i;return o.protocol===t.protocol&&o.host===t.host}}():function(){return function(){return!0}}();function Kx(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function Wx(n,e){n=n||10;const t=new Array(n),r=new Array(n);let i=0,o=0,s;return e=e!==void 0?e:1e3,function(a){const c=Date.now(),l=r[o];s||(s=c),t[i]=a,r[i]=c;let u=o,h=0;for(;u!==i;)h+=t[u++],u=u%n;if(i=(i+1)%n,i===o&&(o=(o+1)%n),c-s<e)return;const y=l&&c-l;return y?Math.round(h*1e3/y):void 0}}function tp(n,e){let t=0;const r=Wx(50,250);return i=>{const o=i.loaded,s=i.lengthComputable?i.total:void 0,a=o-t,c=r(a),l=o<=s;t=o;const u={loaded:o,total:s,progress:s?o/s:void 0,bytes:a,rate:c||void 0,estimated:c&&s&&l?(s-o)/c:void 0,event:i};u[e?"download":"upload"]=!0,n(u)}}const zx=typeof XMLHttpRequest!="undefined",Hx=zx&&function(n){return new Promise(function(e,t){let r=n.data;const i=xr.from(n.headers).normalize(),o=n.responseType;let s;function a(){n.cancelToken&&n.cancelToken.unsubscribe(s),n.signal&&n.signal.removeEventListener("abort",s)}Z.isFormData(r)&&(ir.isStandardBrowserEnv||ir.isStandardBrowserWebWorkerEnv?i.setContentType(!1):i.setContentType("multipart/form-data;",!1));let c=new XMLHttpRequest;if(n.auth){const y=n.auth.username||"",d=n.auth.password?unescape(encodeURIComponent(n.auth.password)):"";i.set("Authorization","Basic "+btoa(y+":"+d))}const l=Wg(n.baseURL,n.url);c.open(n.method.toUpperCase(),Mg(l,n.params,n.paramsSerializer),!0),c.timeout=n.timeout;function u(){if(!c)return;const y=xr.from("getAllResponseHeaders"in c&&c.getAllResponseHeaders()),d={data:!o||o==="text"||o==="json"?c.responseText:c.response,status:c.status,statusText:c.statusText,headers:y,config:n,request:c};qx(function(f){e(f),a()},function(f){t(f),a()},d),c=null}if("onloadend"in c?c.onloadend=u:c.onreadystatechange=function(){!c||c.readyState!==4||c.status===0&&!(c.responseURL&&c.responseURL.indexOf("file:")===0)||setTimeout(u)},c.onabort=function(){!c||(t(new Ve("Request aborted",Ve.ECONNABORTED,n,c)),c=null)},c.onerror=function(){t(new Ve("Network Error",Ve.ERR_NETWORK,n,c)),c=null},c.ontimeout=function(){let y=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const d=n.transitional||Fg;n.timeoutErrorMessage&&(y=n.timeoutErrorMessage),t(new Ve(y,d.clarifyTimeoutError?Ve.ETIMEDOUT:Ve.ECONNABORTED,n,c)),c=null},ir.isStandardBrowserEnv){const y=(n.withCredentials||Vx(l))&&n.xsrfCookieName&&Ux.read(n.xsrfCookieName);y&&i.set(n.xsrfHeaderName,y)}r===void 0&&i.setContentType(null),"setRequestHeader"in c&&Z.forEach(i.toJSON(),function(y,d){c.setRequestHeader(d,y)}),Z.isUndefined(n.withCredentials)||(c.withCredentials=!!n.withCredentials),o&&o!=="json"&&(c.responseType=n.responseType),typeof n.onDownloadProgress=="function"&&c.addEventListener("progress",tp(n.onDownloadProgress,!0)),typeof n.onUploadProgress=="function"&&c.upload&&c.upload.addEventListener("progress",tp(n.onUploadProgress)),(n.cancelToken||n.signal)&&(s=y=>{!c||(t(!y||y.type?new bs(null,n,c):y),c.abort(),c=null)},n.cancelToken&&n.cancelToken.subscribe(s),n.signal&&(n.signal.aborted?s():n.signal.addEventListener("abort",s)));const h=Kx(l);if(h&&ir.protocols.indexOf(h)===-1){t(new Ve("Unsupported protocol "+h+":",Ve.ERR_BAD_REQUEST,n));return}c.send(r||null)})},da={http:vx,xhr:Hx};Z.forEach(da,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch(t){}Object.defineProperty(n,"adapterName",{value:e})}});const Jx={getAdapter:n=>{n=Z.isArray(n)?n:[n];const{length:e}=n;let t,r;for(let i=0;i<e&&(t=n[i],!(r=Z.isString(t)?da[t.toLowerCase()]:t));i++);if(!r)throw r===!1?new Ve(`Adapter ${t} is not supported by the environment`,"ERR_NOT_SUPPORT"):new Error(Z.hasOwnProp(da,t)?`Adapter '${t}' is not available in the build`:`Unknown adapter '${t}'`);if(!Z.isFunction(r))throw new TypeError("adapter is not a function");return r},adapters:da};function yl(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new bs(null,n)}function np(n){return yl(n),n.headers=xr.from(n.headers),n.data=pl.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),Jx.getAdapter(n.adapter||Mh.adapter)(n).then(function(e){return yl(n),e.data=pl.call(n,n.transformResponse,e),e.headers=xr.from(e.headers),e},function(e){return Kg(e)||(yl(n),e&&e.response&&(e.response.data=pl.call(n,n.transformResponse,e.response),e.response.headers=xr.from(e.response.headers))),Promise.reject(e)})}const rp=n=>n instanceof xr?n.toJSON():n;function io(n,e){e=e||{};const t={};function r(l,u,h){return Z.isPlainObject(l)&&Z.isPlainObject(u)?Z.merge.call({caseless:h},l,u):Z.isPlainObject(u)?Z.merge({},u):Z.isArray(u)?u.slice():u}function i(l,u,h){if(Z.isUndefined(u)){if(!Z.isUndefined(l))return r(void 0,l,h)}else return r(l,u,h)}function o(l,u){if(!Z.isUndefined(u))return r(void 0,u)}function s(l,u){if(Z.isUndefined(u)){if(!Z.isUndefined(l))return r(void 0,l)}else return r(void 0,u)}function a(l,u,h){if(h in e)return r(l,u);if(h in n)return r(void 0,l)}const c={url:o,method:o,data:o,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:a,headers:(l,u)=>i(rp(l),rp(u),!0)};return Z.forEach(Object.keys(Object.assign({},n,e)),function(l){const u=c[l]||i,h=u(n[l],e[l],l);Z.isUndefined(h)&&u!==a||(t[l]=h)}),t}const zg="1.4.0",Fh={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{Fh[n]=function(t){return typeof t===n||"a"+(e<1?"n ":" ")+n}});const ip={};Fh.transitional=function(n,e,t){function r(i,o){return"[Axios v"+zg+"] Transitional option '"+i+"'"+o+(t?". "+t:"")}return(i,o,s)=>{if(n===!1)throw new Ve(r(o," has been removed"+(e?" in "+e:"")),Ve.ERR_DEPRECATED);return e&&!ip[o]&&(ip[o]=!0,console.warn(r(o," has been deprecated since v"+e+" and will be removed in the near future"))),n?n(i,o,s):!0}};function Yx(n,e,t){if(typeof n!="object")throw new Ve("options must be an object",Ve.ERR_BAD_OPTION_VALUE);const r=Object.keys(n);let i=r.length;for(;i-- >0;){const o=r[i],s=e[o];if(s){const a=n[o],c=a===void 0||s(a,o,n);if(c!==!0)throw new Ve("option "+o+" must be "+c,Ve.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new Ve("Unknown option "+o,Ve.ERR_BAD_OPTION)}}const wu={assertOptions:Yx,validators:Fh},Ur=wu.validators;class za{constructor(e){this.defaults=e,this.interceptors={request:new Qf,response:new Qf}}request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=io(this.defaults,t);const{transitional:r,paramsSerializer:i,headers:o}=t;r!==void 0&&wu.assertOptions(r,{silentJSONParsing:Ur.transitional(Ur.boolean),forcedJSONParsing:Ur.transitional(Ur.boolean),clarifyTimeoutError:Ur.transitional(Ur.boolean)},!1),i!=null&&(Z.isFunction(i)?t.paramsSerializer={serialize:i}:wu.assertOptions(i,{encode:Ur.function,serialize:Ur.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let s;s=o&&Z.merge(o.common,o[t.method]),s&&Z.forEach(["delete","get","head","post","put","patch","common"],f=>{delete o[f]}),t.headers=xr.concat(s,o);const a=[];let c=!0;this.interceptors.request.forEach(function(f){typeof f.runWhen=="function"&&f.runWhen(t)===!1||(c=c&&f.synchronous,a.unshift(f.fulfilled,f.rejected))});const l=[];this.interceptors.response.forEach(function(f){l.push(f.fulfilled,f.rejected)});let u,h=0,y;if(!c){const f=[np.bind(this),void 0];for(f.unshift.apply(f,a),f.push.apply(f,l),y=f.length,u=Promise.resolve(t);h<y;)u=u.then(f[h++],f[h++]);return u}y=a.length;let d=t;for(h=0;h<y;){const f=a[h++],g=a[h++];try{d=f(d)}catch(_){g.call(this,_);break}}try{u=np.call(this,d)}catch(f){return Promise.reject(f)}for(h=0,y=l.length;h<y;)u=u.then(l[h++],l[h++]);return u}getUri(e){e=io(this.defaults,e);const t=Wg(e.baseURL,e.url);return Mg(t,e.params,e.paramsSerializer)}}Z.forEach(["delete","get","head","options"],function(n){za.prototype[n]=function(e,t){return this.request(io(t||{},{method:n,url:e,data:(t||{}).data}))}});Z.forEach(["post","put","patch"],function(n){function e(t){return function(r,i,o){return this.request(io(o||{},{method:n,headers:t?{"Content-Type":"multipart/form-data"}:{},url:r,data:i}))}}za.prototype[n]=e(),za.prototype[n+"Form"]=e(!0)});const fa=za;class Vh{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(i){t=i});const r=this;this.promise.then(i=>{if(!r._listeners)return;let o=r._listeners.length;for(;o-- >0;)r._listeners[o](i);r._listeners=null}),this.promise.then=i=>{let o;const s=new Promise(a=>{r.subscribe(a),o=a}).then(i);return s.cancel=function(){r.unsubscribe(o)},s},e(function(i,o,s){r.reason||(r.reason=new bs(i,o,s),t(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}static source(){let e;return{token:new Vh(function(t){e=t}),cancel:e}}}const Gx=Vh;function Xx(n){return function(e){return n.apply(null,e)}}function Zx(n){return Z.isObject(n)&&n.isAxiosError===!0}const ku={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(ku).forEach(([n,e])=>{ku[e]=n});const Qx=ku;function Hg(n){const e=new fa(n),t=Tg(fa.prototype.request,e);return Z.extend(t,fa.prototype,e,{allOwnKeys:!0}),Z.extend(t,e,null,{allOwnKeys:!0}),t.create=function(r){return Hg(io(n,r))},t}const kt=Hg(Mh);kt.Axios=fa;kt.CanceledError=bs;kt.CancelToken=Gx;kt.isCancel=Kg;kt.VERSION=zg;kt.toFormData=fc;kt.AxiosError=Ve;kt.Cancel=kt.CanceledError;kt.all=function(n){return Promise.all(n)};kt.spread=Xx;kt.isAxiosError=Zx;kt.mergeConfig=io;kt.AxiosHeaders=xr;kt.formToJSON=n=>Vg(Z.isHTMLForm(n)?new FormData(n):n);kt.HttpStatusCode=Qx;kt.default=kt;const eE=kt,op={init:({API_KEY:n})=>(...e)=>V(void 0,[...e],function*(t="post",r="/",i={},o={}){var s,a,c,l;const u=localStorage.getItem("accessToken");let h={Accept:"application/json","Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Key":n,"Access-Control-Allow-Methods":"POST, GET, OPTIONS, PUT, DELETE, HEAD,PATCH","Access-Control-Allow-Headers":"X-PINGOTHER, Origin, X-Requested-With, Content-Type, Accept","Access-Control-Max-Age":"1728000"};u&&(h.Authorization="Bearer "+u);const y=r;typeof(i==null?void 0:i.get)=="function"&&(i==null?void 0:i.get("file"))&&(h["Content-Type"]="multipart/form-data"),o!=null&&o.headers&&(h=Object.assign(...h,...o.headers),delete o.headers);const d=Object.assign({mode:"cors",method:t,url:y,data:i,headers:h},o);let f={};try{const g=yield eE(d);f.data=((s=g==null?void 0:g.data)==null?void 0:s.data)||(g==null?void 0:g.data),f.data||(f.data={})}catch(g){f.error=((c=(a=g.response)==null?void 0:a.data)==null?void 0:c.error)||((l=g.response)==null?void 0:l.error),f.error||(f.error={})}return f})};let Ms;const tE=new Uint8Array(16);function nE(){if(!Ms&&(Ms=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Ms))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ms(tE)}const Dt=[];for(let n=0;n<256;++n)Dt.push((n+256).toString(16).slice(1));function rE(n,e=0){return(Dt[n[e+0]]+Dt[n[e+1]]+Dt[n[e+2]]+Dt[n[e+3]]+"-"+Dt[n[e+4]]+Dt[n[e+5]]+"-"+Dt[n[e+6]]+Dt[n[e+7]]+"-"+Dt[n[e+8]]+Dt[n[e+9]]+"-"+Dt[n[e+10]]+Dt[n[e+11]]+Dt[n[e+12]]+Dt[n[e+13]]+Dt[n[e+14]]+Dt[n[e+15]]).toLowerCase()}const iE=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),sp={randomUUID:iE};function gl(n,e,t){if(sp.randomUUID&&!e&&!n)return sp.randomUUID();n=n||{};const r=n.random||(n.rng||nE)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let i=0;i<16;++i)e[t+i]=r[i];return e}return rE(r)}var Jg={exports:{}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function i(c,l,u){this.fn=c,this.context=l,this.once=u||!1}function o(c,l,u,h,y){if(typeof u!="function")throw new TypeError("The listener must be a function");var d=new i(u,h||c,y),f=t?t+l:l;return c._events[f]?c._events[f].fn?c._events[f]=[c._events[f],d]:c._events[f].push(d):(c._events[f]=d,c._eventsCount++),c}function s(c,l){--c._eventsCount===0?c._events=new r:delete c._events[l]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var c=[],l,u;if(this._eventsCount===0)return c;for(u in l=this._events)e.call(l,u)&&c.push(t?u.slice(1):u);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(l)):c},a.prototype.listeners=function(c){var l=t?t+c:c,u=this._events[l];if(!u)return[];if(u.fn)return[u.fn];for(var h=0,y=u.length,d=new Array(y);h<y;h++)d[h]=u[h].fn;return d},a.prototype.listenerCount=function(c){var l=t?t+c:c,u=this._events[l];return u?u.fn?1:u.length:0},a.prototype.emit=function(c,l,u,h,y,d){var f=t?t+c:c;if(!this._events[f])return!1;var g=this._events[f],_=arguments.length,A,P;if(g.fn){switch(g.once&&this.removeListener(c,g.fn,void 0,!0),_){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,l),!0;case 3:return g.fn.call(g.context,l,u),!0;case 4:return g.fn.call(g.context,l,u,h),!0;case 5:return g.fn.call(g.context,l,u,h,y),!0;case 6:return g.fn.call(g.context,l,u,h,y,d),!0}for(P=1,A=new Array(_-1);P<_;P++)A[P-1]=arguments[P];g.fn.apply(g.context,A)}else{var B=g.length,C;for(P=0;P<B;P++)switch(g[P].once&&this.removeListener(c,g[P].fn,void 0,!0),_){case 1:g[P].fn.call(g[P].context);break;case 2:g[P].fn.call(g[P].context,l);break;case 3:g[P].fn.call(g[P].context,l,u);break;case 4:g[P].fn.call(g[P].context,l,u,h);break;default:if(!A)for(C=1,A=new Array(_-1);C<_;C++)A[C-1]=arguments[C];g[P].fn.apply(g[P].context,A)}}return!0},a.prototype.on=function(c,l,u){return o(this,c,l,u,!1)},a.prototype.once=function(c,l,u){return o(this,c,l,u,!0)},a.prototype.removeListener=function(c,l,u,h){var y=t?t+c:c;if(!this._events[y])return this;if(!l)return s(this,y),this;var d=this._events[y];if(d.fn)d.fn===l&&(!h||d.once)&&(!u||d.context===u)&&s(this,y);else{for(var f=0,g=[],_=d.length;f<_;f++)(d[f].fn!==l||h&&!d[f].once||u&&d[f].context!==u)&&g.push(d[f]);g.length?this._events[y]=g.length===1?g[0]:g:s(this,y)}return this},a.prototype.removeAllListeners=function(c){var l;return c?(l=t?t+c:c,this._events[l]&&s(this,l)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,n.exports=a})(Jg);const oE=Jg.exports;function ml(n,e){try{n(e)}catch(t){console.error("Error in subscription callback",t)}}const Mr=Symbol("subscriptions"),Fr=Symbol("oneTimeEvents");class oo{constructor(){this[Mr]=[],this[Fr]=new Map}on(e,t){return this[Fr].has(e)?ml(t,this[Fr].get(e)):(this[Mr].push({event:e,callback:t,once:!1}),this)}off(e,t){return this[Mr]=this[Mr].filter(r=>r.event!==e||t&&r.callback!==t),this}once(e,t){return new Promise(r=>{const i=o=>{r(o),t==null||t(o)};this[Fr].has(e)?ml(i,this[Fr].get(e)):this[Mr].push({event:e,callback:i,once:!0})})}emit(e,t){if(this[Fr].has(e))throw new Error(`Event "${e}" was supposed to be emitted only once`);for(let r=0;r<this[Mr].length;r++){const i=this[Mr][r];i.event===e&&(ml(i.callback,t),i.once&&(this[Mr].splice(r,1),r--))}return this}emitOnce(e,t){if(this[Fr].has(e))throw new Error(`Event "${e}" was supposed to be emitted only once`);return this.emit(e,t),this[Fr].set(e,t),this.off(e),this}pipe(e,t){this.on(e,r=>{t.emit(e,r)})}pipeOnce(e,t){this.once(e,r=>{t.emitOnce(e,r)})}}function Vr(n){return n=n.replace(/\[/g,"/[").replace(/^\/+/,"").replace(/\/+$/,""),n.length===0?[]:n.split("/").map(e=>e.startsWith("[")?parseInt(e.slice(1,-1)):e)}class J{static get(e){return new J(e)}static getChildPath(e,t){return J.get(e).child(t).path}static getPathKeys(e){return Vr(e)}constructor(e){typeof e=="string"?this.keys=Vr(e):e instanceof Array&&(this.keys=e),this.path=this.keys.reduce((t,r,i)=>i===0?`${r}`:typeof r=="string"?`${t}/${r}`:`${t}[${r}]`,"")}get key(){return this.keys.length===0?null:this.keys.slice(-1)[0]}get parent(){if(this.keys.length==0)return null;const e=this.keys.slice(0,-1);return new J(e)}get parentPath(){return this.keys.length===0?null:this.parent.path}child(e){if(typeof e=="string"){if(e.length===0)throw new Error(`child key for path "${this.path}" cannot be empty`);const t=Vr(e);t.forEach(r=>{if(typeof r=="string"){if(/[\x00-\x08\x0b\x0c\x0e-\x1f/[\]\\]/.test(r))throw new Error(`Invalid child key "${r}" for path "${this.path}". Keys cannot contain control characters or any of the following characters: \\ / [ ]`);if(r.length>128)throw new Error(`child key "${r}" for path "${this.path}" is too long. Max key length is 128`);if(r.length===0)throw new Error(`child key for path "${this.path}" cannot be empty`)}}),e=t}return new J(this.keys.concat(e))}childPath(e){return this.child(e).path}get pathKeys(){return this.keys}static extractVariables(e,t){if(!e.includes("*")&&!e.includes("$"))return[];const r=Vr(e),i=Vr(t);let o=0;const s={get length(){return o}};return r.forEach((a,c)=>{const l=i[c];if(a==="*")s[o++]=l;else if(typeof a=="string"&&a[0]==="$"){s[o++]=l,s[a]=l;const u=a.slice(1);typeof s[u]=="undefined"&&(s[u]=l)}}),s}static fillVariables(e,t){if(e.indexOf("*")<0&&e.indexOf("$")<0)return e;const r=Vr(e),i=Vr(t),o=r.map((a,c)=>{if(a===i[c]||c>=i.length)return a;if(typeof a=="string"&&(a==="*"||a[0]==="$"))return i[c];throw new Error(`Path "${t}" cannot be used to fill variables of path "${e}" because they do not match`)});let s="";return o.forEach(a=>{typeof a=="number"?s+=`[${a}]`:(s.length>0&&(s+="/"),s+=a)}),s}static fillVariables2(e,t){if(typeof t!="object"||Object.keys(t).length===0)return e;const r=Vr(e);let i=0;return r.reduce((o,s)=>typeof s=="string"&&(s==="*"||s.startsWith("$"))?J.getChildPath(o,t[i++]):J.getChildPath(o,s),"")}equals(e){const t=e instanceof J?e:new J(e);return this.path===t.path?!0:this.keys.length!==t.keys.length?!1:this.keys.every((r,i)=>{const o=t.keys[i];return o===r||typeof o=="string"&&(o==="*"||o[0]==="$")||typeof r=="string"&&(r==="*"||r[0]==="$")})}isAncestorOf(e){const t=e instanceof J?e:new J(e);return t.path===""||this.path===t.path?!1:this.path===""?!0:this.keys.length>=t.keys.length?!1:this.keys.every((r,i)=>{const o=t.keys[i];return o===r||typeof o=="string"&&(o==="*"||o[0]==="$")||typeof r=="string"&&(r==="*"||r[0]==="$")})}isDescendantOf(e){const t=e instanceof J?e:new J(e);return this.path===""||this.path===t.path?!1:e===""?!0:t.keys.length>=this.keys.length?!1:t.keys.every((r,i)=>{const o=this.keys[i];return o===r||typeof o=="string"&&(o==="*"||o[0]==="$")||typeof r=="string"&&(r==="*"||r[0]==="$")})}isOnTrailOf(e){const t=e instanceof J?e:new J(e);return this.path.length===0||t.path.length===0||this.path===t.path?!0:this.pathKeys.every((r,i)=>{if(i>=t.keys.length)return!0;const o=t.keys[i];return o===r||typeof o=="string"&&(o==="*"||o[0]==="$")||typeof r=="string"&&(r==="*"||r[0]==="$")})}isChildOf(e){const t=e instanceof J?e:new J(e);return this.path===""?!1:this.parent.equals(t)}isParentOf(e){const t=e instanceof J?e:new J(e);return t.path===""?!1:this.equals(t.parent)}}function vl(n,e,t=!1){if(!n.exists())return null;let r=t?n.previous():n.val();return typeof e=="number"?r[e]:(J.getPathKeys(e).every(i=>(r=r[i],typeof r!="undefined")),r||null)}function bl(n){if(!n.exists())return[];const e=n.val();return e instanceof Array?new Array(e.length).map((t,r)=>r):typeof e=="object"?Object.keys(e):[]}class nt{exists(){return!1}constructor(e,t,r=!1,i,o){this.ref=e,this.val=()=>t,this.previous=()=>i,this.exists=()=>r?!1:t!==null&&typeof t!="undefined",this.context=()=>o||{}}static for(e,t){return new nt(e,t)}child(e){const t=vl(this,e,!1),r=vl(this,e,!0);return new nt(this.ref.child(e),t,!1,r)}hasChild(e){return vl(this,e)!==null}hasChildren(){return bl(this).length>0}numChildren(){return bl(this).length}forEach(e){const t=this.val(),r=this.previous();return bl(this).every(i=>{const o=new nt(this.ref.child(i),t[i],!1,r[i]);return e(o)})}get key(){return this.ref.key}}class pa extends nt{constructor(e,t,r){super(e,t,!1,void 0,r),this.previous=()=>{throw new Error("Iterate values to get previous values for each mutation")},this.val=(i=!0)=>(i&&console.warn("Unless you know what you are doing, it is best not to use the value of a mutations snapshot directly. Use child methods and forEach to iterate the mutations instead"),t)}forEach(e){return this.val(!1).every(t=>{const r=t.target.reduce((o,s)=>o.child(s),this.ref),i=new nt(r,t.val,!1,t.prev);return e(i)})}child(e){if(typeof e!="number")throw new Error("child index must be a number");const t=this.val(!1)[e],r=t.target.reduce((i,o)=>i.child(o),this.ref);return new nt(r,t.val,!1,t.prev)}}class Yg{constructor(e){this.stop=e,this._internal={state:"init",activatePromises:[]}}activated(e){return e&&(this._internal.activatePromises.push({callback:e}),this._internal.state==="active"?e(!0):this._internal.state==="canceled"&&e(!1,this._internal.cancelReason)),new Promise((t,r)=>{if(this._internal.state==="active")return t();if(this._internal.state==="canceled"&&!e)return r(new Error(this._internal.cancelReason));const i=()=>{};this._internal.activatePromises.push({resolve:t,reject:e?i:r})})}_setActivationState(e,t){for(this._internal.cancelReason=t,this._internal.state=e?"active":"canceled";this._internal.activatePromises.length>0;){const r=this._internal.activatePromises.shift();e?(r.callback&&r.callback(!0),r.resolve&&r.resolve()):(r.callback&&r.callback(!1,t),r.reject&&r.reject(t))}}}class sE{constructor(e,t,r){this.publish=e,this.start=t,this.cancel=r}}class aE{constructor(e){const t=[];let r,i;const o="stopped (no more subscribers)";this.subscribe=(h,y)=>{if(typeof h!="function")throw new TypeError("callback must be a function");if(i===o)throw new Error("stream can't be used anymore because all subscribers were stopped");const d={callback:h,activationCallback:function(f,g){y==null||y(f,g),this.subscription._setActivationState(f,g)},subscription:new Yg(function(){return t.splice(t.indexOf(this),1),s()})};return t.push(d),typeof i!="undefined"&&(i===!0?(y==null||y(!0),d.subscription._setActivationState(!0)):typeof i=="string"&&(y==null||y(!1,i),d.subscription._setActivationState(!1,i))),d.subscription};const s=()=>{let h;return t.length===0&&(h=r==null?void 0:r(),i=o),Promise.resolve(h)};this.unsubscribe=h=>{(h?t.filter(y=>y.callback===h):t).forEach(y=>{const d=t.indexOf(y);t.splice(d,1)}),s()},this.stop=()=>{t.splice(0),s()};const a=h=>(t.forEach(y=>{try{y.callback(h)}catch(d){console.error(`Error running subscriber callback: ${d.message}`)}}),t.length===0&&s(),t.length>0),c=h=>{i=!0,r=h,t.forEach(y=>{var d;(d=y.activationCallback)==null||d.call(y,!0)})},l=h=>{i=h,t.forEach(y=>{var d;(d=y.activationCallback)==null||d.call(y,!1,h||new Error("unknown reason"))}),t.splice(0)},u=new sE(a,c,l);e(u)}}function Kh(n,e){const t="000000000"+n;return t.substr(t.length-e)}const cE=typeof window=="object"?window:self,lE=Object.keys(cE).length;var ap,cp;const uE=(cp=(ap=navigator.mimeTypes)==null?void 0:ap.length)!=null?cp:0,hE=Kh((uE+navigator.userAgent.length).toString(36)+lE.toString(36),4);function dE(){return hE}let Ao=0;const Wh=4,Ha=36,Gg=Math.pow(Ha,Wh);function lp(){return Kh((Math.random()*Gg<<0).toString(Ha),Wh)}function fE(){return Ao=Ao<Gg?Ao:0,Ao++,Ao-1}function pE(n=0){const e="c",t=(new Date().getTime()+n).toString(Ha),r=Kh(fE().toString(Ha),Wh),i=dE(),o=lp()+lp();return e+t+r+i+o}let up=0;class Ft{static set timeBias(e){typeof e=="number"&&(up=e)}static generate(){return pE(up).slice(1)}}class rt{constructor(e){this.path=e}}const An={nextTick(n){setTimeout(n,0)}};class Ja{constructor(e){if(e instanceof Array)for(let t=0;t<e.length;t++)typeof e[t]!="undefined"&&(this[t]=e[t]);else e&&Object.assign(this,e)}}function yE(n){const e=new Uint8Array(8);return new DataView(e.buffer).setFloat64(0,n),new Array(...e)}function gE(n){if((Array.isArray(n)?n.length:n.byteLength)!==8)throw new TypeError("must be 8 bytes");const e=new Uint8Array(n);return new DataView(e.buffer).getFloat64(0)}const ei={zero:BigInt(0),one:BigInt(1),two:BigInt(2),eight:BigInt(8),ff:BigInt(255)};function mE(n){if(typeof n!="bigint")throw new Error("number must be a bigint");const e=[],t=n<ei.zero;do{const r=Number(n&ei.ff);e.push(r),n=n>>ei.eight}while(n!==(t?-ei.one:ei.zero));return e.reverse(),(t?e[0]<128:e[0]>=128)&&e.unshift(t?255:0),e}function vE(n){const e=n[0]>=128;let t=ei.zero;for(let r of n)e&&(r=~r&255),t=(t<<ei.eight)+BigInt(r);return e&&(t=-(t+ei.one)),t}function bE(n){if(typeof TextEncoder!="undefined")return new TextEncoder().encode(n);if(typeof Buffer=="function"){const e=Buffer.from(n,"utf-8");return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}else{const e=[];for(let t=0;t<n.length;t++){let r=n.charCodeAt(t);if(r>128){if((r&55296)===55296){const i=n.charCodeAt(t+1);if((i&56320)!==56320)throw new Error("follow-up utf-16 character does not start with 0xDC00");t++;const o=r&1023,s=i&1023;r=65536|o<<10|s}if(r<2048){const i=192|r>>6&31,o=128|r&63;e.push(i,o)}else if(r<65536){const i=224|r>>12&15,o=128|r>>6&63,s=128|r&63;e.push(i,o,s)}else if(r<2097152){const i=240|r>>18&7,o=128|r>>12&63,s=128|r>>6&63,a=128|r&63;e.push(i,o,s,a)}else throw new Error(`Cannot convert character ${n.charAt(t)} (code ${r}) to utf-8`)}else e.push(r<128?r:63)}return new Uint8Array(e)}}function Xg(n){if(typeof TextDecoder!="undefined"){const e=new TextDecoder;if(n instanceof Uint8Array)return e.decode(n);const t=Uint8Array.from(n);return e.decode(t)}else if(typeof Buffer=="function"){if(n instanceof Array&&(n=Uint8Array.from(n)),!(n instanceof Buffer)&&"buffer"in n&&n.buffer instanceof ArrayBuffer){const e=n;n=Buffer.from(e.buffer,e.byteOffset,e.byteLength)}if(!(n instanceof Buffer))throw new Error("Unsupported buffer argument");return n.toString("utf-8")}else{if(!(n instanceof Uint8Array)&&"buffer"in n&&n.buffer instanceof ArrayBuffer){const e=n;n=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}if(n instanceof Buffer||n instanceof Array||n instanceof Uint8Array){let e="";for(let t=0;t<n.length;t++){let r=n[t];if(r>128)if((r&240)===240){const i=r,o=n[t+1],s=n[t+2],a=n[t+3];r=(i&7)<<18|(o&63)<<12|(s&63)<<6|a&63,t+=3}else if((r&224)===224){const i=r,o=n[t+1],s=n[t+2];r=(i&15)<<12|(o&63)<<6|s&63,t+=2}else if((r&192)===192){const i=r,o=n[t+1];r=(i&31)<<6|o&63,t++}else throw new Error("invalid utf-8 data");if(r>=65536){r^=65536;const i=55296|r>>10,o=56320|r&1023;e+=String.fromCharCode(i),e+=String.fromCharCode(o)}else e+=String.fromCharCode(r)}return e}else throw new Error("Unsupported buffer argument")}}function wE(n,e){const t=new n.constructor(n.length+e.length);return t.set(n),t.set(e,n.length),t}function Kn(n,e){var t;if(((t=n==null?void 0:n.constructor)==null?void 0:t.name)==="DataSnapshot")throw new TypeError(`Object to clone is a DataSnapshot (path "${n.ref.path}")`);const r=s=>(s!==null&&typeof s=="object"&&typeof s.constructor=="function"&&typeof s.constructor.name=="string"&&["Buffer","Uint8Array","Int8Array","Uint16Array","Int16Array","Uint32Array","Int32Array","BigUint64Array","BigInt64Array"].includes(s.constructor.name)&&(s=s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)),s);if(n=r(n),typeof n!="object"||n===null||n instanceof Date||n instanceof ArrayBuffer||n instanceof rt||n instanceof RegExp)return n;const i=s=>{if(e.indexOf(s)>=0)throw new ReferenceError("object contains a circular reference");return s=r(s),s===null||s instanceof Date||s instanceof ArrayBuffer||s instanceof rt||s instanceof RegExp||typeof s=="object"&&(e.push(s),s=Kn(s,e),e.pop()),s};typeof e=="undefined"&&(e=[n]);const o=n instanceof Array?[]:n instanceof Ja?new Ja:{};return Object.keys(n).forEach(s=>{const a=n[s];typeof a!="function"&&(o[s]=i(a))}),o}const oi=n=>typeof n=="object"&&["ArrayBuffer","Buffer","Uint8Array","Uint16Array","Uint32Array","Int8Array","Int16Array","Int32Array"].includes(n.constructor.name);function Ya(n,e){if(n===e)return!0;if(typeof n!=typeof e)return!1;if(typeof n=="object"||typeof e=="object"){if(n===null||e===null)return!1;if(n instanceof rt||e instanceof rt)return n instanceof rt&&e instanceof rt&&n.path===e.path;if(n instanceof Date||e instanceof Date)return n instanceof Date&&e instanceof Date&&n.getTime()===e.getTime();if(n instanceof Array||e instanceof Array)return n instanceof Array&&e instanceof Array&&n.length===e.length&&n.every((i,o)=>Ya(n[o],e[o]));if(oi(n)||oi(e)){if(!oi(n)||!oi(e)||n.byteLength===e.byteLength)return!1;const i=n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength),o=e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength);return i.every((s,a)=>o[a]===s)}const t=Object.keys(n),r=Object.keys(e);return t.length===r.length&&t.every(i=>r.includes(i))&&t.every(i=>Ya(n[i],e[i]))}return!1}class Zg{constructor(e,t,r){this.added=e,this.removed=t,this.changed=r}forChild(e){if(this.added.includes(e))return"added";if(this.removed.includes(e))return"removed";const t=this.changed.find(r=>r.key===e);return t?t.change:"identical"}}function zh(n,e,t=!1){const r=[void 0,null];if(n===e)return"identical";if(r.indexOf(n)>=0&&r.indexOf(e)<0)return"added";if(r.indexOf(n)<0&&r.indexOf(e)>=0)return"removed";if(typeof n!=typeof e)return"changed";if(oi(n)||oi(e)){if(!oi(n)||!oi(e))return"changed";const i=n instanceof Uint8Array?n:n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength),o=e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength);return i.byteLength===o.byteLength&&i.every((s,a)=>o[a]===s)?"identical":"changed"}else{if(n instanceof Date||e instanceof Date)return n instanceof Date&&e instanceof Date&&n.getTime()===e.getTime()?"identical":"changed";if(n instanceof rt||e instanceof rt)return n instanceof rt&&e instanceof rt&&n.path===e.path?"identical":"changed";if(typeof n=="object"){const i=n instanceof Array,o=h=>{let y=Object.keys(h).filter(d=>!r.includes(h[d]));return i&&(y=y.map(d=>parseInt(d))),y},s=o(n),a=o(e),c=s.filter(h=>!a.includes(h)),l=a.filter(h=>!s.includes(h)),u=a.reduce((h,y)=>{if(s.includes(y)){const d=n[y],f=e[y],g=zh(d,f);g!=="identical"&&h.push({key:y,change:g})}return h},[]);return l.length===0&&c.length===0&&u.length===0?"identical":new Zg(l,c,t?u.sort((h,y)=>h.key<y.key?-1:1):u)}}return"changed"}function Qg(n,e,t=!1){const r=(o,s,a,c)=>{switch(s){case"identical":return[];case"changed":return[{target:o,prev:a,val:c}];case"added":return[{target:o,prev:null,val:c}];case"removed":return[{target:o,prev:a,val:null}];default:{let l=[];return s.added.forEach(u=>l.push({target:o.concat(u),prev:null,val:c[u]})),s.removed.forEach(u=>l.push({target:o.concat(u),prev:a[u],val:null})),s.changed.forEach(u=>{const h=r(o.concat(u.key),u.change,a[u.key],c[u.key]);l=l.concat(h)}),l}}},i=zh(n,e,t);return r([],i,n,e)}function kE(n,e,t){return e=e===null?null:e[n],typeof e=="undefined"&&(e=null),t=t===null?null:t[n],typeof t=="undefined"&&(t=null),{oldValue:e,newValue:t}}function xE(n){An.nextTick(n)}function em(){var n;return typeof globalThis!="undefined"?globalThis:typeof global!="undefined"?global:typeof window!="undefined"?window:typeof self!="undefined"?self:(n=function(){return this}())!=null?n:Function("return this")()}const tm=Object.freeze(Object.defineProperty({__proto__:null,numberToBytes:yE,bytesToNumber:gE,bigintToBytes:mE,bytesToBigint:vE,encodeString:bE,decodeString:Xg,concatTypedArrays:wE,cloneObject:Kn,valuesAreEqual:Ya,ObjectDifferences:Zg,compareValues:zh,getMutations:Qg,getChildValues:kE,defer:xE,getGlobalObject:em},Symbol.toStringTag,{value:"Module"})),EE="modulepreload",_E=function(n){return"/"+n},hp={},$E=function(n,e,t){if(!e||e.length===0)return n();const r=document.getElementsByTagName("link");return Promise.all(e.map(i=>{if(i=_E(i),i in hp)return;hp[i]=!0;const o=i.endsWith(".css"),s=o?'[rel="stylesheet"]':"";if(t)for(let c=r.length-1;c>=0;c--){const l=r[c];if(l.href===i&&(!o||l.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${s}`))return;const a=document.createElement("link");if(a.rel=o?"stylesheet":EE,o||(a.as="script",a.crossOrigin=""),a.href=i,document.head.appendChild(a),o)return new Promise((c,l)=>{a.addEventListener("load",c),a.addEventListener("error",()=>l(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>n())};let nm=!1,ci;V(void 0,null,function*(){const n=em();if(typeof n.Observable!="undefined"){ci=n.Observable;return}try{const{Observable:e}=yield $E(()=>Promise.resolve().then(()=>EA),void 0);ci=e}catch(e){ci=Jh}});function Hh(){if(ci===Jh&&!nm&&console.warn(`Using AceBase's simple Observable implementation because rxjs is not available. Add it to your project with "npm install rxjs", add it to AceBase using db.setObservable(Observable), or call db.setObservable("shim") to suppress this warning`),ci)return ci;throw new Error("RxJS Observable could not be loaded. ")}function OE(n){n==="shim"?(ci=Jh,nm=!0):ci=n}class Jh{constructor(e){this._active=!1,this._subscribers=[],this._create=e}subscribe(e){if(!this._active){const t={next:r=>{this._subscribers.forEach(i=>{try{i(r)}catch(o){console.error("Error in subscriber callback:",o)}})}};this._cleanup=this._create(t),this._active=!0}return this._subscribers.push(e),{unsubscribe:()=>{this._subscribers.splice(this._subscribers.indexOf(e),1),this._subscribers.length===0&&(this._active=!1,this._cleanup())}}}}class gn extends Array{static areEqual(e,t){return e.length===t.length&&e.every((r,i)=>t[i]===r)}static isAncestor(e,t){return e.length<t.length&&e.every((r,i)=>t[i]===r)}static isDescendant(e,t){return e.length>t.length&&t.every((r,i)=>e[i]===r)}}const ki=Symbol("isProxy");class AE{static create(e,t){return V(this,null,function*(){var r;e=new Hn(e.db,e.path);let i,o=!1,s=t==null?void 0:t.cursor,a;const c=Ft.generate(),l=[],u=new oo;u.on("cursor",p=>s=p),u.on("error",p=>{console.error(p.message,p.details)});const h=(p,v)=>{if(p.length===0)return i=v,!0;let m=i;const w=p.slice();for(;w.length>1;){const b=w.shift();if(!(b in m))return!1;m=m[b]}const E=w.shift();return v===null?m instanceof Array?m.splice(E,1):delete m[E]:m[E]=v,!0},y=()=>V(this,null,function*(){!o||(yield O())}),d=e.on("mutations",{syncFallback:y}).subscribe(p=>V(this,null,function*(){var v;if(!o)return;const m=p.context(),w=((v=m.acebase_proxy)==null?void 0:v.id)!==c;!w||(p.val(!1).every(E=>{if(!h(E.target,E.val))return!1;const b=E.target.reduce((x,$)=>x.child($),e),k=new nt(b,E.val,!1,E.prev,p.context());return u.emit("mutation",{snapshot:k,isRemote:w}),!0})?(u.emit("cursor",m.acebase_cursor),j.emit("mutations",{origin:"remote",snap:p})):(console.warn(`Cached value of live data proxy on "${e.path}" appears outdated, will be reloaded`),yield O()))}));let f=Promise.resolve();const g=[],_=[],A=()=>V(this,null,function*(){const p=[];for(let v=0,m=g[0];v<g.length;v++,m=g[v])_.find(w=>gn.areEqual(w.target,m.target)||gn.isAncestor(w.target,m.target))||(g.splice(v,1),v--,p.push(m));p.length!==0&&(p.forEach(v=>{v.value=Kn(En(i,v.target))}),An.nextTick(()=>{const v={acebase_proxy:{id:c,source:"update"}};p.forEach(w=>{const E=w.target.reduce((k,x)=>k.child(x),e),b=new nt(E,w.value,!1,w.previous,v);u.emit("mutation",{snapshot:b,isRemote:!1})});const m=new pa(e,p.map(w=>({target:w.target,val:w.value,prev:w.previous})),v);j.emit("mutations",{origin:"local",snap:m})}),f=p.reduce((v,m,w,E)=>(E.some(b=>gn.isAncestor(b.target,m.target))||v.push(m),v),[]).reduce((v,m)=>{const w=m.target;if(w.length===0)v.push({ref:e,target:w,value:i,type:"set",previous:m.previous});else{const E=w.slice(0,-1),b=w.slice(-1)[0],k=E.reduce((T,R)=>T.child(R),e),x=v.find(T=>T.ref.path===k.path),$=En(i,w),S=m.previous;x?(x.value[b]=$,x.previous[b]=S):v.push({ref:k,target:E,value:{[b]:$},type:"update",previous:{[b]:S}})}return v},[]).reduce((v,m)=>V(this,null,function*(){const w={acebase_proxy:{id:c,source:m.type}};yield v,yield m.ref.context(w)[m.type](m.value).catch(E=>{u.emit("error",{source:"update",message:`Error processing update of "/${e.path}"`,details:E});const b={acebase_proxy:{id:c,source:"update-rollback"}},k=[];if(m.type==="set"){wl(i,m.target,m.previous);const $=new nt(m.ref,m.previous,!1,m.value,b);u.emit("mutation",{snapshot:$,isRemote:!1}),k.push({target:m.target,val:m.previous,prev:m.value})}else Object.keys(m.previous).forEach($=>{wl(i,m.target.concat($),m.previous[$]);const S=new nt(m.ref.child($),m.previous[$],!1,m.value[$],b);u.emit("mutation",{snapshot:S,isRemote:!1}),k.push({target:m.target.concat($),val:m.previous[$],prev:m.value[$]})});k.forEach($=>{const S=$.target.reduce((R,N)=>R.child(N),e),T=new nt(S,$.val,!1,$.prev,b);u.emit("mutation",{snapshot:T,isRemote:!1})});const x=new pa(m.ref,k,b);j.emit("mutations",{origin:"local",snap:x})}),m.ref.cursor&&u.emit("cursor",m.ref.cursor)}),f),yield f)});let P=!1;const B=[],C=()=>{let p;const v=new Promise(m=>p=m);return B.push({resolve:p}),v};let L=null;const q=()=>{L||(L=setTimeout(()=>V(this,null,function*(){P=!0,L=null,yield A(),P=!1,B.splice(0).forEach(p=>p.resolve())}),0))},H=p=>{g.find(v=>gn.areEqual(v.target,p))||g.push({target:p,previous:Kn(En(i,p))}),q()},j=new oo,I=(p,v)=>{const m=b=>b!==null&&typeof b=="object",w=b=>V(this,null,function*(){var k;const{snap:x,origin:$}=b,S=x.context(),T=((k=S.acebase_proxy)==null?void 0:k.id)===c;if(b.origin==="remote"&&T){console.error("DEV ISSUE: mutationsHandler was called from remote event originating from our own proxy");return}const R=x.val(!1).filter(ne=>ne.target.slice(0,p.length).every((te,pe)=>p[pe]===te));if(R.length===0)return;let N,z;const F=R.find(ne=>ne.target.length<=p.length);if(F){const ne=p.slice(F.target.length);N=ne.reduce((te,pe)=>!m(te)||!(pe in te)?null:te[pe],F.val),z=ne.reduce((te,pe)=>!m(te)||!(pe in te)?null:te[pe],F.prev)}else{const ne=En(i,p);N=Kn(ne),z=Kn(N),R.forEach(te=>{const pe=te.target.slice(p.length);for(let oe=0,re=N,ue=z;oe<pe.length;oe++){const Ne=oe+1===pe.length,ye=pe[oe];Ne?(re[ye]=te.val,re[ye]===null&&delete re[ye],ue[ye]=te.prev,ue[ye]===null&&delete ue[ye]):(re=re[ye]=ye in re?re[ye]:{},ue=ue[ye]=ye in ue?ue[ye]:{})}})}An.nextTick(()=>{let ne=!0;try{ne=v(Object.freeze(N),Object.freeze(z),!T,S)!==!1}catch(te){u.emit("error",{source:$==="remote"?"remote_update":"local_update",message:"Error running subscription callback",details:te})}ne===!1&&E()})});j.on("mutations",w);const E=()=>{j.off("mutations",w),l.splice(l.findIndex(b=>b.stop===E),1)};return l.push({target:p,stop:E}),{stop:E}},D=(p,v,m)=>{if(p==="write")return H(v);if(p==="onChange")return I(v,m.callback);if(p==="subscribe"||p==="observe"){const w=b=>{const k=En(i,v);b.next(k);const x=I(v,$=>{b.next($)});return function(){x.stop()}};if(p==="subscribe")return w;const E=Hh();return new E(w)}else if(p==="transaction")return _.some(w=>gn.areEqual(v,w.target)||gn.isAncestor(v,w.target)||gn.isDescendant(v,w.target))?Promise.reject(new Error("Cannot start transaction because it conflicts with another transaction")):new Promise(w=>V(this,null,function*(){g.some(b=>gn.areEqual(v,b.target)||gn.isAncestor(v,b.target))&&(P||q(),yield C());const E={target:v,status:"started",transaction:null};_.push(E),E.transaction={get status(){return E.status},get completed(){return E.status!=="started"},get mutations(){return g.filter(b=>gn.areEqual(E.target,b.target)||gn.isAncestor(E.target,b.target))},get hasMutations(){return this.mutations.length>0},commit(){return V(this,null,function*(){if(this.completed)throw new Error(`Transaction has completed already (status '${E.status}')`);E.status="finished",_.splice(_.indexOf(E),1),P&&(yield C()),q(),yield C()})},rollback(){if(this.completed)throw new Error(`Transaction has completed already (status '${E.status}')`);E.status="canceled";const b=[];for(let k=0;k<g.length;k++){const x=g[k];(gn.areEqual(E.target,x.target)||gn.isAncestor(E.target,x.target))&&(g.splice(k,1),k--,b.push(x))}b.reverse().forEach(k=>{k.target.length===0?i=k.previous:wl(i,k.target,k.previous)}),_.splice(_.indexOf(E),1)}},w(E.transaction)}))},M=yield e.get({cache_mode:"allow",cache_cursor:t==null?void 0:t.cursor});if(M.context().acebase_origin!=="cache"&&u.emit("cursor",(r=e.cursor)!=null?r:null),o=!0,i=M.val(),i===null&&typeof(t==null?void 0:t.defaultValue)!="undefined"){i=t.defaultValue;const p={acebase_proxy:{id:c,source:"default"}};yield e.context(p).set(i)}a=rm({root:{ref:e,get cache(){return i}},target:[],id:c,flag:D});const U=()=>{if(a===null)throw new Error("Proxy was destroyed")},O=()=>V(this,null,function*(){U(),g.splice(0);const p=yield e.get({allow_cache:!1}),v=i,m=p.val();i=m;const w=Qg(v,m);if(w.length===0)return;const E=p.context();E.acebase_proxy={id:c,source:"reload"},w.forEach(k=>{const x=xu(e,k.target),$=new nt(x,k.val,k.val===null,k.prev,E);u.emit("mutation",{snapshot:$,isRemote:!0})});const b=new pa(e,w,E);j.emit("mutations",{origin:"local",snap:b})});return{destroy(){return V(this,null,function*(){yield f;const p=[d.stop(),...l.map(v=>v.stop())];yield Promise.all(p),["cursor","mutation","error"].forEach(v=>u.off(v)),i=null,a=null})},stop(){this.destroy()},get value(){return U(),a},get hasValue(){return U(),i!==null},set value(p){U(),p!==null&&typeof p=="object"&&p[ki]&&(p=p.valueOf()),H([]),i=p},get ref(){return e},get cursor(){return s},reload:O,onMutation(p){U(),u.off("mutation"),u.on("mutation",({snapshot:v,isRemote:m})=>{try{p(v,m)}catch(w){u.emit("error",{source:"mutation_callback",message:"Error in dataproxy onMutation callback",details:w})}})},onError(p){U(),u.off("error"),u.on("error",v=>{try{p(v)}catch(m){console.error(`Error in dataproxy onError callback: ${m.message}`)}})},on(p,v){u.on(p,v)},off(p,v){u.off(p,v)}}})}}function En(n,e){let t=n;for(const r of e)t=typeof t=="object"&&t!==null&&r in t?t[r]:null;return t}function wl(n,e,t){if(e.length===0)throw new Error("Cannot update root target, caller must do that itself!");const r=e.slice(0,-1).reduce((o,s)=>o[s],n),i=e.slice(-1)[0];t===null||typeof t=="undefined"?r instanceof Array?r.splice(i,1):delete r[i]:r[i]=t}function xu(n,e){const t=J.get(n.path).childPath(e);return new Hn(n.db,t)}function rm(n){const e=xu(n.root.ref,n.target),t=[],r={get(o,s,a){if(o=En(n.root.cache,n.target),typeof s=="symbol")if(s.toString()===Symbol.iterator.toString())s="values";else return s.toString()===ki.toString()?!0:Reflect.get(o,s,a);if(s==="valueOf")return function(){return o};if(o===null||typeof o!="object")throw new Error(`Cannot read property "${s}" of ${o}. Value of path "/${e.path}" is not an object (anymore)`);o instanceof Array&&typeof s=="string"&&/^[0-9]+$/.test(s)&&(s=parseInt(s));const c=o[s];if(c===null){delete o[s];return}const l=t.find(d=>d.prop===s);if(l){if(l.typeof===typeof c)return l.value;t.splice(t.indexOf(l),1)}const u=d=>{const f=o[d],g=t.find(A=>A.prop===d);if(g){if(g.typeof===typeof f)return g.value;t.splice(t.indexOf(g),1)}if(typeof f!="object")return f;const _=rm({root:n.root,target:n.target.concat(d),id:n.id,flag:n.flag});return t.push({typeof:typeof f,prop:d,value:_}),_},h=d=>d!==null&&typeof d=="object"&&d[ki]?d.getTarget():d;if(["string","number","boolean"].includes(typeof c)||c instanceof Date||c instanceof rt||c instanceof ArrayBuffer||typeof c=="object"&&"buffer"in c)return c;const y=o instanceof Array;if(s==="toString")return function(){return`[LiveDataProxy for "${e.path}"]`};if(typeof c=="undefined")return s==="push"?function(d){const f=e.push();return n.flag("write",n.target.concat(f.key)),o[f.key]=d,f.key}:s==="getTarget"?function(d=!0){return d&&console.warn("Use getTarget with caution - any changes will not be synchronized!"),o}:s==="getRef"?function(){return xu(n.root.ref,n.target)}:s==="forEach"?function(d){const f=Object.keys(o);let g=!1;for(let _=0;!g&&_<f.length;_++){const A=f[_],P=u(A);g=d(P,A,_)===!1}}:["values","entries","keys"].includes(s)?function*(){const d=Object.keys(o);for(const f of d)if(s==="keys")yield f;else{const g=u(f);s==="entries"?yield[f,g]:yield g}}:s==="toArray"?function(d){const f=Object.keys(o).map(g=>u(g));return d&&f.sort(d),f}:s==="onChanged"?function(d){return n.flag("onChange",n.target,{callback:d})}:s==="subscribe"?function(){return n.flag("subscribe",n.target)}:s==="getObservable"?function(){return n.flag("observe",n.target)}:s==="getOrderedCollection"?function(d,f){return new SE(this,d,f)}:s==="startTransaction"?function(){return n.flag("transaction",n.target)}:s==="remove"&&!y?function(){if(n.target.length===0)throw new Error("Can't remove proxy root value");const d=En(n.root.cache,n.target.slice(0,-1)),f=n.target.slice(-1)[0];n.flag("write",n.target),delete d[f]}:void 0;if(typeof c=="function"){if(y){const d=g=>(n.flag("write",n.target),g()),f=g=>g.map(_=>(_=h(_),Eu(_),_));if(s==="push")return function(...g){return g=f(g),d(()=>o.push(...g))};if(s==="pop")return function(){return d(()=>o.pop())};if(s==="splice")return function(g,_,...A){return A=f(A),d(()=>o.splice(g,_,...A))};if(s==="shift")return function(){return d(()=>o.shift())};if(s==="unshift")return function(...g){return g=f(g),d(()=>o.unshift(...g))};if(s==="sort")return function(g){return d(()=>o.sort(g))};if(s==="reverse")return function(){return d(()=>o.reverse())};if(["indexOf","lastIndexOf"].includes(s))return function(g,_){return g!==null&&typeof g=="object"&&g[ki]&&(g=g.getTarget(!1)),o[s](g,_)};if(["forEach","every","some","filter","map"].includes(s))return function(g){return o[s]((_,A)=>g(u(A),A,i))};if(["reduce","reduceRight"].includes(s))return function(g,_){return o[s]((A,P,B)=>g(A,u(B),B,i),_)};if(["find","findIndex"].includes(s))return function(g){let _=o[s]((A,P)=>g(u(P),P,i));if(s==="find"&&_){const A=o.indexOf(_);_=u(A)}return _};if(["values","entries","keys"].includes(s))return function*(){for(let g=0;g<o.length;g++)if(s==="keys")yield g;else{const _=u(g);s==="entries"?yield[g,_]:yield _}}}return c}return u(s)},set(o,s,a,c){if(o=En(n.root.cache,n.target),typeof s=="symbol")return Reflect.set(o,s,a,c);if(o===null||typeof o!="object")throw new Error(`Cannot set property "${s}" of ${o}. Value of path "/${e.path}" is not an object`);if(o instanceof Array&&typeof s=="string"){if(!/^[0-9]+$/.test(s))throw new Error(`Cannot set property "${s}" on array value of path "/${e.path}"`);s=parseInt(s)}return a!==null&&(typeof a=="object"&&(a[ki]&&(a=a.valueOf()),a=Kn(a)),Ya(a,o[s]))||(n.target.some(l=>typeof l=="number")?n.flag("write",n.target.slice(0,n.target.findIndex(l=>typeof l=="number"))):o instanceof Array?n.flag("write",n.target):n.flag("write",n.target.concat(s)),a===null?delete o[s]:(Eu(a),o[s]=a)),!0},deleteProperty(o,s){if(o=En(n.root.cache,n.target),o===null)throw new Error(`Cannot delete property ${s.toString()} of null`);return typeof s=="symbol"?Reflect.deleteProperty(o,s):(s in o&&(n.flag("write",n.target.concat(s)),delete o[s]),!0)},ownKeys(o){return o=En(n.root.cache,n.target),Reflect.ownKeys(o)},has(o,s){return o=En(n.root.cache,n.target),Reflect.has(o,s)},getOwnPropertyDescriptor(o,s){o=En(n.root.cache,n.target);const a=Reflect.getOwnPropertyDescriptor(o,s);return a&&(a.configurable=!0),a},getPrototypeOf(o){return o=En(n.root.cache,n.target),Reflect.getPrototypeOf(o)}},i=new Proxy({},r);return i}function Eu(n){typeof n=="object"&&Object.keys(n).forEach(e=>{const t=n[e];t===null||typeof t=="undefined"?delete n[e]:typeof t=="object"&&Eu(t)})}function ya(n){if(typeof n!="object"||!n[ki])throw new Error("Given value is not proxied. Make sure you are referencing the value through the live data proxy.");return n}class SE{constructor(e,t="order",r=10){if(this.collection=e,this.orderProperty=t,this.orderIncrement=r,typeof e!="object"||!e[ki])throw new Error("Collection is not proxied");if(e.valueOf()instanceof Array)throw new Error("Collection is an array, not an object collection");if(!Object.keys(e).every(i=>typeof e[i]=="object"))throw new Error("Collection has non-object children");if(!Object.keys(e).every(i=>typeof e[i][t]=="number")){const i=Object.keys(e);for(let o=0;o<i.length;o++){const s=e[i[o]];s[t]=o*r}}}getObservable(){return ya(this.collection).getObservable()}getArrayObservable(){const e=Hh();return new e(t=>{const r=this.getObservable().subscribe(()=>{const i=this.getArray();t.next(i)});return function(){r.unsubscribe()}})}getArray(){return ya(this.collection).toArray((e,t)=>e[this.orderProperty]-t[this.orderProperty])}add(e,t,r){const i=this.getArray();let o=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;for(let c=0;c<i.length;c++){const l=i[c][this.orderProperty];o=Math.min(l,o),s=Math.max(l,s)}let a;if(typeof r=="number"){if(a=Object.keys(this.collection).find(c=>this.collection[c]===e),!a)throw new Error("item not found in collection");if(r===t)return{key:a,index:t};if(Math.abs(r-t)===1){const c=i[t],l=c[this.orderProperty];return c[this.orderProperty]=e[this.orderProperty],e[this.orderProperty]=l,{key:a,index:t}}else i.splice(r,1)}if(typeof t!="number"||t>=i.length)t=i.length,e[this.orderProperty]=i.length==0?0:s+this.orderIncrement;else if(t===0)e[this.orderProperty]=i.length==0?0:o-this.orderIncrement;else{const c=i.map(u=>u[this.orderProperty]),l=c[t]-c[t-1];if(l>1)e[this.orderProperty]=c[t]-Math.floor(l/2);else{i.splice(t,0,e);for(let u=0;u<i.length;u++)i[u][this.orderProperty]=u*this.orderIncrement}}return{key:typeof a=="string"?a:ya(this.collection).push(e),index:t}}delete(e){const t=this.getArray()[e];if(!t)throw new Error(`Item at index ${e} not found`);const r=Object.keys(this.collection).find(i=>this.collection[i]===t);if(!r)throw new Error("Cannot find target object to delete");return this.collection[r]=null,{key:r,index:e}}move(e,t){const r=this.getArray();return this.add(r[e],t,e)}sort(e){const t=this.getArray();t.sort(e);for(let r=0;r<t.length;r++)t[r][this.orderProperty]=r*this.orderIncrement}}class im{constructor(e){if(e||(e={}),typeof e.include!="undefined"&&!(e.include instanceof Array))throw new TypeError("options.include must be an array");if(typeof e.exclude!="undefined"&&!(e.exclude instanceof Array))throw new TypeError("options.exclude must be an array");if(typeof e.child_objects!="undefined"&&typeof e.child_objects!="boolean")throw new TypeError("options.child_objects must be a boolean");if(typeof e.cache_mode=="string"&&!["allow","bypass","force"].includes(e.cache_mode))throw new TypeError("invalid value for options.cache_mode");this.include=e.include||void 0,this.exclude=e.exclude||void 0,this.child_objects=typeof e.child_objects=="boolean"?e.child_objects:void 0,this.cache_mode=typeof e.cache_mode=="string"?e.cache_mode:typeof e.allow_cache=="boolean"?e.allow_cache?"allow":"bypass":"allow",this.cache_cursor=typeof e.cache_cursor=="string"?e.cache_cursor:void 0}}class TE extends im{constructor(e){if(super(e),!["undefined","boolean"].includes(typeof e.snapshots))throw new TypeError("options.snapshots must be a boolean");this.snapshots=typeof e.snapshots=="boolean"?e.snapshots:!0}}const Ae=Symbol("private");class Hn{constructor(e,t,r){this.db=e,t||(t=""),t=t.replace(/^\/|\/$/g,"");const i=J.get(t).key,o=[];this[Ae]={get path(){return t},get key(){return i},get callbacks(){return o},vars:r||{},context:{},pushed:!1,cursor:null}}context(e,t=!1){const r=this[Ae].context;if(typeof e=="object"){const i=e?t?r||{}:e:{};return e&&Object.keys(e).forEach(o=>{i[o]=e[o]}),this[Ae].context=i,this}else{if(typeof e=="undefined")return console.warn("Use snap.context() instead of snap.ref.context() to get updating context in event callbacks"),r;throw new Error("Invalid context argument")}}get cursor(){return this[Ae].cursor}set cursor(e){var t;this[Ae].cursor=e,(t=this.onCursor)==null||t.call(this,e)}get path(){return this[Ae].path}get key(){const e=this[Ae].key;return typeof e=="number"?`[${e}]`:e}get index(){const e=this[Ae].key;if(typeof e!="number")throw new Error(`"${e}" is not a number`);return e}get parent(){const e=J.fillVariables2(this.path,this.vars),t=J.get(e);return t.parentPath===null?null:new Hn(this.db,t.parentPath).context(this[Ae].context)}get vars(){return this[Ae].vars}child(e){e=typeof e=="number"?e:e.replace(/^\/|\/$/g,"");const t=J.fillVariables2(this.path,this.vars),r=J.getChildPath(t,e);return new Hn(this.db,r).context(this[Ae].context)}set(e,t){return V(this,null,function*(){try{if(this.isWildcardPath)throw new Error(`Cannot set the value of wildcard path "/${this.path}"`);if(this.parent===null)throw new Error("Cannot set the root object. Use update, or set individual child properties");if(typeof e=="undefined")throw new TypeError(`Cannot store undefined value in "/${this.path}"`);this.db.isReady||(yield this.db.ready()),e=this.db.types.serialize(this.path,e);const{cursor:r}=yield this.db.api.set(this.path,e,{context:this[Ae].context});if(this.cursor=r,typeof t=="function")try{t(null,this)}catch(i){console.error("Error in onComplete callback:",i)}}catch(r){if(typeof t=="function")try{t(r,this)}catch(i){console.error("Error in onComplete callback:",i)}else throw r}return this})}update(e,t){return V(this,null,function*(){try{if(this.isWildcardPath)throw new Error(`Cannot update the value of wildcard path "/${this.path}"`);if(this.db.isReady||(yield this.db.ready()),typeof e!="object"||e instanceof Array||e instanceof ArrayBuffer||e instanceof Date)yield this.set(e);else if(Object.keys(e).length===0)console.warn(`update called on path "/${this.path}", but there is nothing to update`);else{e=this.db.types.serialize(this.path,e);const{cursor:r}=yield this.db.api.update(this.path,e,{context:this[Ae].context});this.cursor=r}if(typeof t=="function")try{t(null,this)}catch(r){console.error("Error in onComplete callback:",r)}}catch(r){if(typeof t=="function")try{t(r,this)}catch(i){console.error("Error in onComplete callback:",i)}else throw r}return this})}transaction(e){return V(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot start a transaction on wildcard path "/${this.path}"`);this.db.isReady||(yield this.db.ready());let t;const r=o=>{o=this.db.types.deserialize(this.path,o);const s=new nt(this,o);let a;try{a=e(s)}catch(c){t=c;return}return a instanceof Promise?a.then(c=>this.db.types.serialize(this.path,c)).catch(c=>{t=c}):this.db.types.serialize(this.path,a)},{cursor:i}=yield this.db.api.transaction(this.path,r,{context:this[Ae].context});if(this.cursor=i,t)throw t;return this})}on(e,t,r){this.path===""&&["value","child_changed"].includes(e)&&console.warn("WARNING: Listening for value and child_changed events on the root node is a bad practice. These events require loading of all data (value event), or potentially lots of data (child_changed event) each time they are fired");let i=null;const o=new aE(c=>{i=c}),s={event:e,stream:o,userCallback:typeof t=="function"&&t,ourCallback:(c,l,u,h,y)=>{if(c){this.db.debug.error(`Error getting data for event ${e} on path "${l}"`,c);return}const d=this.db.ref(l);d[Ae].vars=J.extractVariables(this.path,l);let f;if(e.startsWith("notify_"))f=d.context(y||{});else{const g={previous:this.db.types.deserialize(l,h),current:this.db.types.deserialize(l,u)};if(e==="child_removed")f=new nt(d,g.previous,!0,g.previous,y);else if(e==="mutations")f=new pa(d,g.current,y);else{const _=e==="mutated"&&g.current===null;f=new nt(d,g.current,_,g.previous,y)}}i.publish(f),y!=null&&y.acebase_cursor&&(this.cursor=y.acebase_cursor)}};this[Ae].callbacks.push(s);const a=()=>{typeof t=="function"&&o.subscribe(t,(y,d)=>{y||r&&r(d)});const c=typeof t=="object"?t:{newOnly:!t};typeof c.newOnly!="boolean"&&(c.newOnly=!1),this.isWildcardPath&&(c.newOnly=!0);const l=y=>{const d=this[Ae].callbacks;d.splice(d.indexOf(s),1),this.db.api.unsubscribe(this.path,e,s.ourCallback),this.db.debug.error(`Subscription "${e}" on path "/${this.path}" canceled because of an error: ${y.message}`),i.cancel(y.message)},u=this.db.api.subscribe(this.path,e,s.ourCallback,{newOnly:c.newOnly,cancelCallback:l,syncFallback:c.syncFallback}),h=()=>{const y=this[Ae].callbacks;return y.splice(y.indexOf(s),1),this.db.api.unsubscribe(this.path,e,s.ourCallback)};if(u instanceof Promise?u.then(()=>{i.start(h)}).catch(l):i.start(h),!c.newOnly){if(e==="value")this.get(y=>{i.publish(y)});else if(e==="child_added")this.get(y=>{const d=y.val();d===null||typeof d!="object"||Object.keys(d).forEach(f=>{const g=new nt(this.child(f),d[f]);i.publish(g)})});else if(e==="notify_child_added"){let y=0;const d=()=>V(this,null,function*(){const f=yield this.db.api.reflect(this.path,"children",{limit:100,skip:y});f.list.forEach(g=>{const _=this.child(g.key);i.publish(_)}),f.more&&(y+=100,d())});d()}}};return this.db.isReady?a():this.db.ready(a),o}off(e,t){const r=this[Ae].callbacks.filter(i=>(!e||i.event===e)&&(!t||i.userCallback===t));return r.length===0&&this.db.debug.warn(`Can't find event subscriptions to stop (path: "${this.path}", event: ${e||"(any)"}, callback: ${t})`),r.forEach(i=>{i.stream.stop()}),this}get(e,t){if(!this.db.isReady){const o=this.db.ready().then(()=>this.get(e,t));return typeof e!="function"&&typeof t!="function"?o:void 0}if(t=typeof e=="function"?e:typeof t=="function"?t:void 0,this.isWildcardPath){const o=new Error(`Cannot get value of wildcard path "/${this.path}". Use .query() instead`);if(typeof t=="function")throw o;return Promise.reject(o)}const r=new im(typeof e=="object"?e:{cache_mode:"allow"}),i=this.db.api.get(this.path,r).then(o=>{var s;"context"in o&&"value"in o||(console.warn("AceBase api.get method returned an old response value. Update your acebase or acebase-client package"),o={value:o,context:{}});const a=this.db.types.deserialize(this.path,o.value),c=new nt(this,a,void 0,void 0,o.context);return(s=o.context)!=null&&s.acebase_cursor&&(this.cursor=o.context.acebase_cursor),c});if(t){i.then(t).catch(o=>{console.error("Uncaught error:",o)});return}else return i}once(e,t){return e==="value"&&!this.isWildcardPath?this.get(t):new Promise(r=>{const i=o=>{this.off(e,i),r(o)};this.on(e,i)})}push(e,t){if(this.isWildcardPath){const o=new Error(`Cannot push to wildcard path "/${this.path}"`);if(typeof e=="undefined"||typeof t=="function")throw o;return Promise.reject(o)}const r=Ft.generate(),i=this.child(r);return i[Ae].pushed=!0,typeof e!="undefined"?i.set(e,t).then(()=>i):i}remove(){return V(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot remove wildcard path "/${this.path}". Use query().remove instead`);if(this.parent===null)throw new Error("Cannot remove the root node");return this.set(null)})}exists(){return V(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot check wildcard path "/${this.path}" existence`);return this.db.isReady||(yield this.db.ready()),this.db.api.exists(this.path)})}get isWildcardPath(){return this.path.indexOf("*")>=0||this.path.indexOf("$")>=0}query(){return new om(this)}count(){return V(this,null,function*(){return(yield this.reflect("info",{child_count:!0})).children.count})}reflect(e,t){return V(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot reflect on wildcard path "/${this.path}"`);return this.db.isReady||(yield this.db.ready()),this.db.api.reflect(this.path,e,t)})}export(e){return V(this,arguments,function*(t,r={format:"json",type_safe:!0}){if(this.isWildcardPath)throw new Error(`Cannot export wildcard path "/${this.path}"`);this.db.isReady||(yield this.db.ready());const i=typeof t=="function"?t:t.write.bind(t);return this.db.api.export(this.path,i,r)})}import(e){return V(this,arguments,function*(t,r={format:"json",suppress_events:!1}){if(this.isWildcardPath)throw new Error(`Cannot import to wildcard path "/${this.path}"`);return this.db.isReady||(yield this.db.ready()),this.db.api.import(this.path,t,r)})}proxy(e){const t=typeof e=="object"&&(typeof e.cursor!="undefined"||typeof e.defaultValue!="undefined");return typeof e!="undefined"&&!t&&(this.db.debug.warn("Warning: live data proxy is being initialized with a deprecated method signature. Use ref.proxy(options) instead of ref.proxy(defaultValue)"),e={defaultValue:e}),AE.create(this,e)}observe(e){if(e)throw new Error("observe does not support data retrieval options yet");if(this.isWildcardPath)throw new Error(`Cannot observe wildcard path "/${this.path}"`);const t=Hh();return new t(r=>{let i,o=!1,s=this.get(e).then(c=>{o=!0,i=c.val(),r.next(i)});const a=c=>{if(!o){s=s.then(()=>a(c));return}const l=c.ref.path;if(l===this.path)return i=c.val(),r.next(i);const u=J.getPathKeys(l).slice(J.getPathKeys(this.path).length);let h=i;for(;u.length>1;){const f=u.shift();f in h||(h[f]=typeof u[0]=="number"?[]:{}),h=h[f]}const y=u.shift(),d=c.val();d===null?h instanceof Array&&typeof y=="number"?h.splice(y,1):delete h[y]:h[y]=d,r.next(i)};return this.on("mutated",a),()=>{this.off("mutated",a)}})}forEach(e,t){return V(this,null,function*(){let r;if(typeof e=="function"?t=e:r=e,typeof t!="function")throw new TypeError("No callback function given");const i=yield this.reflect("children",{limit:0,skip:0}),o={canceled:!1,total:i.list.length,processed:0};for(let s=0;s<i.list.length;s++){const a=i.list[s].key,c=yield this.child(a).get(r);if(o.processed++,!!c.exists()&&(yield t(c))===!1){o.canceled=!0;break}}return o})}getMutations(e){return V(this,null,function*(){const t=typeof e=="string"?e:void 0,r=e===null||typeof e=="undefined"?0:e instanceof Date?e.getTime():void 0;return this.db.api.getMutations({path:this.path,cursor:t,timestamp:r})})}getChanges(e){return V(this,null,function*(){const t=typeof e=="string"?e:void 0,r=e===null||typeof e=="undefined"?0:e instanceof Date?e.getTime():void 0;return this.db.api.getChanges({path:this.path,cursor:t,timestamp:r})})}}class om{constructor(e){this.ref=e,this[Ae]={filters:[],skip:0,take:0,order:[],events:{}}}filter(e,t,r){if((t==="in"||t==="!in")&&(!(r instanceof Array)||r.length===0))throw new Error(`${t} filter for ${e} must supply an Array compare argument containing at least 1 value`);if((t==="between"||t==="!between")&&(!(r instanceof Array)||r.length!==2))throw new Error(`${t} filter for ${e} must supply an Array compare argument containing 2 values`);if((t==="matches"||t==="!matches")&&!(r instanceof RegExp))throw new Error(`${t} filter for ${e} must supply a RegExp compare argument`);return this[Ae].filters.push({key:e,op:t,compare:r}),this}where(e,t,r){return this.filter(e,t,r)}take(e){return this[Ae].take=e,this}skip(e){return this[Ae].skip=e,this}sort(e,t=!0){if(!["string","number"].includes(typeof e))throw"key must be a string or number";return this[Ae].order.push({key:e,ascending:t}),this}order(e,t=!0){return this.sort(e,t)}get(e,t){if(!this.ref.db.isReady){const o=this.ref.db.ready().then(()=>this.get(e,t));return typeof e!="function"&&typeof t!="function"?o:void 0}t=typeof e=="function"?e:typeof t=="function"?t:void 0;const r=new TE(typeof e=="object"?e:{snapshots:!0,cache_mode:"allow"});r.allow_cache=r.cache_mode!=="bypass",r.eventHandler=o=>{if(!this[Ae].events[o.name])return!1;const s=this[Ae].events[o.name];if(typeof s!="object"||s.length===0)return!1;if(["add","change","remove"].includes(o.name)){const a={name:o.name,ref:new Hn(this.ref.db,o.path)};if(r.snapshots&&o.name!=="remove"){const c=i.types.deserialize(o.path,o.value);a.snapshot=new nt(a.ref,c,!1)}o=a}s.forEach(a=>{var c,l;try{a(o)}catch(u){this.ref.db.debug.error(`Error executing "${o.name}" event handler of realtime query on path "${this.ref.path}": ${(l=(c=u==null?void 0:u.stack)!=null?c:u==null?void 0:u.message)!=null?l:u}`)}})},r.monitor={add:!1,change:!1,remove:!1},this[Ae].events&&(this[Ae].events.add&&this[Ae].events.add.length>0&&(r.monitor.add=!0),this[Ae].events.change&&this[Ae].events.change.length>0&&(r.monitor.change=!0),this[Ae].events.remove&&this[Ae].events.remove.length>0&&(r.monitor.remove=!0)),this.stop();const i=this.ref.db;return i.api.query(this.ref.path,this[Ae],r).catch(o=>{throw new Error(o)}).then(o=>{const{stop:s}=o;let{results:a,context:c}=o;if(this.stop=()=>V(this,null,function*(){yield s()}),"results"in o&&"context"in o||(console.warn("Query results missing context. Update your acebase and/or acebase-client packages"),a=o,c={}),r.snapshots){const l=a.map(u=>{const h=i.types.deserialize(u.path,u.val);return new nt(i.ref(u.path),h,!1,void 0,c)});return gc.from(l)}else{const l=a.map(u=>i.ref(u));return Yh.from(l)}}).then(o=>(t&&t(o),o))}stop(){return V(this,null,function*(){})}getRefs(e){return this.get({snapshots:!1},e)}find(){return this.get({snapshots:!1})}count(){return V(this,null,function*(){return(yield this.find()).length})}exists(){return V(this,null,function*(){const e=this[Ae].take,t=this.take(1).find();return this.take(e),(yield t).length!==0})}remove(e){return V(this,null,function*(){const t=yield this.find(),r=t.reduce((a,c)=>{const l=a[c.parent.path];return l?l.push(c):a[c.parent.path]=[c],a},{}),i=this.ref.db,o=Object.keys(r).map(a=>V(this,null,function*(){const c=t.reduce((u,h)=>(u[h.key]=null,u),{}),l=i.ref(a);try{return yield l.update(c),{ref:l,success:!0}}catch(u){return{ref:l,success:!1,error:u}}})),s=yield Promise.all(o);return e&&e(s),s})}on(e,t){return this[Ae].events[e]||(this[Ae].events[e]=[]),this[Ae].events[e].push(t),this}off(e,t){if(typeof e=="undefined")return this[Ae].events={},this;if(!this[Ae].events[e])return this;if(typeof t=="undefined")return delete this[Ae].events[e],this;const r=this[Ae].events[e].indexOf(t);return~r?(this[Ae].events[e].splice(r,1),this):this}forEach(e,t){return V(this,null,function*(){let r;if(typeof e=="function"?t=e:r=e,typeof t!="function")throw new TypeError("No callback function given");const i=yield this.find(),o={canceled:!1,total:i.length,processed:0};for(let s=0;s<i.length;s++){const a=yield i[s].get(r);if(o.processed++,!!a.exists()&&(yield t(a))===!1){o.canceled=!0;break}}return o})}}class gc extends Array{static from(e){const t=new gc(e.length);return e.forEach((r,i)=>t[i]=r),t}getValues(){return this.map(e=>e.val())}}class Yh extends Array{static from(e){const t=new Yh(e.length);return e.forEach((r,i)=>t[i]=r),t}getPaths(){return this.map(e=>e.path)}}function PE(n,e){e=e.replace(/^\/|\/$/g,"");const t=J.getPathKeys(e),r=Object.keys(n).find(i=>{const o=J.getPathKeys(i);return o.length!==t.length?!1:o.every((s,a)=>s==="*"||typeof s=="string"&&s[0]==="$"?!0:s===t[a])});return n[r]}function jE(n,e){const t=J.get(e).parentPath;if(t!==null)return PE(n,t)}function RE(n,e){e=e.replace(/^\/|\/$/g,"");const t=J.get(e).parentPath,r=t?J.getPathKeys(t):[];return Object.keys(n).reduce((i,o)=>{const s=J.getPathKeys(o);if(s.length<r.length)return i;let a=!0;if(r.length===0&&t!==null?a=s.length===1&&(s[0]==="*"||typeof s[0]=="string"&&s[0][0]==="$"):s.every((c,l)=>l>=r.length?!1:c==="*"||typeof c=="string"&&c[0]==="$"||c===r[l]?!0:(a=!1,!1)),a){const c=n[o];i.push({path:o,type:c})}return i},[])}function dp(n,e,t,r,i){if(r===null||typeof r!="object")return r;const o=J.getPathKeys(t),s=RE(e,t),a=[];return s.sort((c,l)=>J.getPathKeys(c.path).length>J.getPathKeys(l.path).length?-1:1),s.forEach(c=>{const l=J.getPathKeys(c.path);l.push("*");const u=l.slice(o.length);if(u.length===0){const y=J.extractVariables(c.path,t),d=new Hn(n,t,y);if(i==="serialize")r=c.type.serialize(r,d);else if(i==="deserialize"){const f=new nt(d,r);r=c.type.deserialize(f)}return}const h=(y,d,f)=>{if(r===null||typeof r!="object")return r;const g=f[0];let _=[];if(g==="*"||typeof g=="string"&&g[0]==="$")d instanceof Array?_=d.map((A,P)=>({key:P,val:A})):_=Object.keys(d).map(A=>({key:A,val:d[A]}));else{const A=d[g];typeof A=="object"&&_.push({key:g,val:A})}_.forEach(A=>{const P=J.getChildPath(y,A.key),B=J.extractVariables(c.path,P),C=new Hn(n,P,B);if(f.length===1){if(i==="serialize")a.push({parent:d,key:A.key,original:d[A.key]}),d[A.key]=c.type.serialize(A.val,C);else if(i==="deserialize"){const L=new nt(C,A.val);d[A.key]=c.type.deserialize(L)}}else h(P,A.val,f.slice(1))})};h(t,r,u)}),i==="serialize"&&(r=Kn(r),a.length>0&&a.forEach(c=>{c.parent[c.key]=c.original})),r}const Wi=Symbol("mappings");class sm{constructor(e){this.db=e,this[Wi]={}}get mappings(){return this[Wi]}map(e){return jE(this[Wi],e)}bind(e,t,r={}){if(typeof e!="string")throw new TypeError("path must be a string");if(typeof t!="function")throw new TypeError("constructor must be a function");if(typeof r.serializer!="undefined"){if(typeof r.serializer=="string")if(typeof t.prototype[r.serializer]=="function")r.serializer=t.prototype[r.serializer];else throw new TypeError(`${t.name}.prototype.${r.serializer} is not a function, cannot use it as serializer`);else if(typeof r.serializer!="function")throw new TypeError(`serializer for class ${t.name} must be a function, or the name of a prototype method`)}if(typeof r.creator=="undefined")typeof t.create=="function"&&(r.creator=t.create);else if(typeof r.creator=="string")if(typeof t[r.creator]=="function")r.creator=t[r.creator];else throw new TypeError(`${t.name}.${r.creator} is not a function, cannot use it as creator`);else if(typeof r.creator!="function")throw new TypeError(`creator for class ${t.name} must be a function, or the name of a static method`);e=e.replace(/^\/|\/$/g,""),this[Wi][e]={db:this.db,type:t,creator:r.creator,serializer:r.serializer,deserialize(i){let o;return this.creator?o=this.creator.call(this.type,i):o=new this.type(i),o},serialize(i,o){return this.serializer?i=this.serializer.call(i,o,i):i&&typeof i.serialize=="function"&&(i=i.serialize(o,i)),i}}}serialize(e,t){return dp(this.db,this[Wi],e,t,"serialize")}deserialize(e,t){return dp(this.db,this[Wi],e,t,"deserialize")}}const Fs=()=>{};class am{constructor(e="log",t=""){this.level=e,this.prefix=t,this.setLevel(e)}setLevel(e){const t=this.prefix?this.prefix+" %s":"";this.verbose=["verbose"].includes(e)?t?console.log.bind(console,t):console.log.bind(console):Fs,this.log=["verbose","log"].includes(e)?t?console.log.bind(console,t):console.log.bind(console):Fs,this.warn=["verbose","log","warn"].includes(e)?t?console.warn.bind(console,t):console.warn.bind(console):Fs,this.error=["verbose","log","warn","error"].includes(e)?t?console.error.bind(console,t):console.error.bind(console):Fs,this.write=r=>{const i=typeof An!="undefined"&&An.env&&typeof{}.RUNKIT_ENDPOINT_PATH=="string";r&&i?r.split(`
`).forEach(o=>console.log(o)):console.log(r)}}}const fp={bold:1,dim:2,italic:3,underline:4,inverse:7,hidden:8,strikethrough:94},pp={black:30,red:31,green:32,yellow:33,blue:34,magenta:35,cyan:36,white:37,grey:90,brightRed:91},yp={bgBlack:40,bgRed:41,bgGreen:42,bgYellow:43,bgBlue:44,bgMagenta:45,bgCyan:46,bgWhite:47,bgGrey:100,bgBrightRed:101},Vs={all:0,color:39,background:49,bold:22,dim:22,italic:23,underline:24,inverse:27,hidden:28,strikethrough:29};var At;(function(n){n.reset="reset",n.bold="bold",n.dim="dim",n.italic="italic",n.underline="underline",n.inverse="inverse",n.hidden="hidden",n.strikethrough="strikethrough",n.black="black",n.red="red",n.green="green",n.yellow="yellow",n.blue="blue",n.magenta="magenta",n.cyan="cyan",n.grey="grey",n.bgBlack="bgBlack",n.bgRed="bgRed",n.bgGreen="bgGreen",n.bgYellow="bgYellow",n.bgBlue="bgBlue",n.bgMagenta="bgMagenta",n.bgCyan="bgCyan",n.bgWhite="bgWhite",n.bgGrey="bgGrey"})(At||(At={}));function cm(){if(typeof An=="undefined"||!An.stdout||!An.env||!An.platform||An.platform==="browser")return!1;if(An.platform==="win32")return!0;const n=An.env;return n.COLORTERM?!0:n.TERM==="dumb"?!1:n.CI||n.TEAMCITY_VERSION?!!n.TRAVIS:!!(["iTerm.app","HyperTerm","Hyper","MacTerm","Apple_Terminal","vscode"].includes(n.TERM_PROGRAM)||/^xterm-256|^screen|^xterm|^vt100|color|ansi|cygwin|linux/i.test(n.TERM))}let lm=cm();function IE(n){lm=cm()&&n}function CE(n,e){if(!lm)return n;const t=[],r=[],i=a=>{a===At.reset?t.push(Vs.all):a in fp?(t.push(fp[a]),r.push(Vs[a])):a in pp?(t.push(pp[a]),r.push(Vs.color)):a in yp&&(t.push(yp[a]),r.push(Vs.background))};e instanceof Array?e.forEach(i):i(e);const o=t.map(a=>"\x1B["+a+"m").join(""),s=r.map(a=>"\x1B["+a+"m").join("");return n.split(`
`).map(a=>o+a+s).join(`
`)}String.prototype.colorize=function(n){return CE(this,n)};class um{constructor(e){this.logLevel="log",this.logColors=!0,this.info="realtime database",this.sponsor=!1,typeof e!="object"&&(e={}),typeof e.logLevel=="string"&&(this.logLevel=e.logLevel),typeof e.logColors=="boolean"&&(this.logColors=e.logColors),typeof e.info=="string"&&(this.info=e.info),typeof e.sponsor=="boolean"&&(this.sponsor=e.sponsor)}}class NE extends oo{constructor(e,t={}){super(),this._ready=!1,t=new um(t),this.name=e,this.debug=new am(t.logLevel,`[${e}]`),IE(t.logColors);const r=[At.magenta,At.bold],i=`     ___          ______                
    / _ \\         | ___ \\               
   / /_\\ \\ ___ ___| |_/ / __ _ ___  ___ 
   |  _  |/ __/ _ \\ ___ \\/ _\` / __|/ _ \\
   | | | | (_|  __/ |_/ / (_| \\__ \\  __/
   \\_| |_/\\___\\___\\____/ \\__,_|___/\\___|`,o=t.info?"".padStart(40-t.info.length," ")+t.info+`
`:"";t.sponsor||(this.debug.write(i.colorize(r)),o&&this.debug.write(o.colorize(At.magenta))),this.types=new sm(this),this.once("ready",()=>{this._ready=!0})}ready(e){return V(this,null,function*(){this._ready||(yield new Promise(t=>this.on("ready",t))),e==null||e()})}get isReady(){return this._ready}setObservable(e){OE(e)}ref(e){return new Hn(this,e)}get root(){return this.ref("")}query(e){const t=new Hn(this,e);return new om(t)}get indexes(){return{get:()=>this.api.getIndexes(),create:(e,t,r)=>this.api.createIndex(e,t,r),delete:e=>V(this,null,function*(){return this.api.deleteIndex(e)})}}get schema(){return{get:e=>this.api.getSchema(e),set:(e,t,r=!1)=>this.api.setSchema(e,t,r),all:()=>this.api.getSchemas(),check:(e,t,r)=>this.api.validateSchema(e,t,r)}}}class ct extends Error{constructor(e){super(`${e} is not implemented`)}}class BE extends oo{constructor(){super()}stats(e){throw new ct("stats")}subscribe(e,t,r,i){throw new ct("subscribe")}unsubscribe(e,t,r){throw new ct("unsubscribe")}update(e,t,r){throw new ct("update")}set(e,t,r){throw new ct("set")}get(e,t){throw new ct("get")}transaction(e,t,r){throw new ct("transaction")}exists(e){throw new ct("exists")}query(e,t,r){throw new ct("query")}reflect(e,t,r){throw new ct("reflect")}export(e,t,r){throw new ct("export")}import(e,t,r){throw new ct("import")}createIndex(e,t,r){throw new ct("createIndex")}getIndexes(){throw new ct("getIndexes")}deleteIndex(e){throw new ct("deleteIndex")}setSchema(e,t,r){throw new ct("setSchema")}getSchema(e){throw new ct("getSchema")}getSchemas(){throw new ct("getSchemas")}validateSchema(e,t,r){throw new ct("validateSchema")}getMutations(e){throw new ct("getMutations")}getChanges(e){throw new ct("getChanges")}}function gp(n,e,t){const r=[0,0,0,0,0];for(let i=0;i<e;i+=4){let o=((n[i]*256+n[i+1])*256+n[i+2])*256+n[i+3];if(!o)t.push("z");else{for(let s=0;s<5;r[s++]=o%85+33,o=Math.floor(o/85));t.push(String.fromCharCode(r[4],r[3],r[2],r[1],r[0]))}}}function LE(n){const e=n,t=[],r=e.length%4,i=e.length-r;if(gp(e,i,t),r){const s=new Uint8Array(4);s.set(e.slice(i),0),gp(s,4,t);let a=t.pop();a=="z"&&(a="!!!!!"),t.push(a.substr(0,r+1))}let o=t.join("");return o="<~"+o+"~>",o}const br={encode:function(n){return n instanceof ArrayBuffer&&(n=new Uint8Array(n,0,n.byteLength)),LE(n)},decode:function(n){if(!n.startsWith("<~")||!n.endsWith("~>"))throw new Error("Invalid input string");n=n.substr(2,n.length-4);const e=n.length,t=[],r=[0,0,0,0,0];let i,o,s,a;for(let l=0;l<e;++l){if(n.charAt(l)=="z"){t.push(0,0,0,0);continue}for(let u=0;u<5;++u)r[u]=n.charCodeAt(l+u)-33;if(a=e-l,a<5){for(let u=a;u<4;r[++u]=0);r[a]=85}i=(((r[0]*85+r[1])*85+r[2])*85+r[3])*85+r[4],o=i&255,i>>>=8,s=i&255,i>>>=8,t.push(i>>>8,i&255,s,o);for(let u=a;u<5;++u,t.pop());l+=4}const c=new Uint8Array(t);return c.buffer.slice(c.byteOffset,c.byteOffset+c.byteLength)}},DE=n=>{if(n.map===null||typeof n.map=="undefined"){if(typeof n.val=="undefined")throw new Error("serialized value must have a val property");return n.val}const e=(t,r)=>t==="date"?new Date(r):t==="binary"?br.decode(r):t==="reference"?new rt(r):t==="regexp"?new RegExp(r.pattern,r.flags):t==="array"?new Ja(r):t==="bigint"?BigInt(r):r;return typeof n.map=="string"?e(n.map,n.val):(Object.keys(n.map).forEach(t=>{const r=n.map[t],i=J.getPathKeys(t);let o=n,s="val",a=n.val;i.forEach(c=>{s=c,o=a,a=a[s]}),o[s]=e(r,a)}),n.val)},hm=n=>{var e;if(n===null||typeof n!="object"||n instanceof Date||n instanceof ArrayBuffer||n instanceof rt||n instanceof RegExp){const o=hm({value:n});return{map:(e=o.map)==null?void 0:e.value,val:o.val.value}}n=Kn(n);const t=(o,s,a)=>{o instanceof Ja&&(s[a]="array"),Object.keys(o).forEach(c=>{const l=o[c],u=a.length===0?c:`${a}/${c}`;typeof l=="bigint"?(o[c]=l.toString(),s[u]="bigint"):l instanceof Date?(o[c]=l.toISOString(),s[u]="date"):l instanceof ArrayBuffer?(o[c]=br.encode(l),s[u]="binary"):l instanceof rt?(o[c]=l.path,s[u]="reference"):l instanceof RegExp?(o[c]={pattern:l.source,flags:l.flags},s[u]="regexp"):typeof l=="object"&&l!==null&&t(l,s,u)})},r={};t(n,r,"");const i={val:n};return Object.keys(r).length>0&&(i.map=r),i},mp=n=>n>0?Date.now()+n*1e3:1/0;class qE{get size(){return this.cache.size}constructor(e){var t;if(this.enabled=!0,typeof e=="number"&&(e={expirySeconds:e}),e.cloneValues=e.cloneValues!==!1,typeof e.expirySeconds!="number"&&typeof e.maxEntries!="number")throw new Error("Either expirySeconds or maxEntries must be specified");this.options=e,this.cache=new Map;const r=setInterval(()=>{this.cleanUp()},60*1e3);(t=r.unref)==null||t.call(r)}has(e){return this.enabled?this.cache.has(e):!1}get(e){if(!this.enabled)return null;const t=this.cache.get(e);return t?(t.expires=mp(this.options.expirySeconds),t.accessed=Date.now(),this.options.cloneValues?Kn(t.value):t.value):null}set(e,t){if(this.options.maxEntries>0&&this.cache.size>=this.options.maxEntries&&!this.cache.has(e)){let r=null;const i=Date.now();for(const[o,s]of this.cache.entries()){if(s.expires<=i){this.cache.delete(o),r=null;break}(!r||s.accessed<r.accessed)&&(r={key:o,accessed:s.accessed})}r!==null&&this.cache.delete(r.key)}this.cache.set(e,{value:this.options.cloneValues?Kn(t):t,added:Date.now(),accessed:Date.now(),expires:mp(this.options.expirySeconds)})}remove(e){this.cache.delete(e)}cleanUp(){const e=Date.now();this.cache.forEach((t,r)=>{t.expires<=e&&this.cache.delete(r)})}}function UE(n){let e=0;function t(){let a;for(;a=n[e],[" ","\r",`
`,"	"].includes(a);)e++}function r(a){if(n[e]!==a)throw new Error(`Unexpected character at position ${e}. Expected: '${a}', found '${n[e]}'`);e++}function i(){t();const a={name:"",optional:!1,wildcard:!1};let c;for(;c=n[e],c==="_"||c==="$"||c>="a"&&c<="z"||c>="A"&&c<="Z"||a.name.length>0&&c>="0"&&c<="9"||a.name.length===0&&c==="*";)a.name+=c,e++;if(a.name.length===0)throw new Error(`Property name expected at position ${e}, found: ${n.slice(e,e+10)}..`);return n[e]==="?"&&(a.optional=!0,e++),(a.name==="*"||a.name[0]==="$")&&(a.optional=!0,a.wildcard=!0),t(),r(":"),a}function o(){t();let a={typeOf:"any"},c,l="";for(;c=n[e],c>="a"&&c<="z"||c>="A"&&c<="Z";)l+=c,e++;if(l.length===0)if(n[e]==="*")r("*"),a.typeOf="any";else if(["'",'"',"`"].includes(n[e])){a.typeOf="string",a.value="";const u=n[e];for(r(u);c=n[e],c&&c!==u;)a.value+=c,e++;r(u)}else if(n[e]>="0"&&n[e]<="9"){a.typeOf="number";let u="";for(;c=n[e],c==="."||c==="n"||c>="0"&&c<="9";)u+=c,e++;u.endsWith("n")?a.value=BigInt(u):u.includes(".")?a.value=parseFloat(u):a.value=parseInt(u)}else if(n[e]==="{"){for(r("{"),a.typeOf="object",a.instanceOf=Object,a.children=[];;){const u=i(),h=s();if(a.children.push({name:u.name,optional:u.optional,wildcard:u.wildcard,types:h}),t(),(n[e]===";"||n[e]===",")&&(r(n[e]),t()),n[e]==="}")break}r("}")}else if(n[e]==="/"){r("/");let u="",h="";for(;c=n[e],c!=="/"||u.endsWith("\\");)u+=c,e++;for(r("/");c=n[e],["g","i","m","s","u","y","d"].includes(c);)h+=c,e++;a.typeOf="string",a.matches=new RegExp(u,h)}else throw new Error(`Expected a type definition at position ${e}, found character '${n[e]}'`);else if(["string","number","boolean","bigint","undefined","String","Number","Boolean","BigInt"].includes(l))a.typeOf=l.toLowerCase();else if(l==="Object"||l==="object")a.typeOf="object",a.instanceOf=Object;else if(l==="Date")a.typeOf="object",a.instanceOf=Date;else if(l==="Binary"||l==="binary")a.typeOf="object",a.instanceOf=ArrayBuffer;else if(l==="any")a.typeOf="any";else if(l==="null")a.typeOf="object",a.value=null;else if(l==="Array")r("<"),a.typeOf="object",a.instanceOf=Array,a.genericTypes=s(),r(">");else if(["true","false"].includes(l))a.typeOf="boolean",a.value=l==="true";else throw new Error(`Unknown type at position ${e}: "${a}"`);for(t();n[e]==="[";)r("["),r("]"),a={typeOf:"object",instanceOf:Array,genericTypes:[a]};return a}function s(){t();const a=[o()];for(;n[e]==="|";)r("|"),a.push(o()),t();return a}return o()}function ME(n,e,t,r){const i=e.find(h=>h.name==="*"||h.name[0]==="$")?[]:Object.keys(t).filter(h=>![null,void 0].includes(t[h])&&!e.find(y=>y.name===h));if(i.length>0)return{ok:!1,reason:`Object at path "${n}" cannot have propert${i.length===1?"y":"ies"} ${i.map(h=>`"${h}"`).join(", ")}`};function o(h){const y=![null,void 0].includes(t[h.name]);return!h.optional&&(r?t[h.name]===null:!y)?{ok:!1,reason:`Property at path "${n}/${h.name}" is not optional`}:y&&h.types.length===1?Yo(`${n}/${h.name}`,h.types[0],t[h.name],!1):y&&!h.types.some(d=>Yo(`${n}/${h.name}`,d,t[h.name],!1).ok)?{ok:!1,reason:`Property at path "${n}/${h.name}" does not match any of ${h.types.length} allowed types`}:{ok:!0}}const s=e.filter(h=>!h.wildcard),a=s.find(h=>!o(h).ok);if(a)return{ok:!1,reason:o(a).reason};const c=e.find(h=>h.wildcard);if(!c)return{ok:!0};const l=Object.keys(t).filter(h=>!s.find(y=>y.name===h));let u={ok:!0};for(let h=0;h<l.length&&u.ok;h++){const y=l[h];u=o({name:y,types:c.types,optional:!0,wildcard:!0})}return u}function Yo(n,e,t,r,i){const o={ok:!0};if(e.typeOf==="any")return o;if(i instanceof Array&&i.length>0){if(e.typeOf!=="object")return{ok:!1,reason:`path "${n}" must be typeof ${e.typeOf}`};if(!e.children)return o;const s=i[0];let a=e.children.find(l=>l.name===s);if(a||(a=e.children.find(l=>l.name==="*"||l.name[0]==="$")),!a)return{ok:!1,reason:`Object at path "${n}" cannot have property "${s}"`};if(a.optional&&t===null&&i.length===1)return o;let c;return a.types.some(l=>{const u=typeof s=="number"?`${n}[${s}]`:`${n}/${s}`;return c=Yo(u,l,t,r,i.slice(1)),c.ok}),c}return t===null?o:e.instanceOf===Object&&(typeof t!="object"||t instanceof Array||t instanceof Date)?{ok:!1,reason:`path "${n}" must be an object collection`}:e.instanceOf&&(typeof t!="object"||t.constructor!==e.instanceOf)?{ok:!1,reason:`path "${n}" must be an instance of ${e.instanceOf.name}`}:"value"in e&&t!==e.value?{ok:!1,reason:`path "${n}" must be value: ${e.value}`}:typeof t!==e.typeOf?{ok:!1,reason:`path "${n}" must be typeof ${e.typeOf}`}:e.instanceOf===Array&&e.genericTypes&&!t.every(s=>e.genericTypes.some(a=>Yo(n,a,s,!1).ok))?{ok:!1,reason:`every array value of path "${n}" must match one of the specified types`}:e.typeOf==="object"&&e.children?ME(n,e.children,t,r):e.matches&&!e.matches.test(t)?{ok:!1,reason:`path "${n}" must match regular expression /${e.matches.source}/${e.matches.flags}`}:o}function FE(n){switch(n){case String:return"string";case Number:return"number";case Boolean:return"boolean";case Date:return"Date";case BigInt:return"bigint";case Array:throw new Error("Schema error: Array cannot be used without a type. Use string[] or Array<string> instead");default:throw new Error(`Schema error: unknown type used: ${n.name}`)}}class VE{constructor(e,t={warnOnly:!1}){if(this.handling=t,this.source=e,typeof e=="object"){const r=i=>"{"+Object.keys(i).map(o=>{let s=i[o];if(s===void 0)s="undefined";else if(s instanceof RegExp)s=`/${s.source}/${s.flags}`;else if(typeof s=="object")s=r(s);else if(typeof s=="function")s=FE(s);else if(!["string","number","boolean","bigint"].includes(typeof s))throw new Error(`Type definition for key "${o}" must be a string, number, boolean, bigint, object, regular expression, or one of these classes: String, Number, Boolean, Date, BigInt`);return`${o}:${s}`}).join(",")+"}";this.text=r(e)}else if(typeof e=="string")this.text=e;else throw new Error("Type definiton must be a string or an object");this.type=UE(this.text)}check(e,t,r,i){const o=Yo(e,this.type,t,r,i);return!o.ok&&this.handling.warnOnly&&(o.warning=`${r?"Partial schema":"Schema"} check on path "${e}"${i?` for child "${i.join("/")}"`:""} failed: ${o.reason}`,o.ok=!0,this.handling.warnCallback(o.warning)),o}}class nn{constructor(e="browser"){throw new Error(`This feature is not supported in ${e} context`)}}class kl extends nn{}class _u extends nn{}class vp extends nn{}class KE extends nn{}class bp extends nn{}class WE extends nn{}const zE={OBJECT:1,ARRAY:2,NUMBER:3,BOOLEAN:4,STRING:5,BIGINT:7,DATETIME:6,BINARY:8,REFERENCE:9},ae=zE;function HE(n){switch(n){case ae.ARRAY:return"array";case ae.BINARY:return"binary";case ae.BOOLEAN:return"boolean";case ae.DATETIME:return"date";case ae.NUMBER:return"number";case ae.OBJECT:return"object";case ae.REFERENCE:return"reference";case ae.STRING:return"string";case ae.BIGINT:return"bigint"}}class dm{constructor(e){if(this.path=e.path,this.type=e.type,this.index=e.index,this.key=e.key,this.exists=e.exists,this.address=e.address,this.value=e.value,this.childCount=e.childCount,typeof this.path=="string"&&typeof this.key=="undefined"&&typeof this.index=="undefined"){const t=J.get(this.path);typeof t.key=="number"?this.index=t.key:this.key=t.key}typeof this.exists=="undefined"&&(this.exists=!0)}get valueType(){return this.type}get valueTypeName(){return HE(this.valueType)}toString(){return this.exists?this.address?`"${this.path}" is ${this.valueTypeName} stored at ${this.address.toString()}`:`"${this.path}" is ${this.valueTypeName} with value ${this.value}`:`"${this.path}" doesn't exist`}}function Gt(n,e){if(!n)throw new Error(`Assertion failed: ${e!=null?e:"check your code"}`)}const JE=120,Xt={PENDING:"pending",LOCKED:"locked",EXPIRED:"expired",DONE:"done"};class fm{constructor(e,t=JE){this._locks=[],this._lastTid=0,this.debug=e,this.timeout=t*1e3}setTimeout(e){this.timeout=e*1e3}createTid(){return Ft.generate()}_allowLock(e,t,r){const i=this._locks.find(o=>o.tid!==t&&o.state===Xt.LOCKED&&(r||o.forWriting));return{allow:!i,conflict:i}}quit(){return new Promise(e=>{if(this._locks.length===0)return e();this._quit=e})}_rejectLock(e,t){this._locks.splice(this._locks.indexOf(e),1),clearTimeout(e.timeout);try{e.reject(t)}catch(r){console.error("Unhandled promise rejection:",r)}}_processLockQueue(){if(this._quit){const e=new Error("Quitting");this._locks.filter(t=>t.state===Xt.PENDING).forEach(t=>this._rejectLock(t,e)),this._locks.length===0&&this._quit()}this._locks.filter(e=>e.state===Xt.PENDING).sort((e,t)=>e.priority&&!t.priority?-1:!e.priority&&t.priority?1:e.requested-t.requested).forEach(e=>{const t=this._allowLock(e.path,e.tid,e.forWriting);e.waitingFor=t.conflict||null,t.allow&&this.lock(e).then(e.resolve).catch(r=>this._rejectLock(e,r))})}lock(e,t){return V(this,arguments,function*(r,i,o=!0,s="",a={withPriority:!1,noTimeout:!1}){let c,l;if(r instanceof xl)c=r,l=!0;else{if(this._locks.findIndex(u=>u.tid===i&&u.state===Xt.EXPIRED)>=0)throw new Error(`lock on tid ${i} has expired, not allowed to continue`);if(this._quit&&!a.withPriority)throw new Error("Quitting");{c=new xl(this,r,i,o,a.withPriority===!0),c.comment=s,this._locks.push(c);const u=this._allowLock(r,i,o);c.waitingFor=u.conflict||null,l=u.allow}}if(l){if(c.state=Xt.LOCKED,typeof c.granted!="number"&&(c.granted=Date.now(),a.noTimeout!==!0)){c.expires=Date.now()+this.timeout;let u=0;const h=()=>{if(c.state===Xt.LOCKED){if(u++,u<=3){this.debug.warn(`${c.forWriting?"write":"read"} lock on path "/${c.path}" by tid ${c.tid} (${c.comment}) is taking a long time to complete [${u}]`),c.timeout=setTimeout(h,this.timeout/4);return}this.debug.error(`lock :: ${c.forWriting?"write":"read"} lock on path "/${c.path}" by tid ${c.tid} (${c.comment}) took too long`),c.state=Xt.EXPIRED,this._processLockQueue()}};c.timeout=setTimeout(h,this.timeout/4)}return c}else return Gt(c.state===Xt.PENDING),new Promise((u,h)=>{c.resolve=u,c.reject=h})})}unlock(e,t,r=!0){let i,o;if(e instanceof xl)i=e,o=this._locks.indexOf(i);else{const s=e;o=this._locks.findIndex(a=>a.id===s),i=this._locks[o]}if(o<0){const s=`lock on "/${i.path}" for tid ${i.tid} wasn't found; ${t}`;throw new Error(s)}return i.state=Xt.DONE,clearTimeout(i.timeout),this._locks.splice(o,1),r&&this._processLockQueue(),i}list(){return this._locks||[]}isAllowed(e,t,r){return this._allowLock(e,t,r).allow}}let YE=0;class xl{static get LOCK_STATE(){return Xt}constructor(e,t,r,i,o=!1){this.locker=e,this.path=t,this.tid=r,this.forWriting=i,this.priority=o,this.state=Xt.PENDING,this.requested=Date.now(),this.comment="",this.waitingFor=null,this.id=++YE,this.history=[]}release(e){return V(this,null,function*(){return this.history.push({action:"release",path:this.path,forWriting:this.forWriting,comment:e}),this.locker.unlock(this,e||this.comment)})}moveToParent(){return V(this,null,function*(){const e=J.get(this.path).parentPath;if(this.locker.isAllowed(e,this.tid,this.forWriting))return this.history.push({path:this.path,forWriting:this.forWriting,action:"moving to parent"}),this.waitingFor=null,this.path=e,this;{this.locker.unlock(this,`moveLockToParent: ${this.comment}`,!1);const t=yield this.locker.lock(e,this.tid,this.forWriting,this.comment,{withPriority:!0});return t.history=this.history,t.history.push({path:this.path,forWriting:this.forWriting,action:"moving to parent through queue (priority)"}),t}})}}class Gh extends Error{}class $u extends Error{}class GE extends Error{constructor(e){super(`Exiting: ${e}`)}}class XE extends oo{get isMaster(){return this.masterPeerId===this.id}constructor(e,t,r=e.name){super(),this.storage=e,this.id=t,this.dbname=r,this.ipcType="ipc",this.ourSubscriptions=[],this.remoteSubscriptions=[],this.peers=[],this._exiting=!1,this._locks=[],this._requests=new Map,this._eventsEnabled=!0,this._nodeLocker=new fm(e.debug,e.settings.lockTimeout),e.on("subscribe",i=>{if(e.debug.verbose(`database subscription being added on peer ${this.id}`),this.remoteSubscriptions.find(a=>a.callback===i.callback))return;const o=this.ourSubscriptions.some(a=>a.event===i.event&&a.path===i.path);if(this.ourSubscriptions.push(i),o)return;const s={type:"subscribe",from:this.id,data:{path:i.path,event:i.event}};this.sendMessage(s)}),e.on("unsubscribe",i=>{const o=this.remoteSubscriptions.find(s=>s.callback===i.callback);if(o){this.remoteSubscriptions.splice(this.remoteSubscriptions.indexOf(o),1);return}this.ourSubscriptions.filter(s=>s.path===i.path&&(!i.event||s.event===i.event)&&(!i.callback||s.callback===i.callback)).forEach(s=>{this.ourSubscriptions.splice(this.ourSubscriptions.indexOf(s),1);const a={type:"unsubscribe",from:this.id,data:{path:s.path,event:s.event}};this.sendMessage(a)})})}exit(e=0){return V(this,null,function*(){if(this._exiting)return this.once("exit");this._exiting=!0,this.storage.debug.warn(`Received ${this.isMaster?"master":"worker "+this.id} process exit request`),this._locks.length>0&&(this.storage.debug.warn(`Waiting for ${this.isMaster?"master":"worker"} ${this.id} locks to clear`),yield this.once("locks-cleared")),this.sayGoodbye(this.id),this.storage.debug.warn(`${this.isMaster?"Master":"Worker "+this.id} will now exit`),this.emitOnce("exit",e)})}sayGoodbye(e){const t={type:"bye",from:e,data:void 0};this.sendMessage(t)}addPeer(e,t=!0){if(!this._exiting&&(this.peers.find(r=>r.id===e)||this.peers.push({id:e,lastSeen:Date.now()}),t)){const r={type:"hello",from:this.id,to:e,data:void 0};this.sendMessage(r),this.ourSubscriptions.forEach(i=>{const o={type:"subscribe",from:this.id,to:e,data:{path:i.path,event:i.event}};this.sendMessage(o)})}}removePeer(e,t=!1){if(this._exiting)return;const r=this.peers.find(i=>i.id===e);if(!r){if(!t)throw new Error("We are supposed to know this peer!");return}this.peers.splice(this.peers.indexOf(r),1),this.remoteSubscriptions.filter(i=>i.for===e).forEach(i=>{this.remoteSubscriptions.splice(this.remoteSubscriptions.indexOf(i),1),this.storage.subscriptions.remove(i.path,i.event,i.callback)})}addRemoteSubscription(e,t){if(this._exiting||this.remoteSubscriptions.some(i=>i.for===e&&i.event===t.event&&i.path===t.path))return;const r=(i,o,s,a,c)=>{const l={type:"event",from:this.id,to:e,path:t.path,event:t.event,data:{path:o,val:s,previous:a,context:c}};this.sendMessage(l)};this.remoteSubscriptions.push({for:e,event:t.event,path:t.path,callback:r}),this.storage.subscriptions.add(t.path,t.event,r)}cancelRemoteSubscription(e,t){const r=this.remoteSubscriptions.find(i=>i.for===e&&i.event===t.event&&i.path===t.event);!r||this.storage.subscriptions.remove(t.path,t.event,r.callback)}handleMessage(e){return V(this,null,function*(){switch(e.type){case"hello":return this.addPeer(e.from,e.to!==this.id);case"bye":return this.removePeer(e.from,!0);case"subscribe":return this.addRemoteSubscription(e.from,e.data);case"unsubscribe":return this.cancelRemoteSubscription(e.from,e.data);case"event":{if(!this._eventsEnabled)break;const t=e,r=t.data.context||{};r.acebase_ipc={type:this.ipcType,origin:t.from},this.ourSubscriptions.filter(i=>i.event===t.event&&i.path===t.path).forEach(i=>{i.callback(null,t.data.path,t.data.val,t.data.previous,r)});break}case"lock-request":{if(!this.isMaster)throw new Error("Workers are not supposed to receive lock requests!");const t=e,r={type:"lock-result",id:t.id,from:this.id,to:t.from,ok:!0,data:void 0};try{const i=yield this.lock(t.data);r.data={id:i.id,path:i.path,tid:i.tid,write:i.forWriting,expires:i.expires,comment:i.comment}}catch(i){r.ok=!1,r.reason=i.stack||i.message||i}return this.sendMessage(r)}case"lock-result":{if(this.isMaster)throw new Error("Masters are not supposed to receive results for lock requests!");const t=e,r=this._requests.get(t.id);if(typeof r!="object")throw new Error("The request must be known to us!");t.ok?r.resolve(t.data):r.reject(new Error(t.reason));return}case"unlock-request":{if(!this.isMaster)throw new Error("Workers are not supposed to receive unlock requests!");const t=e,r={type:"unlock-result",id:t.id,from:this.id,to:t.from,ok:!0,data:{id:t.data.id}};try{yield this._locks.find(i=>{var o;return((o=i.lock)==null?void 0:o.id)===t.data.id}).lock.release()}catch(i){r.ok=!1,r.reason=i.stack||i.message||i}return this.sendMessage(r)}case"unlock-result":{if(this.isMaster)throw new Error("Masters are not supposed to receive results for unlock requests!");const t=e,r=this._requests.get(t.id);if(typeof r!="object")throw new Error("The request must be known to us!");t.ok?r.resolve(t.data):r.reject(new Error(t.reason));return}case"move-lock-request":{if(!this.isMaster)throw new Error("Workers are not supposed to receive move lock requests!");const t=e,r={type:"lock-result",id:t.id,from:this.id,to:t.from,ok:!0,data:void 0};try{let i;const o=this._locks.find(s=>{var a;return((a=s.lock)==null?void 0:a.id)===t.data.id});if(t.data.move_to==="parent")i=yield o.lock.moveToParent();else throw new Error(`Unknown lock move_to "${t.data.move_to}"`);o.lock=i,r.data={id:i.id,path:i.path,tid:i.tid,write:i.forWriting,expires:i.expires,comment:i.comment}}catch(i){r.ok=!1,r.reason=i.stack||i.message||i}return this.sendMessage(r)}case"notification":return this.emit("notification",e);case"request":return this.emit("request",e);case"result":{const t=e,r=this._requests.get(t.id);if(typeof r!="object")throw new Error("Result of unknown request received");t.ok?r.resolve(t.data):r.reject(new Error(t.reason))}}})}lock(e){return V(this,null,function*(){if(this._exiting&&!this._locks.find(r=>r.tid===e.tid&&r.granted))throw new GE("new transaction lock denied because the IPC peer is exiting");const t=r=>{this._locks.splice(this._locks.indexOf(r),1),this._locks.length===0&&this.emit("locks-cleared")};if(this.isMaster){const r={tid:e.tid,granted:!1,request:e,lock:null};this._locks.push(r);const i=yield this._nodeLocker.lock(e.path,e.tid,e.write,e.comment);r.tid=i.tid,r.granted=!0;const o=s=>({get id(){return s.id},get tid(){return s.tid},get path(){return s.path},get forWriting(){return s.forWriting},get expires(){return s.expires},get comment(){return s.comment},get state(){return s.state},release:()=>V(this,null,function*(){yield s.release(),t(r)}),moveToParent:()=>V(this,null,function*(){const a=yield s.moveToParent();return r.lock=o(a),r.lock})});return r.lock=o(i),r.lock}else{const r={tid:e.tid,granted:!1,request:e,lock:null};this._locks.push(r);const i=c=>(r.granted=!0,r.tid=c.tid,r.lock={id:c.id,tid:c.tid,path:c.path,forWriting:c.write,state:Xt.LOCKED,expires:c.expires,comment:c.comment,release:()=>V(this,null,function*(){const l={type:"unlock-request",id:Ft.generate(),from:this.id,to:this.masterPeerId,data:{id:r.lock.id}};yield this.request(l),r.lock.state=Xt.DONE,this.storage.debug.verbose(`Worker ${this.id} released lock ${r.lock.id} (tid ${r.lock.tid}, ${r.lock.comment}, "/${r.lock.path}", ${r.lock.forWriting?"write":"read"})`),t(r)}),moveToParent:()=>V(this,null,function*(){const l={type:"move-lock-request",id:Ft.generate(),from:this.id,to:this.masterPeerId,data:{id:r.lock.id,move_to:"parent"}};let u;try{u=yield this.request(l)}catch(h){throw r.lock.state=Xt.DONE,t(r),h}return r.lock=i(u),r.lock})},r.lock),o={type:"lock-request",id:Ft.generate(),from:this.id,to:this.masterPeerId,data:e};let s,a;try{s=yield this.request(o)}catch(c){a=c,s=null}if(a)throw t(r),a;return i(s)}})}request(e){return V(this,null,function*(){let t,r;const i=new Promise((o,s)=>{t=a=>{this._requests.delete(e.id),o(a)},r=a=>{this._requests.delete(e.id),s(a)}});return this._requests.set(e.id,{resolve:t,reject:r,request:e}),this.sendMessage(e),i})}sendRequest(e){const t={type:"request",from:this.id,to:this.masterPeerId,id:Ft.generate(),data:e};return this.request(t).catch(r=>{throw this.storage.debug.error(r),r})}replyRequest(e,t){const r={type:"result",id:e.id,ok:!0,from:this.id,to:e.from,data:t};this.sendMessage(r)}sendNotification(e){const t={type:"notification",from:this.id,data:e};this.sendMessage(t)}get eventsEnabled(){return this._eventsEnabled}set eventsEnabled(e){this.storage.debug.log(`ipc events ${e?"enabled":"disabled"}`),this._eventsEnabled=e}}class ZE extends XE{constructor(e){if(super(e,Ft.generate()),this.masterPeerId=this.id,this.ipcType="browser.bcc",window.addEventListener("beforeunload",()=>{this.exit()}),typeof window.BroadcastChannel!="undefined")this.channel=new BroadcastChannel(`acebase:${e.name}`);else{const r=[null],i=()=>{throw new Error("Not implemented")};this.channel={name:`acebase:${e.name}`,postMessage:o=>{const s=Ft.generate(),a=`acebase:${e.name}:${this.id}:${s}`,c=JSON.stringify(hm(o));localStorage.setItem(a,c),setTimeout(()=>localStorage.removeItem(a),10)},set onmessage(o){r[0]=o},set onmessageerror(o){i()},close(){i()},addEventListener(o,s){o!=="message"&&i(),r.push(s)},removeEventListener(o,s){const a=r.indexOf(s);a>=1&&r.splice(a,1)},dispatchEvent(o){return r.forEach(s=>{try{s&&s(o)}catch(a){console.error(a)}}),!0}},window.addEventListener("storage",o=>{const[s,a,c,l]=o.key.split(":");if(s!=="acebase"||a!==e.name||c===this.id||o.newValue===null)return;const u=DE(JSON.parse(o.newValue));this.channel.dispatchEvent({data:u})})}this.channel.addEventListener("message",r=>V(this,null,function*(){const i=r.data;if(!(i.to&&i.to!==this.id)){if(e.debug.verbose("[BroadcastChannel] received: ",i),i.type==="hello"&&i.from<this.masterPeerId)this.masterPeerId=i.from,e.debug.log(`[BroadcastChannel] Tab ${this.masterPeerId} is the master.`);else if(i.type==="bye"&&i.from===this.masterPeerId){e.debug.log(`[BroadcastChannel] Master tab ${this.masterPeerId} is leaving`);const o=this.peers.map(a=>a.id).concat(this.id).filter(a=>a!==this.masterPeerId);this.masterPeerId=o.sort()[0],e.debug.log(`[BroadcastChannel] ${this.masterPeerId===this.id?"We are":`tab ${this.masterPeerId} is`} the new master. Requesting ${this._locks.length} locks (${this._locks.filter(a=>!a.granted).length} pending)`);const s=this._locks.splice(0);yield Promise.all(s.filter(a=>a.granted).map(a=>V(this,null,function*(){let c,l;a.lock.release=()=>new Promise(h=>c=h),a.lock.moveToParent=()=>new Promise(h=>l=h);const u=yield this.lock({path:a.lock.path,write:a.lock.forWriting,tid:a.lock.tid,comment:a.lock.comment});if(l){const h=yield u.moveToParent();l(h)}c&&(yield u.release(),c())}))),yield Promise.all(s.filter(a=>!a.granted).map(a=>V(this,null,function*(){yield this.lock(a.request)})))}return this.handleMessage(i)}}));const t={type:"hello",from:this.id,data:void 0};this.sendMessage(t)}sendMessage(e){this.storage.debug.verbose("[BroadcastChannel] sending: ",e),this.channel.postMessage(e)}}class Bo{static get hasFileSystem(){return!1}static get fs(){return null}}class Xh extends nn{}class pm extends nn{}class QE extends nn{}class e_ extends nn{}function t_(n,e,t,r){return V(this,null,function*(){if(!n.storage.indexes.supported)throw new Error("Indexes are not supported in current environment because it requires Node.js fs");const{ipc:i,debug:o,indexes:s,storage:a}=n,c=r&&r.rebuild===!0,l=r&&r.type||"normal";let u=r&&r.include||[];typeof u=="string"&&(u=[u]);const h=s.find(d=>d.path===e&&d.key===t&&d.type===l&&d.includeKeys.length===u.length&&d.includeKeys.every((f,g)=>u[g]===f));if(h&&r.config&&(h.config=r.config),h&&c!==!0)return o.log(`Index on "/${e}/*/${t}" already exists`.colorize(At.inverse)),h;if(!i.isMaster){const d=yield i.sendRequest({type:"index.create",path:e,key:t,options:r});if(d.ok)return a.indexes.add(d.fileName);throw new Error(d.reason)}yield Bo.mkdir(`${a.settings.path}/${a.name}.acebase`).catch(d=>{if(d.code!=="EEXIST")throw d});const y=h||(()=>{const{include:d,caseSensitive:f,textLocale:g,textLocaleKey:_}=r,A={include:d,caseSensitive:f,textLocale:g,textLocaleKey:_};switch(l){case"array":return new e_(a,e,t,X({},A));case"fulltext":return new pm(a,e,t,qe(X({},A),{config:r.config}));case"geo":return new QE(a,e,t,X({},A));default:return new Xh(a,e,t,X({},A))}})();h||s.push(y);try{yield y.build()}catch(d){throw n.debug.error(`Index build on "/${e}/*/${t}" failed: ${d.message} (code: ${d.code})`.colorize(At.red)),h||s.splice(s.indexOf(y),1),d}return i.sendNotification({type:"index.created",fileName:y.fileName,path:e,key:t,options:r}),y})}const{compareValues:Ks,getChildValues:pi,encodeString:wp,defer:n_}=tm,Ou=["value","child_added","child_changed","child_removed","mutated","mutations"];Ou.push(...Ou.map(n=>`notify_${n}`));const r_=()=>{};class i_ extends Error{constructor(e){super(`Schema validation failed: ${e}`),this.reason=e}}class Zh{constructor(e={}){this.maxInlineValueSize=50,this.removeVoidProperties=!1,this.path=".",this.lockTimeout=120,this.type="data",this.readOnly=!1,typeof e.maxInlineValueSize=="number"&&(this.maxInlineValueSize=e.maxInlineValueSize),typeof e.removeVoidProperties=="boolean"&&(this.removeVoidProperties=e.removeVoidProperties),typeof e.path=="string"&&(this.path=e.path),this.path.endsWith("/")&&(this.path=this.path.slice(0,-1)),typeof e.lockTimeout=="number"&&(this.lockTimeout=e.lockTimeout),typeof e.type=="string"&&(this.type=e.type),typeof e.readOnly=="boolean"&&(this.readOnly=e.readOnly),["object","string"].includes(typeof e.ipc)&&(this.ipc=e.ipc)}}class o_ extends oo{createTid(){return Ft.generate()}constructor(e,t,r){super(),this.name=e,this.settings=t,this._schemas=[],this._indexes=[],this._annoucedIndexes=new Map,this.indexes={get supported(){return Bo==null?void 0:Bo.hasFileSystem},create:(o,s,a={rebuild:!1})=>{const c={storage:this,debug:this.debug,indexes:this._indexes,ipc:this.ipc};return t_(c,o,s,a)},get:(o,s=null)=>{if(o.includes("$")){const a=J.getPathKeys(o).map(c=>typeof c=="string"&&c.startsWith("$")?"*":c);o=new J(a).path}return this._indexes.filter(a=>a.path===o&&(s===null||s===a.key))},getAll:(o,s={parentPaths:!0,childPaths:!0})=>{const a=J.getPathKeys(o);return this._indexes.filter(c=>{const l=J.getPathKeys(c.path+"/*");return s.parentPaths&&l.every((u,h)=>u==="*"||a[h]===u)&&[c.key].concat(...c.includeKeys).includes(a[l.length])?!0:l.length<a.length||!s.childPaths&&l.length!==a.length?!1:a.every((u,h)=>[u,"*"].includes(l[h]))})},list:()=>this._indexes.slice(),load:()=>V(this,null,function*(){if(this._indexes.splice(0),!Bo.hasFileSystem)return;let o=[];try{o=yield Bo.readdir(`${this.settings.path}/${this.name}.acebase`)}catch(a){a.code!=="ENOENT"&&this.debug.error(a)}const s=[];o.forEach(a=>{if(!a.endsWith(".idx"))return;const c=this.settings.type!=="data",l=/^\[[a-z]+\]-/.test(a);if(!c&&!l||c&&a.startsWith(`[${this.settings.type}]-`)){const u=this.indexes.add(a);s.push(u)}}),yield Promise.all(s)}),add:o=>V(this,null,function*(){const s=this._indexes.find(a=>a.fileName===o);if(s)return s;if(this._annoucedIndexes.has(o))return yield this._annoucedIndexes.get(o);try{const a=Xh.readFromFile(this,o);this._annoucedIndexes.set(o,a);const c=yield a;return this._indexes.push(c),this._annoucedIndexes.delete(o),c}catch(a){return this.debug.error(a),null}}),delete:o=>V(this,null,function*(){const s=yield this.indexes.remove(o);yield s.delete(),this.ipc.sendNotification({type:"index.deleted",fileName:s.fileName,path:s.path,keys:s.key})}),remove:o=>V(this,null,function*(){const s=this._indexes.find(a=>a.fileName===o);if(!s)throw new Error(`Index ${o} not found`);return this._indexes.splice(this._indexes.indexOf(s),1),s}),close:()=>V(this,null,function*(){const o=this.indexes.list().map(s=>s.close().catch(a=>this.debug.error(a)));yield Promise.all(o)})},this._eventSubscriptions={},this.subscriptions={add:(o,s,a)=>{if(Ou.indexOf(s)<0)throw new TypeError(`Invalid event type "${s}"`);let c=this._eventSubscriptions[o];c||(c=this._eventSubscriptions[o]=[]),c.push({created:Date.now(),type:s,callback:a}),this.emit("subscribe",{path:o,event:s,callback:a})},remove:(o,s,a)=>{const c=this._eventSubscriptions[o];if(!c)return;const l=()=>c.findIndex(h=>(s?h.type===s:!0)&&(a?h.callback===a:!0));let u;for(;(u=l())>=0;)c.splice(u,1);this.emit("unsubscribe",{path:o,event:s,callback:a})},hasValueSubscribersForPath(o){return!!this.getValueSubscribersForPath(o)},getValueSubscribersForPath:o=>{const s=new J(o),a=[];return Object.keys(this._eventSubscriptions).forEach(c=>{if(s.equals(c)||s.isDescendantOf(c)){const l=this._eventSubscriptions[c],u=J.fillVariables(c,o);l.filter(h=>!h.type.startsWith("notify_")).forEach(h=>{let y=null;if(h.type==="value")y=u;else if(["mutated","mutations"].includes(h.type)&&s.isDescendantOf(u))y=o;else if(h.type==="child_changed"&&o!==u){const d=J.getPathKeys(o.slice(u.length).replace(/^\//,""))[0];y=J.getChildPath(u,d)}else if(["child_added","child_removed"].includes(h.type)&&s.isChildOf(u)){const d=J.getPathKeys(o.slice(u.length).replace(/^\//,""))[0];y=J.getChildPath(u,d)}y!==null&&!a.some(d=>d.type===h.type&&d.eventPath===u)&&a.push({type:h.type,eventPath:u,dataPath:y,subscriptionPath:c})})}}),a},getAllSubscribersForPath:o=>{const s=J.get(o),a=[];return Object.keys(this._eventSubscriptions).forEach(c=>{if(s.isOnTrailOf(c)){const l=this._eventSubscriptions[c],u=J.fillVariables(c,o);l.forEach(h=>{let y=null;if(h.type==="value"||h.type==="notify_value")y=u;else if(["child_changed","notify_child_changed"].includes(h.type)){const d=o===u||s.isAncestorOf(u)?"*":J.getPathKeys(o.slice(u.length).replace(/^\//,""))[0];y=J.getChildPath(u,d)}else if(["mutated","mutations","notify_mutated","notify_mutations"].includes(h.type))y=o;else if(["child_added","child_removed","notify_child_added","notify_child_removed"].includes(h.type)&&(s.isChildOf(u)||o===u||s.isAncestorOf(u))){const d=o===u||s.isAncestorOf(u)?"*":J.getPathKeys(o.slice(u.length).replace(/^\//,""))[0];y=J.getChildPath(u,d)}y!==null&&!a.some(d=>d.type===h.type&&d.eventPath===u&&d.subscriptionPath===c)&&a.push({type:h.type,eventPath:u,dataPath:y,subscriptionPath:c})})}}),a},trigger:(o,s,a,c,l,u)=>{(this._eventSubscriptions[s]||[]).filter(h=>h.type===o).forEach(h=>{h.callback(null,a,l,c,u)})}},this.debug=new am(r.logLevel,`[${e}${typeof t.type=="string"&&t.type!=="data"?`:${t.type}`:""}]`);const i=e+(typeof t.type=="string"?`_${t.type}`:"");if(t.ipc==="socket"||t.ipc instanceof nn){const o={ipcName:i,server:t.ipc instanceof nn?t.ipc:null};this.ipc=new nn(this,o)}else if(t.ipc){if(typeof t.ipc.port!="number")throw new Error("IPC port number must be a number");if(!["master","worker"].includes(t.ipc.role))throw new Error(`IPC client role must be either "master" or "worker", not "${t.ipc.role}"`);const o=Object.assign({dbname:i},t.ipc);this.ipc=new nn(this,o)}else this.ipc=new ZE(this,i);this.ipc.once("exit",o=>{this.indexes.supported&&this.indexes.close()}),this.nodeLocker={lock:(o,s,a,c)=>this.ipc.lock({path:o,tid:s,write:a,comment:c})},this._lastTid=0}close(){return V(this,null,function*(){yield this.ipc.exit()})}get path(){return`${this.settings.path}/${this.name}.acebase`}valueFitsInline(e){if(typeof e=="number"||typeof e=="boolean"||e instanceof Date)return!0;if(typeof e=="string")return e.length>this.settings.maxInlineValueSize?!1:wp(e).length<this.settings.maxInlineValueSize;if(e instanceof rt)return e.path.length>this.settings.maxInlineValueSize?!1:wp(e.path).length<this.settings.maxInlineValueSize;if(e instanceof ArrayBuffer)return e.byteLength<this.settings.maxInlineValueSize;if(e instanceof Array)return e.length===0;if(typeof e=="object")return Object.keys(e).length===0;throw new TypeError("What else is there?")}_writeNode(e,t,r){throw new Error("This method must be implemented by subclass")}getUpdateImpact(e,t){let r=e,i=!1;const o=t?[]:this.subscriptions.getAllSubscribersForPath(e),s=t?[]:this.subscriptions.getValueSubscribersForPath(e);s.length>0&&(i=!0,r=s.map(l=>({path:l.dataPath,keys:J.getPathKeys(l.dataPath)})).sort((l,u)=>l.keys.length<u.keys.length?-1:l.keys.length>u.keys.length?1:0)[0].path,s.filter(l=>l.dataPath===r).every(l=>l.type==="mutated"||l.type.startsWith("notify_"))&&(i=!1),r=J.fillVariables(r,e));const a=this.indexes.getAll(e,{childPaths:!0,parentPaths:!0}).map(l=>({index:l,keys:J.getPathKeys(l.path)})).sort((l,u)=>l.keys.length<u.keys.length?-1:l.keys.length>u.keys.length?1:0).map(l=>l.index),c=[];if(a.length>0){a.sort((h,y)=>(typeof h._pathKeys=="undefined"&&(h._pathKeys=J.getPathKeys(h.path)),typeof y._pathKeys=="undefined"&&(y._pathKeys=J.getPathKeys(y.path)),h._pathKeys.length<y._pathKeys.length?-1:h._pathKeys.length>y._pathKeys.length?1:0));const l=a[0],u=l.path===e?e:J.fillVariables(`${l.path}/*`,e);u.length<r.length&&(r=u,a.filter(h=>h.path===l.path).forEach(h=>{[h.key].concat(h.includeKeys).forEach(y=>!c.includes(y)&&c.push(y))}))}return{topEventPath:r,eventSubscriptions:o,valueSubscribers:s,hasValueSubscribers:i,indexes:a,keysFilter:c}}_writeNodeWithTracking(e,t){return V(this,arguments,function*(r,i,o={merge:!1,waitForIndexUpdates:!0,suppress_events:!1,context:null,impact:null}){if(o=o||{},!o.tid&&!o.transaction)throw new Error("_writeNodeWithTracking MUST be executed with a tid OR transaction!");o.merge=o.merge===!0;const s=this.validateSchema(r,i,{updates:o.merge});if(!s.ok)throw new i_(s.reason);const a=o.tid,c=o.transaction;let l=null;const u=o.impact?o.impact:this.getUpdateImpact(r,o.suppress_events),{topEventPath:h,eventSubscriptions:y,hasValueSubscribers:d,indexes:f}=u;let{keysFilter:g}=u;const _=()=>{if(typeof o._customWriteFunction=="function")return o._customWriteFunction();if(l){const O=J.getPathKeys(r),p=J.getPathKeys(h),v=O.slice(p.length);let m=l;for(;v.length>0&&m!==null;){const w=v.shift();m=typeof m=="object"&&w in m?m[w]:null}o.currentValue=m}return this._writeNode(r,i,o)},A=this.settings.transactions&&this.settings.transactions.log===!0;if(y.length===0&&f.length===0&&!A)return _();if(!d&&o.merge===!0&&g.length===0&&(g=Object.keys(i),h!==r)){const O=r.slice(h.length);g=g.map(p=>`${O}/${p}`)}const P=yield this.getNodeInfo(h,{transaction:c,tid:a});let B=null;if(P.exists){const O={transaction:c,tid:a};g.length>0&&(O.include=g),h===""&&typeof O.include=="undefined"&&this.debug.warn('WARNING: One or more value event listeners on the root node are causing the entire database value to be read to facilitate change tracking. Using "value", "notify_value", "child_changed" and "notify_child_changed" events on the root node are a bad practice because of the significant performance impact. Use "mutated" or "mutations" events instead'),B=(yield this.getNode(h,O)).value}l=B;const C=(yield _())||{};let L,q;if(r===h)o.merge?l===null?L=i instanceof Array?[]:{}:(L=l instanceof Array?[]:{},Object.keys(l).forEach(O=>{L[O]=l[O]})):L=i,q=L;else{const O=r.slice(h.length).replace(/^\//,""),p=J.getPathKeys(O);for(l===null?L=typeof p[0]=="number"?[]:{}:(L=l instanceof Array?[]:{},Object.keys(l).forEach(v=>{L[v]=l[v]})),q=L;p.length>0;){const v=p.shift();if(!o.merge&&p.length===0)q[v]=i;else{const m=q[v],w=typeof v=="number"?[...m]:X({},m);q[v]=w}q=q[v]}}o.merge&&Object.keys(i).forEach(O=>{q[O]=i[O]});const H=Ks(l,L);if(H==="identical")return C.mutations=[],C;function j(O){if(O===null||typeof O!="object")return O;Object.keys(O).forEach(p=>{const v=O[p];v===null&&(delete O[p],O instanceof Array&&O.length--),typeof v=="object"&&j(v)})}j(L);const I=[];f.map(O=>({index:O,keys:J.getPathKeys(O.path)})).sort((O,p)=>O.keys.length<p.keys.length?1:O.keys.length>p.keys.length?-1:0).forEach(({index:O})=>{const p=J.getPathKeys(h),v=J.getPathKeys(O.path+"/*"),m=v.slice(p.length),w=l,E=L;if(m.length===0){Gt(p.length===v.length,"check logic");const k=this.ipc.isMaster?O.handleRecordUpdate(h,w,E):this.ipc.sendRequest({type:"index.update",fileName:O.fileName,path:h,oldValue:w,newValue:E});I.push(k);return}const b=(k,x,$)=>{if(x===null&&$===null)return[];const S=J.getPathKeys(k),T=J.getPathKeys(O.path+"/*"),R=T.slice(S.length);if(R.length===0)return Gt(S.length===T.length,"check logic"),[{path:k,oldValue:x,newValue:$}];let N=[],z="";for(;R.length>0;){const F=R.shift();if(typeof F=="string"&&(F==="*"||F.startsWith("$"))){const ne=x===null?[]:Object.keys(x);$!==null&&Object.keys($).forEach(te=>{ne.indexOf(te)<0&&ne.push(te)}),ne.forEach(te=>{const pe=J.getChildPath(z,te),oe=pi(te,x,$),re=J.getChildPath(k,pe),ue=b(re,oe.oldValue,oe.newValue);N=N.concat(ue)});break}else{const ne=pi(F,x,$);if(x=ne.oldValue,$=ne.newValue,x===null&&$===null)break;z=J.getChildPath(z,F)}}return N};b(h,w,E).forEach(k=>{const x=this.ipc.isMaster?O.handleRecordUpdate(k.path,k.oldValue,k.newValue):this.ipc.sendRequest({type:"index.update",fileName:O.fileName,path:k.path,oldValue:k.oldValue,newValue:k.newValue});I.push(x)})});const D=(O,p,v,m=[])=>{let w=!0,E=O.type;if(E.startsWith("notify_")&&(E=E.slice(7)),E==="mutated"||(E==="child_changed"&&(p===null||v===null)?w=!1:E==="value"||E==="child_changed"?w=Ks(p,v)!=="identical":E==="child_added"?w=p===null&&v!==null:E==="child_removed"&&(w=p!==null&&v===null),!w))return;const b=J.getPathKeys(O.dataPath);m.forEach(x=>{const $=b.indexOf(x.name);Gt($>=0,`Variable "${x.name}" not found in subscription dataPath "${O.dataPath}"`),b[$]=x.value});const k=b.reduce((x,$)=>J.getChildPath(x,$),"");this.subscriptions.trigger(O.type,O.subscriptionPath,k,p,v,o.context)},M=(O,p,v,m)=>{const w=[],E=m||Ks(p,v);return E==="identical"||(typeof E=="string"?w.push({path:O,oldValue:p,newValue:v}):(E.changed.forEach(b=>{const k=J.getChildPath(O,b.key),x=pi(b.key,p,v),$=M(k,x.oldValue,x.newValue,b.change);w.push(...$)}),E.added.forEach(b=>{const k=J.getChildPath(O,b);w.push({path:k,oldValue:null,newValue:v[b]})}),p instanceof Array&&v instanceof Array&&E.removed.sort((b,k)=>b<k?1:-1),E.removed.forEach(b=>{const k=J.getChildPath(O,b);w.push({path:k,oldValue:p[b],newValue:null})}))),w};A&&this.settings.type!=="transaction"&&(C.mutations=(()=>{const O=r.slice(h.length).replace(/^\//,""),p=J.getPathKeys(O);let v=l,m=L;for(;p.length>0;){const E=p.shift();({oldValue:v,newValue:m}=pi(E,v,m))}const w=Ks(v,m);return M(r,v,m,w).map(E=>({target:J.getPathKeys(E.path.slice(r.length)),prev:E.oldValue,val:E.newValue}))})());const U=()=>{y.filter(O=>!["mutated","mutations","notify_mutated","notify_mutations"].includes(O.type)).map(O=>{const p=J.getPathKeys(O.dataPath);return{sub:O,keys:p}}).sort((O,p)=>O.keys.length<p.keys.length?1:O.keys.length>p.keys.length?-1:0).forEach(({sub:O})=>{const p=(v,m,w,E=[])=>{const b=O.dataPath.slice(v.length).replace(/^\//,""),k=J.getPathKeys(b);for(;k.length>0;){const x=k.shift();if(typeof x=="string"&&(x==="*"||x[0]==="$")){const $=m===null?[]:Object.keys(m).map(S=>m instanceof Array?parseInt(S):S);w!==null&&Object.keys(w).forEach(S=>{const T=w instanceof Array?parseInt(S):S;!$.includes(T)&&$.push(S)}),$.forEach(S=>{const T=pi(S,m,w),R=E.concat({name:x,value:S});k.length===0?D(O,T.oldValue,T.newValue,R):p(J.getChildPath(v,x),T.oldValue,T.newValue,R)});return}else{v=J.getChildPath(v,x);const $=pi(x,m,w);m=$.oldValue,w=$.newValue}}D(O,m,w,E)};if(O.type.startsWith("notify_")&&J.get(O.eventPath).isAncestorOf(h)){const v=J.get(O.eventPath).isParentOf(h);(O.type==="notify_value"||O.type==="notify_child_changed"&&(!v||!["added","removed"].includes(H))||O.type==="notify_child_removed"&&H==="removed"&&v||O.type==="notify_child_added"&&H==="added"&&v)&&this.subscriptions.trigger(O.type,O.subscriptionPath,O.dataPath,null,null,o.context)}else p(h,l,L)}),y.filter(O=>["mutated","mutations","notify_mutated","notify_mutations"].includes(O.type)).forEach(O=>{let p=h;const v=O.eventPath.slice(p.length).replace(/^\//,""),m=J.getPathKeys(v);let w=l,E=L;for(;m.length>0;){const x=m.shift();p=J.getChildPath(p,x);const $=pi(x,w,E);w=$.oldValue,E=$.newValue}const b=M(p,w,E);if(b.length===0)return;const k=O.type.startsWith("notify_");if(["mutated","notify_mutated"].includes(O.type))b.forEach((x,$)=>{const S=o.context,T=k?null:x.oldValue,R=k?null:x.newValue;this.subscriptions.trigger(O.type,O.subscriptionPath,x.path,T,R,S)});else if(["mutations","notify_mutations"].includes(O.type)){const x=k?null:b.map($=>({target:J.getPathKeys($.path.slice(O.subscriptionPath.length)),prev:$.oldValue,val:$.newValue}));this.subscriptions.trigger(O.type,O.subscriptionPath,O.subscriptionPath,null,x,o.context)}})};return o.waitForIndexUpdates===!1&&I.splice(0),yield Promise.all(I),n_(U),C})}getChildren(e,t){throw new Error("This method must be implemented by subclass")}getNodeValue(e){return V(this,arguments,function*(t,r={}){return(yield this.getNode(t,r)).value})}getNode(e,t){throw new Error("This method must be implemented by subclass")}getNodeInfo(e,t){throw new Error("This method must be implemented by subclass")}setNode(e,t,r){throw new Error("This method must be implemented by subclass")}updateNode(e,t,r){throw new Error("This method must be implemented by subclass")}transactNode(e,t){return V(this,arguments,function*(r,i,o={no_lock:!1,suppress_events:!1,context:null}){const s=o&&o.no_lock===!0,a=this.createTid(),c=s?{tid:a,release:r_}:yield this.nodeLocker.lock(r,a,!0,"transactNode");try{let l=!1;const u=()=>{l=!0};s&&this.subscriptions.add(r,"notify_value",u);const h=yield this.getNode(r,{tid:a}),y=h.revision;let d;try{d=i(h.value),d instanceof Promise&&(d=yield d.catch(f=>{this.debug.error(`Error in transaction callback: ${f.message}`)}))}catch(f){this.debug.error(`Error in transaction callback: ${f.message}`)}if(typeof d=="undefined")return;if(s&&this.subscriptions.remove(r,"notify_value",u),l)throw new $u("Node changed");return yield this.setNode(r,d,{assert_revision:y,tid:c.tid,suppress_events:o.suppress_events,context:o.context})}catch(l){if(l instanceof $u)return console.warn(`node value changed, running again. Error: ${l.message}`),this.transactNode(r,i,o);throw l}finally{c.release()}})}matchNode(e,t,r){return V(this,null,function*(){var i;const o=(i=r==null?void 0:r.tid)!=null?i:Ft.generate(),s=(c,l)=>V(this,null,function*(){if(l.length===0)return Promise.resolve(!0);const u=l.reduce((f,g)=>{let _=g.key;return typeof _=="string"&&_.includes("/")&&(_=_.slice(0,_.indexOf("/"))),f.indexOf(_)<0&&f.push(_),f},[]),h=u.slice();let y=!0;const d=[];try{return yield this.getChildren(c,{tid:o,keyFilter:u}).next(f=>{var g;const _=(g=f.key)!=null?g:f.index;h.includes(_)&&h.splice(h.indexOf(f.key),1);const A=l.filter(B=>B.key===_).map(B=>({op:B.op,compare:B.compare})),P=A.length>0?a(f,A):{isMatch:!0,promises:[]};if(y=P.isMatch,y){d.push(...P.promises);const B=l.filter(C=>typeof C.key=="string"&&C.key.startsWith(`${typeof _=="number"?`[${_}]`:_}/`)).map(C=>({key:C.key.slice(C.key.indexOf("/")+1),op:C.op,compare:C.compare}));if(B.length>0){const C=J.getChildPath(c,f.key),L=s(C,B).then(q=>({isMatch:q}));d.push(L)}}if(!y||h.length===0)return!1}),y&&(y=(yield Promise.all(d)).every(f=>f.isMatch)),y?(y=h.every(f=>{const g=new dm(qe(X(X({},typeof f=="number"&&{index:f}),typeof f=="string"&&{key:f}),{exists:!1})),_=l.filter(P=>typeof P.key=="string"&&P.key.startsWith(`${typeof f=="number"?`[${f}]`:f}/`)).map(P=>({op:P.op,compare:P.compare}));if(_.length>0&&!a(g,_).isMatch)return!1;const A=l.filter(P=>P.key===f).map(P=>({op:P.op,compare:P.compare}));return A.length===0?!0:a(g,A).isMatch}),y):!1}catch(f){throw this.debug.error(`Error matching on "${c}": `,f),f}}),a=(c,l)=>{const u=[];return{isMatch:l.every(h=>{let y=!0;if(h.op==="!exists"||h.op==="=="&&(typeof h.compare=="undefined"||h.compare===null))y=!c.exists;else if(h.op==="exists"||h.op==="!="&&(typeof h.compare=="undefined"||h.compare===null))y=c.exists;else if((h.op==="contains"||h.op==="!contains")&&h.compare instanceof Array&&h.compare.length===0)y=!0;else if(!c.exists)y=!1;else if(c.address)if(c.valueType===ae.OBJECT&&["has","!has"].indexOf(h.op)>=0){const d=h.op==="has"?"exists":"!exists",f=s(c.path,[{key:h.compare,op:d}]).then(g=>({key:c.key,isMatch:g}));u.push(f),y=!0}else if(c.valueType===ae.ARRAY&&["contains","!contains"].indexOf(h.op)>=0){const d=this.getNode(c.path,{tid:o}).then(({value:f})=>{const g=h.op==="contains"?h.compare instanceof Array?h.compare.every(_=>f.includes(_)):f.includes(h.compare):h.compare instanceof Array?!h.compare.some(_=>f.includes(_)):!f.includes(h.compare);return{key:c.key,isMatch:g}});u.push(d),y=!0}else if(c.valueType===ae.STRING){const d=this.getNode(c.path,{tid:o}).then(f=>({key:c.key,isMatch:this.test(f.value,h.op,h.compare)}));u.push(d),y=!0}else y=!1;else if(c.type===ae.OBJECT&&["has","!has"].indexOf(h.op)>=0){const d=h.compare in c.value;y=d&&h.op==="has"||!d&&h.op==="!has"}else if(c.type===ae.ARRAY&&["contains","!contains"].indexOf(h.op)>=0){const d=c.value.indexOf(h.compare)>=0;y=d&&h.op==="contains"||!d&&h.op==="!contains"}else{let d=this.test(c.value,h.op,h.compare);d instanceof Promise&&(u.push(d),d=!0),y=d}return y}),promises:u}};return s(e,t)})}test(e,t,r){if(t==="<")return e<r;if(t==="<=")return e<=r;if(t==="==")return e===r;if(t==="!=")return e!==r;if(t===">")return e>r;if(t===">=")return e>=r;if(t==="in")return r.indexOf(e)>=0;if(t==="!in")return r.indexOf(e)<0;if(t==="like"||t==="!like"){const i="^"+r.replace(/[-[\]{}()+.,\\^$|#\s]/g,"\\$&").replace(/\?/g,".").replace(/\*/g,".*?")+"$",o=new RegExp(i,"i").test(e.toString());return t==="like"?o:!o}if(t==="matches")return r.test(e.toString());if(t==="!matches")return!r.test(e.toString());if(t==="between")return e>=r[0]&&e<=r[1];if(t==="!between")return e<r[0]||e>r[1];if(t==="has"||t==="!has"){const i=typeof e=="object"&&r in e;return t==="has"?i:!i}if(t==="contains"||t==="!contains"){const i=typeof e=="object"&&e instanceof Array&&e.includes(r);return t==="contains"?i:!i}return!1}exportNode(e,t){return V(this,arguments,function*(r,i,o={format:"json",type_safe:!0}){if((o==null?void 0:o.format)!=="json")throw new Error("Only json output is currently supported");const s=typeof i!="function"?i.write.bind(i):i,a=(f,g)=>{const _=A=>A.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/[\u0000-\u001f]/g,P=>`\\u${P.charCodeAt(0).toString(16).padStart(4,"0")}`);return f===ae.DATETIME?(g=`"${g.toISOString()}"`,o.type_safe&&(g=`{".type":"date",".val":${g}}`)):f===ae.STRING?g=`"${_(g)}"`:f===ae.ARRAY?g="[]":f===ae.OBJECT?g="{}":f===ae.BINARY?(g=`"${_(br.encode(g))}"`,o.type_safe&&(g=`{".type":"binary",".val":${g}}`)):f===ae.REFERENCE?(g=`"${g.path}"`,o.type_safe&&(g=`{".type":"reference",".val":${g}}`)):f===ae.BIGINT&&(g=`"${g}"`,o.type_safe&&(g=`{".type":"bigint",".val":${g}}`)),g};let c="",l="";const u=yield this.getNodeInfo(r);if(u.exists)if(u.type===ae.OBJECT)c="{",l="}";else if(u.type===ae.ARRAY)c="[",l="]";else{const f=yield this.getNode(r),g=a(u.type,f.value);return s(g)}else return s("null");if(c){const f=s(c);f instanceof Promise&&(yield f)}let h="",y=0;const d=[];if(yield this.getChildren(r).next(f=>{f.address?d.push(f):(y++>0&&(h+=","),typeof f.key=="string"&&(h+=`"${f.key}":`),h+=a(f.type,f.value))}),h){const f=s(h);f instanceof Promise&&(yield f)}for(;d.length>0;){const f=d.shift();let g=y++>0?",":"";const _=typeof f.index=="number"?f.index:f.key;if(typeof _=="string"&&(g+=`"${_}":`),g){const A=s(g);A instanceof Promise&&(yield A)}yield this.exportNode(J.getChildPath(r,_),s,o)}if(l){const f=s(l);f instanceof Promise&&(yield f)}})}importNode(e,t){return V(this,arguments,function*(r,i,o={format:"json",method:"set"}){const s={data:"",index:0,offset:0,queue:[],queueStartByte:0,timesFlushed:0,get processedBytes(){return this.offset+this.index}},a=(j=!1)=>V(this,null,function*(){let I=yield i(262144);if(I===null)throw s.data?new Error(`Unexpected EOF at index ${s.offset+s.data.length}`):new Error("Unable to read data from stream");typeof I=="object"&&(I=Xg(I)),j?s.data+=I:(s.offset+=s.data.length,s.data=I,s.index=0)}),c=j=>V(this,null,function*(){let I="";return s.index+j>=s.data.length&&(I=s.data.slice(s.index),j-=I.length,yield a()),I+=s.data.slice(s.index,s.index+j),s.index+=j,I}),l=j=>V(this,null,function*(){if(s.index+j>s.data.length&&(yield a(!0)),s.index+j>s.data.length)throw new Error("Not enough data available from stream")}),u=j=>V(this,null,function*(){const I=yield c(j.length);if(I!==j)throw new Error(`Unexpected character "${I[0]}" at index ${s.offset+s.index}, expected "${j}"`)}),h=()=>V(this,null,function*(){const j=[" ","	","\r",`
`];for(;s.index>=s.data.length&&(yield a()),j.includes(s.data[s.index]);)s.index++}),y=j=>V(this,null,function*(){yield l(j);const I=s.index;return s.data.slice(I,I+j)}),d=()=>V(this,null,function*(){yield h();const j=yield y(1);switch(j){case'"':return"string";case"{":return"object";case"[":return"array";case"n":return"null";case"u":return"undefined";case"t":case"f":return"boolean";default:{if(j==="-"||j>="0"&&j<="9")return"number";throw new Error(`Unknown value at index ${s.offset+s.index}`)}}}),f=()=>V(this,null,function*(){yield u('"');let j="",I=s.index;for(;s.data[I]!=='"'||s.data[I-1]==="\\";)I++,I>=s.data.length&&(j+=s.data.slice(s.index),yield a(),I=0);return j+=s.data.slice(s.index,I),s.index=I+1,P(j)}),g=()=>V(this,null,function*(){throw s.data[s.index]==="t"?yield u("true"):s.data[s.index]==="f"&&(yield u("false")),new Error(`Expected true or false at index ${s.offset+s.index}`)}),_=()=>V(this,null,function*(){let j="",I=s.index;const D=["-","0","1","2","3","4","5","6","7","8","9",".","e","b","f","x","o","n"];for(;D.includes(s.data[I]);)I++,I>=s.data.length&&(j+=s.data.slice(s.index),yield a(),I=0);return j+=s.data.slice(s.index,I),s.index=I,j.endsWith("n")?BigInt(j.slice(0,-1)):j.includes(".")?parseFloat(j):parseInt(j)}),A=()=>V(this,null,function*(){yield h();const j=yield d(),I=yield(()=>{switch(j){case"string":return f();case"object":return{};case"array":return[];case"number":return _();case"null":return null;case"undefined":return;case"boolean":return g()}})();return{type:j,value:I}}),P=j=>j.replace(/\\n/g,`
`).replace(/\\"/g,'"'),B=(j,I)=>{const D=I[".type"];let M=I[".val"];switch(D){case"Date":case"date":{M=new Date(M);break}case"Buffer":case"binary":{if(M=P(M),M.startsWith("<~"))M=br.decode(M);else throw new Error(`Import error: Unexpected encoding for value for value at path "/${j}"`);break}case"PathReference":case"reference":{M=new rt(M);break}case"bigint":{M=BigInt(M);break}default:throw new Error(`Import error: Unsupported type "${D}" for value at path "/${j}"`)}return M},C={acebase_import_id:Ft.generate()},L={suppress_events:o.suppress_events,context:C},q=j=>V(this,null,function*(){if(yield u("{"),yield h(),(yield y(1))==="}")return s.index++,this.setNode(j.path,{},L);let I=0,D={},M=!1;const U=()=>V(this,null,function*(){let p;M?Object.keys(D).length>0&&(p=this.updateNode(j.path,D,L)):(M=!0,p=this.setNode(j.path,D,L)),D={},p&&(yield p)}),O=[];for(;;){yield h();const p=yield f();yield h(),yield u(":"),yield h();const{value:v,type:m}=yield A();if(D[p]=v,I++,["object","array"].includes(m)&&(O.push(U()),m==="object"?yield q(j.child(p)):yield H(j.child(p))),yield h(),(yield y(1))==="}"){s.index++;break}yield u(",")}if(I===2&&".type"in D&&".val"in D){const p=B(j.path,D);return this.setNode(j.path,p,L)}O.push(U()),yield Promise.all(O)}),H=j=>V(this,null,function*(){if(yield u("["),yield h(),(yield y(1))==="]")return s.index++,this.setNode(j.path,[],L);let I=!1,D=[],M={};const U=()=>V(this,null,function*(){let m;I?Object.keys(M).length>0&&(m=this.updateNode(j.path,M,L),M={}):(I=!0,m=this.setNode(j.path,D,L),D=null),m&&(yield m)}),O=(m,w)=>{I?M[w]=m:D.push(m)},p=[];let v=0;for(;;){yield h();const{value:m,type:w}=yield A();if(O(m,v),["object","array"].includes(w)&&(p.push(U()),w==="object"?yield q(j.child(v)):yield H(j.child(v))),yield h(),(yield y(1))==="]"){s.index++;break}yield u(","),v++}p.push(U()),yield Promise.all(p)});return(()=>V(this,null,function*(){const{value:j,type:I}=yield A();if(["object","array"].includes(I)){const D=J.get(r);I==="object"?yield q(D):yield H(D)}else yield this.setNode(r,j,L)}))()})}setSchema(e,t,r=!1){if(typeof t=="undefined")throw new TypeError("schema argument must be given");if(t===null){const s=this._schemas.findIndex(a=>a.path===e);s>=0&&this._schemas.splice(s,1);return}const i=new VE(t,{warnOnly:r,warnCallback:s=>this.debug.warn(s)}),o=this._schemas.find(s=>s.path===e);o?o.schema=i:(this._schemas.push({path:e,schema:i}),this._schemas.sort((s,a)=>{const c=J.getPathKeys(s.path),l=J.getPathKeys(a.path);return c.length===l.length?0:c.length<l.length?-1:1}))}getSchema(e){const t=this._schemas.find(r=>r.path===e);return t?{path:e,schema:t.schema.source,text:t.schema.text}:null}getSchemas(){return this._schemas.map(e=>({path:e.path,schema:e.schema.source,text:e.schema.text}))}validateSchema(e,t,r={updates:!1}){let i={ok:!0};const o=J.get(e);return this._schemas.filter(s=>o.isOnTrailOf(s.path)).every(s=>{if(o.isDescendantOf(s.path)){const u=J.fillVariables(s.path,e),h=o.keys.slice(J.getPathKeys(s.path).length);return i=s.schema.check(u,t,r.updates,h),i.ok}const a=J.getPathKeys(s.path).slice(o.keys.length);if(r.updates===!0&&a.length>0&&!(a[0]in t))return i.ok;const c=r.updates===!0&&a.length===0,l=(u,h,y)=>{if(y.length===0)return s.schema.check(u,h,c);if(h===null)return{ok:!0};const d=y[0];if(typeof d=="string"&&(d==="*"||d[0]==="$")){if(h===null||typeof h!="object")return{ok:!0};let f;return Object.keys(h).every(g=>{const _=J.getChildPath(u,g),A=h[g];return f=l(_,A,y.slice(1)),f.ok}),f}else{const f=J.getChildPath(u,d),g=h[d];return l(f,g,y.slice(1))}};return i=l(e,t,a),i.ok}),i}}class Go{static ChildPathsSql(e,t="path"){return e===""?`${t} <> '' AND ${t} NOT LIKE '%/%'`:`(${t} LIKE '${e}/%' OR ${t} LIKE '${e}[%') AND ${t} NOT LIKE '${e}/%/%' AND ${t} NOT LIKE '${e}[%]/%' AND ${t} NOT LIKE '${e}[%][%'`}static ChildPathsRegex(e){return new RegExp(`^${e}(?:/[^/[]+|\\[[0-9]+\\])$`)}static DescendantPathsSql(e,t="path"){return e===""?`${t} <> ''`:`${t} LIKE '${e}/%' OR ${t} LIKE '${e}[%'`}static DescendantPathsRegex(e){return new RegExp(`^${e}(?:/[^/[]+|\\[[0-9]+\\])`)}static get PathInfo(){return J}}class kp{constructor(e){this.path=e}toString(){return`"/${this.path}"`}equals(e){return this.path===e.path}}const{compareValues:s_}=tm;class Qh{constructor(e){this.production=!1,this.target={get originalPath(){return e.path},path:e.path,get write(){return e.write}},this.id=Ft.generate()}getChildCount(e){return V(this,null,function*(){let t=0;return yield this.childrenOf(e,{metadata:!1,value:!1},()=>(t++,!1)),t})}getMultiple(e){return V(this,null,function*(){const t=new Map;return yield Promise.all(e.map(r=>this.get(r).then(i=>t.set(r,i)))),t})}setMultiple(e){return V(this,null,function*(){yield Promise.all(e.map(({path:t,node:r})=>this.set(t,r)))})}removeMultiple(e){return V(this,null,function*(){yield Promise.all(e.map(t=>this.remove(t)))})}commit(){return V(this,null,function*(){throw new Error("CustomStorageTransaction.rollback must be overridden by subclass")})}moveToParentPath(e){return V(this,null,function*(){const t=this._lock&&this._lock.path||this.target.path;if(t===e)return e;if(Go.PathInfo.get(e).isParentOf(t))this._lock&&(this._lock=yield this._lock.moveToParent());else throw new Error(`Locking issue. Locked path "${this._lock.path}" is not a child/descendant of "${e}"`);return this.target.path=e,e})}}class Xo extends Zh{constructor(e){if(super(e),this.locking=!0,typeof e!="object")throw new Error("settings missing");if(typeof e.ready!="function")throw new Error("ready must be a function");if(typeof e.getTransaction!="function")throw new Error("getTransaction must be a function");this.name=e.name,this.locking=e.locking!==!1,this.locking&&(this.lockTimeout=typeof e.lockTimeout=="number"?e.lockTimeout:120),this.ready=e.ready;const t=this.locking,r=t?new fm(console,this.lockTimeout):null;this.getTransaction=i=>V(this,[i],function*({path:o,write:s}){const a=yield e.getTransaction({path:o,write:s});Gt(typeof a.id=="string","transaction id not set");const c=a.rollback,l=a.commit;return a.commit=()=>V(this,null,function*(){const u=yield l.call(a);return t&&(yield a._lock.release("commit")),u}),a.rollback=u=>V(this,null,function*(){const h=yield c.call(a,u);return t&&(yield a._lock.release("rollback")),h}),t&&(a._lock=yield r.lock(o,a.id,s,`${this.name}::getTransaction`)),a})}}class El extends dm{constructor(e){super(e),this.revision=e.revision,this.revision_nr=e.revision_nr,this.created=e.created,this.modified=e.modified}}class a_ extends o_{constructor(e,t,r){super(e,t,r),this._customImplementation=t,this._init()}_init(){return V(this,null,function*(){this.debug.log(`Database "${this.name}" details:`.colorize(At.dim)),this.debug.log("- Type: CustomStorage".colorize(At.dim)),this.debug.log(`- Path: ${this.settings.path}`.colorize(At.dim)),this.debug.log(`- Max inline value size: ${this.settings.maxInlineValueSize}`.colorize(At.dim)),this.debug.log(`- Autoremove undefined props: ${this.settings.removeVoidProperties}`.colorize(At.dim)),yield this._customImplementation.ready();const e=yield this._customImplementation.getTransaction({path:"",write:!0});(yield this.getNodeInfo("",{transaction:e})).exists||(yield this._writeNode("",{},{transaction:e})),yield e.commit(),this.indexes.supported&&(yield this.indexes.load()),this.emit("ready")})}throwImplementationError(e){throw new Error(`CustomStorage "${this._customImplementation.name}" ${e}`)}_storeNode(e,t,r){const i=s=>{if(s===null)throw new Error("Not allowed to store null values. remove the property");if(["string","number","boolean"].includes(typeof s))return s;if(s instanceof Date)return{type:ae.DATETIME,value:s.getTime()};if(s instanceof rt)return{type:ae.REFERENCE,value:s.path};if(s instanceof ArrayBuffer)return{type:ae.BINARY,value:br.encode(s)};if(typeof s=="object")return Gt(Object.keys(s).length===0,"child object stored in parent can only be empty"),s},o="Caller should have pre-processed the value by converting it to a string";if(t.type===ae.ARRAY&&t.value instanceof Array){console.warn(`Unprocessed array. ${o}`);const s={};for(let a=0;a<t.value.length;a++)s[a]=t.value[a];t.value=s}if(t.type===ae.BINARY&&typeof t.value!="string"&&(console.warn(`Unprocessed binary value. ${o}`),t.value=br.encode(t.value)),t.type===ae.REFERENCE&&t.value instanceof rt&&(console.warn(`Unprocessed path reference. ${o}`),t.value=t.value.path),[ae.OBJECT,ae.ARRAY].includes(t.type)){const s=t.value;t.value={},Object.keys(s).forEach(a=>{t.value[a]=i(s[a])})}return r.transaction.set(e,t)}_processReadNodeValue(e){const t=r=>{if(r.type===ae.BINARY)return br.decode(r.value);if(r.type===ae.DATETIME)return new Date(r.value);if(r.type===ae.REFERENCE)return new rt(r.value);throw new Error(`Unhandled child value type ${r.type}`)};switch(e.type){case ae.ARRAY:case ae.OBJECT:{const r=e.value;Object.keys(r).forEach(i=>{const o=r[i];typeof o=="object"&&"type"in o&&(r[i]=t(o))}),e.value=r;break}case ae.BINARY:{e.value=br.decode(e.value);break}case ae.REFERENCE:{e.value=new rt(e.value);break}case ae.STRING:break;default:throw new Error("Invalid standalone record value type")}}_readNode(e,t){return V(this,null,function*(){const r=yield t.transaction.get(e);return r===null?null:(typeof r!="object"&&this.throwImplementationError("transaction.get must return an ICustomStorageNode object. Use JSON.parse if your set function stored it as a string"),this._processReadNodeValue(r),r)})}_getTypeFromStoredValue(e){let t;if(typeof e=="string")t=ae.STRING;else if(typeof e=="number")t=ae.NUMBER;else if(typeof e=="boolean")t=ae.BOOLEAN;else if(e instanceof Array)t=ae.ARRAY;else if(typeof e=="object")if("type"in e){const r=e;t=r.type,e=r.value,t===ae.DATETIME?e=new Date(e):t===ae.REFERENCE&&(e=new rt(e))}else t=ae.OBJECT;else throw new Error("Unknown value type");return{type:t,value:e}}_writeNode(e,t,r){return V(this,null,function*(){if(!r.merge&&this.valueFitsInline(t)&&e!=="")throw new Error("invalid value to store in its own node");if(e===""&&(typeof t!="object"||t instanceof Array))throw new Error("Invalid root node value. Must be an object");if(typeof r.diff=="undefined"&&typeof r.currentValue!="undefined"){const f=s_(r.currentValue,t);r.merge&&typeof f=="object"&&(f.removed=f.removed.filter(g=>t[g]===null)),r.diff=f}if(r.diff==="identical")return;const i=r.transaction,o=r.currentValue===null?null:yield this._readNode(e,{transaction:i});if(r.merge&&o){if(o.type===ae.ARRAY&&!(t instanceof Array)&&typeof t=="object"&&Object.keys(t).some(f=>isNaN(parseInt(f))))throw new Error(`Cannot merge existing array of path "${e}" with an object`);if(t instanceof Array&&o.type!==ae.ARRAY)throw new Error(`Cannot merge existing object of path "${e}" with an array`)}const s=r.revision||Ft.generate(),a={type:o&&o.type===ae.ARRAY?ae.ARRAY:ae.OBJECT,value:{}},c={};if(t instanceof Array){a.type=ae.ARRAY;const f={};for(let g=0;g<t.length;g++)f[g]=t[g];t=f}else t instanceof rt?(a.type=ae.REFERENCE,a.value=t.path):t instanceof ArrayBuffer?(a.type=ae.BINARY,a.value=br.encode(t)):typeof t=="string"&&(a.type=ae.STRING,a.value=t);const l=o?[ae.OBJECT,ae.ARRAY].includes(o.type):!1,u=[ae.OBJECT,ae.ARRAY].includes(a.type),h={current:[],new:[]};let y=null;l&&(y=o.value,h.current=Object.keys(y),u&&(a.value=y)),u&&(r.merge||Object.keys(a.value).forEach(f=>{f in t||(t[f]=null)}),Object.keys(t).forEach(f=>{const g=t[f];if(delete a.value[f],g!==null){if(typeof g=="undefined")if(this.settings.removeVoidProperties===!0){delete t[f];return}else throw new Error(`Property "${f}" has invalid value. Cannot store undefined values. Set removeVoidProperties option to true to automatically remove undefined properties`);this.valueFitsInline(g)?a.value[f]=g:c[f]=g}}));const d=a.type===ae.ARRAY;if(o){if(this.debug.log(`Node "/${e}" is being ${r.merge?"updated":"overwritten"}`.colorize(At.cyan)),l||u){const g=J.get(e),_=[];let A=!1;const P=I=>(A=!0,!i.production&&!g.isParentOf(I)&&this.throwImplementationError(`"${I}" is not a child of "${e}" - childrenOf must only check and return paths that are children`),!0),B=I=>{A||this.throwImplementationError("childrenOf did not call checkCallback before addCallback");const D=J.get(I).key;return _.push(D.toString()),!0};yield i.childrenOf(e,{metadata:!1,value:!1},P,B),h.current=h.current.concat(_),u&&(r&&r.merge&&(h.new=h.current.slice()),Object.keys(t).forEach(I=>{h.new.includes(I)||h.new.push(I)}));const C={insert:h.new.filter(I=>!h.current.includes(I)),update:[],delete:r&&r.merge?Object.keys(t).filter(I=>t[I]===null):h.current.filter(I=>!h.new.includes(I))};if(C.update=h.new.filter(I=>h.current.includes(I)&&!C.delete.includes(I)),d&&r.merge&&(C.insert.length>0||C.delete.length>0)&&!C.update.concat(C.insert).every((I,D,M)=>M.includes(D.toString())))throw new Error(`Elements cannot be inserted beyond, or removed before the end of an array. Rewrite the whole array at path "${e}" or change your schema to use an object collection instead`);const L=Object.keys(c).map(I=>{const D=d?parseInt(I):I,M=typeof r.diff=="object"?r.diff.forChild(D):void 0;if(M==="identical")return;const U=g.childPath(D),O=c[D],p=typeof r.currentValue=="undefined"?void 0:r.currentValue!==null&&typeof r.currentValue=="object"&&D in r.currentValue?r.currentValue[D]:null;return this._writeNode(U,O,{transaction:i,revision:s,merge:!1,currentValue:p,diff:M})}),q=u?_.filter(I=>I in a.value):[],H=C.delete.concat(q).map(I=>{const D=d?parseInt(I):I,M=g.childPath(D);return this._deleteNode(M,{transaction:i})}),j=L.concat(H);yield Promise.all(j)}const f=this._storeNode(e,{type:a.type,value:a.value,revision:o.revision,revision_nr:o.revision_nr+1,created:o.created,modified:Date.now()},{transaction:i});if(f instanceof Promise)return yield f}else{if(this.debug.log(`Node "/${e}" is being created`.colorize(At.cyan)),d&&!Object.keys(a.value).concat(Object.keys(c)).every((_,A,P)=>P.includes(A.toString())))throw new Error("Cannot store arrays with missing entries");const f=Object.keys(c).map(_=>{const A=d?parseInt(_):_,P=J.getChildPath(e,A),B=c[A];return this._writeNode(P,B,{transaction:i,revision:s,merge:!1,currentValue:null})}),g=this._storeNode(e,{type:a.type,value:a.value,revision:s,revision_nr:1,created:Date.now(),modified:Date.now()},{transaction:i});g instanceof Promise&&f.push(g),yield Promise.all(f)}})}_deleteNode(e,t){return V(this,null,function*(){const r=J.get(e);this.debug.log(`Node "/${e}" is being deleted`.colorize(At.cyan));const i=[e];let o=!1;const s=l=>(o=!0,!c.production&&!r.isAncestorOf(l)&&this.throwImplementationError(`"${l}" is not a descendant of "${e}" - descendantsOf must only check and return paths that are descendants`),!0),a=l=>(o||this.throwImplementationError("descendantsOf did not call checkCallback before addCallback"),i.push(l),!0),c=t.transaction;return yield c.descendantsOf(e,{metadata:!1,value:!1},s,a),this.debug.log(`Nodes ${i.map(l=>`"/${l}"`).join(",")} are being deleted`.colorize(At.cyan)),c.removeMultiple(i)})}getChildren(e,t={}){let r;const i={next(s){return r=s,o()}},o=()=>V(this,null,function*(){const s=t.transaction||(yield this._customImplementation.getTransaction({path:e,write:!1}));try{let a=!1;return yield(()=>V(this,null,function*(){const c=yield this._readNode(e,{transaction:s});if(!c)throw new Gh(`Node "/${e}" does not exist`);if(![ae.OBJECT,ae.ARRAY].includes(c.type))return;const l=c.type===ae.ARRAY,u=c.value;let h=Object.keys(u).map(_=>l?parseInt(_):_);t.keyFilter&&(h=h.filter(_=>t.keyFilter.includes(_)));const y=J.get(e);if(h.length>0&&h.every(_=>{const A=this._getTypeFromStoredValue(u[_]),P=new El({path:y.childPath(_),key:l?null:_,index:l?_:null,type:A.type,address:null,exists:!0,value:A.value,revision:c.revision,revision_nr:c.revision_nr,created:new Date(c.created),modified:new Date(c.modified)});return a=r(P)===!1,!a}),a)return;let d=!1;const f=_=>{if(d=!0,!s.production&&!y.isParentOf(_)&&this.throwImplementationError(`"${_}" is not a child of "${e}" - childrenOf must only check and return paths that are children`),t.keyFilter){const A=J.get(_).key;return t.keyFilter.includes(A)}return!0},g=(_,A)=>{d||this.throwImplementationError("childrenOf did not call checkCallback before addCallback");const P=J.get(_).key,B=new El({path:_,type:A.type,key:l?null:P,index:l?P:null,address:new kp(_),exists:!0,value:null,revision:A.revision,revision_nr:A.revision_nr,created:new Date(A.created),modified:new Date(A.modified)});return a=r(B)===!1,!a};yield s.childrenOf(e,{metadata:!0,value:!1},f,g)}))(),t.transaction||(yield s.commit()),a}catch(a){throw t.transaction||(yield s.rollback(a)),a}});return i}getNode(e,t){return V(this,null,function*(){t=t||{};const r=t.transaction||(yield this._customImplementation.getTransaction({path:e,write:!1}));try{const i=yield(()=>V(this,null,function*(){const o=t.include&&t.include.length>0||t.exclude&&t.exclude.length>0||t.child_objects===!1,s=J.get(e),a=yield this._readNode(e,{transaction:r});if(!a){if(e==="")return{value:null};const B=yield r.moveToParentPath(s.parentPath);Gt(B===s.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${e}"`);const C=yield this._readNode(s.parentPath,{transaction:r});if(C&&[ae.OBJECT,ae.ARRAY].includes(C.type)&&s.key in C.value){const L=this._getTypeFromStoredValue(C.value[s.key]);return{revision:C.revision,revision_nr:C.revision_nr,created:C.created,modified:C.modified,type:L.type,value:L.value}}return{value:null}}const c=a.type===ae.ARRAY,l=B=>{const C=L=>/^[0-9]+$/.test(L);return B.map(L=>J.get(c&&C(L)?`[${L}]`:L))},u=t.include?l(t.include):[],h=t.exclude?l(t.exclude):[],y=(B,C)=>{if([ae.OBJECT,ae.ARRAY].includes(C.type)&&u.length>0){const L=J.getPathKeys(B).slice(s.keys.length),q=new J(L),H=[],j=u.filter(D=>D.isDescendantOf(q));if(j.length>0){const D=C.type===ae.ARRAY;H.push(...Object.keys(C.value).map(M=>D?+M:M));for(const M of j){const U=M.keys[L.length];if(typeof U=="string"&&(U==="*"||U.startsWith("$"))){H.splice(0);break}const O=H.indexOf(U);O>=0&&H.splice(O,1)}}const I=u.some(D=>D.isChildOf(q));if(h.some(D=>D.isChildOf(q))&&!I){const D=h.filter(M=>M.isChildOf(q));for(let M=0;M<H.length;M++)D.find(U=>U.equals(H[M]))||(H.splice(M,1),M--)}for(const D of H)delete C.value[D]}};y(e,a);let d=!1;const f=(B,C)=>{if(d=!0,!r.production&&!s.isAncestorOf(B)&&this.throwImplementationError(`"${B}" is not a descendant of "${e}" - descendantsOf must only check and return paths that are descendants`),!o)return!0;const L=J.getPathKeys(B).slice(s.keys.length),q=new J(L);let H=(u.length>0?u.some(j=>q.isOnTrailOf(j)):!0)&&(h.length>0?!h.some(j=>j.equals(q)||j.isAncestorOf(q)):!0);return H&&t.child_objects===!1&&(s.isParentOf(B)&&[ae.OBJECT,ae.ARRAY].includes(C?C.type:-1)||J.getPathKeys(B).length>s.pathKeys.length+1)&&(H=!1),H},g=[],_=(B,C)=>{if(d||this.throwImplementationError("descendantsOf did not call checkCallback before addCallback"),t.child_objects===!1&&[ae.OBJECT,ae.ARRAY].includes(C.type))return!0;y(B,C),this._processReadNodeValue(C);const L=C;return L.path=B,g.push(L),!0};yield r.descendantsOf(e,{metadata:!0,value:!0},f,_),this.debug.log(`Read node "/${e}" and ${o?"(filtered) ":""}descendants from ${g.length+1} records`.colorize(At.magenta));const A=a,P=B=>{const C=[];return Object.keys(B).forEach(L=>{const q=parseInt(L);C[q]=B[q]}),C};if(a.type===ae.ARRAY&&(A.value=P(A.value)),a.type===ae.OBJECT||a.type===ae.ARRAY){const B=J.getPathKeys(e),C=a.value;for(let L=0;L<g.length;L++){const q=g[L],H=J.getPathKeys(q.path).slice(B.length);let j=C;for(let I=0;I<H.length;I++){Gt(typeof j=="object","parent must be an object/array to have children!!");const D=H[I],M=I===H.length-1,U=M?q.type:typeof H[I+1]=="number"?ae.ARRAY:ae.OBJECT;let O;M?(O=q.value,U===ae.ARRAY&&(O=P(O))):O=U===ae.OBJECT?{}:[],D in j?typeof j[D]==typeof O&&[ae.OBJECT,ae.ARRAY].includes(U)?Object.keys(O).forEach(p=>{p in j[D]&&this.throwImplementationError(`Custom storage merge error: child key "${p}" is in parent value already! Make sure the get/childrenOf/descendantsOf methods of the custom storage class return values that can be modified by AceBase without affecting the stored source`),j[D][p]=O[p]}):this.debug.error(`The value stored in node "${q.path}" cannot be merged with the parent node, value will be ignored. This error should disappear once the target node value is updated. See issue #20 for more information`,{path:e,parent:j,key:D,nodeType:U,nodeValue:O}):j[D]=O,j=j[D]}}}else g.length>0&&this.throwImplementationError("multiple records found for non-object value!");if(t.child_objects===!1&&Object.keys(A.value).forEach(B=>{typeof A.value[B]=="object"&&A.value[B].constructor===Object&&(Gt(Object.keys(A.value[B]).length===0),delete A.value[B])}),t.include,t.exclude){const B=(C,L)=>{if(typeof C!="object")return;const q=L[0];q==="*"?Object.keys(C).forEach(H=>{B(C[H],L.slice(1))}):L.length>1?q in C&&B(C[q],L.slice(1)):delete C[q]};t.exclude.forEach(C=>{const L=J.getPathKeys(C);B(A.value,L)})}return A}))();return t.transaction||(yield r.commit()),i}catch(i){throw t.transaction||(yield r.rollback(i)),i}})}getNodeInfo(e){return V(this,arguments,function*(t,r={}){r=r||{};const i=J.get(t),o=r.transaction||(yield this._customImplementation.getTransaction({path:t,write:!1}));try{const s=yield this._readNode(t,{transaction:o}),a=new El({path:t,key:typeof i.key=="string"?i.key:null,index:typeof i.key=="number"?i.key:null,type:s?s.type:0,exists:s!==null,address:s?new kp(t):null,created:s?new Date(s.created):null,modified:s?new Date(s.modified):null,revision:s?s.revision:null,revision_nr:s?s.revision_nr:null});if(!s&&t!==""){const c=yield o.moveToParentPath(i.parentPath);Gt(c===i.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${t}"`);const l=yield this._readNode(i.parentPath,{transaction:o});l&&[ae.OBJECT,ae.ARRAY].includes(l.type)&&i.key in l.value?(a.exists=!0,a.value=l.value[i.key],a.address=null,a.type=l.type,a.created=new Date(l.created),a.modified=new Date(l.modified),a.revision=l.revision,a.revision_nr=l.revision_nr):a.address=null}return r.include_child_count&&(a.childCount=0,[ae.OBJECT,ae.ARRAY].includes(a.valueType)&&a.address&&(a.childCount=s.value?Object.keys(s.value).length:0,a.childCount+=yield o.getChildCount(t))),r.transaction||(yield o.commit()),a}catch(s){throw r.transaction||(yield o.rollback(s)),s}})}setNode(e,t){return V(this,arguments,function*(r,i,o={suppress_events:!1,context:null}){if(this.settings.readOnly)throw new Error("Database is opened in read-only mode");const s=J.get(r),a=o.transaction||(yield this._customImplementation.getTransaction({path:r,write:!0}));try{if(r===""){if(i===null||typeof i!="object"||i instanceof Array||i instanceof ArrayBuffer||"buffer"in i&&i.buffer instanceof ArrayBuffer)throw new Error(`Invalid value for root node: ${i}`);yield this._writeNodeWithTracking("",i,{merge:!1,transaction:a,suppress_events:o.suppress_events,context:o.context})}else if(typeof o.assert_revision!="undefined"){const c=yield this.getNodeInfo(r,{transaction:a});if(c.revision!==o.assert_revision)throw new $u(`revision '${c.revision}' does not match requested revision '${o.assert_revision}'`);if(c.address&&c.address.path===r&&i!==null&&!this.valueFitsInline(i))yield this._writeNodeWithTracking(r,i,{merge:!1,transaction:a,suppress_events:o.suppress_events,context:o.context});else{const l=yield a.moveToParentPath(s.parentPath);Gt(l===s.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${r}"`),yield this._writeNodeWithTracking(s.parentPath,{[s.key]:i},{merge:!0,transaction:a,suppress_events:o.suppress_events,context:o.context})}}else{const c=yield a.moveToParentPath(s.parentPath);Gt(c===s.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${r}"`),yield this.updateNode(s.parentPath,{[s.key]:i},{transaction:a,suppress_events:o.suppress_events,context:o.context})}o.transaction||(yield a.commit())}catch(c){throw o.transaction||(yield a.rollback(c)),c}})}updateNode(e,t){return V(this,arguments,function*(r,i,o={suppress_events:!1,context:null}){if(this.settings.readOnly)throw new Error("Database is opened in read-only mode");if(typeof i!="object")throw new Error("invalid updates argument");if(Object.keys(i).length===0)return;const s=o.transaction||(yield this._customImplementation.getTransaction({path:r,write:!0}));try{const a=yield this.getNodeInfo(r,{transaction:s}),c=J.get(r);if(a.exists&&a.address&&a.address.path===r)yield this._writeNodeWithTracking(r,i,{transaction:s,merge:!0,suppress_events:o.suppress_events,context:o.context});else if(a.exists){const l=J.get(r),u=yield s.moveToParentPath(l.parentPath);Gt(u===l.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${r}"`),yield this._writeNodeWithTracking(l.parentPath,{[l.key]:i},{transaction:s,merge:!0,suppress_events:o.suppress_events,context:o.context})}else{const l=yield s.moveToParentPath(c.parentPath);Gt(l===c.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${r}"`),yield this.updateNode(c.parentPath,{[c.key]:i},{transaction:s,suppress_events:o.suppress_events,context:o.context})}o.transaction||(yield s.commit())}catch(a){throw o.transaction||(yield s.rollback(a)),a}})}}class c_{constructor(e=1e3,t){this.limit=e,this.options=t,this.added=0,this.scheduled=[],this.running=0,this.results=[],this.done=!1}execute(e,t){return V(this,null,function*(){var r,i;try{this.running++;const o=yield e();if(this.results[t]=o,this.running--,this.running===0&&this.scheduled.length===0)this.done=!0,(r=this.doneCallback)==null||r.call(this,this.results);else if(this.scheduled.length>0){const s=this.scheduled.shift();this.execute(s.task,s.index)}}catch(o){this.done=!0,(i=this.errorCallback)==null||i.call(this,o)}})}add(e){var t;if(this.done)throw new Error("Cannot add to a batch that has already finished. Use wait option and start batch processing manually if you are adding tasks in an async loop");const r=this.added++;((t=this.options)==null?void 0:t.wait)!==!0&&this.running<this.limit?this.execute(e,r):this.scheduled.push({task:e,index:r})}start(){for(;this.running<this.limit;){const e=this.scheduled.shift();this.execute(e.task,e.index)}}finish(){return V(this,null,function*(){return this.running===0&&this.scheduled.length===0?this.results:(yield new Promise((e,t)=>{this.doneCallback=e,this.errorCallback=t}),this.results)})}}const l_=()=>{};function ym(n,e,t){return V(this,arguments,function*(r,i,o,s={snapshots:!1,include:void 0,exclude:void 0,child_objects:void 0,eventHandler:l_}){var a,c,l,u,h,y;typeof s!="object"&&(s={}),typeof s.snapshots=="undefined"&&(s.snapshots=!1);const d={};(a=r.storage.settings.transactions)!=null&&a.log&&(d.acebase_cursor=Ft.generate());const f=o.filters.map(O=>X({},O)),g=o.order.map(O=>X({},O)),_=O=>{O.sort((p,v)=>{const m=w=>{const E=g[w],b=J.getPathKeys(typeof E.key=="number"?`[${E.key}]`:E.key),k=b.reduce(($,S)=>$!==null&&typeof $=="object"&&S in $?$[S]:null,p.val),x=b.reduce(($,S)=>$!==null&&typeof $=="object"&&S in $?$[S]:null,v.val);return k===null?x===null?0:E.ascending?-1:1:x===null?E.ascending?1:-1:k==x?w<g.length-1?m(w+1):p.path<v.path?-1:1:k<x?E.ascending?-1:1:E.ascending?1:-1};return m(0)})},A=(O,p)=>V(this,null,function*(){if(O.length===0)return[];const v=50,m=new c_(v),w=[];return O.forEach(({path:E},b)=>m.add(()=>V(this,null,function*(){const k=(yield r.storage.getNode(E,p)).value;if(k===null){r.storage.debug.warn(`Indexed result "/${E}" does not have a record!`);return}const x={path:E,val:k};U.sorted?w[b]=x:(w.push(x),!U.skipped&&w.length>o.skip+Math.abs(o.take)&&(_(w),w.pop()))}))),yield m.finish(),w}),P=J.get(i),B=P.keys.some(O=>O==="*"||O.toString().startsWith("$")),C=r.storage.indexes.get(i),L=[];let q=()=>V(this,null,function*(){});if(B){const O=P.keys.filter(m=>typeof m=="string"&&m.startsWith("$")),p=O.length>0&&O.every(m=>o.filters.some(w=>w.key===m&&["==","in"].includes(w.op))),v=typeof s.monitor=="object"&&[(c=s.monitor)==null?void 0:c.add,(l=s.monitor)==null?void 0:l.change,(u=s.monitor)==null?void 0:u.remove].some(m=>m===!0);if(p&&!v){const m=[];for(const $ of O){const S=o.filters.filter(R=>R.key===$).reduce((R,N)=>{if(N.op==="=="&&R.push(N.compare),N.op==="in"){if(!(N.compare instanceof Array))throw new Error("compare argument for 'in' operator must be an Array");R.push(...N.compare)}return R},[]),T=m.splice(0);S.forEach(R=>{T.length===0?m.push({[$]:R}):m.push(...T.map(N=>qe(X({},N),{[$]:R})))})}const w=o.filters.filter($=>!O.includes($.key)),E=m.map($=>J.get(J.getPathKeys(i).map(S=>{var T;return(T=$[S])!=null?T:S})).path),b=o.order.length>0,k=E.map($=>{var S;return ym(r,$,{filters:w,take:0,skip:0,order:[]},{snapshots:b,cache_mode:s.cache_mode,include:[...(S=s.include)!=null?S:[],...o.order.map(T=>T.key)],exclude:s.exclude})});let x=(yield Promise.all(k)).reduce(($,S)=>($.push(...S.results),$),[]);if(b&&_(x),o.skip>0&&x.splice(0,o.skip),o.take>0&&x.splice(o.take),s.snapshots&&(!b||((h=s.include)==null?void 0:h.length)>0||((y=s.exclude)==null?void 0:y.length)>0||!s.child_objects)){const{include:$,exclude:S,child_objects:T}=s;x=yield A(x,{include:$,exclude:S,child_objects:T})}return{results:x,context:null,stop:q}}else if(C.length===0){const m=new Error(`Query on wildcard path "/${i}" requires an index`);return Promise.reject(m)}if(f.length===0){const m=C.filter(w=>w.type==="normal")[0];f.push({key:m.key,op:"!=",compare:null})}}f.forEach(O=>{if(O.index)return;const p=C.filter(v=>v.key===O.key).filter(v=>v.validOperators.includes(O.op));if(p.length>=1){const v=f.filter(b=>b!==O).map(b=>b.key),m=g.map(b=>b.key).filter(b=>b!==O.key),w=p.map(b=>{const k=b.includeKeys.concat(b.key),x=k.filter(R=>v.includes(R)),$=k.filter(R=>m.includes(R)),S=x.concat($.filter(R=>!x.includes(R))),T={filters:x.length,sorting:$.length*(o.take!==0?$.length:1),both:S.length*S.length,get total(){return this.filters+this.sorting+this.both}};return{index:b,points:T.total,filterKeys:x,sortKeys:$}});w.sort((b,k)=>b.points>k.points?-1:1);const E=w[0];O.index=E.index,E.filterKeys.forEach(b=>{f.filter(k=>k!==O&&k.key===b).forEach(k=>{!Xh.validOperators.includes(k.op)||(k.indexUsage="filter",k.index=E.index)})}),E.sortKeys.forEach(b=>{g.filter(k=>k.key===b).forEach(k=>{k.index=E.index})})}O.index&&L.push({index:O.index,description:O.index.description})}),g.length>0&&o.take!==0&&f.length===0&&g.forEach(O=>{O.index||(O.index=C.filter(p=>p.key===O.key).find(p=>p.type==="normal"))});const H=L.map(O=>O.description).join(", ");L.length>0&&r.storage.debug.log(`Using indexes for query: ${H}`);const j=f.filter(O=>!O.index),I=/^[a-z]+:/i;if(j.some(O=>I.test(O.op))){const O=j.find(v=>I.test(v.op)),p=new Error(`query contains operator "${O.op}" which requires a special index that was not found on path "${i}", key "${O.key}"`);return Promise.reject(p)}const D=["<","<=","==","!=",">=",">","like","!like","in","!in","matches","!matches","between","!between","has","!has","contains","!contains","exists","!exists"];for(let O=0;O<j.length;O++){const p=j[O];if(!D.includes(p.op))return Promise.reject(new Error(`query contains unknown filter operator "${p.op}" on path "${i}", key "${p.key}"`))}if(B&&j.length>0){const O=j.reduce((v,m)=>(v.indexOf(m.key)<0&&v.push(m.key),v),[]).map(v=>`"${v}"`),p=new Error(`This wildcard path query on "/${i}" requires index(es) on key(s): ${O.join(", ")}. Create the index(es) and retry`);return Promise.reject(p)}const M=[];f.forEach(O=>{if(O.index&&O.indexUsage!=="filter"){let p=O.index.query(O.op,O.compare).then(m=>(s.eventHandler&&s.eventHandler({name:"stats",type:"index_query",source:O.index.description,stats:m.stats}),m.hints.length>0&&s.eventHandler&&s.eventHandler({name:"hints",type:"index_query",source:O.index.description,hints:m.hints}),m));const v=f.filter(m=>m.index===O.index&&m.indexUsage==="filter");v.length>0&&(p=p.then(m=>(v.forEach(w=>{const{key:E,op:b,index:k}=w;let{compare:x}=w;typeof x=="string"&&!k.caseSensitive&&(x=x.toLocaleLowerCase(k.textLocale)),m=m.filterMetadata(E,b,x)}),m))),M.push(p)}});const U={filtered:f.length===0,skipped:o.skip===0,taken:o.take===0,sorted:g.length===0,preDataLoaded:!1,dataLoaded:!1};if(f.length===0&&o.take===0&&(r.storage.debug.warn(`Filterless queries must use .take to limit the results. Defaulting to 100 for query on path "${i}"`),o.take=100),g.length>0&&g[0].index){const O=g[0].index,p=o.take<0?!g[0].ascending:g[0].ascending;if(f.length===0&&g.slice(1).every(v=>O.allMetadataKeys.includes(v.key))){r.storage.debug.log(`Using index for sorting: ${O.description}`);const v=g.slice(1).map(w=>(w.index=O,{key:w.key,ascending:w.ascending})),m=O.take(o.skip,Math.abs(o.take),{ascending:p,metadataSort:v}).then(w=>(s.eventHandler&&s.eventHandler({name:"stats",type:"sort_index_take",source:O.description,stats:w.stats}),w.hints.length>0&&s.eventHandler&&s.eventHandler({name:"hints",type:"sort_index_take",source:O.description,hints:w.hints}),w));M.push(m),U.skipped=!0,U.taken=!0,U.sorted=!0}}return Promise.all(M).then(O=>V(this,null,function*(){let p=[];if(O.length===1){const x=O[0];p=x.map($=>{const S={key:$.key,path:$.path,val:{[x.filterKey]:$.value}};return $.metadata&&Object.assign(S.val,$.metadata),S}),U.filtered=!0}else if(O.length>1){O.sort((S,T)=>S.length<T.length?-1:1);const x=O[0],$=O.slice(1);p=x.reduce((S,T)=>{const R={key:T.key,path:T.path,val:{[x.filterKey]:T.value}};return $.every(N=>N.findIndex(z=>z.path===T.path)>=0)&&(T.metadata&&Object.assign(R.val,T.metadata),$.forEach(N=>{const z=N.find(F=>F.path===R.path);R.val[N.filterKey]=z.value,z.metadata&&Object.assign(R.val,z.metadata)}),S.push(R)),S},[]),U.filtered=!0}if(B||M.length>0&&j.length===0){if(g.length===0||g.every(x=>x.index)){if(U.preDataLoaded=!0,!U.sorted&&g.length>0&&_(p),U.sorted=!0,!U.skipped&&o.skip>0&&(p=o.take<0?p.slice(0,-o.skip):p.slice(o.skip)),!U.taken&&o.take!==0&&(p=o.take<0?p.slice(o.take):p.slice(0,o.take)),U.skipped=!0,U.taken=!0,!s.snapshots)return p;const x={include:s.include,exclude:s.exclude,child_objects:s.child_objects};return A(p,x).then($=>(U.dataLoaded=!0,$))}if(s.snapshots||!U.sorted){const x=g.length>0,$=x?{include:g.map(S=>S.key)}:{include:s.include,exclude:s.exclude,child_objects:s.child_objects};return A(p,$).then(S=>(g.length>0&&_(S),U.sorted=!0,o.skip>0&&(S=o.take<0?S.slice(0,-o.skip):S.slice(o.skip)),o.take!==0&&(S=o.take<0?S.slice(o.take):S.slice(0,o.take)),U.skipped=!0,U.taken=!0,s.snapshots&&x?A(S,{include:s.include,exclude:s.exclude,child_objects:s.child_objects}):S))}else return p}let v;p.length>0&&(v=p.map(x=>x.key));let m=[],w=!1;const E=g.length>0,b=E?{include:g.map(x=>x.key)}:{include:s.include,exclude:s.exclude,child_objects:s.child_objects},k={promises:[],add(x){if(this.promises.push(x),this.promises.length>=1e3)return Promise.all(this.promises.splice(0)).then($=>{})}};try{yield r.storage.getChildren(i,{keyFilter:v,async:!0}).next(x=>{if(x.type!==ae.OBJECT||!x.address)return;if(w)return!1;const $=()=>V(this,null,function*(){if(!(yield r.storage.matchNode(x.address.path,j)))return;const T=x.address.path;let R;if(s.snapshots||g.length>0){const N=yield r.storage.getNode(T,b);R={path:T,val:N.value}}else R={path:T};m.push(R),o.take!==0&&m.length>Math.abs(o.take)+o.skip&&(g.length>0?_(m):o.take>0&&(w=!0),m.pop())}),S=k.add($());if(S instanceof Promise)return S})}catch(x){return x instanceof Gh||r.storage.debug.warn(`Error getting child stream: ${x}`),[]}return yield Promise.all(k.promises),U.preDataLoaded=E,U.dataLoaded=!E,g.length>0&&_(m),U.sorted=!0,o.skip>0&&(m=o.take<0?m.slice(0,-o.skip):m.slice(o.skip)),U.skipped=!0,o.take!==0&&(m=o.take<0?m.slice(o.take):m.slice(0,o.take)),U.taken=!0,U.dataLoaded||(m=yield A(m,{include:s.include,exclude:s.exclude,child_objects:s.child_objects}),U.dataLoaded=!0),m})).then(O=>{if(!U.sorted&&g.length>0&&_(O),s.snapshots||(O=O.map(p=>p.path)),!U.skipped&&o.skip>0&&(O=o.take<0?O.slice(0,-o.skip):O.slice(o.skip)),!U.taken&&o.take!==0&&(O=o.take<0?O.slice(o.take):O.slice(0,o.take)),s.monitor===!0&&(s.monitor={add:!0,change:!0,remove:!0}),typeof s.monitor=="object"&&(s.monitor.add||s.monitor.change||s.monitor.remove)){const p=s.monitor,v=s.snapshots?O.map(S=>S.path):O.slice(),m=r.db.ref(i),w=S=>{const T=v.indexOf(S);T<0||v.splice(T,1)},E=S=>{v.includes(S)||v.push(S)},b=()=>{r.unsubscribe(m.path,"child_changed",k),r.unsubscribe(m.path,"child_added",x),r.unsubscribe(m.path,"notify_child_removed",$)};q=()=>V(this,null,function*(){b()});const k=(S,T,R,N)=>V(this,null,function*(){const z=v.includes(T);let F=!0;const ne=[];f.forEach(re=>!ne.includes(re.key)&&ne.push(re.key));const te=[];typeof N=="object"&&Object.keys(N).forEach(re=>!te.includes(re)&&te.push(re)),typeof R=="object"&&Object.keys(R).forEach(re=>!te.includes(re)&&te.push(re));const pe=[];let oe=te.every(re=>ne.includes(re)?f.filter(ue=>ue.key===re).every(ue=>{var Ne;return((Ne=ue.index)==null?void 0:Ne.textLocaleKey)&&!te.includes(ue.index.textLocaleKey)?(pe.push(ue.index.textLocaleKey),!0):D.includes(ue.op)?r.storage.test(R[re],ue.op,ue.compare):ue.index.test(R,ue.op,ue.compare)}):!0);if(oe&&(pe.push(...ne.filter(re=>!te.includes(re))),!z&&pe.length>0)){const re=f.filter(ye=>pe.includes(ye.key)),ue=re.filter(ye=>D.includes(ye.op)),Ne=re.filter(ye=>!D.includes(ye.op));if(ue.length>0&&(oe=yield r.storage.matchNode(T,ue)),oe&&Ne.length>0){const ye=Ne.reduce((Ce,He)=>(Ce.includes(He.key)||Ce.push(He.key),He.index instanceof pm&&He.index.config.localeKey&&!Ce.includes(He.index.config.localeKey)&&Ce.push(He.index.config.localeKey),Ce),[]),It=yield r.storage.getNode(T,{include:ye});if(It.value===null)return!1;oe=Ne.every(Ce=>Ce.index.test(It.value,Ce.op,Ce.compare))}}if(oe){if(z||E(T),s.snapshots){const re={include:s.include,exclude:s.exclude,child_objects:s.child_objects};R=(yield r.storage.getNode(T,re)).value}z&&p.change?F=s.eventHandler({name:"change",path:T,value:R})!==!1:!z&&p.add&&(F=s.eventHandler({name:"add",path:T,value:R})!==!1)}else z&&(w(T),p.remove&&(F=s.eventHandler({name:"remove",path:T,value:N})!==!1));F===!1&&b()}),x=(S,T,R)=>{const N=f.every(F=>D.includes(F.op)?r.storage.test(R[F.key],F.op,F.compare):F.index.test(R,F.op,F.compare));let z=!0;N&&(E(T),p.add&&(z=s.eventHandler({name:"add",path:T,value:s.snapshots?R:null})!==!1)),z===!1&&b()},$=(S,T,R,N)=>{let z=!0;w(T),p.remove&&(z=s.eventHandler({name:"remove",path:T,value:s.snapshots?N:null})!==!1),z===!1&&b()};(s.monitor.add||s.monitor.change||s.monitor.remove)&&r.subscribe(m.path,"child_changed",k),s.monitor.remove&&r.subscribe(m.path,"notify_child_removed",$),s.monitor.add&&r.subscribe(m.path,"child_added",x)}return{results:O,context:d,stop:q}})})}class u_ extends BE{constructor(e="default",t,r){super(),this.db=t.db;const i={logLevel:t.settings.logLevel};if(typeof t.settings.storage=="object")if(vp&&t.settings.storage instanceof vp)this.storage=new KE(e,t.settings.storage,i);else if(bp&&t.settings.storage instanceof bp)this.storage=new WE(e,t.settings.storage,i);else if(Xo&&t.settings.storage instanceof Xo)this.storage=new a_(e,t.settings.storage,i);else{const o=t.settings.storage instanceof kl?t.settings.storage:new kl(t.settings.storage);this.storage=new _u(e,o,i)}else this.storage=new _u(e,new kl,i);this.storage.on("ready",r)}stats(e){return V(this,null,function*(){return this.storage.stats})}subscribe(e,t,r){this.storage.subscriptions.add(e,t,r)}unsubscribe(e,t,r){this.storage.subscriptions.remove(e,t,r)}set(e,t){return V(this,arguments,function*(r,i,o={suppress_events:!1,context:null}){const s=yield this.storage.setNode(r,i,{suppress_events:o.suppress_events,context:o.context});return X({},s&&{cursor:s})})}update(e,t){return V(this,arguments,function*(r,i,o={suppress_events:!1,context:null}){const s=yield this.storage.updateNode(r,i,{suppress_events:o.suppress_events,context:o.context});return X({},s&&{cursor:s})})}get transactionLoggingEnabled(){return this.storage.settings.transactions&&this.storage.settings.transactions.log===!0}get(e,t){return V(this,null,function*(){if(t||(t={}),typeof t.include!="undefined"&&!(t.include instanceof Array))throw new TypeError("options.include must be an array of key names");if(typeof t.exclude!="undefined"&&!(t.exclude instanceof Array))throw new TypeError("options.exclude must be an array of key names");if(["undefined","boolean"].indexOf(typeof t.child_objects)<0)throw new TypeError("options.child_objects must be a boolean");const r=yield this.storage.getNode(e,t);return{value:r.value,context:{acebase_cursor:r.cursor},cursor:r.cursor}})}transaction(e,t){return V(this,arguments,function*(r,i,o={suppress_events:!1,context:null}){const s=yield this.storage.transactNode(r,i,{suppress_events:o.suppress_events,context:o.context});return X({},s&&{cursor:s})})}exists(e){return V(this,null,function*(){return(yield this.storage.getNodeInfo(e)).exists})}query(e,t){return V(this,arguments,function*(r,i,o={snapshots:!1}){return yield ym(this,r,i,o)})}createIndex(e,t,r){return this.storage.indexes.create(e,t,r)}getIndexes(){return V(this,null,function*(){return this.storage.indexes.list()})}deleteIndex(e){return V(this,null,function*(){return this.storage.indexes.delete(e)})}reflect(e,t,r){return V(this,null,function*(){r=r||{};const i=(o,s=50,a=0,c=null)=>V(this,null,function*(){typeof s=="string"&&(s=parseInt(s)),typeof a=="string"&&(a=parseInt(a)),["null","undefined"].includes(c)&&(c=null);const l=[];let u=0,h=!1,y=!1;return yield this.storage.getChildren(o).next(d=>{if(h)return y=!0,!1;u++,(c!==null?d.key>c:a===0||u>a)&&l.push(X({key:typeof d.key=="string"?d.key:d.index,type:d.valueTypeName,value:d.value},typeof d.address=="object"&&"pageNr"in d.address&&{address:{pageNr:d.address.pageNr,recordNr:d.address.recordNr}})),h=s>0&&l.length===s}).catch(d=>{if(!(d instanceof Gh))throw d}),{more:y,list:l}});switch(t){case"children":return yield i(e,r.limit,r.skip,r.from);case"info":{const o={key:"",exists:!1,type:"unknown",value:void 0,address:void 0,children:{count:0,more:!1,list:[]}},s=yield this.storage.getNodeInfo(e,{include_child_count:r.child_count===!0});o.key=typeof s.key!="undefined"?s.key:s.index,o.exists=s.exists,o.type=s.exists?s.valueTypeName:void 0,o.value=s.value,o.address=typeof s.address=="object"&&"pageNr"in s.address?{pageNr:s.address.pageNr,recordNr:s.address.recordNr}:void 0;const a=s.exists&&s.address&&[ae.OBJECT,ae.ARRAY].includes(s.type);return r.child_count===!0?o.children={count:a?s.childCount:0}:typeof r.child_limit=="number"&&r.child_limit>0&&a&&(o.children=yield i(e,r.child_limit,r.child_skip,r.child_from)),o}}})}export(e,t,r={format:"json",type_safe:!0}){return this.storage.exportNode(e,t,r)}import(e,t,r={format:"json",suppress_events:!1,method:"set"}){return this.storage.importNode(e,t,r)}setSchema(e,t,r=!1){return V(this,null,function*(){return this.storage.setSchema(e,t,r)})}getSchema(e){return V(this,null,function*(){return this.storage.getSchema(e)})}getSchemas(){return V(this,null,function*(){return this.storage.getSchemas()})}validateSchema(e,t,r){return V(this,null,function*(){return this.storage.validateSchema(e,t,{updates:r})})}getMutations(e){return V(this,null,function*(){if(typeof this.storage.getMutations!="function")throw new Error("Used storage type does not support getMutations");if(typeof e!="object")throw new Error("No filter specified");if(typeof e.cursor!="string"&&typeof e.timestamp!="number")throw new Error("No cursor or timestamp given");return this.storage.getMutations(e)})}getChanges(e){return V(this,null,function*(){if(typeof this.storage.getChanges!="function")throw new Error("Used storage type does not support getChanges");if(typeof e!="object")throw new Error("No filter specified");if(typeof e.cursor!="string"&&typeof e.timestamp!="number")throw new Error("No cursor or timestamp given");return this.storage.getChanges(e)})}}class h_ extends Zh{constructor(e){super(e),this.temp=!1,this.multipleTabs=!1,typeof e.temp=="boolean"&&(this.temp=e.temp),typeof e.provider=="object"&&(this.provider=e.provider),typeof e.multipleTabs=="boolean"&&(this.multipleTabs=e.multipleTabs),typeof e.logLevel=="string"&&(this.logLevel=e.logLevel),typeof e.sponsor=="boolean"&&(this.sponsor=e.sponsor),["type","ipc","path"].forEach(t=>{t in e&&console.warn(`${t} setting is not supported for AceBase LocalStorage`)})}}class d_ extends Qh{constructor(e,t){super(t),this.context=e,this._storageKeysPrefix=`${this.context.dbname}.acebase::`}commit(){return V(this,null,function*(){})}rollback(e){return V(this,null,function*(){})}get(e){return V(this,null,function*(){const t=this.context.localStorage.getItem(this.getStorageKeyForPath(e));return JSON.parse(t)})}set(e,t){return V(this,null,function*(){const r=JSON.stringify(t);this.context.localStorage.setItem(this.getStorageKeyForPath(e),r)})}remove(e){return V(this,null,function*(){this.context.localStorage.removeItem(this.getStorageKeyForPath(e))})}childrenOf(e,t,r,i){return V(this,null,function*(){const o=Go.PathInfo.get(e);for(let s=0;s<this.context.localStorage.length;s++){const a=this.context.localStorage.key(s);if(!a.startsWith(this._storageKeysPrefix))continue;const c=this.getPathFromStorageKey(a);if(o.isParentOf(c)&&r(c)){let l;if(t.metadata||t.value){const u=this.context.localStorage.getItem(a);l=JSON.parse(u)}if(!i(c,l))break}}})}descendantsOf(e,t,r,i){return V(this,null,function*(){const o=Go.PathInfo.get(e);for(let s=0;s<this.context.localStorage.length;s++){const a=this.context.localStorage.key(s);if(!a.startsWith(this._storageKeysPrefix))continue;const c=this.getPathFromStorageKey(a);if(o.isAncestorOf(c)&&r(c)){let l;if(t.metadata||t.value){const u=this.context.localStorage.getItem(a);l=JSON.parse(u)}if(!i(c,l))break}}})}getPathFromStorageKey(e){return e.slice(this._storageKeysPrefix.length)}getStorageKeyForPath(e){return`${this._storageKeysPrefix}${e}`}}function f_(n,e={}){const t=new h_(e),r=t.provider?t.provider:t.temp?window.localStorage:window.sessionStorage,i=new Xo({name:"LocalStorage",locking:!0,removeVoidProperties:t.removeVoidProperties,maxInlineValueSize:t.maxInlineValueSize,ready(){return V(this,null,function*(){})},getTransaction(s){return V(this,null,function*(){const a={debug:!0,dbname:n,localStorage:r};return new d_(a,s)})}}),o=new ws(n,{logLevel:t.logLevel,storage:i,sponsor:t.sponsor});return o.settings.ipcEvents=t.multipleTabs===!0,o}class p_ extends Zh{constructor(e){super(e),this.multipleTabs=!1,this.cacheSeconds=60,this.sponsor=!1,typeof e.logLevel=="string"&&(this.logLevel=e.logLevel),typeof e.multipleTabs=="boolean"&&(this.multipleTabs=e.multipleTabs),typeof e.cacheSeconds=="number"&&(this.cacheSeconds=e.cacheSeconds),typeof e.sponsor=="boolean"&&(this.sponsor=e.sponsor),["type","ipc","path"].forEach(t=>{t in e&&console.warn(`${t} setting is not supported for AceBase IndexedDBStorage`)})}}class gm extends um{constructor(e={}){super(e),e.storage&&(this.storage=e.storage,e.ipc&&(this.storage.ipc=e.ipc),e.transactions&&(this.storage.transactions=e.transactions))}}class y_ extends NE{constructor(e,t={}){const r=new gm(t);super(e,r),this.recovery={repairNode:(o,s)=>V(this,null,function*(){if(yield this.ready(),this.api.storage instanceof _u)yield this.api.storage.repairNode(o,s);else if(!this.api.storage.repairNode)throw new Error("repairNode is not supported with chosen storage engine")}),repairNodeTree:o=>V(this,null,function*(){yield this.ready(),yield this.api.storage.repairNodeTree(o)})};const i={db:this,settings:r};this.api=new u_(e,i,()=>{this.emit("ready")})}close(){return V(this,null,function*(){yield this.api.storage.close()})}get settings(){const e=this.api.storage.ipc,t=this.debug;return{get logLevel(){return t.level},set logLevel(r){t.setLevel(r)},get ipcEvents(){return e.eventsEnabled},set ipcEvents(r){e.eventsEnabled=r}}}static WithLocalStorage(e,t={}){return f_(e,t)}static WithIndexedDB(e,t={}){throw new Error("IndexedDB storage can only be used in browser contexts")}}function xp(n){return new Promise((e,t)=>{n.onsuccess=r=>e(n.result||null),n.onerror=t})}class g_ extends Qh{constructor(e,t){super(t),this.context=e,this.production=!0,this._pending=[]}_createTransaction(e=!1){return this.context.db.transaction(["nodes","content"],e?"readwrite":"readonly")}_splitMetadata(e){const t=e.value,r=X({},e);return delete r.value,{metadata:r,value:t}}commit(){return V(this,null,function*(){if(this._pending.length===0)return;const e=this._pending.splice(0);this.context.ipc.sendNotification({action:"cache.invalidate",paths:e.map(r=>r.path)});const t=this._createTransaction(!0);try{yield new Promise((r,i)=>{let o=!1,s=0;const a=l=>{o=!0,i(l)},c=()=>{++s===e.length&&r()};e.forEach((l,u)=>{if(o)return;let h,y;const d=l.path;if(l.action==="set"){const{metadata:g,value:_}=this._splitMetadata(l.node),A={path:d,metadata:g};h=t.objectStore("nodes").put(A),y=t.objectStore("content").put(_,d),this.context.cache.set(d,l.node)}else l.action==="remove"?(h=t.objectStore("content").delete(d),y=t.objectStore("nodes").delete(d),this.context.cache.set(d,null)):a(new Error(`Unknown pending operation "${l.action}" on path "${d}" `));let f=0;h.onsuccess=y.onsuccess=()=>{++f===2&&c()},h.onerror=y.onerror=a})}),t.commit&&t.commit()}catch(r){throw console.error(r),t.abort&&t.abort(),r}})}rollback(e){return V(this,null,function*(){this._pending=[]})}get(e){return V(this,null,function*(){if(this.context.cache.has(e))return this.context.cache.get(e);const t=this._createTransaction(!1),r=xp(t.objectStore("nodes").get(e)),i=xp(t.objectStore("content").get(e));try{const o=yield Promise.all([r,i]);t.commit&&t.commit();const s=o[0];if(!s)return this.context.cache.set(e,null),null;const a=s.metadata;return a.value=o[1],this.context.cache.set(e,a),a}catch(o){throw console.error("IndexedDB get error",o),t.abort&&t.abort(),o}})}set(e,t){this._pending.push({action:"set",path:e,node:t})}remove(e){this._pending.push({action:"remove",path:e})}removeMultiple(e){return V(this,null,function*(){e.forEach(t=>{this._pending.push({action:"remove",path:t})})})}childrenOf(e,t,r,i){return this._getChildrenOf(e,qe(X({},t),{descendants:!1}),r,i)}descendantsOf(e,t,r,i){return this._getChildrenOf(e,qe(X({},t),{descendants:!0}),r,i)}_getChildrenOf(e,t,r,i){return new Promise((o,s)=>{const a=Go.PathInfo.get(e),c=this._createTransaction(!1),l=c.objectStore("nodes"),u=IDBKeyRange.lowerBound(e,!0),h=t.metadata?l.openCursor(u):l.openKeyCursor(u);h.onerror=y=>{var d;(d=c.abort)==null||d.call(c),s(y)},h.onsuccess=y=>V(this,null,function*(){var d,f,g;const _=(f=(d=h.result)==null?void 0:d.key)!=null?f:null;let A=!0;if(_===null)A=!1;else if(!a.isAncestorOf(_))A=!1;else if(t.descendants||a.isParentOf(_)){let P;if(t.metadata&&(P=h.result.value.metadata),r(_,P)){if(t.value)if(this.context.cache.has(_)){const B=this.context.cache.get(_);P.value=B.value}else{const B=c.objectStore("content").get(_);P.value=yield new Promise((C,L)=>{B.onerror=q=>{C(null)},B.onsuccess=q=>{C(B.result)}}),this.context.cache.set(_,P.value===null?null:P)}A=i(_,P)}}if(A)try{h.result.continue()}catch(P){A=!1}A||((g=c.commit)==null||g.call(c),o())})})}}function m_(n,e={}){const t=new p_(e),r=(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB).open(`${n}.acebase`,1);r.onupgradeneeded=u=>{const h=r.result;h.createObjectStore("nodes",{keyPath:"path"}),h.createObjectStore("content")};let i;const o=new Promise((u,h)=>{r.onsuccess=y=>{i=r.result,u()},r.onerror=y=>{h(y)}}),s=new qE(typeof t.cacheSeconds=="number"?t.cacheSeconds:60),a=new Xo({name:"IndexedDB",locking:!0,removeVoidProperties:t.removeVoidProperties,maxInlineValueSize:t.maxInlineValueSize,lockTimeout:t.lockTimeout,ready(){return o},getTransaction(u){return V(this,null,function*(){yield o;const h={debug:!1,db:i,cache:s,ipc:l};return new g_(h,u)})}}),c=new ws(n,{logLevel:t.logLevel,storage:a,sponsor:t.sponsor}),l=c.api.storage.ipc;return c.settings.ipcEvents=t.multipleTabs===!0,l.on("notification",u=>V(this,null,function*(){const h=u.data;if(typeof h=="object"&&h.action==="cache.invalidate")for(const y of h.paths)s.remove(y)})),c}const v_=`Using AceBase constructor in the browser to use localStorage is deprecated!
Switch to:
IndexedDB implementation (FASTER, MORE RELIABLE):
    let db = AceBase.WithIndexedDB(name, settings)
Or, new LocalStorage implementation:
    let db = AceBase.WithLocalStorage(name, settings)
Or, write your own CustomStorage adapter:
    let myCustomStorage = new CustomStorageSettings({ ... });
    let db = new AceBase(name, { storage: myCustomStorage })`;class ws extends y_{constructor(e,t){if(typeof t!="object"||typeof t.storage!="object")throw new Error(v_);super(e,t),this.settings.ipcEvents=t.multipleTabs===!0}static WithIndexedDB(e,t={}){return m_(e,t)}}const b_={AceBase:ws,AceBaseLocalSettings:gm,DataReference:Hn,DataSnapshot:nt,EventSubscription:Yg,PathReference:rt,TypeMappings:sm,CustomStorageSettings:Xo,CustomStorageTransaction:Qh,CustomStorageHelpers:Go,ID:Ft,proxyAccess:ya,DataSnapshotsArray:gc};window.acebase=b_;window.AceBase=ws;let w_=()=>Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),_l=(()=>"/ps"+w_()+"/pe")();const Ct={req:"/custom",create:{one:"/create-one",many:"/create-many"},send:{one:"/send-one",many:"/send-many"},find:{one:"/find-one",many:"/find-many"},get:{one:"/get-one",many:"/get-many"},query:{many:"/get-many"},update:{one:"/update-one",many:"/update-many"},delete:{one:"/delete-one",many:"/delete-many"}},Nt={create:"/create",find:"/find",get:"/get",query:"/get",update:"/update",delete:"/delete",req:"/custom",upload:"/upload",send:"/send",user:{base:"/user",example:"/user/device-connected",join:"",status:"/user/status",device:{connected:"/user/device-connected",removed:"/user/device-removed",disconnected:"/user/device-disconnected"}}},Ws={user:{base:"/user",device:{remove:"/user/device-remove",list:"/user/device-list"}},users:{base:"/users",device:{list:"/users/device-list"}}},On={base:"/auth",login:"/login/get-one",verify_token_code:"/verify-token-code/get-one",verify_pass_code:"/verify-pass-code/get-one",verify_email_code:"/verify-email-code/get-one",req:"/custom",user:"/user/"+_l+"/get-one",register:"/register/get-one",forgotPassword:"/forgot-password/get-one"+_l+"/get-one",deleteAccount:"/delete-account/get-one",refreshToken:"/refresh-token"+_l+"/get-one",users:{base:"/users"}};var Lo,mi,Ji,Do,er,mm,Au,Su,ga,tr,xn,Yi,qt;class k_{constructor(e={}){yn(this,Lo,"/on"),yn(this,mi,!0),yn(this,Ji,void 0),yn(this,Do,void 0),yn(this,er,void 0),yn(this,mm,void 0),yn(this,Au,void 0),yn(this,Su,void 0),yn(this,ga,new oE),yn(this,tr,void 0),yn(this,xn,void 0),yn(this,Yi,void 0),yn(this,qt,void 0),J1(this,"init",o=>{var s,a,c,l,u;let{ENV:h,HOST_SERVER:y,API_VERSION:d}=ke(this,Yi),f=()=>V(this,null,function*(){var p,v,m,w,E,b,k,x,$,S,T,R;let N="/transaction",z="/database",F=yield(m=(v=(p=ke(this,qt))==null?void 0:p.ref(N))==null?void 0:v.get())==null?void 0:m.catch(te=>{}),ne=yield(b=(E=(w=ke(this,qt))==null?void 0:w.ref(z))==null?void 0:E.get())==null?void 0:b.catch(te=>{});if(F.exists()){F=F.val();let te=Object.keys(F);if((te==null?void 0:te.length)>0){for(let pe in te){let oe=F[pe];(oe==null?void 0:oe.path)&&(oe==null?void 0:oe.method)&&(oe==null?void 0:oe.value)&&(yield this.init(o).database().ref(oe==null?void 0:oe.path).req(oe==null?void 0:oe.method,oe==null?void 0:oe.path,oe==null?void 0:oe.value).val())}ne.exists()&&(yield($=(x=(k=ke(this,qt))==null?void 0:k.ref(z))==null?void 0:x.remove())==null?void 0:$.catch(pe=>{})),yield(R=(T=(S=ke(this,qt))==null?void 0:S.ref(N))==null?void 0:T.remove())==null?void 0:R.catch(pe=>{})}}});(a=(s=o==null?void 0:o.socket)==null?void 0:s.auth)==null||a.on("connect",()=>{qr(this,xn,!0),f()}),(l=(c=o==null?void 0:o.socket)==null?void 0:c.auth)==null||l.on("disconnect",()=>{qr(this,xn,!1)});const g=(p={})=>{var v,m,w;let E={};if(p&&Object.keys(p).length>0&&(E.data=p),ke(this,er)&&(E.storage=ke(this,er),E.config=ke(this,Au)),ke(this,Su)){let b=new FormData;Array.isArray(p)?(p.map((k,x)=>{typeof k=="object"&&(k.attachmentName="attachment"+x,k==null||k.attachments.forEach($=>{$!=null&&$.data?b.append("attachments"+x,$==null?void 0:$.data,$==null?void 0:$.name):b.append("attachments"+x,$)}))}),b.append("field",JSON.stringify(E))):Array.isArray(p==null?void 0:p.attachments)&&(p==null||p.attachments.forEach(k=>{k!=null&&k.data?b.append("attachments",k==null?void 0:k.data,k==null?void 0:k.name):b.append("attachments",k)}),delete E.data.attachments,b.append("field",JSON.stringify(E))),E=b}else if(ke(this,er)&&(p==null?void 0:p.file)){let b=new FormData;p!=null&&p.file?((v=p.file)!=null&&v.data?b.append("file",(m=p.file)==null?void 0:m.data,(w=p.file)==null?void 0:w.name):b.append("file",p.file),delete E.data.file,b.append("field",JSON.stringify(E))):Array.isArray(p==null?void 0:p.directory)&&(p==null||p.directory.forEach(k=>{k!=null&&k.data?b.append("file",k==null?void 0:k.data,k==null?void 0:k.name):b.append("file",k)}),delete E.data.directory,b.append("field",JSON.stringify(E)),E=b),E=b}return E};let _=(p,v)=>V(this,null,function*(){var m,w,E,b,k,x,$,S;if(((m=p==null?void 0:p.error)==null?void 0:m.token)&&ke(this,mi)){if(qr(this,mi,!1),localStorage.getItem("refreshToken")){h==="dev"&&console.log("Token expired or not found: ",(w=p.error)==null?void 0:w.token," Trying to request a new refresh token");let T=yield(b=(E=this==null?void 0:this.init(o))==null?void 0:E.auth())==null?void 0:b.req(On.refreshToken,{token:localStorage.getItem("refreshToken")}).val();if(T!=null&&T.error)return h==="dev"&&console.log("Refresh token expired or not found: ",T),ke(this,Ji)&&(window.top.location.href=ke(this,Ji)),T;if(T!=null&&T.data&&(h==="dev"&&console.log("We got a new refresh token ,",T==null?void 0:T.data),(k=T==null?void 0:T.data)!=null&&k.token&&localStorage.setItem("accessToken",(x=T==null?void 0:T.data)==null?void 0:x.token),($=T==null?void 0:T.data)!=null&&$.refreshToken&&localStorage.setItem("refreshToken",(S=T==null?void 0:T.data)==null?void 0:S.refreshToken),h==="dev"&&console.log("Trying to restart your request..."),typeof v=="function"))return yield v()}}else return p});const A=(p,v,m,w=()=>{})=>{const E=ke(this,Lo);let b=v.version+E+v.base+m;b=b.replace(/\/\//g,"/"),h==="dev"&&console.log("socket listen local path: ",b),p==null||p.on(b,w)},P=(p,v=()=>{})=>{var m;const w=ke(this,Lo);let E=(d==null?void 0:d.AUTH)+w+p;E=E.replace(/\/\//g,"/"),h==="dev"&&console.log("emitter listen local path: ",E),(m=ke(this,ga))==null||m.on(E,v)};let B=(p,v,m,w)=>(ke(this,Do)&&(w=w+ke(this,Do)),{req:E=>(A(p,v,w+Nt.req,b=>{var k,x,$;(!((x=(k=b==null?void 0:b.error)==null?void 0:k.error)!=null&&x.token)&&!(($=b==null?void 0:b.error)!=null&&$.token)||(b==null?void 0:b.data))&&typeof E=="function"&&E(qe(X({},m),{value:b}))}),m),create:E=>(A(p,v,w+Nt.create,b=>{var k,x,$;(!((x=(k=b==null?void 0:b.error)==null?void 0:k.error)!=null&&x.token)&&!(($=b==null?void 0:b.error)!=null&&$.token)||(b==null?void 0:b.data))&&typeof E=="function"&&E(qe(X({},m),{value:b}))}),m),find:E=>(A(p,v,w+Nt.find,b=>{var k,x,$;(!((x=(k=b==null?void 0:b.error)==null?void 0:k.error)!=null&&x.token)&&!(($=b==null?void 0:b.error)!=null&&$.token)||(b==null?void 0:b.data))&&typeof E=="function"&&E(qe(X({},m),{value:b}))}),m),get:E=>(A(p,v,w+Nt.get,b=>{var k,x,$;(!((x=(k=b==null?void 0:b.error)==null?void 0:k.error)!=null&&x.token)&&!(($=b==null?void 0:b.error)!=null&&$.token)||(b==null?void 0:b.data))&&typeof E=="function"&&E(qe(X({},m),{value:b}))}),m),query:E=>(A(p,v,w+Nt.query,b=>{var k,x,$;(!((x=(k=b==null?void 0:b.error)==null?void 0:k.error)!=null&&x.token)&&!(($=b==null?void 0:b.error)!=null&&$.token)||(b==null?void 0:b.data))&&typeof E=="function"&&E(qe(X({},m),{value:b}))}),m),update:E=>(A(p,v,w+Nt.update,b=>{var k,x,$;(!((x=(k=b==null?void 0:b.error)==null?void 0:k.error)!=null&&x.token)&&!(($=b==null?void 0:b.error)!=null&&$.token)||(b==null?void 0:b.data))&&typeof E=="function"&&E(qe(X({},m),{value:b}))}),m),delete:E=>(A(p,v,w+Nt.delete,b=>{var k,x,$;(!((x=(k=b==null?void 0:b.error)==null?void 0:k.error)!=null&&x.token)&&!(($=b==null?void 0:b.error)!=null&&$.token)||(b==null?void 0:b.data))&&typeof E=="function"&&E(qe(X({},m),{value:b}))}),m)}),C=(p,v)=>({create:m=>(P(p+Nt.create,w=>{(!(w!=null&&w.error)||(w==null?void 0:w.data))&&typeof m=="function"&&m(qe(X({},v),{value:w}))}),v),find:m=>(P(p+Nt.find,w=>{(!(w!=null&&w.error)||(w==null?void 0:w.data))&&typeof m=="function"&&m(qe(X({},v),{value:w}))}),v),get:m=>(P(p+Nt.get,w=>{(!(w!=null&&w.error)||(w==null?void 0:w.data))&&typeof m=="function"&&m(qe(X({},v),{value:w}))}),v),query:m=>(P(p+Nt.query,w=>{(!(w!=null&&w.error)||(w==null?void 0:w.data))&&typeof m=="function"&&m(qe(X({},v),{value:w}))}),v),update:m=>(P(p+Nt.update,w=>{(!(w!=null&&w.error)||(w==null?void 0:w.data))&&typeof m=="function"&&m(qe(X({},v),{value:w}))}),v),delete:m=>(P(p+Nt.delete,w=>{(!(w!=null&&w.error)||(w==null?void 0:w.data))&&typeof m=="function"&&m(qe(X({},v),{value:w}))}),v)}),L=op.init(ke(this,Yi)),q=(p="",v={},m={},w={},E)=>{p=p.trim(),p.charAt(p.length-1)==="/"&&(p=p.slice(0,-1));let b=(()=>V(this,null,function*(){let k=()=>V(this,null,function*(){return yield L("post",y.AUTH+d.AUTH+On.base+p,g(v))}),x=yield k();return ke(this,mi)&&(x=yield _(x,()=>V(this,null,function*(){return yield k()}))),typeof E=="function"&&E(qe(X({},w),{value:x})),x}))();return qe(X({},w),{val:()=>b})},H=(p,v,m,w={},E={},b)=>{let k=(()=>V(this,null,function*(){let x=()=>V(this,null,function*(){return yield L(p,v,g(m),w)}),$=yield x();return ke(this,mi)&&($=yield _($,()=>V(this,null,function*(){return yield x()}))),typeof b=="function"&&b(qe(X({},E),{value:$})),$}))();return qe(X({},E),{val:()=>k})},j=p=>{let v={},m,[w={},,,]=p;if(p.length===1&&typeof w=="function"&&(m=p[0],w={}),p.length===2&&(typeof p[1]=="object"?v=p[1]:typeof p[1]=="function"&&(m=p[1])),p.length>=3){let[,E,b]=p;typeof E=="object"&&(v=E),m=b}return{data:w,onRequest:v,callback:m}},I=()=>Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),D=(p,v,m={},w,E)=>{v=v.replace(/\/\//g,"/");let b=(()=>V(this,null,function*(){var k,x,$,S,T,R,N,z,F,ne,te,pe,oe,re,ue,Ne,ye,It,Ce,He,Cr,Nr,Br;let Lr="/transaction",ge,Dr,ze={error:{message:"We could not execute the "+p+" method for path: "+v}};switch(p){case"create":yield($=(x=(k=ke(this,qt))==null?void 0:k.ref(v))==null?void 0:x.set(m))==null?void 0:$.catch(Ie=>ze);break;case"update":yield(R=(T=(S=ke(this,qt))==null?void 0:S.ref(v))==null?void 0:T.update(m))==null?void 0:R.catch(Ie=>ze);break;case"query":let we=(N=ke(this,qt))==null?void 0:N.query(v);Array.isArray(m==null?void 0:m.where)&&(yield Promise.all(m==null?void 0:m.where.map(Ie=>V(this,null,function*(){return yield new Promise(ht=>{we==null||we.filter(...Ie),ht()})})))),m!=null&&m.take&&(we==null||we.take(m==null?void 0:m.take)),m!=null&&m.skip&&(we==null||we.take(m==null?void 0:m.skip)),m!=null&&m.order&&Array.isArray(m==null?void 0:m.order)&&(yield Promise.all(m==null?void 0:m.order.map(Ie=>V(this,null,function*(){return yield new Promise(ht=>{we==null||we.sort(...Ie),ht()})})))),Dr=yield we==null?void 0:we.count(),ge=yield(z=we==null?void 0:we.get(X({},m==null?void 0:m.$option)))==null?void 0:z.catch(Ie=>ze);break;case"delete":ge=yield(te=(ne=(F=ke(this,qt))==null?void 0:F.ref(v))==null?void 0:ne.get())==null?void 0:te.catch(Ie=>ze),yield(re=(oe=(pe=ke(this,qt))==null?void 0:pe.ref(v))==null?void 0:oe.remove())==null?void 0:re.catch(Ie=>ze);break}if(p!=="delete"&&p!=="query"&&(ge=yield(ye=(Ne=(ue=ke(this,qt))==null?void 0:ue.ref(v))==null?void 0:Ne.get(X({},m==null?void 0:m.$option)))==null?void 0:ye.catch(we=>ze)),p==="query"?ge.exists()?(ge=ge==null?void 0:ge.getValues(),ge={data:ge,max:Dr,take:m==null?void 0:m.take,skip:m==null?void 0:m.skip}):ge=X({},ze):ge.exists()?(ge=ge==null?void 0:ge.val(),ge={data:ge}):ge=X({},ze),ke(this,tr)&&w.auth().$currentUserId&&!ke(this,xn)&&["create","delete","update"].includes(p)&&ge!=null&&ge.data){let we=yield(He=(Ce=(It=ke(this,qt))==null?void 0:It.ref(Lr))==null?void 0:Ce.get())==null?void 0:He.catch(_o=>ze);we.exists()?we=we.val():we={};let Ie,ht=Object.keys(we);switch(ht.length>0?Ie=ht.length+1:Ie=0,p){case"create":p="post";break;case"update":p="put";break;case"delete":p="delete";break}p!=="get"&&(yield(Br=(Nr=(Cr=ke(this,qt))==null?void 0:Cr.ref(Lr+"/"+Ie))==null?void 0:Nr.set({path:v,method:p,uid:Ie,value:ge.data}))==null?void 0:Br.catch(_o=>ze))}const Eo=ke(this,Lo);let qn=(d==null?void 0:d.AUTH)+Eo+v+"/"+p;return qn=qn.replace(/\/\//g,"/"),ke(this,ga).emit(qn,ge),typeof E=="function"&&E(qe(X({},w),{value:ge})),ge}))();return qe(X({},w),{val:()=>b})},M=({value:p,node:v},m)=>{var w,E,b,k;let x=p;if((w=x==null?void 0:x.data)!=null&&w.data){let $=(E=x==null?void 0:x.data)==null?void 0:E.data,S=(b=x==null?void 0:x.data)==null?void 0:b.refreshToken,T=(k=x==null?void 0:x.data)==null?void 0:k.token;T&&localStorage.setItem("accessToken",T),S&&localStorage.setItem("refreshToken",S),$&&localStorage.setItem("userInfo",JSON.stringify($))}typeof m=="function"&&m(qe(X({},v),{value:x}))},U=(p,v)=>{typeof p=="function"&&(v==null||v.on("connect",p))},O=(p,v)=>{let m="%"+p,w=this.init(o);return delete w.auth().login,delete w.auth().register,{$connected:ke(this,xn),private:(E=I())=>w.event(p+E),child:E=>w.event(p+E),emit:(E,b)=>(v==null||v.emit(m,E),typeof b=="function"&&w.event(p).do(b),X(X({},w.event(p)),w)),do:E=>(v==null||v.on(m,b=>{typeof E=="function"&&E(qe(X(X({},w.event(p)),w),{value:b}))}),X(X({},w.event(p)),w)),onAny:E=>{v==null||v.onAny((b,k)=>{typeof E=="function"&&E(b,X(X({value:k},w.event(b)),w))})}}};return{activity:()=>{let p=this.init(o);return{onStart:v=>(typeof v=="function"&&document.addEventListener("DOMContentLoaded",v),X(X({},p),p.activity())),onCreate:v=>(typeof v=="function"&&(window.onload=v),X(X({},p),p.activity())),onPause:v=>(window.addEventListener("beforeunload",function(m){typeof v=="function"&&v(),m.returnValue="onbeforeunload"}),X(X({},p),p.activity())),onResume:()=>X(X({},p),p.activity()),onLeave:v=>(typeof v=="function"&&(window.onunload=v),X(X({},p),p.activity()))}},socket:{auth:(u=o==null?void 0:o.socket)==null?void 0:u.auth},$randomUID:()=>gl(),$randomId:()=>I(),$axios:op,local:(p={})=>{const v=this.init(o);return delete v.local,delete v.auth().register,delete v.auth().login,{database:(m="/database")=>({ref:(w="/database")=>{let E=this.init(o);return delete E.auth().login,delete E.auth().register,w=w.trim(),w=w.replace(/\/\//g,"/"),m=m+"/"+w,m=m.replace(/\/\//g,"/"),w.charAt(w.length-1)==="/"&&(w=w.slice(0,-1)),{child:(b="")=>{var k,x;return b=b.trim(),b=b.replace(/\/\//g,"/"),b.charAt(b.length-1)==="/"&&(b=b.slice(0,-1)),b.charAt(0)!=="/"&&(b="/"+b),(x=(k=E.local())==null?void 0:k.database())==null?void 0:x.ref(w+b)},push:(...b)=>{var k,x;let $=gl();return!b.length>0?{getKey:()=>$}:(x=(k=E.local())==null?void 0:k.database())==null?void 0:x.ref(w+"/"+$).create(b)},create:(...b)=>{var k,x;let $=X(X({},(x=(k=E.local(p))==null?void 0:k.database())==null?void 0:x.ref(w)),E),{data:S,callback:T}=j(b);return D(p,"create",m,S,$)},get:(...b)=>{var k,x;let $=X(X({},(x=(k=E.local())==null?void 0:k.database())==null?void 0:x.ref(w)),E),{data:S,callback:T}=j(b);return D("get",m,S,$,T)},find:(...b)=>{var k,x;let $=X(X({},(x=(k=E.local())==null?void 0:k.database())==null?void 0:x.ref(w)),E),{data:S,callback:T}=j(b);return D("get",m,S,$,T)},query:()=>{},update:(...b)=>{var k,x;let $=X(X({},(x=(k=E.local())==null?void 0:k.database())==null?void 0:x.ref(w)),E),{data:S,callback:T}=j(b);return D("update",m,S,$,T)},delete:(...b)=>{var k,x;let $=X(X({},(x=(k=E.local())==null?void 0:k.database())==null?void 0:x.ref(w)),E),{data:S,callback:T}=j(b);return D("delete",m,S,$,T)},on:()=>{var b,k;let x=X(X({},(k=(b=E.local())==null?void 0:b.database())==null?void 0:k.ref(w)),E);return C(w,x)},onValue:b=>{var k,x,$,S,T,R,N;let z=X(X({},(x=(k=E.local())==null?void 0:k.database())==null?void 0:x.ref(w)),E),F=(S=($=E.local())==null?void 0:$.database())==null?void 0:S.ref(w);return(T=F==null?void 0:F.on())==null||T.create(b),(R=F==null?void 0:F.on())==null||R.update(b),(N=F==null?void 0:F.on())==null||N.delete(b),z}}}}),cache:(m="/cache")=>{var w;let E=this.init(o);return delete E.auth().login,delete E.auth().register,(w=E.local())==null?void 0:w.database(m)},storage:()=>({})}},$online:navigator==null?void 0:navigator.onLine,auth:()=>{var p;return{$io:(p=o==null?void 0:o.socket)==null?void 0:p.auth,connected:()=>{var v,m;return(m=(v=o==null?void 0:o.socket)==null?void 0:v.auth)==null?void 0:m.connected},event:v=>{var m;return O(v,(m=o==null?void 0:o.socket)==null?void 0:m.auth)},ready:v=>{var m;return U(v,(m=o==null?void 0:o.socket)==null?void 0:m.auth)},$currentUserId:(()=>{let v=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");return v.uid?v.uid:!1})(),$status:(()=>{let v=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");if(v.status)return v.status})(),status:(...v)=>{var m,w,E,b;let k,x,$=this.init(o);if(delete $.auth().login,delete $.auth().register,v.length===1)typeof v[0]=="string"?k=v[0]:typeof v[0]=="function"&&(x=v[0]);else if(v.length>=2){const[T,R]=v;typeof T=="string"&&(k=T),x=R}let S=(w=(m=o==null?void 0:o.socket)==null?void 0:m.auth)==null?void 0:w.id;if(S){if(!k){let T=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");T.uid&&(k=T.uid)}k&&S&&((b=(E=o==null?void 0:o.socket)==null?void 0:E.auth)==null||b.on((d==null?void 0:d.AUTH)+Nt.user.status,T=>{h==="dev"&&console.log("The user with id: ",k," is disconnected/connected: ",T==null?void 0:T.value),typeof x=="function"&&x(X({value:T},$))}))}return X({},$)},device:{connected:(...v)=>{var m,w,E,b;let k=this.init(o);delete k.auth().login,delete k.auth().register;let x,$;if(v.length===1)typeof v[0]=="string"?x=v[0]:typeof v[0]=="function"&&($=v[0]);else if(v.length>=2){const[T,R]=v;typeof T=="string"&&(x=T),$=R}let S=(w=(m=o==null?void 0:o.socket)==null?void 0:m.auth)==null?void 0:w.id;if(S){if(!x){let T=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");T.uid&&(x=T.uid)}x&&S&&((b=(E=o==null?void 0:o.socket)==null?void 0:E.auth)==null||b.on((d==null?void 0:d.AUTH)+Nt.user.device.connected,T=>{h==="dev"&&console.log("The user with id: ",x," has this device connected: ",T==null?void 0:T.value),typeof $=="function"&&$(qe(X(X({},k.auth().device),k),{value:T}))}))}return X(X({},k.auth().device),k)},disconnected:(...v)=>{var m,w,E,b;let k=this.init(o);delete k.auth().login,delete k.auth().register;let x,$;if(v.length===1)typeof v[0]=="string"?x=v[0]:typeof v[0]=="function"&&($=v[0]);else if(v.length>=2){const[T,R]=v;typeof T=="string"&&(x=T),$=R}let S=(w=(m=o==null?void 0:o.socket)==null?void 0:m.auth)==null?void 0:w.id;if(S){if(!x){let T=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");T.uid&&(x=T.uid)}x&&S&&((b=(E=o==null?void 0:o.socket)==null?void 0:E.auth)==null||b.on((d==null?void 0:d.AUTH)+Nt.user.device.disconnected,T=>{h==="dev"&&console.log("The user with id: ",x," has this device connected: ",T==null?void 0:T.value),typeof $=="function"&&$(qe(X(X({},k.auth().device),k),{value:T}))}))}return X(X({},k.auth().device),k)},remove:(...v)=>{var m,w,E,b,k,x;let $=this.init(o);delete $.auth().login,delete $.auth().register;let S,T;if(v.length===1)typeof v[0]=="string"?S=v[0]:typeof v[0]=="function"&&(T=v[0]);else if(v.length>=2){const[z,F]=v;(typeof z=="string"||Array.isArray(z))&&(S=z),T=F}let R=(w=(m=o==null?void 0:o.socket)==null?void 0:m.auth)==null?void 0:w.id,N=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");return S&&N.uid&&R&&((b=(E=o==null?void 0:o.socket)==null?void 0:E.auth)==null||b.emit((d==null?void 0:d.AUTH)+Ws.user.device.remove,{socketId:R,userId:S,currentUserId:N.uid}),(x=(k=o==null?void 0:o.socket)==null?void 0:k.auth)==null||x.on((d==null?void 0:d.AUTH)+Nt.user.device.removed,z=>{h==="dev"&&console.log("The user with id: ",S," has this device connected: ",z==null?void 0:z.value),typeof T=="function"&&T(qe(X(X({},$.auth().device),$),{value:z}))})),X(X({},$.auth().device),$)},list:(...v)=>{var m,w,E,b;let k=this.init(o);delete k.auth().login,delete k.auth().register;let x=Ws.users.device.list,$,S;if(v.length===1)typeof v[0]=="string"?$=v[0]:typeof v[0]=="function"&&(S=v[0]);else if(v.length>=2){const[N,z]=v;typeof N=="string"&&($=N,x=Ws.user.device.list),S=z}let T=(w=(m=o==null?void 0:o.socket)==null?void 0:m.auth)==null?void 0:w.id,R=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");return T&&R.uid&&($||(x=Ws.user.device.list,$=R.uid),$&&T&&((E=o==null?void 0:o.socket.auth)==null||E.emit((d==null?void 0:d.AUTH)+x,{socketId:T,userId:$,currenUserId:R.uid}),(b=o==null?void 0:o.socket.auth)==null||b.on((d==null?void 0:d.AUTH)+x+"/",N=>{h==="dev"&&console.log("The user with id: ",$," has these devices connected: ",res==null?void 0:res.value),typeof S=="function"&&S(qe(X(X({},k.auth().device),k),{value:N}))}))),X(X({},k.auth().device),k)}},req:(v,m,w)=>{let E=this.init(o);delete E.auth().login,delete E.auth().register;let b=X(X({},E),E.auth());return q(v+On.req,m,null,b,w)},$user:(()=>{let v=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");if(v.uid)return v})(),user:(...v)=>{let m,w;v.length>1?(typeof v[0]=="string"&&(m=v[0]),typeof v[1]=="function"&&(w=v[1])):v.length===1&&(typeof v[0]=="string"&&(m=v[0]),typeof v[0]=="function"&&(w=v[0]));let E=this.init(o);delete E.auth().login,delete E.auth().register;let b=X(X({},E),E.auth());if(!m||typeof m!="string"){let k=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}"),x=localStorage.getItem("accessToken"),$=(()=>{var S;try{let T=Jf(x);return(Date==null?void 0:Date.parse((S=new Date((T==null?void 0:T.exp)*1e3))==null?void 0:S.toString()))>Date.now()}catch(T){return!1}})();return k.uid&&$?(typeof w=="function"&&w(qe(X({},b),{value:k})),qe(X({},b),{val:()=>k})):q(On.user,{},null,null,({value:S})=>{var T;let R=S;R!=null&&R.data&&(R={data:(T=R==null?void 0:R.data)==null?void 0:T.data},R.data&&localStorage.setItem("userInfo",JSON.stringify(R.data))),typeof w=="function"&&w(qe(X({},b),{value:R}))})}else return q(On.user,{uid:m},null,null,({value:k})=>{var x;let $=k;$!=null&&$.data&&($={data:(x=$==null?void 0:$.data)==null?void 0:x.data}),typeof w=="function"&&w(qe(X({},b),{value:$}))})},verifyEmailCode:(v,m)=>{let w=this.init(o);return delete w.auth().login,delete w.auth().register,q(On.verify_email_code,v,null,null,({value:E})=>{M({value:E,node:w},m)})},verifyTokenCode:(v,m)=>{let w=this.init(o);return delete w.auth().login,delete w.auth().register,q(On.verify_token_code,v,null,null,({value:E})=>{M({value:E,node:w},m)})},verifyPassCode:(v,m)=>{let w=this.init(o);return delete w.auth().login,delete w.auth().register,q(On.verify_pass_code,v,null,null,({value:E})=>{M({value:E,node:w},m)})},login:(v,m)=>{let w=this.init(o);return delete w.auth().login,delete w.auth().register,q(On.login,v,null,null,({value:E})=>{M({value:E,node:w},m)})},loginWithToken:(v,m)=>{let w=this.init(o);return delete w.auth().login,delete w.auth().register,localStorage.setItem("userInfo","{}"),localStorage.setItem("accessToken",""),localStorage.setItem("refreshToken",v),this.init(o).auth.user(null,m)},logout:v=>{let m=this.init(o);return localStorage.removeItem("refreshToken"),localStorage.removeItem("userInfo"),localStorage.removeItem("accessToken"),(()=>V(this,null,function*(){var w,E,b,k,x,$;yield(b=(E=(w=ke(this,qt))==null?void 0:w.ref("/database"))==null?void 0:E.remove())==null?void 0:b.catch(S=>{}),yield($=(x=(k=ke(this,qt))==null?void 0:k.ref("/transaction"))==null?void 0:x.remove())==null?void 0:$.catch(S=>{})}))().then(w=>{}).catch(w=>{}),typeof v=="function"&&v(X(X({},m),m.auth())),X(X({},m),m.auth())},register:(v,m)=>{let w=this.init(o);return delete w.auth().login,delete w.auth().register,q(On.register,v,null,null,({value:E})=>{M({value:E,node:w},m)})},forgotPassword:(v,m)=>q(On.forgotPassword,v,null,null,m),users:()=>{let v=this.init(o);return delete v.auth().login,delete v.auth().register,v.ref("/users")},tokens:()=>{let v=this.init(o);return delete v.auth().login,delete v.auth().register,v.ref("/tokens")}}},syncDatabase:(p=!0)=>{const v=this.init(o);return qr(this,tr,typeof p=="boolean"?p:!0),v.database()},ref:(p="",v={host:y.AUTH,version:d.AUTH,base:On.base},m=(E=>(E=o==null?void 0:o.socket)==null?void 0:E.socket)(),w=!0)=>{p=p.trim(),p=p.replace(/\/\//g,"/"),p.charAt(0)==="/"&&p.length<=1&&(p="/root"),p.charAt(p.length-1)==="/"&&(p=p.slice(0,-1));const E=v.host+v.version+v.base+p;let b=this.init(o);return delete b.auth().login,delete b.auth().register,qr(this,mi,w),{push:(...k)=>{let x=gl();return!k.length>0?{getKey:()=>x}:b.ref(p+"/"+x,v,m).create(k)},private:(k=I())=>b.ref(p+"/ps"+k+"/pe",v,m),setAuthAccess:(k=!0,x=ke(this,Ji))=>(qr(this,Ji,x),b.ref(p,v,m,k)),req:(...k)=>{let x=X(X({},b.ref(p,v,m)),b);if(k.length>=2){let[$="post",S={},T={},R]=k;if(typeof $=="string"&&["post","put","delete","get"].includes($)){let N=Ct.req;return H($,E+N,S,T,x,R)}return x}else{let $=k.filter(S=>typeof S=="function");if($.length>0)$=$[0],typeof $=="function"&&$(x);else return x}},child:(k="")=>(k=k.trim(),k=k.replace(/\/\//g,"/"),k.charAt(k.length-1)==="/"&&(k=k.slice(0,-1)),k.charAt(0)!=="/"&&(k="/"+k),b.ref(p+k,v,m)),set:(...k)=>{var x;return(x=b.ref(p,v,m))==null?void 0:x.create(...k)},create:(...k)=>{var x,$,S,T;let R=X(X({},b.ref(p,v,m)),b);if(b.auth().$currentUserId&&p.includes("/users")&&ke(this,tr)&&!ke(this,xn))return(S=($=(x=b.local())==null?void 0:x.database())==null?void 0:$.ref(p))==null?void 0:S.create(...k);{let{data:N,onRequest:z,callback:F}=j(k),ne=Ct.create.one;if(ke(this,er)){if((N==null?void 0:N.file)||(N==null?void 0:N.directory))return(T=b.ref(p))==null?void 0:T.upload(N,null,F);Array.isArray(N.folders)&&(ne=Ct.create.many)}else Array!=null&&Array.isArray(N)&&(ne=Ct.create.many);return H("post",E+ne,N,z,R,F)}},find:(...k)=>{var x,$,S,T;if(console.log("Database connected: ",ke(this,xn)),b.auth().$currentUserId&&p.includes("/users")&&ke(this,tr)&&!ke(this,xn))return h==="dev"&&console.log("Find: We are offline"),(S=($=(x=b.local())==null?void 0:x.database())==null?void 0:$.ref(p))==null?void 0:S.find(...k);{h==="dev"&&console.log("Find: We are online");let R=X(X({},b.ref(p,v,m)),b),{data:N,onRequest:z,callback:F}=j(k),ne=Ct.find.one;return ke(this,er)?(Array.isArray(N==null?void 0:N.files)||Array.isArray(N==null?void 0:N.folders))&&(Array.isArray(N==null?void 0:N.files)&&(N.isFolder=!1),Array.isArray(N==null?void 0:N.folders)&&(N.isFolder=!0),ne=Ct.find.many):(((T=Object.keys(N))==null?void 0:T.length)<=0||N.order||N.where||N.$option||N.skip||N.take)&&(ne=Ct.find.many),H("post",E+ne,N,z,R,F)}},get:(...k)=>{var x,$,S,T;if(b.auth().$currentUserId&&p.includes("/users")&&ke(this,tr)&&!ke(this,xn))return(S=($=(x=b.local())==null?void 0:x.database())==null?void 0:$.ref(p))==null?void 0:S.get(...k);{let R=X(X({},b.ref(p,v,m)),b),{data:N,onRequest:z,callback:F}=j(k),ne=Ct.get.one;return ke(this,er)?(Array.isArray(N==null?void 0:N.files)||Array.isArray(N==null?void 0:N.folders))&&(Array.isArray(N==null?void 0:N.files)&&(N.isFolder=!1),Array.isArray(N==null?void 0:N.folders)&&(N.isFolder=!0),ne=Ct.get.many):(((T=Object.keys(N))==null?void 0:T.length)<=0||N.order||N.where||N.$option||N.skip||N.take)&&(ne=Ct.get.many),H("get",E+ne+"?query="+JSON.stringify(g(N)),null,z,R,F)}},query:(...k)=>{var x,$,S;if(b.auth().$currentUserId&&p.includes("/users")&&ke(this,tr)&&!ke(this,xn))return(S=($=(x=b.local())==null?void 0:x.database())==null?void 0:$.ref(p))==null?void 0:S.query(...k);{let T=X(X({},b.ref(p,v,m)),b),{data:R,onRequest:N,callback:z}=j(k);return(!R||R==="")&&(R={take:15},!ke(this,Do)&&!R.order&&(R.order={uid:"ASC"})),H("get",E+Ct.get.many+"?query="+JSON.stringify(g(R)),null,N,T,z)}},update:(...k)=>{var x,$,S;if(b.auth().$currentUserId&&p.includes("/users")&&ke(this,tr)&&!ke(this,xn))return(S=($=(x=b.local())==null?void 0:x.database())==null?void 0:$.ref(p))==null?void 0:S.update(...k);{let T=X(X({},b.ref(p,v,m)),b),{data:R,onRequest:N,callback:z}=j(k),F=Ct.update.one;return ke(this,er)?(Array.isArray(R==null?void 0:R.files)||Array.isArray(R==null?void 0:R.folders))&&(Array.isArray(R==null?void 0:R.files)&&(R.isFolder=!1),Array.isArray(R==null?void 0:R.folders)&&(R.isFolder=!0),F=Ct.update.many):Array.isArray(R)&&(F=Ct.find.many),H("put",E+F,R,N,T,z)}},delete:(...k)=>{var x,$,S;if(b.auth().$currentUserId&&p.includes("/users")&&ke(this,tr)&&!ke(this,xn))return(S=($=(x=b.local())==null?void 0:x.database())==null?void 0:$.ref(p))==null?void 0:S.delete(...k);{let T=X(X({},b.ref(p,v,m)),b),{data:R,onRequest:N,callback:z}=j(k),F=Ct.delete.one;return ke(this,er)?(Array.isArray(R==null?void 0:R.files)||Array.isArray(R==null?void 0:R.folders))&&(Array.isArray(R==null?void 0:R.files)&&(R.isFolder=!1),Array.isArray(R==null?void 0:R.folders)&&(R.isFolder=!0),Object.keys(R).length<=0&&(R.isFolder=!0),F=Ct.delete.many):(Array.isArray(R)||R.where)&&(F=Ct.delete.many),H("delete",E+F,R,N,T,z)}},on:()=>{let k=X(X({},b.ref(p,v,m)),b);return B(m,v,k,p)},onValue:k=>{let x=X(X({},b.ref(p,v,m)),b),$=b.ref(p,v,m);return $==null||$.on().create(k),$==null||$.on().update(k),$==null||$.on().delete(k),$==null||$.on().upload(k),x}}}}}),qr(this,Yi,e);let{ENV:t,OFFLINE_DB_NAME:r}=ke(this,Yi);qr(this,qt,ws.WithIndexedDB((r==null?void 0:r.AUTH)||"swyger_auth"));let i=()=>V(this,null,function*(){try{let o,s=localStorage.getItem("accessToken");if((()=>{var a;try{o=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");let c=Jf(s);return(Date==null?void 0:Date.parse((a=new Date((c==null?void 0:c.exp)*1e3))==null?void 0:a.toString()))<Date.now()}catch(c){return!1}})()&&o.uid)try{t==="dev"&&console.log("Token expired on inactivity, Trying to request a new refresh token")}catch(a){}}catch(o){}});"requestIdleCallback"in window&&requestIdleCallback(i)}}Lo=new WeakMap,mi=new WeakMap,Ji=new WeakMap,Do=new WeakMap,er=new WeakMap,mm=new WeakMap,Au=new WeakMap,Su=new WeakMap,ga=new WeakMap,tr=new WeakMap,xn=new WeakMap,Yi=new WeakMap,qt=new WeakMap;const x_={init:n=>{try{return(e={})=>new k_(n).init(e)}catch(e){return{}}}};let E_={init:n=>{var e,t,r;return{OFFLINE_DB_NAME:{AUTH:((e=n==null?void 0:n.OFFLINE_DB_NAME)==null?void 0:e.AUTH)||"swyger_auth"},ENV:(n==null?void 0:n.ENV)||"prod",HOST_SERVER:{AUTH:((t=n==null?void 0:n.HOST_SERVER)==null?void 0:t.AUTH)||"http://localhost:4100"},API_VERSION:{AUTH:((r=n==null?void 0:n.API_VERSION)==null?void 0:r.AUTH)||"/api/v1"},AUTO_REFRESH_TOKEN_TIMEOUT:(n==null?void 0:n.AUTO_REFRESH_TOKEN_TIMEOUT)||15e5,API_KEY:(n==null?void 0:n.API_KEY)||"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJzd3lnZXIuY29tIiwiaWF0IjoxNjUzNDQwOTkxLCJleHAiOjE2ODQ5NzY5OTEsImF1ZCI6ImRheW52ZXIuY29tIiwic3ViIjoidGVhbUBzd3lnZXIuY29tIiwiR2l2ZW5OYW1lIjoiSXZhbiBKb2VsIiwiU3VybmFtZSI6IlNvYmd1aSIsIkVtYWlsIjoidGVhbUBhZ2dsb215LmNvbSIsIlJvbGUiOlsiQWRtaW4iLCJQcm9qZWN0IEFkbWluaXN0cmF0b3IiXX0.UvlcjBahR9G8dKxIeENJ7k4I87t3_oNJQ16eyPsRcSE"}}};const __={init:n=>{let e=E_.init(n);const t=Bk.init(e),r={socket:{auth:t==null?void 0:t.auth,database:t==null?void 0:t.database,storage:t==null?void 0:t.storage}};return x_.init(e)(r)}};var Tu=function(n,e){return Tu=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])},Tu(n,e)};function vt(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Tu(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function $_(n,e,t,r){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{l(r.next(u))}catch(h){s(h)}}function c(u){try{l(r.throw(u))}catch(h){s(h)}}function l(u){u.done?o(u.value):i(u.value).then(a,c)}l((r=r.apply(n,e||[])).next())})}function ed(n,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(l){return function(u){return c([l,u])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,l[0]&&(t=0)),t;)try{if(r=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){t.label=l[1];break}if(l[0]===6&&t.label<o[1]){t.label=o[1],o=l;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(l);break}o[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(n,t)}catch(u){l=[6,u],i=0}finally{r=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function sn(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Je(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(s)throw s.error}}return o}function Ye(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return n.concat(o||Array.prototype.slice.call(e))}function eo(n){return this instanceof eo?(this.v=n,this):new eo(n)}function O_(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),i,o=[];return i={},s("next"),s("throw"),s("return"),i[Symbol.asyncIterator]=function(){return this},i;function s(y){r[y]&&(i[y]=function(d){return new Promise(function(f,g){o.push([y,d,f,g])>1||a(y,d)})})}function a(y,d){try{c(r[y](d))}catch(f){h(o[0][3],f)}}function c(y){y.value instanceof eo?Promise.resolve(y.value.v).then(l,u):h(o[0][2],y)}function l(y){a("next",y)}function u(y){a("throw",y)}function h(y,d){y(d),o.shift(),o.length&&a(o[0][0],o[0][1])}}function A_(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof sn=="function"?sn(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(o){t[o]=n[o]&&function(s){return new Promise(function(a,c){s=n[o](s),i(a,c,s.done,s.value)})}}function i(o,s,a,c){Promise.resolve(c).then(function(l){o({value:l,done:a})},s)}}function Pe(n){return typeof n=="function"}function Pi(n){var e=function(r){Error.call(r),r.stack=new Error().stack},t=n(e);return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var ma=Pi(function(n){return function(e){n(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(t,r){return r+1+") "+t.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function $r(n,e){if(n){var t=n.indexOf(e);0<=t&&n.splice(t,1)}}var dn=function(){function n(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return n.prototype.unsubscribe=function(){var e,t,r,i,o;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var a=sn(s),c=a.next();!c.done;c=a.next()){var l=c.value;l.remove(this)}}catch(g){e={error:g}}finally{try{c&&!c.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}else s.remove(this);var u=this.initialTeardown;if(Pe(u))try{u()}catch(g){o=g instanceof ma?g.errors:[g]}var h=this._finalizers;if(h){this._finalizers=null;try{for(var y=sn(h),d=y.next();!d.done;d=y.next()){var f=d.value;try{Ep(f)}catch(g){o=o!=null?o:[],g instanceof ma?o=Ye(Ye([],Je(o)),Je(g.errors)):o.push(g)}}}catch(g){r={error:g}}finally{try{d&&!d.done&&(i=y.return)&&i.call(y)}finally{if(r)throw r.error}}}if(o)throw new ma(o)}},n.prototype.add=function(e){var t;if(e&&e!==this)if(this.closed)Ep(e);else{if(e instanceof n){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}},n.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},n.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},n.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&$r(t,e)},n.prototype.remove=function(e){var t=this._finalizers;t&&$r(t,e),e instanceof n&&e._removeParent(this)},n.EMPTY=function(){var e=new n;return e.closed=!0,e}(),n}(),vm=dn.EMPTY;function bm(n){return n instanceof dn||n&&"closed"in n&&Pe(n.remove)&&Pe(n.add)&&Pe(n.unsubscribe)}function Ep(n){Pe(n)?n():n.unsubscribe()}var hi={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},td={setTimeout:function(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];var i=td.delegate;return i!=null&&i.setTimeout?i.setTimeout.apply(i,Ye([n,e],Je(t))):setTimeout.apply(void 0,Ye([n,e],Je(t)))},clearTimeout:function(n){return clearTimeout(n)},delegate:void 0};function wm(n){td.setTimeout(function(){var e=hi.onUnhandledError;if(e)e(n);else throw n})}function yt(){}var S_=function(){return nd("C",void 0,void 0)}();function T_(n){return nd("E",void 0,n)}function P_(n){return nd("N",n,void 0)}function nd(n,e,t){return{kind:n,value:e,error:t}}var xi=null;function va(n){if(hi.useDeprecatedSynchronousErrorHandling){var e=!xi;if(e&&(xi={errorThrown:!1,error:null}),n(),e){var t=xi,r=t.errorThrown,i=t.error;if(xi=null,r)throw i}}else n()}function j_(n){hi.useDeprecatedSynchronousErrorHandling&&xi&&(xi.errorThrown=!0,xi.error=n)}var mc=function(n){vt(e,n);function e(t){var r=n.call(this)||this;return r.isStopped=!1,t?(r.destination=t,bm(t)&&t.add(r)):r.destination=N_,r}return e.create=function(t,r,i){return new so(t,r,i)},e.prototype.next=function(t){this.isStopped?Ol(P_(t),this):this._next(t)},e.prototype.error=function(t){this.isStopped?Ol(T_(t),this):(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped?Ol(S_,this):(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,n.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(dn),R_=Function.prototype.bind;function $l(n,e){return R_.call(n,e)}var I_=function(){function n(e){this.partialObserver=e}return n.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(r){zs(r)}},n.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(r){zs(r)}else zs(e)},n.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(t){zs(t)}},n}(),so=function(n){vt(e,n);function e(t,r,i){var o=n.call(this)||this,s;if(Pe(t)||!t)s={next:t!=null?t:void 0,error:r!=null?r:void 0,complete:i!=null?i:void 0};else{var a;o&&hi.useDeprecatedNextContext?(a=Object.create(t),a.unsubscribe=function(){return o.unsubscribe()},s={next:t.next&&$l(t.next,a),error:t.error&&$l(t.error,a),complete:t.complete&&$l(t.complete,a)}):s=t}return o.destination=new I_(s),o}return e}(mc);function zs(n){hi.useDeprecatedSynchronousErrorHandling?j_(n):wm(n)}function C_(n){throw n}function Ol(n,e){var t=hi.onStoppedNotification;t&&td.setTimeout(function(){return t(n,e)})}var N_={closed:!0,next:yt,error:C_,complete:yt},vc=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Pt(n){return n}function rd(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return km(n)}function km(n){return n.length===0?Pt:n.length===1?n[0]:function(e){return n.reduce(function(t,r){return r(t)},e)}}var Ue=function(){function n(e){e&&(this._subscribe=e)}return n.prototype.lift=function(e){var t=new n;return t.source=this,t.operator=e,t},n.prototype.subscribe=function(e,t,r){var i=this,o=L_(e)?e:new so(e,t,r);return va(function(){var s=i,a=s.operator,c=s.source;o.add(a?a.call(o,c):c?i._subscribe(o):i._trySubscribe(o))}),o},n.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},n.prototype.forEach=function(e,t){var r=this;return t=_p(t),new t(function(i,o){var s=new so({next:function(a){try{e(a)}catch(c){o(c),s.unsubscribe()}},error:o,complete:i});r.subscribe(s)})},n.prototype._subscribe=function(e){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(e)},n.prototype[vc]=function(){return this},n.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return km(e)(this)},n.prototype.toPromise=function(e){var t=this;return e=_p(e),new e(function(r,i){var o;t.subscribe(function(s){return o=s},function(s){return i(s)},function(){return r(o)})})},n.create=function(e){return new n(e)},n}();function _p(n){var e;return(e=n!=null?n:hi.Promise)!==null&&e!==void 0?e:Promise}function B_(n){return n&&Pe(n.next)&&Pe(n.error)&&Pe(n.complete)}function L_(n){return n&&n instanceof mc||B_(n)&&bm(n)}function xm(n){return Pe(n==null?void 0:n.lift)}function me(n){return function(e){if(xm(e))return e.lift(function(t){try{return n(t,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function he(n,e,t,r,i){return new id(n,e,t,r,i)}var id=function(n){vt(e,n);function e(t,r,i,o,s,a){var c=n.call(this,t)||this;return c.onFinalize=s,c.shouldUnsubscribe=a,c._next=r?function(l){try{r(l)}catch(u){t.error(u)}}:n.prototype._next,c._error=o?function(l){try{o(l)}catch(u){t.error(u)}finally{this.unsubscribe()}}:n.prototype._error,c._complete=i?function(){try{i()}catch(l){t.error(l)}finally{this.unsubscribe()}}:n.prototype._complete,c}return e.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;n.prototype.unsubscribe.call(this),!r&&((t=this.onFinalize)===null||t===void 0||t.call(this))}},e}(mc);function Em(){return me(function(n,e){var t=null;n._refCount++;var r=he(e,void 0,void 0,void 0,function(){if(!n||n._refCount<=0||0<--n._refCount){t=null;return}var i=n._connection,o=t;t=null,i&&(!o||i===o)&&i.unsubscribe(),e.unsubscribe()});n.subscribe(r),r.closed||(t=n.connect())})}var bc=function(n){vt(e,n);function e(t,r){var i=n.call(this)||this;return i.source=t,i.subjectFactory=r,i._subject=null,i._refCount=0,i._connection=null,xm(t)&&(i.lift=t.lift),i}return e.prototype._subscribe=function(t){return this.getSubject().subscribe(t)},e.prototype.getSubject=function(){var t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject},e.prototype._teardown=function(){this._refCount=0;var t=this._connection;this._subject=this._connection=null,t==null||t.unsubscribe()},e.prototype.connect=function(){var t=this,r=this._connection;if(!r){r=this._connection=new dn;var i=this.getSubject();r.add(this.source.subscribe(he(i,void 0,function(){t._teardown(),i.complete()},function(o){t._teardown(),i.error(o)},function(){return t._teardown()}))),r.closed&&(this._connection=null,r=dn.EMPTY)}return r},e.prototype.refCount=function(){return Em()(this)},e}(Ue),_m={now:function(){return(_m.delegate||performance).now()},delegate:void 0},Zo={schedule:function(n){var e=requestAnimationFrame,t=cancelAnimationFrame,r=e(function(i){t=void 0,n(i)});return new dn(function(){return t==null?void 0:t(r)})},requestAnimationFrame:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Zo.delegate;return((t==null?void 0:t.requestAnimationFrame)||requestAnimationFrame).apply(void 0,Ye([],Je(n)))},cancelAnimationFrame:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return cancelAnimationFrame.apply(void 0,Ye([],Je(n)))},delegate:void 0};function D_(n){return n?$m(n):q_}function $m(n){return new Ue(function(e){var t=n||_m,r=t.now(),i=0,o=function(){e.closed||(i=Zo.requestAnimationFrame(function(s){i=0;var a=t.now();e.next({timestamp:n?a:s,elapsed:a-r}),o()}))};return o(),function(){i&&Zo.cancelAnimationFrame(i)}})}var q_=$m(),Om=Pi(function(n){return function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),xt=function(n){vt(e,n);function e(){var t=n.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return e.prototype.lift=function(t){var r=new $p(this,this);return r.operator=t,r},e.prototype._throwIfClosed=function(){if(this.closed)throw new Om},e.prototype.next=function(t){var r=this;va(function(){var i,o;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var s=sn(r.currentObservers),a=s.next();!a.done;a=s.next()){var c=a.value;c.next(t)}}catch(l){i={error:l}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}}})},e.prototype.error=function(t){var r=this;va(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=t;for(var i=r.observers;i.length;)i.shift().error(t)}})},e.prototype.complete=function(){var t=this;va(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var r=t.observers;r.length;)r.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(t){return this._throwIfClosed(),n.prototype._trySubscribe.call(this,t)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var r=this,i=this,o=i.hasError,s=i.isStopped,a=i.observers;return o||s?vm:(this.currentObservers=null,a.push(t),new dn(function(){r.currentObservers=null,$r(a,t)}))},e.prototype._checkFinalizedStatuses=function(t){var r=this,i=r.hasError,o=r.thrownError,s=r.isStopped;i?t.error(o):s&&t.complete()},e.prototype.asObservable=function(){var t=new Ue;return t.source=this,t},e.create=function(t,r){return new $p(t,r)},e}(Ue),$p=function(n){vt(e,n);function e(t,r){var i=n.call(this)||this;return i.destination=t,i.source=r,i}return e.prototype.next=function(t){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.next)===null||i===void 0||i.call(r,t)},e.prototype.error=function(t){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.error)===null||i===void 0||i.call(r,t)},e.prototype.complete=function(){var t,r;(r=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||r===void 0||r.call(t)},e.prototype._subscribe=function(t){var r,i;return(i=(r=this.source)===null||r===void 0?void 0:r.subscribe(t))!==null&&i!==void 0?i:vm},e}(xt),Am=function(n){vt(e,n);function e(t){var r=n.call(this)||this;return r._value=t,r}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(t){var r=n.prototype._subscribe.call(this,t);return!r.closed&&t.next(this._value),r},e.prototype.getValue=function(){var t=this,r=t.hasError,i=t.thrownError,o=t._value;if(r)throw i;return this._throwIfClosed(),o},e.prototype.next=function(t){n.prototype.next.call(this,this._value=t)},e}(xt),wc={now:function(){return(wc.delegate||Date).now()},delegate:void 0},od=function(n){vt(e,n);function e(t,r,i){t===void 0&&(t=1/0),r===void 0&&(r=1/0),i===void 0&&(i=wc);var o=n.call(this)||this;return o._bufferSize=t,o._windowTime=r,o._timestampProvider=i,o._buffer=[],o._infiniteTimeWindow=!0,o._infiniteTimeWindow=r===1/0,o._bufferSize=Math.max(1,t),o._windowTime=Math.max(1,r),o}return e.prototype.next=function(t){var r=this,i=r.isStopped,o=r._buffer,s=r._infiniteTimeWindow,a=r._timestampProvider,c=r._windowTime;i||(o.push(t),!s&&o.push(a.now()+c)),this._trimBuffer(),n.prototype.next.call(this,t)},e.prototype._subscribe=function(t){this._throwIfClosed(),this._trimBuffer();for(var r=this._innerSubscribe(t),i=this,o=i._infiniteTimeWindow,s=i._buffer,a=s.slice(),c=0;c<a.length&&!t.closed;c+=o?1:2)t.next(a[c]);return this._checkFinalizedStatuses(t),r},e.prototype._trimBuffer=function(){var t=this,r=t._bufferSize,i=t._timestampProvider,o=t._buffer,s=t._infiniteTimeWindow,a=(s?1:2)*r;if(r<1/0&&a<o.length&&o.splice(0,o.length-a),!s){for(var c=i.now(),l=0,u=1;u<o.length&&o[u]<=c;u+=2)l=u;l&&o.splice(0,l+1)}},e}(xt),sd=function(n){vt(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t._value=null,t._hasValue=!1,t._isComplete=!1,t}return e.prototype._checkFinalizedStatuses=function(t){var r=this,i=r.hasError,o=r._hasValue,s=r._value,a=r.thrownError,c=r.isStopped,l=r._isComplete;i?t.error(a):(c||l)&&(o&&t.next(s),t.complete())},e.prototype.next=function(t){this.isStopped||(this._value=t,this._hasValue=!0)},e.prototype.complete=function(){var t=this,r=t._hasValue,i=t._value,o=t._isComplete;o||(this._isComplete=!0,r&&n.prototype.next.call(this,i),n.prototype.complete.call(this))},e}(xt),U_=function(n){vt(e,n);function e(t,r){return n.call(this)||this}return e.prototype.schedule=function(t,r){return this},e}(dn),Pu={setInterval:function(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];var i=Pu.delegate;return i!=null&&i.setInterval?i.setInterval.apply(i,Ye([n,e],Je(t))):setInterval.apply(void 0,Ye([n,e],Je(t)))},clearInterval:function(n){return clearInterval(n)},delegate:void 0},ks=function(n){vt(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.scheduler=t,i.work=r,i.pending=!1,i}return e.prototype.schedule=function(t,r){var i;if(r===void 0&&(r=0),this.closed)return this;this.state=t;var o=this.id,s=this.scheduler;return o!=null&&(this.id=this.recycleAsyncId(s,o,r)),this.pending=!0,this.delay=r,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(s,this.id,r),this},e.prototype.requestAsyncId=function(t,r,i){return i===void 0&&(i=0),Pu.setInterval(t.flush.bind(t,this),i)},e.prototype.recycleAsyncId=function(t,r,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return r;r!=null&&Pu.clearInterval(r)},e.prototype.execute=function(t,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(t,r);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,r){var i=!1,o;try{this.work(t)}catch(s){i=!0,o=s||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),o},e.prototype.unsubscribe=function(){if(!this.closed){var t=this,r=t.id,i=t.scheduler,o=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,$r(o,this),r!=null&&(this.id=this.recycleAsyncId(i,r,null)),this.delay=null,n.prototype.unsubscribe.call(this)}},e}(U_),M_=1,Al,ju={};function Op(n){return n in ju?(delete ju[n],!0):!1}var Sm={setImmediate:function(n){var e=M_++;return ju[e]=!0,Al||(Al=Promise.resolve()),Al.then(function(){return Op(e)&&n()}),e},clearImmediate:function(n){Op(n)}},F_=Sm.setImmediate,V_=Sm.clearImmediate,Ru={setImmediate:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Ru.delegate;return((t==null?void 0:t.setImmediate)||F_).apply(void 0,Ye([],Je(n)))},clearImmediate:function(n){return V_(n)},delegate:void 0},K_=function(n){vt(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.scheduler=t,i.work=r,i}return e.prototype.requestAsyncId=function(t,r,i){return i===void 0&&(i=0),i!==null&&i>0?n.prototype.requestAsyncId.call(this,t,r,i):(t.actions.push(this),t._scheduled||(t._scheduled=Ru.setImmediate(t.flush.bind(t,void 0))))},e.prototype.recycleAsyncId=function(t,r,i){var o;if(i===void 0&&(i=0),i!=null?i>0:this.delay>0)return n.prototype.recycleAsyncId.call(this,t,r,i);var s=t.actions;r!=null&&((o=s[s.length-1])===null||o===void 0?void 0:o.id)!==r&&(Ru.clearImmediate(r),t._scheduled===r&&(t._scheduled=void 0))},e}(ks),Iu=function(){function n(e,t){t===void 0&&(t=n.now),this.schedulerActionCtor=e,this.now=t}return n.prototype.schedule=function(e,t,r){return t===void 0&&(t=0),new this.schedulerActionCtor(this,e).schedule(r,t)},n.now=wc.now,n}(),xs=function(n){vt(e,n);function e(t,r){r===void 0&&(r=Iu.now);var i=n.call(this,t,r)||this;return i.actions=[],i._active=!1,i}return e.prototype.flush=function(t){var r=this.actions;if(this._active){r.push(t);return}var i;this._active=!0;do if(i=t.execute(t.state,t.delay))break;while(t=r.shift());if(this._active=!1,i){for(;t=r.shift();)t.unsubscribe();throw i}},e}(Iu),W_=function(n){vt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.flush=function(t){this._active=!0;var r=this._scheduled;this._scheduled=void 0;var i=this.actions,o;t=t||i.shift();do if(o=t.execute(t.state,t.delay))break;while((t=i[0])&&t.id===r&&i.shift());if(this._active=!1,o){for(;(t=i[0])&&t.id===r&&i.shift();)t.unsubscribe();throw o}},e}(xs),Tm=new W_(K_),z_=Tm,Bn=new xs(ks),ad=Bn,H_=function(n){vt(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.scheduler=t,i.work=r,i}return e.prototype.schedule=function(t,r){return r===void 0&&(r=0),r>0?n.prototype.schedule.call(this,t,r):(this.delay=r,this.state=t,this.scheduler.flush(this),this)},e.prototype.execute=function(t,r){return r>0||this.closed?n.prototype.execute.call(this,t,r):this._execute(t,r)},e.prototype.requestAsyncId=function(t,r,i){return i===void 0&&(i=0),i!=null&&i>0||i==null&&this.delay>0?n.prototype.requestAsyncId.call(this,t,r,i):(t.flush(this),0)},e}(ks),J_=function(n){vt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e}(xs),Pm=new J_(H_),Y_=Pm,G_=function(n){vt(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.scheduler=t,i.work=r,i}return e.prototype.requestAsyncId=function(t,r,i){return i===void 0&&(i=0),i!==null&&i>0?n.prototype.requestAsyncId.call(this,t,r,i):(t.actions.push(this),t._scheduled||(t._scheduled=Zo.requestAnimationFrame(function(){return t.flush(void 0)})))},e.prototype.recycleAsyncId=function(t,r,i){var o;if(i===void 0&&(i=0),i!=null?i>0:this.delay>0)return n.prototype.recycleAsyncId.call(this,t,r,i);var s=t.actions;r!=null&&((o=s[s.length-1])===null||o===void 0?void 0:o.id)!==r&&(Zo.cancelAnimationFrame(r),t._scheduled=void 0)},e}(ks),X_=function(n){vt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.flush=function(t){this._active=!0;var r=this._scheduled;this._scheduled=void 0;var i=this.actions,o;t=t||i.shift();do if(o=t.execute(t.state,t.delay))break;while((t=i[0])&&t.id===r&&i.shift());if(this._active=!1,o){for(;(t=i[0])&&t.id===r&&i.shift();)t.unsubscribe();throw o}},e}(xs),jm=new X_(G_),Z_=jm,Q_=function(n){vt(e,n);function e(t,r){t===void 0&&(t=Rm),r===void 0&&(r=1/0);var i=n.call(this,t,function(){return i.frame})||this;return i.maxFrames=r,i.frame=0,i.index=-1,i}return e.prototype.flush=function(){for(var t=this,r=t.actions,i=t.maxFrames,o,s;(s=r[0])&&s.delay<=i&&(r.shift(),this.frame=s.delay,!(o=s.execute(s.state,s.delay))););if(o){for(;s=r.shift();)s.unsubscribe();throw o}},e.frameTimeFactor=10,e}(xs),Rm=function(n){vt(e,n);function e(t,r,i){i===void 0&&(i=t.index+=1);var o=n.call(this,t,r)||this;return o.scheduler=t,o.work=r,o.index=i,o.active=!0,o.index=t.index=i,o}return e.prototype.schedule=function(t,r){if(r===void 0&&(r=0),Number.isFinite(r)){if(!this.id)return n.prototype.schedule.call(this,t,r);this.active=!1;var i=new e(this.scheduler,this.work);return this.add(i),i.schedule(t,r)}else return dn.EMPTY},e.prototype.requestAsyncId=function(t,r,i){i===void 0&&(i=0),this.delay=t.frame+i;var o=t.actions;return o.push(this),o.sort(e.sortActions),1},e.prototype.recycleAsyncId=function(t,r,i){},e.prototype._execute=function(t,r){if(this.active===!0)return n.prototype._execute.call(this,t,r)},e.sortActions=function(t,r){return t.delay===r.delay?t.index===r.index?0:t.index>r.index?1:-1:t.delay>r.delay?1:-1},e}(ks),pr=new Ue(function(n){return n.complete()});function e$(n){return n?t$(n):pr}function t$(n){return new Ue(function(e){return n.schedule(function(){return e.complete()})})}function kc(n){return n&&Pe(n.schedule)}function cd(n){return n[n.length-1]}function Es(n){return Pe(cd(n))?n.pop():void 0}function Sr(n){return kc(cd(n))?n.pop():void 0}function Im(n,e){return typeof cd(n)=="number"?n.pop():e}var ld=function(n){return n&&typeof n.length=="number"&&typeof n!="function"};function Cm(n){return Pe(n==null?void 0:n.then)}function Nm(n){return Pe(n[vc])}function Bm(n){return Symbol.asyncIterator&&Pe(n==null?void 0:n[Symbol.asyncIterator])}function Lm(n){return new TypeError("You provided "+(n!==null&&typeof n=="object"?"an invalid object":"'"+n+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function n$(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Dm=n$();function qm(n){return Pe(n==null?void 0:n[Dm])}function Um(n){return O_(this,arguments,function(){var e,t,r,i;return ed(this,function(o){switch(o.label){case 0:e=n.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,eo(e.read())];case 3:return t=o.sent(),r=t.value,i=t.done,i?[4,eo(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,eo(r)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function Mm(n){return Pe(n==null?void 0:n.getReader)}function _e(n){if(n instanceof Ue)return n;if(n!=null){if(Nm(n))return r$(n);if(ld(n))return i$(n);if(Cm(n))return o$(n);if(Bm(n))return Fm(n);if(qm(n))return s$(n);if(Mm(n))return a$(n)}throw Lm(n)}function r$(n){return new Ue(function(e){var t=n[vc]();if(Pe(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function i$(n){return new Ue(function(e){for(var t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}function o$(n){return new Ue(function(e){n.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,wm)})}function s$(n){return new Ue(function(e){var t,r;try{for(var i=sn(n),o=i.next();!o.done;o=i.next()){var s=o.value;if(e.next(s),e.closed)return}}catch(a){t={error:a}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}e.complete()})}function Fm(n){return new Ue(function(e){c$(n,e).catch(function(t){return e.error(t)})})}function a$(n){return Fm(Um(n))}function c$(n,e){var t,r,i,o;return $_(this,void 0,void 0,function(){var s,a;return ed(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),t=A_(n),c.label=1;case 1:return[4,t.next()];case 2:if(r=c.sent(),!!r.done)return[3,4];if(s=r.value,e.next(s),e.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),i={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),r&&!r.done&&(o=t.return)?[4,o.call(t)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function an(n,e,t,r,i){r===void 0&&(r=0),i===void 0&&(i=!1);var o=e.schedule(function(){t(),i?n.add(this.schedule(null,r)):this.unsubscribe()},r);if(n.add(o),!i)return o}function xc(n,e){return e===void 0&&(e=0),me(function(t,r){t.subscribe(he(r,function(i){return an(r,n,function(){return r.next(i)},e)},function(){return an(r,n,function(){return r.complete()},e)},function(i){return an(r,n,function(){return r.error(i)},e)}))})}function Ec(n,e){return e===void 0&&(e=0),me(function(t,r){r.add(n.schedule(function(){return t.subscribe(r)},e))})}function l$(n,e){return _e(n).pipe(Ec(e),xc(e))}function u$(n,e){return _e(n).pipe(Ec(e),xc(e))}function h$(n,e){return new Ue(function(t){var r=0;return e.schedule(function(){r===n.length?t.complete():(t.next(n[r++]),t.closed||this.schedule())})})}function Vm(n,e){return new Ue(function(t){var r;return an(t,e,function(){r=n[Dm](),an(t,e,function(){var i,o,s;try{i=r.next(),o=i.value,s=i.done}catch(a){t.error(a);return}s?t.complete():t.next(o)},0,!0)}),function(){return Pe(r==null?void 0:r.return)&&r.return()}})}function Km(n,e){if(!n)throw new Error("Iterable cannot be null");return new Ue(function(t){an(t,e,function(){var r=n[Symbol.asyncIterator]();an(t,e,function(){r.next().then(function(i){i.done?t.complete():t.next(i.value)})},0,!0)})})}function d$(n,e){return Km(Um(n),e)}function Wm(n,e){if(n!=null){if(Nm(n))return l$(n,e);if(ld(n))return h$(n,e);if(Cm(n))return u$(n,e);if(Bm(n))return Km(n,e);if(qm(n))return Vm(n,e);if(Mm(n))return d$(n,e)}throw Lm(n)}function Tr(n,e){return e?Wm(n,e):_e(n)}function ud(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Sr(n);return Tr(n,t)}function zm(n,e){var t=Pe(n)?n:function(){return n},r=function(i){return i.error(t())};return new Ue(e?function(i){return e.schedule(r,0,i)}:r)}var Cu;(function(n){n.NEXT="N",n.ERROR="E",n.COMPLETE="C"})(Cu||(Cu={}));var ba=function(){function n(e,t,r){this.kind=e,this.value=t,this.error=r,this.hasValue=e==="N"}return n.prototype.observe=function(e){return Hm(this,e)},n.prototype.do=function(e,t,r){var i=this,o=i.kind,s=i.value,a=i.error;return o==="N"?e==null?void 0:e(s):o==="E"?t==null?void 0:t(a):r==null?void 0:r()},n.prototype.accept=function(e,t,r){var i;return Pe((i=e)===null||i===void 0?void 0:i.next)?this.observe(e):this.do(e,t,r)},n.prototype.toObservable=function(){var e=this,t=e.kind,r=e.value,i=e.error,o=t==="N"?ud(r):t==="E"?zm(function(){return i}):t==="C"?pr:0;if(!o)throw new TypeError("Unexpected notification kind "+t);return o},n.createNext=function(e){return new n("N",e)},n.createError=function(e){return new n("E",void 0,e)},n.createComplete=function(){return n.completeNotification},n.completeNotification=new n("C"),n}();function Hm(n,e){var t,r,i,o=n,s=o.kind,a=o.value,c=o.error;if(typeof s!="string")throw new TypeError('Invalid notification, missing "kind"');s==="N"?(t=e.next)===null||t===void 0||t.call(e,a):s==="E"?(r=e.error)===null||r===void 0||r.call(e,c):(i=e.complete)===null||i===void 0||i.call(e)}function f$(n){return!!n&&(n instanceof Ue||Pe(n.lift)&&Pe(n.subscribe))}var ji=Pi(function(n){return function(){n(this),this.name="EmptyError",this.message="no elements in sequence"}});function p$(n,e){var t=typeof e=="object";return new Promise(function(r,i){var o=!1,s;n.subscribe({next:function(a){s=a,o=!0},error:i,complete:function(){o?r(s):t?r(e.defaultValue):i(new ji)}})})}function y$(n,e){var t=typeof e=="object";return new Promise(function(r,i){var o=new so({next:function(s){r(s),o.unsubscribe()},error:i,complete:function(){t?r(e.defaultValue):i(new ji)}});n.subscribe(o)})}var Nu=Pi(function(n){return function(){n(this),this.name="ArgumentOutOfRangeError",this.message="argument out of range"}}),Jm=Pi(function(n){return function(e){n(this),this.name="NotFoundError",this.message=e}}),Ym=Pi(function(n){return function(e){n(this),this.name="SequenceError",this.message=e}});function hd(n){return n instanceof Date&&!isNaN(n)}var Gm=Pi(function(n){return function(e){e===void 0&&(e=null),n(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=e}});function Xm(n,e){var t=hd(n)?{first:n}:typeof n=="number"?{each:n}:n,r=t.first,i=t.each,o=t.with,s=o===void 0?g$:o,a=t.scheduler,c=a===void 0?e!=null?e:Bn:a,l=t.meta,u=l===void 0?null:l;if(r==null&&i==null)throw new TypeError("No timeout provided.");return me(function(h,y){var d,f,g=null,_=0,A=function(P){f=an(y,c,function(){try{d.unsubscribe(),_e(s({meta:u,lastValue:g,seen:_})).subscribe(y)}catch(B){y.error(B)}},P)};d=h.subscribe(he(y,function(P){f==null||f.unsubscribe(),_++,y.next(g=P),i>0&&A(i)},void 0,void 0,function(){f!=null&&f.closed||f==null||f.unsubscribe(),g=null})),!_&&A(r!=null?typeof r=="number"?r:+r-c.now():i)})}function g$(n){throw new Gm(n)}function Ri(n,e){return me(function(t,r){var i=0;t.subscribe(he(r,function(o){r.next(n.call(e,o,i++))}))})}var m$=Array.isArray;function v$(n,e){return m$(e)?n.apply(void 0,Ye([],Je(e))):n(e)}function Ii(n){return Ri(function(e){return v$(n,e)})}function Ga(n,e,t,r){if(t)if(kc(t))r=t;else return function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return Ga(n,e,r).apply(this,i).pipe(Ii(t))};return r?function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return Ga(n,e).apply(this,i).pipe(Ec(r),xc(r))}:function(){for(var i=this,o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];var a=new sd,c=!0;return new Ue(function(l){var u=a.subscribe(l);if(c){c=!1;var h=!1,y=!1;e.apply(i,Ye(Ye([],Je(o)),[function(){for(var d=[],f=0;f<arguments.length;f++)d[f]=arguments[f];if(n){var g=d.shift();if(g!=null){a.error(g);return}}a.next(1<d.length?d:d[0]),y=!0,h&&a.complete()}])),y&&a.complete(),h=!0}return u})}}function b$(n,e,t){return Ga(!1,n,e,t)}function w$(n,e,t){return Ga(!0,n,e,t)}var k$=Array.isArray,x$=Object.getPrototypeOf,E$=Object.prototype,_$=Object.keys;function Zm(n){if(n.length===1){var e=n[0];if(k$(e))return{args:e,keys:null};if($$(e)){var t=_$(e);return{args:t.map(function(r){return e[r]}),keys:t}}}return{args:n,keys:null}}function $$(n){return n&&typeof n=="object"&&x$(n)===E$}function Qm(n,e){return n.reduce(function(t,r,i){return t[r]=e[i],t},{})}function ev(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Sr(n),r=Es(n),i=Zm(n),o=i.args,s=i.keys;if(o.length===0)return Tr([],t);var a=new Ue(tv(o,t,s?function(c){return Qm(s,c)}:Pt));return r?a.pipe(Ii(r)):a}function tv(n,e,t){return t===void 0&&(t=Pt),function(r){Ap(e,function(){for(var i=n.length,o=new Array(i),s=i,a=i,c=function(u){Ap(e,function(){var h=Tr(n[u],e),y=!1;h.subscribe(he(r,function(d){o[u]=d,y||(y=!0,a--),a||r.next(t(o.slice()))},function(){--s||r.complete()}))},r)},l=0;l<i;l++)c(l)},r)}}function Ap(n,e,t){n?an(t,n,e):e()}function dd(n,e,t,r,i,o,s,a){var c=[],l=0,u=0,h=!1,y=function(){h&&!c.length&&!l&&e.complete()},d=function(g){return l<r?f(g):c.push(g)},f=function(g){o&&e.next(g),l++;var _=!1;_e(t(g,u++)).subscribe(he(e,function(A){i==null||i(A),o?d(A):e.next(A)},function(){_=!0},void 0,function(){if(_)try{l--;for(var A=function(){var P=c.shift();s?an(e,s,function(){return f(P)}):f(P)};c.length&&l<r;)A();y()}catch(P){e.error(P)}}))};return n.subscribe(he(e,d,function(){h=!0,y()})),function(){a==null||a()}}function Jn(n,e,t){return t===void 0&&(t=1/0),Pe(e)?Jn(function(r,i){return Ri(function(o,s){return e(r,o,i,s)})(_e(n(r,i)))},t):(typeof e=="number"&&(t=e),me(function(r,i){return dd(r,i,n,t)}))}function _c(n){return n===void 0&&(n=1/0),Jn(Pt,n)}function fd(){return _c(1)}function Qo(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return fd()(Tr(n,Sr(n)))}function $c(n){return new Ue(function(e){_e(n()).subscribe(e)})}var O$={connector:function(){return new xt},resetOnDisconnect:!0};function A$(n,e){e===void 0&&(e=O$);var t=null,r=e.connector,i=e.resetOnDisconnect,o=i===void 0?!0:i,s=r(),a=new Ue(function(c){return s.subscribe(c)});return a.connect=function(){return(!t||t.closed)&&(t=$c(function(){return n}).subscribe(s),o&&t.add(function(){return s=r()})),t},a}function S$(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Es(n),r=Zm(n),i=r.args,o=r.keys,s=new Ue(function(a){var c=i.length;if(!c){a.complete();return}for(var l=new Array(c),u=c,h=c,y=function(f){var g=!1;_e(i[f]).subscribe(he(a,function(_){g||(g=!0,h--),l[f]=_},function(){return u--},void 0,function(){(!u||!g)&&(h||a.next(o?Qm(o,l):l),a.complete())}))},d=0;d<c;d++)y(d)});return t?s.pipe(Ii(t)):s}var T$=["addListener","removeListener"],P$=["addEventListener","removeEventListener"],j$=["on","off"];function Bu(n,e,t,r){if(Pe(t)&&(r=t,t=void 0),r)return Bu(n,e,t).pipe(Ii(r));var i=Je(C$(n)?P$.map(function(a){return function(c){return n[a](e,c,t)}}):R$(n)?T$.map(Sp(n,e)):I$(n)?j$.map(Sp(n,e)):[],2),o=i[0],s=i[1];if(!o&&ld(n))return Jn(function(a){return Bu(a,e,t)})(_e(n));if(!o)throw new TypeError("Invalid event target");return new Ue(function(a){var c=function(){for(var l=[],u=0;u<arguments.length;u++)l[u]=arguments[u];return a.next(1<l.length?l:l[0])};return o(c),function(){return s(c)}})}function Sp(n,e){return function(t){return function(r){return n[t](e,r)}}}function R$(n){return Pe(n.addListener)&&Pe(n.removeListener)}function I$(n){return Pe(n.on)&&Pe(n.off)}function C$(n){return Pe(n.addEventListener)&&Pe(n.removeEventListener)}function nv(n,e,t){return t?nv(n,e).pipe(Ii(t)):new Ue(function(r){var i=function(){for(var s=[],a=0;a<arguments.length;a++)s[a]=arguments[a];return r.next(s.length===1?s[0]:s)},o=n(i);return Pe(e)?function(){return e(i,o)}:void 0})}function N$(n,e,t,r,i){var o,s,a,c;arguments.length===1?(o=n,c=o.initialState,e=o.condition,t=o.iterate,s=o.resultSelector,a=s===void 0?Pt:s,i=o.scheduler):(c=n,!r||kc(r)?(a=Pt,i=r):a=r);function l(){var u;return ed(this,function(h){switch(h.label){case 0:u=c,h.label=1;case 1:return!e||e(u)?[4,a(u)]:[3,4];case 2:h.sent(),h.label=3;case 3:return u=t(u),[3,1];case 4:return[2]}})}return $c(i?function(){return Vm(l(),i)}:l)}function B$(n,e,t){return $c(function(){return n()?e:t})}function Ci(n,e,t){n===void 0&&(n=0),t===void 0&&(t=ad);var r=-1;return e!=null&&(kc(e)?t=e:r=e),new Ue(function(i){var o=hd(n)?+n-t.now():n;o<0&&(o=0);var s=0;return t.schedule(function(){i.closed||(i.next(s++),0<=r?this.schedule(void 0,r):i.complete())},o)})}function rv(n,e){return n===void 0&&(n=0),e===void 0&&(e=Bn),n<0&&(n=0),Ci(n,n,e)}function L$(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Sr(n),r=Im(n,1/0),i=n;return i.length?i.length===1?_e(i[0]):_c(r)(Tr(i,t)):pr}var iv=new Ue(yt);function D$(){return iv}var q$=Array.isArray;function go(n){return n.length===1&&q$(n[0])?n[0]:n}function ov(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=go(n);return new Ue(function(r){var i=0,o=function(){if(i<t.length){var s=void 0;try{s=_e(t[i++])}catch(c){o();return}var a=new id(r,void 0,yt,yt);s.subscribe(a),a.add(o)}else r.complete()};o()})}function U$(n,e){return Tr(Object.entries(n),e)}function M$(n,e){return function(t,r){return!n.call(e,t,r)}}function Ai(n,e){return me(function(t,r){var i=0;t.subscribe(he(r,function(o){return n.call(e,o,i++)&&r.next(o)}))})}function F$(n,e,t){return[Ai(e,t)(_e(n)),Ai(M$(e,t))(_e(n))]}function V$(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return n=go(n),n.length===1?_e(n[0]):new Ue(sv(n))}function sv(n){return function(e){for(var t=[],r=function(o){t.push(_e(n[o]).subscribe(he(e,function(s){if(t){for(var a=0;a<t.length;a++)a!==o&&t[a].unsubscribe();t=null}e.next(s)})))},i=0;t&&!e.closed&&i<n.length;i++)r(i)}}function K$(n,e,t){if(e==null&&(e=n,n=0),e<=0)return pr;var r=e+n;return new Ue(t?function(i){var o=n;return t.schedule(function(){o<r?(i.next(o++),this.schedule()):i.complete()})}:function(i){for(var o=n;o<r&&!i.closed;)i.next(o++);i.complete()})}function W$(n,e){return new Ue(function(t){var r=n(),i=e(r),o=i?_e(i):pr;return o.subscribe(t),function(){r&&r.unsubscribe()}})}function pd(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Es(n),r=go(n);return r.length?new Ue(function(i){var o=r.map(function(){return[]}),s=r.map(function(){return!1});i.add(function(){o=s=null});for(var a=function(l){_e(r[l]).subscribe(he(i,function(u){if(o[l].push(u),o.every(function(y){return y.length})){var h=o.map(function(y){return y.shift()});i.next(t?t.apply(void 0,Ye([],Je(h))):h),o.some(function(y,d){return!y.length&&s[d]})&&i.complete()}},function(){s[l]=!0,!o[l].length&&i.complete()}))},c=0;!i.closed&&c<r.length;c++)a(c);return function(){o=s=null}}):pr}function av(n){return me(function(e,t){var r=!1,i=null,o=null,s=!1,a=function(){if(o==null||o.unsubscribe(),o=null,r){r=!1;var l=i;i=null,t.next(l)}s&&t.complete()},c=function(){o=null,s&&t.complete()};e.subscribe(he(t,function(l){r=!0,i=l,o||_e(n(l)).subscribe(o=he(t,a,c))},function(){s=!0,(!r||!o||o.closed)&&t.complete()}))})}function z$(n,e){return e===void 0&&(e=Bn),av(function(){return Ci(n,e)})}function H$(n){return me(function(e,t){var r=[];return e.subscribe(he(t,function(i){return r.push(i)},function(){t.next(r),t.complete()})),_e(n).subscribe(he(t,function(){var i=r;r=[],t.next(i)},yt)),function(){r=null}})}function J$(n,e){return e===void 0&&(e=null),e=e!=null?e:n,me(function(t,r){var i=[],o=0;t.subscribe(he(r,function(s){var a,c,l,u,h=null;o++%e===0&&i.push([]);try{for(var y=sn(i),d=y.next();!d.done;d=y.next()){var f=d.value;f.push(s),n<=f.length&&(h=h!=null?h:[],h.push(f))}}catch(A){a={error:A}}finally{try{d&&!d.done&&(c=y.return)&&c.call(y)}finally{if(a)throw a.error}}if(h)try{for(var g=sn(h),_=g.next();!_.done;_=g.next()){var f=_.value;$r(i,f),r.next(f)}}catch(A){l={error:A}}finally{try{_&&!_.done&&(u=g.return)&&u.call(g)}finally{if(l)throw l.error}}},function(){var s,a;try{for(var c=sn(i),l=c.next();!l.done;l=c.next()){var u=l.value;r.next(u)}}catch(h){s={error:h}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(s)throw s.error}}r.complete()},void 0,function(){i=null}))})}function Y$(n){for(var e,t,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];var o=(e=Sr(r))!==null&&e!==void 0?e:Bn,s=(t=r[0])!==null&&t!==void 0?t:null,a=r[1]||1/0;return me(function(c,l){var u=[],h=!1,y=function(g){var _=g.buffer,A=g.subs;A.unsubscribe(),$r(u,g),l.next(_),h&&d()},d=function(){if(u){var g=new dn;l.add(g);var _=[],A={buffer:_,subs:g};u.push(A),an(g,o,function(){return y(A)},n)}};s!==null&&s>=0?an(l,o,d,s,!0):h=!0,d();var f=he(l,function(g){var _,A,P=u.slice();try{for(var B=sn(P),C=B.next();!C.done;C=B.next()){var L=C.value,q=L.buffer;q.push(g),a<=q.length&&y(L)}}catch(H){_={error:H}}finally{try{C&&!C.done&&(A=B.return)&&A.call(B)}finally{if(_)throw _.error}}},function(){for(;u!=null&&u.length;)l.next(u.shift().buffer);f==null||f.unsubscribe(),l.complete(),l.unsubscribe()},void 0,function(){return u=null});c.subscribe(f)})}function G$(n,e){return me(function(t,r){var i=[];_e(n).subscribe(he(r,function(o){var s=[];i.push(s);var a=new dn,c=function(){$r(i,s),r.next(s),a.unsubscribe()};a.add(_e(e(o)).subscribe(he(r,c,yt)))},yt)),t.subscribe(he(r,function(o){var s,a;try{for(var c=sn(i),l=c.next();!l.done;l=c.next()){var u=l.value;u.push(o)}}catch(h){s={error:h}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(s)throw s.error}}},function(){for(;i.length>0;)r.next(i.shift());r.complete()}))})}function X$(n){return me(function(e,t){var r=null,i=null,o=function(){i==null||i.unsubscribe();var s=r;r=[],s&&t.next(s),_e(n()).subscribe(i=he(t,o,yt))};o(),e.subscribe(he(t,function(s){return r==null?void 0:r.push(s)},function(){r&&t.next(r),t.complete()},void 0,function(){return r=i=null}))})}function cv(n){return me(function(e,t){var r=null,i=!1,o;r=e.subscribe(he(t,void 0,void 0,function(s){o=_e(n(s,cv(n)(e))),r?(r.unsubscribe(),r=null,o.subscribe(t)):i=!0})),i&&(r.unsubscribe(),r=null,o.subscribe(t))})}function lv(n,e,t,r,i){return function(o,s){var a=t,c=e,l=0;o.subscribe(he(s,function(u){var h=l++;c=a?n(c,u,h):(a=!0,u),r&&s.next(c)},i&&function(){a&&s.next(c),s.complete()}))}}function _s(n,e){return me(lv(n,e,arguments.length>=2,!1,!0))}var Z$=function(n,e){return n.push(e),n};function uv(){return me(function(n,e){_s(Z$,[])(n).subscribe(e)})}function hv(n,e){return rd(uv(),Jn(function(t){return n(t)}),e?Ii(e):Pt)}function dv(n){return hv(ev,n)}var Q$=dv;function fv(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Es(n);return t?rd(fv.apply(void 0,Ye([],Je(n))),Ii(t)):me(function(r,i){tv(Ye([r],Je(go(n))))(i)})}function eO(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return fv.apply(void 0,Ye([],Je(n)))}function Lu(n,e){return Pe(e)?Jn(n,e,1):Jn(n,1)}function tO(n,e){return Pe(e)?Lu(function(){return n},e):Lu(function(){return n})}function nO(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Sr(n);return me(function(r,i){fd()(Tr(Ye([r],Je(n)),t)).subscribe(i)})}function rO(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return nO.apply(void 0,Ye([],Je(n)))}function iO(n){return new Ue(function(e){return n.subscribe(e)})}var oO={connector:function(){return new xt}};function yd(n,e){e===void 0&&(e=oO);var t=e.connector;return me(function(r,i){var o=t();_e(n(iO(o))).subscribe(i),i.add(r.subscribe(o))})}function sO(n){return _s(function(e,t,r){return!n||n(t,r)?e+1:e},0)}function aO(n){return me(function(e,t){var r=!1,i=null,o=null,s=function(){if(o==null||o.unsubscribe(),o=null,r){r=!1;var a=i;i=null,t.next(a)}};e.subscribe(he(t,function(a){o==null||o.unsubscribe(),r=!0,i=a,o=he(t,s,yt),_e(n(a)).subscribe(o)},function(){s(),t.complete()},void 0,function(){i=o=null}))})}function cO(n,e){return e===void 0&&(e=Bn),me(function(t,r){var i=null,o=null,s=null,a=function(){if(i){i.unsubscribe(),i=null;var l=o;o=null,r.next(l)}};function c(){var l=s+n,u=e.now();if(u<l){i=this.schedule(void 0,l-u),r.add(i);return}a()}t.subscribe(he(r,function(l){o=l,s=e.now(),i||(i=e.schedule(c,n),r.add(i))},function(){a(),r.complete()},void 0,function(){o=i=null}))})}function Oc(n){return me(function(e,t){var r=!1;e.subscribe(he(t,function(i){r=!0,t.next(i)},function(){r||t.next(n),t.complete()}))})}function es(n){return n<=0?function(){return pr}:me(function(e,t){var r=0;e.subscribe(he(t,function(i){++r<=n&&(t.next(i),n<=r&&t.complete())}))})}function pv(){return me(function(n,e){n.subscribe(he(e,yt))})}function yv(n){return Ri(function(){return n})}function gd(n,e){return e?function(t){return Qo(e.pipe(es(1),pv()),t.pipe(gd(n)))}:Jn(function(t,r){return _e(n(t,r)).pipe(es(1),yv(t))})}function lO(n,e){e===void 0&&(e=Bn);var t=Ci(n,e);return gd(function(){return t})}function uO(){return me(function(n,e){n.subscribe(he(e,function(t){return Hm(t,e)}))})}function hO(n,e){return me(function(t,r){var i=new Set;t.subscribe(he(r,function(o){var s=n?n(o):o;i.has(s)||(i.add(s),r.next(o))})),e&&_e(e).subscribe(he(r,function(){return i.clear()},yt))})}function gv(n,e){return e===void 0&&(e=Pt),n=n!=null?n:dO,me(function(t,r){var i,o=!0;t.subscribe(he(r,function(s){var a=e(s);(o||!n(i,a))&&(o=!1,i=a,r.next(s))}))})}function dO(n,e){return n===e}function fO(n,e){return gv(function(t,r){return e?e(t[n],r[n]):t[n]===r[n]})}function Ac(n){return n===void 0&&(n=pO),me(function(e,t){var r=!1;e.subscribe(he(t,function(i){r=!0,t.next(i)},function(){return r?t.complete():t.error(n())}))})}function pO(){return new ji}function yO(n,e){if(n<0)throw new Nu;var t=arguments.length>=2;return function(r){return r.pipe(Ai(function(i,o){return o===n}),es(1),t?Oc(e):Ac(function(){return new Nu}))}}function gO(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return function(t){return Qo(t,ud.apply(void 0,Ye([],Je(n))))}}function mO(n,e){return me(function(t,r){var i=0;t.subscribe(he(r,function(o){n.call(e,o,i++,t)||(r.next(!1),r.complete())},function(){r.next(!0),r.complete()}))})}function md(n,e){return e?function(t){return t.pipe(md(function(r,i){return _e(n(r,i)).pipe(Ri(function(o,s){return e(r,o,i,s)}))}))}:me(function(t,r){var i=0,o=null,s=!1;t.subscribe(he(r,function(a){o||(o=he(r,void 0,function(){o=null,s&&r.complete()}),_e(n(a,i++)).subscribe(o))},function(){s=!0,!o&&r.complete()}))})}function mv(){return md(Pt)}var vO=mv;function bO(n,e,t){return e===void 0&&(e=1/0),e=(e||0)<1?1/0:e,me(function(r,i){return dd(r,i,n,e,void 0,!0,t)})}function wO(n){return me(function(e,t){try{e.subscribe(t)}finally{t.add(n)}})}function kO(n,e){return me(vv(n,e,"value"))}function vv(n,e,t){var r=t==="index";return function(i,o){var s=0;i.subscribe(he(o,function(a){var c=s++;n.call(e,a,c,i)&&(o.next(r?c:a),o.complete())},function(){o.next(r?-1:void 0),o.complete()}))}}function xO(n,e){return me(vv(n,e,"index"))}function EO(n,e){var t=arguments.length>=2;return function(r){return r.pipe(n?Ai(function(i,o){return n(i,o,r)}):Pt,es(1),t?Oc(e):Ac(function(){return new ji}))}}function _O(n,e,t,r){return me(function(i,o){var s;!e||typeof e=="function"?s=e:(t=e.duration,s=e.element,r=e.connector);var a=new Map,c=function(f){a.forEach(f),f(o)},l=function(f){return c(function(g){return g.error(f)})},u=0,h=!1,y=new id(o,function(f){try{var g=n(f),_=a.get(g);if(!_){a.set(g,_=r?r():new xt);var A=d(g,_);if(o.next(A),t){var P=he(_,function(){_.complete(),P==null||P.unsubscribe()},void 0,void 0,function(){return a.delete(g)});y.add(_e(t(A)).subscribe(P))}}_.next(s?s(f):f)}catch(B){l(B)}},function(){return c(function(f){return f.complete()})},l,function(){return a.clear()},function(){return h=!0,u===0});i.subscribe(y);function d(f,g){var _=new Ue(function(A){u++;var P=g.subscribe(A);return function(){P.unsubscribe(),--u===0&&h&&y.unsubscribe()}});return _.key=f,_}})}function $O(){return me(function(n,e){n.subscribe(he(e,function(){e.next(!1),e.complete()},function(){e.next(!0),e.complete()}))})}function bv(n){return n<=0?function(){return pr}:me(function(e,t){var r=[];e.subscribe(he(t,function(i){r.push(i),n<r.length&&r.shift()},function(){var i,o;try{for(var s=sn(r),a=s.next();!a.done;a=s.next()){var c=a.value;t.next(c)}}catch(l){i={error:l}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}t.complete()},void 0,function(){r=null}))})}function OO(n,e){var t=arguments.length>=2;return function(r){return r.pipe(n?Ai(function(i,o){return n(i,o,r)}):Pt,bv(1),t?Oc(e):Ac(function(){return new ji}))}}function AO(){return me(function(n,e){n.subscribe(he(e,function(t){e.next(ba.createNext(t))},function(){e.next(ba.createComplete()),e.complete()},function(t){e.next(ba.createError(t)),e.complete()}))})}function SO(n){return _s(Pe(n)?function(e,t){return n(e,t)>0?e:t}:function(e,t){return e>t?e:t})}var TO=Jn;function PO(n,e,t){return t===void 0&&(t=1/0),Pe(e)?Jn(function(){return n},e,t):(typeof e=="number"&&(t=e),Jn(function(){return n},t))}function jO(n,e,t){return t===void 0&&(t=1/0),me(function(r,i){var o=e;return dd(r,i,function(s,a){return n(o,s,a)},t,function(s){o=s},!1,void 0,function(){return o=null})})}function RO(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Sr(n),r=Im(n,1/0);return n=go(n),me(function(i,o){_c(r)(Tr(Ye([i],Je(n)),t)).subscribe(o)})}function IO(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return RO.apply(void 0,Ye([],Je(n)))}function CO(n){return _s(Pe(n)?function(e,t){return n(e,t)<0?e:t}:function(e,t){return e<t?e:t})}function vd(n,e){var t=Pe(n)?n:function(){return n};return Pe(e)?yd(e,{connector:t}):function(r){return new bc(r,t)}}function NO(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=go(n);return function(r){return ov.apply(void 0,Ye([r],Je(t)))}}function BO(){return me(function(n,e){var t,r=!1;n.subscribe(he(e,function(i){var o=t;t=i,r&&e.next([o,i]),r=!0}))})}function LO(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=n.length;if(t===0)throw new Error("list of properties cannot be empty.");return Ri(function(r){for(var i=r,o=0;o<t;o++){var s=i==null?void 0:i[n[o]];if(typeof s!="undefined")i=s;else return}return i})}function DO(n){return n?function(e){return yd(n)(e)}:function(e){return vd(new xt)(e)}}function qO(n){return function(e){var t=new Am(n);return new bc(e,function(){return t})}}function UO(){return function(n){var e=new sd;return new bc(n,function(){return e})}}function MO(n,e,t,r){t&&!Pe(t)&&(r=t);var i=Pe(t)?t:void 0;return function(o){return vd(new od(n,e,r),i)(o)}}function FO(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return n.length?me(function(t,r){sv(Ye([t],Je(n)))(r)}):Pt}function VO(n){var e,t=1/0,r;return n!=null&&(typeof n=="object"?(e=n.count,t=e===void 0?1/0:e,r=n.delay):t=n),t<=0?function(){return pr}:me(function(i,o){var s=0,a,c=function(){if(a==null||a.unsubscribe(),a=null,r!=null){var u=typeof r=="number"?Ci(r):_e(r(s)),h=he(o,function(){h.unsubscribe(),l()});u.subscribe(h)}else l()},l=function(){var u=!1;a=i.subscribe(he(o,void 0,function(){++s<t?a?c():u=!0:o.complete()})),u&&c()};l()})}function KO(n){return me(function(e,t){var r,i=!1,o,s=!1,a=!1,c=function(){return a&&s&&(t.complete(),!0)},l=function(){return o||(o=new xt,_e(n(o)).subscribe(he(t,function(){r?u():i=!0},function(){s=!0,c()}))),o},u=function(){a=!1,r=e.subscribe(he(t,void 0,function(){a=!0,!c()&&l().next()})),i&&(r.unsubscribe(),r=null,i=!1,u())};u()})}function WO(n){n===void 0&&(n=1/0);var e;n&&typeof n=="object"?e=n:e={count:n};var t=e.count,r=t===void 0?1/0:t,i=e.delay,o=e.resetOnSuccess,s=o===void 0?!1:o;return r<=0?Pt:me(function(a,c){var l=0,u,h=function(){var y=!1;u=a.subscribe(he(c,function(d){s&&(l=0),c.next(d)},void 0,function(d){if(l++<r){var f=function(){u?(u.unsubscribe(),u=null,h()):y=!0};if(i!=null){var g=typeof i=="number"?Ci(i):_e(i(d,l)),_=he(c,function(){_.unsubscribe(),f()},function(){c.complete()});g.subscribe(_)}else f()}else c.error(d)})),y&&(u.unsubscribe(),u=null,h())};h()})}function zO(n){return me(function(e,t){var r,i=!1,o,s=function(){r=e.subscribe(he(t,void 0,void 0,function(a){o||(o=new xt,_e(n(o)).subscribe(he(t,function(){return r?s():i=!0}))),o&&o.next(a)})),i&&(r.unsubscribe(),r=null,i=!1,s())};s()})}function wv(n){return me(function(e,t){var r=!1,i=null;e.subscribe(he(t,function(o){r=!0,i=o})),_e(n).subscribe(he(t,function(){if(r){r=!1;var o=i;i=null,t.next(o)}},yt))})}function HO(n,e){return e===void 0&&(e=Bn),wv(rv(n,e))}function JO(n,e){return me(lv(n,e,arguments.length>=2,!0))}function YO(n,e){return e===void 0&&(e=function(t,r){return t===r}),me(function(t,r){var i=Tp(),o=Tp(),s=function(c){r.next(c),r.complete()},a=function(c,l){var u=he(r,function(h){var y=l.buffer,d=l.complete;y.length===0?d?s(!1):c.buffer.push(h):!e(h,y.shift())&&s(!1)},function(){c.complete=!0;var h=l.complete,y=l.buffer;h&&s(y.length===0),u==null||u.unsubscribe()});return u};t.subscribe(a(i,o)),_e(n).subscribe(a(o,i))})}function Tp(){return{buffer:[],complete:!1}}function kv(n){n===void 0&&(n={});var e=n.connector,t=e===void 0?function(){return new xt}:e,r=n.resetOnError,i=r===void 0?!0:r,o=n.resetOnComplete,s=o===void 0?!0:o,a=n.resetOnRefCountZero,c=a===void 0?!0:a;return function(l){var u,h,y,d=0,f=!1,g=!1,_=function(){h==null||h.unsubscribe(),h=void 0},A=function(){_(),u=y=void 0,f=g=!1},P=function(){var B=u;A(),B==null||B.unsubscribe()};return me(function(B,C){d++,!g&&!f&&_();var L=y=y!=null?y:t();C.add(function(){d--,d===0&&!g&&!f&&(h=Sl(P,c))}),L.subscribe(C),!u&&d>0&&(u=new so({next:function(q){return L.next(q)},error:function(q){g=!0,_(),h=Sl(A,i,q),L.error(q)},complete:function(){f=!0,_(),h=Sl(A,s),L.complete()}}),_e(B).subscribe(u))})(l)}}function Sl(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];if(e===!0){n();return}if(e!==!1){var i=new so({next:function(){i.unsubscribe(),n()}});return _e(e.apply(void 0,Ye([],Je(t)))).subscribe(i)}}function GO(n,e,t){var r,i,o,s,a=!1;return n&&typeof n=="object"?(r=n.bufferSize,s=r===void 0?1/0:r,i=n.windowTime,e=i===void 0?1/0:i,o=n.refCount,a=o===void 0?!1:o,t=n.scheduler):s=n!=null?n:1/0,kv({connector:function(){return new od(s,e,t)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:a})}function XO(n){return me(function(e,t){var r=!1,i,o=!1,s=0;e.subscribe(he(t,function(a){o=!0,(!n||n(a,s++,e))&&(r&&t.error(new Ym("Too many matching values")),r=!0,i=a)},function(){r?(t.next(i),t.complete()):t.error(o?new Jm("No matching values"):new ji)}))})}function ZO(n){return Ai(function(e,t){return n<=t})}function QO(n){return n<=0?Pt:me(function(e,t){var r=new Array(n),i=0;return e.subscribe(he(t,function(o){var s=i++;if(s<n)r[s]=o;else{var a=s%n,c=r[a];r[a]=o,t.next(c)}})),function(){r=null}})}function eA(n){return me(function(e,t){var r=!1,i=he(t,function(){i==null||i.unsubscribe(),r=!0},yt);_e(n).subscribe(i),e.subscribe(he(t,function(o){return r&&t.next(o)}))})}function tA(n){return me(function(e,t){var r=!1,i=0;e.subscribe(he(t,function(o){return(r||(r=!n(o,i++)))&&t.next(o)}))})}function nA(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Sr(n);return me(function(r,i){(t?Qo(n,r,t):Qo(n,r)).subscribe(i)})}function ts(n,e){return me(function(t,r){var i=null,o=0,s=!1,a=function(){return s&&!i&&r.complete()};t.subscribe(he(r,function(c){i==null||i.unsubscribe();var l=0,u=o++;_e(n(c,u)).subscribe(i=he(r,function(h){return r.next(e?e(c,h,u,l++):h)},function(){i=null,a()}))},function(){s=!0,a()}))})}function rA(){return ts(Pt)}function iA(n,e){return Pe(e)?ts(function(){return n},e):ts(function(){return n})}function oA(n,e){return me(function(t,r){var i=e;return ts(function(o,s){return n(i,o,s)},function(o,s){return i=s,s})(t).subscribe(r),function(){i=null}})}function sA(n){return me(function(e,t){_e(n).subscribe(he(t,function(){return t.complete()},yt)),!t.closed&&e.subscribe(t)})}function aA(n,e){return e===void 0&&(e=!1),me(function(t,r){var i=0;t.subscribe(he(r,function(o){var s=n(o,i++);(s||e)&&r.next(o),!s&&r.complete()}))})}function cA(n,e,t){var r=Pe(n)||e||t?{next:n,error:e,complete:t}:n;return r?me(function(i,o){var s;(s=r.subscribe)===null||s===void 0||s.call(r);var a=!0;i.subscribe(he(o,function(c){var l;(l=r.next)===null||l===void 0||l.call(r,c),o.next(c)},function(){var c;a=!1,(c=r.complete)===null||c===void 0||c.call(r),o.complete()},function(c){var l;a=!1,(l=r.error)===null||l===void 0||l.call(r,c),o.error(c)},function(){var c,l;a&&((c=r.unsubscribe)===null||c===void 0||c.call(r)),(l=r.finalize)===null||l===void 0||l.call(r)}))}):Pt}function xv(n,e){return me(function(t,r){var i=e!=null?e:{},o=i.leading,s=o===void 0?!0:o,a=i.trailing,c=a===void 0?!1:a,l=!1,u=null,h=null,y=!1,d=function(){h==null||h.unsubscribe(),h=null,c&&(_(),y&&r.complete())},f=function(){h=null,y&&r.complete()},g=function(A){return h=_e(n(A)).subscribe(he(r,d,f))},_=function(){if(l){l=!1;var A=u;u=null,r.next(A),!y&&g(A)}};t.subscribe(he(r,function(A){l=!0,u=A,!(h&&!h.closed)&&(s?_():g(A))},function(){y=!0,!(c&&l&&h&&!h.closed)&&r.complete()}))})}function lA(n,e,t){e===void 0&&(e=Bn);var r=Ci(n,e);return xv(function(){return r},t)}function uA(n){return n===void 0&&(n=Bn),me(function(e,t){var r=n.now();e.subscribe(he(t,function(i){var o=n.now(),s=o-r;r=o,t.next(new hA(i,s))}))})}var hA=function(){function n(e,t){this.value=e,this.interval=t}return n}();function dA(n,e,t){var r,i,o;if(t=t!=null?t:ad,hd(n)?r=n:typeof n=="number"&&(i=n),e)o=function(){return e};else throw new TypeError("No observable provided to switch to");if(r==null&&i==null)throw new TypeError("No timeout provided.");return Xm({first:r,each:i,scheduler:t,with:o})}function fA(n){return n===void 0&&(n=wc),Ri(function(e){return{value:e,timestamp:n.now()}})}function pA(n){return me(function(e,t){var r=new xt;t.next(r.asObservable());var i=function(o){r.error(o),t.error(o)};return e.subscribe(he(t,function(o){return r==null?void 0:r.next(o)},function(){r.complete(),t.complete()},i)),_e(n).subscribe(he(t,function(){r.complete(),t.next(r=new xt)},yt,i)),function(){r==null||r.unsubscribe(),r=null}})}function yA(n,e){e===void 0&&(e=0);var t=e>0?e:n;return me(function(r,i){var o=[new xt],s=[],a=0;i.next(o[0].asObservable()),r.subscribe(he(i,function(c){var l,u;try{for(var h=sn(o),y=h.next();!y.done;y=h.next()){var d=y.value;d.next(c)}}catch(_){l={error:_}}finally{try{y&&!y.done&&(u=h.return)&&u.call(h)}finally{if(l)throw l.error}}var f=a-n+1;if(f>=0&&f%t===0&&o.shift().complete(),++a%t===0){var g=new xt;o.push(g),i.next(g.asObservable())}},function(){for(;o.length>0;)o.shift().complete();i.complete()},function(c){for(;o.length>0;)o.shift().error(c);i.error(c)},function(){s=null,o=null}))})}function gA(n){for(var e,t,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];var o=(e=Sr(r))!==null&&e!==void 0?e:Bn,s=(t=r[0])!==null&&t!==void 0?t:null,a=r[1]||1/0;return me(function(c,l){var u=[],h=!1,y=function(_){var A=_.window,P=_.subs;A.complete(),P.unsubscribe(),$r(u,_),h&&d()},d=function(){if(u){var _=new dn;l.add(_);var A=new xt,P={window:A,subs:_,seen:0};u.push(P),l.next(A.asObservable()),an(_,o,function(){return y(P)},n)}};s!==null&&s>=0?an(l,o,d,s,!0):h=!0,d();var f=function(_){return u.slice().forEach(_)},g=function(_){f(function(A){var P=A.window;return _(P)}),_(l),l.unsubscribe()};return c.subscribe(he(l,function(_){f(function(A){A.window.next(_),a<=++A.seen&&y(A)})},function(){return g(function(_){return _.complete()})},function(_){return g(function(A){return A.error(_)})})),function(){u=null}})}function mA(n,e){return me(function(t,r){var i=[],o=function(s){for(;0<i.length;)i.shift().error(s);r.error(s)};_e(n).subscribe(he(r,function(s){var a=new xt;i.push(a);var c=new dn,l=function(){$r(i,a),a.complete(),c.unsubscribe()},u;try{u=_e(e(s))}catch(h){o(h);return}r.next(a.asObservable()),c.add(u.subscribe(he(r,l,yt,o)))},yt)),t.subscribe(he(r,function(s){var a,c,l=i.slice();try{for(var u=sn(l),h=u.next();!h.done;h=u.next()){var y=h.value;y.next(s)}}catch(d){a={error:d}}finally{try{h&&!h.done&&(c=u.return)&&c.call(u)}finally{if(a)throw a.error}}},function(){for(;0<i.length;)i.shift().complete();r.complete()},o,function(){for(;0<i.length;)i.shift().unsubscribe()}))})}function vA(n){return me(function(e,t){var r,i,o=function(a){r.error(a),t.error(a)},s=function(){i==null||i.unsubscribe(),r==null||r.complete(),r=new xt,t.next(r.asObservable());var a;try{a=_e(n())}catch(c){o(c);return}a.subscribe(i=he(t,s,s,o))};s(),e.subscribe(he(t,function(a){return r.next(a)},function(){r.complete(),t.complete()},o,function(){i==null||i.unsubscribe(),r=null}))})}function bA(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Es(n);return me(function(r,i){for(var o=n.length,s=new Array(o),a=n.map(function(){return!1}),c=!1,l=function(h){_e(n[h]).subscribe(he(i,function(y){s[h]=y,!c&&!a[h]&&(a[h]=!0,(c=a.every(Pt))&&(a=null))},yt))},u=0;u<o;u++)l(u);r.subscribe(he(i,function(h){if(c){var y=Ye([h],Je(s));i.next(t?t.apply(void 0,Ye([],Je(y))):y)}}))})}function wA(n){return hv(pd,n)}function kA(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return me(function(t,r){pd.apply(void 0,Ye([t],Je(n))).subscribe(r)})}function xA(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return kA.apply(void 0,Ye([],Je(n)))}const EA=Object.freeze(Object.defineProperty({__proto__:null,Observable:Ue,ConnectableObservable:bc,observable:vc,animationFrames:D_,Subject:xt,BehaviorSubject:Am,ReplaySubject:od,AsyncSubject:sd,asap:z_,asapScheduler:Tm,async:ad,asyncScheduler:Bn,queue:Y_,queueScheduler:Pm,animationFrame:Z_,animationFrameScheduler:jm,VirtualTimeScheduler:Q_,VirtualAction:Rm,Scheduler:Iu,Subscription:dn,Subscriber:mc,Notification:ba,get NotificationKind(){return Cu},pipe:rd,noop:yt,identity:Pt,isObservable:f$,lastValueFrom:p$,firstValueFrom:y$,ArgumentOutOfRangeError:Nu,EmptyError:ji,NotFoundError:Jm,ObjectUnsubscribedError:Om,SequenceError:Ym,TimeoutError:Gm,UnsubscriptionError:ma,bindCallback:b$,bindNodeCallback:w$,combineLatest:ev,concat:Qo,connectable:A$,defer:$c,empty:e$,forkJoin:S$,from:Tr,fromEvent:Bu,fromEventPattern:nv,generate:N$,iif:B$,interval:rv,merge:L$,never:D$,of:ud,onErrorResumeNext:ov,pairs:U$,partition:F$,race:V$,range:K$,throwError:zm,timer:Ci,using:W$,zip:pd,scheduled:Wm,EMPTY:pr,NEVER:iv,config:hi,audit:av,auditTime:z$,buffer:H$,bufferCount:J$,bufferTime:Y$,bufferToggle:G$,bufferWhen:X$,catchError:cv,combineAll:Q$,combineLatestAll:dv,combineLatestWith:eO,concatAll:fd,concatMap:Lu,concatMapTo:tO,concatWith:rO,connect:yd,count:sO,debounce:aO,debounceTime:cO,defaultIfEmpty:Oc,delay:lO,delayWhen:gd,dematerialize:uO,distinct:hO,distinctUntilChanged:gv,distinctUntilKeyChanged:fO,elementAt:yO,endWith:gO,every:mO,exhaust:vO,exhaustAll:mv,exhaustMap:md,expand:bO,filter:Ai,finalize:wO,find:kO,findIndex:xO,first:EO,groupBy:_O,ignoreElements:pv,isEmpty:$O,last:OO,map:Ri,mapTo:yv,materialize:AO,max:SO,mergeAll:_c,flatMap:TO,mergeMap:Jn,mergeMapTo:PO,mergeScan:jO,mergeWith:IO,min:CO,multicast:vd,observeOn:xc,onErrorResumeNextWith:NO,pairwise:BO,pluck:LO,publish:DO,publishBehavior:qO,publishLast:UO,publishReplay:MO,raceWith:FO,reduce:_s,repeat:VO,repeatWhen:KO,retry:WO,retryWhen:zO,refCount:Em,sample:wv,sampleTime:HO,scan:JO,sequenceEqual:YO,share:kv,shareReplay:GO,single:XO,skip:ZO,skipLast:QO,skipUntil:eA,skipWhile:tA,startWith:nA,subscribeOn:Ec,switchAll:rA,switchMap:ts,switchMapTo:iA,switchScan:oA,take:es,takeLast:bv,takeUntil:sA,takeWhile:aA,tap:cA,throttle:xv,throttleTime:lA,throwIfEmpty:Ac,timeInterval:uA,timeout:Xm,timeoutWith:dA,timestamp:fA,toArray:uv,window:pA,windowCount:yA,windowTime:gA,windowToggle:mA,windowWhen:vA,withLatestFrom:bA,zipAll:wA,zipWith:xA},Symbol.toStringTag,{value:"Module"}));var _A=Object.defineProperty,$A=Object.defineProperties,OA=Object.getOwnPropertyDescriptors,Pp=Object.getOwnPropertySymbols,AA=Object.prototype.hasOwnProperty,SA=Object.prototype.propertyIsEnumerable,Du=(n,e,t)=>e in n?_A(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,se=(n,e)=>{for(var t in e||(e={}))AA.call(e,t)&&Du(n,t,e[t]);if(Pp)for(var t of Pp(e))SA.call(e,t)&&Du(n,t,e[t]);return n},tt=(n,e)=>$A(n,OA(e)),TA=(n,e,t)=>(Du(n,typeof e!="symbol"?e+"":e,t),t),Ev=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)},xe=(n,e,t)=>(Ev(n,e,"read from private field"),t?t.call(n):e.get(n)),mn=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)},Qn=(n,e,t,r)=>(Ev(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t),K=(n,e,t)=>new Promise((r,i)=>{var o=c=>{try{a(t.next(c))}catch(l){i(l)}},s=c=>{try{a(t.throw(c))}catch(l){i(l)}},a=c=>c.done?r(c.value):Promise.resolve(c.value).then(o,s);a((t=t.apply(n,e)).next())});const hr=Object.create(null);hr.open="0";hr.close="1";hr.ping="2";hr.pong="3";hr.message="4";hr.upgrade="5";hr.noop="6";const wa=Object.create(null);Object.keys(hr).forEach(n=>{wa[hr[n]]=n});const PA={type:"error",data:"parser error"},jA=typeof Blob=="function"||typeof Blob!="undefined"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",RA=typeof ArrayBuffer=="function",IA=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n&&n.buffer instanceof ArrayBuffer,_v=({type:n,data:e},t,r)=>jA&&e instanceof Blob?t?r(e):jp(e,r):RA&&(e instanceof ArrayBuffer||IA(e))?t?r(e):jp(new Blob([e]),r):r(hr[n]+(e||"")),jp=(n,e)=>{const t=new FileReader;return t.onload=function(){const r=t.result.split(",")[1];e("b"+(r||""))},t.readAsDataURL(n)},Rp="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",qo=typeof Uint8Array=="undefined"?[]:new Uint8Array(256);for(let n=0;n<Rp.length;n++)qo[Rp.charCodeAt(n)]=n;const CA=n=>{let e=n.length*.75,t=n.length,r,i=0,o,s,a,c;n[n.length-1]==="="&&(e--,n[n.length-2]==="="&&e--);const l=new ArrayBuffer(e),u=new Uint8Array(l);for(r=0;r<t;r+=4)o=qo[n.charCodeAt(r)],s=qo[n.charCodeAt(r+1)],a=qo[n.charCodeAt(r+2)],c=qo[n.charCodeAt(r+3)],u[i++]=o<<2|s>>4,u[i++]=(s&15)<<4|a>>2,u[i++]=(a&3)<<6|c&63;return l},NA=typeof ArrayBuffer=="function",$v=(n,e)=>{if(typeof n!="string")return{type:"message",data:Ov(n,e)};const t=n.charAt(0);return t==="b"?{type:"message",data:BA(n.substring(1),e)}:wa[t]?n.length>1?{type:wa[t],data:n.substring(1)}:{type:wa[t]}:PA},BA=(n,e)=>{if(NA){const t=CA(n);return Ov(t,e)}else return{base64:!0,data:n}},Ov=(n,e)=>{switch(e){case"blob":return n instanceof ArrayBuffer?new Blob([n]):n;case"arraybuffer":default:return n}},Av=String.fromCharCode(30),LA=(n,e)=>{const t=n.length,r=new Array(t);let i=0;n.forEach((o,s)=>{_v(o,!1,a=>{r[s]=a,++i===t&&e(r.join(Av))})})},DA=(n,e)=>{const t=n.split(Av),r=[];for(let i=0;i<t.length;i++){const o=$v(t[i],e);if(r.push(o),o.type==="error")break}return r},Sv=4;function ft(n){if(n)return qA(n)}function qA(n){for(var e in ft.prototype)n[e]=ft.prototype[e];return n}ft.prototype.on=ft.prototype.addEventListener=function(n,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+n]=this._callbacks["$"+n]||[]).push(e),this};ft.prototype.once=function(n,e){function t(){this.off(n,t),e.apply(this,arguments)}return t.fn=e,this.on(n,t),this};ft.prototype.off=ft.prototype.removeListener=ft.prototype.removeAllListeners=ft.prototype.removeEventListener=function(n,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+n];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+n],this;for(var r,i=0;i<t.length;i++)if(r=t[i],r===e||r.fn===e){t.splice(i,1);break}return t.length===0&&delete this._callbacks["$"+n],this};ft.prototype.emit=function(n){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+n],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(t){t=t.slice(0);for(var r=0,i=t.length;r<i;++r)t[r].apply(this,e)}return this};ft.prototype.emitReserved=ft.prototype.emit;ft.prototype.listeners=function(n){return this._callbacks=this._callbacks||{},this._callbacks["$"+n]||[]};ft.prototype.hasListeners=function(n){return!!this.listeners(n).length};const jn=(()=>typeof self!="undefined"?self:typeof window!="undefined"?window:Function("return this")())();function Tv(n,...e){return e.reduce((t,r)=>(n.hasOwnProperty(r)&&(t[r]=n[r]),t),{})}const UA=jn.setTimeout,MA=jn.clearTimeout;function Sc(n,e){e.useNativeTimers?(n.setTimeoutFn=UA.bind(jn),n.clearTimeoutFn=MA.bind(jn)):(n.setTimeoutFn=jn.setTimeout.bind(jn),n.clearTimeoutFn=jn.clearTimeout.bind(jn))}const FA=1.33;function VA(n){return typeof n=="string"?KA(n):Math.ceil((n.byteLength||n.size)*FA)}function KA(n){let e=0,t=0;for(let r=0,i=n.length;r<i;r++)e=n.charCodeAt(r),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(r++,t+=4);return t}class WA extends Error{constructor(e,t,r){super(e),this.description=t,this.context=r,this.type="TransportError"}}class Pv extends ft{constructor(e){super(),this.writable=!1,Sc(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,r){return super.emitReserved("error",new WA(e,t,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=$v(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}}const jv="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),qu=64,zA={};let Ip=0,Hs=0,Cp;function Np(n){let e="";do e=jv[n%qu]+e,n=Math.floor(n/qu);while(n>0);return e}function Rv(){const n=Np(+new Date);return n!==Cp?(Ip=0,Cp=n):n+"."+Np(Ip++)}for(;Hs<qu;Hs++)zA[jv[Hs]]=Hs;function Iv(n){let e="";for(let t in n)n.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(n[t]));return e}function HA(n){let e={},t=n.split("&");for(let r=0,i=t.length;r<i;r++){let o=t[r].split("=");e[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return e}let Cv=!1;try{Cv=typeof XMLHttpRequest!="undefined"&&"withCredentials"in new XMLHttpRequest}catch(n){}const JA=Cv;function Nv(n){const e=n.xdomain;try{if(typeof XMLHttpRequest!="undefined"&&(!e||JA))return new XMLHttpRequest}catch(t){}if(!e)try{return new jn[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch(t){}}function YA(){}const GA=function(){return new Nv({xdomain:!1}).responseType!=null}();class XA extends Pv{constructor(e){if(super(e),this.polling=!1,typeof location!="undefined"){const r=location.protocol==="https:";let i=location.port;i||(i=r?"443":"80"),this.xd=typeof location!="undefined"&&e.hostname!==location.hostname||i!==e.port,this.xs=e.secure!==r}const t=e&&e.forceBase64;this.supportsBinary=GA&&!t}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let r=0;this.polling&&(r++,this.once("pollComplete",function(){--r||t()})),this.writable||(r++,this.once("drain",function(){--r||t()}))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const t=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)};DA(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,LA(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let e=this.query||{};const t=this.opts.secure?"https":"http";let r="";this.opts.timestampRequests!==!1&&(e[this.opts.timestampParam]=Rv()),!this.supportsBinary&&!e.sid&&(e.b64=1),this.opts.port&&(t==="https"&&Number(this.opts.port)!==443||t==="http"&&Number(this.opts.port)!==80)&&(r=":"+this.opts.port);const i=Iv(e),o=this.opts.hostname.indexOf(":")!==-1;return t+"://"+(o?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(i.length?"?"+i:"")}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new cr(this.uri(),e)}doWrite(e,t){const r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",(i,o)=>{this.onError("xhr post error",i,o)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,r)=>{this.onError("xhr poll error",t,r)}),this.pollXhr=e}}class cr extends ft{constructor(e,t){super(),Sc(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.async=t.async!==!1,this.data=t.data!==void 0?t.data:null,this.create()}create(){const e=Tv(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;const t=this.xhr=new Nv(e);try{t.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(let r in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(r)&&t.setRequestHeader(r,this.opts.extraHeaders[r])}}catch(r){}if(this.method==="POST")try{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(r){}try{t.setRequestHeader("Accept","*/*")}catch(r){}"withCredentials"in t&&(t.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(t.timeout=this.opts.requestTimeout),t.onreadystatechange=()=>{t.readyState===4&&(t.status===200||t.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof t.status=="number"?t.status:0)},0))},t.send(this.data)}catch(r){this.setTimeoutFn(()=>{this.onError(r)},0);return}typeof document!="undefined"&&(this.index=cr.requestsCount++,cr.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr=="undefined"||this.xhr===null)){if(this.xhr.onreadystatechange=YA,e)try{this.xhr.abort()}catch(t){}typeof document!="undefined"&&delete cr.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}cr.requestsCount=0;cr.requests={};if(typeof document!="undefined"){if(typeof attachEvent=="function")attachEvent("onunload",Bp);else if(typeof addEventListener=="function"){const n="onpagehide"in jn?"pagehide":"unload";addEventListener(n,Bp,!1)}}function Bp(){for(let n in cr.requests)cr.requests.hasOwnProperty(n)&&cr.requests[n].abort()}const Bv=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?n=>Promise.resolve().then(n):(n,e)=>e(n,0))(),Js=jn.WebSocket||jn.MozWebSocket,Lp=!0,ZA="arraybuffer",Dp=typeof navigator!="undefined"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class QA extends Pv{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,r=Dp?{}:Tv(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=Lp&&!Dp?t?new Js(e,t):new Js(e):new Js(e,t,r)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType||ZA,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],i=t===e.length-1;_v(r,this.supportsBinary,o=>{try{Lp&&this.ws.send(o)}catch(s){}i&&Bv(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws!="undefined"&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{};const t=this.opts.secure?"wss":"ws";let r="";this.opts.port&&(t==="wss"&&Number(this.opts.port)!==443||t==="ws"&&Number(this.opts.port)!==80)&&(r=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=Rv()),this.supportsBinary||(e.b64=1);const i=Iv(e),o=this.opts.hostname.indexOf(":")!==-1;return t+"://"+(o?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(i.length?"?"+i:"")}check(){return!!Js}}const eS={websocket:QA,polling:XA},tS=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,nS=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Uu(n){const e=n,t=n.indexOf("["),r=n.indexOf("]");t!=-1&&r!=-1&&(n=n.substring(0,t)+n.substring(t,r).replace(/:/g,";")+n.substring(r,n.length));let i=tS.exec(n||""),o={},s=14;for(;s--;)o[nS[s]]=i[s]||"";return t!=-1&&r!=-1&&(o.source=e,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=rS(o,o.path),o.queryKey=iS(o,o.query),o}function rS(n,e){const t=/\/{2,9}/g,r=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&r.splice(0,1),e.slice(-1)=="/"&&r.splice(r.length-1,1),r}function iS(n,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,i,o){i&&(t[i]=o)}),t}class ti extends ft{constructor(e,t={}){super(),this.writeBuffer=[],e&&typeof e=="object"&&(t=e,e=null),e?(e=Uu(e),t.hostname=e.host,t.secure=e.protocol==="https"||e.protocol==="wss",t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=Uu(t.host).host),Sc(this,t),this.secure=t.secure!=null?t.secure:typeof location!="undefined"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location!="undefined"?location.hostname:"localhost"),this.port=t.port||(typeof location!="undefined"&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=HA(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=Sv,t.transport=e,this.id&&(t.sid=this.id);const r=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new eS[e](r)}open(){let e;if(this.opts.rememberUpgrade&&ti.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch(t){this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",t=>this.onClose("transport close",t))}probe(e){let t=this.createTransport(e),r=!1;ti.priorWebsocketSuccess=!1;const i=()=>{r||(t.send([{type:"ping",data:"probe"}]),t.once("packet",h=>{if(!r)if(h.type==="pong"&&h.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;ti.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{r||this.readyState!=="closed"&&(u(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const y=new Error("probe error");y.transport=t.name,this.emitReserved("upgradeError",y)}}))};function o(){r||(r=!0,u(),t.close(),t=null)}const s=h=>{const y=new Error("probe error: "+h);y.transport=t.name,o(),this.emitReserved("upgradeError",y)};function a(){s("transport closed")}function c(){s("socket closed")}function l(h){t&&h.name!==t.name&&o()}const u=()=>{t.removeListener("open",i),t.removeListener("error",s),t.removeListener("close",a),this.off("close",c),this.off("upgrading",l)};t.once("open",i),t.once("error",s),t.once("close",a),this.once("close",c),this.once("upgrading",l),t.open()}onOpen(){if(this.readyState="open",ti.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let t=0;t<this.writeBuffer.length;t++){const r=this.writeBuffer[t].data;if(r&&(e+=VA(r)),t>0&&e>this.maxPayload)return this.writeBuffer.slice(0,t);e+=2}return this.writeBuffer}write(e,t,r){return this.sendPacket("message",e,t,r),this}send(e,t,r){return this.sendPacket("message",e,t,r),this}sendPacket(e,t,r,i){if(typeof t=="function"&&(i=t,t=void 0),typeof r=="function"&&(i=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;const o={type:e,data:t,options:r};this.emitReserved("packetCreate",o),this.writeBuffer.push(o),i&&this.once("flush",i),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},r=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():e()}):this.upgrading?r():e()),this}onError(e){ti.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let r=0;const i=e.length;for(;r<i;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}}ti.protocol=Sv;function oS(n,e="",t){let r=n;t=t||typeof location!="undefined"&&location,n==null&&(n=t.protocol+"//"+t.host),typeof n=="string"&&(n.charAt(0)==="/"&&(n.charAt(1)==="/"?n=t.protocol+n:n=t.host+n),/^(https?|wss?):\/\//.test(n)||(typeof t!="undefined"?n=t.protocol+"//"+n:n="https://"+n),r=Uu(n)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const i=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+i+":"+r.port+e,r.href=r.protocol+"://"+i+(t&&t.port===r.port?"":":"+r.port),r}const sS=typeof ArrayBuffer=="function",aS=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n.buffer instanceof ArrayBuffer,Lv=Object.prototype.toString,cS=typeof Blob=="function"||typeof Blob!="undefined"&&Lv.call(Blob)==="[object BlobConstructor]",lS=typeof File=="function"||typeof File!="undefined"&&Lv.call(File)==="[object FileConstructor]";function bd(n){return sS&&(n instanceof ArrayBuffer||aS(n))||cS&&n instanceof Blob||lS&&n instanceof File}function ka(n,e){if(!n||typeof n!="object")return!1;if(Array.isArray(n)){for(let t=0,r=n.length;t<r;t++)if(ka(n[t]))return!0;return!1}if(bd(n))return!0;if(n.toJSON&&typeof n.toJSON=="function"&&arguments.length===1)return ka(n.toJSON(),!0);for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)&&ka(n[t]))return!0;return!1}function uS(n){const e=[],t=n.data,r=n;return r.data=Mu(t,e),r.attachments=e.length,{packet:r,buffers:e}}function Mu(n,e){if(!n)return n;if(bd(n)){const t={_placeholder:!0,num:e.length};return e.push(n),t}else if(Array.isArray(n)){const t=new Array(n.length);for(let r=0;r<n.length;r++)t[r]=Mu(n[r],e);return t}else if(typeof n=="object"&&!(n instanceof Date)){const t={};for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=Mu(n[r],e));return t}return n}function hS(n,e){return n.data=Fu(n.data,e),delete n.attachments,n}function Fu(n,e){if(!n)return n;if(n&&n._placeholder===!0){if(typeof n.num=="number"&&n.num>=0&&n.num<e.length)return e[n.num];throw new Error("illegal attachments")}else if(Array.isArray(n))for(let t=0;t<n.length;t++)n[t]=Fu(n[t],e);else if(typeof n=="object")for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&(n[t]=Fu(n[t],e));return n}const dS=5;var Le;(function(n){n[n.CONNECT=0]="CONNECT",n[n.DISCONNECT=1]="DISCONNECT",n[n.EVENT=2]="EVENT",n[n.ACK=3]="ACK",n[n.CONNECT_ERROR=4]="CONNECT_ERROR",n[n.BINARY_EVENT=5]="BINARY_EVENT",n[n.BINARY_ACK=6]="BINARY_ACK"})(Le||(Le={}));class fS{constructor(e){this.replacer=e}encode(e){return(e.type===Le.EVENT||e.type===Le.ACK)&&ka(e)?this.encodeAsBinary({type:e.type===Le.EVENT?Le.BINARY_EVENT:Le.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===Le.BINARY_EVENT||e.type===Le.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=uS(e),r=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(r),i}}class wd extends ft{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const r=t.type===Le.BINARY_EVENT;r||t.type===Le.BINARY_ACK?(t.type=r?Le.EVENT:Le.ACK,this.reconstructor=new pS(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(bd(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const r={type:Number(e.charAt(0))};if(Le[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===Le.BINARY_EVENT||r.type===Le.BINARY_ACK){const o=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const s=e.substring(o,t);if(s!=Number(s)||e.charAt(t)!=="-")throw new Error("Illegal attachments");r.attachments=Number(s)}if(e.charAt(t+1)==="/"){const o=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););r.nsp=e.substring(o,t)}else r.nsp="/";const i=e.charAt(t+1);if(i!==""&&Number(i)==i){const o=t+1;for(;++t;){const s=e.charAt(t);if(s==null||Number(s)!=s){--t;break}if(t===e.length)break}r.id=Number(e.substring(o,t+1))}if(e.charAt(++t)){const o=this.tryParse(e.substr(t));if(wd.isPayloadValid(r.type,o))r.data=o;else throw new Error("invalid payload")}return r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(t){return!1}}static isPayloadValid(e,t){switch(e){case Le.CONNECT:return typeof t=="object";case Le.DISCONNECT:return t===void 0;case Le.CONNECT_ERROR:return typeof t=="string"||typeof t=="object";case Le.EVENT:case Le.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="string"||typeof t[0]=="number");case Le.ACK:case Le.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class pS{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=hS(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const yS=Object.freeze(Object.defineProperty({__proto__:null,protocol:dS,get PacketType(){return Le},Encoder:fS,Decoder:wd},Symbol.toStringTag,{value:"Module"}));function Fn(n,e,t){return n.on(e,t),function(){n.off(e,t)}}const gS=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Dv extends ft{constructor(e,t,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Fn(e,"open",this.onopen.bind(this)),Fn(e,"packet",this.onpacket.bind(this)),Fn(e,"error",this.onerror.bind(this)),Fn(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(gS.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const r={type:Le.EVENT,data:t};if(r.options={},r.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const o=this.ids++,s=t.pop();this._registerAckCallback(o,s),r.id=o}const i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!i||!this.connected)||(this.connected?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(e,t){var r;const i=(r=this.flags.timeout)!==null&&r!==void 0?r:this._opts.ackTimeout;if(i===void 0){this.acks[e]=t;return}const o=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let s=0;s<this.sendBuffer.length;s++)this.sendBuffer[s].id===e&&this.sendBuffer.splice(s,1);t.call(this,new Error("operation has timed out"))},i);this.acks[e]=(...s)=>{this.io.clearTimeoutFn(o),t.apply(this,[null,...s])}}emitWithAck(e,...t){const r=this.flags.timeout!==void 0||this._opts.ackTimeout!==void 0;return new Promise((i,o)=>{t.push((s,a)=>r?s?o(s):i(a):i(s)),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((i,...o)=>r!==this._queue[0]?void 0:(i!==null?r.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(i)):(this._queue.shift(),t&&t(null,...o)),r.pending=!1,this._drainQueue())),this._queue.push(r),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:Le.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case Le.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Le.EVENT:case Le.BINARY_EVENT:this.onevent(e);break;case Le.ACK:case Le.BINARY_ACK:this.onack(e);break;case Le.DISCONNECT:this.ondisconnect();break;case Le.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const r of t)r.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let r=!1;return function(...i){r||(r=!0,t.packet({type:Le.ACK,id:e,data:i}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Le.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const r of t)r.apply(this,e.data)}}}function mo(n){n=n||{},this.ms=n.min||100,this.max=n.max||1e4,this.factor=n.factor||2,this.jitter=n.jitter>0&&n.jitter<=1?n.jitter:0,this.attempts=0}mo.prototype.duration=function(){var n=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*n);n=(Math.floor(e*10)&1)==0?n-t:n+t}return Math.min(n,this.max)|0};mo.prototype.reset=function(){this.attempts=0};mo.prototype.setMin=function(n){this.ms=n};mo.prototype.setMax=function(n){this.max=n};mo.prototype.setJitter=function(n){this.jitter=n};class Vu extends ft{constructor(e,t){var r;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,Sc(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((r=t.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new mo({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const i=t.parser||yS;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new ti(this.uri,this.opts);const t=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const i=Fn(t,"open",function(){r.onopen(),e&&e()}),o=Fn(t,"error",s=>{r.cleanup(),r._readyState="closed",this.emitReserved("error",s),e?e(s):r.maybeReconnectOnOpen()});if(this._timeout!==!1){const s=this._timeout;s===0&&i();const a=this.setTimeoutFn(()=>{i(),t.close(),t.emit("error",new Error("timeout"))},s);this.opts.autoUnref&&a.unref(),this.subs.push(function(){clearTimeout(a)})}return this.subs.push(i),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Fn(e,"ping",this.onping.bind(this)),Fn(e,"data",this.ondata.bind(this)),Fn(e,"error",this.onerror.bind(this)),Fn(e,"close",this.onclose.bind(this)),Fn(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){Bv(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new Dv(this,e,t),this.nsps[e]=r),r}_destroy(e){const t=Object.keys(this.nsps);for(const r of t)if(this.nsps[r].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let r=0;r<t.length;r++)this.engine.write(t[r],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(i=>{i?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",i)):e.onreconnect()}))},t);this.opts.autoUnref&&r.unref(),this.subs.push(function(){clearTimeout(r)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const So={};function xa(n,e){typeof n=="object"&&(e=n,n=void 0),e=e||{};const t=oS(n,e.path||"/socket.io"),r=t.source,i=t.id,o=t.path,s=So[i]&&o in So[i].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||s;let c;return a?c=new Vu(r,e):(So[i]||(So[i]=new Vu(r,e)),c=So[i]),t.query&&!e.query&&(e.query=t.queryKey),c.socket(t.path,e)}Object.assign(xa,{Manager:Vu,Socket:Dv,io:xa,connect:xa});const mS={init:({API_KEY:n,HOST_SERVER:e,CURRENT:t,ENV:r,API_VERSION:i})=>{var o,s;let a={};const c=localStorage.getItem("accessToken");try{const l={Accept:"application/json","Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Key":n,"Access-Control-Allow-Methods":"POST, GET, OPTIONS, PUT, DELETE, HEAD,PATCH","Access-Control-Allow-Headers":"X-PINGOTHER, Origin, X-Requested-With, Content-Type, Accept","Access-Control-Max-Age":"1728000"};return c&&(l.Authorization="Bearer "+c),a.database=xa(e.DATABASE,{extraHeaders:l}),(o=a==null?void 0:a.database)==null||o.on("connect",()=>{r==="dev"&&console.log("Swyger Database Client JS is connected with Swyger Server!!!")}),(s=a==null?void 0:a.database)==null||s.on("disconnect",u=>{r==="dev"&&console.log("The device is disconnected from Database server!")}),a}catch(l){}}};function Ku(n){this.message=n}Ku.prototype=new Error,Ku.prototype.name="InvalidCharacterError";var qp=typeof window!="undefined"&&window.atob&&window.atob.bind(window)||function(n){var e=String(n).replace(/=+$/,"");if(e.length%4==1)throw new Ku("'atob' failed: The string to be decoded is not correctly encoded.");for(var t,r,i=0,o=0,s="";r=e.charAt(o++);~r&&(t=i%4?64*t+r:r,i++%4)?s+=String.fromCharCode(255&t>>(-2*i&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return s};function vS(n){var e=n.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw"Illegal base64url string!"}try{return function(t){return decodeURIComponent(qp(t).replace(/(.)/g,function(r,i){var o=i.charCodeAt(0).toString(16).toUpperCase();return o.length<2&&(o="0"+o),"%"+o}))}(e)}catch(t){return qp(e)}}function Xa(n){this.message=n}function bS(n,e){if(typeof n!="string")throw new Xa("Invalid token specified");var t=(e=e||{}).header===!0?0:1;try{return JSON.parse(vS(n.split(".")[t]))}catch(r){throw new Xa("Invalid token specified: "+r.message)}}Xa.prototype=new Error,Xa.prototype.name="InvalidTokenError";function qv(n,e){return function(){return n.apply(e,arguments)}}const{toString:wS}=Object.prototype,{getPrototypeOf:kd}=Object,Tc=(n=>e=>{const t=wS.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),yr=n=>(n=n.toLowerCase(),e=>Tc(e)===n),Pc=n=>e=>typeof e===n,{isArray:vo}=Array,ns=Pc("undefined");function kS(n){return n!==null&&!ns(n)&&n.constructor!==null&&!ns(n.constructor)&&Cn(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const Uv=yr("ArrayBuffer");function xS(n){let e;return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&Uv(n.buffer),e}const ES=Pc("string"),Cn=Pc("function"),Mv=Pc("number"),jc=n=>n!==null&&typeof n=="object",_S=n=>n===!0||n===!1,Ea=n=>{if(Tc(n)!=="object")return!1;const e=kd(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},$S=yr("Date"),OS=yr("File"),AS=yr("Blob"),SS=yr("FileList"),TS=n=>jc(n)&&Cn(n.pipe),PS=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||Cn(n.append)&&((e=Tc(n))==="formdata"||e==="object"&&Cn(n.toString)&&n.toString()==="[object FormData]"))},jS=yr("URLSearchParams"),RS=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function $s(n,e,{allOwnKeys:t=!1}={}){if(n===null||typeof n=="undefined")return;let r,i;if(typeof n!="object"&&(n=[n]),vo(n))for(r=0,i=n.length;r<i;r++)e.call(null,n[r],r,n);else{const o=t?Object.getOwnPropertyNames(n):Object.keys(n),s=o.length;let a;for(r=0;r<s;r++)a=o[r],e.call(null,n[a],a,n)}}function Fv(n,e){e=e.toLowerCase();const t=Object.keys(n);let r=t.length,i;for(;r-- >0;)if(i=t[r],e===i.toLowerCase())return i;return null}const Vv=(()=>typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:global)(),Kv=n=>!ns(n)&&n!==Vv;function Wu(){const{caseless:n}=Kv(this)&&this||{},e={},t=(r,i)=>{const o=n&&Fv(e,i)||i;Ea(e[o])&&Ea(r)?e[o]=Wu(e[o],r):Ea(r)?e[o]=Wu({},r):vo(r)?e[o]=r.slice():e[o]=r};for(let r=0,i=arguments.length;r<i;r++)arguments[r]&&$s(arguments[r],t);return e}const IS=(n,e,t,{allOwnKeys:r}={})=>($s(e,(i,o)=>{t&&Cn(i)?n[o]=qv(i,t):n[o]=i},{allOwnKeys:r}),n),CS=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),NS=(n,e,t,r)=>{n.prototype=Object.create(e.prototype,r),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),t&&Object.assign(n.prototype,t)},BS=(n,e,t,r)=>{let i,o,s;const a={};if(e=e||{},n==null)return e;do{for(i=Object.getOwnPropertyNames(n),o=i.length;o-- >0;)s=i[o],(!r||r(s,n,e))&&!a[s]&&(e[s]=n[s],a[s]=!0);n=t!==!1&&kd(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e},LS=(n,e,t)=>{n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;const r=n.indexOf(e,t);return r!==-1&&r===t},DS=n=>{if(!n)return null;if(vo(n))return n;let e=n.length;if(!Mv(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=n[e];return t},qS=(n=>e=>n&&e instanceof n)(typeof Uint8Array!="undefined"&&kd(Uint8Array)),US=(n,e)=>{const t=(n&&n[Symbol.iterator]).call(n);let r;for(;(r=t.next())&&!r.done;){const i=r.value;e.call(n,i[0],i[1])}},MS=(n,e)=>{let t;const r=[];for(;(t=n.exec(e))!==null;)r.push(t);return r},FS=yr("HTMLFormElement"),VS=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,r){return t.toUpperCase()+r}),Up=(({hasOwnProperty:n})=>(e,t)=>n.call(e,t))(Object.prototype),KS=yr("RegExp"),Wv=(n,e)=>{const t=Object.getOwnPropertyDescriptors(n),r={};$s(t,(i,o)=>{e(i,o,n)!==!1&&(r[o]=i)}),Object.defineProperties(n,r)},WS=n=>{Wv(n,(e,t)=>{if(Cn(n)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const r=n[t];if(Cn(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},zS=(n,e)=>{const t={},r=i=>{i.forEach(o=>{t[o]=!0})};return vo(n)?r(n):r(String(n).split(e)),t},HS=()=>{},JS=(n,e)=>(n=+n,Number.isFinite(n)?n:e),Tl="abcdefghijklmnopqrstuvwxyz",Mp="0123456789",zv={DIGIT:Mp,ALPHA:Tl,ALPHA_DIGIT:Tl+Tl.toUpperCase()+Mp},YS=(n=16,e=zv.ALPHA_DIGIT)=>{let t="";const{length:r}=e;for(;n--;)t+=e[Math.random()*r|0];return t};function GS(n){return!!(n&&Cn(n.append)&&n[Symbol.toStringTag]==="FormData"&&n[Symbol.iterator])}const XS=n=>{const e=new Array(10),t=(r,i)=>{if(jc(r)){if(e.indexOf(r)>=0)return;if(!("toJSON"in r)){e[i]=r;const o=vo(r)?[]:{};return $s(r,(s,a)=>{const c=t(s,i+1);!ns(c)&&(o[a]=c)}),e[i]=void 0,o}}return r};return t(n,0)},ZS=yr("AsyncFunction"),QS=n=>n&&(jc(n)||Cn(n))&&Cn(n.then)&&Cn(n.catch),Q={isArray:vo,isArrayBuffer:Uv,isBuffer:kS,isFormData:PS,isArrayBufferView:xS,isString:ES,isNumber:Mv,isBoolean:_S,isObject:jc,isPlainObject:Ea,isUndefined:ns,isDate:$S,isFile:OS,isBlob:AS,isRegExp:KS,isFunction:Cn,isStream:TS,isURLSearchParams:jS,isTypedArray:qS,isFileList:SS,forEach:$s,merge:Wu,extend:IS,trim:RS,stripBOM:CS,inherits:NS,toFlatObject:BS,kindOf:Tc,kindOfTest:yr,endsWith:LS,toArray:DS,forEachEntry:US,matchAll:MS,isHTMLForm:FS,hasOwnProperty:Up,hasOwnProp:Up,reduceDescriptors:Wv,freezeMethods:WS,toObjectSet:zS,toCamelCase:VS,noop:HS,toFiniteNumber:JS,findKey:Fv,global:Vv,isContextDefined:Kv,ALPHABET:zv,generateString:YS,isSpecCompliantForm:GS,toJSONObject:XS,isAsyncFn:ZS,isThenable:QS};function Ke(n,e,t,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),r&&(this.request=r),i&&(this.response=i)}Q.inherits(Ke,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Q.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const Hv=Ke.prototype,Jv={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{Jv[n]={value:n}});Object.defineProperties(Ke,Jv);Object.defineProperty(Hv,"isAxiosError",{value:!0});Ke.from=(n,e,t,r,i,o)=>{const s=Object.create(Hv);return Q.toFlatObject(n,s,function(a){return a!==Error.prototype},a=>a!=="isAxiosError"),Ke.call(s,n.message,e,t,r,i),s.cause=n,s.name=n.name,o&&Object.assign(s,o),s};const eT=null;function zu(n){return Q.isPlainObject(n)||Q.isArray(n)}function Yv(n){return Q.endsWith(n,"[]")?n.slice(0,-2):n}function Fp(n,e,t){return n?n.concat(e).map(function(r,i){return r=Yv(r),!t&&i?"["+r+"]":r}).join(t?".":""):e}function tT(n){return Q.isArray(n)&&!n.some(zu)}const nT=Q.toFlatObject(Q,{},null,function(n){return/^is[A-Z]/.test(n)});function Rc(n,e,t){if(!Q.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,t=Q.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(d,f){return!Q.isUndefined(f[d])});const r=t.metaTokens,i=t.visitor||l,o=t.dots,s=t.indexes,a=(t.Blob||typeof Blob!="undefined"&&Blob)&&Q.isSpecCompliantForm(e);if(!Q.isFunction(i))throw new TypeError("visitor must be a function");function c(d){if(d===null)return"";if(Q.isDate(d))return d.toISOString();if(!a&&Q.isBlob(d))throw new Ke("Blob is not supported. Use a Buffer instead.");return Q.isArrayBuffer(d)||Q.isTypedArray(d)?a&&typeof Blob=="function"?new Blob([d]):Buffer.from(d):d}function l(d,f,g){let _=d;if(d&&!g&&typeof d=="object"){if(Q.endsWith(f,"{}"))f=r?f:f.slice(0,-2),d=JSON.stringify(d);else if(Q.isArray(d)&&tT(d)||(Q.isFileList(d)||Q.endsWith(f,"[]"))&&(_=Q.toArray(d)))return f=Yv(f),_.forEach(function(A,P){!(Q.isUndefined(A)||A===null)&&e.append(s===!0?Fp([f],P,o):s===null?f:f+"[]",c(A))}),!1}return zu(d)?!0:(e.append(Fp(g,f,o),c(d)),!1)}const u=[],h=Object.assign(nT,{defaultVisitor:l,convertValue:c,isVisitable:zu});function y(d,f){if(!Q.isUndefined(d)){if(u.indexOf(d)!==-1)throw Error("Circular reference detected in "+f.join("."));u.push(d),Q.forEach(d,function(g,_){(!(Q.isUndefined(g)||g===null)&&i.call(e,g,Q.isString(_)?_.trim():_,f,h))===!0&&y(g,f?f.concat(_):[_])}),u.pop()}}if(!Q.isObject(n))throw new TypeError("data must be an object");return y(n),e}function Vp(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(t){return e[t]})}function xd(n,e){this._pairs=[],n&&Rc(n,this,e)}const Gv=xd.prototype;Gv.append=function(n,e){this._pairs.push([n,e])};Gv.toString=function(n){const e=n?function(t){return n.call(this,t,Vp)}:Vp;return this._pairs.map(function(t){return e(t[0])+"="+e(t[1])},"").join("&")};function rT(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Xv(n,e,t){if(!e)return n;const r=t&&t.encode||rT,i=t&&t.serialize;let o;if(i?o=i(e,t):o=Q.isURLSearchParams(e)?e.toString():new xd(e,t).toString(r),o){const s=n.indexOf("#");s!==-1&&(n=n.slice(0,s)),n+=(n.indexOf("?")===-1?"?":"&")+o}return n}class iT{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Q.forEach(this.handlers,function(t){t!==null&&e(t)})}}const Kp=iT,Zv={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},oT=typeof URLSearchParams!="undefined"?URLSearchParams:xd,sT=typeof FormData!="undefined"?FormData:null,aT=typeof Blob!="undefined"?Blob:null,cT=(()=>{let n;return typeof navigator!="undefined"&&((n=navigator.product)==="ReactNative"||n==="NativeScript"||n==="NS")?!1:typeof window!="undefined"&&typeof document!="undefined"})(),lT=(()=>typeof WorkerGlobalScope!="undefined"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),or={isBrowser:!0,classes:{URLSearchParams:oT,FormData:sT,Blob:aT},isStandardBrowserEnv:cT,isStandardBrowserWebWorkerEnv:lT,protocols:["http","https","file","blob","url","data"]};function uT(n,e){return Rc(n,new or.classes.URLSearchParams,Object.assign({visitor:function(t,r,i,o){return or.isNode&&Q.isBuffer(t)?(this.append(r,t.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},e))}function hT(n){return Q.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function dT(n){const e={},t=Object.keys(n);let r;const i=t.length;let o;for(r=0;r<i;r++)o=t[r],e[o]=n[o];return e}function Qv(n){function e(t,r,i,o){let s=t[o++];const a=Number.isFinite(+s),c=o>=t.length;return s=!s&&Q.isArray(i)?i.length:s,c?(Q.hasOwnProp(i,s)?i[s]=[i[s],r]:i[s]=r,!a):((!i[s]||!Q.isObject(i[s]))&&(i[s]=[]),e(t,r,i[s],o)&&Q.isArray(i[s])&&(i[s]=dT(i[s])),!a)}if(Q.isFormData(n)&&Q.isFunction(n.entries)){const t={};return Q.forEachEntry(n,(r,i)=>{e(hT(r),i,t,0)}),t}return null}const fT={"Content-Type":void 0};function pT(n,e,t){if(Q.isString(n))try{return(e||JSON.parse)(n),Q.trim(n)}catch(r){if(r.name!=="SyntaxError")throw r}return(t||JSON.stringify)(n)}const Ic={transitional:Zv,adapter:["xhr","http"],transformRequest:[function(n,e){const t=e.getContentType()||"",r=t.indexOf("application/json")>-1,i=Q.isObject(n);if(i&&Q.isHTMLForm(n)&&(n=new FormData(n)),Q.isFormData(n))return r&&r?JSON.stringify(Qv(n)):n;if(Q.isArrayBuffer(n)||Q.isBuffer(n)||Q.isStream(n)||Q.isFile(n)||Q.isBlob(n))return n;if(Q.isArrayBufferView(n))return n.buffer;if(Q.isURLSearchParams(n))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),n.toString();let o;if(i){if(t.indexOf("application/x-www-form-urlencoded")>-1)return uT(n,this.formSerializer).toString();if((o=Q.isFileList(n))||t.indexOf("multipart/form-data")>-1){const s=this.env&&this.env.FormData;return Rc(o?{"files[]":n}:n,s&&new s,this.formSerializer)}}return i||r?(e.setContentType("application/json",!1),pT(n)):n}],transformResponse:[function(n){const e=this.transitional||Ic.transitional,t=e&&e.forcedJSONParsing,r=this.responseType==="json";if(n&&Q.isString(n)&&(t&&!this.responseType||r)){const i=!(e&&e.silentJSONParsing)&&r;try{return JSON.parse(n)}catch(o){if(i)throw o.name==="SyntaxError"?Ke.from(o,Ke.ERR_BAD_RESPONSE,this,null,this.response):o}}return n}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:or.classes.FormData,Blob:or.classes.Blob},validateStatus:function(n){return n>=200&&n<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};Q.forEach(["delete","get","head"],function(n){Ic.headers[n]={}});Q.forEach(["post","put","patch"],function(n){Ic.headers[n]=Q.merge(fT)});const Ed=Ic,yT=Q.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),gT=n=>{const e={};let t,r,i;return n&&n.split(`
`).forEach(function(o){i=o.indexOf(":"),t=o.substring(0,i).trim().toLowerCase(),r=o.substring(i+1).trim(),!(!t||e[t]&&yT[t])&&(t==="set-cookie"?e[t]?e[t].push(r):e[t]=[r]:e[t]=e[t]?e[t]+", "+r:r)}),e},Wp=Symbol("internals");function To(n){return n&&String(n).trim().toLowerCase()}function _a(n){return n===!1||n==null?n:Q.isArray(n)?n.map(_a):String(n)}function mT(n){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=t.exec(n);)e[r[1]]=r[2];return e}const vT=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function Pl(n,e,t,r,i){if(Q.isFunction(r))return r.call(this,e,t);if(i&&(e=t),!!Q.isString(e)){if(Q.isString(r))return e.indexOf(r)!==-1;if(Q.isRegExp(r))return r.test(e)}}function bT(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,r)=>t.toUpperCase()+r)}function wT(n,e){const t=Q.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(n,r+t,{value:function(i,o,s){return this[r].call(this,e,i,o,s)},configurable:!0})})}class Cc{constructor(e){e&&this.set(e)}set(e,t,r){const i=this;function o(a,c,l){const u=To(c);if(!u)throw new Error("header name must be a non-empty string");const h=Q.findKey(i,u);(!h||i[h]===void 0||l===!0||l===void 0&&i[h]!==!1)&&(i[h||c]=_a(a))}const s=(a,c)=>Q.forEach(a,(l,u)=>o(l,u,c));return Q.isPlainObject(e)||e instanceof this.constructor?s(e,t):Q.isString(e)&&(e=e.trim())&&!vT(e)?s(gT(e),t):e!=null&&o(t,e,r),this}get(e,t){if(e=To(e),e){const r=Q.findKey(this,e);if(r){const i=this[r];if(!t)return i;if(t===!0)return mT(i);if(Q.isFunction(t))return t.call(this,i,r);if(Q.isRegExp(t))return t.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=To(e),e){const r=Q.findKey(this,e);return!!(r&&this[r]!==void 0&&(!t||Pl(this,this[r],r,t)))}return!1}delete(e,t){const r=this;let i=!1;function o(s){if(s=To(s),s){const a=Q.findKey(r,s);a&&(!t||Pl(r,r[a],a,t))&&(delete r[a],i=!0)}}return Q.isArray(e)?e.forEach(o):o(e),i}clear(e){const t=Object.keys(this);let r=t.length,i=!1;for(;r--;){const o=t[r];(!e||Pl(this,this[o],o,e,!0))&&(delete this[o],i=!0)}return i}normalize(e){const t=this,r={};return Q.forEach(this,(i,o)=>{const s=Q.findKey(r,o);if(s){t[s]=_a(i),delete t[o];return}const a=e?bT(o):String(o).trim();a!==o&&delete t[o],t[a]=_a(i),r[a]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return Q.forEach(this,(r,i)=>{r!=null&&r!==!1&&(t[i]=e&&Q.isArray(r)?r.join(", "):r)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const r=new this(e);return t.forEach(i=>r.set(i)),r}static accessor(e){const t=(this[Wp]=this[Wp]={accessors:{}}).accessors,r=this.prototype;function i(o){const s=To(o);t[s]||(wT(r,o),t[s]=!0)}return Q.isArray(e)?e.forEach(i):i(e),this}}Cc.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Q.freezeMethods(Cc.prototype);Q.freezeMethods(Cc);const Er=Cc;function jl(n,e){const t=this||Ed,r=e||t,i=Er.from(r.headers);let o=r.data;return Q.forEach(n,function(s){o=s.call(t,o,i.normalize(),e?e.status:void 0)}),i.normalize(),o}function eb(n){return!!(n&&n.__CANCEL__)}function Os(n,e,t){Ke.call(this,n==null?"canceled":n,Ke.ERR_CANCELED,e,t),this.name="CanceledError"}Q.inherits(Os,Ke,{__CANCEL__:!0});function kT(n,e,t){const r=t.config.validateStatus;!t.status||!r||r(t.status)?n(t):e(new Ke("Request failed with status code "+t.status,[Ke.ERR_BAD_REQUEST,Ke.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}const xT=or.isStandardBrowserEnv?function(){return{write:function(n,e,t,r,i,o){const s=[];s.push(n+"="+encodeURIComponent(e)),Q.isNumber(t)&&s.push("expires="+new Date(t).toGMTString()),Q.isString(r)&&s.push("path="+r),Q.isString(i)&&s.push("domain="+i),o===!0&&s.push("secure"),document.cookie=s.join("; ")},read:function(n){const e=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(n){this.write(n,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}();function ET(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function _T(n,e){return e?n.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):n}function tb(n,e){return n&&!ET(e)?_T(n,e):e}const $T=or.isStandardBrowserEnv?function(){const n=/(msie|trident)/i.test(navigator.userAgent),e=document.createElement("a");let t;function r(i){let o=i;return n&&(e.setAttribute("href",o),o=e.href),e.setAttribute("href",o),{href:e.href,protocol:e.protocol?e.protocol.replace(/:$/,""):"",host:e.host,search:e.search?e.search.replace(/^\?/,""):"",hash:e.hash?e.hash.replace(/^#/,""):"",hostname:e.hostname,port:e.port,pathname:e.pathname.charAt(0)==="/"?e.pathname:"/"+e.pathname}}return t=r(window.location.href),function(i){const o=Q.isString(i)?r(i):i;return o.protocol===t.protocol&&o.host===t.host}}():function(){return function(){return!0}}();function OT(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function AT(n,e){n=n||10;const t=new Array(n),r=new Array(n);let i=0,o=0,s;return e=e!==void 0?e:1e3,function(a){const c=Date.now(),l=r[o];s||(s=c),t[i]=a,r[i]=c;let u=o,h=0;for(;u!==i;)h+=t[u++],u=u%n;if(i=(i+1)%n,i===o&&(o=(o+1)%n),c-s<e)return;const y=l&&c-l;return y?Math.round(h*1e3/y):void 0}}function zp(n,e){let t=0;const r=AT(50,250);return i=>{const o=i.loaded,s=i.lengthComputable?i.total:void 0,a=o-t,c=r(a),l=o<=s;t=o;const u={loaded:o,total:s,progress:s?o/s:void 0,bytes:a,rate:c||void 0,estimated:c&&s&&l?(s-o)/c:void 0,event:i};u[e?"download":"upload"]=!0,n(u)}}const ST=typeof XMLHttpRequest!="undefined",TT=ST&&function(n){return new Promise(function(e,t){let r=n.data;const i=Er.from(n.headers).normalize(),o=n.responseType;let s;function a(){n.cancelToken&&n.cancelToken.unsubscribe(s),n.signal&&n.signal.removeEventListener("abort",s)}Q.isFormData(r)&&(or.isStandardBrowserEnv||or.isStandardBrowserWebWorkerEnv?i.setContentType(!1):i.setContentType("multipart/form-data;",!1));let c=new XMLHttpRequest;if(n.auth){const y=n.auth.username||"",d=n.auth.password?unescape(encodeURIComponent(n.auth.password)):"";i.set("Authorization","Basic "+btoa(y+":"+d))}const l=tb(n.baseURL,n.url);c.open(n.method.toUpperCase(),Xv(l,n.params,n.paramsSerializer),!0),c.timeout=n.timeout;function u(){if(!c)return;const y=Er.from("getAllResponseHeaders"in c&&c.getAllResponseHeaders()),d={data:!o||o==="text"||o==="json"?c.responseText:c.response,status:c.status,statusText:c.statusText,headers:y,config:n,request:c};kT(function(f){e(f),a()},function(f){t(f),a()},d),c=null}if("onloadend"in c?c.onloadend=u:c.onreadystatechange=function(){!c||c.readyState!==4||c.status===0&&!(c.responseURL&&c.responseURL.indexOf("file:")===0)||setTimeout(u)},c.onabort=function(){!c||(t(new Ke("Request aborted",Ke.ECONNABORTED,n,c)),c=null)},c.onerror=function(){t(new Ke("Network Error",Ke.ERR_NETWORK,n,c)),c=null},c.ontimeout=function(){let y=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const d=n.transitional||Zv;n.timeoutErrorMessage&&(y=n.timeoutErrorMessage),t(new Ke(y,d.clarifyTimeoutError?Ke.ETIMEDOUT:Ke.ECONNABORTED,n,c)),c=null},or.isStandardBrowserEnv){const y=(n.withCredentials||$T(l))&&n.xsrfCookieName&&xT.read(n.xsrfCookieName);y&&i.set(n.xsrfHeaderName,y)}r===void 0&&i.setContentType(null),"setRequestHeader"in c&&Q.forEach(i.toJSON(),function(y,d){c.setRequestHeader(d,y)}),Q.isUndefined(n.withCredentials)||(c.withCredentials=!!n.withCredentials),o&&o!=="json"&&(c.responseType=n.responseType),typeof n.onDownloadProgress=="function"&&c.addEventListener("progress",zp(n.onDownloadProgress,!0)),typeof n.onUploadProgress=="function"&&c.upload&&c.upload.addEventListener("progress",zp(n.onUploadProgress)),(n.cancelToken||n.signal)&&(s=y=>{!c||(t(!y||y.type?new Os(null,n,c):y),c.abort(),c=null)},n.cancelToken&&n.cancelToken.subscribe(s),n.signal&&(n.signal.aborted?s():n.signal.addEventListener("abort",s)));const h=OT(l);if(h&&or.protocols.indexOf(h)===-1){t(new Ke("Unsupported protocol "+h+":",Ke.ERR_BAD_REQUEST,n));return}c.send(r||null)})},$a={http:eT,xhr:TT};Q.forEach($a,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch(t){}Object.defineProperty(n,"adapterName",{value:e})}});const PT={getAdapter:n=>{n=Q.isArray(n)?n:[n];const{length:e}=n;let t,r;for(let i=0;i<e&&(t=n[i],!(r=Q.isString(t)?$a[t.toLowerCase()]:t));i++);if(!r)throw r===!1?new Ke(`Adapter ${t} is not supported by the environment`,"ERR_NOT_SUPPORT"):new Error(Q.hasOwnProp($a,t)?`Adapter '${t}' is not available in the build`:`Unknown adapter '${t}'`);if(!Q.isFunction(r))throw new TypeError("adapter is not a function");return r},adapters:$a};function Rl(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new Os(null,n)}function Hp(n){return Rl(n),n.headers=Er.from(n.headers),n.data=jl.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),PT.getAdapter(n.adapter||Ed.adapter)(n).then(function(e){return Rl(n),e.data=jl.call(n,n.transformResponse,e),e.headers=Er.from(e.headers),e},function(e){return eb(e)||(Rl(n),e&&e.response&&(e.response.data=jl.call(n,n.transformResponse,e.response),e.response.headers=Er.from(e.response.headers))),Promise.reject(e)})}const Jp=n=>n instanceof Er?n.toJSON():n;function ao(n,e){e=e||{};const t={};function r(l,u,h){return Q.isPlainObject(l)&&Q.isPlainObject(u)?Q.merge.call({caseless:h},l,u):Q.isPlainObject(u)?Q.merge({},u):Q.isArray(u)?u.slice():u}function i(l,u,h){if(Q.isUndefined(u)){if(!Q.isUndefined(l))return r(void 0,l,h)}else return r(l,u,h)}function o(l,u){if(!Q.isUndefined(u))return r(void 0,u)}function s(l,u){if(Q.isUndefined(u)){if(!Q.isUndefined(l))return r(void 0,l)}else return r(void 0,u)}function a(l,u,h){if(h in e)return r(l,u);if(h in n)return r(void 0,l)}const c={url:o,method:o,data:o,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:a,headers:(l,u)=>i(Jp(l),Jp(u),!0)};return Q.forEach(Object.keys(Object.assign({},n,e)),function(l){const u=c[l]||i,h=u(n[l],e[l],l);Q.isUndefined(h)&&u!==a||(t[l]=h)}),t}const nb="1.4.0",_d={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{_d[n]=function(t){return typeof t===n||"a"+(e<1?"n ":" ")+n}});const Yp={};_d.transitional=function(n,e,t){function r(i,o){return"[Axios v"+nb+"] Transitional option '"+i+"'"+o+(t?". "+t:"")}return(i,o,s)=>{if(n===!1)throw new Ke(r(o," has been removed"+(e?" in "+e:"")),Ke.ERR_DEPRECATED);return e&&!Yp[o]&&(Yp[o]=!0,console.warn(r(o," has been deprecated since v"+e+" and will be removed in the near future"))),n?n(i,o,s):!0}};function jT(n,e,t){if(typeof n!="object")throw new Ke("options must be an object",Ke.ERR_BAD_OPTION_VALUE);const r=Object.keys(n);let i=r.length;for(;i-- >0;){const o=r[i],s=e[o];if(s){const a=n[o],c=a===void 0||s(a,o,n);if(c!==!0)throw new Ke("option "+o+" must be "+c,Ke.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new Ke("Unknown option "+o,Ke.ERR_BAD_OPTION)}}const Hu={assertOptions:jT,validators:_d},Kr=Hu.validators;class Za{constructor(e){this.defaults=e,this.interceptors={request:new Kp,response:new Kp}}request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=ao(this.defaults,t);const{transitional:r,paramsSerializer:i,headers:o}=t;r!==void 0&&Hu.assertOptions(r,{silentJSONParsing:Kr.transitional(Kr.boolean),forcedJSONParsing:Kr.transitional(Kr.boolean),clarifyTimeoutError:Kr.transitional(Kr.boolean)},!1),i!=null&&(Q.isFunction(i)?t.paramsSerializer={serialize:i}:Hu.assertOptions(i,{encode:Kr.function,serialize:Kr.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let s;s=o&&Q.merge(o.common,o[t.method]),s&&Q.forEach(["delete","get","head","post","put","patch","common"],f=>{delete o[f]}),t.headers=Er.concat(s,o);const a=[];let c=!0;this.interceptors.request.forEach(function(f){typeof f.runWhen=="function"&&f.runWhen(t)===!1||(c=c&&f.synchronous,a.unshift(f.fulfilled,f.rejected))});const l=[];this.interceptors.response.forEach(function(f){l.push(f.fulfilled,f.rejected)});let u,h=0,y;if(!c){const f=[Hp.bind(this),void 0];for(f.unshift.apply(f,a),f.push.apply(f,l),y=f.length,u=Promise.resolve(t);h<y;)u=u.then(f[h++],f[h++]);return u}y=a.length;let d=t;for(h=0;h<y;){const f=a[h++],g=a[h++];try{d=f(d)}catch(_){g.call(this,_);break}}try{u=Hp.call(this,d)}catch(f){return Promise.reject(f)}for(h=0,y=l.length;h<y;)u=u.then(l[h++],l[h++]);return u}getUri(e){e=ao(this.defaults,e);const t=tb(e.baseURL,e.url);return Xv(t,e.params,e.paramsSerializer)}}Q.forEach(["delete","get","head","options"],function(n){Za.prototype[n]=function(e,t){return this.request(ao(t||{},{method:n,url:e,data:(t||{}).data}))}});Q.forEach(["post","put","patch"],function(n){function e(t){return function(r,i,o){return this.request(ao(o||{},{method:n,headers:t?{"Content-Type":"multipart/form-data"}:{},url:r,data:i}))}}Za.prototype[n]=e(),Za.prototype[n+"Form"]=e(!0)});const Oa=Za;class $d{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(i){t=i});const r=this;this.promise.then(i=>{if(!r._listeners)return;let o=r._listeners.length;for(;o-- >0;)r._listeners[o](i);r._listeners=null}),this.promise.then=i=>{let o;const s=new Promise(a=>{r.subscribe(a),o=a}).then(i);return s.cancel=function(){r.unsubscribe(o)},s},e(function(i,o,s){r.reason||(r.reason=new Os(i,o,s),t(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}static source(){let e;return{token:new $d(function(t){e=t}),cancel:e}}}const RT=$d;function IT(n){return function(e){return n.apply(null,e)}}function CT(n){return Q.isObject(n)&&n.isAxiosError===!0}const Ju={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Ju).forEach(([n,e])=>{Ju[e]=n});const NT=Ju;function rb(n){const e=new Oa(n),t=qv(Oa.prototype.request,e);return Q.extend(t,Oa.prototype,e,{allOwnKeys:!0}),Q.extend(t,e,null,{allOwnKeys:!0}),t.create=function(r){return rb(ao(n,r))},t}const Et=rb(Ed);Et.Axios=Oa;Et.CanceledError=Os;Et.CancelToken=RT;Et.isCancel=eb;Et.VERSION=nb;Et.toFormData=Rc;Et.AxiosError=Ke;Et.Cancel=Et.CanceledError;Et.all=function(n){return Promise.all(n)};Et.spread=IT;Et.isAxiosError=CT;Et.mergeConfig=ao;Et.AxiosHeaders=Er;Et.formToJSON=n=>Qv(Q.isHTMLForm(n)?new FormData(n):n);Et.HttpStatusCode=NT;Et.default=Et;const BT=Et,Gp={init:({API_KEY:n})=>(...e)=>K(void 0,[...e],function*(t="post",r="/",i={},o={}){var s,a,c,l;const u=localStorage.getItem("accessToken");let h={Accept:"application/json","Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Key":n,"Access-Control-Allow-Methods":"POST, GET, OPTIONS, PUT, DELETE, HEAD,PATCH","Access-Control-Allow-Headers":"X-PINGOTHER, Origin, X-Requested-With, Content-Type, Accept","Access-Control-Max-Age":"1728000"};u&&(h.Authorization="Bearer "+u);const y=r;typeof(i==null?void 0:i.get)=="function"&&(i==null?void 0:i.get("file"))&&(h["Content-Type"]="multipart/form-data"),o!=null&&o.headers&&(h=Object.assign(...h,...o.headers),delete o.headers);const d=Object.assign({mode:"cors",method:t,url:y,data:i,headers:h},o);let f={};try{const g=yield BT(d);f.data=((s=g==null?void 0:g.data)==null?void 0:s.data)||(g==null?void 0:g.data),f.data||(f.data={})}catch(g){f.error=((c=(a=g.response)==null?void 0:a.data)==null?void 0:c.error)||((l=g.response)==null?void 0:l.error),f.error||(f.error={})}return f})};let Ys;const LT=new Uint8Array(16);function DT(){if(!Ys&&(Ys=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Ys))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ys(LT)}const Ut=[];for(let n=0;n<256;++n)Ut.push((n+256).toString(16).slice(1));function qT(n,e=0){return(Ut[n[e+0]]+Ut[n[e+1]]+Ut[n[e+2]]+Ut[n[e+3]]+"-"+Ut[n[e+4]]+Ut[n[e+5]]+"-"+Ut[n[e+6]]+Ut[n[e+7]]+"-"+Ut[n[e+8]]+Ut[n[e+9]]+"-"+Ut[n[e+10]]+Ut[n[e+11]]+Ut[n[e+12]]+Ut[n[e+13]]+Ut[n[e+14]]+Ut[n[e+15]]).toLowerCase()}const UT=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Xp={randomUUID:UT};function Il(n,e,t){if(Xp.randomUUID&&!e&&!n)return Xp.randomUUID();n=n||{};const r=n.random||(n.rng||DT)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let i=0;i<16;++i)e[t+i]=r[i];return e}return qT(r)}var ib={exports:{}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function i(c,l,u){this.fn=c,this.context=l,this.once=u||!1}function o(c,l,u,h,y){if(typeof u!="function")throw new TypeError("The listener must be a function");var d=new i(u,h||c,y),f=t?t+l:l;return c._events[f]?c._events[f].fn?c._events[f]=[c._events[f],d]:c._events[f].push(d):(c._events[f]=d,c._eventsCount++),c}function s(c,l){--c._eventsCount===0?c._events=new r:delete c._events[l]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var c=[],l,u;if(this._eventsCount===0)return c;for(u in l=this._events)e.call(l,u)&&c.push(t?u.slice(1):u);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(l)):c},a.prototype.listeners=function(c){var l=t?t+c:c,u=this._events[l];if(!u)return[];if(u.fn)return[u.fn];for(var h=0,y=u.length,d=new Array(y);h<y;h++)d[h]=u[h].fn;return d},a.prototype.listenerCount=function(c){var l=t?t+c:c,u=this._events[l];return u?u.fn?1:u.length:0},a.prototype.emit=function(c,l,u,h,y,d){var f=t?t+c:c;if(!this._events[f])return!1;var g=this._events[f],_=arguments.length,A,P;if(g.fn){switch(g.once&&this.removeListener(c,g.fn,void 0,!0),_){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,l),!0;case 3:return g.fn.call(g.context,l,u),!0;case 4:return g.fn.call(g.context,l,u,h),!0;case 5:return g.fn.call(g.context,l,u,h,y),!0;case 6:return g.fn.call(g.context,l,u,h,y,d),!0}for(P=1,A=new Array(_-1);P<_;P++)A[P-1]=arguments[P];g.fn.apply(g.context,A)}else{var B=g.length,C;for(P=0;P<B;P++)switch(g[P].once&&this.removeListener(c,g[P].fn,void 0,!0),_){case 1:g[P].fn.call(g[P].context);break;case 2:g[P].fn.call(g[P].context,l);break;case 3:g[P].fn.call(g[P].context,l,u);break;case 4:g[P].fn.call(g[P].context,l,u,h);break;default:if(!A)for(C=1,A=new Array(_-1);C<_;C++)A[C-1]=arguments[C];g[P].fn.apply(g[P].context,A)}}return!0},a.prototype.on=function(c,l,u){return o(this,c,l,u,!1)},a.prototype.once=function(c,l,u){return o(this,c,l,u,!0)},a.prototype.removeListener=function(c,l,u,h){var y=t?t+c:c;if(!this._events[y])return this;if(!l)return s(this,y),this;var d=this._events[y];if(d.fn)d.fn===l&&(!h||d.once)&&(!u||d.context===u)&&s(this,y);else{for(var f=0,g=[],_=d.length;f<_;f++)(d[f].fn!==l||h&&!d[f].once||u&&d[f].context!==u)&&g.push(d[f]);g.length?this._events[y]=g.length===1?g[0]:g:s(this,y)}return this},a.prototype.removeAllListeners=function(c){var l;return c?(l=t?t+c:c,this._events[l]&&s(this,l)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,n.exports=a})(ib);const MT=ib.exports;var FT={exports:{}};(function(n,e){(function(t){var r=this,i=Object.prototype.hasOwnProperty,o=function(c){for(var l=new Array(c.length),u=c.length,h=u-1;u--;)l[h-u]=c[u];return l},s=function(){var c=Array.prototype.slice.call(arguments);return c.length==2?s.find.apply(this,c):s.transform.apply(this,c)};s.find=function(c,l){return s.get(l,c)},s.memoizePath=!0;var a={};s.get=function(c,l,u){if(c===t||c===null||l===t||l===null)return u;var h;for(typeof l=="string"?s.memoizePath?a[l]?h=a[l].slice(0):(h=l.split(".").reverse(),a[l]=h.slice(0)):h=l.split(".").reverse():Array.isArray(l)&&(h=o(l));h.length&&(c=c[h.pop()])!==t&&c!==null;);return c===null&&h.length&&(c=t),c===t?u:c},s.exists=function(c,l){return s.get(c,l)!==t},s.set=function(c,l,u,h){var y=Array.isArray(l)?l:l.split("."),d=c,f,g=y.length;if(typeof d!="object")throw new Error("Parent is not an object.");for(var _=0;_<g;_++)if(f=y[_],(!i.call(d,f)||d[f]===t||(typeof d[f]!="object"||d[f]===null)&&h&&h.force===!0)&&(d[f]={}),_==g-1)d[f]=u;else{if(typeof d[f]!="object"||d[f]===null)throw new Error('Target key "'+f+'" is not suitable for a nested value. (It is in use as non-object. Set `force` to `true` to override.)');d=d[f]}d[f]=u},s.default=function(c,l,u){s.get(c,l)===t&&s.set(c,l,u)},s.transform=function(c,l){if(Array.isArray(c))return c.map(function(C){return s.transform(C,l)});l=l||{},l.delimiter=l.delimiter||".";var u,h,y,d,f={},g,_=Object.keys(c),A=_.length,P;for(P=0;P<A;P++)if(g=_[P],g.indexOf(l.delimiter)!==-1){u=g.split(l.delimiter),h=u.length,d=f;for(var B=0;B<h&&(y=u[B],B!=h-1&&!d.hasOwnProperty(y)&&(d[y]={}),B==h-1&&(d[y]=c[g]),d=d[y],d!==null);B++);}else f[g]=c[g];return f},s.flatten=function(c,l){typeof l=="undefined"&&(l=".");var u={},h,y;for(var d in c)if(i.call(c,d))if(h=c[d],Object.prototype.toString.call(h)==="[object Object]"){y=s.flatten(h,l);for(var f in y)u[d+l+f]=y[f]}else u[d]=h;return u},s.paths=function(c,l){var u=[],h,y;if(l=l||[],typeof c=="object")for(y in c)h=c[y],typeof h=="object"&&h!==null?u=u.concat(s.paths(h,l.concat([y]))):u.push(l.concat(y).join("."));else throw new Error("Paths was called with non-object argument.");return u},n.exports?n.exports=s:(r.Dottie=s,r.Dot=s,typeof t=="function"&&t([],function(){return s}))})()})(FT);function Cl(n,e){try{n(e)}catch(t){console.error("Error in subscription callback",t)}}const Wr=Symbol("subscriptions"),zr=Symbol("oneTimeEvents");class co{constructor(){this[Wr]=[],this[zr]=new Map}on(e,t){return this[zr].has(e)?Cl(t,this[zr].get(e)):(this[Wr].push({event:e,callback:t,once:!1}),this)}off(e,t){return this[Wr]=this[Wr].filter(r=>r.event!==e||t&&r.callback!==t),this}once(e,t){return new Promise(r=>{const i=o=>{r(o),t==null||t(o)};this[zr].has(e)?Cl(i,this[zr].get(e)):this[Wr].push({event:e,callback:i,once:!0})})}emit(e,t){if(this[zr].has(e))throw new Error(`Event "${e}" was supposed to be emitted only once`);for(let r=0;r<this[Wr].length;r++){const i=this[Wr][r];i.event===e&&(Cl(i.callback,t),i.once&&(this[Wr].splice(r,1),r--))}return this}emitOnce(e,t){if(this[zr].has(e))throw new Error(`Event "${e}" was supposed to be emitted only once`);return this.emit(e,t),this[zr].set(e,t),this.off(e),this}pipe(e,t){this.on(e,r=>{t.emit(e,r)})}pipeOnce(e,t){this.once(e,r=>{t.emitOnce(e,r)})}}function Hr(n){return n=n.replace(/\[/g,"/[").replace(/^\/+/,"").replace(/\/+$/,""),n.length===0?[]:n.split("/").map(e=>e.startsWith("[")?parseInt(e.slice(1,-1)):e)}class Y{static get(e){return new Y(e)}static getChildPath(e,t){return Y.get(e).child(t).path}static getPathKeys(e){return Hr(e)}constructor(e){typeof e=="string"?this.keys=Hr(e):e instanceof Array&&(this.keys=e),this.path=this.keys.reduce((t,r,i)=>i===0?`${r}`:typeof r=="string"?`${t}/${r}`:`${t}[${r}]`,"")}get key(){return this.keys.length===0?null:this.keys.slice(-1)[0]}get parent(){if(this.keys.length==0)return null;const e=this.keys.slice(0,-1);return new Y(e)}get parentPath(){return this.keys.length===0?null:this.parent.path}child(e){if(typeof e=="string"){if(e.length===0)throw new Error(`child key for path "${this.path}" cannot be empty`);const t=Hr(e);t.forEach(r=>{if(typeof r=="string"){if(/[\x00-\x08\x0b\x0c\x0e-\x1f/[\]\\]/.test(r))throw new Error(`Invalid child key "${r}" for path "${this.path}". Keys cannot contain control characters or any of the following characters: \\ / [ ]`);if(r.length>128)throw new Error(`child key "${r}" for path "${this.path}" is too long. Max key length is 128`);if(r.length===0)throw new Error(`child key for path "${this.path}" cannot be empty`)}}),e=t}return new Y(this.keys.concat(e))}childPath(e){return this.child(e).path}get pathKeys(){return this.keys}static extractVariables(e,t){if(!e.includes("*")&&!e.includes("$"))return[];const r=Hr(e),i=Hr(t);let o=0;const s={get length(){return o}};return r.forEach((a,c)=>{const l=i[c];if(a==="*")s[o++]=l;else if(typeof a=="string"&&a[0]==="$"){s[o++]=l,s[a]=l;const u=a.slice(1);typeof s[u]=="undefined"&&(s[u]=l)}}),s}static fillVariables(e,t){if(e.indexOf("*")<0&&e.indexOf("$")<0)return e;const r=Hr(e),i=Hr(t),o=r.map((a,c)=>{if(a===i[c]||c>=i.length)return a;if(typeof a=="string"&&(a==="*"||a[0]==="$"))return i[c];throw new Error(`Path "${t}" cannot be used to fill variables of path "${e}" because they do not match`)});let s="";return o.forEach(a=>{typeof a=="number"?s+=`[${a}]`:(s.length>0&&(s+="/"),s+=a)}),s}static fillVariables2(e,t){if(typeof t!="object"||Object.keys(t).length===0)return e;const r=Hr(e);let i=0;return r.reduce((o,s)=>typeof s=="string"&&(s==="*"||s.startsWith("$"))?Y.getChildPath(o,t[i++]):Y.getChildPath(o,s),"")}equals(e){const t=e instanceof Y?e:new Y(e);return this.path===t.path?!0:this.keys.length!==t.keys.length?!1:this.keys.every((r,i)=>{const o=t.keys[i];return o===r||typeof o=="string"&&(o==="*"||o[0]==="$")||typeof r=="string"&&(r==="*"||r[0]==="$")})}isAncestorOf(e){const t=e instanceof Y?e:new Y(e);return t.path===""||this.path===t.path?!1:this.path===""?!0:this.keys.length>=t.keys.length?!1:this.keys.every((r,i)=>{const o=t.keys[i];return o===r||typeof o=="string"&&(o==="*"||o[0]==="$")||typeof r=="string"&&(r==="*"||r[0]==="$")})}isDescendantOf(e){const t=e instanceof Y?e:new Y(e);return this.path===""||this.path===t.path?!1:e===""?!0:t.keys.length>=this.keys.length?!1:t.keys.every((r,i)=>{const o=this.keys[i];return o===r||typeof o=="string"&&(o==="*"||o[0]==="$")||typeof r=="string"&&(r==="*"||r[0]==="$")})}isOnTrailOf(e){const t=e instanceof Y?e:new Y(e);return this.path.length===0||t.path.length===0||this.path===t.path?!0:this.pathKeys.every((r,i)=>{if(i>=t.keys.length)return!0;const o=t.keys[i];return o===r||typeof o=="string"&&(o==="*"||o[0]==="$")||typeof r=="string"&&(r==="*"||r[0]==="$")})}isChildOf(e){const t=e instanceof Y?e:new Y(e);return this.path===""?!1:this.parent.equals(t)}isParentOf(e){const t=e instanceof Y?e:new Y(e);return t.path===""?!1:this.equals(t.parent)}}function Nl(n,e,t=!1){if(!n.exists())return null;let r=t?n.previous():n.val();return typeof e=="number"?r[e]:(Y.getPathKeys(e).every(i=>(r=r[i],typeof r!="undefined")),r||null)}function Bl(n){if(!n.exists())return[];const e=n.val();return e instanceof Array?new Array(e.length).map((t,r)=>r):typeof e=="object"?Object.keys(e):[]}class it{exists(){return!1}constructor(e,t,r=!1,i,o){this.ref=e,this.val=()=>t,this.previous=()=>i,this.exists=()=>r?!1:t!==null&&typeof t!="undefined",this.context=()=>o||{}}static for(e,t){return new it(e,t)}child(e){const t=Nl(this,e,!1),r=Nl(this,e,!0);return new it(this.ref.child(e),t,!1,r)}hasChild(e){return Nl(this,e)!==null}hasChildren(){return Bl(this).length>0}numChildren(){return Bl(this).length}forEach(e){const t=this.val(),r=this.previous();return Bl(this).every(i=>{const o=new it(this.ref.child(i),t[i],!1,r[i]);return e(o)})}get key(){return this.ref.key}}class Aa extends it{constructor(e,t,r){super(e,t,!1,void 0,r),this.previous=()=>{throw new Error("Iterate values to get previous values for each mutation")},this.val=(i=!0)=>(i&&console.warn("Unless you know what you are doing, it is best not to use the value of a mutations snapshot directly. Use child methods and forEach to iterate the mutations instead"),t)}forEach(e){return this.val(!1).every(t=>{const r=t.target.reduce((o,s)=>o.child(s),this.ref),i=new it(r,t.val,!1,t.prev);return e(i)})}child(e){if(typeof e!="number")throw new Error("child index must be a number");const t=this.val(!1)[e],r=t.target.reduce((i,o)=>i.child(o),this.ref);return new it(r,t.val,!1,t.prev)}}class ob{constructor(e){this.stop=e,this._internal={state:"init",activatePromises:[]}}activated(e){return e&&(this._internal.activatePromises.push({callback:e}),this._internal.state==="active"?e(!0):this._internal.state==="canceled"&&e(!1,this._internal.cancelReason)),new Promise((t,r)=>{if(this._internal.state==="active")return t();if(this._internal.state==="canceled"&&!e)return r(new Error(this._internal.cancelReason));const i=()=>{};this._internal.activatePromises.push({resolve:t,reject:e?i:r})})}_setActivationState(e,t){for(this._internal.cancelReason=t,this._internal.state=e?"active":"canceled";this._internal.activatePromises.length>0;){const r=this._internal.activatePromises.shift();e?(r.callback&&r.callback(!0),r.resolve&&r.resolve()):(r.callback&&r.callback(!1,t),r.reject&&r.reject(t))}}}class VT{constructor(e,t,r){this.publish=e,this.start=t,this.cancel=r}}class KT{constructor(e){const t=[];let r,i;const o="stopped (no more subscribers)";this.subscribe=(h,y)=>{if(typeof h!="function")throw new TypeError("callback must be a function");if(i===o)throw new Error("stream can't be used anymore because all subscribers were stopped");const d={callback:h,activationCallback:function(f,g){y==null||y(f,g),this.subscription._setActivationState(f,g)},subscription:new ob(function(){return t.splice(t.indexOf(this),1),s()})};return t.push(d),typeof i!="undefined"&&(i===!0?(y==null||y(!0),d.subscription._setActivationState(!0)):typeof i=="string"&&(y==null||y(!1,i),d.subscription._setActivationState(!1,i))),d.subscription};const s=()=>{let h;return t.length===0&&(h=r==null?void 0:r(),i=o),Promise.resolve(h)};this.unsubscribe=h=>{(h?t.filter(y=>y.callback===h):t).forEach(y=>{const d=t.indexOf(y);t.splice(d,1)}),s()},this.stop=()=>{t.splice(0),s()};const a=h=>(t.forEach(y=>{try{y.callback(h)}catch(d){console.error(`Error running subscriber callback: ${d.message}`)}}),t.length===0&&s(),t.length>0),c=h=>{i=!0,r=h,t.forEach(y=>{var d;(d=y.activationCallback)==null||d.call(y,!0)})},l=h=>{i=h,t.forEach(y=>{var d;(d=y.activationCallback)==null||d.call(y,!1,h||new Error("unknown reason"))}),t.splice(0)},u=new VT(a,c,l);e(u)}}function Od(n,e){const t="000000000"+n;return t.substr(t.length-e)}const WT=typeof window=="object"?window:self,zT=Object.keys(WT).length;var Zp,Qp;const HT=(Qp=(Zp=navigator.mimeTypes)==null?void 0:Zp.length)!=null?Qp:0,JT=Od((HT+navigator.userAgent.length).toString(36)+zT.toString(36),4);function YT(){return JT}let Po=0;const Ad=4,Qa=36,sb=Math.pow(Qa,Ad);function ey(){return Od((Math.random()*sb<<0).toString(Qa),Ad)}function GT(){return Po=Po<sb?Po:0,Po++,Po-1}function XT(n=0){const e="c",t=(new Date().getTime()+n).toString(Qa),r=Od(GT().toString(Qa),Ad),i=YT(),o=ey()+ey();return e+t+r+i+o}let ty=0;class Vt{static set timeBias(e){typeof e=="number"&&(ty=e)}static generate(){return XT(ty).slice(1)}}class ot{constructor(e){this.path=e}}const Sn={nextTick(n){setTimeout(n,0)}};class ec{constructor(e){if(e instanceof Array)for(let t=0;t<e.length;t++)typeof e[t]!="undefined"&&(this[t]=e[t]);else e&&Object.assign(this,e)}}function ZT(n){const e=new Uint8Array(8);return new DataView(e.buffer).setFloat64(0,n),new Array(...e)}function QT(n){if((Array.isArray(n)?n.length:n.byteLength)!==8)throw new TypeError("must be 8 bytes");const e=new Uint8Array(n);return new DataView(e.buffer).getFloat64(0)}const ni={zero:BigInt(0),one:BigInt(1),two:BigInt(2),eight:BigInt(8),ff:BigInt(255)};function eP(n){if(typeof n!="bigint")throw new Error("number must be a bigint");const e=[],t=n<ni.zero;do{const r=Number(n&ni.ff);e.push(r),n=n>>ni.eight}while(n!==(t?-ni.one:ni.zero));return e.reverse(),(t?e[0]<128:e[0]>=128)&&e.unshift(t?255:0),e}function tP(n){const e=n[0]>=128;let t=ni.zero;for(let r of n)e&&(r=~r&255),t=(t<<ni.eight)+BigInt(r);return e&&(t=-(t+ni.one)),t}function nP(n){if(typeof TextEncoder!="undefined")return new TextEncoder().encode(n);if(typeof Buffer=="function"){const e=Buffer.from(n,"utf-8");return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}else{const e=[];for(let t=0;t<n.length;t++){let r=n.charCodeAt(t);if(r>128){if((r&55296)===55296){const i=n.charCodeAt(t+1);if((i&56320)!==56320)throw new Error("follow-up utf-16 character does not start with 0xDC00");t++;const o=r&1023,s=i&1023;r=65536|o<<10|s}if(r<2048){const i=192|r>>6&31,o=128|r&63;e.push(i,o)}else if(r<65536){const i=224|r>>12&15,o=128|r>>6&63,s=128|r&63;e.push(i,o,s)}else if(r<2097152){const i=240|r>>18&7,o=128|r>>12&63,s=128|r>>6&63,a=128|r&63;e.push(i,o,s,a)}else throw new Error(`Cannot convert character ${n.charAt(t)} (code ${r}) to utf-8`)}else e.push(r<128?r:63)}return new Uint8Array(e)}}function ab(n){if(typeof TextDecoder!="undefined"){const e=new TextDecoder;if(n instanceof Uint8Array)return e.decode(n);const t=Uint8Array.from(n);return e.decode(t)}else if(typeof Buffer=="function"){if(n instanceof Array&&(n=Uint8Array.from(n)),!(n instanceof Buffer)&&"buffer"in n&&n.buffer instanceof ArrayBuffer){const e=n;n=Buffer.from(e.buffer,e.byteOffset,e.byteLength)}if(!(n instanceof Buffer))throw new Error("Unsupported buffer argument");return n.toString("utf-8")}else{if(!(n instanceof Uint8Array)&&"buffer"in n&&n.buffer instanceof ArrayBuffer){const e=n;n=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}if(n instanceof Buffer||n instanceof Array||n instanceof Uint8Array){let e="";for(let t=0;t<n.length;t++){let r=n[t];if(r>128)if((r&240)===240){const i=r,o=n[t+1],s=n[t+2],a=n[t+3];r=(i&7)<<18|(o&63)<<12|(s&63)<<6|a&63,t+=3}else if((r&224)===224){const i=r,o=n[t+1],s=n[t+2];r=(i&15)<<12|(o&63)<<6|s&63,t+=2}else if((r&192)===192){const i=r,o=n[t+1];r=(i&31)<<6|o&63,t++}else throw new Error("invalid utf-8 data");if(r>=65536){r^=65536;const i=55296|r>>10,o=56320|r&1023;e+=String.fromCharCode(i),e+=String.fromCharCode(o)}else e+=String.fromCharCode(r)}return e}else throw new Error("Unsupported buffer argument")}}function rP(n,e){const t=new n.constructor(n.length+e.length);return t.set(n),t.set(e,n.length),t}function Wn(n,e){var t;if(((t=n==null?void 0:n.constructor)==null?void 0:t.name)==="DataSnapshot")throw new TypeError(`Object to clone is a DataSnapshot (path "${n.ref.path}")`);const r=s=>(s!==null&&typeof s=="object"&&typeof s.constructor=="function"&&typeof s.constructor.name=="string"&&["Buffer","Uint8Array","Int8Array","Uint16Array","Int16Array","Uint32Array","Int32Array","BigUint64Array","BigInt64Array"].includes(s.constructor.name)&&(s=s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)),s);if(n=r(n),typeof n!="object"||n===null||n instanceof Date||n instanceof ArrayBuffer||n instanceof ot||n instanceof RegExp)return n;const i=s=>{if(e.indexOf(s)>=0)throw new ReferenceError("object contains a circular reference");return s=r(s),s===null||s instanceof Date||s instanceof ArrayBuffer||s instanceof ot||s instanceof RegExp||typeof s=="object"&&(e.push(s),s=Wn(s,e),e.pop()),s};typeof e=="undefined"&&(e=[n]);const o=n instanceof Array?[]:n instanceof ec?new ec:{};return Object.keys(n).forEach(s=>{const a=n[s];typeof a!="function"&&(o[s]=i(a))}),o}const si=n=>typeof n=="object"&&["ArrayBuffer","Buffer","Uint8Array","Uint16Array","Uint32Array","Int8Array","Int16Array","Int32Array"].includes(n.constructor.name);function tc(n,e){if(n===e)return!0;if(typeof n!=typeof e)return!1;if(typeof n=="object"||typeof e=="object"){if(n===null||e===null)return!1;if(n instanceof ot||e instanceof ot)return n instanceof ot&&e instanceof ot&&n.path===e.path;if(n instanceof Date||e instanceof Date)return n instanceof Date&&e instanceof Date&&n.getTime()===e.getTime();if(n instanceof Array||e instanceof Array)return n instanceof Array&&e instanceof Array&&n.length===e.length&&n.every((i,o)=>tc(n[o],e[o]));if(si(n)||si(e)){if(!si(n)||!si(e)||n.byteLength===e.byteLength)return!1;const i=n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength),o=e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength);return i.every((s,a)=>o[a]===s)}const t=Object.keys(n),r=Object.keys(e);return t.length===r.length&&t.every(i=>r.includes(i))&&t.every(i=>tc(n[i],e[i]))}return!1}class cb{constructor(e,t,r){this.added=e,this.removed=t,this.changed=r}forChild(e){if(this.added.includes(e))return"added";if(this.removed.includes(e))return"removed";const t=this.changed.find(r=>r.key===e);return t?t.change:"identical"}}function Sd(n,e,t=!1){const r=[void 0,null];if(n===e)return"identical";if(r.indexOf(n)>=0&&r.indexOf(e)<0)return"added";if(r.indexOf(n)<0&&r.indexOf(e)>=0)return"removed";if(typeof n!=typeof e)return"changed";if(si(n)||si(e)){if(!si(n)||!si(e))return"changed";const i=n instanceof Uint8Array?n:n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength),o=e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength);return i.byteLength===o.byteLength&&i.every((s,a)=>o[a]===s)?"identical":"changed"}else{if(n instanceof Date||e instanceof Date)return n instanceof Date&&e instanceof Date&&n.getTime()===e.getTime()?"identical":"changed";if(n instanceof ot||e instanceof ot)return n instanceof ot&&e instanceof ot&&n.path===e.path?"identical":"changed";if(typeof n=="object"){const i=n instanceof Array,o=h=>{let y=Object.keys(h).filter(d=>!r.includes(h[d]));return i&&(y=y.map(d=>parseInt(d))),y},s=o(n),a=o(e),c=s.filter(h=>!a.includes(h)),l=a.filter(h=>!s.includes(h)),u=a.reduce((h,y)=>{if(s.includes(y)){const d=n[y],f=e[y],g=Sd(d,f);g!=="identical"&&h.push({key:y,change:g})}return h},[]);return l.length===0&&c.length===0&&u.length===0?"identical":new cb(l,c,t?u.sort((h,y)=>h.key<y.key?-1:1):u)}}return"changed"}function lb(n,e,t=!1){const r=(o,s,a,c)=>{switch(s){case"identical":return[];case"changed":return[{target:o,prev:a,val:c}];case"added":return[{target:o,prev:null,val:c}];case"removed":return[{target:o,prev:a,val:null}];default:{let l=[];return s.added.forEach(u=>l.push({target:o.concat(u),prev:null,val:c[u]})),s.removed.forEach(u=>l.push({target:o.concat(u),prev:a[u],val:null})),s.changed.forEach(u=>{const h=r(o.concat(u.key),u.change,a[u.key],c[u.key]);l=l.concat(h)}),l}}},i=Sd(n,e,t);return r([],i,n,e)}function iP(n,e,t){return e=e===null?null:e[n],typeof e=="undefined"&&(e=null),t=t===null?null:t[n],typeof t=="undefined"&&(t=null),{oldValue:e,newValue:t}}function oP(n){Sn.nextTick(n)}function ub(){var n;return typeof globalThis!="undefined"?globalThis:typeof global!="undefined"?global:typeof window!="undefined"?window:typeof self!="undefined"?self:(n=function(){return this}())!=null?n:Function("return this")()}const hb=Object.freeze(Object.defineProperty({__proto__:null,numberToBytes:ZT,bytesToNumber:QT,bigintToBytes:eP,bytesToBigint:tP,encodeString:nP,decodeString:ab,concatTypedArrays:rP,cloneObject:Wn,valuesAreEqual:tc,ObjectDifferences:cb,compareValues:Sd,getMutations:lb,getChildValues:iP,defer:oP,getGlobalObject:ub},Symbol.toStringTag,{value:"Module"})),sP="modulepreload",aP=function(n){return"/"+n},ny={},cP=function(n,e,t){if(!e||e.length===0)return n();const r=document.getElementsByTagName("link");return Promise.all(e.map(i=>{if(i=aP(i),i in ny)return;ny[i]=!0;const o=i.endsWith(".css"),s=o?'[rel="stylesheet"]':"";if(t)for(let c=r.length-1;c>=0;c--){const l=r[c];if(l.href===i&&(!o||l.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${s}`))return;const a=document.createElement("link");if(a.rel=o?"stylesheet":sP,o||(a.as="script",a.crossOrigin=""),a.href=i,document.head.appendChild(a),o)return new Promise((c,l)=>{a.addEventListener("load",c),a.addEventListener("error",()=>l(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>n())};let db=!1,li;K(void 0,null,function*(){const n=ub();if(typeof n.Observable!="undefined"){li=n.Observable;return}try{const{Observable:e}=yield cP(()=>Promise.resolve().then(()=>sC),void 0);li=e}catch(e){li=Pd}});function Td(){if(li===Pd&&!db&&console.warn(`Using AceBase's simple Observable implementation because rxjs is not available. Add it to your project with "npm install rxjs", add it to AceBase using db.setObservable(Observable), or call db.setObservable("shim") to suppress this warning`),li)return li;throw new Error("RxJS Observable could not be loaded. ")}function lP(n){n==="shim"?(li=Pd,db=!0):li=n}class Pd{constructor(e){this._active=!1,this._subscribers=[],this._create=e}subscribe(e){if(!this._active){const t={next:r=>{this._subscribers.forEach(i=>{try{i(r)}catch(o){console.error("Error in subscriber callback:",o)}})}};this._cleanup=this._create(t),this._active=!0}return this._subscribers.push(e),{unsubscribe:()=>{this._subscribers.splice(this._subscribers.indexOf(e),1),this._subscribers.length===0&&(this._active=!1,this._cleanup())}}}}class vn extends Array{static areEqual(e,t){return e.length===t.length&&e.every((r,i)=>t[i]===r)}static isAncestor(e,t){return e.length<t.length&&e.every((r,i)=>t[i]===r)}static isDescendant(e,t){return e.length>t.length&&t.every((r,i)=>e[i]===r)}}const Ei=Symbol("isProxy");class uP{static create(e,t){return K(this,null,function*(){var r;e=new Yn(e.db,e.path);let i,o=!1,s=t==null?void 0:t.cursor,a;const c=Vt.generate(),l=[],u=new co;u.on("cursor",p=>s=p),u.on("error",p=>{console.error(p.message,p.details)});const h=(p,v)=>{if(p.length===0)return i=v,!0;let m=i;const w=p.slice();for(;w.length>1;){const b=w.shift();if(!(b in m))return!1;m=m[b]}const E=w.shift();return v===null?m instanceof Array?m.splice(E,1):delete m[E]:m[E]=v,!0},y=()=>K(this,null,function*(){!o||(yield O())}),d=e.on("mutations",{syncFallback:y}).subscribe(p=>K(this,null,function*(){var v;if(!o)return;const m=p.context(),w=((v=m.acebase_proxy)==null?void 0:v.id)!==c;!w||(p.val(!1).every(E=>{if(!h(E.target,E.val))return!1;const b=E.target.reduce((x,$)=>x.child($),e),k=new it(b,E.val,!1,E.prev,p.context());return u.emit("mutation",{snapshot:k,isRemote:w}),!0})?(u.emit("cursor",m.acebase_cursor),j.emit("mutations",{origin:"remote",snap:p})):(console.warn(`Cached value of live data proxy on "${e.path}" appears outdated, will be reloaded`),yield O()))}));let f=Promise.resolve();const g=[],_=[],A=()=>K(this,null,function*(){const p=[];for(let v=0,m=g[0];v<g.length;v++,m=g[v])_.find(w=>vn.areEqual(w.target,m.target)||vn.isAncestor(w.target,m.target))||(g.splice(v,1),v--,p.push(m));p.length!==0&&(p.forEach(v=>{v.value=Wn(_n(i,v.target))}),Sn.nextTick(()=>{const v={acebase_proxy:{id:c,source:"update"}};p.forEach(w=>{const E=w.target.reduce((k,x)=>k.child(x),e),b=new it(E,w.value,!1,w.previous,v);u.emit("mutation",{snapshot:b,isRemote:!1})});const m=new Aa(e,p.map(w=>({target:w.target,val:w.value,prev:w.previous})),v);j.emit("mutations",{origin:"local",snap:m})}),f=p.reduce((v,m,w,E)=>(E.some(b=>vn.isAncestor(b.target,m.target))||v.push(m),v),[]).reduce((v,m)=>{const w=m.target;if(w.length===0)v.push({ref:e,target:w,value:i,type:"set",previous:m.previous});else{const E=w.slice(0,-1),b=w.slice(-1)[0],k=E.reduce((T,R)=>T.child(R),e),x=v.find(T=>T.ref.path===k.path),$=_n(i,w),S=m.previous;x?(x.value[b]=$,x.previous[b]=S):v.push({ref:k,target:E,value:{[b]:$},type:"update",previous:{[b]:S}})}return v},[]).reduce((v,m)=>K(this,null,function*(){const w={acebase_proxy:{id:c,source:m.type}};yield v,yield m.ref.context(w)[m.type](m.value).catch(E=>{u.emit("error",{source:"update",message:`Error processing update of "/${e.path}"`,details:E});const b={acebase_proxy:{id:c,source:"update-rollback"}},k=[];if(m.type==="set"){Ll(i,m.target,m.previous);const $=new it(m.ref,m.previous,!1,m.value,b);u.emit("mutation",{snapshot:$,isRemote:!1}),k.push({target:m.target,val:m.previous,prev:m.value})}else Object.keys(m.previous).forEach($=>{Ll(i,m.target.concat($),m.previous[$]);const S=new it(m.ref.child($),m.previous[$],!1,m.value[$],b);u.emit("mutation",{snapshot:S,isRemote:!1}),k.push({target:m.target.concat($),val:m.previous[$],prev:m.value[$]})});k.forEach($=>{const S=$.target.reduce((R,N)=>R.child(N),e),T=new it(S,$.val,!1,$.prev,b);u.emit("mutation",{snapshot:T,isRemote:!1})});const x=new Aa(m.ref,k,b);j.emit("mutations",{origin:"local",snap:x})}),m.ref.cursor&&u.emit("cursor",m.ref.cursor)}),f),yield f)});let P=!1;const B=[],C=()=>{let p;const v=new Promise(m=>p=m);return B.push({resolve:p}),v};let L=null;const q=()=>{L||(L=setTimeout(()=>K(this,null,function*(){P=!0,L=null,yield A(),P=!1,B.splice(0).forEach(p=>p.resolve())}),0))},H=p=>{g.find(v=>vn.areEqual(v.target,p))||g.push({target:p,previous:Wn(_n(i,p))}),q()},j=new co,I=(p,v)=>{const m=b=>b!==null&&typeof b=="object",w=b=>K(this,null,function*(){var k;const{snap:x,origin:$}=b,S=x.context(),T=((k=S.acebase_proxy)==null?void 0:k.id)===c;if(b.origin==="remote"&&T){console.error("DEV ISSUE: mutationsHandler was called from remote event originating from our own proxy");return}const R=x.val(!1).filter(ne=>ne.target.slice(0,p.length).every((te,pe)=>p[pe]===te));if(R.length===0)return;let N,z;const F=R.find(ne=>ne.target.length<=p.length);if(F){const ne=p.slice(F.target.length);N=ne.reduce((te,pe)=>!m(te)||!(pe in te)?null:te[pe],F.val),z=ne.reduce((te,pe)=>!m(te)||!(pe in te)?null:te[pe],F.prev)}else{const ne=_n(i,p);N=Wn(ne),z=Wn(N),R.forEach(te=>{const pe=te.target.slice(p.length);for(let oe=0,re=N,ue=z;oe<pe.length;oe++){const Ne=oe+1===pe.length,ye=pe[oe];Ne?(re[ye]=te.val,re[ye]===null&&delete re[ye],ue[ye]=te.prev,ue[ye]===null&&delete ue[ye]):(re=re[ye]=ye in re?re[ye]:{},ue=ue[ye]=ye in ue?ue[ye]:{})}})}Sn.nextTick(()=>{let ne=!0;try{ne=v(Object.freeze(N),Object.freeze(z),!T,S)!==!1}catch(te){u.emit("error",{source:$==="remote"?"remote_update":"local_update",message:"Error running subscription callback",details:te})}ne===!1&&E()})});j.on("mutations",w);const E=()=>{j.off("mutations",w),l.splice(l.findIndex(b=>b.stop===E),1)};return l.push({target:p,stop:E}),{stop:E}},D=(p,v,m)=>{if(p==="write")return H(v);if(p==="onChange")return I(v,m.callback);if(p==="subscribe"||p==="observe"){const w=b=>{const k=_n(i,v);b.next(k);const x=I(v,$=>{b.next($)});return function(){x.stop()}};if(p==="subscribe")return w;const E=Td();return new E(w)}else if(p==="transaction")return _.some(w=>vn.areEqual(v,w.target)||vn.isAncestor(v,w.target)||vn.isDescendant(v,w.target))?Promise.reject(new Error("Cannot start transaction because it conflicts with another transaction")):new Promise(w=>K(this,null,function*(){g.some(b=>vn.areEqual(v,b.target)||vn.isAncestor(v,b.target))&&(P||q(),yield C());const E={target:v,status:"started",transaction:null};_.push(E),E.transaction={get status(){return E.status},get completed(){return E.status!=="started"},get mutations(){return g.filter(b=>vn.areEqual(E.target,b.target)||vn.isAncestor(E.target,b.target))},get hasMutations(){return this.mutations.length>0},commit(){return K(this,null,function*(){if(this.completed)throw new Error(`Transaction has completed already (status '${E.status}')`);E.status="finished",_.splice(_.indexOf(E),1),P&&(yield C()),q(),yield C()})},rollback(){if(this.completed)throw new Error(`Transaction has completed already (status '${E.status}')`);E.status="canceled";const b=[];for(let k=0;k<g.length;k++){const x=g[k];(vn.areEqual(E.target,x.target)||vn.isAncestor(E.target,x.target))&&(g.splice(k,1),k--,b.push(x))}b.reverse().forEach(k=>{k.target.length===0?i=k.previous:Ll(i,k.target,k.previous)}),_.splice(_.indexOf(E),1)}},w(E.transaction)}))},M=yield e.get({cache_mode:"allow",cache_cursor:t==null?void 0:t.cursor});if(M.context().acebase_origin!=="cache"&&u.emit("cursor",(r=e.cursor)!=null?r:null),o=!0,i=M.val(),i===null&&typeof(t==null?void 0:t.defaultValue)!="undefined"){i=t.defaultValue;const p={acebase_proxy:{id:c,source:"default"}};yield e.context(p).set(i)}a=fb({root:{ref:e,get cache(){return i}},target:[],id:c,flag:D});const U=()=>{if(a===null)throw new Error("Proxy was destroyed")},O=()=>K(this,null,function*(){U(),g.splice(0);const p=yield e.get({allow_cache:!1}),v=i,m=p.val();i=m;const w=lb(v,m);if(w.length===0)return;const E=p.context();E.acebase_proxy={id:c,source:"reload"},w.forEach(k=>{const x=Yu(e,k.target),$=new it(x,k.val,k.val===null,k.prev,E);u.emit("mutation",{snapshot:$,isRemote:!0})});const b=new Aa(e,w,E);j.emit("mutations",{origin:"local",snap:b})});return{destroy(){return K(this,null,function*(){yield f;const p=[d.stop(),...l.map(v=>v.stop())];yield Promise.all(p),["cursor","mutation","error"].forEach(v=>u.off(v)),i=null,a=null})},stop(){this.destroy()},get value(){return U(),a},get hasValue(){return U(),i!==null},set value(p){U(),p!==null&&typeof p=="object"&&p[Ei]&&(p=p.valueOf()),H([]),i=p},get ref(){return e},get cursor(){return s},reload:O,onMutation(p){U(),u.off("mutation"),u.on("mutation",({snapshot:v,isRemote:m})=>{try{p(v,m)}catch(w){u.emit("error",{source:"mutation_callback",message:"Error in dataproxy onMutation callback",details:w})}})},onError(p){U(),u.off("error"),u.on("error",v=>{try{p(v)}catch(m){console.error(`Error in dataproxy onError callback: ${m.message}`)}})},on(p,v){u.on(p,v)},off(p,v){u.off(p,v)}}})}}function _n(n,e){let t=n;for(const r of e)t=typeof t=="object"&&t!==null&&r in t?t[r]:null;return t}function Ll(n,e,t){if(e.length===0)throw new Error("Cannot update root target, caller must do that itself!");const r=e.slice(0,-1).reduce((o,s)=>o[s],n),i=e.slice(-1)[0];t===null||typeof t=="undefined"?r instanceof Array?r.splice(i,1):delete r[i]:r[i]=t}function Yu(n,e){const t=Y.get(n.path).childPath(e);return new Yn(n.db,t)}function fb(n){const e=Yu(n.root.ref,n.target),t=[],r={get(o,s,a){if(o=_n(n.root.cache,n.target),typeof s=="symbol")if(s.toString()===Symbol.iterator.toString())s="values";else return s.toString()===Ei.toString()?!0:Reflect.get(o,s,a);if(s==="valueOf")return function(){return o};if(o===null||typeof o!="object")throw new Error(`Cannot read property "${s}" of ${o}. Value of path "/${e.path}" is not an object (anymore)`);o instanceof Array&&typeof s=="string"&&/^[0-9]+$/.test(s)&&(s=parseInt(s));const c=o[s];if(c===null){delete o[s];return}const l=t.find(d=>d.prop===s);if(l){if(l.typeof===typeof c)return l.value;t.splice(t.indexOf(l),1)}const u=d=>{const f=o[d],g=t.find(A=>A.prop===d);if(g){if(g.typeof===typeof f)return g.value;t.splice(t.indexOf(g),1)}if(typeof f!="object")return f;const _=fb({root:n.root,target:n.target.concat(d),id:n.id,flag:n.flag});return t.push({typeof:typeof f,prop:d,value:_}),_},h=d=>d!==null&&typeof d=="object"&&d[Ei]?d.getTarget():d;if(["string","number","boolean"].includes(typeof c)||c instanceof Date||c instanceof ot||c instanceof ArrayBuffer||typeof c=="object"&&"buffer"in c)return c;const y=o instanceof Array;if(s==="toString")return function(){return`[LiveDataProxy for "${e.path}"]`};if(typeof c=="undefined")return s==="push"?function(d){const f=e.push();return n.flag("write",n.target.concat(f.key)),o[f.key]=d,f.key}:s==="getTarget"?function(d=!0){return d&&console.warn("Use getTarget with caution - any changes will not be synchronized!"),o}:s==="getRef"?function(){return Yu(n.root.ref,n.target)}:s==="forEach"?function(d){const f=Object.keys(o);let g=!1;for(let _=0;!g&&_<f.length;_++){const A=f[_],P=u(A);g=d(P,A,_)===!1}}:["values","entries","keys"].includes(s)?function*(){const d=Object.keys(o);for(const f of d)if(s==="keys")yield f;else{const g=u(f);s==="entries"?yield[f,g]:yield g}}:s==="toArray"?function(d){const f=Object.keys(o).map(g=>u(g));return d&&f.sort(d),f}:s==="onChanged"?function(d){return n.flag("onChange",n.target,{callback:d})}:s==="subscribe"?function(){return n.flag("subscribe",n.target)}:s==="getObservable"?function(){return n.flag("observe",n.target)}:s==="getOrderedCollection"?function(d,f){return new hP(this,d,f)}:s==="startTransaction"?function(){return n.flag("transaction",n.target)}:s==="remove"&&!y?function(){if(n.target.length===0)throw new Error("Can't remove proxy root value");const d=_n(n.root.cache,n.target.slice(0,-1)),f=n.target.slice(-1)[0];n.flag("write",n.target),delete d[f]}:void 0;if(typeof c=="function"){if(y){const d=g=>(n.flag("write",n.target),g()),f=g=>g.map(_=>(_=h(_),Gu(_),_));if(s==="push")return function(...g){return g=f(g),d(()=>o.push(...g))};if(s==="pop")return function(){return d(()=>o.pop())};if(s==="splice")return function(g,_,...A){return A=f(A),d(()=>o.splice(g,_,...A))};if(s==="shift")return function(){return d(()=>o.shift())};if(s==="unshift")return function(...g){return g=f(g),d(()=>o.unshift(...g))};if(s==="sort")return function(g){return d(()=>o.sort(g))};if(s==="reverse")return function(){return d(()=>o.reverse())};if(["indexOf","lastIndexOf"].includes(s))return function(g,_){return g!==null&&typeof g=="object"&&g[Ei]&&(g=g.getTarget(!1)),o[s](g,_)};if(["forEach","every","some","filter","map"].includes(s))return function(g){return o[s]((_,A)=>g(u(A),A,i))};if(["reduce","reduceRight"].includes(s))return function(g,_){return o[s]((A,P,B)=>g(A,u(B),B,i),_)};if(["find","findIndex"].includes(s))return function(g){let _=o[s]((A,P)=>g(u(P),P,i));if(s==="find"&&_){const A=o.indexOf(_);_=u(A)}return _};if(["values","entries","keys"].includes(s))return function*(){for(let g=0;g<o.length;g++)if(s==="keys")yield g;else{const _=u(g);s==="entries"?yield[g,_]:yield _}}}return c}return u(s)},set(o,s,a,c){if(o=_n(n.root.cache,n.target),typeof s=="symbol")return Reflect.set(o,s,a,c);if(o===null||typeof o!="object")throw new Error(`Cannot set property "${s}" of ${o}. Value of path "/${e.path}" is not an object`);if(o instanceof Array&&typeof s=="string"){if(!/^[0-9]+$/.test(s))throw new Error(`Cannot set property "${s}" on array value of path "/${e.path}"`);s=parseInt(s)}return a!==null&&(typeof a=="object"&&(a[Ei]&&(a=a.valueOf()),a=Wn(a)),tc(a,o[s]))||(n.target.some(l=>typeof l=="number")?n.flag("write",n.target.slice(0,n.target.findIndex(l=>typeof l=="number"))):o instanceof Array?n.flag("write",n.target):n.flag("write",n.target.concat(s)),a===null?delete o[s]:(Gu(a),o[s]=a)),!0},deleteProperty(o,s){if(o=_n(n.root.cache,n.target),o===null)throw new Error(`Cannot delete property ${s.toString()} of null`);return typeof s=="symbol"?Reflect.deleteProperty(o,s):(s in o&&(n.flag("write",n.target.concat(s)),delete o[s]),!0)},ownKeys(o){return o=_n(n.root.cache,n.target),Reflect.ownKeys(o)},has(o,s){return o=_n(n.root.cache,n.target),Reflect.has(o,s)},getOwnPropertyDescriptor(o,s){o=_n(n.root.cache,n.target);const a=Reflect.getOwnPropertyDescriptor(o,s);return a&&(a.configurable=!0),a},getPrototypeOf(o){return o=_n(n.root.cache,n.target),Reflect.getPrototypeOf(o)}},i=new Proxy({},r);return i}function Gu(n){typeof n=="object"&&Object.keys(n).forEach(e=>{const t=n[e];t===null||typeof t=="undefined"?delete n[e]:typeof t=="object"&&Gu(t)})}function Sa(n){if(typeof n!="object"||!n[Ei])throw new Error("Given value is not proxied. Make sure you are referencing the value through the live data proxy.");return n}class hP{constructor(e,t="order",r=10){if(this.collection=e,this.orderProperty=t,this.orderIncrement=r,typeof e!="object"||!e[Ei])throw new Error("Collection is not proxied");if(e.valueOf()instanceof Array)throw new Error("Collection is an array, not an object collection");if(!Object.keys(e).every(i=>typeof e[i]=="object"))throw new Error("Collection has non-object children");if(!Object.keys(e).every(i=>typeof e[i][t]=="number")){const i=Object.keys(e);for(let o=0;o<i.length;o++){const s=e[i[o]];s[t]=o*r}}}getObservable(){return Sa(this.collection).getObservable()}getArrayObservable(){const e=Td();return new e(t=>{const r=this.getObservable().subscribe(()=>{const i=this.getArray();t.next(i)});return function(){r.unsubscribe()}})}getArray(){return Sa(this.collection).toArray((e,t)=>e[this.orderProperty]-t[this.orderProperty])}add(e,t,r){const i=this.getArray();let o=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;for(let c=0;c<i.length;c++){const l=i[c][this.orderProperty];o=Math.min(l,o),s=Math.max(l,s)}let a;if(typeof r=="number"){if(a=Object.keys(this.collection).find(c=>this.collection[c]===e),!a)throw new Error("item not found in collection");if(r===t)return{key:a,index:t};if(Math.abs(r-t)===1){const c=i[t],l=c[this.orderProperty];return c[this.orderProperty]=e[this.orderProperty],e[this.orderProperty]=l,{key:a,index:t}}else i.splice(r,1)}if(typeof t!="number"||t>=i.length)t=i.length,e[this.orderProperty]=i.length==0?0:s+this.orderIncrement;else if(t===0)e[this.orderProperty]=i.length==0?0:o-this.orderIncrement;else{const c=i.map(u=>u[this.orderProperty]),l=c[t]-c[t-1];if(l>1)e[this.orderProperty]=c[t]-Math.floor(l/2);else{i.splice(t,0,e);for(let u=0;u<i.length;u++)i[u][this.orderProperty]=u*this.orderIncrement}}return{key:typeof a=="string"?a:Sa(this.collection).push(e),index:t}}delete(e){const t=this.getArray()[e];if(!t)throw new Error(`Item at index ${e} not found`);const r=Object.keys(this.collection).find(i=>this.collection[i]===t);if(!r)throw new Error("Cannot find target object to delete");return this.collection[r]=null,{key:r,index:e}}move(e,t){const r=this.getArray();return this.add(r[e],t,e)}sort(e){const t=this.getArray();t.sort(e);for(let r=0;r<t.length;r++)t[r][this.orderProperty]=r*this.orderIncrement}}class pb{constructor(e){if(e||(e={}),typeof e.include!="undefined"&&!(e.include instanceof Array))throw new TypeError("options.include must be an array");if(typeof e.exclude!="undefined"&&!(e.exclude instanceof Array))throw new TypeError("options.exclude must be an array");if(typeof e.child_objects!="undefined"&&typeof e.child_objects!="boolean")throw new TypeError("options.child_objects must be a boolean");if(typeof e.cache_mode=="string"&&!["allow","bypass","force"].includes(e.cache_mode))throw new TypeError("invalid value for options.cache_mode");this.include=e.include||void 0,this.exclude=e.exclude||void 0,this.child_objects=typeof e.child_objects=="boolean"?e.child_objects:void 0,this.cache_mode=typeof e.cache_mode=="string"?e.cache_mode:typeof e.allow_cache=="boolean"?e.allow_cache?"allow":"bypass":"allow",this.cache_cursor=typeof e.cache_cursor=="string"?e.cache_cursor:void 0}}class dP extends pb{constructor(e){if(super(e),!["undefined","boolean"].includes(typeof e.snapshots))throw new TypeError("options.snapshots must be a boolean");this.snapshots=typeof e.snapshots=="boolean"?e.snapshots:!0}}const Se=Symbol("private");class Yn{constructor(e,t,r){this.db=e,t||(t=""),t=t.replace(/^\/|\/$/g,"");const i=Y.get(t).key,o=[];this[Se]={get path(){return t},get key(){return i},get callbacks(){return o},vars:r||{},context:{},pushed:!1,cursor:null}}context(e,t=!1){const r=this[Se].context;if(typeof e=="object"){const i=e?t?r||{}:e:{};return e&&Object.keys(e).forEach(o=>{i[o]=e[o]}),this[Se].context=i,this}else{if(typeof e=="undefined")return console.warn("Use snap.context() instead of snap.ref.context() to get updating context in event callbacks"),r;throw new Error("Invalid context argument")}}get cursor(){return this[Se].cursor}set cursor(e){var t;this[Se].cursor=e,(t=this.onCursor)==null||t.call(this,e)}get path(){return this[Se].path}get key(){const e=this[Se].key;return typeof e=="number"?`[${e}]`:e}get index(){const e=this[Se].key;if(typeof e!="number")throw new Error(`"${e}" is not a number`);return e}get parent(){const e=Y.fillVariables2(this.path,this.vars),t=Y.get(e);return t.parentPath===null?null:new Yn(this.db,t.parentPath).context(this[Se].context)}get vars(){return this[Se].vars}child(e){e=typeof e=="number"?e:e.replace(/^\/|\/$/g,"");const t=Y.fillVariables2(this.path,this.vars),r=Y.getChildPath(t,e);return new Yn(this.db,r).context(this[Se].context)}set(e,t){return K(this,null,function*(){try{if(this.isWildcardPath)throw new Error(`Cannot set the value of wildcard path "/${this.path}"`);if(this.parent===null)throw new Error("Cannot set the root object. Use update, or set individual child properties");if(typeof e=="undefined")throw new TypeError(`Cannot store undefined value in "/${this.path}"`);this.db.isReady||(yield this.db.ready()),e=this.db.types.serialize(this.path,e);const{cursor:r}=yield this.db.api.set(this.path,e,{context:this[Se].context});if(this.cursor=r,typeof t=="function")try{t(null,this)}catch(i){console.error("Error in onComplete callback:",i)}}catch(r){if(typeof t=="function")try{t(r,this)}catch(i){console.error("Error in onComplete callback:",i)}else throw r}return this})}update(e,t){return K(this,null,function*(){try{if(this.isWildcardPath)throw new Error(`Cannot update the value of wildcard path "/${this.path}"`);if(this.db.isReady||(yield this.db.ready()),typeof e!="object"||e instanceof Array||e instanceof ArrayBuffer||e instanceof Date)yield this.set(e);else if(Object.keys(e).length===0)console.warn(`update called on path "/${this.path}", but there is nothing to update`);else{e=this.db.types.serialize(this.path,e);const{cursor:r}=yield this.db.api.update(this.path,e,{context:this[Se].context});this.cursor=r}if(typeof t=="function")try{t(null,this)}catch(r){console.error("Error in onComplete callback:",r)}}catch(r){if(typeof t=="function")try{t(r,this)}catch(i){console.error("Error in onComplete callback:",i)}else throw r}return this})}transaction(e){return K(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot start a transaction on wildcard path "/${this.path}"`);this.db.isReady||(yield this.db.ready());let t;const r=o=>{o=this.db.types.deserialize(this.path,o);const s=new it(this,o);let a;try{a=e(s)}catch(c){t=c;return}return a instanceof Promise?a.then(c=>this.db.types.serialize(this.path,c)).catch(c=>{t=c}):this.db.types.serialize(this.path,a)},{cursor:i}=yield this.db.api.transaction(this.path,r,{context:this[Se].context});if(this.cursor=i,t)throw t;return this})}on(e,t,r){this.path===""&&["value","child_changed"].includes(e)&&console.warn("WARNING: Listening for value and child_changed events on the root node is a bad practice. These events require loading of all data (value event), or potentially lots of data (child_changed event) each time they are fired");let i=null;const o=new KT(c=>{i=c}),s={event:e,stream:o,userCallback:typeof t=="function"&&t,ourCallback:(c,l,u,h,y)=>{if(c){this.db.debug.error(`Error getting data for event ${e} on path "${l}"`,c);return}const d=this.db.ref(l);d[Se].vars=Y.extractVariables(this.path,l);let f;if(e.startsWith("notify_"))f=d.context(y||{});else{const g={previous:this.db.types.deserialize(l,h),current:this.db.types.deserialize(l,u)};if(e==="child_removed")f=new it(d,g.previous,!0,g.previous,y);else if(e==="mutations")f=new Aa(d,g.current,y);else{const _=e==="mutated"&&g.current===null;f=new it(d,g.current,_,g.previous,y)}}i.publish(f),y!=null&&y.acebase_cursor&&(this.cursor=y.acebase_cursor)}};this[Se].callbacks.push(s);const a=()=>{typeof t=="function"&&o.subscribe(t,(y,d)=>{y||r&&r(d)});const c=typeof t=="object"?t:{newOnly:!t};typeof c.newOnly!="boolean"&&(c.newOnly=!1),this.isWildcardPath&&(c.newOnly=!0);const l=y=>{const d=this[Se].callbacks;d.splice(d.indexOf(s),1),this.db.api.unsubscribe(this.path,e,s.ourCallback),this.db.debug.error(`Subscription "${e}" on path "/${this.path}" canceled because of an error: ${y.message}`),i.cancel(y.message)},u=this.db.api.subscribe(this.path,e,s.ourCallback,{newOnly:c.newOnly,cancelCallback:l,syncFallback:c.syncFallback}),h=()=>{const y=this[Se].callbacks;return y.splice(y.indexOf(s),1),this.db.api.unsubscribe(this.path,e,s.ourCallback)};if(u instanceof Promise?u.then(()=>{i.start(h)}).catch(l):i.start(h),!c.newOnly){if(e==="value")this.get(y=>{i.publish(y)});else if(e==="child_added")this.get(y=>{const d=y.val();d===null||typeof d!="object"||Object.keys(d).forEach(f=>{const g=new it(this.child(f),d[f]);i.publish(g)})});else if(e==="notify_child_added"){let y=0;const d=()=>K(this,null,function*(){const f=yield this.db.api.reflect(this.path,"children",{limit:100,skip:y});f.list.forEach(g=>{const _=this.child(g.key);i.publish(_)}),f.more&&(y+=100,d())});d()}}};return this.db.isReady?a():this.db.ready(a),o}off(e,t){const r=this[Se].callbacks.filter(i=>(!e||i.event===e)&&(!t||i.userCallback===t));return r.length===0&&this.db.debug.warn(`Can't find event subscriptions to stop (path: "${this.path}", event: ${e||"(any)"}, callback: ${t})`),r.forEach(i=>{i.stream.stop()}),this}get(e,t){if(!this.db.isReady){const o=this.db.ready().then(()=>this.get(e,t));return typeof e!="function"&&typeof t!="function"?o:void 0}if(t=typeof e=="function"?e:typeof t=="function"?t:void 0,this.isWildcardPath){const o=new Error(`Cannot get value of wildcard path "/${this.path}". Use .query() instead`);if(typeof t=="function")throw o;return Promise.reject(o)}const r=new pb(typeof e=="object"?e:{cache_mode:"allow"}),i=this.db.api.get(this.path,r).then(o=>{var s;"context"in o&&"value"in o||(console.warn("AceBase api.get method returned an old response value. Update your acebase or acebase-client package"),o={value:o,context:{}});const a=this.db.types.deserialize(this.path,o.value),c=new it(this,a,void 0,void 0,o.context);return(s=o.context)!=null&&s.acebase_cursor&&(this.cursor=o.context.acebase_cursor),c});if(t){i.then(t).catch(o=>{console.error("Uncaught error:",o)});return}else return i}once(e,t){return e==="value"&&!this.isWildcardPath?this.get(t):new Promise(r=>{const i=o=>{this.off(e,i),r(o)};this.on(e,i)})}push(e,t){if(this.isWildcardPath){const o=new Error(`Cannot push to wildcard path "/${this.path}"`);if(typeof e=="undefined"||typeof t=="function")throw o;return Promise.reject(o)}const r=Vt.generate(),i=this.child(r);return i[Se].pushed=!0,typeof e!="undefined"?i.set(e,t).then(()=>i):i}remove(){return K(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot remove wildcard path "/${this.path}". Use query().remove instead`);if(this.parent===null)throw new Error("Cannot remove the root node");return this.set(null)})}exists(){return K(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot check wildcard path "/${this.path}" existence`);return this.db.isReady||(yield this.db.ready()),this.db.api.exists(this.path)})}get isWildcardPath(){return this.path.indexOf("*")>=0||this.path.indexOf("$")>=0}query(){return new yb(this)}count(){return K(this,null,function*(){return(yield this.reflect("info",{child_count:!0})).children.count})}reflect(e,t){return K(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot reflect on wildcard path "/${this.path}"`);return this.db.isReady||(yield this.db.ready()),this.db.api.reflect(this.path,e,t)})}export(e){return K(this,arguments,function*(t,r={format:"json",type_safe:!0}){if(this.isWildcardPath)throw new Error(`Cannot export wildcard path "/${this.path}"`);this.db.isReady||(yield this.db.ready());const i=typeof t=="function"?t:t.write.bind(t);return this.db.api.export(this.path,i,r)})}import(e){return K(this,arguments,function*(t,r={format:"json",suppress_events:!1}){if(this.isWildcardPath)throw new Error(`Cannot import to wildcard path "/${this.path}"`);return this.db.isReady||(yield this.db.ready()),this.db.api.import(this.path,t,r)})}proxy(e){const t=typeof e=="object"&&(typeof e.cursor!="undefined"||typeof e.defaultValue!="undefined");return typeof e!="undefined"&&!t&&(this.db.debug.warn("Warning: live data proxy is being initialized with a deprecated method signature. Use ref.proxy(options) instead of ref.proxy(defaultValue)"),e={defaultValue:e}),uP.create(this,e)}observe(e){if(e)throw new Error("observe does not support data retrieval options yet");if(this.isWildcardPath)throw new Error(`Cannot observe wildcard path "/${this.path}"`);const t=Td();return new t(r=>{let i,o=!1,s=this.get(e).then(c=>{o=!0,i=c.val(),r.next(i)});const a=c=>{if(!o){s=s.then(()=>a(c));return}const l=c.ref.path;if(l===this.path)return i=c.val(),r.next(i);const u=Y.getPathKeys(l).slice(Y.getPathKeys(this.path).length);let h=i;for(;u.length>1;){const f=u.shift();f in h||(h[f]=typeof u[0]=="number"?[]:{}),h=h[f]}const y=u.shift(),d=c.val();d===null?h instanceof Array&&typeof y=="number"?h.splice(y,1):delete h[y]:h[y]=d,r.next(i)};return this.on("mutated",a),()=>{this.off("mutated",a)}})}forEach(e,t){return K(this,null,function*(){let r;if(typeof e=="function"?t=e:r=e,typeof t!="function")throw new TypeError("No callback function given");const i=yield this.reflect("children",{limit:0,skip:0}),o={canceled:!1,total:i.list.length,processed:0};for(let s=0;s<i.list.length;s++){const a=i.list[s].key,c=yield this.child(a).get(r);if(o.processed++,!!c.exists()&&(yield t(c))===!1){o.canceled=!0;break}}return o})}getMutations(e){return K(this,null,function*(){const t=typeof e=="string"?e:void 0,r=e===null||typeof e=="undefined"?0:e instanceof Date?e.getTime():void 0;return this.db.api.getMutations({path:this.path,cursor:t,timestamp:r})})}getChanges(e){return K(this,null,function*(){const t=typeof e=="string"?e:void 0,r=e===null||typeof e=="undefined"?0:e instanceof Date?e.getTime():void 0;return this.db.api.getChanges({path:this.path,cursor:t,timestamp:r})})}}class yb{constructor(e){this.ref=e,this[Se]={filters:[],skip:0,take:0,order:[],events:{}}}filter(e,t,r){if((t==="in"||t==="!in")&&(!(r instanceof Array)||r.length===0))throw new Error(`${t} filter for ${e} must supply an Array compare argument containing at least 1 value`);if((t==="between"||t==="!between")&&(!(r instanceof Array)||r.length!==2))throw new Error(`${t} filter for ${e} must supply an Array compare argument containing 2 values`);if((t==="matches"||t==="!matches")&&!(r instanceof RegExp))throw new Error(`${t} filter for ${e} must supply a RegExp compare argument`);return this[Se].filters.push({key:e,op:t,compare:r}),this}where(e,t,r){return this.filter(e,t,r)}take(e){return this[Se].take=e,this}skip(e){return this[Se].skip=e,this}sort(e,t=!0){if(!["string","number"].includes(typeof e))throw"key must be a string or number";return this[Se].order.push({key:e,ascending:t}),this}order(e,t=!0){return this.sort(e,t)}get(e,t){if(!this.ref.db.isReady){const o=this.ref.db.ready().then(()=>this.get(e,t));return typeof e!="function"&&typeof t!="function"?o:void 0}t=typeof e=="function"?e:typeof t=="function"?t:void 0;const r=new dP(typeof e=="object"?e:{snapshots:!0,cache_mode:"allow"});r.allow_cache=r.cache_mode!=="bypass",r.eventHandler=o=>{if(!this[Se].events[o.name])return!1;const s=this[Se].events[o.name];if(typeof s!="object"||s.length===0)return!1;if(["add","change","remove"].includes(o.name)){const a={name:o.name,ref:new Yn(this.ref.db,o.path)};if(r.snapshots&&o.name!=="remove"){const c=i.types.deserialize(o.path,o.value);a.snapshot=new it(a.ref,c,!1)}o=a}s.forEach(a=>{var c,l;try{a(o)}catch(u){this.ref.db.debug.error(`Error executing "${o.name}" event handler of realtime query on path "${this.ref.path}": ${(l=(c=u==null?void 0:u.stack)!=null?c:u==null?void 0:u.message)!=null?l:u}`)}})},r.monitor={add:!1,change:!1,remove:!1},this[Se].events&&(this[Se].events.add&&this[Se].events.add.length>0&&(r.monitor.add=!0),this[Se].events.change&&this[Se].events.change.length>0&&(r.monitor.change=!0),this[Se].events.remove&&this[Se].events.remove.length>0&&(r.monitor.remove=!0)),this.stop();const i=this.ref.db;return i.api.query(this.ref.path,this[Se],r).catch(o=>{throw new Error(o)}).then(o=>{const{stop:s}=o;let{results:a,context:c}=o;if(this.stop=()=>K(this,null,function*(){yield s()}),"results"in o&&"context"in o||(console.warn("Query results missing context. Update your acebase and/or acebase-client packages"),a=o,c={}),r.snapshots){const l=a.map(u=>{const h=i.types.deserialize(u.path,u.val);return new it(i.ref(u.path),h,!1,void 0,c)});return Nc.from(l)}else{const l=a.map(u=>i.ref(u));return jd.from(l)}}).then(o=>(t&&t(o),o))}stop(){return K(this,null,function*(){})}getRefs(e){return this.get({snapshots:!1},e)}find(){return this.get({snapshots:!1})}count(){return K(this,null,function*(){return(yield this.find()).length})}exists(){return K(this,null,function*(){const e=this[Se].take,t=this.take(1).find();return this.take(e),(yield t).length!==0})}remove(e){return K(this,null,function*(){const t=yield this.find(),r=t.reduce((a,c)=>{const l=a[c.parent.path];return l?l.push(c):a[c.parent.path]=[c],a},{}),i=this.ref.db,o=Object.keys(r).map(a=>K(this,null,function*(){const c=t.reduce((u,h)=>(u[h.key]=null,u),{}),l=i.ref(a);try{return yield l.update(c),{ref:l,success:!0}}catch(u){return{ref:l,success:!1,error:u}}})),s=yield Promise.all(o);return e&&e(s),s})}on(e,t){return this[Se].events[e]||(this[Se].events[e]=[]),this[Se].events[e].push(t),this}off(e,t){if(typeof e=="undefined")return this[Se].events={},this;if(!this[Se].events[e])return this;if(typeof t=="undefined")return delete this[Se].events[e],this;const r=this[Se].events[e].indexOf(t);return~r?(this[Se].events[e].splice(r,1),this):this}forEach(e,t){return K(this,null,function*(){let r;if(typeof e=="function"?t=e:r=e,typeof t!="function")throw new TypeError("No callback function given");const i=yield this.find(),o={canceled:!1,total:i.length,processed:0};for(let s=0;s<i.length;s++){const a=yield i[s].get(r);if(o.processed++,!!a.exists()&&(yield t(a))===!1){o.canceled=!0;break}}return o})}}class Nc extends Array{static from(e){const t=new Nc(e.length);return e.forEach((r,i)=>t[i]=r),t}getValues(){return this.map(e=>e.val())}}class jd extends Array{static from(e){const t=new jd(e.length);return e.forEach((r,i)=>t[i]=r),t}getPaths(){return this.map(e=>e.path)}}function fP(n,e){e=e.replace(/^\/|\/$/g,"");const t=Y.getPathKeys(e),r=Object.keys(n).find(i=>{const o=Y.getPathKeys(i);return o.length!==t.length?!1:o.every((s,a)=>s==="*"||typeof s=="string"&&s[0]==="$"?!0:s===t[a])});return n[r]}function pP(n,e){const t=Y.get(e).parentPath;if(t!==null)return fP(n,t)}function yP(n,e){e=e.replace(/^\/|\/$/g,"");const t=Y.get(e).parentPath,r=t?Y.getPathKeys(t):[];return Object.keys(n).reduce((i,o)=>{const s=Y.getPathKeys(o);if(s.length<r.length)return i;let a=!0;if(r.length===0&&t!==null?a=s.length===1&&(s[0]==="*"||typeof s[0]=="string"&&s[0][0]==="$"):s.every((c,l)=>l>=r.length?!1:c==="*"||typeof c=="string"&&c[0]==="$"||c===r[l]?!0:(a=!1,!1)),a){const c=n[o];i.push({path:o,type:c})}return i},[])}function ry(n,e,t,r,i){if(r===null||typeof r!="object")return r;const o=Y.getPathKeys(t),s=yP(e,t),a=[];return s.sort((c,l)=>Y.getPathKeys(c.path).length>Y.getPathKeys(l.path).length?-1:1),s.forEach(c=>{const l=Y.getPathKeys(c.path);l.push("*");const u=l.slice(o.length);if(u.length===0){const y=Y.extractVariables(c.path,t),d=new Yn(n,t,y);if(i==="serialize")r=c.type.serialize(r,d);else if(i==="deserialize"){const f=new it(d,r);r=c.type.deserialize(f)}return}const h=(y,d,f)=>{if(r===null||typeof r!="object")return r;const g=f[0];let _=[];if(g==="*"||typeof g=="string"&&g[0]==="$")d instanceof Array?_=d.map((A,P)=>({key:P,val:A})):_=Object.keys(d).map(A=>({key:A,val:d[A]}));else{const A=d[g];typeof A=="object"&&_.push({key:g,val:A})}_.forEach(A=>{const P=Y.getChildPath(y,A.key),B=Y.extractVariables(c.path,P),C=new Yn(n,P,B);if(f.length===1){if(i==="serialize")a.push({parent:d,key:A.key,original:d[A.key]}),d[A.key]=c.type.serialize(A.val,C);else if(i==="deserialize"){const L=new it(C,A.val);d[A.key]=c.type.deserialize(L)}}else h(P,A.val,f.slice(1))})};h(t,r,u)}),i==="serialize"&&(r=Wn(r),a.length>0&&a.forEach(c=>{c.parent[c.key]=c.original})),r}const zi=Symbol("mappings");class gb{constructor(e){this.db=e,this[zi]={}}get mappings(){return this[zi]}map(e){return pP(this[zi],e)}bind(e,t,r={}){if(typeof e!="string")throw new TypeError("path must be a string");if(typeof t!="function")throw new TypeError("constructor must be a function");if(typeof r.serializer!="undefined"){if(typeof r.serializer=="string")if(typeof t.prototype[r.serializer]=="function")r.serializer=t.prototype[r.serializer];else throw new TypeError(`${t.name}.prototype.${r.serializer} is not a function, cannot use it as serializer`);else if(typeof r.serializer!="function")throw new TypeError(`serializer for class ${t.name} must be a function, or the name of a prototype method`)}if(typeof r.creator=="undefined")typeof t.create=="function"&&(r.creator=t.create);else if(typeof r.creator=="string")if(typeof t[r.creator]=="function")r.creator=t[r.creator];else throw new TypeError(`${t.name}.${r.creator} is not a function, cannot use it as creator`);else if(typeof r.creator!="function")throw new TypeError(`creator for class ${t.name} must be a function, or the name of a static method`);e=e.replace(/^\/|\/$/g,""),this[zi][e]={db:this.db,type:t,creator:r.creator,serializer:r.serializer,deserialize(i){let o;return this.creator?o=this.creator.call(this.type,i):o=new this.type(i),o},serialize(i,o){return this.serializer?i=this.serializer.call(i,o,i):i&&typeof i.serialize=="function"&&(i=i.serialize(o,i)),i}}}serialize(e,t){return ry(this.db,this[zi],e,t,"serialize")}deserialize(e,t){return ry(this.db,this[zi],e,t,"deserialize")}}const Gs=()=>{};class mb{constructor(e="log",t=""){this.level=e,this.prefix=t,this.setLevel(e)}setLevel(e){const t=this.prefix?this.prefix+" %s":"";this.verbose=["verbose"].includes(e)?t?console.log.bind(console,t):console.log.bind(console):Gs,this.log=["verbose","log"].includes(e)?t?console.log.bind(console,t):console.log.bind(console):Gs,this.warn=["verbose","log","warn"].includes(e)?t?console.warn.bind(console,t):console.warn.bind(console):Gs,this.error=["verbose","log","warn","error"].includes(e)?t?console.error.bind(console,t):console.error.bind(console):Gs,this.write=r=>{const i=typeof Sn!="undefined"&&Sn.env&&typeof{}.RUNKIT_ENDPOINT_PATH=="string";r&&i?r.split(`
`).forEach(o=>console.log(o)):console.log(r)}}}const iy={bold:1,dim:2,italic:3,underline:4,inverse:7,hidden:8,strikethrough:94},oy={black:30,red:31,green:32,yellow:33,blue:34,magenta:35,cyan:36,white:37,grey:90,brightRed:91},sy={bgBlack:40,bgRed:41,bgGreen:42,bgYellow:43,bgBlue:44,bgMagenta:45,bgCyan:46,bgWhite:47,bgGrey:100,bgBrightRed:101},Xs={all:0,color:39,background:49,bold:22,dim:22,italic:23,underline:24,inverse:27,hidden:28,strikethrough:29};var St;(function(n){n.reset="reset",n.bold="bold",n.dim="dim",n.italic="italic",n.underline="underline",n.inverse="inverse",n.hidden="hidden",n.strikethrough="strikethrough",n.black="black",n.red="red",n.green="green",n.yellow="yellow",n.blue="blue",n.magenta="magenta",n.cyan="cyan",n.grey="grey",n.bgBlack="bgBlack",n.bgRed="bgRed",n.bgGreen="bgGreen",n.bgYellow="bgYellow",n.bgBlue="bgBlue",n.bgMagenta="bgMagenta",n.bgCyan="bgCyan",n.bgWhite="bgWhite",n.bgGrey="bgGrey"})(St||(St={}));function vb(){if(typeof Sn=="undefined"||!Sn.stdout||!Sn.env||!Sn.platform||Sn.platform==="browser")return!1;if(Sn.platform==="win32")return!0;const n=Sn.env;return n.COLORTERM?!0:n.TERM==="dumb"?!1:n.CI||n.TEAMCITY_VERSION?!!n.TRAVIS:!!(["iTerm.app","HyperTerm","Hyper","MacTerm","Apple_Terminal","vscode"].includes(n.TERM_PROGRAM)||/^xterm-256|^screen|^xterm|^vt100|color|ansi|cygwin|linux/i.test(n.TERM))}let bb=vb();function gP(n){bb=vb()&&n}function mP(n,e){if(!bb)return n;const t=[],r=[],i=a=>{a===St.reset?t.push(Xs.all):a in iy?(t.push(iy[a]),r.push(Xs[a])):a in oy?(t.push(oy[a]),r.push(Xs.color)):a in sy&&(t.push(sy[a]),r.push(Xs.background))};e instanceof Array?e.forEach(i):i(e);const o=t.map(a=>"\x1B["+a+"m").join(""),s=r.map(a=>"\x1B["+a+"m").join("");return n.split(`
`).map(a=>o+a+s).join(`
`)}String.prototype.colorize=function(n){return mP(this,n)};class wb{constructor(e){this.logLevel="log",this.logColors=!0,this.info="realtime database",this.sponsor=!1,typeof e!="object"&&(e={}),typeof e.logLevel=="string"&&(this.logLevel=e.logLevel),typeof e.logColors=="boolean"&&(this.logColors=e.logColors),typeof e.info=="string"&&(this.info=e.info),typeof e.sponsor=="boolean"&&(this.sponsor=e.sponsor)}}class vP extends co{constructor(e,t={}){super(),this._ready=!1,t=new wb(t),this.name=e,this.debug=new mb(t.logLevel,`[${e}]`),gP(t.logColors);const r=[St.magenta,St.bold],i=`     ___          ______                
    / _ \\         | ___ \\               
   / /_\\ \\ ___ ___| |_/ / __ _ ___  ___ 
   |  _  |/ __/ _ \\ ___ \\/ _\` / __|/ _ \\
   | | | | (_|  __/ |_/ / (_| \\__ \\  __/
   \\_| |_/\\___\\___\\____/ \\__,_|___/\\___|`,o=t.info?"".padStart(40-t.info.length," ")+t.info+`
`:"";t.sponsor||(this.debug.write(i.colorize(r)),o&&this.debug.write(o.colorize(St.magenta))),this.types=new gb(this),this.once("ready",()=>{this._ready=!0})}ready(e){return K(this,null,function*(){this._ready||(yield new Promise(t=>this.on("ready",t))),e==null||e()})}get isReady(){return this._ready}setObservable(e){lP(e)}ref(e){return new Yn(this,e)}get root(){return this.ref("")}query(e){const t=new Yn(this,e);return new yb(t)}get indexes(){return{get:()=>this.api.getIndexes(),create:(e,t,r)=>this.api.createIndex(e,t,r),delete:e=>K(this,null,function*(){return this.api.deleteIndex(e)})}}get schema(){return{get:e=>this.api.getSchema(e),set:(e,t,r=!1)=>this.api.setSchema(e,t,r),all:()=>this.api.getSchemas(),check:(e,t,r)=>this.api.validateSchema(e,t,r)}}}class lt extends Error{constructor(e){super(`${e} is not implemented`)}}class bP extends co{constructor(){super()}stats(e){throw new lt("stats")}subscribe(e,t,r,i){throw new lt("subscribe")}unsubscribe(e,t,r){throw new lt("unsubscribe")}update(e,t,r){throw new lt("update")}set(e,t,r){throw new lt("set")}get(e,t){throw new lt("get")}transaction(e,t,r){throw new lt("transaction")}exists(e){throw new lt("exists")}query(e,t,r){throw new lt("query")}reflect(e,t,r){throw new lt("reflect")}export(e,t,r){throw new lt("export")}import(e,t,r){throw new lt("import")}createIndex(e,t,r){throw new lt("createIndex")}getIndexes(){throw new lt("getIndexes")}deleteIndex(e){throw new lt("deleteIndex")}setSchema(e,t,r){throw new lt("setSchema")}getSchema(e){throw new lt("getSchema")}getSchemas(){throw new lt("getSchemas")}validateSchema(e,t,r){throw new lt("validateSchema")}getMutations(e){throw new lt("getMutations")}getChanges(e){throw new lt("getChanges")}}function ay(n,e,t){const r=[0,0,0,0,0];for(let i=0;i<e;i+=4){let o=((n[i]*256+n[i+1])*256+n[i+2])*256+n[i+3];if(!o)t.push("z");else{for(let s=0;s<5;r[s++]=o%85+33,o=Math.floor(o/85));t.push(String.fromCharCode(r[4],r[3],r[2],r[1],r[0]))}}}function wP(n){const e=n,t=[],r=e.length%4,i=e.length-r;if(ay(e,i,t),r){const s=new Uint8Array(4);s.set(e.slice(i),0),ay(s,4,t);let a=t.pop();a=="z"&&(a="!!!!!"),t.push(a.substr(0,r+1))}let o=t.join("");return o="<~"+o+"~>",o}const wr={encode:function(n){return n instanceof ArrayBuffer&&(n=new Uint8Array(n,0,n.byteLength)),wP(n)},decode:function(n){if(!n.startsWith("<~")||!n.endsWith("~>"))throw new Error("Invalid input string");n=n.substr(2,n.length-4);const e=n.length,t=[],r=[0,0,0,0,0];let i,o,s,a;for(let l=0;l<e;++l){if(n.charAt(l)=="z"){t.push(0,0,0,0);continue}for(let u=0;u<5;++u)r[u]=n.charCodeAt(l+u)-33;if(a=e-l,a<5){for(let u=a;u<4;r[++u]=0);r[a]=85}i=(((r[0]*85+r[1])*85+r[2])*85+r[3])*85+r[4],o=i&255,i>>>=8,s=i&255,i>>>=8,t.push(i>>>8,i&255,s,o);for(let u=a;u<5;++u,t.pop());l+=4}const c=new Uint8Array(t);return c.buffer.slice(c.byteOffset,c.byteOffset+c.byteLength)}},kP=n=>{if(n.map===null||typeof n.map=="undefined"){if(typeof n.val=="undefined")throw new Error("serialized value must have a val property");return n.val}const e=(t,r)=>t==="date"?new Date(r):t==="binary"?wr.decode(r):t==="reference"?new ot(r):t==="regexp"?new RegExp(r.pattern,r.flags):t==="array"?new ec(r):t==="bigint"?BigInt(r):r;return typeof n.map=="string"?e(n.map,n.val):(Object.keys(n.map).forEach(t=>{const r=n.map[t],i=Y.getPathKeys(t);let o=n,s="val",a=n.val;i.forEach(c=>{s=c,o=a,a=a[s]}),o[s]=e(r,a)}),n.val)},kb=n=>{var e;if(n===null||typeof n!="object"||n instanceof Date||n instanceof ArrayBuffer||n instanceof ot||n instanceof RegExp){const o=kb({value:n});return{map:(e=o.map)==null?void 0:e.value,val:o.val.value}}n=Wn(n);const t=(o,s,a)=>{o instanceof ec&&(s[a]="array"),Object.keys(o).forEach(c=>{const l=o[c],u=a.length===0?c:`${a}/${c}`;typeof l=="bigint"?(o[c]=l.toString(),s[u]="bigint"):l instanceof Date?(o[c]=l.toISOString(),s[u]="date"):l instanceof ArrayBuffer?(o[c]=wr.encode(l),s[u]="binary"):l instanceof ot?(o[c]=l.path,s[u]="reference"):l instanceof RegExp?(o[c]={pattern:l.source,flags:l.flags},s[u]="regexp"):typeof l=="object"&&l!==null&&t(l,s,u)})},r={};t(n,r,"");const i={val:n};return Object.keys(r).length>0&&(i.map=r),i},cy=n=>n>0?Date.now()+n*1e3:1/0;class xP{get size(){return this.cache.size}constructor(e){var t;if(this.enabled=!0,typeof e=="number"&&(e={expirySeconds:e}),e.cloneValues=e.cloneValues!==!1,typeof e.expirySeconds!="number"&&typeof e.maxEntries!="number")throw new Error("Either expirySeconds or maxEntries must be specified");this.options=e,this.cache=new Map;const r=setInterval(()=>{this.cleanUp()},60*1e3);(t=r.unref)==null||t.call(r)}has(e){return this.enabled?this.cache.has(e):!1}get(e){if(!this.enabled)return null;const t=this.cache.get(e);return t?(t.expires=cy(this.options.expirySeconds),t.accessed=Date.now(),this.options.cloneValues?Wn(t.value):t.value):null}set(e,t){if(this.options.maxEntries>0&&this.cache.size>=this.options.maxEntries&&!this.cache.has(e)){let r=null;const i=Date.now();for(const[o,s]of this.cache.entries()){if(s.expires<=i){this.cache.delete(o),r=null;break}(!r||s.accessed<r.accessed)&&(r={key:o,accessed:s.accessed})}r!==null&&this.cache.delete(r.key)}this.cache.set(e,{value:this.options.cloneValues?Wn(t):t,added:Date.now(),accessed:Date.now(),expires:cy(this.options.expirySeconds)})}remove(e){this.cache.delete(e)}cleanUp(){const e=Date.now();this.cache.forEach((t,r)=>{t.expires<=e&&this.cache.delete(r)})}}function EP(n){let e=0;function t(){let a;for(;a=n[e],[" ","\r",`
`,"	"].includes(a);)e++}function r(a){if(n[e]!==a)throw new Error(`Unexpected character at position ${e}. Expected: '${a}', found '${n[e]}'`);e++}function i(){t();const a={name:"",optional:!1,wildcard:!1};let c;for(;c=n[e],c==="_"||c==="$"||c>="a"&&c<="z"||c>="A"&&c<="Z"||a.name.length>0&&c>="0"&&c<="9"||a.name.length===0&&c==="*";)a.name+=c,e++;if(a.name.length===0)throw new Error(`Property name expected at position ${e}, found: ${n.slice(e,e+10)}..`);return n[e]==="?"&&(a.optional=!0,e++),(a.name==="*"||a.name[0]==="$")&&(a.optional=!0,a.wildcard=!0),t(),r(":"),a}function o(){t();let a={typeOf:"any"},c,l="";for(;c=n[e],c>="a"&&c<="z"||c>="A"&&c<="Z";)l+=c,e++;if(l.length===0)if(n[e]==="*")r("*"),a.typeOf="any";else if(["'",'"',"`"].includes(n[e])){a.typeOf="string",a.value="";const u=n[e];for(r(u);c=n[e],c&&c!==u;)a.value+=c,e++;r(u)}else if(n[e]>="0"&&n[e]<="9"){a.typeOf="number";let u="";for(;c=n[e],c==="."||c==="n"||c>="0"&&c<="9";)u+=c,e++;u.endsWith("n")?a.value=BigInt(u):u.includes(".")?a.value=parseFloat(u):a.value=parseInt(u)}else if(n[e]==="{"){for(r("{"),a.typeOf="object",a.instanceOf=Object,a.children=[];;){const u=i(),h=s();if(a.children.push({name:u.name,optional:u.optional,wildcard:u.wildcard,types:h}),t(),(n[e]===";"||n[e]===",")&&(r(n[e]),t()),n[e]==="}")break}r("}")}else if(n[e]==="/"){r("/");let u="",h="";for(;c=n[e],c!=="/"||u.endsWith("\\");)u+=c,e++;for(r("/");c=n[e],["g","i","m","s","u","y","d"].includes(c);)h+=c,e++;a.typeOf="string",a.matches=new RegExp(u,h)}else throw new Error(`Expected a type definition at position ${e}, found character '${n[e]}'`);else if(["string","number","boolean","bigint","undefined","String","Number","Boolean","BigInt"].includes(l))a.typeOf=l.toLowerCase();else if(l==="Object"||l==="object")a.typeOf="object",a.instanceOf=Object;else if(l==="Date")a.typeOf="object",a.instanceOf=Date;else if(l==="Binary"||l==="binary")a.typeOf="object",a.instanceOf=ArrayBuffer;else if(l==="any")a.typeOf="any";else if(l==="null")a.typeOf="object",a.value=null;else if(l==="Array")r("<"),a.typeOf="object",a.instanceOf=Array,a.genericTypes=s(),r(">");else if(["true","false"].includes(l))a.typeOf="boolean",a.value=l==="true";else throw new Error(`Unknown type at position ${e}: "${a}"`);for(t();n[e]==="[";)r("["),r("]"),a={typeOf:"object",instanceOf:Array,genericTypes:[a]};return a}function s(){t();const a=[o()];for(;n[e]==="|";)r("|"),a.push(o()),t();return a}return o()}function _P(n,e,t,r){const i=e.find(h=>h.name==="*"||h.name[0]==="$")?[]:Object.keys(t).filter(h=>![null,void 0].includes(t[h])&&!e.find(y=>y.name===h));if(i.length>0)return{ok:!1,reason:`Object at path "${n}" cannot have propert${i.length===1?"y":"ies"} ${i.map(h=>`"${h}"`).join(", ")}`};function o(h){const y=![null,void 0].includes(t[h.name]);return!h.optional&&(r?t[h.name]===null:!y)?{ok:!1,reason:`Property at path "${n}/${h.name}" is not optional`}:y&&h.types.length===1?rs(`${n}/${h.name}`,h.types[0],t[h.name],!1):y&&!h.types.some(d=>rs(`${n}/${h.name}`,d,t[h.name],!1).ok)?{ok:!1,reason:`Property at path "${n}/${h.name}" does not match any of ${h.types.length} allowed types`}:{ok:!0}}const s=e.filter(h=>!h.wildcard),a=s.find(h=>!o(h).ok);if(a)return{ok:!1,reason:o(a).reason};const c=e.find(h=>h.wildcard);if(!c)return{ok:!0};const l=Object.keys(t).filter(h=>!s.find(y=>y.name===h));let u={ok:!0};for(let h=0;h<l.length&&u.ok;h++){const y=l[h];u=o({name:y,types:c.types,optional:!0,wildcard:!0})}return u}function rs(n,e,t,r,i){const o={ok:!0};if(e.typeOf==="any")return o;if(i instanceof Array&&i.length>0){if(e.typeOf!=="object")return{ok:!1,reason:`path "${n}" must be typeof ${e.typeOf}`};if(!e.children)return o;const s=i[0];let a=e.children.find(l=>l.name===s);if(a||(a=e.children.find(l=>l.name==="*"||l.name[0]==="$")),!a)return{ok:!1,reason:`Object at path "${n}" cannot have property "${s}"`};if(a.optional&&t===null&&i.length===1)return o;let c;return a.types.some(l=>{const u=typeof s=="number"?`${n}[${s}]`:`${n}/${s}`;return c=rs(u,l,t,r,i.slice(1)),c.ok}),c}return t===null?o:e.instanceOf===Object&&(typeof t!="object"||t instanceof Array||t instanceof Date)?{ok:!1,reason:`path "${n}" must be an object collection`}:e.instanceOf&&(typeof t!="object"||t.constructor!==e.instanceOf)?{ok:!1,reason:`path "${n}" must be an instance of ${e.instanceOf.name}`}:"value"in e&&t!==e.value?{ok:!1,reason:`path "${n}" must be value: ${e.value}`}:typeof t!==e.typeOf?{ok:!1,reason:`path "${n}" must be typeof ${e.typeOf}`}:e.instanceOf===Array&&e.genericTypes&&!t.every(s=>e.genericTypes.some(a=>rs(n,a,s,!1).ok))?{ok:!1,reason:`every array value of path "${n}" must match one of the specified types`}:e.typeOf==="object"&&e.children?_P(n,e.children,t,r):e.matches&&!e.matches.test(t)?{ok:!1,reason:`path "${n}" must match regular expression /${e.matches.source}/${e.matches.flags}`}:o}function $P(n){switch(n){case String:return"string";case Number:return"number";case Boolean:return"boolean";case Date:return"Date";case BigInt:return"bigint";case Array:throw new Error("Schema error: Array cannot be used without a type. Use string[] or Array<string> instead");default:throw new Error(`Schema error: unknown type used: ${n.name}`)}}class OP{constructor(e,t={warnOnly:!1}){if(this.handling=t,this.source=e,typeof e=="object"){const r=i=>"{"+Object.keys(i).map(o=>{let s=i[o];if(s===void 0)s="undefined";else if(s instanceof RegExp)s=`/${s.source}/${s.flags}`;else if(typeof s=="object")s=r(s);else if(typeof s=="function")s=$P(s);else if(!["string","number","boolean","bigint"].includes(typeof s))throw new Error(`Type definition for key "${o}" must be a string, number, boolean, bigint, object, regular expression, or one of these classes: String, Number, Boolean, Date, BigInt`);return`${o}:${s}`}).join(",")+"}";this.text=r(e)}else if(typeof e=="string")this.text=e;else throw new Error("Type definiton must be a string or an object");this.type=EP(this.text)}check(e,t,r,i){const o=rs(e,this.type,t,r,i);return!o.ok&&this.handling.warnOnly&&(o.warning=`${r?"Partial schema":"Schema"} check on path "${e}"${i?` for child "${i.join("/")}"`:""} failed: ${o.reason}`,o.ok=!0,this.handling.warnCallback(o.warning)),o}}class rn{constructor(e="browser"){throw new Error(`This feature is not supported in ${e} context`)}}class Dl extends rn{}class Xu extends rn{}class ly extends rn{}class AP extends rn{}class uy extends rn{}class SP extends rn{}const TP={OBJECT:1,ARRAY:2,NUMBER:3,BOOLEAN:4,STRING:5,BIGINT:7,DATETIME:6,BINARY:8,REFERENCE:9},ce=TP;function PP(n){switch(n){case ce.ARRAY:return"array";case ce.BINARY:return"binary";case ce.BOOLEAN:return"boolean";case ce.DATETIME:return"date";case ce.NUMBER:return"number";case ce.OBJECT:return"object";case ce.REFERENCE:return"reference";case ce.STRING:return"string";case ce.BIGINT:return"bigint"}}class xb{constructor(e){if(this.path=e.path,this.type=e.type,this.index=e.index,this.key=e.key,this.exists=e.exists,this.address=e.address,this.value=e.value,this.childCount=e.childCount,typeof this.path=="string"&&typeof this.key=="undefined"&&typeof this.index=="undefined"){const t=Y.get(this.path);typeof t.key=="number"?this.index=t.key:this.key=t.key}typeof this.exists=="undefined"&&(this.exists=!0)}get valueType(){return this.type}get valueTypeName(){return PP(this.valueType)}toString(){return this.exists?this.address?`"${this.path}" is ${this.valueTypeName} stored at ${this.address.toString()}`:`"${this.path}" is ${this.valueTypeName} with value ${this.value}`:`"${this.path}" doesn't exist`}}function Zt(n,e){if(!n)throw new Error(`Assertion failed: ${e!=null?e:"check your code"}`)}const jP=120,Qt={PENDING:"pending",LOCKED:"locked",EXPIRED:"expired",DONE:"done"};class Eb{constructor(e,t=jP){this._locks=[],this._lastTid=0,this.debug=e,this.timeout=t*1e3}setTimeout(e){this.timeout=e*1e3}createTid(){return Vt.generate()}_allowLock(e,t,r){const i=this._locks.find(o=>o.tid!==t&&o.state===Qt.LOCKED&&(r||o.forWriting));return{allow:!i,conflict:i}}quit(){return new Promise(e=>{if(this._locks.length===0)return e();this._quit=e})}_rejectLock(e,t){this._locks.splice(this._locks.indexOf(e),1),clearTimeout(e.timeout);try{e.reject(t)}catch(r){console.error("Unhandled promise rejection:",r)}}_processLockQueue(){if(this._quit){const e=new Error("Quitting");this._locks.filter(t=>t.state===Qt.PENDING).forEach(t=>this._rejectLock(t,e)),this._locks.length===0&&this._quit()}this._locks.filter(e=>e.state===Qt.PENDING).sort((e,t)=>e.priority&&!t.priority?-1:!e.priority&&t.priority?1:e.requested-t.requested).forEach(e=>{const t=this._allowLock(e.path,e.tid,e.forWriting);e.waitingFor=t.conflict||null,t.allow&&this.lock(e).then(e.resolve).catch(r=>this._rejectLock(e,r))})}lock(e,t){return K(this,arguments,function*(r,i,o=!0,s="",a={withPriority:!1,noTimeout:!1}){let c,l;if(r instanceof ql)c=r,l=!0;else{if(this._locks.findIndex(u=>u.tid===i&&u.state===Qt.EXPIRED)>=0)throw new Error(`lock on tid ${i} has expired, not allowed to continue`);if(this._quit&&!a.withPriority)throw new Error("Quitting");{c=new ql(this,r,i,o,a.withPriority===!0),c.comment=s,this._locks.push(c);const u=this._allowLock(r,i,o);c.waitingFor=u.conflict||null,l=u.allow}}if(l){if(c.state=Qt.LOCKED,typeof c.granted!="number"&&(c.granted=Date.now(),a.noTimeout!==!0)){c.expires=Date.now()+this.timeout;let u=0;const h=()=>{if(c.state===Qt.LOCKED){if(u++,u<=3){this.debug.warn(`${c.forWriting?"write":"read"} lock on path "/${c.path}" by tid ${c.tid} (${c.comment}) is taking a long time to complete [${u}]`),c.timeout=setTimeout(h,this.timeout/4);return}this.debug.error(`lock :: ${c.forWriting?"write":"read"} lock on path "/${c.path}" by tid ${c.tid} (${c.comment}) took too long`),c.state=Qt.EXPIRED,this._processLockQueue()}};c.timeout=setTimeout(h,this.timeout/4)}return c}else return Zt(c.state===Qt.PENDING),new Promise((u,h)=>{c.resolve=u,c.reject=h})})}unlock(e,t,r=!0){let i,o;if(e instanceof ql)i=e,o=this._locks.indexOf(i);else{const s=e;o=this._locks.findIndex(a=>a.id===s),i=this._locks[o]}if(o<0){const s=`lock on "/${i.path}" for tid ${i.tid} wasn't found; ${t}`;throw new Error(s)}return i.state=Qt.DONE,clearTimeout(i.timeout),this._locks.splice(o,1),r&&this._processLockQueue(),i}list(){return this._locks||[]}isAllowed(e,t,r){return this._allowLock(e,t,r).allow}}let RP=0;class ql{static get LOCK_STATE(){return Qt}constructor(e,t,r,i,o=!1){this.locker=e,this.path=t,this.tid=r,this.forWriting=i,this.priority=o,this.state=Qt.PENDING,this.requested=Date.now(),this.comment="",this.waitingFor=null,this.id=++RP,this.history=[]}release(e){return K(this,null,function*(){return this.history.push({action:"release",path:this.path,forWriting:this.forWriting,comment:e}),this.locker.unlock(this,e||this.comment)})}moveToParent(){return K(this,null,function*(){const e=Y.get(this.path).parentPath;if(this.locker.isAllowed(e,this.tid,this.forWriting))return this.history.push({path:this.path,forWriting:this.forWriting,action:"moving to parent"}),this.waitingFor=null,this.path=e,this;{this.locker.unlock(this,`moveLockToParent: ${this.comment}`,!1);const t=yield this.locker.lock(e,this.tid,this.forWriting,this.comment,{withPriority:!0});return t.history=this.history,t.history.push({path:this.path,forWriting:this.forWriting,action:"moving to parent through queue (priority)"}),t}})}}class Rd extends Error{}class Zu extends Error{}class IP extends Error{constructor(e){super(`Exiting: ${e}`)}}class CP extends co{get isMaster(){return this.masterPeerId===this.id}constructor(e,t,r=e.name){super(),this.storage=e,this.id=t,this.dbname=r,this.ipcType="ipc",this.ourSubscriptions=[],this.remoteSubscriptions=[],this.peers=[],this._exiting=!1,this._locks=[],this._requests=new Map,this._eventsEnabled=!0,this._nodeLocker=new Eb(e.debug,e.settings.lockTimeout),e.on("subscribe",i=>{if(e.debug.verbose(`database subscription being added on peer ${this.id}`),this.remoteSubscriptions.find(a=>a.callback===i.callback))return;const o=this.ourSubscriptions.some(a=>a.event===i.event&&a.path===i.path);if(this.ourSubscriptions.push(i),o)return;const s={type:"subscribe",from:this.id,data:{path:i.path,event:i.event}};this.sendMessage(s)}),e.on("unsubscribe",i=>{const o=this.remoteSubscriptions.find(s=>s.callback===i.callback);if(o){this.remoteSubscriptions.splice(this.remoteSubscriptions.indexOf(o),1);return}this.ourSubscriptions.filter(s=>s.path===i.path&&(!i.event||s.event===i.event)&&(!i.callback||s.callback===i.callback)).forEach(s=>{this.ourSubscriptions.splice(this.ourSubscriptions.indexOf(s),1);const a={type:"unsubscribe",from:this.id,data:{path:s.path,event:s.event}};this.sendMessage(a)})})}exit(e=0){return K(this,null,function*(){if(this._exiting)return this.once("exit");this._exiting=!0,this.storage.debug.warn(`Received ${this.isMaster?"master":"worker "+this.id} process exit request`),this._locks.length>0&&(this.storage.debug.warn(`Waiting for ${this.isMaster?"master":"worker"} ${this.id} locks to clear`),yield this.once("locks-cleared")),this.sayGoodbye(this.id),this.storage.debug.warn(`${this.isMaster?"Master":"Worker "+this.id} will now exit`),this.emitOnce("exit",e)})}sayGoodbye(e){const t={type:"bye",from:e,data:void 0};this.sendMessage(t)}addPeer(e,t=!0){if(!this._exiting&&(this.peers.find(r=>r.id===e)||this.peers.push({id:e,lastSeen:Date.now()}),t)){const r={type:"hello",from:this.id,to:e,data:void 0};this.sendMessage(r),this.ourSubscriptions.forEach(i=>{const o={type:"subscribe",from:this.id,to:e,data:{path:i.path,event:i.event}};this.sendMessage(o)})}}removePeer(e,t=!1){if(this._exiting)return;const r=this.peers.find(i=>i.id===e);if(!r){if(!t)throw new Error("We are supposed to know this peer!");return}this.peers.splice(this.peers.indexOf(r),1),this.remoteSubscriptions.filter(i=>i.for===e).forEach(i=>{this.remoteSubscriptions.splice(this.remoteSubscriptions.indexOf(i),1),this.storage.subscriptions.remove(i.path,i.event,i.callback)})}addRemoteSubscription(e,t){if(this._exiting||this.remoteSubscriptions.some(i=>i.for===e&&i.event===t.event&&i.path===t.path))return;const r=(i,o,s,a,c)=>{const l={type:"event",from:this.id,to:e,path:t.path,event:t.event,data:{path:o,val:s,previous:a,context:c}};this.sendMessage(l)};this.remoteSubscriptions.push({for:e,event:t.event,path:t.path,callback:r}),this.storage.subscriptions.add(t.path,t.event,r)}cancelRemoteSubscription(e,t){const r=this.remoteSubscriptions.find(i=>i.for===e&&i.event===t.event&&i.path===t.event);!r||this.storage.subscriptions.remove(t.path,t.event,r.callback)}handleMessage(e){return K(this,null,function*(){switch(e.type){case"hello":return this.addPeer(e.from,e.to!==this.id);case"bye":return this.removePeer(e.from,!0);case"subscribe":return this.addRemoteSubscription(e.from,e.data);case"unsubscribe":return this.cancelRemoteSubscription(e.from,e.data);case"event":{if(!this._eventsEnabled)break;const t=e,r=t.data.context||{};r.acebase_ipc={type:this.ipcType,origin:t.from},this.ourSubscriptions.filter(i=>i.event===t.event&&i.path===t.path).forEach(i=>{i.callback(null,t.data.path,t.data.val,t.data.previous,r)});break}case"lock-request":{if(!this.isMaster)throw new Error("Workers are not supposed to receive lock requests!");const t=e,r={type:"lock-result",id:t.id,from:this.id,to:t.from,ok:!0,data:void 0};try{const i=yield this.lock(t.data);r.data={id:i.id,path:i.path,tid:i.tid,write:i.forWriting,expires:i.expires,comment:i.comment}}catch(i){r.ok=!1,r.reason=i.stack||i.message||i}return this.sendMessage(r)}case"lock-result":{if(this.isMaster)throw new Error("Masters are not supposed to receive results for lock requests!");const t=e,r=this._requests.get(t.id);if(typeof r!="object")throw new Error("The request must be known to us!");t.ok?r.resolve(t.data):r.reject(new Error(t.reason));return}case"unlock-request":{if(!this.isMaster)throw new Error("Workers are not supposed to receive unlock requests!");const t=e,r={type:"unlock-result",id:t.id,from:this.id,to:t.from,ok:!0,data:{id:t.data.id}};try{yield this._locks.find(i=>{var o;return((o=i.lock)==null?void 0:o.id)===t.data.id}).lock.release()}catch(i){r.ok=!1,r.reason=i.stack||i.message||i}return this.sendMessage(r)}case"unlock-result":{if(this.isMaster)throw new Error("Masters are not supposed to receive results for unlock requests!");const t=e,r=this._requests.get(t.id);if(typeof r!="object")throw new Error("The request must be known to us!");t.ok?r.resolve(t.data):r.reject(new Error(t.reason));return}case"move-lock-request":{if(!this.isMaster)throw new Error("Workers are not supposed to receive move lock requests!");const t=e,r={type:"lock-result",id:t.id,from:this.id,to:t.from,ok:!0,data:void 0};try{let i;const o=this._locks.find(s=>{var a;return((a=s.lock)==null?void 0:a.id)===t.data.id});if(t.data.move_to==="parent")i=yield o.lock.moveToParent();else throw new Error(`Unknown lock move_to "${t.data.move_to}"`);o.lock=i,r.data={id:i.id,path:i.path,tid:i.tid,write:i.forWriting,expires:i.expires,comment:i.comment}}catch(i){r.ok=!1,r.reason=i.stack||i.message||i}return this.sendMessage(r)}case"notification":return this.emit("notification",e);case"request":return this.emit("request",e);case"result":{const t=e,r=this._requests.get(t.id);if(typeof r!="object")throw new Error("Result of unknown request received");t.ok?r.resolve(t.data):r.reject(new Error(t.reason))}}})}lock(e){return K(this,null,function*(){if(this._exiting&&!this._locks.find(r=>r.tid===e.tid&&r.granted))throw new IP("new transaction lock denied because the IPC peer is exiting");const t=r=>{this._locks.splice(this._locks.indexOf(r),1),this._locks.length===0&&this.emit("locks-cleared")};if(this.isMaster){const r={tid:e.tid,granted:!1,request:e,lock:null};this._locks.push(r);const i=yield this._nodeLocker.lock(e.path,e.tid,e.write,e.comment);r.tid=i.tid,r.granted=!0;const o=s=>({get id(){return s.id},get tid(){return s.tid},get path(){return s.path},get forWriting(){return s.forWriting},get expires(){return s.expires},get comment(){return s.comment},get state(){return s.state},release:()=>K(this,null,function*(){yield s.release(),t(r)}),moveToParent:()=>K(this,null,function*(){const a=yield s.moveToParent();return r.lock=o(a),r.lock})});return r.lock=o(i),r.lock}else{const r={tid:e.tid,granted:!1,request:e,lock:null};this._locks.push(r);const i=c=>(r.granted=!0,r.tid=c.tid,r.lock={id:c.id,tid:c.tid,path:c.path,forWriting:c.write,state:Qt.LOCKED,expires:c.expires,comment:c.comment,release:()=>K(this,null,function*(){const l={type:"unlock-request",id:Vt.generate(),from:this.id,to:this.masterPeerId,data:{id:r.lock.id}};yield this.request(l),r.lock.state=Qt.DONE,this.storage.debug.verbose(`Worker ${this.id} released lock ${r.lock.id} (tid ${r.lock.tid}, ${r.lock.comment}, "/${r.lock.path}", ${r.lock.forWriting?"write":"read"})`),t(r)}),moveToParent:()=>K(this,null,function*(){const l={type:"move-lock-request",id:Vt.generate(),from:this.id,to:this.masterPeerId,data:{id:r.lock.id,move_to:"parent"}};let u;try{u=yield this.request(l)}catch(h){throw r.lock.state=Qt.DONE,t(r),h}return r.lock=i(u),r.lock})},r.lock),o={type:"lock-request",id:Vt.generate(),from:this.id,to:this.masterPeerId,data:e};let s,a;try{s=yield this.request(o)}catch(c){a=c,s=null}if(a)throw t(r),a;return i(s)}})}request(e){return K(this,null,function*(){let t,r;const i=new Promise((o,s)=>{t=a=>{this._requests.delete(e.id),o(a)},r=a=>{this._requests.delete(e.id),s(a)}});return this._requests.set(e.id,{resolve:t,reject:r,request:e}),this.sendMessage(e),i})}sendRequest(e){const t={type:"request",from:this.id,to:this.masterPeerId,id:Vt.generate(),data:e};return this.request(t).catch(r=>{throw this.storage.debug.error(r),r})}replyRequest(e,t){const r={type:"result",id:e.id,ok:!0,from:this.id,to:e.from,data:t};this.sendMessage(r)}sendNotification(e){const t={type:"notification",from:this.id,data:e};this.sendMessage(t)}get eventsEnabled(){return this._eventsEnabled}set eventsEnabled(e){this.storage.debug.log(`ipc events ${e?"enabled":"disabled"}`),this._eventsEnabled=e}}class NP extends CP{constructor(e){if(super(e,Vt.generate()),this.masterPeerId=this.id,this.ipcType="browser.bcc",window.addEventListener("beforeunload",()=>{this.exit()}),typeof window.BroadcastChannel!="undefined")this.channel=new BroadcastChannel(`acebase:${e.name}`);else{const r=[null],i=()=>{throw new Error("Not implemented")};this.channel={name:`acebase:${e.name}`,postMessage:o=>{const s=Vt.generate(),a=`acebase:${e.name}:${this.id}:${s}`,c=JSON.stringify(kb(o));localStorage.setItem(a,c),setTimeout(()=>localStorage.removeItem(a),10)},set onmessage(o){r[0]=o},set onmessageerror(o){i()},close(){i()},addEventListener(o,s){o!=="message"&&i(),r.push(s)},removeEventListener(o,s){const a=r.indexOf(s);a>=1&&r.splice(a,1)},dispatchEvent(o){return r.forEach(s=>{try{s&&s(o)}catch(a){console.error(a)}}),!0}},window.addEventListener("storage",o=>{const[s,a,c,l]=o.key.split(":");if(s!=="acebase"||a!==e.name||c===this.id||o.newValue===null)return;const u=kP(JSON.parse(o.newValue));this.channel.dispatchEvent({data:u})})}this.channel.addEventListener("message",r=>K(this,null,function*(){const i=r.data;if(!(i.to&&i.to!==this.id)){if(e.debug.verbose("[BroadcastChannel] received: ",i),i.type==="hello"&&i.from<this.masterPeerId)this.masterPeerId=i.from,e.debug.log(`[BroadcastChannel] Tab ${this.masterPeerId} is the master.`);else if(i.type==="bye"&&i.from===this.masterPeerId){e.debug.log(`[BroadcastChannel] Master tab ${this.masterPeerId} is leaving`);const o=this.peers.map(a=>a.id).concat(this.id).filter(a=>a!==this.masterPeerId);this.masterPeerId=o.sort()[0],e.debug.log(`[BroadcastChannel] ${this.masterPeerId===this.id?"We are":`tab ${this.masterPeerId} is`} the new master. Requesting ${this._locks.length} locks (${this._locks.filter(a=>!a.granted).length} pending)`);const s=this._locks.splice(0);yield Promise.all(s.filter(a=>a.granted).map(a=>K(this,null,function*(){let c,l;a.lock.release=()=>new Promise(h=>c=h),a.lock.moveToParent=()=>new Promise(h=>l=h);const u=yield this.lock({path:a.lock.path,write:a.lock.forWriting,tid:a.lock.tid,comment:a.lock.comment});if(l){const h=yield u.moveToParent();l(h)}c&&(yield u.release(),c())}))),yield Promise.all(s.filter(a=>!a.granted).map(a=>K(this,null,function*(){yield this.lock(a.request)})))}return this.handleMessage(i)}}));const t={type:"hello",from:this.id,data:void 0};this.sendMessage(t)}sendMessage(e){this.storage.debug.verbose("[BroadcastChannel] sending: ",e),this.channel.postMessage(e)}}class Uo{static get hasFileSystem(){return!1}static get fs(){return null}}class Id extends rn{}class _b extends rn{}class BP extends rn{}class LP extends rn{}function DP(n,e,t,r){return K(this,null,function*(){if(!n.storage.indexes.supported)throw new Error("Indexes are not supported in current environment because it requires Node.js fs");const{ipc:i,debug:o,indexes:s,storage:a}=n,c=r&&r.rebuild===!0,l=r&&r.type||"normal";let u=r&&r.include||[];typeof u=="string"&&(u=[u]);const h=s.find(d=>d.path===e&&d.key===t&&d.type===l&&d.includeKeys.length===u.length&&d.includeKeys.every((f,g)=>u[g]===f));if(h&&r.config&&(h.config=r.config),h&&c!==!0)return o.log(`Index on "/${e}/*/${t}" already exists`.colorize(St.inverse)),h;if(!i.isMaster){const d=yield i.sendRequest({type:"index.create",path:e,key:t,options:r});if(d.ok)return a.indexes.add(d.fileName);throw new Error(d.reason)}yield Uo.mkdir(`${a.settings.path}/${a.name}.acebase`).catch(d=>{if(d.code!=="EEXIST")throw d});const y=h||(()=>{const{include:d,caseSensitive:f,textLocale:g,textLocaleKey:_}=r,A={include:d,caseSensitive:f,textLocale:g,textLocaleKey:_};switch(l){case"array":return new LP(a,e,t,se({},A));case"fulltext":return new _b(a,e,t,tt(se({},A),{config:r.config}));case"geo":return new BP(a,e,t,se({},A));default:return new Id(a,e,t,se({},A))}})();h||s.push(y);try{yield y.build()}catch(d){throw n.debug.error(`Index build on "/${e}/*/${t}" failed: ${d.message} (code: ${d.code})`.colorize(St.red)),h||s.splice(s.indexOf(y),1),d}return i.sendNotification({type:"index.created",fileName:y.fileName,path:e,key:t,options:r}),y})}const{compareValues:Zs,getChildValues:yi,encodeString:hy,defer:qP}=hb,Qu=["value","child_added","child_changed","child_removed","mutated","mutations"];Qu.push(...Qu.map(n=>`notify_${n}`));const UP=()=>{};class MP extends Error{constructor(e){super(`Schema validation failed: ${e}`),this.reason=e}}class Cd{constructor(e={}){this.maxInlineValueSize=50,this.removeVoidProperties=!1,this.path=".",this.lockTimeout=120,this.type="data",this.readOnly=!1,typeof e.maxInlineValueSize=="number"&&(this.maxInlineValueSize=e.maxInlineValueSize),typeof e.removeVoidProperties=="boolean"&&(this.removeVoidProperties=e.removeVoidProperties),typeof e.path=="string"&&(this.path=e.path),this.path.endsWith("/")&&(this.path=this.path.slice(0,-1)),typeof e.lockTimeout=="number"&&(this.lockTimeout=e.lockTimeout),typeof e.type=="string"&&(this.type=e.type),typeof e.readOnly=="boolean"&&(this.readOnly=e.readOnly),["object","string"].includes(typeof e.ipc)&&(this.ipc=e.ipc)}}class FP extends co{createTid(){return Vt.generate()}constructor(e,t,r){super(),this.name=e,this.settings=t,this._schemas=[],this._indexes=[],this._annoucedIndexes=new Map,this.indexes={get supported(){return Uo==null?void 0:Uo.hasFileSystem},create:(o,s,a={rebuild:!1})=>{const c={storage:this,debug:this.debug,indexes:this._indexes,ipc:this.ipc};return DP(c,o,s,a)},get:(o,s=null)=>{if(o.includes("$")){const a=Y.getPathKeys(o).map(c=>typeof c=="string"&&c.startsWith("$")?"*":c);o=new Y(a).path}return this._indexes.filter(a=>a.path===o&&(s===null||s===a.key))},getAll:(o,s={parentPaths:!0,childPaths:!0})=>{const a=Y.getPathKeys(o);return this._indexes.filter(c=>{const l=Y.getPathKeys(c.path+"/*");return s.parentPaths&&l.every((u,h)=>u==="*"||a[h]===u)&&[c.key].concat(...c.includeKeys).includes(a[l.length])?!0:l.length<a.length||!s.childPaths&&l.length!==a.length?!1:a.every((u,h)=>[u,"*"].includes(l[h]))})},list:()=>this._indexes.slice(),load:()=>K(this,null,function*(){if(this._indexes.splice(0),!Uo.hasFileSystem)return;let o=[];try{o=yield Uo.readdir(`${this.settings.path}/${this.name}.acebase`)}catch(a){a.code!=="ENOENT"&&this.debug.error(a)}const s=[];o.forEach(a=>{if(!a.endsWith(".idx"))return;const c=this.settings.type!=="data",l=/^\[[a-z]+\]-/.test(a);if(!c&&!l||c&&a.startsWith(`[${this.settings.type}]-`)){const u=this.indexes.add(a);s.push(u)}}),yield Promise.all(s)}),add:o=>K(this,null,function*(){const s=this._indexes.find(a=>a.fileName===o);if(s)return s;if(this._annoucedIndexes.has(o))return yield this._annoucedIndexes.get(o);try{const a=Id.readFromFile(this,o);this._annoucedIndexes.set(o,a);const c=yield a;return this._indexes.push(c),this._annoucedIndexes.delete(o),c}catch(a){return this.debug.error(a),null}}),delete:o=>K(this,null,function*(){const s=yield this.indexes.remove(o);yield s.delete(),this.ipc.sendNotification({type:"index.deleted",fileName:s.fileName,path:s.path,keys:s.key})}),remove:o=>K(this,null,function*(){const s=this._indexes.find(a=>a.fileName===o);if(!s)throw new Error(`Index ${o} not found`);return this._indexes.splice(this._indexes.indexOf(s),1),s}),close:()=>K(this,null,function*(){const o=this.indexes.list().map(s=>s.close().catch(a=>this.debug.error(a)));yield Promise.all(o)})},this._eventSubscriptions={},this.subscriptions={add:(o,s,a)=>{if(Qu.indexOf(s)<0)throw new TypeError(`Invalid event type "${s}"`);let c=this._eventSubscriptions[o];c||(c=this._eventSubscriptions[o]=[]),c.push({created:Date.now(),type:s,callback:a}),this.emit("subscribe",{path:o,event:s,callback:a})},remove:(o,s,a)=>{const c=this._eventSubscriptions[o];if(!c)return;const l=()=>c.findIndex(h=>(s?h.type===s:!0)&&(a?h.callback===a:!0));let u;for(;(u=l())>=0;)c.splice(u,1);this.emit("unsubscribe",{path:o,event:s,callback:a})},hasValueSubscribersForPath(o){return!!this.getValueSubscribersForPath(o)},getValueSubscribersForPath:o=>{const s=new Y(o),a=[];return Object.keys(this._eventSubscriptions).forEach(c=>{if(s.equals(c)||s.isDescendantOf(c)){const l=this._eventSubscriptions[c],u=Y.fillVariables(c,o);l.filter(h=>!h.type.startsWith("notify_")).forEach(h=>{let y=null;if(h.type==="value")y=u;else if(["mutated","mutations"].includes(h.type)&&s.isDescendantOf(u))y=o;else if(h.type==="child_changed"&&o!==u){const d=Y.getPathKeys(o.slice(u.length).replace(/^\//,""))[0];y=Y.getChildPath(u,d)}else if(["child_added","child_removed"].includes(h.type)&&s.isChildOf(u)){const d=Y.getPathKeys(o.slice(u.length).replace(/^\//,""))[0];y=Y.getChildPath(u,d)}y!==null&&!a.some(d=>d.type===h.type&&d.eventPath===u)&&a.push({type:h.type,eventPath:u,dataPath:y,subscriptionPath:c})})}}),a},getAllSubscribersForPath:o=>{const s=Y.get(o),a=[];return Object.keys(this._eventSubscriptions).forEach(c=>{if(s.isOnTrailOf(c)){const l=this._eventSubscriptions[c],u=Y.fillVariables(c,o);l.forEach(h=>{let y=null;if(h.type==="value"||h.type==="notify_value")y=u;else if(["child_changed","notify_child_changed"].includes(h.type)){const d=o===u||s.isAncestorOf(u)?"*":Y.getPathKeys(o.slice(u.length).replace(/^\//,""))[0];y=Y.getChildPath(u,d)}else if(["mutated","mutations","notify_mutated","notify_mutations"].includes(h.type))y=o;else if(["child_added","child_removed","notify_child_added","notify_child_removed"].includes(h.type)&&(s.isChildOf(u)||o===u||s.isAncestorOf(u))){const d=o===u||s.isAncestorOf(u)?"*":Y.getPathKeys(o.slice(u.length).replace(/^\//,""))[0];y=Y.getChildPath(u,d)}y!==null&&!a.some(d=>d.type===h.type&&d.eventPath===u&&d.subscriptionPath===c)&&a.push({type:h.type,eventPath:u,dataPath:y,subscriptionPath:c})})}}),a},trigger:(o,s,a,c,l,u)=>{(this._eventSubscriptions[s]||[]).filter(h=>h.type===o).forEach(h=>{h.callback(null,a,l,c,u)})}},this.debug=new mb(r.logLevel,`[${e}${typeof t.type=="string"&&t.type!=="data"?`:${t.type}`:""}]`);const i=e+(typeof t.type=="string"?`_${t.type}`:"");if(t.ipc==="socket"||t.ipc instanceof rn){const o={ipcName:i,server:t.ipc instanceof rn?t.ipc:null};this.ipc=new rn(this,o)}else if(t.ipc){if(typeof t.ipc.port!="number")throw new Error("IPC port number must be a number");if(!["master","worker"].includes(t.ipc.role))throw new Error(`IPC client role must be either "master" or "worker", not "${t.ipc.role}"`);const o=Object.assign({dbname:i},t.ipc);this.ipc=new rn(this,o)}else this.ipc=new NP(this,i);this.ipc.once("exit",o=>{this.indexes.supported&&this.indexes.close()}),this.nodeLocker={lock:(o,s,a,c)=>this.ipc.lock({path:o,tid:s,write:a,comment:c})},this._lastTid=0}close(){return K(this,null,function*(){yield this.ipc.exit()})}get path(){return`${this.settings.path}/${this.name}.acebase`}valueFitsInline(e){if(typeof e=="number"||typeof e=="boolean"||e instanceof Date)return!0;if(typeof e=="string")return e.length>this.settings.maxInlineValueSize?!1:hy(e).length<this.settings.maxInlineValueSize;if(e instanceof ot)return e.path.length>this.settings.maxInlineValueSize?!1:hy(e.path).length<this.settings.maxInlineValueSize;if(e instanceof ArrayBuffer)return e.byteLength<this.settings.maxInlineValueSize;if(e instanceof Array)return e.length===0;if(typeof e=="object")return Object.keys(e).length===0;throw new TypeError("What else is there?")}_writeNode(e,t,r){throw new Error("This method must be implemented by subclass")}getUpdateImpact(e,t){let r=e,i=!1;const o=t?[]:this.subscriptions.getAllSubscribersForPath(e),s=t?[]:this.subscriptions.getValueSubscribersForPath(e);s.length>0&&(i=!0,r=s.map(l=>({path:l.dataPath,keys:Y.getPathKeys(l.dataPath)})).sort((l,u)=>l.keys.length<u.keys.length?-1:l.keys.length>u.keys.length?1:0)[0].path,s.filter(l=>l.dataPath===r).every(l=>l.type==="mutated"||l.type.startsWith("notify_"))&&(i=!1),r=Y.fillVariables(r,e));const a=this.indexes.getAll(e,{childPaths:!0,parentPaths:!0}).map(l=>({index:l,keys:Y.getPathKeys(l.path)})).sort((l,u)=>l.keys.length<u.keys.length?-1:l.keys.length>u.keys.length?1:0).map(l=>l.index),c=[];if(a.length>0){a.sort((h,y)=>(typeof h._pathKeys=="undefined"&&(h._pathKeys=Y.getPathKeys(h.path)),typeof y._pathKeys=="undefined"&&(y._pathKeys=Y.getPathKeys(y.path)),h._pathKeys.length<y._pathKeys.length?-1:h._pathKeys.length>y._pathKeys.length?1:0));const l=a[0],u=l.path===e?e:Y.fillVariables(`${l.path}/*`,e);u.length<r.length&&(r=u,a.filter(h=>h.path===l.path).forEach(h=>{[h.key].concat(h.includeKeys).forEach(y=>!c.includes(y)&&c.push(y))}))}return{topEventPath:r,eventSubscriptions:o,valueSubscribers:s,hasValueSubscribers:i,indexes:a,keysFilter:c}}_writeNodeWithTracking(e,t){return K(this,arguments,function*(r,i,o={merge:!1,waitForIndexUpdates:!0,suppress_events:!1,context:null,impact:null}){if(o=o||{},!o.tid&&!o.transaction)throw new Error("_writeNodeWithTracking MUST be executed with a tid OR transaction!");o.merge=o.merge===!0;const s=this.validateSchema(r,i,{updates:o.merge});if(!s.ok)throw new MP(s.reason);const a=o.tid,c=o.transaction;let l=null;const u=o.impact?o.impact:this.getUpdateImpact(r,o.suppress_events),{topEventPath:h,eventSubscriptions:y,hasValueSubscribers:d,indexes:f}=u;let{keysFilter:g}=u;const _=()=>{if(typeof o._customWriteFunction=="function")return o._customWriteFunction();if(l){const O=Y.getPathKeys(r),p=Y.getPathKeys(h),v=O.slice(p.length);let m=l;for(;v.length>0&&m!==null;){const w=v.shift();m=typeof m=="object"&&w in m?m[w]:null}o.currentValue=m}return this._writeNode(r,i,o)},A=this.settings.transactions&&this.settings.transactions.log===!0;if(y.length===0&&f.length===0&&!A)return _();if(!d&&o.merge===!0&&g.length===0&&(g=Object.keys(i),h!==r)){const O=r.slice(h.length);g=g.map(p=>`${O}/${p}`)}const P=yield this.getNodeInfo(h,{transaction:c,tid:a});let B=null;if(P.exists){const O={transaction:c,tid:a};g.length>0&&(O.include=g),h===""&&typeof O.include=="undefined"&&this.debug.warn('WARNING: One or more value event listeners on the root node are causing the entire database value to be read to facilitate change tracking. Using "value", "notify_value", "child_changed" and "notify_child_changed" events on the root node are a bad practice because of the significant performance impact. Use "mutated" or "mutations" events instead'),B=(yield this.getNode(h,O)).value}l=B;const C=(yield _())||{};let L,q;if(r===h)o.merge?l===null?L=i instanceof Array?[]:{}:(L=l instanceof Array?[]:{},Object.keys(l).forEach(O=>{L[O]=l[O]})):L=i,q=L;else{const O=r.slice(h.length).replace(/^\//,""),p=Y.getPathKeys(O);for(l===null?L=typeof p[0]=="number"?[]:{}:(L=l instanceof Array?[]:{},Object.keys(l).forEach(v=>{L[v]=l[v]})),q=L;p.length>0;){const v=p.shift();if(!o.merge&&p.length===0)q[v]=i;else{const m=q[v],w=typeof v=="number"?[...m]:se({},m);q[v]=w}q=q[v]}}o.merge&&Object.keys(i).forEach(O=>{q[O]=i[O]});const H=Zs(l,L);if(H==="identical")return C.mutations=[],C;function j(O){if(O===null||typeof O!="object")return O;Object.keys(O).forEach(p=>{const v=O[p];v===null&&(delete O[p],O instanceof Array&&O.length--),typeof v=="object"&&j(v)})}j(L);const I=[];f.map(O=>({index:O,keys:Y.getPathKeys(O.path)})).sort((O,p)=>O.keys.length<p.keys.length?1:O.keys.length>p.keys.length?-1:0).forEach(({index:O})=>{const p=Y.getPathKeys(h),v=Y.getPathKeys(O.path+"/*"),m=v.slice(p.length),w=l,E=L;if(m.length===0){Zt(p.length===v.length,"check logic");const k=this.ipc.isMaster?O.handleRecordUpdate(h,w,E):this.ipc.sendRequest({type:"index.update",fileName:O.fileName,path:h,oldValue:w,newValue:E});I.push(k);return}const b=(k,x,$)=>{if(x===null&&$===null)return[];const S=Y.getPathKeys(k),T=Y.getPathKeys(O.path+"/*"),R=T.slice(S.length);if(R.length===0)return Zt(S.length===T.length,"check logic"),[{path:k,oldValue:x,newValue:$}];let N=[],z="";for(;R.length>0;){const F=R.shift();if(typeof F=="string"&&(F==="*"||F.startsWith("$"))){const ne=x===null?[]:Object.keys(x);$!==null&&Object.keys($).forEach(te=>{ne.indexOf(te)<0&&ne.push(te)}),ne.forEach(te=>{const pe=Y.getChildPath(z,te),oe=yi(te,x,$),re=Y.getChildPath(k,pe),ue=b(re,oe.oldValue,oe.newValue);N=N.concat(ue)});break}else{const ne=yi(F,x,$);if(x=ne.oldValue,$=ne.newValue,x===null&&$===null)break;z=Y.getChildPath(z,F)}}return N};b(h,w,E).forEach(k=>{const x=this.ipc.isMaster?O.handleRecordUpdate(k.path,k.oldValue,k.newValue):this.ipc.sendRequest({type:"index.update",fileName:O.fileName,path:k.path,oldValue:k.oldValue,newValue:k.newValue});I.push(x)})});const D=(O,p,v,m=[])=>{let w=!0,E=O.type;if(E.startsWith("notify_")&&(E=E.slice(7)),E==="mutated"||(E==="child_changed"&&(p===null||v===null)?w=!1:E==="value"||E==="child_changed"?w=Zs(p,v)!=="identical":E==="child_added"?w=p===null&&v!==null:E==="child_removed"&&(w=p!==null&&v===null),!w))return;const b=Y.getPathKeys(O.dataPath);m.forEach(x=>{const $=b.indexOf(x.name);Zt($>=0,`Variable "${x.name}" not found in subscription dataPath "${O.dataPath}"`),b[$]=x.value});const k=b.reduce((x,$)=>Y.getChildPath(x,$),"");this.subscriptions.trigger(O.type,O.subscriptionPath,k,p,v,o.context)},M=(O,p,v,m)=>{const w=[],E=m||Zs(p,v);return E==="identical"||(typeof E=="string"?w.push({path:O,oldValue:p,newValue:v}):(E.changed.forEach(b=>{const k=Y.getChildPath(O,b.key),x=yi(b.key,p,v),$=M(k,x.oldValue,x.newValue,b.change);w.push(...$)}),E.added.forEach(b=>{const k=Y.getChildPath(O,b);w.push({path:k,oldValue:null,newValue:v[b]})}),p instanceof Array&&v instanceof Array&&E.removed.sort((b,k)=>b<k?1:-1),E.removed.forEach(b=>{const k=Y.getChildPath(O,b);w.push({path:k,oldValue:p[b],newValue:null})}))),w};A&&this.settings.type!=="transaction"&&(C.mutations=(()=>{const O=r.slice(h.length).replace(/^\//,""),p=Y.getPathKeys(O);let v=l,m=L;for(;p.length>0;){const E=p.shift();({oldValue:v,newValue:m}=yi(E,v,m))}const w=Zs(v,m);return M(r,v,m,w).map(E=>({target:Y.getPathKeys(E.path.slice(r.length)),prev:E.oldValue,val:E.newValue}))})());const U=()=>{y.filter(O=>!["mutated","mutations","notify_mutated","notify_mutations"].includes(O.type)).map(O=>{const p=Y.getPathKeys(O.dataPath);return{sub:O,keys:p}}).sort((O,p)=>O.keys.length<p.keys.length?1:O.keys.length>p.keys.length?-1:0).forEach(({sub:O})=>{const p=(v,m,w,E=[])=>{const b=O.dataPath.slice(v.length).replace(/^\//,""),k=Y.getPathKeys(b);for(;k.length>0;){const x=k.shift();if(typeof x=="string"&&(x==="*"||x[0]==="$")){const $=m===null?[]:Object.keys(m).map(S=>m instanceof Array?parseInt(S):S);w!==null&&Object.keys(w).forEach(S=>{const T=w instanceof Array?parseInt(S):S;!$.includes(T)&&$.push(S)}),$.forEach(S=>{const T=yi(S,m,w),R=E.concat({name:x,value:S});k.length===0?D(O,T.oldValue,T.newValue,R):p(Y.getChildPath(v,x),T.oldValue,T.newValue,R)});return}else{v=Y.getChildPath(v,x);const $=yi(x,m,w);m=$.oldValue,w=$.newValue}}D(O,m,w,E)};if(O.type.startsWith("notify_")&&Y.get(O.eventPath).isAncestorOf(h)){const v=Y.get(O.eventPath).isParentOf(h);(O.type==="notify_value"||O.type==="notify_child_changed"&&(!v||!["added","removed"].includes(H))||O.type==="notify_child_removed"&&H==="removed"&&v||O.type==="notify_child_added"&&H==="added"&&v)&&this.subscriptions.trigger(O.type,O.subscriptionPath,O.dataPath,null,null,o.context)}else p(h,l,L)}),y.filter(O=>["mutated","mutations","notify_mutated","notify_mutations"].includes(O.type)).forEach(O=>{let p=h;const v=O.eventPath.slice(p.length).replace(/^\//,""),m=Y.getPathKeys(v);let w=l,E=L;for(;m.length>0;){const x=m.shift();p=Y.getChildPath(p,x);const $=yi(x,w,E);w=$.oldValue,E=$.newValue}const b=M(p,w,E);if(b.length===0)return;const k=O.type.startsWith("notify_");if(["mutated","notify_mutated"].includes(O.type))b.forEach((x,$)=>{const S=o.context,T=k?null:x.oldValue,R=k?null:x.newValue;this.subscriptions.trigger(O.type,O.subscriptionPath,x.path,T,R,S)});else if(["mutations","notify_mutations"].includes(O.type)){const x=k?null:b.map($=>({target:Y.getPathKeys($.path.slice(O.subscriptionPath.length)),prev:$.oldValue,val:$.newValue}));this.subscriptions.trigger(O.type,O.subscriptionPath,O.subscriptionPath,null,x,o.context)}})};return o.waitForIndexUpdates===!1&&I.splice(0),yield Promise.all(I),qP(U),C})}getChildren(e,t){throw new Error("This method must be implemented by subclass")}getNodeValue(e){return K(this,arguments,function*(t,r={}){return(yield this.getNode(t,r)).value})}getNode(e,t){throw new Error("This method must be implemented by subclass")}getNodeInfo(e,t){throw new Error("This method must be implemented by subclass")}setNode(e,t,r){throw new Error("This method must be implemented by subclass")}updateNode(e,t,r){throw new Error("This method must be implemented by subclass")}transactNode(e,t){return K(this,arguments,function*(r,i,o={no_lock:!1,suppress_events:!1,context:null}){const s=o&&o.no_lock===!0,a=this.createTid(),c=s?{tid:a,release:UP}:yield this.nodeLocker.lock(r,a,!0,"transactNode");try{let l=!1;const u=()=>{l=!0};s&&this.subscriptions.add(r,"notify_value",u);const h=yield this.getNode(r,{tid:a}),y=h.revision;let d;try{d=i(h.value),d instanceof Promise&&(d=yield d.catch(f=>{this.debug.error(`Error in transaction callback: ${f.message}`)}))}catch(f){this.debug.error(`Error in transaction callback: ${f.message}`)}if(typeof d=="undefined")return;if(s&&this.subscriptions.remove(r,"notify_value",u),l)throw new Zu("Node changed");return yield this.setNode(r,d,{assert_revision:y,tid:c.tid,suppress_events:o.suppress_events,context:o.context})}catch(l){if(l instanceof Zu)return console.warn(`node value changed, running again. Error: ${l.message}`),this.transactNode(r,i,o);throw l}finally{c.release()}})}matchNode(e,t,r){return K(this,null,function*(){var i;const o=(i=r==null?void 0:r.tid)!=null?i:Vt.generate(),s=(c,l)=>K(this,null,function*(){if(l.length===0)return Promise.resolve(!0);const u=l.reduce((f,g)=>{let _=g.key;return typeof _=="string"&&_.includes("/")&&(_=_.slice(0,_.indexOf("/"))),f.indexOf(_)<0&&f.push(_),f},[]),h=u.slice();let y=!0;const d=[];try{return yield this.getChildren(c,{tid:o,keyFilter:u}).next(f=>{var g;const _=(g=f.key)!=null?g:f.index;h.includes(_)&&h.splice(h.indexOf(f.key),1);const A=l.filter(B=>B.key===_).map(B=>({op:B.op,compare:B.compare})),P=A.length>0?a(f,A):{isMatch:!0,promises:[]};if(y=P.isMatch,y){d.push(...P.promises);const B=l.filter(C=>typeof C.key=="string"&&C.key.startsWith(`${typeof _=="number"?`[${_}]`:_}/`)).map(C=>({key:C.key.slice(C.key.indexOf("/")+1),op:C.op,compare:C.compare}));if(B.length>0){const C=Y.getChildPath(c,f.key),L=s(C,B).then(q=>({isMatch:q}));d.push(L)}}if(!y||h.length===0)return!1}),y&&(y=(yield Promise.all(d)).every(f=>f.isMatch)),y?(y=h.every(f=>{const g=new xb(tt(se(se({},typeof f=="number"&&{index:f}),typeof f=="string"&&{key:f}),{exists:!1})),_=l.filter(P=>typeof P.key=="string"&&P.key.startsWith(`${typeof f=="number"?`[${f}]`:f}/`)).map(P=>({op:P.op,compare:P.compare}));if(_.length>0&&!a(g,_).isMatch)return!1;const A=l.filter(P=>P.key===f).map(P=>({op:P.op,compare:P.compare}));return A.length===0?!0:a(g,A).isMatch}),y):!1}catch(f){throw this.debug.error(`Error matching on "${c}": `,f),f}}),a=(c,l)=>{const u=[];return{isMatch:l.every(h=>{let y=!0;if(h.op==="!exists"||h.op==="=="&&(typeof h.compare=="undefined"||h.compare===null))y=!c.exists;else if(h.op==="exists"||h.op==="!="&&(typeof h.compare=="undefined"||h.compare===null))y=c.exists;else if((h.op==="contains"||h.op==="!contains")&&h.compare instanceof Array&&h.compare.length===0)y=!0;else if(!c.exists)y=!1;else if(c.address)if(c.valueType===ce.OBJECT&&["has","!has"].indexOf(h.op)>=0){const d=h.op==="has"?"exists":"!exists",f=s(c.path,[{key:h.compare,op:d}]).then(g=>({key:c.key,isMatch:g}));u.push(f),y=!0}else if(c.valueType===ce.ARRAY&&["contains","!contains"].indexOf(h.op)>=0){const d=this.getNode(c.path,{tid:o}).then(({value:f})=>{const g=h.op==="contains"?h.compare instanceof Array?h.compare.every(_=>f.includes(_)):f.includes(h.compare):h.compare instanceof Array?!h.compare.some(_=>f.includes(_)):!f.includes(h.compare);return{key:c.key,isMatch:g}});u.push(d),y=!0}else if(c.valueType===ce.STRING){const d=this.getNode(c.path,{tid:o}).then(f=>({key:c.key,isMatch:this.test(f.value,h.op,h.compare)}));u.push(d),y=!0}else y=!1;else if(c.type===ce.OBJECT&&["has","!has"].indexOf(h.op)>=0){const d=h.compare in c.value;y=d&&h.op==="has"||!d&&h.op==="!has"}else if(c.type===ce.ARRAY&&["contains","!contains"].indexOf(h.op)>=0){const d=c.value.indexOf(h.compare)>=0;y=d&&h.op==="contains"||!d&&h.op==="!contains"}else{let d=this.test(c.value,h.op,h.compare);d instanceof Promise&&(u.push(d),d=!0),y=d}return y}),promises:u}};return s(e,t)})}test(e,t,r){if(t==="<")return e<r;if(t==="<=")return e<=r;if(t==="==")return e===r;if(t==="!=")return e!==r;if(t===">")return e>r;if(t===">=")return e>=r;if(t==="in")return r.indexOf(e)>=0;if(t==="!in")return r.indexOf(e)<0;if(t==="like"||t==="!like"){const i="^"+r.replace(/[-[\]{}()+.,\\^$|#\s]/g,"\\$&").replace(/\?/g,".").replace(/\*/g,".*?")+"$",o=new RegExp(i,"i").test(e.toString());return t==="like"?o:!o}if(t==="matches")return r.test(e.toString());if(t==="!matches")return!r.test(e.toString());if(t==="between")return e>=r[0]&&e<=r[1];if(t==="!between")return e<r[0]||e>r[1];if(t==="has"||t==="!has"){const i=typeof e=="object"&&r in e;return t==="has"?i:!i}if(t==="contains"||t==="!contains"){const i=typeof e=="object"&&e instanceof Array&&e.includes(r);return t==="contains"?i:!i}return!1}exportNode(e,t){return K(this,arguments,function*(r,i,o={format:"json",type_safe:!0}){if((o==null?void 0:o.format)!=="json")throw new Error("Only json output is currently supported");const s=typeof i!="function"?i.write.bind(i):i,a=(f,g)=>{const _=A=>A.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/[\u0000-\u001f]/g,P=>`\\u${P.charCodeAt(0).toString(16).padStart(4,"0")}`);return f===ce.DATETIME?(g=`"${g.toISOString()}"`,o.type_safe&&(g=`{".type":"date",".val":${g}}`)):f===ce.STRING?g=`"${_(g)}"`:f===ce.ARRAY?g="[]":f===ce.OBJECT?g="{}":f===ce.BINARY?(g=`"${_(wr.encode(g))}"`,o.type_safe&&(g=`{".type":"binary",".val":${g}}`)):f===ce.REFERENCE?(g=`"${g.path}"`,o.type_safe&&(g=`{".type":"reference",".val":${g}}`)):f===ce.BIGINT&&(g=`"${g}"`,o.type_safe&&(g=`{".type":"bigint",".val":${g}}`)),g};let c="",l="";const u=yield this.getNodeInfo(r);if(u.exists)if(u.type===ce.OBJECT)c="{",l="}";else if(u.type===ce.ARRAY)c="[",l="]";else{const f=yield this.getNode(r),g=a(u.type,f.value);return s(g)}else return s("null");if(c){const f=s(c);f instanceof Promise&&(yield f)}let h="",y=0;const d=[];if(yield this.getChildren(r).next(f=>{f.address?d.push(f):(y++>0&&(h+=","),typeof f.key=="string"&&(h+=`"${f.key}":`),h+=a(f.type,f.value))}),h){const f=s(h);f instanceof Promise&&(yield f)}for(;d.length>0;){const f=d.shift();let g=y++>0?",":"";const _=typeof f.index=="number"?f.index:f.key;if(typeof _=="string"&&(g+=`"${_}":`),g){const A=s(g);A instanceof Promise&&(yield A)}yield this.exportNode(Y.getChildPath(r,_),s,o)}if(l){const f=s(l);f instanceof Promise&&(yield f)}})}importNode(e,t){return K(this,arguments,function*(r,i,o={format:"json",method:"set"}){const s={data:"",index:0,offset:0,queue:[],queueStartByte:0,timesFlushed:0,get processedBytes(){return this.offset+this.index}},a=(j=!1)=>K(this,null,function*(){let I=yield i(262144);if(I===null)throw s.data?new Error(`Unexpected EOF at index ${s.offset+s.data.length}`):new Error("Unable to read data from stream");typeof I=="object"&&(I=ab(I)),j?s.data+=I:(s.offset+=s.data.length,s.data=I,s.index=0)}),c=j=>K(this,null,function*(){let I="";return s.index+j>=s.data.length&&(I=s.data.slice(s.index),j-=I.length,yield a()),I+=s.data.slice(s.index,s.index+j),s.index+=j,I}),l=j=>K(this,null,function*(){if(s.index+j>s.data.length&&(yield a(!0)),s.index+j>s.data.length)throw new Error("Not enough data available from stream")}),u=j=>K(this,null,function*(){const I=yield c(j.length);if(I!==j)throw new Error(`Unexpected character "${I[0]}" at index ${s.offset+s.index}, expected "${j}"`)}),h=()=>K(this,null,function*(){const j=[" ","	","\r",`
`];for(;s.index>=s.data.length&&(yield a()),j.includes(s.data[s.index]);)s.index++}),y=j=>K(this,null,function*(){yield l(j);const I=s.index;return s.data.slice(I,I+j)}),d=()=>K(this,null,function*(){yield h();const j=yield y(1);switch(j){case'"':return"string";case"{":return"object";case"[":return"array";case"n":return"null";case"u":return"undefined";case"t":case"f":return"boolean";default:{if(j==="-"||j>="0"&&j<="9")return"number";throw new Error(`Unknown value at index ${s.offset+s.index}`)}}}),f=()=>K(this,null,function*(){yield u('"');let j="",I=s.index;for(;s.data[I]!=='"'||s.data[I-1]==="\\";)I++,I>=s.data.length&&(j+=s.data.slice(s.index),yield a(),I=0);return j+=s.data.slice(s.index,I),s.index=I+1,P(j)}),g=()=>K(this,null,function*(){throw s.data[s.index]==="t"?yield u("true"):s.data[s.index]==="f"&&(yield u("false")),new Error(`Expected true or false at index ${s.offset+s.index}`)}),_=()=>K(this,null,function*(){let j="",I=s.index;const D=["-","0","1","2","3","4","5","6","7","8","9",".","e","b","f","x","o","n"];for(;D.includes(s.data[I]);)I++,I>=s.data.length&&(j+=s.data.slice(s.index),yield a(),I=0);return j+=s.data.slice(s.index,I),s.index=I,j.endsWith("n")?BigInt(j.slice(0,-1)):j.includes(".")?parseFloat(j):parseInt(j)}),A=()=>K(this,null,function*(){yield h();const j=yield d(),I=yield(()=>{switch(j){case"string":return f();case"object":return{};case"array":return[];case"number":return _();case"null":return null;case"undefined":return;case"boolean":return g()}})();return{type:j,value:I}}),P=j=>j.replace(/\\n/g,`
`).replace(/\\"/g,'"'),B=(j,I)=>{const D=I[".type"];let M=I[".val"];switch(D){case"Date":case"date":{M=new Date(M);break}case"Buffer":case"binary":{if(M=P(M),M.startsWith("<~"))M=wr.decode(M);else throw new Error(`Import error: Unexpected encoding for value for value at path "/${j}"`);break}case"PathReference":case"reference":{M=new ot(M);break}case"bigint":{M=BigInt(M);break}default:throw new Error(`Import error: Unsupported type "${D}" for value at path "/${j}"`)}return M},C={acebase_import_id:Vt.generate()},L={suppress_events:o.suppress_events,context:C},q=j=>K(this,null,function*(){if(yield u("{"),yield h(),(yield y(1))==="}")return s.index++,this.setNode(j.path,{},L);let I=0,D={},M=!1;const U=()=>K(this,null,function*(){let p;M?Object.keys(D).length>0&&(p=this.updateNode(j.path,D,L)):(M=!0,p=this.setNode(j.path,D,L)),D={},p&&(yield p)}),O=[];for(;;){yield h();const p=yield f();yield h(),yield u(":"),yield h();const{value:v,type:m}=yield A();if(D[p]=v,I++,["object","array"].includes(m)&&(O.push(U()),m==="object"?yield q(j.child(p)):yield H(j.child(p))),yield h(),(yield y(1))==="}"){s.index++;break}yield u(",")}if(I===2&&".type"in D&&".val"in D){const p=B(j.path,D);return this.setNode(j.path,p,L)}O.push(U()),yield Promise.all(O)}),H=j=>K(this,null,function*(){if(yield u("["),yield h(),(yield y(1))==="]")return s.index++,this.setNode(j.path,[],L);let I=!1,D=[],M={};const U=()=>K(this,null,function*(){let m;I?Object.keys(M).length>0&&(m=this.updateNode(j.path,M,L),M={}):(I=!0,m=this.setNode(j.path,D,L),D=null),m&&(yield m)}),O=(m,w)=>{I?M[w]=m:D.push(m)},p=[];let v=0;for(;;){yield h();const{value:m,type:w}=yield A();if(O(m,v),["object","array"].includes(w)&&(p.push(U()),w==="object"?yield q(j.child(v)):yield H(j.child(v))),yield h(),(yield y(1))==="]"){s.index++;break}yield u(","),v++}p.push(U()),yield Promise.all(p)});return(()=>K(this,null,function*(){const{value:j,type:I}=yield A();if(["object","array"].includes(I)){const D=Y.get(r);I==="object"?yield q(D):yield H(D)}else yield this.setNode(r,j,L)}))()})}setSchema(e,t,r=!1){if(typeof t=="undefined")throw new TypeError("schema argument must be given");if(t===null){const s=this._schemas.findIndex(a=>a.path===e);s>=0&&this._schemas.splice(s,1);return}const i=new OP(t,{warnOnly:r,warnCallback:s=>this.debug.warn(s)}),o=this._schemas.find(s=>s.path===e);o?o.schema=i:(this._schemas.push({path:e,schema:i}),this._schemas.sort((s,a)=>{const c=Y.getPathKeys(s.path),l=Y.getPathKeys(a.path);return c.length===l.length?0:c.length<l.length?-1:1}))}getSchema(e){const t=this._schemas.find(r=>r.path===e);return t?{path:e,schema:t.schema.source,text:t.schema.text}:null}getSchemas(){return this._schemas.map(e=>({path:e.path,schema:e.schema.source,text:e.schema.text}))}validateSchema(e,t,r={updates:!1}){let i={ok:!0};const o=Y.get(e);return this._schemas.filter(s=>o.isOnTrailOf(s.path)).every(s=>{if(o.isDescendantOf(s.path)){const u=Y.fillVariables(s.path,e),h=o.keys.slice(Y.getPathKeys(s.path).length);return i=s.schema.check(u,t,r.updates,h),i.ok}const a=Y.getPathKeys(s.path).slice(o.keys.length);if(r.updates===!0&&a.length>0&&!(a[0]in t))return i.ok;const c=r.updates===!0&&a.length===0,l=(u,h,y)=>{if(y.length===0)return s.schema.check(u,h,c);if(h===null)return{ok:!0};const d=y[0];if(typeof d=="string"&&(d==="*"||d[0]==="$")){if(h===null||typeof h!="object")return{ok:!0};let f;return Object.keys(h).every(g=>{const _=Y.getChildPath(u,g),A=h[g];return f=l(_,A,y.slice(1)),f.ok}),f}else{const f=Y.getChildPath(u,d),g=h[d];return l(f,g,y.slice(1))}};return i=l(e,t,a),i.ok}),i}}class is{static ChildPathsSql(e,t="path"){return e===""?`${t} <> '' AND ${t} NOT LIKE '%/%'`:`(${t} LIKE '${e}/%' OR ${t} LIKE '${e}[%') AND ${t} NOT LIKE '${e}/%/%' AND ${t} NOT LIKE '${e}[%]/%' AND ${t} NOT LIKE '${e}[%][%'`}static ChildPathsRegex(e){return new RegExp(`^${e}(?:/[^/[]+|\\[[0-9]+\\])$`)}static DescendantPathsSql(e,t="path"){return e===""?`${t} <> ''`:`${t} LIKE '${e}/%' OR ${t} LIKE '${e}[%'`}static DescendantPathsRegex(e){return new RegExp(`^${e}(?:/[^/[]+|\\[[0-9]+\\])`)}static get PathInfo(){return Y}}class dy{constructor(e){this.path=e}toString(){return`"/${this.path}"`}equals(e){return this.path===e.path}}const{compareValues:VP}=hb;class Nd{constructor(e){this.production=!1,this.target={get originalPath(){return e.path},path:e.path,get write(){return e.write}},this.id=Vt.generate()}getChildCount(e){return K(this,null,function*(){let t=0;return yield this.childrenOf(e,{metadata:!1,value:!1},()=>(t++,!1)),t})}getMultiple(e){return K(this,null,function*(){const t=new Map;return yield Promise.all(e.map(r=>this.get(r).then(i=>t.set(r,i)))),t})}setMultiple(e){return K(this,null,function*(){yield Promise.all(e.map(({path:t,node:r})=>this.set(t,r)))})}removeMultiple(e){return K(this,null,function*(){yield Promise.all(e.map(t=>this.remove(t)))})}commit(){return K(this,null,function*(){throw new Error("CustomStorageTransaction.rollback must be overridden by subclass")})}moveToParentPath(e){return K(this,null,function*(){const t=this._lock&&this._lock.path||this.target.path;if(t===e)return e;if(is.PathInfo.get(e).isParentOf(t))this._lock&&(this._lock=yield this._lock.moveToParent());else throw new Error(`Locking issue. Locked path "${this._lock.path}" is not a child/descendant of "${e}"`);return this.target.path=e,e})}}class os extends Cd{constructor(e){if(super(e),this.locking=!0,typeof e!="object")throw new Error("settings missing");if(typeof e.ready!="function")throw new Error("ready must be a function");if(typeof e.getTransaction!="function")throw new Error("getTransaction must be a function");this.name=e.name,this.locking=e.locking!==!1,this.locking&&(this.lockTimeout=typeof e.lockTimeout=="number"?e.lockTimeout:120),this.ready=e.ready;const t=this.locking,r=t?new Eb(console,this.lockTimeout):null;this.getTransaction=i=>K(this,[i],function*({path:o,write:s}){const a=yield e.getTransaction({path:o,write:s});Zt(typeof a.id=="string","transaction id not set");const c=a.rollback,l=a.commit;return a.commit=()=>K(this,null,function*(){const u=yield l.call(a);return t&&(yield a._lock.release("commit")),u}),a.rollback=u=>K(this,null,function*(){const h=yield c.call(a,u);return t&&(yield a._lock.release("rollback")),h}),t&&(a._lock=yield r.lock(o,a.id,s,`${this.name}::getTransaction`)),a})}}class Ul extends xb{constructor(e){super(e),this.revision=e.revision,this.revision_nr=e.revision_nr,this.created=e.created,this.modified=e.modified}}class KP extends FP{constructor(e,t,r){super(e,t,r),this._customImplementation=t,this._init()}_init(){return K(this,null,function*(){this.debug.log(`Database "${this.name}" details:`.colorize(St.dim)),this.debug.log("- Type: CustomStorage".colorize(St.dim)),this.debug.log(`- Path: ${this.settings.path}`.colorize(St.dim)),this.debug.log(`- Max inline value size: ${this.settings.maxInlineValueSize}`.colorize(St.dim)),this.debug.log(`- Autoremove undefined props: ${this.settings.removeVoidProperties}`.colorize(St.dim)),yield this._customImplementation.ready();const e=yield this._customImplementation.getTransaction({path:"",write:!0});(yield this.getNodeInfo("",{transaction:e})).exists||(yield this._writeNode("",{},{transaction:e})),yield e.commit(),this.indexes.supported&&(yield this.indexes.load()),this.emit("ready")})}throwImplementationError(e){throw new Error(`CustomStorage "${this._customImplementation.name}" ${e}`)}_storeNode(e,t,r){const i=s=>{if(s===null)throw new Error("Not allowed to store null values. remove the property");if(["string","number","boolean"].includes(typeof s))return s;if(s instanceof Date)return{type:ce.DATETIME,value:s.getTime()};if(s instanceof ot)return{type:ce.REFERENCE,value:s.path};if(s instanceof ArrayBuffer)return{type:ce.BINARY,value:wr.encode(s)};if(typeof s=="object")return Zt(Object.keys(s).length===0,"child object stored in parent can only be empty"),s},o="Caller should have pre-processed the value by converting it to a string";if(t.type===ce.ARRAY&&t.value instanceof Array){console.warn(`Unprocessed array. ${o}`);const s={};for(let a=0;a<t.value.length;a++)s[a]=t.value[a];t.value=s}if(t.type===ce.BINARY&&typeof t.value!="string"&&(console.warn(`Unprocessed binary value. ${o}`),t.value=wr.encode(t.value)),t.type===ce.REFERENCE&&t.value instanceof ot&&(console.warn(`Unprocessed path reference. ${o}`),t.value=t.value.path),[ce.OBJECT,ce.ARRAY].includes(t.type)){const s=t.value;t.value={},Object.keys(s).forEach(a=>{t.value[a]=i(s[a])})}return r.transaction.set(e,t)}_processReadNodeValue(e){const t=r=>{if(r.type===ce.BINARY)return wr.decode(r.value);if(r.type===ce.DATETIME)return new Date(r.value);if(r.type===ce.REFERENCE)return new ot(r.value);throw new Error(`Unhandled child value type ${r.type}`)};switch(e.type){case ce.ARRAY:case ce.OBJECT:{const r=e.value;Object.keys(r).forEach(i=>{const o=r[i];typeof o=="object"&&"type"in o&&(r[i]=t(o))}),e.value=r;break}case ce.BINARY:{e.value=wr.decode(e.value);break}case ce.REFERENCE:{e.value=new ot(e.value);break}case ce.STRING:break;default:throw new Error("Invalid standalone record value type")}}_readNode(e,t){return K(this,null,function*(){const r=yield t.transaction.get(e);return r===null?null:(typeof r!="object"&&this.throwImplementationError("transaction.get must return an ICustomStorageNode object. Use JSON.parse if your set function stored it as a string"),this._processReadNodeValue(r),r)})}_getTypeFromStoredValue(e){let t;if(typeof e=="string")t=ce.STRING;else if(typeof e=="number")t=ce.NUMBER;else if(typeof e=="boolean")t=ce.BOOLEAN;else if(e instanceof Array)t=ce.ARRAY;else if(typeof e=="object")if("type"in e){const r=e;t=r.type,e=r.value,t===ce.DATETIME?e=new Date(e):t===ce.REFERENCE&&(e=new ot(e))}else t=ce.OBJECT;else throw new Error("Unknown value type");return{type:t,value:e}}_writeNode(e,t,r){return K(this,null,function*(){if(!r.merge&&this.valueFitsInline(t)&&e!=="")throw new Error("invalid value to store in its own node");if(e===""&&(typeof t!="object"||t instanceof Array))throw new Error("Invalid root node value. Must be an object");if(typeof r.diff=="undefined"&&typeof r.currentValue!="undefined"){const f=VP(r.currentValue,t);r.merge&&typeof f=="object"&&(f.removed=f.removed.filter(g=>t[g]===null)),r.diff=f}if(r.diff==="identical")return;const i=r.transaction,o=r.currentValue===null?null:yield this._readNode(e,{transaction:i});if(r.merge&&o){if(o.type===ce.ARRAY&&!(t instanceof Array)&&typeof t=="object"&&Object.keys(t).some(f=>isNaN(parseInt(f))))throw new Error(`Cannot merge existing array of path "${e}" with an object`);if(t instanceof Array&&o.type!==ce.ARRAY)throw new Error(`Cannot merge existing object of path "${e}" with an array`)}const s=r.revision||Vt.generate(),a={type:o&&o.type===ce.ARRAY?ce.ARRAY:ce.OBJECT,value:{}},c={};if(t instanceof Array){a.type=ce.ARRAY;const f={};for(let g=0;g<t.length;g++)f[g]=t[g];t=f}else t instanceof ot?(a.type=ce.REFERENCE,a.value=t.path):t instanceof ArrayBuffer?(a.type=ce.BINARY,a.value=wr.encode(t)):typeof t=="string"&&(a.type=ce.STRING,a.value=t);const l=o?[ce.OBJECT,ce.ARRAY].includes(o.type):!1,u=[ce.OBJECT,ce.ARRAY].includes(a.type),h={current:[],new:[]};let y=null;l&&(y=o.value,h.current=Object.keys(y),u&&(a.value=y)),u&&(r.merge||Object.keys(a.value).forEach(f=>{f in t||(t[f]=null)}),Object.keys(t).forEach(f=>{const g=t[f];if(delete a.value[f],g!==null){if(typeof g=="undefined")if(this.settings.removeVoidProperties===!0){delete t[f];return}else throw new Error(`Property "${f}" has invalid value. Cannot store undefined values. Set removeVoidProperties option to true to automatically remove undefined properties`);this.valueFitsInline(g)?a.value[f]=g:c[f]=g}}));const d=a.type===ce.ARRAY;if(o){if(this.debug.log(`Node "/${e}" is being ${r.merge?"updated":"overwritten"}`.colorize(St.cyan)),l||u){const g=Y.get(e),_=[];let A=!1;const P=I=>(A=!0,!i.production&&!g.isParentOf(I)&&this.throwImplementationError(`"${I}" is not a child of "${e}" - childrenOf must only check and return paths that are children`),!0),B=I=>{A||this.throwImplementationError("childrenOf did not call checkCallback before addCallback");const D=Y.get(I).key;return _.push(D.toString()),!0};yield i.childrenOf(e,{metadata:!1,value:!1},P,B),h.current=h.current.concat(_),u&&(r&&r.merge&&(h.new=h.current.slice()),Object.keys(t).forEach(I=>{h.new.includes(I)||h.new.push(I)}));const C={insert:h.new.filter(I=>!h.current.includes(I)),update:[],delete:r&&r.merge?Object.keys(t).filter(I=>t[I]===null):h.current.filter(I=>!h.new.includes(I))};if(C.update=h.new.filter(I=>h.current.includes(I)&&!C.delete.includes(I)),d&&r.merge&&(C.insert.length>0||C.delete.length>0)&&!C.update.concat(C.insert).every((I,D,M)=>M.includes(D.toString())))throw new Error(`Elements cannot be inserted beyond, or removed before the end of an array. Rewrite the whole array at path "${e}" or change your schema to use an object collection instead`);const L=Object.keys(c).map(I=>{const D=d?parseInt(I):I,M=typeof r.diff=="object"?r.diff.forChild(D):void 0;if(M==="identical")return;const U=g.childPath(D),O=c[D],p=typeof r.currentValue=="undefined"?void 0:r.currentValue!==null&&typeof r.currentValue=="object"&&D in r.currentValue?r.currentValue[D]:null;return this._writeNode(U,O,{transaction:i,revision:s,merge:!1,currentValue:p,diff:M})}),q=u?_.filter(I=>I in a.value):[],H=C.delete.concat(q).map(I=>{const D=d?parseInt(I):I,M=g.childPath(D);return this._deleteNode(M,{transaction:i})}),j=L.concat(H);yield Promise.all(j)}const f=this._storeNode(e,{type:a.type,value:a.value,revision:o.revision,revision_nr:o.revision_nr+1,created:o.created,modified:Date.now()},{transaction:i});if(f instanceof Promise)return yield f}else{if(this.debug.log(`Node "/${e}" is being created`.colorize(St.cyan)),d&&!Object.keys(a.value).concat(Object.keys(c)).every((_,A,P)=>P.includes(A.toString())))throw new Error("Cannot store arrays with missing entries");const f=Object.keys(c).map(_=>{const A=d?parseInt(_):_,P=Y.getChildPath(e,A),B=c[A];return this._writeNode(P,B,{transaction:i,revision:s,merge:!1,currentValue:null})}),g=this._storeNode(e,{type:a.type,value:a.value,revision:s,revision_nr:1,created:Date.now(),modified:Date.now()},{transaction:i});g instanceof Promise&&f.push(g),yield Promise.all(f)}})}_deleteNode(e,t){return K(this,null,function*(){const r=Y.get(e);this.debug.log(`Node "/${e}" is being deleted`.colorize(St.cyan));const i=[e];let o=!1;const s=l=>(o=!0,!c.production&&!r.isAncestorOf(l)&&this.throwImplementationError(`"${l}" is not a descendant of "${e}" - descendantsOf must only check and return paths that are descendants`),!0),a=l=>(o||this.throwImplementationError("descendantsOf did not call checkCallback before addCallback"),i.push(l),!0),c=t.transaction;return yield c.descendantsOf(e,{metadata:!1,value:!1},s,a),this.debug.log(`Nodes ${i.map(l=>`"/${l}"`).join(",")} are being deleted`.colorize(St.cyan)),c.removeMultiple(i)})}getChildren(e,t={}){let r;const i={next(s){return r=s,o()}},o=()=>K(this,null,function*(){const s=t.transaction||(yield this._customImplementation.getTransaction({path:e,write:!1}));try{let a=!1;return yield(()=>K(this,null,function*(){const c=yield this._readNode(e,{transaction:s});if(!c)throw new Rd(`Node "/${e}" does not exist`);if(![ce.OBJECT,ce.ARRAY].includes(c.type))return;const l=c.type===ce.ARRAY,u=c.value;let h=Object.keys(u).map(_=>l?parseInt(_):_);t.keyFilter&&(h=h.filter(_=>t.keyFilter.includes(_)));const y=Y.get(e);if(h.length>0&&h.every(_=>{const A=this._getTypeFromStoredValue(u[_]),P=new Ul({path:y.childPath(_),key:l?null:_,index:l?_:null,type:A.type,address:null,exists:!0,value:A.value,revision:c.revision,revision_nr:c.revision_nr,created:new Date(c.created),modified:new Date(c.modified)});return a=r(P)===!1,!a}),a)return;let d=!1;const f=_=>{if(d=!0,!s.production&&!y.isParentOf(_)&&this.throwImplementationError(`"${_}" is not a child of "${e}" - childrenOf must only check and return paths that are children`),t.keyFilter){const A=Y.get(_).key;return t.keyFilter.includes(A)}return!0},g=(_,A)=>{d||this.throwImplementationError("childrenOf did not call checkCallback before addCallback");const P=Y.get(_).key,B=new Ul({path:_,type:A.type,key:l?null:P,index:l?P:null,address:new dy(_),exists:!0,value:null,revision:A.revision,revision_nr:A.revision_nr,created:new Date(A.created),modified:new Date(A.modified)});return a=r(B)===!1,!a};yield s.childrenOf(e,{metadata:!0,value:!1},f,g)}))(),t.transaction||(yield s.commit()),a}catch(a){throw t.transaction||(yield s.rollback(a)),a}});return i}getNode(e,t){return K(this,null,function*(){t=t||{};const r=t.transaction||(yield this._customImplementation.getTransaction({path:e,write:!1}));try{const i=yield(()=>K(this,null,function*(){const o=t.include&&t.include.length>0||t.exclude&&t.exclude.length>0||t.child_objects===!1,s=Y.get(e),a=yield this._readNode(e,{transaction:r});if(!a){if(e==="")return{value:null};const B=yield r.moveToParentPath(s.parentPath);Zt(B===s.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${e}"`);const C=yield this._readNode(s.parentPath,{transaction:r});if(C&&[ce.OBJECT,ce.ARRAY].includes(C.type)&&s.key in C.value){const L=this._getTypeFromStoredValue(C.value[s.key]);return{revision:C.revision,revision_nr:C.revision_nr,created:C.created,modified:C.modified,type:L.type,value:L.value}}return{value:null}}const c=a.type===ce.ARRAY,l=B=>{const C=L=>/^[0-9]+$/.test(L);return B.map(L=>Y.get(c&&C(L)?`[${L}]`:L))},u=t.include?l(t.include):[],h=t.exclude?l(t.exclude):[],y=(B,C)=>{if([ce.OBJECT,ce.ARRAY].includes(C.type)&&u.length>0){const L=Y.getPathKeys(B).slice(s.keys.length),q=new Y(L),H=[],j=u.filter(D=>D.isDescendantOf(q));if(j.length>0){const D=C.type===ce.ARRAY;H.push(...Object.keys(C.value).map(M=>D?+M:M));for(const M of j){const U=M.keys[L.length];if(typeof U=="string"&&(U==="*"||U.startsWith("$"))){H.splice(0);break}const O=H.indexOf(U);O>=0&&H.splice(O,1)}}const I=u.some(D=>D.isChildOf(q));if(h.some(D=>D.isChildOf(q))&&!I){const D=h.filter(M=>M.isChildOf(q));for(let M=0;M<H.length;M++)D.find(U=>U.equals(H[M]))||(H.splice(M,1),M--)}for(const D of H)delete C.value[D]}};y(e,a);let d=!1;const f=(B,C)=>{if(d=!0,!r.production&&!s.isAncestorOf(B)&&this.throwImplementationError(`"${B}" is not a descendant of "${e}" - descendantsOf must only check and return paths that are descendants`),!o)return!0;const L=Y.getPathKeys(B).slice(s.keys.length),q=new Y(L);let H=(u.length>0?u.some(j=>q.isOnTrailOf(j)):!0)&&(h.length>0?!h.some(j=>j.equals(q)||j.isAncestorOf(q)):!0);return H&&t.child_objects===!1&&(s.isParentOf(B)&&[ce.OBJECT,ce.ARRAY].includes(C?C.type:-1)||Y.getPathKeys(B).length>s.pathKeys.length+1)&&(H=!1),H},g=[],_=(B,C)=>{if(d||this.throwImplementationError("descendantsOf did not call checkCallback before addCallback"),t.child_objects===!1&&[ce.OBJECT,ce.ARRAY].includes(C.type))return!0;y(B,C),this._processReadNodeValue(C);const L=C;return L.path=B,g.push(L),!0};yield r.descendantsOf(e,{metadata:!0,value:!0},f,_),this.debug.log(`Read node "/${e}" and ${o?"(filtered) ":""}descendants from ${g.length+1} records`.colorize(St.magenta));const A=a,P=B=>{const C=[];return Object.keys(B).forEach(L=>{const q=parseInt(L);C[q]=B[q]}),C};if(a.type===ce.ARRAY&&(A.value=P(A.value)),a.type===ce.OBJECT||a.type===ce.ARRAY){const B=Y.getPathKeys(e),C=a.value;for(let L=0;L<g.length;L++){const q=g[L],H=Y.getPathKeys(q.path).slice(B.length);let j=C;for(let I=0;I<H.length;I++){Zt(typeof j=="object","parent must be an object/array to have children!!");const D=H[I],M=I===H.length-1,U=M?q.type:typeof H[I+1]=="number"?ce.ARRAY:ce.OBJECT;let O;M?(O=q.value,U===ce.ARRAY&&(O=P(O))):O=U===ce.OBJECT?{}:[],D in j?typeof j[D]==typeof O&&[ce.OBJECT,ce.ARRAY].includes(U)?Object.keys(O).forEach(p=>{p in j[D]&&this.throwImplementationError(`Custom storage merge error: child key "${p}" is in parent value already! Make sure the get/childrenOf/descendantsOf methods of the custom storage class return values that can be modified by AceBase without affecting the stored source`),j[D][p]=O[p]}):this.debug.error(`The value stored in node "${q.path}" cannot be merged with the parent node, value will be ignored. This error should disappear once the target node value is updated. See issue #20 for more information`,{path:e,parent:j,key:D,nodeType:U,nodeValue:O}):j[D]=O,j=j[D]}}}else g.length>0&&this.throwImplementationError("multiple records found for non-object value!");if(t.child_objects===!1&&Object.keys(A.value).forEach(B=>{typeof A.value[B]=="object"&&A.value[B].constructor===Object&&(Zt(Object.keys(A.value[B]).length===0),delete A.value[B])}),t.include,t.exclude){const B=(C,L)=>{if(typeof C!="object")return;const q=L[0];q==="*"?Object.keys(C).forEach(H=>{B(C[H],L.slice(1))}):L.length>1?q in C&&B(C[q],L.slice(1)):delete C[q]};t.exclude.forEach(C=>{const L=Y.getPathKeys(C);B(A.value,L)})}return A}))();return t.transaction||(yield r.commit()),i}catch(i){throw t.transaction||(yield r.rollback(i)),i}})}getNodeInfo(e){return K(this,arguments,function*(t,r={}){r=r||{};const i=Y.get(t),o=r.transaction||(yield this._customImplementation.getTransaction({path:t,write:!1}));try{const s=yield this._readNode(t,{transaction:o}),a=new Ul({path:t,key:typeof i.key=="string"?i.key:null,index:typeof i.key=="number"?i.key:null,type:s?s.type:0,exists:s!==null,address:s?new dy(t):null,created:s?new Date(s.created):null,modified:s?new Date(s.modified):null,revision:s?s.revision:null,revision_nr:s?s.revision_nr:null});if(!s&&t!==""){const c=yield o.moveToParentPath(i.parentPath);Zt(c===i.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${t}"`);const l=yield this._readNode(i.parentPath,{transaction:o});l&&[ce.OBJECT,ce.ARRAY].includes(l.type)&&i.key in l.value?(a.exists=!0,a.value=l.value[i.key],a.address=null,a.type=l.type,a.created=new Date(l.created),a.modified=new Date(l.modified),a.revision=l.revision,a.revision_nr=l.revision_nr):a.address=null}return r.include_child_count&&(a.childCount=0,[ce.OBJECT,ce.ARRAY].includes(a.valueType)&&a.address&&(a.childCount=s.value?Object.keys(s.value).length:0,a.childCount+=yield o.getChildCount(t))),r.transaction||(yield o.commit()),a}catch(s){throw r.transaction||(yield o.rollback(s)),s}})}setNode(e,t){return K(this,arguments,function*(r,i,o={suppress_events:!1,context:null}){if(this.settings.readOnly)throw new Error("Database is opened in read-only mode");const s=Y.get(r),a=o.transaction||(yield this._customImplementation.getTransaction({path:r,write:!0}));try{if(r===""){if(i===null||typeof i!="object"||i instanceof Array||i instanceof ArrayBuffer||"buffer"in i&&i.buffer instanceof ArrayBuffer)throw new Error(`Invalid value for root node: ${i}`);yield this._writeNodeWithTracking("",i,{merge:!1,transaction:a,suppress_events:o.suppress_events,context:o.context})}else if(typeof o.assert_revision!="undefined"){const c=yield this.getNodeInfo(r,{transaction:a});if(c.revision!==o.assert_revision)throw new Zu(`revision '${c.revision}' does not match requested revision '${o.assert_revision}'`);if(c.address&&c.address.path===r&&i!==null&&!this.valueFitsInline(i))yield this._writeNodeWithTracking(r,i,{merge:!1,transaction:a,suppress_events:o.suppress_events,context:o.context});else{const l=yield a.moveToParentPath(s.parentPath);Zt(l===s.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${r}"`),yield this._writeNodeWithTracking(s.parentPath,{[s.key]:i},{merge:!0,transaction:a,suppress_events:o.suppress_events,context:o.context})}}else{const c=yield a.moveToParentPath(s.parentPath);Zt(c===s.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${r}"`),yield this.updateNode(s.parentPath,{[s.key]:i},{transaction:a,suppress_events:o.suppress_events,context:o.context})}o.transaction||(yield a.commit())}catch(c){throw o.transaction||(yield a.rollback(c)),c}})}updateNode(e,t){return K(this,arguments,function*(r,i,o={suppress_events:!1,context:null}){if(this.settings.readOnly)throw new Error("Database is opened in read-only mode");if(typeof i!="object")throw new Error("invalid updates argument");if(Object.keys(i).length===0)return;const s=o.transaction||(yield this._customImplementation.getTransaction({path:r,write:!0}));try{const a=yield this.getNodeInfo(r,{transaction:s}),c=Y.get(r);if(a.exists&&a.address&&a.address.path===r)yield this._writeNodeWithTracking(r,i,{transaction:s,merge:!0,suppress_events:o.suppress_events,context:o.context});else if(a.exists){const l=Y.get(r),u=yield s.moveToParentPath(l.parentPath);Zt(u===l.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${r}"`),yield this._writeNodeWithTracking(l.parentPath,{[l.key]:i},{transaction:s,merge:!0,suppress_events:o.suppress_events,context:o.context})}else{const l=yield s.moveToParentPath(c.parentPath);Zt(l===c.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${r}"`),yield this.updateNode(c.parentPath,{[c.key]:i},{transaction:s,suppress_events:o.suppress_events,context:o.context})}o.transaction||(yield s.commit())}catch(a){throw o.transaction||(yield s.rollback(a)),a}})}}class WP{constructor(e=1e3,t){this.limit=e,this.options=t,this.added=0,this.scheduled=[],this.running=0,this.results=[],this.done=!1}execute(e,t){return K(this,null,function*(){var r,i;try{this.running++;const o=yield e();if(this.results[t]=o,this.running--,this.running===0&&this.scheduled.length===0)this.done=!0,(r=this.doneCallback)==null||r.call(this,this.results);else if(this.scheduled.length>0){const s=this.scheduled.shift();this.execute(s.task,s.index)}}catch(o){this.done=!0,(i=this.errorCallback)==null||i.call(this,o)}})}add(e){var t;if(this.done)throw new Error("Cannot add to a batch that has already finished. Use wait option and start batch processing manually if you are adding tasks in an async loop");const r=this.added++;((t=this.options)==null?void 0:t.wait)!==!0&&this.running<this.limit?this.execute(e,r):this.scheduled.push({task:e,index:r})}start(){for(;this.running<this.limit;){const e=this.scheduled.shift();this.execute(e.task,e.index)}}finish(){return K(this,null,function*(){return this.running===0&&this.scheduled.length===0?this.results:(yield new Promise((e,t)=>{this.doneCallback=e,this.errorCallback=t}),this.results)})}}const zP=()=>{};function $b(n,e,t){return K(this,arguments,function*(r,i,o,s={snapshots:!1,include:void 0,exclude:void 0,child_objects:void 0,eventHandler:zP}){var a,c,l,u,h,y;typeof s!="object"&&(s={}),typeof s.snapshots=="undefined"&&(s.snapshots=!1);const d={};(a=r.storage.settings.transactions)!=null&&a.log&&(d.acebase_cursor=Vt.generate());const f=o.filters.map(O=>se({},O)),g=o.order.map(O=>se({},O)),_=O=>{O.sort((p,v)=>{const m=w=>{const E=g[w],b=Y.getPathKeys(typeof E.key=="number"?`[${E.key}]`:E.key),k=b.reduce(($,S)=>$!==null&&typeof $=="object"&&S in $?$[S]:null,p.val),x=b.reduce(($,S)=>$!==null&&typeof $=="object"&&S in $?$[S]:null,v.val);return k===null?x===null?0:E.ascending?-1:1:x===null?E.ascending?1:-1:k==x?w<g.length-1?m(w+1):p.path<v.path?-1:1:k<x?E.ascending?-1:1:E.ascending?1:-1};return m(0)})},A=(O,p)=>K(this,null,function*(){if(O.length===0)return[];const v=50,m=new WP(v),w=[];return O.forEach(({path:E},b)=>m.add(()=>K(this,null,function*(){const k=(yield r.storage.getNode(E,p)).value;if(k===null){r.storage.debug.warn(`Indexed result "/${E}" does not have a record!`);return}const x={path:E,val:k};U.sorted?w[b]=x:(w.push(x),!U.skipped&&w.length>o.skip+Math.abs(o.take)&&(_(w),w.pop()))}))),yield m.finish(),w}),P=Y.get(i),B=P.keys.some(O=>O==="*"||O.toString().startsWith("$")),C=r.storage.indexes.get(i),L=[];let q=()=>K(this,null,function*(){});if(B){const O=P.keys.filter(m=>typeof m=="string"&&m.startsWith("$")),p=O.length>0&&O.every(m=>o.filters.some(w=>w.key===m&&["==","in"].includes(w.op))),v=typeof s.monitor=="object"&&[(c=s.monitor)==null?void 0:c.add,(l=s.monitor)==null?void 0:l.change,(u=s.monitor)==null?void 0:u.remove].some(m=>m===!0);if(p&&!v){const m=[];for(const $ of O){const S=o.filters.filter(R=>R.key===$).reduce((R,N)=>{if(N.op==="=="&&R.push(N.compare),N.op==="in"){if(!(N.compare instanceof Array))throw new Error("compare argument for 'in' operator must be an Array");R.push(...N.compare)}return R},[]),T=m.splice(0);S.forEach(R=>{T.length===0?m.push({[$]:R}):m.push(...T.map(N=>tt(se({},N),{[$]:R})))})}const w=o.filters.filter($=>!O.includes($.key)),E=m.map($=>Y.get(Y.getPathKeys(i).map(S=>{var T;return(T=$[S])!=null?T:S})).path),b=o.order.length>0,k=E.map($=>{var S;return $b(r,$,{filters:w,take:0,skip:0,order:[]},{snapshots:b,cache_mode:s.cache_mode,include:[...(S=s.include)!=null?S:[],...o.order.map(T=>T.key)],exclude:s.exclude})});let x=(yield Promise.all(k)).reduce(($,S)=>($.push(...S.results),$),[]);if(b&&_(x),o.skip>0&&x.splice(0,o.skip),o.take>0&&x.splice(o.take),s.snapshots&&(!b||((h=s.include)==null?void 0:h.length)>0||((y=s.exclude)==null?void 0:y.length)>0||!s.child_objects)){const{include:$,exclude:S,child_objects:T}=s;x=yield A(x,{include:$,exclude:S,child_objects:T})}return{results:x,context:null,stop:q}}else if(C.length===0){const m=new Error(`Query on wildcard path "/${i}" requires an index`);return Promise.reject(m)}if(f.length===0){const m=C.filter(w=>w.type==="normal")[0];f.push({key:m.key,op:"!=",compare:null})}}f.forEach(O=>{if(O.index)return;const p=C.filter(v=>v.key===O.key).filter(v=>v.validOperators.includes(O.op));if(p.length>=1){const v=f.filter(b=>b!==O).map(b=>b.key),m=g.map(b=>b.key).filter(b=>b!==O.key),w=p.map(b=>{const k=b.includeKeys.concat(b.key),x=k.filter(R=>v.includes(R)),$=k.filter(R=>m.includes(R)),S=x.concat($.filter(R=>!x.includes(R))),T={filters:x.length,sorting:$.length*(o.take!==0?$.length:1),both:S.length*S.length,get total(){return this.filters+this.sorting+this.both}};return{index:b,points:T.total,filterKeys:x,sortKeys:$}});w.sort((b,k)=>b.points>k.points?-1:1);const E=w[0];O.index=E.index,E.filterKeys.forEach(b=>{f.filter(k=>k!==O&&k.key===b).forEach(k=>{!Id.validOperators.includes(k.op)||(k.indexUsage="filter",k.index=E.index)})}),E.sortKeys.forEach(b=>{g.filter(k=>k.key===b).forEach(k=>{k.index=E.index})})}O.index&&L.push({index:O.index,description:O.index.description})}),g.length>0&&o.take!==0&&f.length===0&&g.forEach(O=>{O.index||(O.index=C.filter(p=>p.key===O.key).find(p=>p.type==="normal"))});const H=L.map(O=>O.description).join(", ");L.length>0&&r.storage.debug.log(`Using indexes for query: ${H}`);const j=f.filter(O=>!O.index),I=/^[a-z]+:/i;if(j.some(O=>I.test(O.op))){const O=j.find(v=>I.test(v.op)),p=new Error(`query contains operator "${O.op}" which requires a special index that was not found on path "${i}", key "${O.key}"`);return Promise.reject(p)}const D=["<","<=","==","!=",">=",">","like","!like","in","!in","matches","!matches","between","!between","has","!has","contains","!contains","exists","!exists"];for(let O=0;O<j.length;O++){const p=j[O];if(!D.includes(p.op))return Promise.reject(new Error(`query contains unknown filter operator "${p.op}" on path "${i}", key "${p.key}"`))}if(B&&j.length>0){const O=j.reduce((v,m)=>(v.indexOf(m.key)<0&&v.push(m.key),v),[]).map(v=>`"${v}"`),p=new Error(`This wildcard path query on "/${i}" requires index(es) on key(s): ${O.join(", ")}. Create the index(es) and retry`);return Promise.reject(p)}const M=[];f.forEach(O=>{if(O.index&&O.indexUsage!=="filter"){let p=O.index.query(O.op,O.compare).then(m=>(s.eventHandler&&s.eventHandler({name:"stats",type:"index_query",source:O.index.description,stats:m.stats}),m.hints.length>0&&s.eventHandler&&s.eventHandler({name:"hints",type:"index_query",source:O.index.description,hints:m.hints}),m));const v=f.filter(m=>m.index===O.index&&m.indexUsage==="filter");v.length>0&&(p=p.then(m=>(v.forEach(w=>{const{key:E,op:b,index:k}=w;let{compare:x}=w;typeof x=="string"&&!k.caseSensitive&&(x=x.toLocaleLowerCase(k.textLocale)),m=m.filterMetadata(E,b,x)}),m))),M.push(p)}});const U={filtered:f.length===0,skipped:o.skip===0,taken:o.take===0,sorted:g.length===0,preDataLoaded:!1,dataLoaded:!1};if(f.length===0&&o.take===0&&(r.storage.debug.warn(`Filterless queries must use .take to limit the results. Defaulting to 100 for query on path "${i}"`),o.take=100),g.length>0&&g[0].index){const O=g[0].index,p=o.take<0?!g[0].ascending:g[0].ascending;if(f.length===0&&g.slice(1).every(v=>O.allMetadataKeys.includes(v.key))){r.storage.debug.log(`Using index for sorting: ${O.description}`);const v=g.slice(1).map(w=>(w.index=O,{key:w.key,ascending:w.ascending})),m=O.take(o.skip,Math.abs(o.take),{ascending:p,metadataSort:v}).then(w=>(s.eventHandler&&s.eventHandler({name:"stats",type:"sort_index_take",source:O.description,stats:w.stats}),w.hints.length>0&&s.eventHandler&&s.eventHandler({name:"hints",type:"sort_index_take",source:O.description,hints:w.hints}),w));M.push(m),U.skipped=!0,U.taken=!0,U.sorted=!0}}return Promise.all(M).then(O=>K(this,null,function*(){let p=[];if(O.length===1){const x=O[0];p=x.map($=>{const S={key:$.key,path:$.path,val:{[x.filterKey]:$.value}};return $.metadata&&Object.assign(S.val,$.metadata),S}),U.filtered=!0}else if(O.length>1){O.sort((S,T)=>S.length<T.length?-1:1);const x=O[0],$=O.slice(1);p=x.reduce((S,T)=>{const R={key:T.key,path:T.path,val:{[x.filterKey]:T.value}};return $.every(N=>N.findIndex(z=>z.path===T.path)>=0)&&(T.metadata&&Object.assign(R.val,T.metadata),$.forEach(N=>{const z=N.find(F=>F.path===R.path);R.val[N.filterKey]=z.value,z.metadata&&Object.assign(R.val,z.metadata)}),S.push(R)),S},[]),U.filtered=!0}if(B||M.length>0&&j.length===0){if(g.length===0||g.every(x=>x.index)){if(U.preDataLoaded=!0,!U.sorted&&g.length>0&&_(p),U.sorted=!0,!U.skipped&&o.skip>0&&(p=o.take<0?p.slice(0,-o.skip):p.slice(o.skip)),!U.taken&&o.take!==0&&(p=o.take<0?p.slice(o.take):p.slice(0,o.take)),U.skipped=!0,U.taken=!0,!s.snapshots)return p;const x={include:s.include,exclude:s.exclude,child_objects:s.child_objects};return A(p,x).then($=>(U.dataLoaded=!0,$))}if(s.snapshots||!U.sorted){const x=g.length>0,$=x?{include:g.map(S=>S.key)}:{include:s.include,exclude:s.exclude,child_objects:s.child_objects};return A(p,$).then(S=>(g.length>0&&_(S),U.sorted=!0,o.skip>0&&(S=o.take<0?S.slice(0,-o.skip):S.slice(o.skip)),o.take!==0&&(S=o.take<0?S.slice(o.take):S.slice(0,o.take)),U.skipped=!0,U.taken=!0,s.snapshots&&x?A(S,{include:s.include,exclude:s.exclude,child_objects:s.child_objects}):S))}else return p}let v;p.length>0&&(v=p.map(x=>x.key));let m=[],w=!1;const E=g.length>0,b=E?{include:g.map(x=>x.key)}:{include:s.include,exclude:s.exclude,child_objects:s.child_objects},k={promises:[],add(x){if(this.promises.push(x),this.promises.length>=1e3)return Promise.all(this.promises.splice(0)).then($=>{})}};try{yield r.storage.getChildren(i,{keyFilter:v,async:!0}).next(x=>{if(x.type!==ce.OBJECT||!x.address)return;if(w)return!1;const $=()=>K(this,null,function*(){if(!(yield r.storage.matchNode(x.address.path,j)))return;const T=x.address.path;let R;if(s.snapshots||g.length>0){const N=yield r.storage.getNode(T,b);R={path:T,val:N.value}}else R={path:T};m.push(R),o.take!==0&&m.length>Math.abs(o.take)+o.skip&&(g.length>0?_(m):o.take>0&&(w=!0),m.pop())}),S=k.add($());if(S instanceof Promise)return S})}catch(x){return x instanceof Rd||r.storage.debug.warn(`Error getting child stream: ${x}`),[]}return yield Promise.all(k.promises),U.preDataLoaded=E,U.dataLoaded=!E,g.length>0&&_(m),U.sorted=!0,o.skip>0&&(m=o.take<0?m.slice(0,-o.skip):m.slice(o.skip)),U.skipped=!0,o.take!==0&&(m=o.take<0?m.slice(o.take):m.slice(0,o.take)),U.taken=!0,U.dataLoaded||(m=yield A(m,{include:s.include,exclude:s.exclude,child_objects:s.child_objects}),U.dataLoaded=!0),m})).then(O=>{if(!U.sorted&&g.length>0&&_(O),s.snapshots||(O=O.map(p=>p.path)),!U.skipped&&o.skip>0&&(O=o.take<0?O.slice(0,-o.skip):O.slice(o.skip)),!U.taken&&o.take!==0&&(O=o.take<0?O.slice(o.take):O.slice(0,o.take)),s.monitor===!0&&(s.monitor={add:!0,change:!0,remove:!0}),typeof s.monitor=="object"&&(s.monitor.add||s.monitor.change||s.monitor.remove)){const p=s.monitor,v=s.snapshots?O.map(S=>S.path):O.slice(),m=r.db.ref(i),w=S=>{const T=v.indexOf(S);T<0||v.splice(T,1)},E=S=>{v.includes(S)||v.push(S)},b=()=>{r.unsubscribe(m.path,"child_changed",k),r.unsubscribe(m.path,"child_added",x),r.unsubscribe(m.path,"notify_child_removed",$)};q=()=>K(this,null,function*(){b()});const k=(S,T,R,N)=>K(this,null,function*(){const z=v.includes(T);let F=!0;const ne=[];f.forEach(re=>!ne.includes(re.key)&&ne.push(re.key));const te=[];typeof N=="object"&&Object.keys(N).forEach(re=>!te.includes(re)&&te.push(re)),typeof R=="object"&&Object.keys(R).forEach(re=>!te.includes(re)&&te.push(re));const pe=[];let oe=te.every(re=>ne.includes(re)?f.filter(ue=>ue.key===re).every(ue=>{var Ne;return((Ne=ue.index)==null?void 0:Ne.textLocaleKey)&&!te.includes(ue.index.textLocaleKey)?(pe.push(ue.index.textLocaleKey),!0):D.includes(ue.op)?r.storage.test(R[re],ue.op,ue.compare):ue.index.test(R,ue.op,ue.compare)}):!0);if(oe&&(pe.push(...ne.filter(re=>!te.includes(re))),!z&&pe.length>0)){const re=f.filter(ye=>pe.includes(ye.key)),ue=re.filter(ye=>D.includes(ye.op)),Ne=re.filter(ye=>!D.includes(ye.op));if(ue.length>0&&(oe=yield r.storage.matchNode(T,ue)),oe&&Ne.length>0){const ye=Ne.reduce((Ce,He)=>(Ce.includes(He.key)||Ce.push(He.key),He.index instanceof _b&&He.index.config.localeKey&&!Ce.includes(He.index.config.localeKey)&&Ce.push(He.index.config.localeKey),Ce),[]),It=yield r.storage.getNode(T,{include:ye});if(It.value===null)return!1;oe=Ne.every(Ce=>Ce.index.test(It.value,Ce.op,Ce.compare))}}if(oe){if(z||E(T),s.snapshots){const re={include:s.include,exclude:s.exclude,child_objects:s.child_objects};R=(yield r.storage.getNode(T,re)).value}z&&p.change?F=s.eventHandler({name:"change",path:T,value:R})!==!1:!z&&p.add&&(F=s.eventHandler({name:"add",path:T,value:R})!==!1)}else z&&(w(T),p.remove&&(F=s.eventHandler({name:"remove",path:T,value:N})!==!1));F===!1&&b()}),x=(S,T,R)=>{const N=f.every(F=>D.includes(F.op)?r.storage.test(R[F.key],F.op,F.compare):F.index.test(R,F.op,F.compare));let z=!0;N&&(E(T),p.add&&(z=s.eventHandler({name:"add",path:T,value:s.snapshots?R:null})!==!1)),z===!1&&b()},$=(S,T,R,N)=>{let z=!0;w(T),p.remove&&(z=s.eventHandler({name:"remove",path:T,value:s.snapshots?N:null})!==!1),z===!1&&b()};(s.monitor.add||s.monitor.change||s.monitor.remove)&&r.subscribe(m.path,"child_changed",k),s.monitor.remove&&r.subscribe(m.path,"notify_child_removed",$),s.monitor.add&&r.subscribe(m.path,"child_added",x)}return{results:O,context:d,stop:q}})})}class HP extends bP{constructor(e="default",t,r){super(),this.db=t.db;const i={logLevel:t.settings.logLevel};if(typeof t.settings.storage=="object")if(ly&&t.settings.storage instanceof ly)this.storage=new AP(e,t.settings.storage,i);else if(uy&&t.settings.storage instanceof uy)this.storage=new SP(e,t.settings.storage,i);else if(os&&t.settings.storage instanceof os)this.storage=new KP(e,t.settings.storage,i);else{const o=t.settings.storage instanceof Dl?t.settings.storage:new Dl(t.settings.storage);this.storage=new Xu(e,o,i)}else this.storage=new Xu(e,new Dl,i);this.storage.on("ready",r)}stats(e){return K(this,null,function*(){return this.storage.stats})}subscribe(e,t,r){this.storage.subscriptions.add(e,t,r)}unsubscribe(e,t,r){this.storage.subscriptions.remove(e,t,r)}set(e,t){return K(this,arguments,function*(r,i,o={suppress_events:!1,context:null}){const s=yield this.storage.setNode(r,i,{suppress_events:o.suppress_events,context:o.context});return se({},s&&{cursor:s})})}update(e,t){return K(this,arguments,function*(r,i,o={suppress_events:!1,context:null}){const s=yield this.storage.updateNode(r,i,{suppress_events:o.suppress_events,context:o.context});return se({},s&&{cursor:s})})}get transactionLoggingEnabled(){return this.storage.settings.transactions&&this.storage.settings.transactions.log===!0}get(e,t){return K(this,null,function*(){if(t||(t={}),typeof t.include!="undefined"&&!(t.include instanceof Array))throw new TypeError("options.include must be an array of key names");if(typeof t.exclude!="undefined"&&!(t.exclude instanceof Array))throw new TypeError("options.exclude must be an array of key names");if(["undefined","boolean"].indexOf(typeof t.child_objects)<0)throw new TypeError("options.child_objects must be a boolean");const r=yield this.storage.getNode(e,t);return{value:r.value,context:{acebase_cursor:r.cursor},cursor:r.cursor}})}transaction(e,t){return K(this,arguments,function*(r,i,o={suppress_events:!1,context:null}){const s=yield this.storage.transactNode(r,i,{suppress_events:o.suppress_events,context:o.context});return se({},s&&{cursor:s})})}exists(e){return K(this,null,function*(){return(yield this.storage.getNodeInfo(e)).exists})}query(e,t){return K(this,arguments,function*(r,i,o={snapshots:!1}){return yield $b(this,r,i,o)})}createIndex(e,t,r){return this.storage.indexes.create(e,t,r)}getIndexes(){return K(this,null,function*(){return this.storage.indexes.list()})}deleteIndex(e){return K(this,null,function*(){return this.storage.indexes.delete(e)})}reflect(e,t,r){return K(this,null,function*(){r=r||{};const i=(o,s=50,a=0,c=null)=>K(this,null,function*(){typeof s=="string"&&(s=parseInt(s)),typeof a=="string"&&(a=parseInt(a)),["null","undefined"].includes(c)&&(c=null);const l=[];let u=0,h=!1,y=!1;return yield this.storage.getChildren(o).next(d=>{if(h)return y=!0,!1;u++,(c!==null?d.key>c:a===0||u>a)&&l.push(se({key:typeof d.key=="string"?d.key:d.index,type:d.valueTypeName,value:d.value},typeof d.address=="object"&&"pageNr"in d.address&&{address:{pageNr:d.address.pageNr,recordNr:d.address.recordNr}})),h=s>0&&l.length===s}).catch(d=>{if(!(d instanceof Rd))throw d}),{more:y,list:l}});switch(t){case"children":return yield i(e,r.limit,r.skip,r.from);case"info":{const o={key:"",exists:!1,type:"unknown",value:void 0,address:void 0,children:{count:0,more:!1,list:[]}},s=yield this.storage.getNodeInfo(e,{include_child_count:r.child_count===!0});o.key=typeof s.key!="undefined"?s.key:s.index,o.exists=s.exists,o.type=s.exists?s.valueTypeName:void 0,o.value=s.value,o.address=typeof s.address=="object"&&"pageNr"in s.address?{pageNr:s.address.pageNr,recordNr:s.address.recordNr}:void 0;const a=s.exists&&s.address&&[ce.OBJECT,ce.ARRAY].includes(s.type);return r.child_count===!0?o.children={count:a?s.childCount:0}:typeof r.child_limit=="number"&&r.child_limit>0&&a&&(o.children=yield i(e,r.child_limit,r.child_skip,r.child_from)),o}}})}export(e,t,r={format:"json",type_safe:!0}){return this.storage.exportNode(e,t,r)}import(e,t,r={format:"json",suppress_events:!1,method:"set"}){return this.storage.importNode(e,t,r)}setSchema(e,t,r=!1){return K(this,null,function*(){return this.storage.setSchema(e,t,r)})}getSchema(e){return K(this,null,function*(){return this.storage.getSchema(e)})}getSchemas(){return K(this,null,function*(){return this.storage.getSchemas()})}validateSchema(e,t,r){return K(this,null,function*(){return this.storage.validateSchema(e,t,{updates:r})})}getMutations(e){return K(this,null,function*(){if(typeof this.storage.getMutations!="function")throw new Error("Used storage type does not support getMutations");if(typeof e!="object")throw new Error("No filter specified");if(typeof e.cursor!="string"&&typeof e.timestamp!="number")throw new Error("No cursor or timestamp given");return this.storage.getMutations(e)})}getChanges(e){return K(this,null,function*(){if(typeof this.storage.getChanges!="function")throw new Error("Used storage type does not support getChanges");if(typeof e!="object")throw new Error("No filter specified");if(typeof e.cursor!="string"&&typeof e.timestamp!="number")throw new Error("No cursor or timestamp given");return this.storage.getChanges(e)})}}class JP extends Cd{constructor(e){super(e),this.temp=!1,this.multipleTabs=!1,typeof e.temp=="boolean"&&(this.temp=e.temp),typeof e.provider=="object"&&(this.provider=e.provider),typeof e.multipleTabs=="boolean"&&(this.multipleTabs=e.multipleTabs),typeof e.logLevel=="string"&&(this.logLevel=e.logLevel),typeof e.sponsor=="boolean"&&(this.sponsor=e.sponsor),["type","ipc","path"].forEach(t=>{t in e&&console.warn(`${t} setting is not supported for AceBase LocalStorage`)})}}class YP extends Nd{constructor(e,t){super(t),this.context=e,this._storageKeysPrefix=`${this.context.dbname}.acebase::`}commit(){return K(this,null,function*(){})}rollback(e){return K(this,null,function*(){})}get(e){return K(this,null,function*(){const t=this.context.localStorage.getItem(this.getStorageKeyForPath(e));return JSON.parse(t)})}set(e,t){return K(this,null,function*(){const r=JSON.stringify(t);this.context.localStorage.setItem(this.getStorageKeyForPath(e),r)})}remove(e){return K(this,null,function*(){this.context.localStorage.removeItem(this.getStorageKeyForPath(e))})}childrenOf(e,t,r,i){return K(this,null,function*(){const o=is.PathInfo.get(e);for(let s=0;s<this.context.localStorage.length;s++){const a=this.context.localStorage.key(s);if(!a.startsWith(this._storageKeysPrefix))continue;const c=this.getPathFromStorageKey(a);if(o.isParentOf(c)&&r(c)){let l;if(t.metadata||t.value){const u=this.context.localStorage.getItem(a);l=JSON.parse(u)}if(!i(c,l))break}}})}descendantsOf(e,t,r,i){return K(this,null,function*(){const o=is.PathInfo.get(e);for(let s=0;s<this.context.localStorage.length;s++){const a=this.context.localStorage.key(s);if(!a.startsWith(this._storageKeysPrefix))continue;const c=this.getPathFromStorageKey(a);if(o.isAncestorOf(c)&&r(c)){let l;if(t.metadata||t.value){const u=this.context.localStorage.getItem(a);l=JSON.parse(u)}if(!i(c,l))break}}})}getPathFromStorageKey(e){return e.slice(this._storageKeysPrefix.length)}getStorageKeyForPath(e){return`${this._storageKeysPrefix}${e}`}}function GP(n,e={}){const t=new JP(e),r=t.provider?t.provider:t.temp?window.localStorage:window.sessionStorage,i=new os({name:"LocalStorage",locking:!0,removeVoidProperties:t.removeVoidProperties,maxInlineValueSize:t.maxInlineValueSize,ready(){return K(this,null,function*(){})},getTransaction(s){return K(this,null,function*(){const a={debug:!0,dbname:n,localStorage:r};return new YP(a,s)})}}),o=new As(n,{logLevel:t.logLevel,storage:i,sponsor:t.sponsor});return o.settings.ipcEvents=t.multipleTabs===!0,o}class XP extends Cd{constructor(e){super(e),this.multipleTabs=!1,this.cacheSeconds=60,this.sponsor=!1,typeof e.logLevel=="string"&&(this.logLevel=e.logLevel),typeof e.multipleTabs=="boolean"&&(this.multipleTabs=e.multipleTabs),typeof e.cacheSeconds=="number"&&(this.cacheSeconds=e.cacheSeconds),typeof e.sponsor=="boolean"&&(this.sponsor=e.sponsor),["type","ipc","path"].forEach(t=>{t in e&&console.warn(`${t} setting is not supported for AceBase IndexedDBStorage`)})}}class Ob extends wb{constructor(e={}){super(e),e.storage&&(this.storage=e.storage,e.ipc&&(this.storage.ipc=e.ipc),e.transactions&&(this.storage.transactions=e.transactions))}}class ZP extends vP{constructor(e,t={}){const r=new Ob(t);super(e,r),this.recovery={repairNode:(o,s)=>K(this,null,function*(){if(yield this.ready(),this.api.storage instanceof Xu)yield this.api.storage.repairNode(o,s);else if(!this.api.storage.repairNode)throw new Error("repairNode is not supported with chosen storage engine")}),repairNodeTree:o=>K(this,null,function*(){yield this.ready(),yield this.api.storage.repairNodeTree(o)})};const i={db:this,settings:r};this.api=new HP(e,i,()=>{this.emit("ready")})}close(){return K(this,null,function*(){yield this.api.storage.close()})}get settings(){const e=this.api.storage.ipc,t=this.debug;return{get logLevel(){return t.level},set logLevel(r){t.setLevel(r)},get ipcEvents(){return e.eventsEnabled},set ipcEvents(r){e.eventsEnabled=r}}}static WithLocalStorage(e,t={}){return GP(e,t)}static WithIndexedDB(e,t={}){throw new Error("IndexedDB storage can only be used in browser contexts")}}function fy(n){return new Promise((e,t)=>{n.onsuccess=r=>e(n.result||null),n.onerror=t})}class QP extends Nd{constructor(e,t){super(t),this.context=e,this.production=!0,this._pending=[]}_createTransaction(e=!1){return this.context.db.transaction(["nodes","content"],e?"readwrite":"readonly")}_splitMetadata(e){const t=e.value,r=se({},e);return delete r.value,{metadata:r,value:t}}commit(){return K(this,null,function*(){if(this._pending.length===0)return;const e=this._pending.splice(0);this.context.ipc.sendNotification({action:"cache.invalidate",paths:e.map(r=>r.path)});const t=this._createTransaction(!0);try{yield new Promise((r,i)=>{let o=!1,s=0;const a=l=>{o=!0,i(l)},c=()=>{++s===e.length&&r()};e.forEach((l,u)=>{if(o)return;let h,y;const d=l.path;if(l.action==="set"){const{metadata:g,value:_}=this._splitMetadata(l.node),A={path:d,metadata:g};h=t.objectStore("nodes").put(A),y=t.objectStore("content").put(_,d),this.context.cache.set(d,l.node)}else l.action==="remove"?(h=t.objectStore("content").delete(d),y=t.objectStore("nodes").delete(d),this.context.cache.set(d,null)):a(new Error(`Unknown pending operation "${l.action}" on path "${d}" `));let f=0;h.onsuccess=y.onsuccess=()=>{++f===2&&c()},h.onerror=y.onerror=a})}),t.commit&&t.commit()}catch(r){throw console.error(r),t.abort&&t.abort(),r}})}rollback(e){return K(this,null,function*(){this._pending=[]})}get(e){return K(this,null,function*(){if(this.context.cache.has(e))return this.context.cache.get(e);const t=this._createTransaction(!1),r=fy(t.objectStore("nodes").get(e)),i=fy(t.objectStore("content").get(e));try{const o=yield Promise.all([r,i]);t.commit&&t.commit();const s=o[0];if(!s)return this.context.cache.set(e,null),null;const a=s.metadata;return a.value=o[1],this.context.cache.set(e,a),a}catch(o){throw console.error("IndexedDB get error",o),t.abort&&t.abort(),o}})}set(e,t){this._pending.push({action:"set",path:e,node:t})}remove(e){this._pending.push({action:"remove",path:e})}removeMultiple(e){return K(this,null,function*(){e.forEach(t=>{this._pending.push({action:"remove",path:t})})})}childrenOf(e,t,r,i){return this._getChildrenOf(e,tt(se({},t),{descendants:!1}),r,i)}descendantsOf(e,t,r,i){return this._getChildrenOf(e,tt(se({},t),{descendants:!0}),r,i)}_getChildrenOf(e,t,r,i){return new Promise((o,s)=>{const a=is.PathInfo.get(e),c=this._createTransaction(!1),l=c.objectStore("nodes"),u=IDBKeyRange.lowerBound(e,!0),h=t.metadata?l.openCursor(u):l.openKeyCursor(u);h.onerror=y=>{var d;(d=c.abort)==null||d.call(c),s(y)},h.onsuccess=y=>K(this,null,function*(){var d,f,g;const _=(f=(d=h.result)==null?void 0:d.key)!=null?f:null;let A=!0;if(_===null)A=!1;else if(!a.isAncestorOf(_))A=!1;else if(t.descendants||a.isParentOf(_)){let P;if(t.metadata&&(P=h.result.value.metadata),r(_,P)){if(t.value)if(this.context.cache.has(_)){const B=this.context.cache.get(_);P.value=B.value}else{const B=c.objectStore("content").get(_);P.value=yield new Promise((C,L)=>{B.onerror=q=>{C(null)},B.onsuccess=q=>{C(B.result)}}),this.context.cache.set(_,P.value===null?null:P)}A=i(_,P)}}if(A)try{h.result.continue()}catch(P){A=!1}A||((g=c.commit)==null||g.call(c),o())})})}}function ej(n,e={}){const t=new XP(e),r=(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB).open(`${n}.acebase`,1);r.onupgradeneeded=u=>{const h=r.result;h.createObjectStore("nodes",{keyPath:"path"}),h.createObjectStore("content")};let i;const o=new Promise((u,h)=>{r.onsuccess=y=>{i=r.result,u()},r.onerror=y=>{h(y)}}),s=new xP(typeof t.cacheSeconds=="number"?t.cacheSeconds:60),a=new os({name:"IndexedDB",locking:!0,removeVoidProperties:t.removeVoidProperties,maxInlineValueSize:t.maxInlineValueSize,lockTimeout:t.lockTimeout,ready(){return o},getTransaction(u){return K(this,null,function*(){yield o;const h={debug:!1,db:i,cache:s,ipc:l};return new QP(h,u)})}}),c=new As(n,{logLevel:t.logLevel,storage:a,sponsor:t.sponsor}),l=c.api.storage.ipc;return c.settings.ipcEvents=t.multipleTabs===!0,l.on("notification",u=>K(this,null,function*(){const h=u.data;if(typeof h=="object"&&h.action==="cache.invalidate")for(const y of h.paths)s.remove(y)})),c}const tj=`Using AceBase constructor in the browser to use localStorage is deprecated!
Switch to:
IndexedDB implementation (FASTER, MORE RELIABLE):
    let db = AceBase.WithIndexedDB(name, settings)
Or, new LocalStorage implementation:
    let db = AceBase.WithLocalStorage(name, settings)
Or, write your own CustomStorage adapter:
    let myCustomStorage = new CustomStorageSettings({ ... });
    let db = new AceBase(name, { storage: myCustomStorage })`;class As extends ZP{constructor(e,t){if(typeof t!="object"||typeof t.storage!="object")throw new Error(tj);super(e,t),this.settings.ipcEvents=t.multipleTabs===!0}static WithIndexedDB(e,t={}){return ej(e,t)}}const nj={AceBase:As,AceBaseLocalSettings:Ob,DataReference:Yn,DataSnapshot:it,EventSubscription:ob,PathReference:ot,TypeMappings:gb,CustomStorageSettings:os,CustomStorageTransaction:Nd,CustomStorageHelpers:is,ID:Vt,proxyAccess:Sa,DataSnapshotsArray:Nc};window.acebase=nj;window.AceBase=As;let rj=()=>Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),Ml=(()=>"/ps"+rj()+"/pe")();const Bt={req:"/custom",create:{one:"/create-one",many:"/create-many"},send:{one:"/send-one",many:"/send-many"},find:{one:"/find-one",many:"/find-many"},get:{one:"/get-one",many:"/get-many"},query:{many:"/get-many"},update:{one:"/update-one",many:"/update-many"},delete:{one:"/delete-one",many:"/delete-many"}},bn={create:"/create",find:"/find",get:"/get",query:"/get",update:"/update",delete:"/delete",req:"/custom",upload:"/upload",send:"/send",user:{base:"/user",example:"/user/device-connected",join:"",status:"/user/status",device:{connected:"/user/device-connected",removed:"/user/device-removed",disconnected:"/user/device-disconnected"}}},Fl={base:"/auth",login:"/login/get-one",verify_token_code:"/verify-token-code/get-one",verify_pass_code:"/verify-pass-code/get-one",verify_email_code:"/verify-email-code/get-one",req:"/custom",user:"/user/"+Ml+"/get-one",register:"/register/get-one",forgotPassword:"/forgot-password/get-one"+Ml+"/get-one",deleteAccount:"/delete-account/get-one",refreshToken:"/refresh-token"+Ml+"/get-one",users:{base:"/users"}},py={base:"/data"};var Mo,vi,Gi,Fo,nr,Ab,eh,th,Ta,rr,Wt,Xi,zt;class ij{constructor(e={}){mn(this,Mo,"/on"),mn(this,vi,!0),mn(this,Gi,void 0),mn(this,Fo,void 0),mn(this,nr,void 0),mn(this,Ab,void 0),mn(this,eh,void 0),mn(this,th,void 0),mn(this,Ta,new MT),mn(this,rr,void 0),mn(this,Wt,void 0),mn(this,Xi,void 0),mn(this,zt,void 0),TA(this,"init",o=>{var s,a,c,l,u;let{ENV:h,HOST_SERVER:y,API_VERSION:d}=xe(this,Xi),f=()=>K(this,null,function*(){var p,v,m,w,E,b,k,x,$,S,T,R;let N="/transaction",z="/database",F=yield(m=(v=(p=xe(this,zt))==null?void 0:p.ref(N))==null?void 0:v.get())==null?void 0:m.catch(te=>{}),ne=yield(b=(E=(w=xe(this,zt))==null?void 0:w.ref(z))==null?void 0:E.get())==null?void 0:b.catch(te=>{});if(F.exists()){F=F.val();let te=Object.keys(F);if((te==null?void 0:te.length)>0){for(let pe in te){let oe=F[pe];(oe==null?void 0:oe.path)&&(oe==null?void 0:oe.method)&&(oe==null?void 0:oe.value)&&(yield this.init(o).database().ref(oe==null?void 0:oe.path).req(oe==null?void 0:oe.method,oe==null?void 0:oe.path,oe==null?void 0:oe.value).val())}ne.exists()&&(yield($=(x=(k=xe(this,zt))==null?void 0:k.ref(z))==null?void 0:x.remove())==null?void 0:$.catch(pe=>{})),yield(R=(T=(S=xe(this,zt))==null?void 0:S.ref(N))==null?void 0:T.remove())==null?void 0:R.catch(pe=>{})}}});(a=(s=o==null?void 0:o.socket)==null?void 0:s.database)==null||a.on("connect",()=>{Qn(this,Wt,!0),f()}),(l=(c=o==null?void 0:o.socket)==null?void 0:c.database)==null||l.on("disconnect",()=>{Qn(this,Wt,!1)});const g=(p={})=>{var v,m,w;let E={};if(p&&Object.keys(p).length>0&&(E.data=p),xe(this,nr)&&(E.storage=xe(this,nr),E.config=xe(this,eh)),xe(this,th)){let b=new FormData;Array.isArray(p)?(p.map((k,x)=>{typeof k=="object"&&(k.attachmentName="attachment"+x,k==null||k.attachments.forEach($=>{$!=null&&$.data?b.append("attachments"+x,$==null?void 0:$.data,$==null?void 0:$.name):b.append("attachments"+x,$)}))}),b.append("field",JSON.stringify(E))):Array.isArray(p==null?void 0:p.attachments)&&(p==null||p.attachments.forEach(k=>{k!=null&&k.data?b.append("attachments",k==null?void 0:k.data,k==null?void 0:k.name):b.append("attachments",k)}),delete E.data.attachments,b.append("field",JSON.stringify(E))),E=b}else if(xe(this,nr)&&(p==null?void 0:p.file)){let b=new FormData;p!=null&&p.file?((v=p.file)!=null&&v.data?b.append("file",(m=p.file)==null?void 0:m.data,(w=p.file)==null?void 0:w.name):b.append("file",p.file),delete E.data.file,b.append("field",JSON.stringify(E))):Array.isArray(p==null?void 0:p.directory)&&(p==null||p.directory.forEach(k=>{k!=null&&k.data?b.append("file",k==null?void 0:k.data,k==null?void 0:k.name):b.append("file",k)}),delete E.data.directory,b.append("field",JSON.stringify(E)),E=b),E=b}return E};let _=(p,v)=>K(this,null,function*(){var m,w,E,b,k,x,$,S;if(((m=p==null?void 0:p.error)==null?void 0:m.token)&&xe(this,vi)){if(Qn(this,vi,!1),localStorage.getItem("refreshToken")){h==="dev"&&console.log("Token expired or not found: ",(w=p.error)==null?void 0:w.token," Trying to request a new refresh token");let T=yield(b=(E=this==null?void 0:this.init(o))==null?void 0:E.auth())==null?void 0:b.req(Fl.refreshToken,{token:localStorage.getItem("refreshToken")}).val();if(T!=null&&T.error)return h==="dev"&&console.log("Refresh token expired or not found: ",T),xe(this,Gi)&&(window.top.location.href=xe(this,Gi)),T;if(T!=null&&T.data&&(h==="dev"&&console.log("We got a new refresh token ,",T==null?void 0:T.data),(k=T==null?void 0:T.data)!=null&&k.token&&localStorage.setItem("accessToken",(x=T==null?void 0:T.data)==null?void 0:x.token),($=T==null?void 0:T.data)!=null&&$.refreshToken&&localStorage.setItem("refreshToken",(S=T==null?void 0:T.data)==null?void 0:S.refreshToken),h==="dev"&&console.log("Trying to restart your request..."),typeof v=="function"))return yield v()}}else return p});const A=(p,v,m,w=()=>{})=>{const E=xe(this,Mo);let b=v.version+E+v.base+m;b=b.replace(/\/\//g,"/"),h==="dev"&&console.log("socket listen local path: ",b),p==null||p.on(b,w)},P=(p,v=()=>{})=>{var m;const w=xe(this,Mo);let E=(d==null?void 0:d.DATABASE)+w+p;E=E.replace(/\/\//g,"/"),h==="dev"&&console.log("emitter listen local path: ",E),(m=xe(this,Ta))==null||m.on(E,v)};let B=(p,v,m,w)=>(xe(this,Fo)&&(w=w+xe(this,Fo)),{req:E=>(A(p,v,w+bn.req,b=>{var k,x,$;(!((x=(k=b==null?void 0:b.error)==null?void 0:k.error)!=null&&x.token)&&!(($=b==null?void 0:b.error)!=null&&$.token)||(b==null?void 0:b.data))&&typeof E=="function"&&E(tt(se({},m),{value:b}))}),m),create:E=>(A(p,v,w+bn.create,b=>{var k,x,$;(!((x=(k=b==null?void 0:b.error)==null?void 0:k.error)!=null&&x.token)&&!(($=b==null?void 0:b.error)!=null&&$.token)||(b==null?void 0:b.data))&&typeof E=="function"&&E(tt(se({},m),{value:b}))}),m),find:E=>(A(p,v,w+bn.find,b=>{var k,x,$;(!((x=(k=b==null?void 0:b.error)==null?void 0:k.error)!=null&&x.token)&&!(($=b==null?void 0:b.error)!=null&&$.token)||(b==null?void 0:b.data))&&typeof E=="function"&&E(tt(se({},m),{value:b}))}),m),get:E=>(A(p,v,w+bn.get,b=>{var k,x,$;(!((x=(k=b==null?void 0:b.error)==null?void 0:k.error)!=null&&x.token)&&!(($=b==null?void 0:b.error)!=null&&$.token)||(b==null?void 0:b.data))&&typeof E=="function"&&E(tt(se({},m),{value:b}))}),m),query:E=>(A(p,v,w+bn.query,b=>{var k,x,$;(!((x=(k=b==null?void 0:b.error)==null?void 0:k.error)!=null&&x.token)&&!(($=b==null?void 0:b.error)!=null&&$.token)||(b==null?void 0:b.data))&&typeof E=="function"&&E(tt(se({},m),{value:b}))}),m),update:E=>(A(p,v,w+bn.update,b=>{var k,x,$;(!((x=(k=b==null?void 0:b.error)==null?void 0:k.error)!=null&&x.token)&&!(($=b==null?void 0:b.error)!=null&&$.token)||(b==null?void 0:b.data))&&typeof E=="function"&&E(tt(se({},m),{value:b}))}),m),delete:E=>(A(p,v,w+bn.delete,b=>{var k,x,$;(!((x=(k=b==null?void 0:b.error)==null?void 0:k.error)!=null&&x.token)&&!(($=b==null?void 0:b.error)!=null&&$.token)||(b==null?void 0:b.data))&&typeof E=="function"&&E(tt(se({},m),{value:b}))}),m)}),C=(p,v)=>({create:m=>(P(p+bn.create,w=>{(!(w!=null&&w.error)||(w==null?void 0:w.data))&&typeof m=="function"&&m(tt(se({},v),{value:w}))}),v),find:m=>(P(p+bn.find,w=>{(!(w!=null&&w.error)||(w==null?void 0:w.data))&&typeof m=="function"&&m(tt(se({},v),{value:w}))}),v),get:m=>(P(p+bn.get,w=>{(!(w!=null&&w.error)||(w==null?void 0:w.data))&&typeof m=="function"&&m(tt(se({},v),{value:w}))}),v),query:m=>(P(p+bn.query,w=>{(!(w!=null&&w.error)||(w==null?void 0:w.data))&&typeof m=="function"&&m(tt(se({},v),{value:w}))}),v),update:m=>(P(p+bn.update,w=>{(!(w!=null&&w.error)||(w==null?void 0:w.data))&&typeof m=="function"&&m(tt(se({},v),{value:w}))}),v),delete:m=>(P(p+bn.delete,w=>{(!(w!=null&&w.error)||(w==null?void 0:w.data))&&typeof m=="function"&&m(tt(se({},v),{value:w}))}),v)}),L=Gp.init(xe(this,Xi)),q=(p="",v={},m={},w={},E)=>{p=p.trim(),p.charAt(p.length-1)==="/"&&(p=p.slice(0,-1));let b=(()=>K(this,null,function*(){let k=()=>K(this,null,function*(){return yield L("post",y.AUTH+d.AUTH+Fl.base+p,g(v))}),x=yield k();return xe(this,vi)&&(x=yield _(x,()=>K(this,null,function*(){return yield k()}))),typeof E=="function"&&E(tt(se({},w),{value:x})),x}))();return tt(se({},w),{val:()=>b})},H=(p,v,m,w={},E={},b)=>{let k=(()=>K(this,null,function*(){let x=()=>K(this,null,function*(){return yield L(p,v,g(m),w)}),$=yield x();return xe(this,vi)&&($=yield _($,()=>K(this,null,function*(){return yield x()}))),typeof b=="function"&&b(tt(se({},E),{value:$})),$}))();return tt(se({},E),{val:()=>k})},j=p=>{let v={},m,[w={},,,]=p;if(p.length===1&&typeof w=="function"&&(m=p[0],w={}),p.length===2&&(typeof p[1]=="object"?v=p[1]:typeof p[1]=="function"&&(m=p[1])),p.length>=3){let[,E,b]=p;typeof E=="object"&&(v=E),m=b}return{data:w,onRequest:v,callback:m}},I=()=>Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),D=(p,v,m={},w,E)=>{v=v.replace(/\/\//g,"/");let b=(()=>K(this,null,function*(){var k,x,$,S,T,R,N,z,F,ne,te,pe,oe,re,ue,Ne,ye,It,Ce,He,Cr,Nr,Br;let Lr="/transaction",ge,Dr,ze={error:{message:"We could not execute the "+p+" method for path: "+v}};switch(p){case"create":yield($=(x=(k=xe(this,zt))==null?void 0:k.ref(v))==null?void 0:x.set(m))==null?void 0:$.catch(Ie=>ze);break;case"update":yield(R=(T=(S=xe(this,zt))==null?void 0:S.ref(v))==null?void 0:T.update(m))==null?void 0:R.catch(Ie=>ze);break;case"query":let we=(N=xe(this,zt))==null?void 0:N.query(v);Array.isArray(m==null?void 0:m.where)&&(yield Promise.all(m==null?void 0:m.where.map(Ie=>K(this,null,function*(){return yield new Promise(ht=>{we==null||we.filter(...Ie),ht()})})))),m!=null&&m.take&&(we==null||we.take(m==null?void 0:m.take)),m!=null&&m.skip&&(we==null||we.take(m==null?void 0:m.skip)),m!=null&&m.order&&Array.isArray(m==null?void 0:m.order)&&(yield Promise.all(m==null?void 0:m.order.map(Ie=>K(this,null,function*(){return yield new Promise(ht=>{we==null||we.sort(...Ie),ht()})})))),Dr=yield we==null?void 0:we.count(),ge=yield(z=we==null?void 0:we.get(se({},m==null?void 0:m.$option)))==null?void 0:z.catch(Ie=>ze);break;case"delete":ge=yield(te=(ne=(F=xe(this,zt))==null?void 0:F.ref(v))==null?void 0:ne.get())==null?void 0:te.catch(Ie=>ze),yield(re=(oe=(pe=xe(this,zt))==null?void 0:pe.ref(v))==null?void 0:oe.remove())==null?void 0:re.catch(Ie=>ze);break}if(p!=="delete"&&p!=="query"&&(ge=yield(ye=(Ne=(ue=xe(this,zt))==null?void 0:ue.ref(v))==null?void 0:Ne.get(se({},m==null?void 0:m.$option)))==null?void 0:ye.catch(we=>ze)),p==="query"?ge.exists()?(ge=ge==null?void 0:ge.getValues(),ge={data:ge,max:Dr,take:m==null?void 0:m.take,skip:m==null?void 0:m.skip}):ge=se({},ze):ge.exists()?(ge=ge==null?void 0:ge.val(),ge={data:ge}):ge=se({},ze),xe(this,rr)&&w.auth().$currentUserId&&!xe(this,Wt)&&["create","delete","update"].includes(p)&&ge!=null&&ge.data){let we=yield(He=(Ce=(It=xe(this,zt))==null?void 0:It.ref(Lr))==null?void 0:Ce.get())==null?void 0:He.catch(_o=>ze);we.exists()?we=we.val():we={};let Ie,ht=Object.keys(we);switch(ht.length>0?Ie=ht.length+1:Ie=0,p){case"create":p="post";break;case"update":p="put";break;case"delete":p="delete";break}p!=="get"&&(yield(Br=(Nr=(Cr=xe(this,zt))==null?void 0:Cr.ref(Lr+"/"+Ie))==null?void 0:Nr.set({path:v,method:p,uid:Ie,value:ge.data}))==null?void 0:Br.catch(_o=>ze))}const Eo=xe(this,Mo);let qn=(d==null?void 0:d.DATABASE)+Eo+v+"/"+p;return qn=qn.replace(/\/\//g,"/"),xe(this,Ta).emit(qn,ge),typeof E=="function"&&E(tt(se({},w),{value:ge})),ge}))();return tt(se({},w),{val:()=>b})},M=(p,v)=>{typeof p=="function"&&(v==null||v.on("connect",p))},U=(p,v)=>{let m="%"+p,w=this.init(o);return delete w.auth().login,delete w.auth().register,{private:(E=I())=>w.event(p+E),child:E=>w.event(p+E),emit:(E,b)=>(v==null||v.emit(m,E),typeof b=="function"&&w.event(p).do(b),se(se({},w.event(p)),w)),do:E=>(v==null||v.on(m,b=>{typeof E=="function"&&E(tt(se(se({},w.event(p)),w),{value:b}))}),se(se({},w.event(p)),w)),onAny:E=>{v==null||v.onAny((b,k)=>{typeof E=="function"&&E(b,se(se({value:k},w.event(b)),w))})}}},O=(p,v,m)=>tt(se({},p),{$io:m,connected:()=>m==null?void 0:m.connected,event:w=>U(w,m),ready:w=>M(w,m),ref:(w="")=>p.ref(w,v,m)});return{$connected:xe(this,Wt),activity:()=>{let p=this.init(o);return{onStart:v=>(typeof v=="function"&&document.addEventListener("DOMContentLoaded",v),se(se({},p),p.activity())),onCreate:v=>(typeof v=="function"&&(window.onload=v),se(se({},p),p.activity())),onPause:v=>(window.addEventListener("beforeunload",function(m){typeof v=="function"&&v(),m.returnValue="onbeforeunload"}),se(se({},p),p.activity())),onResume:()=>se(se({},p),p.activity()),onLeave:v=>(typeof v=="function"&&(window.onunload=v),se(se({},p),p.activity()))}},socket:{database:(u=o==null?void 0:o.socket)==null?void 0:u.database},$randomUID:()=>Il(),$randomId:()=>I(),$axios:Gp,local:(p={})=>{const v=this.init(o);return delete v.local,delete v.auth().register,delete v.auth().login,{database:(m="/database")=>({ref:(w="/database")=>{let E=this.init(o);return delete E.auth().login,delete E.auth().register,w=w.trim(),w=w.replace(/\/\//g,"/"),m=m+"/"+w,m=m.replace(/\/\//g,"/"),w.charAt(w.length-1)==="/"&&(w=w.slice(0,-1)),{child:(b="")=>{var k,x;return b=b.trim(),b=b.replace(/\/\//g,"/"),b.charAt(b.length-1)==="/"&&(b=b.slice(0,-1)),b.charAt(0)!=="/"&&(b="/"+b),(x=(k=E.local())==null?void 0:k.database())==null?void 0:x.ref(w+b)},push:(...b)=>{var k,x;let $=Il();return!b.length>0?{getKey:()=>$}:(x=(k=E.local())==null?void 0:k.database())==null?void 0:x.ref(w+"/"+$).create(b)},create:(...b)=>{var k,x;let $=se(se({},(x=(k=E.local(p))==null?void 0:k.database())==null?void 0:x.ref(w)),E),{data:S,callback:T}=j(b);return D(p,"create",m,S,$)},get:(...b)=>{var k,x;let $=se(se({},(x=(k=E.local())==null?void 0:k.database())==null?void 0:x.ref(w)),E),{data:S,callback:T}=j(b);return D("get",m,S,$,T)},find:(...b)=>{var k,x;let $=se(se({},(x=(k=E.local())==null?void 0:k.database())==null?void 0:x.ref(w)),E),{data:S,callback:T}=j(b);return D("get",m,S,$,T)},query:()=>{},update:(...b)=>{var k,x;let $=se(se({},(x=(k=E.local())==null?void 0:k.database())==null?void 0:x.ref(w)),E),{data:S,callback:T}=j(b);return D("update",m,S,$,T)},delete:(...b)=>{var k,x;let $=se(se({},(x=(k=E.local())==null?void 0:k.database())==null?void 0:x.ref(w)),E),{data:S,callback:T}=j(b);return D("delete",m,S,$,T)},on:()=>{var b,k;let x=se(se({},(k=(b=E.local())==null?void 0:b.database())==null?void 0:k.ref(w)),E);return C(w,x)},onValue:b=>{var k,x,$,S,T,R,N;let z=se(se({},(x=(k=E.local())==null?void 0:k.database())==null?void 0:x.ref(w)),E),F=(S=($=E.local())==null?void 0:$.database())==null?void 0:S.ref(w);return(T=F==null?void 0:F.on())==null||T.create(b),(R=F==null?void 0:F.on())==null||R.update(b),(N=F==null?void 0:F.on())==null||N.delete(b),z}}}}),cache:(m="/cache")=>{var w;let E=this.init(o);return delete E.auth().login,delete E.auth().register,(w=E.local())==null?void 0:w.database(m)},storage:()=>({})}},database:()=>{var p,v,m;const w=this.init(o);return delete w.database,delete w.auth().register,delete w.auth().login,(p=o==null?void 0:o.socket)==null||p.database.on("connect",()=>{Qn(this,Wt,!0),f()}),(v=o==null?void 0:o.socket)==null||v.database.on("disconnect",()=>{Qn(this,Wt,!1)}),O(w,{host:y.DATABASE,version:d.DATABASE,base:py.base},(m=o==null?void 0:o.socket)==null?void 0:m.database)},cron:p=>{},task:p=>{},$online:navigator==null?void 0:navigator.onLine,auth:()=>({req:(p,v,m)=>{let w=this.init(o);delete w.auth().login,delete w.auth().register;let E=se(se({},w),w.auth());return q(p+Fl.req,v,null,E,m)}}),syncDatabase:(p=!0)=>{const v=this.init(o);return Qn(this,rr,typeof p=="boolean"?p:!0),v.database()},ref:(p="",v={host:y.DATABASE,version:d.DATABASE,base:py.base},m=(E=>(E=o==null?void 0:o.socket)==null?void 0:E.database)(),w=!0)=>{p=p.trim(),p=p.replace(/\/\//g,"/"),p.charAt(0)==="/"&&p.length<=1&&(p="/root"),p.charAt(p.length-1)==="/"&&(p=p.slice(0,-1));const E=v.host+v.version+v.base+p;let b=this.init(o);return delete b.auth().login,delete b.auth().register,Qn(this,vi,w),{push:(...k)=>{let x=Il();return!k.length>0?{getKey:()=>x}:b.ref(p+"/"+x,v,m).create(k)},private:(k=I())=>b.ref(p+"/ps"+k+"/pe",v,m),setAuthAccess:(k=!0,x=xe(this,Gi))=>(Qn(this,Gi,x),b.ref(p,v,m,k)),req:(...k)=>{let x=se(se({},b.ref(p,v,m)),b);if(k.length>=2){let[$="post",S={},T={},R]=k;if(typeof $=="string"&&["post","put","delete","get"].includes($)){let N=Bt.req;return H($,E+N,S,T,x,R)}return x}else{let $=k.filter(S=>typeof S=="function");if($.length>0)$=$[0],typeof $=="function"&&$(x);else return x}},child:(k="")=>(k=k.trim(),k=k.replace(/\/\//g,"/"),k.charAt(k.length-1)==="/"&&(k=k.slice(0,-1)),k.charAt(0)!=="/"&&(k="/"+k),b.ref(p+k,v,m)),set:(...k)=>{var x;return(x=b.ref(p,v,m))==null?void 0:x.create(...k)},create:(...k)=>{var x,$,S,T;let R=se(se({},b.ref(p,v,m)),b);if(b.auth().$currentUserId&&(v==null?void 0:v.host)===(y==null?void 0:y.DATABASE)&&xe(this,rr)&&!xe(this,Wt))return(S=($=(x=b.local())==null?void 0:x.database())==null?void 0:$.ref(p))==null?void 0:S.create(...k);{let{data:N,onRequest:z,callback:F}=j(k),ne=Bt.create.one;if(xe(this,nr)){if((N==null?void 0:N.file)||(N==null?void 0:N.directory))return(T=b.ref(p))==null?void 0:T.upload(N,null,F);Array.isArray(N.folders)&&(ne=Bt.create.many)}else Array!=null&&Array.isArray(N)&&(ne=Bt.create.many);return H("post",E+ne,N,z,R,F)}},find:(...k)=>{var x,$,S,T;if(console.log("Database connected: ",xe(this,Wt)),b.auth().$currentUserId&&(v==null?void 0:v.host)===(y==null?void 0:y.DATABASE)&&xe(this,rr)&&!xe(this,Wt))return h==="dev"&&console.log("Find: We are offline"),(S=($=(x=b.local())==null?void 0:x.database())==null?void 0:$.ref(p))==null?void 0:S.find(...k);{h==="dev"&&console.log("Find: We are online");let R=se(se({},b.ref(p,v,m)),b),{data:N,onRequest:z,callback:F}=j(k),ne=Bt.find.one;return xe(this,nr)?(Array.isArray(N==null?void 0:N.files)||Array.isArray(N==null?void 0:N.folders))&&(Array.isArray(N==null?void 0:N.files)&&(N.isFolder=!1),Array.isArray(N==null?void 0:N.folders)&&(N.isFolder=!0),ne=Bt.find.many):(((T=Object.keys(N))==null?void 0:T.length)<=0||N.order||N.where||N.$option||N.skip||N.take)&&(ne=Bt.find.many),H("post",E+ne,N,z,R,F)}},get:(...k)=>{var x,$,S,T;if(b.auth().$currentUserId&&(v==null?void 0:v.host)===(y==null?void 0:y.DATABASE)&&xe(this,rr)&&!xe(this,Wt))return(S=($=(x=b.local())==null?void 0:x.database())==null?void 0:$.ref(p))==null?void 0:S.get(...k);{let R=se(se({},b.ref(p,v,m)),b),{data:N,onRequest:z,callback:F}=j(k),ne=Bt.get.one;return xe(this,nr)?(Array.isArray(N==null?void 0:N.files)||Array.isArray(N==null?void 0:N.folders))&&(Array.isArray(N==null?void 0:N.files)&&(N.isFolder=!1),Array.isArray(N==null?void 0:N.folders)&&(N.isFolder=!0),ne=Bt.get.many):(((T=Object.keys(N))==null?void 0:T.length)<=0||N.order||N.where||N.$option||N.skip||N.take)&&(ne=Bt.get.many),H("get",E+ne+"?query="+JSON.stringify(g(N)),null,z,R,F)}},query:(...k)=>{var x,$,S;if(b.auth().$currentUserId&&(v==null?void 0:v.host)===(y==null?void 0:y.DATABASE)&&xe(this,rr)&&!xe(this,Wt))return(S=($=(x=b.local())==null?void 0:x.database())==null?void 0:$.ref(p))==null?void 0:S.query(...k);{let T=se(se({},b.ref(p,v,m)),b),{data:R,onRequest:N,callback:z}=j(k);return(!R||R==="")&&(R={take:15},!xe(this,Fo)&&!R.order&&(R.order={uid:"ASC"})),H("get",E+Bt.get.many+"?query="+JSON.stringify(g(R)),null,N,T,z)}},update:(...k)=>{var x,$,S;if(b.auth().$currentUserId&&(v==null?void 0:v.host)===(y==null?void 0:y.DATABASE)&&xe(this,rr)&&!xe(this,Wt))return(S=($=(x=b.local())==null?void 0:x.database())==null?void 0:$.ref(p))==null?void 0:S.update(...k);{let T=se(se({},b.ref(p,v,m)),b),{data:R,onRequest:N,callback:z}=j(k),F=Bt.update.one;return xe(this,nr)?(Array.isArray(R==null?void 0:R.files)||Array.isArray(R==null?void 0:R.folders))&&(Array.isArray(R==null?void 0:R.files)&&(R.isFolder=!1),Array.isArray(R==null?void 0:R.folders)&&(R.isFolder=!0),F=Bt.update.many):Array.isArray(R)&&(F=Bt.find.many),H("put",E+F,R,N,T,z)}},delete:(...k)=>{var x,$,S;if(b.auth().$currentUserId&&(v==null?void 0:v.host)===(y==null?void 0:y.DATABASE)&&xe(this,rr)&&!xe(this,Wt))return(S=($=(x=b.local())==null?void 0:x.database())==null?void 0:$.ref(p))==null?void 0:S.delete(...k);{let T=se(se({},b.ref(p,v,m)),b),{data:R,onRequest:N,callback:z}=j(k),F=Bt.delete.one;return xe(this,nr)?(Array.isArray(R==null?void 0:R.files)||Array.isArray(R==null?void 0:R.folders))&&(Array.isArray(R==null?void 0:R.files)&&(R.isFolder=!1),Array.isArray(R==null?void 0:R.folders)&&(R.isFolder=!0),Object.keys(R).length<=0&&(R.isFolder=!0),F=Bt.delete.many):(Array.isArray(R)||R.where)&&(F=Bt.delete.many),H("delete",E+F,R,N,T,z)}},on:()=>{let k=se(se({},b.ref(p,v,m)),b);return B(m,v,k,p)},onValue:k=>{let x=se(se({},b.ref(p,v,m)),b),$=b.ref(p,v,m);return $==null||$.on().create(k),$==null||$.on().update(k),$==null||$.on().delete(k),$==null||$.on().upload(k),x}}}}}),Qn(this,Xi,e);let{ENV:t,OFFLINE_DB_NAME:r}=xe(this,Xi);Qn(this,zt,As.WithIndexedDB((r==null?void 0:r.DATABASE)||"swyger_database"));let i=()=>K(this,null,function*(){try{let o,s=localStorage.getItem("accessToken");if((()=>{var a;try{o=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");let c=bS(s);return(Date==null?void 0:Date.parse((a=new Date((c==null?void 0:c.exp)*1e3))==null?void 0:a.toString()))<Date.now()}catch(c){return!1}})()&&o.uid)try{t==="dev"&&console.log("Token expired on inactivity, Trying to request a new refresh token")}catch(a){}}catch(o){}});"requestIdleCallback"in window&&requestIdleCallback(i)}}Mo=new WeakMap,vi=new WeakMap,Gi=new WeakMap,Fo=new WeakMap,nr=new WeakMap,Ab=new WeakMap,eh=new WeakMap,th=new WeakMap,Ta=new WeakMap,rr=new WeakMap,Wt=new WeakMap,Xi=new WeakMap,zt=new WeakMap;const oj={init:n=>{try{return(e={})=>new ij(n).init(e)}catch(e){return{}}}};let sj={init:n=>{var e,t,r,i,o;return{OFFLINE_DB_NAME:{DATABASE:((e=n==null?void 0:n.OFFLINE_DB_NAME)==null?void 0:e.DATABASE)||"swyger_database"},ENV:(n==null?void 0:n.ENV)||"prod",HOST_SERVER:{AUTH:((t=n==null?void 0:n.HOST_SERVER)==null?void 0:t.AUTH)||"http://localhost:4100",DATABASE:((r=n==null?void 0:n.HOST_SERVER)==null?void 0:r.DATABASE)||"http://localhost:4400"},API_VERSION:{AUTH:((i=n==null?void 0:n.API_VERSION)==null?void 0:i.AUTH)||"/api/v1",DATABASE:((o=n==null?void 0:n.API_VERSION)==null?void 0:o.DATABASE)||"/api/v1"},AUTO_REFRESH_TOKEN_TIMEOUT:(n==null?void 0:n.AUTO_REFRESH_TOKEN_TIMEOUT)||15e5,API_KEY:(n==null?void 0:n.API_KEY)||"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJzd3lnZXIuY29tIiwiaWF0IjoxNjUzNDQwOTkxLCJleHAiOjE2ODQ5NzY5OTEsImF1ZCI6ImRheW52ZXIuY29tIiwic3ViIjoidGVhbUBzd3lnZXIuY29tIiwiR2l2ZW5OYW1lIjoiSXZhbiBKb2VsIiwiU3VybmFtZSI6IlNvYmd1aSIsIkVtYWlsIjoidGVhbUBhZ2dsb215LmNvbSIsIlJvbGUiOlsiQWRtaW4iLCJQcm9qZWN0IEFkbWluaXN0cmF0b3IiXX0.UvlcjBahR9G8dKxIeENJ7k4I87t3_oNJQ16eyPsRcSE"}}};const aj={init:n=>{let e=sj.init(n);const t=mS.init(e),r={socket:{database:t==null?void 0:t.database}};return oj.init(e)(r)}};var nh=function(n,e){return nh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])},nh(n,e)};function bt(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");nh(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function cj(n,e,t,r){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{l(r.next(u))}catch(h){s(h)}}function c(u){try{l(r.throw(u))}catch(h){s(h)}}function l(u){u.done?o(u.value):i(u.value).then(a,c)}l((r=r.apply(n,e||[])).next())})}function Bd(n,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(l){return function(u){return c([l,u])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,l[0]&&(t=0)),t;)try{if(r=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){t.label=l[1];break}if(l[0]===6&&t.label<o[1]){t.label=o[1],o=l;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(l);break}o[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(n,t)}catch(u){l=[6,u],i=0}finally{r=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function cn(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ge(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(s)throw s.error}}return o}function Xe(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return n.concat(o||Array.prototype.slice.call(e))}function to(n){return this instanceof to?(this.v=n,this):new to(n)}function lj(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),i,o=[];return i={},s("next"),s("throw"),s("return"),i[Symbol.asyncIterator]=function(){return this},i;function s(y){r[y]&&(i[y]=function(d){return new Promise(function(f,g){o.push([y,d,f,g])>1||a(y,d)})})}function a(y,d){try{c(r[y](d))}catch(f){h(o[0][3],f)}}function c(y){y.value instanceof to?Promise.resolve(y.value.v).then(l,u):h(o[0][2],y)}function l(y){a("next",y)}function u(y){a("throw",y)}function h(y,d){y(d),o.shift(),o.length&&a(o[0][0],o[0][1])}}function uj(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof cn=="function"?cn(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(o){t[o]=n[o]&&function(s){return new Promise(function(a,c){s=n[o](s),i(a,c,s.done,s.value)})}}function i(o,s,a,c){Promise.resolve(c).then(function(l){o({value:l,done:a})},s)}}function je(n){return typeof n=="function"}function Ni(n){var e=function(r){Error.call(r),r.stack=new Error().stack},t=n(e);return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var Pa=Ni(function(n){return function(e){n(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(t,r){return r+1+") "+t.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function Or(n,e){if(n){var t=n.indexOf(e);0<=t&&n.splice(t,1)}}var fn=function(){function n(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return n.prototype.unsubscribe=function(){var e,t,r,i,o;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var a=cn(s),c=a.next();!c.done;c=a.next()){var l=c.value;l.remove(this)}}catch(g){e={error:g}}finally{try{c&&!c.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}else s.remove(this);var u=this.initialTeardown;if(je(u))try{u()}catch(g){o=g instanceof Pa?g.errors:[g]}var h=this._finalizers;if(h){this._finalizers=null;try{for(var y=cn(h),d=y.next();!d.done;d=y.next()){var f=d.value;try{yy(f)}catch(g){o=o!=null?o:[],g instanceof Pa?o=Xe(Xe([],Ge(o)),Ge(g.errors)):o.push(g)}}}catch(g){r={error:g}}finally{try{d&&!d.done&&(i=y.return)&&i.call(y)}finally{if(r)throw r.error}}}if(o)throw new Pa(o)}},n.prototype.add=function(e){var t;if(e&&e!==this)if(this.closed)yy(e);else{if(e instanceof n){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}},n.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},n.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},n.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&Or(t,e)},n.prototype.remove=function(e){var t=this._finalizers;t&&Or(t,e),e instanceof n&&e._removeParent(this)},n.EMPTY=function(){var e=new n;return e.closed=!0,e}(),n}(),Sb=fn.EMPTY;function Tb(n){return n instanceof fn||n&&"closed"in n&&je(n.remove)&&je(n.add)&&je(n.unsubscribe)}function yy(n){je(n)?n():n.unsubscribe()}var di={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Ld={setTimeout:function(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];var i=Ld.delegate;return i!=null&&i.setTimeout?i.setTimeout.apply(i,Xe([n,e],Ge(t))):setTimeout.apply(void 0,Xe([n,e],Ge(t)))},clearTimeout:function(n){return clearTimeout(n)},delegate:void 0};function Pb(n){Ld.setTimeout(function(){var e=di.onUnhandledError;if(e)e(n);else throw n})}function gt(){}var hj=function(){return Dd("C",void 0,void 0)}();function dj(n){return Dd("E",void 0,n)}function fj(n){return Dd("N",n,void 0)}function Dd(n,e,t){return{kind:n,value:e,error:t}}var _i=null;function ja(n){if(di.useDeprecatedSynchronousErrorHandling){var e=!_i;if(e&&(_i={errorThrown:!1,error:null}),n(),e){var t=_i,r=t.errorThrown,i=t.error;if(_i=null,r)throw i}}else n()}function pj(n){di.useDeprecatedSynchronousErrorHandling&&_i&&(_i.errorThrown=!0,_i.error=n)}var Bc=function(n){bt(e,n);function e(t){var r=n.call(this)||this;return r.isStopped=!1,t?(r.destination=t,Tb(t)&&t.add(r)):r.destination=vj,r}return e.create=function(t,r,i){return new lo(t,r,i)},e.prototype.next=function(t){this.isStopped?Kl(fj(t),this):this._next(t)},e.prototype.error=function(t){this.isStopped?Kl(dj(t),this):(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped?Kl(hj,this):(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,n.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(fn),yj=Function.prototype.bind;function Vl(n,e){return yj.call(n,e)}var gj=function(){function n(e){this.partialObserver=e}return n.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(r){Qs(r)}},n.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(r){Qs(r)}else Qs(e)},n.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(t){Qs(t)}},n}(),lo=function(n){bt(e,n);function e(t,r,i){var o=n.call(this)||this,s;if(je(t)||!t)s={next:t!=null?t:void 0,error:r!=null?r:void 0,complete:i!=null?i:void 0};else{var a;o&&di.useDeprecatedNextContext?(a=Object.create(t),a.unsubscribe=function(){return o.unsubscribe()},s={next:t.next&&Vl(t.next,a),error:t.error&&Vl(t.error,a),complete:t.complete&&Vl(t.complete,a)}):s=t}return o.destination=new gj(s),o}return e}(Bc);function Qs(n){di.useDeprecatedSynchronousErrorHandling?pj(n):Pb(n)}function mj(n){throw n}function Kl(n,e){var t=di.onStoppedNotification;t&&Ld.setTimeout(function(){return t(n,e)})}var vj={closed:!0,next:gt,error:mj,complete:gt},Lc=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function jt(n){return n}function qd(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return jb(n)}function jb(n){return n.length===0?jt:n.length===1?n[0]:function(e){return n.reduce(function(t,r){return r(t)},e)}}var Me=function(){function n(e){e&&(this._subscribe=e)}return n.prototype.lift=function(e){var t=new n;return t.source=this,t.operator=e,t},n.prototype.subscribe=function(e,t,r){var i=this,o=wj(e)?e:new lo(e,t,r);return ja(function(){var s=i,a=s.operator,c=s.source;o.add(a?a.call(o,c):c?i._subscribe(o):i._trySubscribe(o))}),o},n.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},n.prototype.forEach=function(e,t){var r=this;return t=gy(t),new t(function(i,o){var s=new lo({next:function(a){try{e(a)}catch(c){o(c),s.unsubscribe()}},error:o,complete:i});r.subscribe(s)})},n.prototype._subscribe=function(e){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(e)},n.prototype[Lc]=function(){return this},n.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return jb(e)(this)},n.prototype.toPromise=function(e){var t=this;return e=gy(e),new e(function(r,i){var o;t.subscribe(function(s){return o=s},function(s){return i(s)},function(){return r(o)})})},n.create=function(e){return new n(e)},n}();function gy(n){var e;return(e=n!=null?n:di.Promise)!==null&&e!==void 0?e:Promise}function bj(n){return n&&je(n.next)&&je(n.error)&&je(n.complete)}function wj(n){return n&&n instanceof Bc||bj(n)&&Tb(n)}function Rb(n){return je(n==null?void 0:n.lift)}function ve(n){return function(e){if(Rb(e))return e.lift(function(t){try{return n(t,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function de(n,e,t,r,i){return new Ud(n,e,t,r,i)}var Ud=function(n){bt(e,n);function e(t,r,i,o,s,a){var c=n.call(this,t)||this;return c.onFinalize=s,c.shouldUnsubscribe=a,c._next=r?function(l){try{r(l)}catch(u){t.error(u)}}:n.prototype._next,c._error=o?function(l){try{o(l)}catch(u){t.error(u)}finally{this.unsubscribe()}}:n.prototype._error,c._complete=i?function(){try{i()}catch(l){t.error(l)}finally{this.unsubscribe()}}:n.prototype._complete,c}return e.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;n.prototype.unsubscribe.call(this),!r&&((t=this.onFinalize)===null||t===void 0||t.call(this))}},e}(Bc);function Ib(){return ve(function(n,e){var t=null;n._refCount++;var r=de(e,void 0,void 0,void 0,function(){if(!n||n._refCount<=0||0<--n._refCount){t=null;return}var i=n._connection,o=t;t=null,i&&(!o||i===o)&&i.unsubscribe(),e.unsubscribe()});n.subscribe(r),r.closed||(t=n.connect())})}var Dc=function(n){bt(e,n);function e(t,r){var i=n.call(this)||this;return i.source=t,i.subjectFactory=r,i._subject=null,i._refCount=0,i._connection=null,Rb(t)&&(i.lift=t.lift),i}return e.prototype._subscribe=function(t){return this.getSubject().subscribe(t)},e.prototype.getSubject=function(){var t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject},e.prototype._teardown=function(){this._refCount=0;var t=this._connection;this._subject=this._connection=null,t==null||t.unsubscribe()},e.prototype.connect=function(){var t=this,r=this._connection;if(!r){r=this._connection=new fn;var i=this.getSubject();r.add(this.source.subscribe(de(i,void 0,function(){t._teardown(),i.complete()},function(o){t._teardown(),i.error(o)},function(){return t._teardown()}))),r.closed&&(this._connection=null,r=fn.EMPTY)}return r},e.prototype.refCount=function(){return Ib()(this)},e}(Me),Cb={now:function(){return(Cb.delegate||performance).now()},delegate:void 0},ss={schedule:function(n){var e=requestAnimationFrame,t=cancelAnimationFrame,r=e(function(i){t=void 0,n(i)});return new fn(function(){return t==null?void 0:t(r)})},requestAnimationFrame:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=ss.delegate;return((t==null?void 0:t.requestAnimationFrame)||requestAnimationFrame).apply(void 0,Xe([],Ge(n)))},cancelAnimationFrame:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return cancelAnimationFrame.apply(void 0,Xe([],Ge(n)))},delegate:void 0};function kj(n){return n?Nb(n):xj}function Nb(n){return new Me(function(e){var t=n||Cb,r=t.now(),i=0,o=function(){e.closed||(i=ss.requestAnimationFrame(function(s){i=0;var a=t.now();e.next({timestamp:n?a:s,elapsed:a-r}),o()}))};return o(),function(){i&&ss.cancelAnimationFrame(i)}})}var xj=Nb(),Bb=Ni(function(n){return function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),_t=function(n){bt(e,n);function e(){var t=n.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return e.prototype.lift=function(t){var r=new my(this,this);return r.operator=t,r},e.prototype._throwIfClosed=function(){if(this.closed)throw new Bb},e.prototype.next=function(t){var r=this;ja(function(){var i,o;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var s=cn(r.currentObservers),a=s.next();!a.done;a=s.next()){var c=a.value;c.next(t)}}catch(l){i={error:l}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}}})},e.prototype.error=function(t){var r=this;ja(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=t;for(var i=r.observers;i.length;)i.shift().error(t)}})},e.prototype.complete=function(){var t=this;ja(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var r=t.observers;r.length;)r.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(t){return this._throwIfClosed(),n.prototype._trySubscribe.call(this,t)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var r=this,i=this,o=i.hasError,s=i.isStopped,a=i.observers;return o||s?Sb:(this.currentObservers=null,a.push(t),new fn(function(){r.currentObservers=null,Or(a,t)}))},e.prototype._checkFinalizedStatuses=function(t){var r=this,i=r.hasError,o=r.thrownError,s=r.isStopped;i?t.error(o):s&&t.complete()},e.prototype.asObservable=function(){var t=new Me;return t.source=this,t},e.create=function(t,r){return new my(t,r)},e}(Me),my=function(n){bt(e,n);function e(t,r){var i=n.call(this)||this;return i.destination=t,i.source=r,i}return e.prototype.next=function(t){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.next)===null||i===void 0||i.call(r,t)},e.prototype.error=function(t){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.error)===null||i===void 0||i.call(r,t)},e.prototype.complete=function(){var t,r;(r=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||r===void 0||r.call(t)},e.prototype._subscribe=function(t){var r,i;return(i=(r=this.source)===null||r===void 0?void 0:r.subscribe(t))!==null&&i!==void 0?i:Sb},e}(_t),Lb=function(n){bt(e,n);function e(t){var r=n.call(this)||this;return r._value=t,r}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(t){var r=n.prototype._subscribe.call(this,t);return!r.closed&&t.next(this._value),r},e.prototype.getValue=function(){var t=this,r=t.hasError,i=t.thrownError,o=t._value;if(r)throw i;return this._throwIfClosed(),o},e.prototype.next=function(t){n.prototype.next.call(this,this._value=t)},e}(_t),qc={now:function(){return(qc.delegate||Date).now()},delegate:void 0},Md=function(n){bt(e,n);function e(t,r,i){t===void 0&&(t=1/0),r===void 0&&(r=1/0),i===void 0&&(i=qc);var o=n.call(this)||this;return o._bufferSize=t,o._windowTime=r,o._timestampProvider=i,o._buffer=[],o._infiniteTimeWindow=!0,o._infiniteTimeWindow=r===1/0,o._bufferSize=Math.max(1,t),o._windowTime=Math.max(1,r),o}return e.prototype.next=function(t){var r=this,i=r.isStopped,o=r._buffer,s=r._infiniteTimeWindow,a=r._timestampProvider,c=r._windowTime;i||(o.push(t),!s&&o.push(a.now()+c)),this._trimBuffer(),n.prototype.next.call(this,t)},e.prototype._subscribe=function(t){this._throwIfClosed(),this._trimBuffer();for(var r=this._innerSubscribe(t),i=this,o=i._infiniteTimeWindow,s=i._buffer,a=s.slice(),c=0;c<a.length&&!t.closed;c+=o?1:2)t.next(a[c]);return this._checkFinalizedStatuses(t),r},e.prototype._trimBuffer=function(){var t=this,r=t._bufferSize,i=t._timestampProvider,o=t._buffer,s=t._infiniteTimeWindow,a=(s?1:2)*r;if(r<1/0&&a<o.length&&o.splice(0,o.length-a),!s){for(var c=i.now(),l=0,u=1;u<o.length&&o[u]<=c;u+=2)l=u;l&&o.splice(0,l+1)}},e}(_t),Fd=function(n){bt(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t._value=null,t._hasValue=!1,t._isComplete=!1,t}return e.prototype._checkFinalizedStatuses=function(t){var r=this,i=r.hasError,o=r._hasValue,s=r._value,a=r.thrownError,c=r.isStopped,l=r._isComplete;i?t.error(a):(c||l)&&(o&&t.next(s),t.complete())},e.prototype.next=function(t){this.isStopped||(this._value=t,this._hasValue=!0)},e.prototype.complete=function(){var t=this,r=t._hasValue,i=t._value,o=t._isComplete;o||(this._isComplete=!0,r&&n.prototype.next.call(this,i),n.prototype.complete.call(this))},e}(_t),Ej=function(n){bt(e,n);function e(t,r){return n.call(this)||this}return e.prototype.schedule=function(t,r){return this},e}(fn),rh={setInterval:function(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];var i=rh.delegate;return i!=null&&i.setInterval?i.setInterval.apply(i,Xe([n,e],Ge(t))):setInterval.apply(void 0,Xe([n,e],Ge(t)))},clearInterval:function(n){return clearInterval(n)},delegate:void 0},Ss=function(n){bt(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.scheduler=t,i.work=r,i.pending=!1,i}return e.prototype.schedule=function(t,r){var i;if(r===void 0&&(r=0),this.closed)return this;this.state=t;var o=this.id,s=this.scheduler;return o!=null&&(this.id=this.recycleAsyncId(s,o,r)),this.pending=!0,this.delay=r,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(s,this.id,r),this},e.prototype.requestAsyncId=function(t,r,i){return i===void 0&&(i=0),rh.setInterval(t.flush.bind(t,this),i)},e.prototype.recycleAsyncId=function(t,r,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return r;r!=null&&rh.clearInterval(r)},e.prototype.execute=function(t,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(t,r);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,r){var i=!1,o;try{this.work(t)}catch(s){i=!0,o=s||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),o},e.prototype.unsubscribe=function(){if(!this.closed){var t=this,r=t.id,i=t.scheduler,o=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,Or(o,this),r!=null&&(this.id=this.recycleAsyncId(i,r,null)),this.delay=null,n.prototype.unsubscribe.call(this)}},e}(Ej),_j=1,Wl,ih={};function vy(n){return n in ih?(delete ih[n],!0):!1}var Db={setImmediate:function(n){var e=_j++;return ih[e]=!0,Wl||(Wl=Promise.resolve()),Wl.then(function(){return vy(e)&&n()}),e},clearImmediate:function(n){vy(n)}},$j=Db.setImmediate,Oj=Db.clearImmediate,oh={setImmediate:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=oh.delegate;return((t==null?void 0:t.setImmediate)||$j).apply(void 0,Xe([],Ge(n)))},clearImmediate:function(n){return Oj(n)},delegate:void 0},Aj=function(n){bt(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.scheduler=t,i.work=r,i}return e.prototype.requestAsyncId=function(t,r,i){return i===void 0&&(i=0),i!==null&&i>0?n.prototype.requestAsyncId.call(this,t,r,i):(t.actions.push(this),t._scheduled||(t._scheduled=oh.setImmediate(t.flush.bind(t,void 0))))},e.prototype.recycleAsyncId=function(t,r,i){var o;if(i===void 0&&(i=0),i!=null?i>0:this.delay>0)return n.prototype.recycleAsyncId.call(this,t,r,i);var s=t.actions;r!=null&&((o=s[s.length-1])===null||o===void 0?void 0:o.id)!==r&&(oh.clearImmediate(r),t._scheduled===r&&(t._scheduled=void 0))},e}(Ss),sh=function(){function n(e,t){t===void 0&&(t=n.now),this.schedulerActionCtor=e,this.now=t}return n.prototype.schedule=function(e,t,r){return t===void 0&&(t=0),new this.schedulerActionCtor(this,e).schedule(r,t)},n.now=qc.now,n}(),Ts=function(n){bt(e,n);function e(t,r){r===void 0&&(r=sh.now);var i=n.call(this,t,r)||this;return i.actions=[],i._active=!1,i}return e.prototype.flush=function(t){var r=this.actions;if(this._active){r.push(t);return}var i;this._active=!0;do if(i=t.execute(t.state,t.delay))break;while(t=r.shift());if(this._active=!1,i){for(;t=r.shift();)t.unsubscribe();throw i}},e}(sh),Sj=function(n){bt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.flush=function(t){this._active=!0;var r=this._scheduled;this._scheduled=void 0;var i=this.actions,o;t=t||i.shift();do if(o=t.execute(t.state,t.delay))break;while((t=i[0])&&t.id===r&&i.shift());if(this._active=!1,o){for(;(t=i[0])&&t.id===r&&i.shift();)t.unsubscribe();throw o}},e}(Ts),qb=new Sj(Aj),Tj=qb,Ln=new Ts(Ss),Vd=Ln,Pj=function(n){bt(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.scheduler=t,i.work=r,i}return e.prototype.schedule=function(t,r){return r===void 0&&(r=0),r>0?n.prototype.schedule.call(this,t,r):(this.delay=r,this.state=t,this.scheduler.flush(this),this)},e.prototype.execute=function(t,r){return r>0||this.closed?n.prototype.execute.call(this,t,r):this._execute(t,r)},e.prototype.requestAsyncId=function(t,r,i){return i===void 0&&(i=0),i!=null&&i>0||i==null&&this.delay>0?n.prototype.requestAsyncId.call(this,t,r,i):(t.flush(this),0)},e}(Ss),jj=function(n){bt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e}(Ts),Ub=new jj(Pj),Rj=Ub,Ij=function(n){bt(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.scheduler=t,i.work=r,i}return e.prototype.requestAsyncId=function(t,r,i){return i===void 0&&(i=0),i!==null&&i>0?n.prototype.requestAsyncId.call(this,t,r,i):(t.actions.push(this),t._scheduled||(t._scheduled=ss.requestAnimationFrame(function(){return t.flush(void 0)})))},e.prototype.recycleAsyncId=function(t,r,i){var o;if(i===void 0&&(i=0),i!=null?i>0:this.delay>0)return n.prototype.recycleAsyncId.call(this,t,r,i);var s=t.actions;r!=null&&((o=s[s.length-1])===null||o===void 0?void 0:o.id)!==r&&(ss.cancelAnimationFrame(r),t._scheduled=void 0)},e}(Ss),Cj=function(n){bt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.flush=function(t){this._active=!0;var r=this._scheduled;this._scheduled=void 0;var i=this.actions,o;t=t||i.shift();do if(o=t.execute(t.state,t.delay))break;while((t=i[0])&&t.id===r&&i.shift());if(this._active=!1,o){for(;(t=i[0])&&t.id===r&&i.shift();)t.unsubscribe();throw o}},e}(Ts),Mb=new Cj(Ij),Nj=Mb,Bj=function(n){bt(e,n);function e(t,r){t===void 0&&(t=Fb),r===void 0&&(r=1/0);var i=n.call(this,t,function(){return i.frame})||this;return i.maxFrames=r,i.frame=0,i.index=-1,i}return e.prototype.flush=function(){for(var t=this,r=t.actions,i=t.maxFrames,o,s;(s=r[0])&&s.delay<=i&&(r.shift(),this.frame=s.delay,!(o=s.execute(s.state,s.delay))););if(o){for(;s=r.shift();)s.unsubscribe();throw o}},e.frameTimeFactor=10,e}(Ts),Fb=function(n){bt(e,n);function e(t,r,i){i===void 0&&(i=t.index+=1);var o=n.call(this,t,r)||this;return o.scheduler=t,o.work=r,o.index=i,o.active=!0,o.index=t.index=i,o}return e.prototype.schedule=function(t,r){if(r===void 0&&(r=0),Number.isFinite(r)){if(!this.id)return n.prototype.schedule.call(this,t,r);this.active=!1;var i=new e(this.scheduler,this.work);return this.add(i),i.schedule(t,r)}else return fn.EMPTY},e.prototype.requestAsyncId=function(t,r,i){i===void 0&&(i=0),this.delay=t.frame+i;var o=t.actions;return o.push(this),o.sort(e.sortActions),1},e.prototype.recycleAsyncId=function(t,r,i){},e.prototype._execute=function(t,r){if(this.active===!0)return n.prototype._execute.call(this,t,r)},e.sortActions=function(t,r){return t.delay===r.delay?t.index===r.index?0:t.index>r.index?1:-1:t.delay>r.delay?1:-1},e}(Ss),gr=new Me(function(n){return n.complete()});function Lj(n){return n?Dj(n):gr}function Dj(n){return new Me(function(e){return n.schedule(function(){return e.complete()})})}function Uc(n){return n&&je(n.schedule)}function Kd(n){return n[n.length-1]}function Ps(n){return je(Kd(n))?n.pop():void 0}function Pr(n){return Uc(Kd(n))?n.pop():void 0}function Vb(n,e){return typeof Kd(n)=="number"?n.pop():e}var Wd=function(n){return n&&typeof n.length=="number"&&typeof n!="function"};function Kb(n){return je(n==null?void 0:n.then)}function Wb(n){return je(n[Lc])}function zb(n){return Symbol.asyncIterator&&je(n==null?void 0:n[Symbol.asyncIterator])}function Hb(n){return new TypeError("You provided "+(n!==null&&typeof n=="object"?"an invalid object":"'"+n+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function qj(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Jb=qj();function Yb(n){return je(n==null?void 0:n[Jb])}function Gb(n){return lj(this,arguments,function(){var e,t,r,i;return Bd(this,function(o){switch(o.label){case 0:e=n.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,to(e.read())];case 3:return t=o.sent(),r=t.value,i=t.done,i?[4,to(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,to(r)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function Xb(n){return je(n==null?void 0:n.getReader)}function $e(n){if(n instanceof Me)return n;if(n!=null){if(Wb(n))return Uj(n);if(Wd(n))return Mj(n);if(Kb(n))return Fj(n);if(zb(n))return Zb(n);if(Yb(n))return Vj(n);if(Xb(n))return Kj(n)}throw Hb(n)}function Uj(n){return new Me(function(e){var t=n[Lc]();if(je(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Mj(n){return new Me(function(e){for(var t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}function Fj(n){return new Me(function(e){n.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,Pb)})}function Vj(n){return new Me(function(e){var t,r;try{for(var i=cn(n),o=i.next();!o.done;o=i.next()){var s=o.value;if(e.next(s),e.closed)return}}catch(a){t={error:a}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}e.complete()})}function Zb(n){return new Me(function(e){Wj(n,e).catch(function(t){return e.error(t)})})}function Kj(n){return Zb(Gb(n))}function Wj(n,e){var t,r,i,o;return cj(this,void 0,void 0,function(){var s,a;return Bd(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),t=uj(n),c.label=1;case 1:return[4,t.next()];case 2:if(r=c.sent(),!!r.done)return[3,4];if(s=r.value,e.next(s),e.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),i={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),r&&!r.done&&(o=t.return)?[4,o.call(t)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function ln(n,e,t,r,i){r===void 0&&(r=0),i===void 0&&(i=!1);var o=e.schedule(function(){t(),i?n.add(this.schedule(null,r)):this.unsubscribe()},r);if(n.add(o),!i)return o}function Mc(n,e){return e===void 0&&(e=0),ve(function(t,r){t.subscribe(de(r,function(i){return ln(r,n,function(){return r.next(i)},e)},function(){return ln(r,n,function(){return r.complete()},e)},function(i){return ln(r,n,function(){return r.error(i)},e)}))})}function Fc(n,e){return e===void 0&&(e=0),ve(function(t,r){r.add(n.schedule(function(){return t.subscribe(r)},e))})}function zj(n,e){return $e(n).pipe(Fc(e),Mc(e))}function Hj(n,e){return $e(n).pipe(Fc(e),Mc(e))}function Jj(n,e){return new Me(function(t){var r=0;return e.schedule(function(){r===n.length?t.complete():(t.next(n[r++]),t.closed||this.schedule())})})}function Qb(n,e){return new Me(function(t){var r;return ln(t,e,function(){r=n[Jb](),ln(t,e,function(){var i,o,s;try{i=r.next(),o=i.value,s=i.done}catch(a){t.error(a);return}s?t.complete():t.next(o)},0,!0)}),function(){return je(r==null?void 0:r.return)&&r.return()}})}function e0(n,e){if(!n)throw new Error("Iterable cannot be null");return new Me(function(t){ln(t,e,function(){var r=n[Symbol.asyncIterator]();ln(t,e,function(){r.next().then(function(i){i.done?t.complete():t.next(i.value)})},0,!0)})})}function Yj(n,e){return e0(Gb(n),e)}function t0(n,e){if(n!=null){if(Wb(n))return zj(n,e);if(Wd(n))return Jj(n,e);if(Kb(n))return Hj(n,e);if(zb(n))return e0(n,e);if(Yb(n))return Qb(n,e);if(Xb(n))return Yj(n,e)}throw Hb(n)}function jr(n,e){return e?t0(n,e):$e(n)}function zd(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Pr(n);return jr(n,t)}function n0(n,e){var t=je(n)?n:function(){return n},r=function(i){return i.error(t())};return new Me(e?function(i){return e.schedule(r,0,i)}:r)}var ah;(function(n){n.NEXT="N",n.ERROR="E",n.COMPLETE="C"})(ah||(ah={}));var Ra=function(){function n(e,t,r){this.kind=e,this.value=t,this.error=r,this.hasValue=e==="N"}return n.prototype.observe=function(e){return r0(this,e)},n.prototype.do=function(e,t,r){var i=this,o=i.kind,s=i.value,a=i.error;return o==="N"?e==null?void 0:e(s):o==="E"?t==null?void 0:t(a):r==null?void 0:r()},n.prototype.accept=function(e,t,r){var i;return je((i=e)===null||i===void 0?void 0:i.next)?this.observe(e):this.do(e,t,r)},n.prototype.toObservable=function(){var e=this,t=e.kind,r=e.value,i=e.error,o=t==="N"?zd(r):t==="E"?n0(function(){return i}):t==="C"?gr:0;if(!o)throw new TypeError("Unexpected notification kind "+t);return o},n.createNext=function(e){return new n("N",e)},n.createError=function(e){return new n("E",void 0,e)},n.createComplete=function(){return n.completeNotification},n.completeNotification=new n("C"),n}();function r0(n,e){var t,r,i,o=n,s=o.kind,a=o.value,c=o.error;if(typeof s!="string")throw new TypeError('Invalid notification, missing "kind"');s==="N"?(t=e.next)===null||t===void 0||t.call(e,a):s==="E"?(r=e.error)===null||r===void 0||r.call(e,c):(i=e.complete)===null||i===void 0||i.call(e)}function Gj(n){return!!n&&(n instanceof Me||je(n.lift)&&je(n.subscribe))}var Bi=Ni(function(n){return function(){n(this),this.name="EmptyError",this.message="no elements in sequence"}});function Xj(n,e){var t=typeof e=="object";return new Promise(function(r,i){var o=!1,s;n.subscribe({next:function(a){s=a,o=!0},error:i,complete:function(){o?r(s):t?r(e.defaultValue):i(new Bi)}})})}function Zj(n,e){var t=typeof e=="object";return new Promise(function(r,i){var o=new lo({next:function(s){r(s),o.unsubscribe()},error:i,complete:function(){t?r(e.defaultValue):i(new Bi)}});n.subscribe(o)})}var ch=Ni(function(n){return function(){n(this),this.name="ArgumentOutOfRangeError",this.message="argument out of range"}}),i0=Ni(function(n){return function(e){n(this),this.name="NotFoundError",this.message=e}}),o0=Ni(function(n){return function(e){n(this),this.name="SequenceError",this.message=e}});function Hd(n){return n instanceof Date&&!isNaN(n)}var s0=Ni(function(n){return function(e){e===void 0&&(e=null),n(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=e}});function a0(n,e){var t=Hd(n)?{first:n}:typeof n=="number"?{each:n}:n,r=t.first,i=t.each,o=t.with,s=o===void 0?Qj:o,a=t.scheduler,c=a===void 0?e!=null?e:Ln:a,l=t.meta,u=l===void 0?null:l;if(r==null&&i==null)throw new TypeError("No timeout provided.");return ve(function(h,y){var d,f,g=null,_=0,A=function(P){f=ln(y,c,function(){try{d.unsubscribe(),$e(s({meta:u,lastValue:g,seen:_})).subscribe(y)}catch(B){y.error(B)}},P)};d=h.subscribe(de(y,function(P){f==null||f.unsubscribe(),_++,y.next(g=P),i>0&&A(i)},void 0,void 0,function(){f!=null&&f.closed||f==null||f.unsubscribe(),g=null})),!_&&A(r!=null?typeof r=="number"?r:+r-c.now():i)})}function Qj(n){throw new s0(n)}function Li(n,e){return ve(function(t,r){var i=0;t.subscribe(de(r,function(o){r.next(n.call(e,o,i++))}))})}var eR=Array.isArray;function tR(n,e){return eR(e)?n.apply(void 0,Xe([],Ge(e))):n(e)}function Di(n){return Li(function(e){return tR(n,e)})}function nc(n,e,t,r){if(t)if(Uc(t))r=t;else return function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return nc(n,e,r).apply(this,i).pipe(Di(t))};return r?function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return nc(n,e).apply(this,i).pipe(Fc(r),Mc(r))}:function(){for(var i=this,o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];var a=new Fd,c=!0;return new Me(function(l){var u=a.subscribe(l);if(c){c=!1;var h=!1,y=!1;e.apply(i,Xe(Xe([],Ge(o)),[function(){for(var d=[],f=0;f<arguments.length;f++)d[f]=arguments[f];if(n){var g=d.shift();if(g!=null){a.error(g);return}}a.next(1<d.length?d:d[0]),y=!0,h&&a.complete()}])),y&&a.complete(),h=!0}return u})}}function nR(n,e,t){return nc(!1,n,e,t)}function rR(n,e,t){return nc(!0,n,e,t)}var iR=Array.isArray,oR=Object.getPrototypeOf,sR=Object.prototype,aR=Object.keys;function c0(n){if(n.length===1){var e=n[0];if(iR(e))return{args:e,keys:null};if(cR(e)){var t=aR(e);return{args:t.map(function(r){return e[r]}),keys:t}}}return{args:n,keys:null}}function cR(n){return n&&typeof n=="object"&&oR(n)===sR}function l0(n,e){return n.reduce(function(t,r,i){return t[r]=e[i],t},{})}function u0(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Pr(n),r=Ps(n),i=c0(n),o=i.args,s=i.keys;if(o.length===0)return jr([],t);var a=new Me(h0(o,t,s?function(c){return l0(s,c)}:jt));return r?a.pipe(Di(r)):a}function h0(n,e,t){return t===void 0&&(t=jt),function(r){by(e,function(){for(var i=n.length,o=new Array(i),s=i,a=i,c=function(u){by(e,function(){var h=jr(n[u],e),y=!1;h.subscribe(de(r,function(d){o[u]=d,y||(y=!0,a--),a||r.next(t(o.slice()))},function(){--s||r.complete()}))},r)},l=0;l<i;l++)c(l)},r)}}function by(n,e,t){n?ln(t,n,e):e()}function Jd(n,e,t,r,i,o,s,a){var c=[],l=0,u=0,h=!1,y=function(){h&&!c.length&&!l&&e.complete()},d=function(g){return l<r?f(g):c.push(g)},f=function(g){o&&e.next(g),l++;var _=!1;$e(t(g,u++)).subscribe(de(e,function(A){i==null||i(A),o?d(A):e.next(A)},function(){_=!0},void 0,function(){if(_)try{l--;for(var A=function(){var P=c.shift();s?ln(e,s,function(){return f(P)}):f(P)};c.length&&l<r;)A();y()}catch(P){e.error(P)}}))};return n.subscribe(de(e,d,function(){h=!0,y()})),function(){a==null||a()}}function Gn(n,e,t){return t===void 0&&(t=1/0),je(e)?Gn(function(r,i){return Li(function(o,s){return e(r,o,i,s)})($e(n(r,i)))},t):(typeof e=="number"&&(t=e),ve(function(r,i){return Jd(r,i,n,t)}))}function Vc(n){return n===void 0&&(n=1/0),Gn(jt,n)}function Yd(){return Vc(1)}function as(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return Yd()(jr(n,Pr(n)))}function Kc(n){return new Me(function(e){$e(n()).subscribe(e)})}var lR={connector:function(){return new _t},resetOnDisconnect:!0};function uR(n,e){e===void 0&&(e=lR);var t=null,r=e.connector,i=e.resetOnDisconnect,o=i===void 0?!0:i,s=r(),a=new Me(function(c){return s.subscribe(c)});return a.connect=function(){return(!t||t.closed)&&(t=Kc(function(){return n}).subscribe(s),o&&t.add(function(){return s=r()})),t},a}function hR(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Ps(n),r=c0(n),i=r.args,o=r.keys,s=new Me(function(a){var c=i.length;if(!c){a.complete();return}for(var l=new Array(c),u=c,h=c,y=function(f){var g=!1;$e(i[f]).subscribe(de(a,function(_){g||(g=!0,h--),l[f]=_},function(){return u--},void 0,function(){(!u||!g)&&(h||a.next(o?l0(o,l):l),a.complete())}))},d=0;d<c;d++)y(d)});return t?s.pipe(Di(t)):s}var dR=["addListener","removeListener"],fR=["addEventListener","removeEventListener"],pR=["on","off"];function lh(n,e,t,r){if(je(t)&&(r=t,t=void 0),r)return lh(n,e,t).pipe(Di(r));var i=Ge(mR(n)?fR.map(function(a){return function(c){return n[a](e,c,t)}}):yR(n)?dR.map(wy(n,e)):gR(n)?pR.map(wy(n,e)):[],2),o=i[0],s=i[1];if(!o&&Wd(n))return Gn(function(a){return lh(a,e,t)})($e(n));if(!o)throw new TypeError("Invalid event target");return new Me(function(a){var c=function(){for(var l=[],u=0;u<arguments.length;u++)l[u]=arguments[u];return a.next(1<l.length?l:l[0])};return o(c),function(){return s(c)}})}function wy(n,e){return function(t){return function(r){return n[t](e,r)}}}function yR(n){return je(n.addListener)&&je(n.removeListener)}function gR(n){return je(n.on)&&je(n.off)}function mR(n){return je(n.addEventListener)&&je(n.removeEventListener)}function d0(n,e,t){return t?d0(n,e).pipe(Di(t)):new Me(function(r){var i=function(){for(var s=[],a=0;a<arguments.length;a++)s[a]=arguments[a];return r.next(s.length===1?s[0]:s)},o=n(i);return je(e)?function(){return e(i,o)}:void 0})}function vR(n,e,t,r,i){var o,s,a,c;arguments.length===1?(o=n,c=o.initialState,e=o.condition,t=o.iterate,s=o.resultSelector,a=s===void 0?jt:s,i=o.scheduler):(c=n,!r||Uc(r)?(a=jt,i=r):a=r);function l(){var u;return Bd(this,function(h){switch(h.label){case 0:u=c,h.label=1;case 1:return!e||e(u)?[4,a(u)]:[3,4];case 2:h.sent(),h.label=3;case 3:return u=t(u),[3,1];case 4:return[2]}})}return Kc(i?function(){return Qb(l(),i)}:l)}function bR(n,e,t){return Kc(function(){return n()?e:t})}function qi(n,e,t){n===void 0&&(n=0),t===void 0&&(t=Vd);var r=-1;return e!=null&&(Uc(e)?t=e:r=e),new Me(function(i){var o=Hd(n)?+n-t.now():n;o<0&&(o=0);var s=0;return t.schedule(function(){i.closed||(i.next(s++),0<=r?this.schedule(void 0,r):i.complete())},o)})}function f0(n,e){return n===void 0&&(n=0),e===void 0&&(e=Ln),n<0&&(n=0),qi(n,n,e)}function wR(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Pr(n),r=Vb(n,1/0),i=n;return i.length?i.length===1?$e(i[0]):Vc(r)(jr(i,t)):gr}var p0=new Me(gt);function kR(){return p0}var xR=Array.isArray;function bo(n){return n.length===1&&xR(n[0])?n[0]:n}function y0(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=bo(n);return new Me(function(r){var i=0,o=function(){if(i<t.length){var s=void 0;try{s=$e(t[i++])}catch(c){o();return}var a=new Ud(r,void 0,gt,gt);s.subscribe(a),a.add(o)}else r.complete()};o()})}function ER(n,e){return jr(Object.entries(n),e)}function _R(n,e){return function(t,r){return!n.call(e,t,r)}}function Si(n,e){return ve(function(t,r){var i=0;t.subscribe(de(r,function(o){return n.call(e,o,i++)&&r.next(o)}))})}function $R(n,e,t){return[Si(e,t)($e(n)),Si(_R(e,t))($e(n))]}function OR(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return n=bo(n),n.length===1?$e(n[0]):new Me(g0(n))}function g0(n){return function(e){for(var t=[],r=function(o){t.push($e(n[o]).subscribe(de(e,function(s){if(t){for(var a=0;a<t.length;a++)a!==o&&t[a].unsubscribe();t=null}e.next(s)})))},i=0;t&&!e.closed&&i<n.length;i++)r(i)}}function AR(n,e,t){if(e==null&&(e=n,n=0),e<=0)return gr;var r=e+n;return new Me(t?function(i){var o=n;return t.schedule(function(){o<r?(i.next(o++),this.schedule()):i.complete()})}:function(i){for(var o=n;o<r&&!i.closed;)i.next(o++);i.complete()})}function SR(n,e){return new Me(function(t){var r=n(),i=e(r),o=i?$e(i):gr;return o.subscribe(t),function(){r&&r.unsubscribe()}})}function Gd(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Ps(n),r=bo(n);return r.length?new Me(function(i){var o=r.map(function(){return[]}),s=r.map(function(){return!1});i.add(function(){o=s=null});for(var a=function(l){$e(r[l]).subscribe(de(i,function(u){if(o[l].push(u),o.every(function(y){return y.length})){var h=o.map(function(y){return y.shift()});i.next(t?t.apply(void 0,Xe([],Ge(h))):h),o.some(function(y,d){return!y.length&&s[d]})&&i.complete()}},function(){s[l]=!0,!o[l].length&&i.complete()}))},c=0;!i.closed&&c<r.length;c++)a(c);return function(){o=s=null}}):gr}function m0(n){return ve(function(e,t){var r=!1,i=null,o=null,s=!1,a=function(){if(o==null||o.unsubscribe(),o=null,r){r=!1;var l=i;i=null,t.next(l)}s&&t.complete()},c=function(){o=null,s&&t.complete()};e.subscribe(de(t,function(l){r=!0,i=l,o||$e(n(l)).subscribe(o=de(t,a,c))},function(){s=!0,(!r||!o||o.closed)&&t.complete()}))})}function TR(n,e){return e===void 0&&(e=Ln),m0(function(){return qi(n,e)})}function PR(n){return ve(function(e,t){var r=[];return e.subscribe(de(t,function(i){return r.push(i)},function(){t.next(r),t.complete()})),$e(n).subscribe(de(t,function(){var i=r;r=[],t.next(i)},gt)),function(){r=null}})}function jR(n,e){return e===void 0&&(e=null),e=e!=null?e:n,ve(function(t,r){var i=[],o=0;t.subscribe(de(r,function(s){var a,c,l,u,h=null;o++%e===0&&i.push([]);try{for(var y=cn(i),d=y.next();!d.done;d=y.next()){var f=d.value;f.push(s),n<=f.length&&(h=h!=null?h:[],h.push(f))}}catch(A){a={error:A}}finally{try{d&&!d.done&&(c=y.return)&&c.call(y)}finally{if(a)throw a.error}}if(h)try{for(var g=cn(h),_=g.next();!_.done;_=g.next()){var f=_.value;Or(i,f),r.next(f)}}catch(A){l={error:A}}finally{try{_&&!_.done&&(u=g.return)&&u.call(g)}finally{if(l)throw l.error}}},function(){var s,a;try{for(var c=cn(i),l=c.next();!l.done;l=c.next()){var u=l.value;r.next(u)}}catch(h){s={error:h}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(s)throw s.error}}r.complete()},void 0,function(){i=null}))})}function RR(n){for(var e,t,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];var o=(e=Pr(r))!==null&&e!==void 0?e:Ln,s=(t=r[0])!==null&&t!==void 0?t:null,a=r[1]||1/0;return ve(function(c,l){var u=[],h=!1,y=function(g){var _=g.buffer,A=g.subs;A.unsubscribe(),Or(u,g),l.next(_),h&&d()},d=function(){if(u){var g=new fn;l.add(g);var _=[],A={buffer:_,subs:g};u.push(A),ln(g,o,function(){return y(A)},n)}};s!==null&&s>=0?ln(l,o,d,s,!0):h=!0,d();var f=de(l,function(g){var _,A,P=u.slice();try{for(var B=cn(P),C=B.next();!C.done;C=B.next()){var L=C.value,q=L.buffer;q.push(g),a<=q.length&&y(L)}}catch(H){_={error:H}}finally{try{C&&!C.done&&(A=B.return)&&A.call(B)}finally{if(_)throw _.error}}},function(){for(;u!=null&&u.length;)l.next(u.shift().buffer);f==null||f.unsubscribe(),l.complete(),l.unsubscribe()},void 0,function(){return u=null});c.subscribe(f)})}function IR(n,e){return ve(function(t,r){var i=[];$e(n).subscribe(de(r,function(o){var s=[];i.push(s);var a=new fn,c=function(){Or(i,s),r.next(s),a.unsubscribe()};a.add($e(e(o)).subscribe(de(r,c,gt)))},gt)),t.subscribe(de(r,function(o){var s,a;try{for(var c=cn(i),l=c.next();!l.done;l=c.next()){var u=l.value;u.push(o)}}catch(h){s={error:h}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(s)throw s.error}}},function(){for(;i.length>0;)r.next(i.shift());r.complete()}))})}function CR(n){return ve(function(e,t){var r=null,i=null,o=function(){i==null||i.unsubscribe();var s=r;r=[],s&&t.next(s),$e(n()).subscribe(i=de(t,o,gt))};o(),e.subscribe(de(t,function(s){return r==null?void 0:r.push(s)},function(){r&&t.next(r),t.complete()},void 0,function(){return r=i=null}))})}function v0(n){return ve(function(e,t){var r=null,i=!1,o;r=e.subscribe(de(t,void 0,void 0,function(s){o=$e(n(s,v0(n)(e))),r?(r.unsubscribe(),r=null,o.subscribe(t)):i=!0})),i&&(r.unsubscribe(),r=null,o.subscribe(t))})}function b0(n,e,t,r,i){return function(o,s){var a=t,c=e,l=0;o.subscribe(de(s,function(u){var h=l++;c=a?n(c,u,h):(a=!0,u),r&&s.next(c)},i&&function(){a&&s.next(c),s.complete()}))}}function js(n,e){return ve(b0(n,e,arguments.length>=2,!1,!0))}var NR=function(n,e){return n.push(e),n};function w0(){return ve(function(n,e){js(NR,[])(n).subscribe(e)})}function k0(n,e){return qd(w0(),Gn(function(t){return n(t)}),e?Di(e):jt)}function x0(n){return k0(u0,n)}var BR=x0;function E0(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Ps(n);return t?qd(E0.apply(void 0,Xe([],Ge(n))),Di(t)):ve(function(r,i){h0(Xe([r],Ge(bo(n))))(i)})}function LR(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return E0.apply(void 0,Xe([],Ge(n)))}function uh(n,e){return je(e)?Gn(n,e,1):Gn(n,1)}function DR(n,e){return je(e)?uh(function(){return n},e):uh(function(){return n})}function qR(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Pr(n);return ve(function(r,i){Yd()(jr(Xe([r],Ge(n)),t)).subscribe(i)})}function UR(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return qR.apply(void 0,Xe([],Ge(n)))}function MR(n){return new Me(function(e){return n.subscribe(e)})}var FR={connector:function(){return new _t}};function Xd(n,e){e===void 0&&(e=FR);var t=e.connector;return ve(function(r,i){var o=t();$e(n(MR(o))).subscribe(i),i.add(r.subscribe(o))})}function VR(n){return js(function(e,t,r){return!n||n(t,r)?e+1:e},0)}function KR(n){return ve(function(e,t){var r=!1,i=null,o=null,s=function(){if(o==null||o.unsubscribe(),o=null,r){r=!1;var a=i;i=null,t.next(a)}};e.subscribe(de(t,function(a){o==null||o.unsubscribe(),r=!0,i=a,o=de(t,s,gt),$e(n(a)).subscribe(o)},function(){s(),t.complete()},void 0,function(){i=o=null}))})}function WR(n,e){return e===void 0&&(e=Ln),ve(function(t,r){var i=null,o=null,s=null,a=function(){if(i){i.unsubscribe(),i=null;var l=o;o=null,r.next(l)}};function c(){var l=s+n,u=e.now();if(u<l){i=this.schedule(void 0,l-u),r.add(i);return}a()}t.subscribe(de(r,function(l){o=l,s=e.now(),i||(i=e.schedule(c,n),r.add(i))},function(){a(),r.complete()},void 0,function(){o=i=null}))})}function Wc(n){return ve(function(e,t){var r=!1;e.subscribe(de(t,function(i){r=!0,t.next(i)},function(){r||t.next(n),t.complete()}))})}function cs(n){return n<=0?function(){return gr}:ve(function(e,t){var r=0;e.subscribe(de(t,function(i){++r<=n&&(t.next(i),n<=r&&t.complete())}))})}function _0(){return ve(function(n,e){n.subscribe(de(e,gt))})}function $0(n){return Li(function(){return n})}function Zd(n,e){return e?function(t){return as(e.pipe(cs(1),_0()),t.pipe(Zd(n)))}:Gn(function(t,r){return $e(n(t,r)).pipe(cs(1),$0(t))})}function zR(n,e){e===void 0&&(e=Ln);var t=qi(n,e);return Zd(function(){return t})}function HR(){return ve(function(n,e){n.subscribe(de(e,function(t){return r0(t,e)}))})}function JR(n,e){return ve(function(t,r){var i=new Set;t.subscribe(de(r,function(o){var s=n?n(o):o;i.has(s)||(i.add(s),r.next(o))})),e&&$e(e).subscribe(de(r,function(){return i.clear()},gt))})}function O0(n,e){return e===void 0&&(e=jt),n=n!=null?n:YR,ve(function(t,r){var i,o=!0;t.subscribe(de(r,function(s){var a=e(s);(o||!n(i,a))&&(o=!1,i=a,r.next(s))}))})}function YR(n,e){return n===e}function GR(n,e){return O0(function(t,r){return e?e(t[n],r[n]):t[n]===r[n]})}function zc(n){return n===void 0&&(n=XR),ve(function(e,t){var r=!1;e.subscribe(de(t,function(i){r=!0,t.next(i)},function(){return r?t.complete():t.error(n())}))})}function XR(){return new Bi}function ZR(n,e){if(n<0)throw new ch;var t=arguments.length>=2;return function(r){return r.pipe(Si(function(i,o){return o===n}),cs(1),t?Wc(e):zc(function(){return new ch}))}}function QR(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return function(t){return as(t,zd.apply(void 0,Xe([],Ge(n))))}}function eI(n,e){return ve(function(t,r){var i=0;t.subscribe(de(r,function(o){n.call(e,o,i++,t)||(r.next(!1),r.complete())},function(){r.next(!0),r.complete()}))})}function Qd(n,e){return e?function(t){return t.pipe(Qd(function(r,i){return $e(n(r,i)).pipe(Li(function(o,s){return e(r,o,i,s)}))}))}:ve(function(t,r){var i=0,o=null,s=!1;t.subscribe(de(r,function(a){o||(o=de(r,void 0,function(){o=null,s&&r.complete()}),$e(n(a,i++)).subscribe(o))},function(){s=!0,!o&&r.complete()}))})}function A0(){return Qd(jt)}var tI=A0;function nI(n,e,t){return e===void 0&&(e=1/0),e=(e||0)<1?1/0:e,ve(function(r,i){return Jd(r,i,n,e,void 0,!0,t)})}function rI(n){return ve(function(e,t){try{e.subscribe(t)}finally{t.add(n)}})}function iI(n,e){return ve(S0(n,e,"value"))}function S0(n,e,t){var r=t==="index";return function(i,o){var s=0;i.subscribe(de(o,function(a){var c=s++;n.call(e,a,c,i)&&(o.next(r?c:a),o.complete())},function(){o.next(r?-1:void 0),o.complete()}))}}function oI(n,e){return ve(S0(n,e,"index"))}function sI(n,e){var t=arguments.length>=2;return function(r){return r.pipe(n?Si(function(i,o){return n(i,o,r)}):jt,cs(1),t?Wc(e):zc(function(){return new Bi}))}}function aI(n,e,t,r){return ve(function(i,o){var s;!e||typeof e=="function"?s=e:(t=e.duration,s=e.element,r=e.connector);var a=new Map,c=function(f){a.forEach(f),f(o)},l=function(f){return c(function(g){return g.error(f)})},u=0,h=!1,y=new Ud(o,function(f){try{var g=n(f),_=a.get(g);if(!_){a.set(g,_=r?r():new _t);var A=d(g,_);if(o.next(A),t){var P=de(_,function(){_.complete(),P==null||P.unsubscribe()},void 0,void 0,function(){return a.delete(g)});y.add($e(t(A)).subscribe(P))}}_.next(s?s(f):f)}catch(B){l(B)}},function(){return c(function(f){return f.complete()})},l,function(){return a.clear()},function(){return h=!0,u===0});i.subscribe(y);function d(f,g){var _=new Me(function(A){u++;var P=g.subscribe(A);return function(){P.unsubscribe(),--u===0&&h&&y.unsubscribe()}});return _.key=f,_}})}function cI(){return ve(function(n,e){n.subscribe(de(e,function(){e.next(!1),e.complete()},function(){e.next(!0),e.complete()}))})}function T0(n){return n<=0?function(){return gr}:ve(function(e,t){var r=[];e.subscribe(de(t,function(i){r.push(i),n<r.length&&r.shift()},function(){var i,o;try{for(var s=cn(r),a=s.next();!a.done;a=s.next()){var c=a.value;t.next(c)}}catch(l){i={error:l}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}t.complete()},void 0,function(){r=null}))})}function lI(n,e){var t=arguments.length>=2;return function(r){return r.pipe(n?Si(function(i,o){return n(i,o,r)}):jt,T0(1),t?Wc(e):zc(function(){return new Bi}))}}function uI(){return ve(function(n,e){n.subscribe(de(e,function(t){e.next(Ra.createNext(t))},function(){e.next(Ra.createComplete()),e.complete()},function(t){e.next(Ra.createError(t)),e.complete()}))})}function hI(n){return js(je(n)?function(e,t){return n(e,t)>0?e:t}:function(e,t){return e>t?e:t})}var dI=Gn;function fI(n,e,t){return t===void 0&&(t=1/0),je(e)?Gn(function(){return n},e,t):(typeof e=="number"&&(t=e),Gn(function(){return n},t))}function pI(n,e,t){return t===void 0&&(t=1/0),ve(function(r,i){var o=e;return Jd(r,i,function(s,a){return n(o,s,a)},t,function(s){o=s},!1,void 0,function(){return o=null})})}function yI(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Pr(n),r=Vb(n,1/0);return n=bo(n),ve(function(i,o){Vc(r)(jr(Xe([i],Ge(n)),t)).subscribe(o)})}function gI(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return yI.apply(void 0,Xe([],Ge(n)))}function mI(n){return js(je(n)?function(e,t){return n(e,t)<0?e:t}:function(e,t){return e<t?e:t})}function ef(n,e){var t=je(n)?n:function(){return n};return je(e)?Xd(e,{connector:t}):function(r){return new Dc(r,t)}}function vI(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=bo(n);return function(r){return y0.apply(void 0,Xe([r],Ge(t)))}}function bI(){return ve(function(n,e){var t,r=!1;n.subscribe(de(e,function(i){var o=t;t=i,r&&e.next([o,i]),r=!0}))})}function wI(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=n.length;if(t===0)throw new Error("list of properties cannot be empty.");return Li(function(r){for(var i=r,o=0;o<t;o++){var s=i==null?void 0:i[n[o]];if(typeof s!="undefined")i=s;else return}return i})}function kI(n){return n?function(e){return Xd(n)(e)}:function(e){return ef(new _t)(e)}}function xI(n){return function(e){var t=new Lb(n);return new Dc(e,function(){return t})}}function EI(){return function(n){var e=new Fd;return new Dc(n,function(){return e})}}function _I(n,e,t,r){t&&!je(t)&&(r=t);var i=je(t)?t:void 0;return function(o){return ef(new Md(n,e,r),i)(o)}}function $I(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return n.length?ve(function(t,r){g0(Xe([t],Ge(n)))(r)}):jt}function OI(n){var e,t=1/0,r;return n!=null&&(typeof n=="object"?(e=n.count,t=e===void 0?1/0:e,r=n.delay):t=n),t<=0?function(){return gr}:ve(function(i,o){var s=0,a,c=function(){if(a==null||a.unsubscribe(),a=null,r!=null){var u=typeof r=="number"?qi(r):$e(r(s)),h=de(o,function(){h.unsubscribe(),l()});u.subscribe(h)}else l()},l=function(){var u=!1;a=i.subscribe(de(o,void 0,function(){++s<t?a?c():u=!0:o.complete()})),u&&c()};l()})}function AI(n){return ve(function(e,t){var r,i=!1,o,s=!1,a=!1,c=function(){return a&&s&&(t.complete(),!0)},l=function(){return o||(o=new _t,$e(n(o)).subscribe(de(t,function(){r?u():i=!0},function(){s=!0,c()}))),o},u=function(){a=!1,r=e.subscribe(de(t,void 0,function(){a=!0,!c()&&l().next()})),i&&(r.unsubscribe(),r=null,i=!1,u())};u()})}function SI(n){n===void 0&&(n=1/0);var e;n&&typeof n=="object"?e=n:e={count:n};var t=e.count,r=t===void 0?1/0:t,i=e.delay,o=e.resetOnSuccess,s=o===void 0?!1:o;return r<=0?jt:ve(function(a,c){var l=0,u,h=function(){var y=!1;u=a.subscribe(de(c,function(d){s&&(l=0),c.next(d)},void 0,function(d){if(l++<r){var f=function(){u?(u.unsubscribe(),u=null,h()):y=!0};if(i!=null){var g=typeof i=="number"?qi(i):$e(i(d,l)),_=de(c,function(){_.unsubscribe(),f()},function(){c.complete()});g.subscribe(_)}else f()}else c.error(d)})),y&&(u.unsubscribe(),u=null,h())};h()})}function TI(n){return ve(function(e,t){var r,i=!1,o,s=function(){r=e.subscribe(de(t,void 0,void 0,function(a){o||(o=new _t,$e(n(o)).subscribe(de(t,function(){return r?s():i=!0}))),o&&o.next(a)})),i&&(r.unsubscribe(),r=null,i=!1,s())};s()})}function P0(n){return ve(function(e,t){var r=!1,i=null;e.subscribe(de(t,function(o){r=!0,i=o})),$e(n).subscribe(de(t,function(){if(r){r=!1;var o=i;i=null,t.next(o)}},gt))})}function PI(n,e){return e===void 0&&(e=Ln),P0(f0(n,e))}function jI(n,e){return ve(b0(n,e,arguments.length>=2,!0))}function RI(n,e){return e===void 0&&(e=function(t,r){return t===r}),ve(function(t,r){var i=ky(),o=ky(),s=function(c){r.next(c),r.complete()},a=function(c,l){var u=de(r,function(h){var y=l.buffer,d=l.complete;y.length===0?d?s(!1):c.buffer.push(h):!e(h,y.shift())&&s(!1)},function(){c.complete=!0;var h=l.complete,y=l.buffer;h&&s(y.length===0),u==null||u.unsubscribe()});return u};t.subscribe(a(i,o)),$e(n).subscribe(a(o,i))})}function ky(){return{buffer:[],complete:!1}}function j0(n){n===void 0&&(n={});var e=n.connector,t=e===void 0?function(){return new _t}:e,r=n.resetOnError,i=r===void 0?!0:r,o=n.resetOnComplete,s=o===void 0?!0:o,a=n.resetOnRefCountZero,c=a===void 0?!0:a;return function(l){var u,h,y,d=0,f=!1,g=!1,_=function(){h==null||h.unsubscribe(),h=void 0},A=function(){_(),u=y=void 0,f=g=!1},P=function(){var B=u;A(),B==null||B.unsubscribe()};return ve(function(B,C){d++,!g&&!f&&_();var L=y=y!=null?y:t();C.add(function(){d--,d===0&&!g&&!f&&(h=zl(P,c))}),L.subscribe(C),!u&&d>0&&(u=new lo({next:function(q){return L.next(q)},error:function(q){g=!0,_(),h=zl(A,i,q),L.error(q)},complete:function(){f=!0,_(),h=zl(A,s),L.complete()}}),$e(B).subscribe(u))})(l)}}function zl(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];if(e===!0){n();return}if(e!==!1){var i=new lo({next:function(){i.unsubscribe(),n()}});return $e(e.apply(void 0,Xe([],Ge(t)))).subscribe(i)}}function II(n,e,t){var r,i,o,s,a=!1;return n&&typeof n=="object"?(r=n.bufferSize,s=r===void 0?1/0:r,i=n.windowTime,e=i===void 0?1/0:i,o=n.refCount,a=o===void 0?!1:o,t=n.scheduler):s=n!=null?n:1/0,j0({connector:function(){return new Md(s,e,t)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:a})}function CI(n){return ve(function(e,t){var r=!1,i,o=!1,s=0;e.subscribe(de(t,function(a){o=!0,(!n||n(a,s++,e))&&(r&&t.error(new o0("Too many matching values")),r=!0,i=a)},function(){r?(t.next(i),t.complete()):t.error(o?new i0("No matching values"):new Bi)}))})}function NI(n){return Si(function(e,t){return n<=t})}function BI(n){return n<=0?jt:ve(function(e,t){var r=new Array(n),i=0;return e.subscribe(de(t,function(o){var s=i++;if(s<n)r[s]=o;else{var a=s%n,c=r[a];r[a]=o,t.next(c)}})),function(){r=null}})}function LI(n){return ve(function(e,t){var r=!1,i=de(t,function(){i==null||i.unsubscribe(),r=!0},gt);$e(n).subscribe(i),e.subscribe(de(t,function(o){return r&&t.next(o)}))})}function DI(n){return ve(function(e,t){var r=!1,i=0;e.subscribe(de(t,function(o){return(r||(r=!n(o,i++)))&&t.next(o)}))})}function qI(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Pr(n);return ve(function(r,i){(t?as(n,r,t):as(n,r)).subscribe(i)})}function ls(n,e){return ve(function(t,r){var i=null,o=0,s=!1,a=function(){return s&&!i&&r.complete()};t.subscribe(de(r,function(c){i==null||i.unsubscribe();var l=0,u=o++;$e(n(c,u)).subscribe(i=de(r,function(h){return r.next(e?e(c,h,u,l++):h)},function(){i=null,a()}))},function(){s=!0,a()}))})}function UI(){return ls(jt)}function MI(n,e){return je(e)?ls(function(){return n},e):ls(function(){return n})}function FI(n,e){return ve(function(t,r){var i=e;return ls(function(o,s){return n(i,o,s)},function(o,s){return i=s,s})(t).subscribe(r),function(){i=null}})}function VI(n){return ve(function(e,t){$e(n).subscribe(de(t,function(){return t.complete()},gt)),!t.closed&&e.subscribe(t)})}function KI(n,e){return e===void 0&&(e=!1),ve(function(t,r){var i=0;t.subscribe(de(r,function(o){var s=n(o,i++);(s||e)&&r.next(o),!s&&r.complete()}))})}function WI(n,e,t){var r=je(n)||e||t?{next:n,error:e,complete:t}:n;return r?ve(function(i,o){var s;(s=r.subscribe)===null||s===void 0||s.call(r);var a=!0;i.subscribe(de(o,function(c){var l;(l=r.next)===null||l===void 0||l.call(r,c),o.next(c)},function(){var c;a=!1,(c=r.complete)===null||c===void 0||c.call(r),o.complete()},function(c){var l;a=!1,(l=r.error)===null||l===void 0||l.call(r,c),o.error(c)},function(){var c,l;a&&((c=r.unsubscribe)===null||c===void 0||c.call(r)),(l=r.finalize)===null||l===void 0||l.call(r)}))}):jt}function R0(n,e){return ve(function(t,r){var i=e!=null?e:{},o=i.leading,s=o===void 0?!0:o,a=i.trailing,c=a===void 0?!1:a,l=!1,u=null,h=null,y=!1,d=function(){h==null||h.unsubscribe(),h=null,c&&(_(),y&&r.complete())},f=function(){h=null,y&&r.complete()},g=function(A){return h=$e(n(A)).subscribe(de(r,d,f))},_=function(){if(l){l=!1;var A=u;u=null,r.next(A),!y&&g(A)}};t.subscribe(de(r,function(A){l=!0,u=A,!(h&&!h.closed)&&(s?_():g(A))},function(){y=!0,!(c&&l&&h&&!h.closed)&&r.complete()}))})}function zI(n,e,t){e===void 0&&(e=Ln);var r=qi(n,e);return R0(function(){return r},t)}function HI(n){return n===void 0&&(n=Ln),ve(function(e,t){var r=n.now();e.subscribe(de(t,function(i){var o=n.now(),s=o-r;r=o,t.next(new JI(i,s))}))})}var JI=function(){function n(e,t){this.value=e,this.interval=t}return n}();function YI(n,e,t){var r,i,o;if(t=t!=null?t:Vd,Hd(n)?r=n:typeof n=="number"&&(i=n),e)o=function(){return e};else throw new TypeError("No observable provided to switch to");if(r==null&&i==null)throw new TypeError("No timeout provided.");return a0({first:r,each:i,scheduler:t,with:o})}function GI(n){return n===void 0&&(n=qc),Li(function(e){return{value:e,timestamp:n.now()}})}function XI(n){return ve(function(e,t){var r=new _t;t.next(r.asObservable());var i=function(o){r.error(o),t.error(o)};return e.subscribe(de(t,function(o){return r==null?void 0:r.next(o)},function(){r.complete(),t.complete()},i)),$e(n).subscribe(de(t,function(){r.complete(),t.next(r=new _t)},gt,i)),function(){r==null||r.unsubscribe(),r=null}})}function ZI(n,e){e===void 0&&(e=0);var t=e>0?e:n;return ve(function(r,i){var o=[new _t],s=[],a=0;i.next(o[0].asObservable()),r.subscribe(de(i,function(c){var l,u;try{for(var h=cn(o),y=h.next();!y.done;y=h.next()){var d=y.value;d.next(c)}}catch(_){l={error:_}}finally{try{y&&!y.done&&(u=h.return)&&u.call(h)}finally{if(l)throw l.error}}var f=a-n+1;if(f>=0&&f%t===0&&o.shift().complete(),++a%t===0){var g=new _t;o.push(g),i.next(g.asObservable())}},function(){for(;o.length>0;)o.shift().complete();i.complete()},function(c){for(;o.length>0;)o.shift().error(c);i.error(c)},function(){s=null,o=null}))})}function QI(n){for(var e,t,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];var o=(e=Pr(r))!==null&&e!==void 0?e:Ln,s=(t=r[0])!==null&&t!==void 0?t:null,a=r[1]||1/0;return ve(function(c,l){var u=[],h=!1,y=function(_){var A=_.window,P=_.subs;A.complete(),P.unsubscribe(),Or(u,_),h&&d()},d=function(){if(u){var _=new fn;l.add(_);var A=new _t,P={window:A,subs:_,seen:0};u.push(P),l.next(A.asObservable()),ln(_,o,function(){return y(P)},n)}};s!==null&&s>=0?ln(l,o,d,s,!0):h=!0,d();var f=function(_){return u.slice().forEach(_)},g=function(_){f(function(A){var P=A.window;return _(P)}),_(l),l.unsubscribe()};return c.subscribe(de(l,function(_){f(function(A){A.window.next(_),a<=++A.seen&&y(A)})},function(){return g(function(_){return _.complete()})},function(_){return g(function(A){return A.error(_)})})),function(){u=null}})}function eC(n,e){return ve(function(t,r){var i=[],o=function(s){for(;0<i.length;)i.shift().error(s);r.error(s)};$e(n).subscribe(de(r,function(s){var a=new _t;i.push(a);var c=new fn,l=function(){Or(i,a),a.complete(),c.unsubscribe()},u;try{u=$e(e(s))}catch(h){o(h);return}r.next(a.asObservable()),c.add(u.subscribe(de(r,l,gt,o)))},gt)),t.subscribe(de(r,function(s){var a,c,l=i.slice();try{for(var u=cn(l),h=u.next();!h.done;h=u.next()){var y=h.value;y.next(s)}}catch(d){a={error:d}}finally{try{h&&!h.done&&(c=u.return)&&c.call(u)}finally{if(a)throw a.error}}},function(){for(;0<i.length;)i.shift().complete();r.complete()},o,function(){for(;0<i.length;)i.shift().unsubscribe()}))})}function tC(n){return ve(function(e,t){var r,i,o=function(a){r.error(a),t.error(a)},s=function(){i==null||i.unsubscribe(),r==null||r.complete(),r=new _t,t.next(r.asObservable());var a;try{a=$e(n())}catch(c){o(c);return}a.subscribe(i=de(t,s,s,o))};s(),e.subscribe(de(t,function(a){return r.next(a)},function(){r.complete(),t.complete()},o,function(){i==null||i.unsubscribe(),r=null}))})}function nC(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Ps(n);return ve(function(r,i){for(var o=n.length,s=new Array(o),a=n.map(function(){return!1}),c=!1,l=function(h){$e(n[h]).subscribe(de(i,function(y){s[h]=y,!c&&!a[h]&&(a[h]=!0,(c=a.every(jt))&&(a=null))},gt))},u=0;u<o;u++)l(u);r.subscribe(de(i,function(h){if(c){var y=Xe([h],Ge(s));i.next(t?t.apply(void 0,Xe([],Ge(y))):y)}}))})}function rC(n){return k0(Gd,n)}function iC(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return ve(function(t,r){Gd.apply(void 0,Xe([t],Ge(n))).subscribe(r)})}function oC(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return iC.apply(void 0,Xe([],Ge(n)))}const sC=Object.freeze(Object.defineProperty({__proto__:null,Observable:Me,ConnectableObservable:Dc,observable:Lc,animationFrames:kj,Subject:_t,BehaviorSubject:Lb,ReplaySubject:Md,AsyncSubject:Fd,asap:Tj,asapScheduler:qb,async:Vd,asyncScheduler:Ln,queue:Rj,queueScheduler:Ub,animationFrame:Nj,animationFrameScheduler:Mb,VirtualTimeScheduler:Bj,VirtualAction:Fb,Scheduler:sh,Subscription:fn,Subscriber:Bc,Notification:Ra,get NotificationKind(){return ah},pipe:qd,noop:gt,identity:jt,isObservable:Gj,lastValueFrom:Xj,firstValueFrom:Zj,ArgumentOutOfRangeError:ch,EmptyError:Bi,NotFoundError:i0,ObjectUnsubscribedError:Bb,SequenceError:o0,TimeoutError:s0,UnsubscriptionError:Pa,bindCallback:nR,bindNodeCallback:rR,combineLatest:u0,concat:as,connectable:uR,defer:Kc,empty:Lj,forkJoin:hR,from:jr,fromEvent:lh,fromEventPattern:d0,generate:vR,iif:bR,interval:f0,merge:wR,never:kR,of:zd,onErrorResumeNext:y0,pairs:ER,partition:$R,race:OR,range:AR,throwError:n0,timer:qi,using:SR,zip:Gd,scheduled:t0,EMPTY:gr,NEVER:p0,config:di,audit:m0,auditTime:TR,buffer:PR,bufferCount:jR,bufferTime:RR,bufferToggle:IR,bufferWhen:CR,catchError:v0,combineAll:BR,combineLatestAll:x0,combineLatestWith:LR,concatAll:Yd,concatMap:uh,concatMapTo:DR,concatWith:UR,connect:Xd,count:VR,debounce:KR,debounceTime:WR,defaultIfEmpty:Wc,delay:zR,delayWhen:Zd,dematerialize:HR,distinct:JR,distinctUntilChanged:O0,distinctUntilKeyChanged:GR,elementAt:ZR,endWith:QR,every:eI,exhaust:tI,exhaustAll:A0,exhaustMap:Qd,expand:nI,filter:Si,finalize:rI,find:iI,findIndex:oI,first:sI,groupBy:aI,ignoreElements:_0,isEmpty:cI,last:lI,map:Li,mapTo:$0,materialize:uI,max:hI,mergeAll:Vc,flatMap:dI,mergeMap:Gn,mergeMapTo:fI,mergeScan:pI,mergeWith:gI,min:mI,multicast:ef,observeOn:Mc,onErrorResumeNextWith:vI,pairwise:bI,pluck:wI,publish:kI,publishBehavior:xI,publishLast:EI,publishReplay:_I,raceWith:$I,reduce:js,repeat:OI,repeatWhen:AI,retry:SI,retryWhen:TI,refCount:Ib,sample:P0,sampleTime:PI,scan:jI,sequenceEqual:RI,share:j0,shareReplay:II,single:CI,skip:NI,skipLast:BI,skipUntil:LI,skipWhile:DI,startWith:qI,subscribeOn:Fc,switchAll:UI,switchMap:ls,switchMapTo:MI,switchScan:FI,take:cs,takeLast:T0,takeUntil:VI,takeWhile:KI,tap:WI,throttle:R0,throttleTime:zI,throwIfEmpty:zc,timeInterval:HI,timeout:a0,timeoutWith:YI,timestamp:GI,toArray:w0,window:XI,windowCount:ZI,windowTime:QI,windowToggle:eC,windowWhen:tC,withLatestFrom:nC,zipAll:rC,zipWith:oC},Symbol.toStringTag,{value:"Module"}));var aC=Object.defineProperty,cC=Object.defineProperties,lC=Object.getOwnPropertyDescriptors,xy=Object.getOwnPropertySymbols,uC=Object.prototype.hasOwnProperty,hC=Object.prototype.propertyIsEnumerable,hh=(n,e,t)=>e in n?aC(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,ie=(n,e)=>{for(var t in e||(e={}))uC.call(e,t)&&hh(n,t,e[t]);if(xy)for(var t of xy(e))hC.call(e,t)&&hh(n,t,e[t]);return n},et=(n,e)=>cC(n,lC(e)),dC=(n,e,t)=>(hh(n,typeof e!="symbol"?e+"":e,t),t),I0=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)},Ee=(n,e,t)=>(I0(n,e,"read from private field"),t?t.call(n):e.get(n)),wn=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)},Un=(n,e,t,r)=>(I0(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t),W=(n,e,t)=>new Promise((r,i)=>{var o=c=>{try{a(t.next(c))}catch(l){i(l)}},s=c=>{try{a(t.throw(c))}catch(l){i(l)}},a=c=>c.done?r(c.value):Promise.resolve(c.value).then(o,s);a((t=t.apply(n,e)).next())});const dr=Object.create(null);dr.open="0";dr.close="1";dr.ping="2";dr.pong="3";dr.message="4";dr.upgrade="5";dr.noop="6";const Ia=Object.create(null);Object.keys(dr).forEach(n=>{Ia[dr[n]]=n});const fC={type:"error",data:"parser error"},pC=typeof Blob=="function"||typeof Blob!="undefined"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",yC=typeof ArrayBuffer=="function",gC=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n&&n.buffer instanceof ArrayBuffer,C0=({type:n,data:e},t,r)=>pC&&e instanceof Blob?t?r(e):Ey(e,r):yC&&(e instanceof ArrayBuffer||gC(e))?t?r(e):Ey(new Blob([e]),r):r(dr[n]+(e||"")),Ey=(n,e)=>{const t=new FileReader;return t.onload=function(){const r=t.result.split(",")[1];e("b"+(r||""))},t.readAsDataURL(n)},_y="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Vo=typeof Uint8Array=="undefined"?[]:new Uint8Array(256);for(let n=0;n<_y.length;n++)Vo[_y.charCodeAt(n)]=n;const mC=n=>{let e=n.length*.75,t=n.length,r,i=0,o,s,a,c;n[n.length-1]==="="&&(e--,n[n.length-2]==="="&&e--);const l=new ArrayBuffer(e),u=new Uint8Array(l);for(r=0;r<t;r+=4)o=Vo[n.charCodeAt(r)],s=Vo[n.charCodeAt(r+1)],a=Vo[n.charCodeAt(r+2)],c=Vo[n.charCodeAt(r+3)],u[i++]=o<<2|s>>4,u[i++]=(s&15)<<4|a>>2,u[i++]=(a&3)<<6|c&63;return l},vC=typeof ArrayBuffer=="function",N0=(n,e)=>{if(typeof n!="string")return{type:"message",data:B0(n,e)};const t=n.charAt(0);return t==="b"?{type:"message",data:bC(n.substring(1),e)}:Ia[t]?n.length>1?{type:Ia[t],data:n.substring(1)}:{type:Ia[t]}:fC},bC=(n,e)=>{if(vC){const t=mC(n);return B0(t,e)}else return{base64:!0,data:n}},B0=(n,e)=>{switch(e){case"blob":return n instanceof ArrayBuffer?new Blob([n]):n;case"arraybuffer":default:return n}},L0=String.fromCharCode(30),wC=(n,e)=>{const t=n.length,r=new Array(t);let i=0;n.forEach((o,s)=>{C0(o,!1,a=>{r[s]=a,++i===t&&e(r.join(L0))})})},kC=(n,e)=>{const t=n.split(L0),r=[];for(let i=0;i<t.length;i++){const o=N0(t[i],e);if(r.push(o),o.type==="error")break}return r},D0=4;function pt(n){if(n)return xC(n)}function xC(n){for(var e in pt.prototype)n[e]=pt.prototype[e];return n}pt.prototype.on=pt.prototype.addEventListener=function(n,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+n]=this._callbacks["$"+n]||[]).push(e),this};pt.prototype.once=function(n,e){function t(){this.off(n,t),e.apply(this,arguments)}return t.fn=e,this.on(n,t),this};pt.prototype.off=pt.prototype.removeListener=pt.prototype.removeAllListeners=pt.prototype.removeEventListener=function(n,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+n];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+n],this;for(var r,i=0;i<t.length;i++)if(r=t[i],r===e||r.fn===e){t.splice(i,1);break}return t.length===0&&delete this._callbacks["$"+n],this};pt.prototype.emit=function(n){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+n],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(t){t=t.slice(0);for(var r=0,i=t.length;r<i;++r)t[r].apply(this,e)}return this};pt.prototype.emitReserved=pt.prototype.emit;pt.prototype.listeners=function(n){return this._callbacks=this._callbacks||{},this._callbacks["$"+n]||[]};pt.prototype.hasListeners=function(n){return!!this.listeners(n).length};const Rn=(()=>typeof self!="undefined"?self:typeof window!="undefined"?window:Function("return this")())();function q0(n,...e){return e.reduce((t,r)=>(n.hasOwnProperty(r)&&(t[r]=n[r]),t),{})}const EC=Rn.setTimeout,_C=Rn.clearTimeout;function Hc(n,e){e.useNativeTimers?(n.setTimeoutFn=EC.bind(Rn),n.clearTimeoutFn=_C.bind(Rn)):(n.setTimeoutFn=Rn.setTimeout.bind(Rn),n.clearTimeoutFn=Rn.clearTimeout.bind(Rn))}const $C=1.33;function OC(n){return typeof n=="string"?AC(n):Math.ceil((n.byteLength||n.size)*$C)}function AC(n){let e=0,t=0;for(let r=0,i=n.length;r<i;r++)e=n.charCodeAt(r),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(r++,t+=4);return t}class SC extends Error{constructor(e,t,r){super(e),this.description=t,this.context=r,this.type="TransportError"}}class U0 extends pt{constructor(e){super(),this.writable=!1,Hc(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,r){return super.emitReserved("error",new SC(e,t,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=N0(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}}const M0="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),dh=64,TC={};let $y=0,ea=0,Oy;function Ay(n){let e="";do e=M0[n%dh]+e,n=Math.floor(n/dh);while(n>0);return e}function F0(){const n=Ay(+new Date);return n!==Oy?($y=0,Oy=n):n+"."+Ay($y++)}for(;ea<dh;ea++)TC[M0[ea]]=ea;function V0(n){let e="";for(let t in n)n.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(n[t]));return e}function PC(n){let e={},t=n.split("&");for(let r=0,i=t.length;r<i;r++){let o=t[r].split("=");e[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return e}let K0=!1;try{K0=typeof XMLHttpRequest!="undefined"&&"withCredentials"in new XMLHttpRequest}catch(n){}const jC=K0;function W0(n){const e=n.xdomain;try{if(typeof XMLHttpRequest!="undefined"&&(!e||jC))return new XMLHttpRequest}catch(t){}if(!e)try{return new Rn[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch(t){}}function RC(){}const IC=function(){return new W0({xdomain:!1}).responseType!=null}();class CC extends U0{constructor(e){if(super(e),this.polling=!1,typeof location!="undefined"){const r=location.protocol==="https:";let i=location.port;i||(i=r?"443":"80"),this.xd=typeof location!="undefined"&&e.hostname!==location.hostname||i!==e.port,this.xs=e.secure!==r}const t=e&&e.forceBase64;this.supportsBinary=IC&&!t}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let r=0;this.polling&&(r++,this.once("pollComplete",function(){--r||t()})),this.writable||(r++,this.once("drain",function(){--r||t()}))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const t=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)};kC(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,wC(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let e=this.query||{};const t=this.opts.secure?"https":"http";let r="";this.opts.timestampRequests!==!1&&(e[this.opts.timestampParam]=F0()),!this.supportsBinary&&!e.sid&&(e.b64=1),this.opts.port&&(t==="https"&&Number(this.opts.port)!==443||t==="http"&&Number(this.opts.port)!==80)&&(r=":"+this.opts.port);const i=V0(e),o=this.opts.hostname.indexOf(":")!==-1;return t+"://"+(o?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(i.length?"?"+i:"")}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new lr(this.uri(),e)}doWrite(e,t){const r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",(i,o)=>{this.onError("xhr post error",i,o)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,r)=>{this.onError("xhr poll error",t,r)}),this.pollXhr=e}}class lr extends pt{constructor(e,t){super(),Hc(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.async=t.async!==!1,this.data=t.data!==void 0?t.data:null,this.create()}create(){const e=q0(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;const t=this.xhr=new W0(e);try{t.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(let r in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(r)&&t.setRequestHeader(r,this.opts.extraHeaders[r])}}catch(r){}if(this.method==="POST")try{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(r){}try{t.setRequestHeader("Accept","*/*")}catch(r){}"withCredentials"in t&&(t.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(t.timeout=this.opts.requestTimeout),t.onreadystatechange=()=>{t.readyState===4&&(t.status===200||t.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof t.status=="number"?t.status:0)},0))},t.send(this.data)}catch(r){this.setTimeoutFn(()=>{this.onError(r)},0);return}typeof document!="undefined"&&(this.index=lr.requestsCount++,lr.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr=="undefined"||this.xhr===null)){if(this.xhr.onreadystatechange=RC,e)try{this.xhr.abort()}catch(t){}typeof document!="undefined"&&delete lr.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}lr.requestsCount=0;lr.requests={};if(typeof document!="undefined"){if(typeof attachEvent=="function")attachEvent("onunload",Sy);else if(typeof addEventListener=="function"){const n="onpagehide"in Rn?"pagehide":"unload";addEventListener(n,Sy,!1)}}function Sy(){for(let n in lr.requests)lr.requests.hasOwnProperty(n)&&lr.requests[n].abort()}const z0=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?n=>Promise.resolve().then(n):(n,e)=>e(n,0))(),ta=Rn.WebSocket||Rn.MozWebSocket,Ty=!0,NC="arraybuffer",Py=typeof navigator!="undefined"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class BC extends U0{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,r=Py?{}:q0(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=Ty&&!Py?t?new ta(e,t):new ta(e):new ta(e,t,r)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType||NC,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],i=t===e.length-1;C0(r,this.supportsBinary,o=>{try{Ty&&this.ws.send(o)}catch(s){}i&&z0(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws!="undefined"&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{};const t=this.opts.secure?"wss":"ws";let r="";this.opts.port&&(t==="wss"&&Number(this.opts.port)!==443||t==="ws"&&Number(this.opts.port)!==80)&&(r=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=F0()),this.supportsBinary||(e.b64=1);const i=V0(e),o=this.opts.hostname.indexOf(":")!==-1;return t+"://"+(o?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(i.length?"?"+i:"")}check(){return!!ta}}const LC={websocket:BC,polling:CC},DC=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,qC=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function fh(n){const e=n,t=n.indexOf("["),r=n.indexOf("]");t!=-1&&r!=-1&&(n=n.substring(0,t)+n.substring(t,r).replace(/:/g,";")+n.substring(r,n.length));let i=DC.exec(n||""),o={},s=14;for(;s--;)o[qC[s]]=i[s]||"";return t!=-1&&r!=-1&&(o.source=e,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=UC(o,o.path),o.queryKey=MC(o,o.query),o}function UC(n,e){const t=/\/{2,9}/g,r=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&r.splice(0,1),e.slice(-1)=="/"&&r.splice(r.length-1,1),r}function MC(n,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,i,o){i&&(t[i]=o)}),t}class ri extends pt{constructor(e,t={}){super(),this.writeBuffer=[],e&&typeof e=="object"&&(t=e,e=null),e?(e=fh(e),t.hostname=e.host,t.secure=e.protocol==="https"||e.protocol==="wss",t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=fh(t.host).host),Hc(this,t),this.secure=t.secure!=null?t.secure:typeof location!="undefined"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location!="undefined"?location.hostname:"localhost"),this.port=t.port||(typeof location!="undefined"&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=PC(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=D0,t.transport=e,this.id&&(t.sid=this.id);const r=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new LC[e](r)}open(){let e;if(this.opts.rememberUpgrade&&ri.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch(t){this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",t=>this.onClose("transport close",t))}probe(e){let t=this.createTransport(e),r=!1;ri.priorWebsocketSuccess=!1;const i=()=>{r||(t.send([{type:"ping",data:"probe"}]),t.once("packet",h=>{if(!r)if(h.type==="pong"&&h.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;ri.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{r||this.readyState!=="closed"&&(u(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const y=new Error("probe error");y.transport=t.name,this.emitReserved("upgradeError",y)}}))};function o(){r||(r=!0,u(),t.close(),t=null)}const s=h=>{const y=new Error("probe error: "+h);y.transport=t.name,o(),this.emitReserved("upgradeError",y)};function a(){s("transport closed")}function c(){s("socket closed")}function l(h){t&&h.name!==t.name&&o()}const u=()=>{t.removeListener("open",i),t.removeListener("error",s),t.removeListener("close",a),this.off("close",c),this.off("upgrading",l)};t.once("open",i),t.once("error",s),t.once("close",a),this.once("close",c),this.once("upgrading",l),t.open()}onOpen(){if(this.readyState="open",ri.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let t=0;t<this.writeBuffer.length;t++){const r=this.writeBuffer[t].data;if(r&&(e+=OC(r)),t>0&&e>this.maxPayload)return this.writeBuffer.slice(0,t);e+=2}return this.writeBuffer}write(e,t,r){return this.sendPacket("message",e,t,r),this}send(e,t,r){return this.sendPacket("message",e,t,r),this}sendPacket(e,t,r,i){if(typeof t=="function"&&(i=t,t=void 0),typeof r=="function"&&(i=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;const o={type:e,data:t,options:r};this.emitReserved("packetCreate",o),this.writeBuffer.push(o),i&&this.once("flush",i),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},r=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():e()}):this.upgrading?r():e()),this}onError(e){ri.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let r=0;const i=e.length;for(;r<i;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}}ri.protocol=D0;function FC(n,e="",t){let r=n;t=t||typeof location!="undefined"&&location,n==null&&(n=t.protocol+"//"+t.host),typeof n=="string"&&(n.charAt(0)==="/"&&(n.charAt(1)==="/"?n=t.protocol+n:n=t.host+n),/^(https?|wss?):\/\//.test(n)||(typeof t!="undefined"?n=t.protocol+"//"+n:n="https://"+n),r=fh(n)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const i=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+i+":"+r.port+e,r.href=r.protocol+"://"+i+(t&&t.port===r.port?"":":"+r.port),r}const VC=typeof ArrayBuffer=="function",KC=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n.buffer instanceof ArrayBuffer,H0=Object.prototype.toString,WC=typeof Blob=="function"||typeof Blob!="undefined"&&H0.call(Blob)==="[object BlobConstructor]",zC=typeof File=="function"||typeof File!="undefined"&&H0.call(File)==="[object FileConstructor]";function tf(n){return VC&&(n instanceof ArrayBuffer||KC(n))||WC&&n instanceof Blob||zC&&n instanceof File}function Ca(n,e){if(!n||typeof n!="object")return!1;if(Array.isArray(n)){for(let t=0,r=n.length;t<r;t++)if(Ca(n[t]))return!0;return!1}if(tf(n))return!0;if(n.toJSON&&typeof n.toJSON=="function"&&arguments.length===1)return Ca(n.toJSON(),!0);for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)&&Ca(n[t]))return!0;return!1}function HC(n){const e=[],t=n.data,r=n;return r.data=ph(t,e),r.attachments=e.length,{packet:r,buffers:e}}function ph(n,e){if(!n)return n;if(tf(n)){const t={_placeholder:!0,num:e.length};return e.push(n),t}else if(Array.isArray(n)){const t=new Array(n.length);for(let r=0;r<n.length;r++)t[r]=ph(n[r],e);return t}else if(typeof n=="object"&&!(n instanceof Date)){const t={};for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=ph(n[r],e));return t}return n}function JC(n,e){return n.data=yh(n.data,e),delete n.attachments,n}function yh(n,e){if(!n)return n;if(n&&n._placeholder===!0){if(typeof n.num=="number"&&n.num>=0&&n.num<e.length)return e[n.num];throw new Error("illegal attachments")}else if(Array.isArray(n))for(let t=0;t<n.length;t++)n[t]=yh(n[t],e);else if(typeof n=="object")for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&(n[t]=yh(n[t],e));return n}const YC=5;var De;(function(n){n[n.CONNECT=0]="CONNECT",n[n.DISCONNECT=1]="DISCONNECT",n[n.EVENT=2]="EVENT",n[n.ACK=3]="ACK",n[n.CONNECT_ERROR=4]="CONNECT_ERROR",n[n.BINARY_EVENT=5]="BINARY_EVENT",n[n.BINARY_ACK=6]="BINARY_ACK"})(De||(De={}));class GC{constructor(e){this.replacer=e}encode(e){return(e.type===De.EVENT||e.type===De.ACK)&&Ca(e)?this.encodeAsBinary({type:e.type===De.EVENT?De.BINARY_EVENT:De.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===De.BINARY_EVENT||e.type===De.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=HC(e),r=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(r),i}}class nf extends pt{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const r=t.type===De.BINARY_EVENT;r||t.type===De.BINARY_ACK?(t.type=r?De.EVENT:De.ACK,this.reconstructor=new XC(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(tf(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const r={type:Number(e.charAt(0))};if(De[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===De.BINARY_EVENT||r.type===De.BINARY_ACK){const o=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const s=e.substring(o,t);if(s!=Number(s)||e.charAt(t)!=="-")throw new Error("Illegal attachments");r.attachments=Number(s)}if(e.charAt(t+1)==="/"){const o=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););r.nsp=e.substring(o,t)}else r.nsp="/";const i=e.charAt(t+1);if(i!==""&&Number(i)==i){const o=t+1;for(;++t;){const s=e.charAt(t);if(s==null||Number(s)!=s){--t;break}if(t===e.length)break}r.id=Number(e.substring(o,t+1))}if(e.charAt(++t)){const o=this.tryParse(e.substr(t));if(nf.isPayloadValid(r.type,o))r.data=o;else throw new Error("invalid payload")}return r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(t){return!1}}static isPayloadValid(e,t){switch(e){case De.CONNECT:return typeof t=="object";case De.DISCONNECT:return t===void 0;case De.CONNECT_ERROR:return typeof t=="string"||typeof t=="object";case De.EVENT:case De.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="string"||typeof t[0]=="number");case De.ACK:case De.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class XC{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=JC(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const ZC=Object.freeze(Object.defineProperty({__proto__:null,protocol:YC,get PacketType(){return De},Encoder:GC,Decoder:nf},Symbol.toStringTag,{value:"Module"}));function Vn(n,e,t){return n.on(e,t),function(){n.off(e,t)}}const QC=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class J0 extends pt{constructor(e,t,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Vn(e,"open",this.onopen.bind(this)),Vn(e,"packet",this.onpacket.bind(this)),Vn(e,"error",this.onerror.bind(this)),Vn(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(QC.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const r={type:De.EVENT,data:t};if(r.options={},r.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const o=this.ids++,s=t.pop();this._registerAckCallback(o,s),r.id=o}const i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!i||!this.connected)||(this.connected?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(e,t){var r;const i=(r=this.flags.timeout)!==null&&r!==void 0?r:this._opts.ackTimeout;if(i===void 0){this.acks[e]=t;return}const o=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let s=0;s<this.sendBuffer.length;s++)this.sendBuffer[s].id===e&&this.sendBuffer.splice(s,1);t.call(this,new Error("operation has timed out"))},i);this.acks[e]=(...s)=>{this.io.clearTimeoutFn(o),t.apply(this,[null,...s])}}emitWithAck(e,...t){const r=this.flags.timeout!==void 0||this._opts.ackTimeout!==void 0;return new Promise((i,o)=>{t.push((s,a)=>r?s?o(s):i(a):i(s)),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((i,...o)=>r!==this._queue[0]?void 0:(i!==null?r.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(i)):(this._queue.shift(),t&&t(null,...o)),r.pending=!1,this._drainQueue())),this._queue.push(r),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:De.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case De.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case De.EVENT:case De.BINARY_EVENT:this.onevent(e);break;case De.ACK:case De.BINARY_ACK:this.onack(e);break;case De.DISCONNECT:this.ondisconnect();break;case De.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const r of t)r.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let r=!1;return function(...i){r||(r=!0,t.packet({type:De.ACK,id:e,data:i}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:De.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const r of t)r.apply(this,e.data)}}}function wo(n){n=n||{},this.ms=n.min||100,this.max=n.max||1e4,this.factor=n.factor||2,this.jitter=n.jitter>0&&n.jitter<=1?n.jitter:0,this.attempts=0}wo.prototype.duration=function(){var n=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*n);n=(Math.floor(e*10)&1)==0?n-t:n+t}return Math.min(n,this.max)|0};wo.prototype.reset=function(){this.attempts=0};wo.prototype.setMin=function(n){this.ms=n};wo.prototype.setMax=function(n){this.max=n};wo.prototype.setJitter=function(n){this.jitter=n};class gh extends pt{constructor(e,t){var r;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,Hc(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((r=t.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new wo({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const i=t.parser||ZC;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new ri(this.uri,this.opts);const t=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const i=Vn(t,"open",function(){r.onopen(),e&&e()}),o=Vn(t,"error",s=>{r.cleanup(),r._readyState="closed",this.emitReserved("error",s),e?e(s):r.maybeReconnectOnOpen()});if(this._timeout!==!1){const s=this._timeout;s===0&&i();const a=this.setTimeoutFn(()=>{i(),t.close(),t.emit("error",new Error("timeout"))},s);this.opts.autoUnref&&a.unref(),this.subs.push(function(){clearTimeout(a)})}return this.subs.push(i),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Vn(e,"ping",this.onping.bind(this)),Vn(e,"data",this.ondata.bind(this)),Vn(e,"error",this.onerror.bind(this)),Vn(e,"close",this.onclose.bind(this)),Vn(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){z0(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new J0(this,e,t),this.nsps[e]=r),r}_destroy(e){const t=Object.keys(this.nsps);for(const r of t)if(this.nsps[r].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let r=0;r<t.length;r++)this.engine.write(t[r],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(i=>{i?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",i)):e.onreconnect()}))},t);this.opts.autoUnref&&r.unref(),this.subs.push(function(){clearTimeout(r)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const jo={};function no(n,e){typeof n=="object"&&(e=n,n=void 0),e=e||{};const t=FC(n,e.path||"/socket.io"),r=t.source,i=t.id,o=t.path,s=jo[i]&&o in jo[i].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||s;let c;return a?c=new gh(r,e):(jo[i]||(jo[i]=new gh(r,e)),c=jo[i]),t.query&&!e.query&&(e.query=t.queryKey),c.socket(t.path,e)}Object.assign(no,{Manager:gh,Socket:J0,io:no,connect:no});const eN={init:({API_KEY:n,HOST_SERVER:e,CURRENT:t,ENV:r,API_VERSION:i})=>{var o,s,a,c;let l={};const u=localStorage.getItem("accessToken");try{const h={Accept:"application/json","Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Key":n,"Access-Control-Allow-Methods":"POST, GET, OPTIONS, PUT, DELETE, HEAD,PATCH","Access-Control-Allow-Headers":"X-PINGOTHER, Origin, X-Requested-With, Content-Type, Accept","Access-Control-Max-Age":"1728000"};return u&&(h.Authorization="Bearer "+u),l.auth=no(e.AUTH,{extraHeaders:h}),l.database=no(e.DATABASE,{extraHeaders:h}),l.storage=no(e.STORAGE,{extraHeaders:h}),(o=l==null?void 0:l.auth)==null||o.on("connect",()=>{var y,d,f,g,_;let A=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");A.uid&&(y=l.auth)!=null&&y.id&&(r==="dev"&&console.log("The socket device id is: ",(d=l.auth)==null?void 0:d.id),(g=l==null?void 0:l.auth)==null||g.emit((i==null?void 0:i.AUTH)+"/user/join",{socketId:(f=l.auth)==null?void 0:f.id,currentUserId:A.uid}),(_=l==null?void 0:l.auth)==null||_.on((i==null?void 0:i.AUTH)+"/user/status",P=>{if(A.status!=="online"){let B;P.from===A.uid&&(B=P==null?void 0:P.value),B!=null&&B.status&&(r==="dev"&&console.log("user is online: ",B),A.status=B.status,localStorage.setItem("userInfo",JSON.stringify(A)))}}))}),(s=l==null?void 0:l.auth)==null||s.on("disconnect",y=>{l.auth.disconnect(),r==="dev"&&console.log("The device is disconnected from Auth server");let d=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");d.uid&&d.status!=="offline"&&(d.status="offline",localStorage.setItem("userInfo",JSON.stringify(d)))}),(a=l==null?void 0:l.database)==null||a.on("disconnect",y=>{r==="dev"&&console.log("The device is disconnected from Database server")}),l.storage.connected||l.storage.disconnect(),(c=l==null?void 0:l.storage)==null||c.on("disconnect",y=>{var d;r==="dev"&&console.log("The device is disconnected from Storage server"),(d=l==null?void 0:l.storage)==null||d.disconnect()}),l}catch(h){}}};function mh(n){this.message=n}mh.prototype=new Error,mh.prototype.name="InvalidCharacterError";var jy=typeof window!="undefined"&&window.atob&&window.atob.bind(window)||function(n){var e=String(n).replace(/=+$/,"");if(e.length%4==1)throw new mh("'atob' failed: The string to be decoded is not correctly encoded.");for(var t,r,i=0,o=0,s="";r=e.charAt(o++);~r&&(t=i%4?64*t+r:r,i++%4)?s+=String.fromCharCode(255&t>>(-2*i&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return s};function tN(n){var e=n.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw"Illegal base64url string!"}try{return function(t){return decodeURIComponent(jy(t).replace(/(.)/g,function(r,i){var o=i.charCodeAt(0).toString(16).toUpperCase();return o.length<2&&(o="0"+o),"%"+o}))}(e)}catch(t){return jy(e)}}function rc(n){this.message=n}function nN(n,e){if(typeof n!="string")throw new rc("Invalid token specified");var t=(e=e||{}).header===!0?0:1;try{return JSON.parse(tN(n.split(".")[t]))}catch(r){throw new rc("Invalid token specified: "+r.message)}}rc.prototype=new Error,rc.prototype.name="InvalidTokenError";function Y0(n,e){return function(){return n.apply(e,arguments)}}const{toString:rN}=Object.prototype,{getPrototypeOf:rf}=Object,Jc=(n=>e=>{const t=rN.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),mr=n=>(n=n.toLowerCase(),e=>Jc(e)===n),Yc=n=>e=>typeof e===n,{isArray:ko}=Array,us=Yc("undefined");function iN(n){return n!==null&&!us(n)&&n.constructor!==null&&!us(n.constructor)&&Nn(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const G0=mr("ArrayBuffer");function oN(n){let e;return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&G0(n.buffer),e}const sN=Yc("string"),Nn=Yc("function"),X0=Yc("number"),Gc=n=>n!==null&&typeof n=="object",aN=n=>n===!0||n===!1,Na=n=>{if(Jc(n)!=="object")return!1;const e=rf(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},cN=mr("Date"),lN=mr("File"),uN=mr("Blob"),hN=mr("FileList"),dN=n=>Gc(n)&&Nn(n.pipe),fN=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||Nn(n.append)&&((e=Jc(n))==="formdata"||e==="object"&&Nn(n.toString)&&n.toString()==="[object FormData]"))},pN=mr("URLSearchParams"),yN=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Rs(n,e,{allOwnKeys:t=!1}={}){if(n===null||typeof n=="undefined")return;let r,i;if(typeof n!="object"&&(n=[n]),ko(n))for(r=0,i=n.length;r<i;r++)e.call(null,n[r],r,n);else{const o=t?Object.getOwnPropertyNames(n):Object.keys(n),s=o.length;let a;for(r=0;r<s;r++)a=o[r],e.call(null,n[a],a,n)}}function Z0(n,e){e=e.toLowerCase();const t=Object.keys(n);let r=t.length,i;for(;r-- >0;)if(i=t[r],e===i.toLowerCase())return i;return null}const Q0=(()=>typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:global)(),ew=n=>!us(n)&&n!==Q0;function vh(){const{caseless:n}=ew(this)&&this||{},e={},t=(r,i)=>{const o=n&&Z0(e,i)||i;Na(e[o])&&Na(r)?e[o]=vh(e[o],r):Na(r)?e[o]=vh({},r):ko(r)?e[o]=r.slice():e[o]=r};for(let r=0,i=arguments.length;r<i;r++)arguments[r]&&Rs(arguments[r],t);return e}const gN=(n,e,t,{allOwnKeys:r}={})=>(Rs(e,(i,o)=>{t&&Nn(i)?n[o]=Y0(i,t):n[o]=i},{allOwnKeys:r}),n),mN=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),vN=(n,e,t,r)=>{n.prototype=Object.create(e.prototype,r),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),t&&Object.assign(n.prototype,t)},bN=(n,e,t,r)=>{let i,o,s;const a={};if(e=e||{},n==null)return e;do{for(i=Object.getOwnPropertyNames(n),o=i.length;o-- >0;)s=i[o],(!r||r(s,n,e))&&!a[s]&&(e[s]=n[s],a[s]=!0);n=t!==!1&&rf(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e},wN=(n,e,t)=>{n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;const r=n.indexOf(e,t);return r!==-1&&r===t},kN=n=>{if(!n)return null;if(ko(n))return n;let e=n.length;if(!X0(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=n[e];return t},xN=(n=>e=>n&&e instanceof n)(typeof Uint8Array!="undefined"&&rf(Uint8Array)),EN=(n,e)=>{const t=(n&&n[Symbol.iterator]).call(n);let r;for(;(r=t.next())&&!r.done;){const i=r.value;e.call(n,i[0],i[1])}},_N=(n,e)=>{let t;const r=[];for(;(t=n.exec(e))!==null;)r.push(t);return r},$N=mr("HTMLFormElement"),ON=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,r){return t.toUpperCase()+r}),Ry=(({hasOwnProperty:n})=>(e,t)=>n.call(e,t))(Object.prototype),AN=mr("RegExp"),tw=(n,e)=>{const t=Object.getOwnPropertyDescriptors(n),r={};Rs(t,(i,o)=>{e(i,o,n)!==!1&&(r[o]=i)}),Object.defineProperties(n,r)},SN=n=>{tw(n,(e,t)=>{if(Nn(n)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const r=n[t];if(Nn(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},TN=(n,e)=>{const t={},r=i=>{i.forEach(o=>{t[o]=!0})};return ko(n)?r(n):r(String(n).split(e)),t},PN=()=>{},jN=(n,e)=>(n=+n,Number.isFinite(n)?n:e),Hl="abcdefghijklmnopqrstuvwxyz",Iy="0123456789",nw={DIGIT:Iy,ALPHA:Hl,ALPHA_DIGIT:Hl+Hl.toUpperCase()+Iy},RN=(n=16,e=nw.ALPHA_DIGIT)=>{let t="";const{length:r}=e;for(;n--;)t+=e[Math.random()*r|0];return t};function IN(n){return!!(n&&Nn(n.append)&&n[Symbol.toStringTag]==="FormData"&&n[Symbol.iterator])}const CN=n=>{const e=new Array(10),t=(r,i)=>{if(Gc(r)){if(e.indexOf(r)>=0)return;if(!("toJSON"in r)){e[i]=r;const o=ko(r)?[]:{};return Rs(r,(s,a)=>{const c=t(s,i+1);!us(c)&&(o[a]=c)}),e[i]=void 0,o}}return r};return t(n,0)},NN=mr("AsyncFunction"),BN=n=>n&&(Gc(n)||Nn(n))&&Nn(n.then)&&Nn(n.catch),ee={isArray:ko,isArrayBuffer:G0,isBuffer:iN,isFormData:fN,isArrayBufferView:oN,isString:sN,isNumber:X0,isBoolean:aN,isObject:Gc,isPlainObject:Na,isUndefined:us,isDate:cN,isFile:lN,isBlob:uN,isRegExp:AN,isFunction:Nn,isStream:dN,isURLSearchParams:pN,isTypedArray:xN,isFileList:hN,forEach:Rs,merge:vh,extend:gN,trim:yN,stripBOM:mN,inherits:vN,toFlatObject:bN,kindOf:Jc,kindOfTest:mr,endsWith:wN,toArray:kN,forEachEntry:EN,matchAll:_N,isHTMLForm:$N,hasOwnProperty:Ry,hasOwnProp:Ry,reduceDescriptors:tw,freezeMethods:SN,toObjectSet:TN,toCamelCase:ON,noop:PN,toFiniteNumber:jN,findKey:Z0,global:Q0,isContextDefined:ew,ALPHABET:nw,generateString:RN,isSpecCompliantForm:IN,toJSONObject:CN,isAsyncFn:NN,isThenable:BN};function We(n,e,t,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),r&&(this.request=r),i&&(this.response=i)}ee.inherits(We,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ee.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const rw=We.prototype,iw={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{iw[n]={value:n}});Object.defineProperties(We,iw);Object.defineProperty(rw,"isAxiosError",{value:!0});We.from=(n,e,t,r,i,o)=>{const s=Object.create(rw);return ee.toFlatObject(n,s,function(a){return a!==Error.prototype},a=>a!=="isAxiosError"),We.call(s,n.message,e,t,r,i),s.cause=n,s.name=n.name,o&&Object.assign(s,o),s};const LN=null;function bh(n){return ee.isPlainObject(n)||ee.isArray(n)}function ow(n){return ee.endsWith(n,"[]")?n.slice(0,-2):n}function Cy(n,e,t){return n?n.concat(e).map(function(r,i){return r=ow(r),!t&&i?"["+r+"]":r}).join(t?".":""):e}function DN(n){return ee.isArray(n)&&!n.some(bh)}const qN=ee.toFlatObject(ee,{},null,function(n){return/^is[A-Z]/.test(n)});function Xc(n,e,t){if(!ee.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,t=ee.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(d,f){return!ee.isUndefined(f[d])});const r=t.metaTokens,i=t.visitor||l,o=t.dots,s=t.indexes,a=(t.Blob||typeof Blob!="undefined"&&Blob)&&ee.isSpecCompliantForm(e);if(!ee.isFunction(i))throw new TypeError("visitor must be a function");function c(d){if(d===null)return"";if(ee.isDate(d))return d.toISOString();if(!a&&ee.isBlob(d))throw new We("Blob is not supported. Use a Buffer instead.");return ee.isArrayBuffer(d)||ee.isTypedArray(d)?a&&typeof Blob=="function"?new Blob([d]):Buffer.from(d):d}function l(d,f,g){let _=d;if(d&&!g&&typeof d=="object"){if(ee.endsWith(f,"{}"))f=r?f:f.slice(0,-2),d=JSON.stringify(d);else if(ee.isArray(d)&&DN(d)||(ee.isFileList(d)||ee.endsWith(f,"[]"))&&(_=ee.toArray(d)))return f=ow(f),_.forEach(function(A,P){!(ee.isUndefined(A)||A===null)&&e.append(s===!0?Cy([f],P,o):s===null?f:f+"[]",c(A))}),!1}return bh(d)?!0:(e.append(Cy(g,f,o),c(d)),!1)}const u=[],h=Object.assign(qN,{defaultVisitor:l,convertValue:c,isVisitable:bh});function y(d,f){if(!ee.isUndefined(d)){if(u.indexOf(d)!==-1)throw Error("Circular reference detected in "+f.join("."));u.push(d),ee.forEach(d,function(g,_){(!(ee.isUndefined(g)||g===null)&&i.call(e,g,ee.isString(_)?_.trim():_,f,h))===!0&&y(g,f?f.concat(_):[_])}),u.pop()}}if(!ee.isObject(n))throw new TypeError("data must be an object");return y(n),e}function Ny(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(t){return e[t]})}function of(n,e){this._pairs=[],n&&Xc(n,this,e)}const sw=of.prototype;sw.append=function(n,e){this._pairs.push([n,e])};sw.toString=function(n){const e=n?function(t){return n.call(this,t,Ny)}:Ny;return this._pairs.map(function(t){return e(t[0])+"="+e(t[1])},"").join("&")};function UN(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function aw(n,e,t){if(!e)return n;const r=t&&t.encode||UN,i=t&&t.serialize;let o;if(i?o=i(e,t):o=ee.isURLSearchParams(e)?e.toString():new of(e,t).toString(r),o){const s=n.indexOf("#");s!==-1&&(n=n.slice(0,s)),n+=(n.indexOf("?")===-1?"?":"&")+o}return n}class MN{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){ee.forEach(this.handlers,function(t){t!==null&&e(t)})}}const By=MN,cw={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},FN=typeof URLSearchParams!="undefined"?URLSearchParams:of,VN=typeof FormData!="undefined"?FormData:null,KN=typeof Blob!="undefined"?Blob:null,WN=(()=>{let n;return typeof navigator!="undefined"&&((n=navigator.product)==="ReactNative"||n==="NativeScript"||n==="NS")?!1:typeof window!="undefined"&&typeof document!="undefined"})(),zN=(()=>typeof WorkerGlobalScope!="undefined"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),sr={isBrowser:!0,classes:{URLSearchParams:FN,FormData:VN,Blob:KN},isStandardBrowserEnv:WN,isStandardBrowserWebWorkerEnv:zN,protocols:["http","https","file","blob","url","data"]};function HN(n,e){return Xc(n,new sr.classes.URLSearchParams,Object.assign({visitor:function(t,r,i,o){return sr.isNode&&ee.isBuffer(t)?(this.append(r,t.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},e))}function JN(n){return ee.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function YN(n){const e={},t=Object.keys(n);let r;const i=t.length;let o;for(r=0;r<i;r++)o=t[r],e[o]=n[o];return e}function lw(n){function e(t,r,i,o){let s=t[o++];const a=Number.isFinite(+s),c=o>=t.length;return s=!s&&ee.isArray(i)?i.length:s,c?(ee.hasOwnProp(i,s)?i[s]=[i[s],r]:i[s]=r,!a):((!i[s]||!ee.isObject(i[s]))&&(i[s]=[]),e(t,r,i[s],o)&&ee.isArray(i[s])&&(i[s]=YN(i[s])),!a)}if(ee.isFormData(n)&&ee.isFunction(n.entries)){const t={};return ee.forEachEntry(n,(r,i)=>{e(JN(r),i,t,0)}),t}return null}const GN={"Content-Type":void 0};function XN(n,e,t){if(ee.isString(n))try{return(e||JSON.parse)(n),ee.trim(n)}catch(r){if(r.name!=="SyntaxError")throw r}return(t||JSON.stringify)(n)}const Zc={transitional:cw,adapter:["xhr","http"],transformRequest:[function(n,e){const t=e.getContentType()||"",r=t.indexOf("application/json")>-1,i=ee.isObject(n);if(i&&ee.isHTMLForm(n)&&(n=new FormData(n)),ee.isFormData(n))return r&&r?JSON.stringify(lw(n)):n;if(ee.isArrayBuffer(n)||ee.isBuffer(n)||ee.isStream(n)||ee.isFile(n)||ee.isBlob(n))return n;if(ee.isArrayBufferView(n))return n.buffer;if(ee.isURLSearchParams(n))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),n.toString();let o;if(i){if(t.indexOf("application/x-www-form-urlencoded")>-1)return HN(n,this.formSerializer).toString();if((o=ee.isFileList(n))||t.indexOf("multipart/form-data")>-1){const s=this.env&&this.env.FormData;return Xc(o?{"files[]":n}:n,s&&new s,this.formSerializer)}}return i||r?(e.setContentType("application/json",!1),XN(n)):n}],transformResponse:[function(n){const e=this.transitional||Zc.transitional,t=e&&e.forcedJSONParsing,r=this.responseType==="json";if(n&&ee.isString(n)&&(t&&!this.responseType||r)){const i=!(e&&e.silentJSONParsing)&&r;try{return JSON.parse(n)}catch(o){if(i)throw o.name==="SyntaxError"?We.from(o,We.ERR_BAD_RESPONSE,this,null,this.response):o}}return n}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:sr.classes.FormData,Blob:sr.classes.Blob},validateStatus:function(n){return n>=200&&n<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};ee.forEach(["delete","get","head"],function(n){Zc.headers[n]={}});ee.forEach(["post","put","patch"],function(n){Zc.headers[n]=ee.merge(GN)});const sf=Zc,ZN=ee.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),QN=n=>{const e={};let t,r,i;return n&&n.split(`
`).forEach(function(o){i=o.indexOf(":"),t=o.substring(0,i).trim().toLowerCase(),r=o.substring(i+1).trim(),!(!t||e[t]&&ZN[t])&&(t==="set-cookie"?e[t]?e[t].push(r):e[t]=[r]:e[t]=e[t]?e[t]+", "+r:r)}),e},Ly=Symbol("internals");function Ro(n){return n&&String(n).trim().toLowerCase()}function Ba(n){return n===!1||n==null?n:ee.isArray(n)?n.map(Ba):String(n)}function e2(n){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=t.exec(n);)e[r[1]]=r[2];return e}const t2=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function Jl(n,e,t,r,i){if(ee.isFunction(r))return r.call(this,e,t);if(i&&(e=t),!!ee.isString(e)){if(ee.isString(r))return e.indexOf(r)!==-1;if(ee.isRegExp(r))return r.test(e)}}function n2(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,r)=>t.toUpperCase()+r)}function r2(n,e){const t=ee.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(n,r+t,{value:function(i,o,s){return this[r].call(this,e,i,o,s)},configurable:!0})})}class Qc{constructor(e){e&&this.set(e)}set(e,t,r){const i=this;function o(a,c,l){const u=Ro(c);if(!u)throw new Error("header name must be a non-empty string");const h=ee.findKey(i,u);(!h||i[h]===void 0||l===!0||l===void 0&&i[h]!==!1)&&(i[h||c]=Ba(a))}const s=(a,c)=>ee.forEach(a,(l,u)=>o(l,u,c));return ee.isPlainObject(e)||e instanceof this.constructor?s(e,t):ee.isString(e)&&(e=e.trim())&&!t2(e)?s(QN(e),t):e!=null&&o(t,e,r),this}get(e,t){if(e=Ro(e),e){const r=ee.findKey(this,e);if(r){const i=this[r];if(!t)return i;if(t===!0)return e2(i);if(ee.isFunction(t))return t.call(this,i,r);if(ee.isRegExp(t))return t.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Ro(e),e){const r=ee.findKey(this,e);return!!(r&&this[r]!==void 0&&(!t||Jl(this,this[r],r,t)))}return!1}delete(e,t){const r=this;let i=!1;function o(s){if(s=Ro(s),s){const a=ee.findKey(r,s);a&&(!t||Jl(r,r[a],a,t))&&(delete r[a],i=!0)}}return ee.isArray(e)?e.forEach(o):o(e),i}clear(e){const t=Object.keys(this);let r=t.length,i=!1;for(;r--;){const o=t[r];(!e||Jl(this,this[o],o,e,!0))&&(delete this[o],i=!0)}return i}normalize(e){const t=this,r={};return ee.forEach(this,(i,o)=>{const s=ee.findKey(r,o);if(s){t[s]=Ba(i),delete t[o];return}const a=e?n2(o):String(o).trim();a!==o&&delete t[o],t[a]=Ba(i),r[a]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return ee.forEach(this,(r,i)=>{r!=null&&r!==!1&&(t[i]=e&&ee.isArray(r)?r.join(", "):r)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const r=new this(e);return t.forEach(i=>r.set(i)),r}static accessor(e){const t=(this[Ly]=this[Ly]={accessors:{}}).accessors,r=this.prototype;function i(o){const s=Ro(o);t[s]||(r2(r,o),t[s]=!0)}return ee.isArray(e)?e.forEach(i):i(e),this}}Qc.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);ee.freezeMethods(Qc.prototype);ee.freezeMethods(Qc);const _r=Qc;function Yl(n,e){const t=this||sf,r=e||t,i=_r.from(r.headers);let o=r.data;return ee.forEach(n,function(s){o=s.call(t,o,i.normalize(),e?e.status:void 0)}),i.normalize(),o}function uw(n){return!!(n&&n.__CANCEL__)}function Is(n,e,t){We.call(this,n==null?"canceled":n,We.ERR_CANCELED,e,t),this.name="CanceledError"}ee.inherits(Is,We,{__CANCEL__:!0});function i2(n,e,t){const r=t.config.validateStatus;!t.status||!r||r(t.status)?n(t):e(new We("Request failed with status code "+t.status,[We.ERR_BAD_REQUEST,We.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}const o2=sr.isStandardBrowserEnv?function(){return{write:function(n,e,t,r,i,o){const s=[];s.push(n+"="+encodeURIComponent(e)),ee.isNumber(t)&&s.push("expires="+new Date(t).toGMTString()),ee.isString(r)&&s.push("path="+r),ee.isString(i)&&s.push("domain="+i),o===!0&&s.push("secure"),document.cookie=s.join("; ")},read:function(n){const e=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(n){this.write(n,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}();function s2(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function a2(n,e){return e?n.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):n}function hw(n,e){return n&&!s2(e)?a2(n,e):e}const c2=sr.isStandardBrowserEnv?function(){const n=/(msie|trident)/i.test(navigator.userAgent),e=document.createElement("a");let t;function r(i){let o=i;return n&&(e.setAttribute("href",o),o=e.href),e.setAttribute("href",o),{href:e.href,protocol:e.protocol?e.protocol.replace(/:$/,""):"",host:e.host,search:e.search?e.search.replace(/^\?/,""):"",hash:e.hash?e.hash.replace(/^#/,""):"",hostname:e.hostname,port:e.port,pathname:e.pathname.charAt(0)==="/"?e.pathname:"/"+e.pathname}}return t=r(window.location.href),function(i){const o=ee.isString(i)?r(i):i;return o.protocol===t.protocol&&o.host===t.host}}():function(){return function(){return!0}}();function l2(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function u2(n,e){n=n||10;const t=new Array(n),r=new Array(n);let i=0,o=0,s;return e=e!==void 0?e:1e3,function(a){const c=Date.now(),l=r[o];s||(s=c),t[i]=a,r[i]=c;let u=o,h=0;for(;u!==i;)h+=t[u++],u=u%n;if(i=(i+1)%n,i===o&&(o=(o+1)%n),c-s<e)return;const y=l&&c-l;return y?Math.round(h*1e3/y):void 0}}function Dy(n,e){let t=0;const r=u2(50,250);return i=>{const o=i.loaded,s=i.lengthComputable?i.total:void 0,a=o-t,c=r(a),l=o<=s;t=o;const u={loaded:o,total:s,progress:s?o/s:void 0,bytes:a,rate:c||void 0,estimated:c&&s&&l?(s-o)/c:void 0,event:i};u[e?"download":"upload"]=!0,n(u)}}const h2=typeof XMLHttpRequest!="undefined",d2=h2&&function(n){return new Promise(function(e,t){let r=n.data;const i=_r.from(n.headers).normalize(),o=n.responseType;let s;function a(){n.cancelToken&&n.cancelToken.unsubscribe(s),n.signal&&n.signal.removeEventListener("abort",s)}ee.isFormData(r)&&(sr.isStandardBrowserEnv||sr.isStandardBrowserWebWorkerEnv?i.setContentType(!1):i.setContentType("multipart/form-data;",!1));let c=new XMLHttpRequest;if(n.auth){const y=n.auth.username||"",d=n.auth.password?unescape(encodeURIComponent(n.auth.password)):"";i.set("Authorization","Basic "+btoa(y+":"+d))}const l=hw(n.baseURL,n.url);c.open(n.method.toUpperCase(),aw(l,n.params,n.paramsSerializer),!0),c.timeout=n.timeout;function u(){if(!c)return;const y=_r.from("getAllResponseHeaders"in c&&c.getAllResponseHeaders()),d={data:!o||o==="text"||o==="json"?c.responseText:c.response,status:c.status,statusText:c.statusText,headers:y,config:n,request:c};i2(function(f){e(f),a()},function(f){t(f),a()},d),c=null}if("onloadend"in c?c.onloadend=u:c.onreadystatechange=function(){!c||c.readyState!==4||c.status===0&&!(c.responseURL&&c.responseURL.indexOf("file:")===0)||setTimeout(u)},c.onabort=function(){!c||(t(new We("Request aborted",We.ECONNABORTED,n,c)),c=null)},c.onerror=function(){t(new We("Network Error",We.ERR_NETWORK,n,c)),c=null},c.ontimeout=function(){let y=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const d=n.transitional||cw;n.timeoutErrorMessage&&(y=n.timeoutErrorMessage),t(new We(y,d.clarifyTimeoutError?We.ETIMEDOUT:We.ECONNABORTED,n,c)),c=null},sr.isStandardBrowserEnv){const y=(n.withCredentials||c2(l))&&n.xsrfCookieName&&o2.read(n.xsrfCookieName);y&&i.set(n.xsrfHeaderName,y)}r===void 0&&i.setContentType(null),"setRequestHeader"in c&&ee.forEach(i.toJSON(),function(y,d){c.setRequestHeader(d,y)}),ee.isUndefined(n.withCredentials)||(c.withCredentials=!!n.withCredentials),o&&o!=="json"&&(c.responseType=n.responseType),typeof n.onDownloadProgress=="function"&&c.addEventListener("progress",Dy(n.onDownloadProgress,!0)),typeof n.onUploadProgress=="function"&&c.upload&&c.upload.addEventListener("progress",Dy(n.onUploadProgress)),(n.cancelToken||n.signal)&&(s=y=>{!c||(t(!y||y.type?new Is(null,n,c):y),c.abort(),c=null)},n.cancelToken&&n.cancelToken.subscribe(s),n.signal&&(n.signal.aborted?s():n.signal.addEventListener("abort",s)));const h=l2(l);if(h&&sr.protocols.indexOf(h)===-1){t(new We("Unsupported protocol "+h+":",We.ERR_BAD_REQUEST,n));return}c.send(r||null)})},La={http:LN,xhr:d2};ee.forEach(La,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch(t){}Object.defineProperty(n,"adapterName",{value:e})}});const f2={getAdapter:n=>{n=ee.isArray(n)?n:[n];const{length:e}=n;let t,r;for(let i=0;i<e&&(t=n[i],!(r=ee.isString(t)?La[t.toLowerCase()]:t));i++);if(!r)throw r===!1?new We(`Adapter ${t} is not supported by the environment`,"ERR_NOT_SUPPORT"):new Error(ee.hasOwnProp(La,t)?`Adapter '${t}' is not available in the build`:`Unknown adapter '${t}'`);if(!ee.isFunction(r))throw new TypeError("adapter is not a function");return r},adapters:La};function Gl(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new Is(null,n)}function qy(n){return Gl(n),n.headers=_r.from(n.headers),n.data=Yl.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),f2.getAdapter(n.adapter||sf.adapter)(n).then(function(e){return Gl(n),e.data=Yl.call(n,n.transformResponse,e),e.headers=_r.from(e.headers),e},function(e){return uw(e)||(Gl(n),e&&e.response&&(e.response.data=Yl.call(n,n.transformResponse,e.response),e.response.headers=_r.from(e.response.headers))),Promise.reject(e)})}const Uy=n=>n instanceof _r?n.toJSON():n;function uo(n,e){e=e||{};const t={};function r(l,u,h){return ee.isPlainObject(l)&&ee.isPlainObject(u)?ee.merge.call({caseless:h},l,u):ee.isPlainObject(u)?ee.merge({},u):ee.isArray(u)?u.slice():u}function i(l,u,h){if(ee.isUndefined(u)){if(!ee.isUndefined(l))return r(void 0,l,h)}else return r(l,u,h)}function o(l,u){if(!ee.isUndefined(u))return r(void 0,u)}function s(l,u){if(ee.isUndefined(u)){if(!ee.isUndefined(l))return r(void 0,l)}else return r(void 0,u)}function a(l,u,h){if(h in e)return r(l,u);if(h in n)return r(void 0,l)}const c={url:o,method:o,data:o,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:a,headers:(l,u)=>i(Uy(l),Uy(u),!0)};return ee.forEach(Object.keys(Object.assign({},n,e)),function(l){const u=c[l]||i,h=u(n[l],e[l],l);ee.isUndefined(h)&&u!==a||(t[l]=h)}),t}const dw="1.4.0",af={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{af[n]=function(t){return typeof t===n||"a"+(e<1?"n ":" ")+n}});const My={};af.transitional=function(n,e,t){function r(i,o){return"[Axios v"+dw+"] Transitional option '"+i+"'"+o+(t?". "+t:"")}return(i,o,s)=>{if(n===!1)throw new We(r(o," has been removed"+(e?" in "+e:"")),We.ERR_DEPRECATED);return e&&!My[o]&&(My[o]=!0,console.warn(r(o," has been deprecated since v"+e+" and will be removed in the near future"))),n?n(i,o,s):!0}};function p2(n,e,t){if(typeof n!="object")throw new We("options must be an object",We.ERR_BAD_OPTION_VALUE);const r=Object.keys(n);let i=r.length;for(;i-- >0;){const o=r[i],s=e[o];if(s){const a=n[o],c=a===void 0||s(a,o,n);if(c!==!0)throw new We("option "+o+" must be "+c,We.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new We("Unknown option "+o,We.ERR_BAD_OPTION)}}const wh={assertOptions:p2,validators:af},Jr=wh.validators;class ic{constructor(e){this.defaults=e,this.interceptors={request:new By,response:new By}}request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=uo(this.defaults,t);const{transitional:r,paramsSerializer:i,headers:o}=t;r!==void 0&&wh.assertOptions(r,{silentJSONParsing:Jr.transitional(Jr.boolean),forcedJSONParsing:Jr.transitional(Jr.boolean),clarifyTimeoutError:Jr.transitional(Jr.boolean)},!1),i!=null&&(ee.isFunction(i)?t.paramsSerializer={serialize:i}:wh.assertOptions(i,{encode:Jr.function,serialize:Jr.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let s;s=o&&ee.merge(o.common,o[t.method]),s&&ee.forEach(["delete","get","head","post","put","patch","common"],f=>{delete o[f]}),t.headers=_r.concat(s,o);const a=[];let c=!0;this.interceptors.request.forEach(function(f){typeof f.runWhen=="function"&&f.runWhen(t)===!1||(c=c&&f.synchronous,a.unshift(f.fulfilled,f.rejected))});const l=[];this.interceptors.response.forEach(function(f){l.push(f.fulfilled,f.rejected)});let u,h=0,y;if(!c){const f=[qy.bind(this),void 0];for(f.unshift.apply(f,a),f.push.apply(f,l),y=f.length,u=Promise.resolve(t);h<y;)u=u.then(f[h++],f[h++]);return u}y=a.length;let d=t;for(h=0;h<y;){const f=a[h++],g=a[h++];try{d=f(d)}catch(_){g.call(this,_);break}}try{u=qy.call(this,d)}catch(f){return Promise.reject(f)}for(h=0,y=l.length;h<y;)u=u.then(l[h++],l[h++]);return u}getUri(e){e=uo(this.defaults,e);const t=hw(e.baseURL,e.url);return aw(t,e.params,e.paramsSerializer)}}ee.forEach(["delete","get","head","options"],function(n){ic.prototype[n]=function(e,t){return this.request(uo(t||{},{method:n,url:e,data:(t||{}).data}))}});ee.forEach(["post","put","patch"],function(n){function e(t){return function(r,i,o){return this.request(uo(o||{},{method:n,headers:t?{"Content-Type":"multipart/form-data"}:{},url:r,data:i}))}}ic.prototype[n]=e(),ic.prototype[n+"Form"]=e(!0)});const Da=ic;class cf{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(i){t=i});const r=this;this.promise.then(i=>{if(!r._listeners)return;let o=r._listeners.length;for(;o-- >0;)r._listeners[o](i);r._listeners=null}),this.promise.then=i=>{let o;const s=new Promise(a=>{r.subscribe(a),o=a}).then(i);return s.cancel=function(){r.unsubscribe(o)},s},e(function(i,o,s){r.reason||(r.reason=new Is(i,o,s),t(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}static source(){let e;return{token:new cf(function(t){e=t}),cancel:e}}}const y2=cf;function g2(n){return function(e){return n.apply(null,e)}}function m2(n){return ee.isObject(n)&&n.isAxiosError===!0}const kh={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(kh).forEach(([n,e])=>{kh[e]=n});const v2=kh;function fw(n){const e=new Da(n),t=Y0(Da.prototype.request,e);return ee.extend(t,Da.prototype,e,{allOwnKeys:!0}),ee.extend(t,e,null,{allOwnKeys:!0}),t.create=function(r){return fw(uo(n,r))},t}const $t=fw(sf);$t.Axios=Da;$t.CanceledError=Is;$t.CancelToken=y2;$t.isCancel=uw;$t.VERSION=dw;$t.toFormData=Xc;$t.AxiosError=We;$t.Cancel=$t.CanceledError;$t.all=function(n){return Promise.all(n)};$t.spread=g2;$t.isAxiosError=m2;$t.mergeConfig=uo;$t.AxiosHeaders=_r;$t.formToJSON=n=>lw(ee.isHTMLForm(n)?new FormData(n):n);$t.HttpStatusCode=v2;$t.default=$t;const b2=$t,Fy={init:({API_KEY:n})=>(...e)=>W(void 0,[...e],function*(t="post",r="/",i={},o={}){var s,a,c,l;const u=localStorage.getItem("accessToken");let h={Accept:"application/json","Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Key":n,"Access-Control-Allow-Methods":"POST, GET, OPTIONS, PUT, DELETE, HEAD,PATCH","Access-Control-Allow-Headers":"X-PINGOTHER, Origin, X-Requested-With, Content-Type, Accept","Access-Control-Max-Age":"1728000"};u&&(h.Authorization="Bearer "+u);const y=r;typeof(i==null?void 0:i.get)=="function"&&(i==null?void 0:i.get("file"))&&(h["Content-Type"]="multipart/form-data"),o!=null&&o.headers&&(h=Object.assign(...h,...o.headers),delete o.headers);const d=Object.assign({mode:"cors",method:t,url:y,data:i,headers:h},o);let f={};try{const g=yield b2(d);f.data=((s=g==null?void 0:g.data)==null?void 0:s.data)||(g==null?void 0:g.data),f.data||(f.data={})}catch(g){f.error=((c=(a=g.response)==null?void 0:a.data)==null?void 0:c.error)||((l=g.response)==null?void 0:l.error),f.error||(f.error={})}return f})};let na;const w2=new Uint8Array(16);function k2(){if(!na&&(na=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!na))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return na(w2)}const Mt=[];for(let n=0;n<256;++n)Mt.push((n+256).toString(16).slice(1));function x2(n,e=0){return(Mt[n[e+0]]+Mt[n[e+1]]+Mt[n[e+2]]+Mt[n[e+3]]+"-"+Mt[n[e+4]]+Mt[n[e+5]]+"-"+Mt[n[e+6]]+Mt[n[e+7]]+"-"+Mt[n[e+8]]+Mt[n[e+9]]+"-"+Mt[n[e+10]]+Mt[n[e+11]]+Mt[n[e+12]]+Mt[n[e+13]]+Mt[n[e+14]]+Mt[n[e+15]]).toLowerCase()}const E2=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Vy={randomUUID:E2};function Xl(n,e,t){if(Vy.randomUUID&&!e&&!n)return Vy.randomUUID();n=n||{};const r=n.random||(n.rng||k2)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let i=0;i<16;++i)e[t+i]=r[i];return e}return x2(r)}var pw={exports:{}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function i(c,l,u){this.fn=c,this.context=l,this.once=u||!1}function o(c,l,u,h,y){if(typeof u!="function")throw new TypeError("The listener must be a function");var d=new i(u,h||c,y),f=t?t+l:l;return c._events[f]?c._events[f].fn?c._events[f]=[c._events[f],d]:c._events[f].push(d):(c._events[f]=d,c._eventsCount++),c}function s(c,l){--c._eventsCount===0?c._events=new r:delete c._events[l]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var c=[],l,u;if(this._eventsCount===0)return c;for(u in l=this._events)e.call(l,u)&&c.push(t?u.slice(1):u);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(l)):c},a.prototype.listeners=function(c){var l=t?t+c:c,u=this._events[l];if(!u)return[];if(u.fn)return[u.fn];for(var h=0,y=u.length,d=new Array(y);h<y;h++)d[h]=u[h].fn;return d},a.prototype.listenerCount=function(c){var l=t?t+c:c,u=this._events[l];return u?u.fn?1:u.length:0},a.prototype.emit=function(c,l,u,h,y,d){var f=t?t+c:c;if(!this._events[f])return!1;var g=this._events[f],_=arguments.length,A,P;if(g.fn){switch(g.once&&this.removeListener(c,g.fn,void 0,!0),_){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,l),!0;case 3:return g.fn.call(g.context,l,u),!0;case 4:return g.fn.call(g.context,l,u,h),!0;case 5:return g.fn.call(g.context,l,u,h,y),!0;case 6:return g.fn.call(g.context,l,u,h,y,d),!0}for(P=1,A=new Array(_-1);P<_;P++)A[P-1]=arguments[P];g.fn.apply(g.context,A)}else{var B=g.length,C;for(P=0;P<B;P++)switch(g[P].once&&this.removeListener(c,g[P].fn,void 0,!0),_){case 1:g[P].fn.call(g[P].context);break;case 2:g[P].fn.call(g[P].context,l);break;case 3:g[P].fn.call(g[P].context,l,u);break;case 4:g[P].fn.call(g[P].context,l,u,h);break;default:if(!A)for(C=1,A=new Array(_-1);C<_;C++)A[C-1]=arguments[C];g[P].fn.apply(g[P].context,A)}}return!0},a.prototype.on=function(c,l,u){return o(this,c,l,u,!1)},a.prototype.once=function(c,l,u){return o(this,c,l,u,!0)},a.prototype.removeListener=function(c,l,u,h){var y=t?t+c:c;if(!this._events[y])return this;if(!l)return s(this,y),this;var d=this._events[y];if(d.fn)d.fn===l&&(!h||d.once)&&(!u||d.context===u)&&s(this,y);else{for(var f=0,g=[],_=d.length;f<_;f++)(d[f].fn!==l||h&&!d[f].once||u&&d[f].context!==u)&&g.push(d[f]);g.length?this._events[y]=g.length===1?g[0]:g:s(this,y)}return this},a.prototype.removeAllListeners=function(c){var l;return c?(l=t?t+c:c,this._events[l]&&s(this,l)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,n.exports=a})(pw);const _2=pw.exports;var $2={exports:{}};(function(n,e){(function(t){var r=this,i=Object.prototype.hasOwnProperty,o=function(c){for(var l=new Array(c.length),u=c.length,h=u-1;u--;)l[h-u]=c[u];return l},s=function(){var c=Array.prototype.slice.call(arguments);return c.length==2?s.find.apply(this,c):s.transform.apply(this,c)};s.find=function(c,l){return s.get(l,c)},s.memoizePath=!0;var a={};s.get=function(c,l,u){if(c===t||c===null||l===t||l===null)return u;var h;for(typeof l=="string"?s.memoizePath?a[l]?h=a[l].slice(0):(h=l.split(".").reverse(),a[l]=h.slice(0)):h=l.split(".").reverse():Array.isArray(l)&&(h=o(l));h.length&&(c=c[h.pop()])!==t&&c!==null;);return c===null&&h.length&&(c=t),c===t?u:c},s.exists=function(c,l){return s.get(c,l)!==t},s.set=function(c,l,u,h){var y=Array.isArray(l)?l:l.split("."),d=c,f,g=y.length;if(typeof d!="object")throw new Error("Parent is not an object.");for(var _=0;_<g;_++)if(f=y[_],(!i.call(d,f)||d[f]===t||(typeof d[f]!="object"||d[f]===null)&&h&&h.force===!0)&&(d[f]={}),_==g-1)d[f]=u;else{if(typeof d[f]!="object"||d[f]===null)throw new Error('Target key "'+f+'" is not suitable for a nested value. (It is in use as non-object. Set `force` to `true` to override.)');d=d[f]}d[f]=u},s.default=function(c,l,u){s.get(c,l)===t&&s.set(c,l,u)},s.transform=function(c,l){if(Array.isArray(c))return c.map(function(C){return s.transform(C,l)});l=l||{},l.delimiter=l.delimiter||".";var u,h,y,d,f={},g,_=Object.keys(c),A=_.length,P;for(P=0;P<A;P++)if(g=_[P],g.indexOf(l.delimiter)!==-1){u=g.split(l.delimiter),h=u.length,d=f;for(var B=0;B<h&&(y=u[B],B!=h-1&&!d.hasOwnProperty(y)&&(d[y]={}),B==h-1&&(d[y]=c[g]),d=d[y],d!==null);B++);}else f[g]=c[g];return f},s.flatten=function(c,l){typeof l=="undefined"&&(l=".");var u={},h,y;for(var d in c)if(i.call(c,d))if(h=c[d],Object.prototype.toString.call(h)==="[object Object]"){y=s.flatten(h,l);for(var f in y)u[d+l+f]=y[f]}else u[d]=h;return u},s.paths=function(c,l){var u=[],h,y;if(l=l||[],typeof c=="object")for(y in c)h=c[y],typeof h=="object"&&h!==null?u=u.concat(s.paths(h,l.concat([y]))):u.push(l.concat(y).join("."));else throw new Error("Paths was called with non-object argument.");return u},n.exports?n.exports=s:(r.Dottie=s,r.Dot=s,typeof t=="function"&&t([],function(){return s}))})()})($2);function Zl(n,e){try{n(e)}catch(t){console.error("Error in subscription callback",t)}}const Yr=Symbol("subscriptions"),Gr=Symbol("oneTimeEvents");class ho{constructor(){this[Yr]=[],this[Gr]=new Map}on(e,t){return this[Gr].has(e)?Zl(t,this[Gr].get(e)):(this[Yr].push({event:e,callback:t,once:!1}),this)}off(e,t){return this[Yr]=this[Yr].filter(r=>r.event!==e||t&&r.callback!==t),this}once(e,t){return new Promise(r=>{const i=o=>{r(o),t==null||t(o)};this[Gr].has(e)?Zl(i,this[Gr].get(e)):this[Yr].push({event:e,callback:i,once:!0})})}emit(e,t){if(this[Gr].has(e))throw new Error(`Event "${e}" was supposed to be emitted only once`);for(let r=0;r<this[Yr].length;r++){const i=this[Yr][r];i.event===e&&(Zl(i.callback,t),i.once&&(this[Yr].splice(r,1),r--))}return this}emitOnce(e,t){if(this[Gr].has(e))throw new Error(`Event "${e}" was supposed to be emitted only once`);return this.emit(e,t),this[Gr].set(e,t),this.off(e),this}pipe(e,t){this.on(e,r=>{t.emit(e,r)})}pipeOnce(e,t){this.once(e,r=>{t.emitOnce(e,r)})}}function Xr(n){return n=n.replace(/\[/g,"/[").replace(/^\/+/,"").replace(/\/+$/,""),n.length===0?[]:n.split("/").map(e=>e.startsWith("[")?parseInt(e.slice(1,-1)):e)}class G{static get(e){return new G(e)}static getChildPath(e,t){return G.get(e).child(t).path}static getPathKeys(e){return Xr(e)}constructor(e){typeof e=="string"?this.keys=Xr(e):e instanceof Array&&(this.keys=e),this.path=this.keys.reduce((t,r,i)=>i===0?`${r}`:typeof r=="string"?`${t}/${r}`:`${t}[${r}]`,"")}get key(){return this.keys.length===0?null:this.keys.slice(-1)[0]}get parent(){if(this.keys.length==0)return null;const e=this.keys.slice(0,-1);return new G(e)}get parentPath(){return this.keys.length===0?null:this.parent.path}child(e){if(typeof e=="string"){if(e.length===0)throw new Error(`child key for path "${this.path}" cannot be empty`);const t=Xr(e);t.forEach(r=>{if(typeof r=="string"){if(/[\x00-\x08\x0b\x0c\x0e-\x1f/[\]\\]/.test(r))throw new Error(`Invalid child key "${r}" for path "${this.path}". Keys cannot contain control characters or any of the following characters: \\ / [ ]`);if(r.length>128)throw new Error(`child key "${r}" for path "${this.path}" is too long. Max key length is 128`);if(r.length===0)throw new Error(`child key for path "${this.path}" cannot be empty`)}}),e=t}return new G(this.keys.concat(e))}childPath(e){return this.child(e).path}get pathKeys(){return this.keys}static extractVariables(e,t){if(!e.includes("*")&&!e.includes("$"))return[];const r=Xr(e),i=Xr(t);let o=0;const s={get length(){return o}};return r.forEach((a,c)=>{const l=i[c];if(a==="*")s[o++]=l;else if(typeof a=="string"&&a[0]==="$"){s[o++]=l,s[a]=l;const u=a.slice(1);typeof s[u]=="undefined"&&(s[u]=l)}}),s}static fillVariables(e,t){if(e.indexOf("*")<0&&e.indexOf("$")<0)return e;const r=Xr(e),i=Xr(t),o=r.map((a,c)=>{if(a===i[c]||c>=i.length)return a;if(typeof a=="string"&&(a==="*"||a[0]==="$"))return i[c];throw new Error(`Path "${t}" cannot be used to fill variables of path "${e}" because they do not match`)});let s="";return o.forEach(a=>{typeof a=="number"?s+=`[${a}]`:(s.length>0&&(s+="/"),s+=a)}),s}static fillVariables2(e,t){if(typeof t!="object"||Object.keys(t).length===0)return e;const r=Xr(e);let i=0;return r.reduce((o,s)=>typeof s=="string"&&(s==="*"||s.startsWith("$"))?G.getChildPath(o,t[i++]):G.getChildPath(o,s),"")}equals(e){const t=e instanceof G?e:new G(e);return this.path===t.path?!0:this.keys.length!==t.keys.length?!1:this.keys.every((r,i)=>{const o=t.keys[i];return o===r||typeof o=="string"&&(o==="*"||o[0]==="$")||typeof r=="string"&&(r==="*"||r[0]==="$")})}isAncestorOf(e){const t=e instanceof G?e:new G(e);return t.path===""||this.path===t.path?!1:this.path===""?!0:this.keys.length>=t.keys.length?!1:this.keys.every((r,i)=>{const o=t.keys[i];return o===r||typeof o=="string"&&(o==="*"||o[0]==="$")||typeof r=="string"&&(r==="*"||r[0]==="$")})}isDescendantOf(e){const t=e instanceof G?e:new G(e);return this.path===""||this.path===t.path?!1:e===""?!0:t.keys.length>=this.keys.length?!1:t.keys.every((r,i)=>{const o=this.keys[i];return o===r||typeof o=="string"&&(o==="*"||o[0]==="$")||typeof r=="string"&&(r==="*"||r[0]==="$")})}isOnTrailOf(e){const t=e instanceof G?e:new G(e);return this.path.length===0||t.path.length===0||this.path===t.path?!0:this.pathKeys.every((r,i)=>{if(i>=t.keys.length)return!0;const o=t.keys[i];return o===r||typeof o=="string"&&(o==="*"||o[0]==="$")||typeof r=="string"&&(r==="*"||r[0]==="$")})}isChildOf(e){const t=e instanceof G?e:new G(e);return this.path===""?!1:this.parent.equals(t)}isParentOf(e){const t=e instanceof G?e:new G(e);return t.path===""?!1:this.equals(t.parent)}}function Ql(n,e,t=!1){if(!n.exists())return null;let r=t?n.previous():n.val();return typeof e=="number"?r[e]:(G.getPathKeys(e).every(i=>(r=r[i],typeof r!="undefined")),r||null)}function eu(n){if(!n.exists())return[];const e=n.val();return e instanceof Array?new Array(e.length).map((t,r)=>r):typeof e=="object"?Object.keys(e):[]}class st{exists(){return!1}constructor(e,t,r=!1,i,o){this.ref=e,this.val=()=>t,this.previous=()=>i,this.exists=()=>r?!1:t!==null&&typeof t!="undefined",this.context=()=>o||{}}static for(e,t){return new st(e,t)}child(e){const t=Ql(this,e,!1),r=Ql(this,e,!0);return new st(this.ref.child(e),t,!1,r)}hasChild(e){return Ql(this,e)!==null}hasChildren(){return eu(this).length>0}numChildren(){return eu(this).length}forEach(e){const t=this.val(),r=this.previous();return eu(this).every(i=>{const o=new st(this.ref.child(i),t[i],!1,r[i]);return e(o)})}get key(){return this.ref.key}}class qa extends st{constructor(e,t,r){super(e,t,!1,void 0,r),this.previous=()=>{throw new Error("Iterate values to get previous values for each mutation")},this.val=(i=!0)=>(i&&console.warn("Unless you know what you are doing, it is best not to use the value of a mutations snapshot directly. Use child methods and forEach to iterate the mutations instead"),t)}forEach(e){return this.val(!1).every(t=>{const r=t.target.reduce((o,s)=>o.child(s),this.ref),i=new st(r,t.val,!1,t.prev);return e(i)})}child(e){if(typeof e!="number")throw new Error("child index must be a number");const t=this.val(!1)[e],r=t.target.reduce((i,o)=>i.child(o),this.ref);return new st(r,t.val,!1,t.prev)}}class yw{constructor(e){this.stop=e,this._internal={state:"init",activatePromises:[]}}activated(e){return e&&(this._internal.activatePromises.push({callback:e}),this._internal.state==="active"?e(!0):this._internal.state==="canceled"&&e(!1,this._internal.cancelReason)),new Promise((t,r)=>{if(this._internal.state==="active")return t();if(this._internal.state==="canceled"&&!e)return r(new Error(this._internal.cancelReason));const i=()=>{};this._internal.activatePromises.push({resolve:t,reject:e?i:r})})}_setActivationState(e,t){for(this._internal.cancelReason=t,this._internal.state=e?"active":"canceled";this._internal.activatePromises.length>0;){const r=this._internal.activatePromises.shift();e?(r.callback&&r.callback(!0),r.resolve&&r.resolve()):(r.callback&&r.callback(!1,t),r.reject&&r.reject(t))}}}class O2{constructor(e,t,r){this.publish=e,this.start=t,this.cancel=r}}class A2{constructor(e){const t=[];let r,i;const o="stopped (no more subscribers)";this.subscribe=(h,y)=>{if(typeof h!="function")throw new TypeError("callback must be a function");if(i===o)throw new Error("stream can't be used anymore because all subscribers were stopped");const d={callback:h,activationCallback:function(f,g){y==null||y(f,g),this.subscription._setActivationState(f,g)},subscription:new yw(function(){return t.splice(t.indexOf(this),1),s()})};return t.push(d),typeof i!="undefined"&&(i===!0?(y==null||y(!0),d.subscription._setActivationState(!0)):typeof i=="string"&&(y==null||y(!1,i),d.subscription._setActivationState(!1,i))),d.subscription};const s=()=>{let h;return t.length===0&&(h=r==null?void 0:r(),i=o),Promise.resolve(h)};this.unsubscribe=h=>{(h?t.filter(y=>y.callback===h):t).forEach(y=>{const d=t.indexOf(y);t.splice(d,1)}),s()},this.stop=()=>{t.splice(0),s()};const a=h=>(t.forEach(y=>{try{y.callback(h)}catch(d){console.error(`Error running subscriber callback: ${d.message}`)}}),t.length===0&&s(),t.length>0),c=h=>{i=!0,r=h,t.forEach(y=>{var d;(d=y.activationCallback)==null||d.call(y,!0)})},l=h=>{i=h,t.forEach(y=>{var d;(d=y.activationCallback)==null||d.call(y,!1,h||new Error("unknown reason"))}),t.splice(0)},u=new O2(a,c,l);e(u)}}function lf(n,e){const t="000000000"+n;return t.substr(t.length-e)}const S2=typeof window=="object"?window:self,T2=Object.keys(S2).length;var Ky,Wy;const P2=(Wy=(Ky=navigator.mimeTypes)==null?void 0:Ky.length)!=null?Wy:0,j2=lf((P2+navigator.userAgent.length).toString(36)+T2.toString(36),4);function R2(){return j2}let Io=0;const uf=4,oc=36,gw=Math.pow(oc,uf);function zy(){return lf((Math.random()*gw<<0).toString(oc),uf)}function I2(){return Io=Io<gw?Io:0,Io++,Io-1}function C2(n=0){const e="c",t=(new Date().getTime()+n).toString(oc),r=lf(I2().toString(oc),uf),i=R2(),o=zy()+zy();return e+t+r+i+o}let Hy=0;class Kt{static set timeBias(e){typeof e=="number"&&(Hy=e)}static generate(){return C2(Hy).slice(1)}}class at{constructor(e){this.path=e}}const Tn={nextTick(n){setTimeout(n,0)}};class sc{constructor(e){if(e instanceof Array)for(let t=0;t<e.length;t++)typeof e[t]!="undefined"&&(this[t]=e[t]);else e&&Object.assign(this,e)}}function N2(n){const e=new Uint8Array(8);return new DataView(e.buffer).setFloat64(0,n),new Array(...e)}function B2(n){if((Array.isArray(n)?n.length:n.byteLength)!==8)throw new TypeError("must be 8 bytes");const e=new Uint8Array(n);return new DataView(e.buffer).getFloat64(0)}const ii={zero:BigInt(0),one:BigInt(1),two:BigInt(2),eight:BigInt(8),ff:BigInt(255)};function L2(n){if(typeof n!="bigint")throw new Error("number must be a bigint");const e=[],t=n<ii.zero;do{const r=Number(n&ii.ff);e.push(r),n=n>>ii.eight}while(n!==(t?-ii.one:ii.zero));return e.reverse(),(t?e[0]<128:e[0]>=128)&&e.unshift(t?255:0),e}function D2(n){const e=n[0]>=128;let t=ii.zero;for(let r of n)e&&(r=~r&255),t=(t<<ii.eight)+BigInt(r);return e&&(t=-(t+ii.one)),t}function q2(n){if(typeof TextEncoder!="undefined")return new TextEncoder().encode(n);if(typeof Buffer=="function"){const e=Buffer.from(n,"utf-8");return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}else{const e=[];for(let t=0;t<n.length;t++){let r=n.charCodeAt(t);if(r>128){if((r&55296)===55296){const i=n.charCodeAt(t+1);if((i&56320)!==56320)throw new Error("follow-up utf-16 character does not start with 0xDC00");t++;const o=r&1023,s=i&1023;r=65536|o<<10|s}if(r<2048){const i=192|r>>6&31,o=128|r&63;e.push(i,o)}else if(r<65536){const i=224|r>>12&15,o=128|r>>6&63,s=128|r&63;e.push(i,o,s)}else if(r<2097152){const i=240|r>>18&7,o=128|r>>12&63,s=128|r>>6&63,a=128|r&63;e.push(i,o,s,a)}else throw new Error(`Cannot convert character ${n.charAt(t)} (code ${r}) to utf-8`)}else e.push(r<128?r:63)}return new Uint8Array(e)}}function mw(n){if(typeof TextDecoder!="undefined"){const e=new TextDecoder;if(n instanceof Uint8Array)return e.decode(n);const t=Uint8Array.from(n);return e.decode(t)}else if(typeof Buffer=="function"){if(n instanceof Array&&(n=Uint8Array.from(n)),!(n instanceof Buffer)&&"buffer"in n&&n.buffer instanceof ArrayBuffer){const e=n;n=Buffer.from(e.buffer,e.byteOffset,e.byteLength)}if(!(n instanceof Buffer))throw new Error("Unsupported buffer argument");return n.toString("utf-8")}else{if(!(n instanceof Uint8Array)&&"buffer"in n&&n.buffer instanceof ArrayBuffer){const e=n;n=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}if(n instanceof Buffer||n instanceof Array||n instanceof Uint8Array){let e="";for(let t=0;t<n.length;t++){let r=n[t];if(r>128)if((r&240)===240){const i=r,o=n[t+1],s=n[t+2],a=n[t+3];r=(i&7)<<18|(o&63)<<12|(s&63)<<6|a&63,t+=3}else if((r&224)===224){const i=r,o=n[t+1],s=n[t+2];r=(i&15)<<12|(o&63)<<6|s&63,t+=2}else if((r&192)===192){const i=r,o=n[t+1];r=(i&31)<<6|o&63,t++}else throw new Error("invalid utf-8 data");if(r>=65536){r^=65536;const i=55296|r>>10,o=56320|r&1023;e+=String.fromCharCode(i),e+=String.fromCharCode(o)}else e+=String.fromCharCode(r)}return e}else throw new Error("Unsupported buffer argument")}}function U2(n,e){const t=new n.constructor(n.length+e.length);return t.set(n),t.set(e,n.length),t}function zn(n,e){var t;if(((t=n==null?void 0:n.constructor)==null?void 0:t.name)==="DataSnapshot")throw new TypeError(`Object to clone is a DataSnapshot (path "${n.ref.path}")`);const r=s=>(s!==null&&typeof s=="object"&&typeof s.constructor=="function"&&typeof s.constructor.name=="string"&&["Buffer","Uint8Array","Int8Array","Uint16Array","Int16Array","Uint32Array","Int32Array","BigUint64Array","BigInt64Array"].includes(s.constructor.name)&&(s=s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)),s);if(n=r(n),typeof n!="object"||n===null||n instanceof Date||n instanceof ArrayBuffer||n instanceof at||n instanceof RegExp)return n;const i=s=>{if(e.indexOf(s)>=0)throw new ReferenceError("object contains a circular reference");return s=r(s),s===null||s instanceof Date||s instanceof ArrayBuffer||s instanceof at||s instanceof RegExp||typeof s=="object"&&(e.push(s),s=zn(s,e),e.pop()),s};typeof e=="undefined"&&(e=[n]);const o=n instanceof Array?[]:n instanceof sc?new sc:{};return Object.keys(n).forEach(s=>{const a=n[s];typeof a!="function"&&(o[s]=i(a))}),o}const ai=n=>typeof n=="object"&&["ArrayBuffer","Buffer","Uint8Array","Uint16Array","Uint32Array","Int8Array","Int16Array","Int32Array"].includes(n.constructor.name);function ac(n,e){if(n===e)return!0;if(typeof n!=typeof e)return!1;if(typeof n=="object"||typeof e=="object"){if(n===null||e===null)return!1;if(n instanceof at||e instanceof at)return n instanceof at&&e instanceof at&&n.path===e.path;if(n instanceof Date||e instanceof Date)return n instanceof Date&&e instanceof Date&&n.getTime()===e.getTime();if(n instanceof Array||e instanceof Array)return n instanceof Array&&e instanceof Array&&n.length===e.length&&n.every((i,o)=>ac(n[o],e[o]));if(ai(n)||ai(e)){if(!ai(n)||!ai(e)||n.byteLength===e.byteLength)return!1;const i=n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength),o=e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength);return i.every((s,a)=>o[a]===s)}const t=Object.keys(n),r=Object.keys(e);return t.length===r.length&&t.every(i=>r.includes(i))&&t.every(i=>ac(n[i],e[i]))}return!1}class vw{constructor(e,t,r){this.added=e,this.removed=t,this.changed=r}forChild(e){if(this.added.includes(e))return"added";if(this.removed.includes(e))return"removed";const t=this.changed.find(r=>r.key===e);return t?t.change:"identical"}}function hf(n,e,t=!1){const r=[void 0,null];if(n===e)return"identical";if(r.indexOf(n)>=0&&r.indexOf(e)<0)return"added";if(r.indexOf(n)<0&&r.indexOf(e)>=0)return"removed";if(typeof n!=typeof e)return"changed";if(ai(n)||ai(e)){if(!ai(n)||!ai(e))return"changed";const i=n instanceof Uint8Array?n:n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength),o=e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength);return i.byteLength===o.byteLength&&i.every((s,a)=>o[a]===s)?"identical":"changed"}else{if(n instanceof Date||e instanceof Date)return n instanceof Date&&e instanceof Date&&n.getTime()===e.getTime()?"identical":"changed";if(n instanceof at||e instanceof at)return n instanceof at&&e instanceof at&&n.path===e.path?"identical":"changed";if(typeof n=="object"){const i=n instanceof Array,o=h=>{let y=Object.keys(h).filter(d=>!r.includes(h[d]));return i&&(y=y.map(d=>parseInt(d))),y},s=o(n),a=o(e),c=s.filter(h=>!a.includes(h)),l=a.filter(h=>!s.includes(h)),u=a.reduce((h,y)=>{if(s.includes(y)){const d=n[y],f=e[y],g=hf(d,f);g!=="identical"&&h.push({key:y,change:g})}return h},[]);return l.length===0&&c.length===0&&u.length===0?"identical":new vw(l,c,t?u.sort((h,y)=>h.key<y.key?-1:1):u)}}return"changed"}function bw(n,e,t=!1){const r=(o,s,a,c)=>{switch(s){case"identical":return[];case"changed":return[{target:o,prev:a,val:c}];case"added":return[{target:o,prev:null,val:c}];case"removed":return[{target:o,prev:a,val:null}];default:{let l=[];return s.added.forEach(u=>l.push({target:o.concat(u),prev:null,val:c[u]})),s.removed.forEach(u=>l.push({target:o.concat(u),prev:a[u],val:null})),s.changed.forEach(u=>{const h=r(o.concat(u.key),u.change,a[u.key],c[u.key]);l=l.concat(h)}),l}}},i=hf(n,e,t);return r([],i,n,e)}function M2(n,e,t){return e=e===null?null:e[n],typeof e=="undefined"&&(e=null),t=t===null?null:t[n],typeof t=="undefined"&&(t=null),{oldValue:e,newValue:t}}function F2(n){Tn.nextTick(n)}function ww(){var n;return typeof globalThis!="undefined"?globalThis:typeof global!="undefined"?global:typeof window!="undefined"?window:typeof self!="undefined"?self:(n=function(){return this}())!=null?n:Function("return this")()}const kw=Object.freeze(Object.defineProperty({__proto__:null,numberToBytes:N2,bytesToNumber:B2,bigintToBytes:L2,bytesToBigint:D2,encodeString:q2,decodeString:mw,concatTypedArrays:U2,cloneObject:zn,valuesAreEqual:ac,ObjectDifferences:vw,compareValues:hf,getMutations:bw,getChildValues:M2,defer:F2,getGlobalObject:ww},Symbol.toStringTag,{value:"Module"})),V2="modulepreload",K2=function(n){return"/"+n},Jy={},W2=function(n,e,t){if(!e||e.length===0)return n();const r=document.getElementsByTagName("link");return Promise.all(e.map(i=>{if(i=K2(i),i in Jy)return;Jy[i]=!0;const o=i.endsWith(".css"),s=o?'[rel="stylesheet"]':"";if(t)for(let c=r.length-1;c>=0;c--){const l=r[c];if(l.href===i&&(!o||l.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${s}`))return;const a=document.createElement("link");if(a.rel=o?"stylesheet":V2,o||(a.as="script",a.crossOrigin=""),a.href=i,document.head.appendChild(a),o)return new Promise((c,l)=>{a.addEventListener("load",c),a.addEventListener("error",()=>l(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>n())};let xw=!1,ui;W(void 0,null,function*(){const n=ww();if(typeof n.Observable!="undefined"){ui=n.Observable;return}try{const{Observable:e}=yield W2(()=>Promise.resolve().then(()=>Vq),void 0);ui=e}catch(e){ui=ff}});function df(){if(ui===ff&&!xw&&console.warn(`Using AceBase's simple Observable implementation because rxjs is not available. Add it to your project with "npm install rxjs", add it to AceBase using db.setObservable(Observable), or call db.setObservable("shim") to suppress this warning`),ui)return ui;throw new Error("RxJS Observable could not be loaded. ")}function z2(n){n==="shim"?(ui=ff,xw=!0):ui=n}class ff{constructor(e){this._active=!1,this._subscribers=[],this._create=e}subscribe(e){if(!this._active){const t={next:r=>{this._subscribers.forEach(i=>{try{i(r)}catch(o){console.error("Error in subscriber callback:",o)}})}};this._cleanup=this._create(t),this._active=!0}return this._subscribers.push(e),{unsubscribe:()=>{this._subscribers.splice(this._subscribers.indexOf(e),1),this._subscribers.length===0&&(this._active=!1,this._cleanup())}}}}class kn extends Array{static areEqual(e,t){return e.length===t.length&&e.every((r,i)=>t[i]===r)}static isAncestor(e,t){return e.length<t.length&&e.every((r,i)=>t[i]===r)}static isDescendant(e,t){return e.length>t.length&&t.every((r,i)=>e[i]===r)}}const $i=Symbol("isProxy");class H2{static create(e,t){return W(this,null,function*(){var r;e=new Xn(e.db,e.path);let i,o=!1,s=t==null?void 0:t.cursor,a;const c=Kt.generate(),l=[],u=new ho;u.on("cursor",p=>s=p),u.on("error",p=>{console.error(p.message,p.details)});const h=(p,v)=>{if(p.length===0)return i=v,!0;let m=i;const w=p.slice();for(;w.length>1;){const b=w.shift();if(!(b in m))return!1;m=m[b]}const E=w.shift();return v===null?m instanceof Array?m.splice(E,1):delete m[E]:m[E]=v,!0},y=()=>W(this,null,function*(){!o||(yield O())}),d=e.on("mutations",{syncFallback:y}).subscribe(p=>W(this,null,function*(){var v;if(!o)return;const m=p.context(),w=((v=m.acebase_proxy)==null?void 0:v.id)!==c;!w||(p.val(!1).every(E=>{if(!h(E.target,E.val))return!1;const b=E.target.reduce((x,$)=>x.child($),e),k=new st(b,E.val,!1,E.prev,p.context());return u.emit("mutation",{snapshot:k,isRemote:w}),!0})?(u.emit("cursor",m.acebase_cursor),j.emit("mutations",{origin:"remote",snap:p})):(console.warn(`Cached value of live data proxy on "${e.path}" appears outdated, will be reloaded`),yield O()))}));let f=Promise.resolve();const g=[],_=[],A=()=>W(this,null,function*(){const p=[];for(let v=0,m=g[0];v<g.length;v++,m=g[v])_.find(w=>kn.areEqual(w.target,m.target)||kn.isAncestor(w.target,m.target))||(g.splice(v,1),v--,p.push(m));p.length!==0&&(p.forEach(v=>{v.value=zn($n(i,v.target))}),Tn.nextTick(()=>{const v={acebase_proxy:{id:c,source:"update"}};p.forEach(w=>{const E=w.target.reduce((k,x)=>k.child(x),e),b=new st(E,w.value,!1,w.previous,v);u.emit("mutation",{snapshot:b,isRemote:!1})});const m=new qa(e,p.map(w=>({target:w.target,val:w.value,prev:w.previous})),v);j.emit("mutations",{origin:"local",snap:m})}),f=p.reduce((v,m,w,E)=>(E.some(b=>kn.isAncestor(b.target,m.target))||v.push(m),v),[]).reduce((v,m)=>{const w=m.target;if(w.length===0)v.push({ref:e,target:w,value:i,type:"set",previous:m.previous});else{const E=w.slice(0,-1),b=w.slice(-1)[0],k=E.reduce((T,R)=>T.child(R),e),x=v.find(T=>T.ref.path===k.path),$=$n(i,w),S=m.previous;x?(x.value[b]=$,x.previous[b]=S):v.push({ref:k,target:E,value:{[b]:$},type:"update",previous:{[b]:S}})}return v},[]).reduce((v,m)=>W(this,null,function*(){const w={acebase_proxy:{id:c,source:m.type}};yield v,yield m.ref.context(w)[m.type](m.value).catch(E=>{u.emit("error",{source:"update",message:`Error processing update of "/${e.path}"`,details:E});const b={acebase_proxy:{id:c,source:"update-rollback"}},k=[];if(m.type==="set"){tu(i,m.target,m.previous);const $=new st(m.ref,m.previous,!1,m.value,b);u.emit("mutation",{snapshot:$,isRemote:!1}),k.push({target:m.target,val:m.previous,prev:m.value})}else Object.keys(m.previous).forEach($=>{tu(i,m.target.concat($),m.previous[$]);const S=new st(m.ref.child($),m.previous[$],!1,m.value[$],b);u.emit("mutation",{snapshot:S,isRemote:!1}),k.push({target:m.target.concat($),val:m.previous[$],prev:m.value[$]})});k.forEach($=>{const S=$.target.reduce((R,N)=>R.child(N),e),T=new st(S,$.val,!1,$.prev,b);u.emit("mutation",{snapshot:T,isRemote:!1})});const x=new qa(m.ref,k,b);j.emit("mutations",{origin:"local",snap:x})}),m.ref.cursor&&u.emit("cursor",m.ref.cursor)}),f),yield f)});let P=!1;const B=[],C=()=>{let p;const v=new Promise(m=>p=m);return B.push({resolve:p}),v};let L=null;const q=()=>{L||(L=setTimeout(()=>W(this,null,function*(){P=!0,L=null,yield A(),P=!1,B.splice(0).forEach(p=>p.resolve())}),0))},H=p=>{g.find(v=>kn.areEqual(v.target,p))||g.push({target:p,previous:zn($n(i,p))}),q()},j=new ho,I=(p,v)=>{const m=b=>b!==null&&typeof b=="object",w=b=>W(this,null,function*(){var k;const{snap:x,origin:$}=b,S=x.context(),T=((k=S.acebase_proxy)==null?void 0:k.id)===c;if(b.origin==="remote"&&T){console.error("DEV ISSUE: mutationsHandler was called from remote event originating from our own proxy");return}const R=x.val(!1).filter(ne=>ne.target.slice(0,p.length).every((te,pe)=>p[pe]===te));if(R.length===0)return;let N,z;const F=R.find(ne=>ne.target.length<=p.length);if(F){const ne=p.slice(F.target.length);N=ne.reduce((te,pe)=>!m(te)||!(pe in te)?null:te[pe],F.val),z=ne.reduce((te,pe)=>!m(te)||!(pe in te)?null:te[pe],F.prev)}else{const ne=$n(i,p);N=zn(ne),z=zn(N),R.forEach(te=>{const pe=te.target.slice(p.length);for(let oe=0,re=N,ue=z;oe<pe.length;oe++){const Ne=oe+1===pe.length,ye=pe[oe];Ne?(re[ye]=te.val,re[ye]===null&&delete re[ye],ue[ye]=te.prev,ue[ye]===null&&delete ue[ye]):(re=re[ye]=ye in re?re[ye]:{},ue=ue[ye]=ye in ue?ue[ye]:{})}})}Tn.nextTick(()=>{let ne=!0;try{ne=v(Object.freeze(N),Object.freeze(z),!T,S)!==!1}catch(te){u.emit("error",{source:$==="remote"?"remote_update":"local_update",message:"Error running subscription callback",details:te})}ne===!1&&E()})});j.on("mutations",w);const E=()=>{j.off("mutations",w),l.splice(l.findIndex(b=>b.stop===E),1)};return l.push({target:p,stop:E}),{stop:E}},D=(p,v,m)=>{if(p==="write")return H(v);if(p==="onChange")return I(v,m.callback);if(p==="subscribe"||p==="observe"){const w=b=>{const k=$n(i,v);b.next(k);const x=I(v,$=>{b.next($)});return function(){x.stop()}};if(p==="subscribe")return w;const E=df();return new E(w)}else if(p==="transaction")return _.some(w=>kn.areEqual(v,w.target)||kn.isAncestor(v,w.target)||kn.isDescendant(v,w.target))?Promise.reject(new Error("Cannot start transaction because it conflicts with another transaction")):new Promise(w=>W(this,null,function*(){g.some(b=>kn.areEqual(v,b.target)||kn.isAncestor(v,b.target))&&(P||q(),yield C());const E={target:v,status:"started",transaction:null};_.push(E),E.transaction={get status(){return E.status},get completed(){return E.status!=="started"},get mutations(){return g.filter(b=>kn.areEqual(E.target,b.target)||kn.isAncestor(E.target,b.target))},get hasMutations(){return this.mutations.length>0},commit(){return W(this,null,function*(){if(this.completed)throw new Error(`Transaction has completed already (status '${E.status}')`);E.status="finished",_.splice(_.indexOf(E),1),P&&(yield C()),q(),yield C()})},rollback(){if(this.completed)throw new Error(`Transaction has completed already (status '${E.status}')`);E.status="canceled";const b=[];for(let k=0;k<g.length;k++){const x=g[k];(kn.areEqual(E.target,x.target)||kn.isAncestor(E.target,x.target))&&(g.splice(k,1),k--,b.push(x))}b.reverse().forEach(k=>{k.target.length===0?i=k.previous:tu(i,k.target,k.previous)}),_.splice(_.indexOf(E),1)}},w(E.transaction)}))},M=yield e.get({cache_mode:"allow",cache_cursor:t==null?void 0:t.cursor});if(M.context().acebase_origin!=="cache"&&u.emit("cursor",(r=e.cursor)!=null?r:null),o=!0,i=M.val(),i===null&&typeof(t==null?void 0:t.defaultValue)!="undefined"){i=t.defaultValue;const p={acebase_proxy:{id:c,source:"default"}};yield e.context(p).set(i)}a=Ew({root:{ref:e,get cache(){return i}},target:[],id:c,flag:D});const U=()=>{if(a===null)throw new Error("Proxy was destroyed")},O=()=>W(this,null,function*(){U(),g.splice(0);const p=yield e.get({allow_cache:!1}),v=i,m=p.val();i=m;const w=bw(v,m);if(w.length===0)return;const E=p.context();E.acebase_proxy={id:c,source:"reload"},w.forEach(k=>{const x=xh(e,k.target),$=new st(x,k.val,k.val===null,k.prev,E);u.emit("mutation",{snapshot:$,isRemote:!0})});const b=new qa(e,w,E);j.emit("mutations",{origin:"local",snap:b})});return{destroy(){return W(this,null,function*(){yield f;const p=[d.stop(),...l.map(v=>v.stop())];yield Promise.all(p),["cursor","mutation","error"].forEach(v=>u.off(v)),i=null,a=null})},stop(){this.destroy()},get value(){return U(),a},get hasValue(){return U(),i!==null},set value(p){U(),p!==null&&typeof p=="object"&&p[$i]&&(p=p.valueOf()),H([]),i=p},get ref(){return e},get cursor(){return s},reload:O,onMutation(p){U(),u.off("mutation"),u.on("mutation",({snapshot:v,isRemote:m})=>{try{p(v,m)}catch(w){u.emit("error",{source:"mutation_callback",message:"Error in dataproxy onMutation callback",details:w})}})},onError(p){U(),u.off("error"),u.on("error",v=>{try{p(v)}catch(m){console.error(`Error in dataproxy onError callback: ${m.message}`)}})},on(p,v){u.on(p,v)},off(p,v){u.off(p,v)}}})}}function $n(n,e){let t=n;for(const r of e)t=typeof t=="object"&&t!==null&&r in t?t[r]:null;return t}function tu(n,e,t){if(e.length===0)throw new Error("Cannot update root target, caller must do that itself!");const r=e.slice(0,-1).reduce((o,s)=>o[s],n),i=e.slice(-1)[0];t===null||typeof t=="undefined"?r instanceof Array?r.splice(i,1):delete r[i]:r[i]=t}function xh(n,e){const t=G.get(n.path).childPath(e);return new Xn(n.db,t)}function Ew(n){const e=xh(n.root.ref,n.target),t=[],r={get(o,s,a){if(o=$n(n.root.cache,n.target),typeof s=="symbol")if(s.toString()===Symbol.iterator.toString())s="values";else return s.toString()===$i.toString()?!0:Reflect.get(o,s,a);if(s==="valueOf")return function(){return o};if(o===null||typeof o!="object")throw new Error(`Cannot read property "${s}" of ${o}. Value of path "/${e.path}" is not an object (anymore)`);o instanceof Array&&typeof s=="string"&&/^[0-9]+$/.test(s)&&(s=parseInt(s));const c=o[s];if(c===null){delete o[s];return}const l=t.find(d=>d.prop===s);if(l){if(l.typeof===typeof c)return l.value;t.splice(t.indexOf(l),1)}const u=d=>{const f=o[d],g=t.find(A=>A.prop===d);if(g){if(g.typeof===typeof f)return g.value;t.splice(t.indexOf(g),1)}if(typeof f!="object")return f;const _=Ew({root:n.root,target:n.target.concat(d),id:n.id,flag:n.flag});return t.push({typeof:typeof f,prop:d,value:_}),_},h=d=>d!==null&&typeof d=="object"&&d[$i]?d.getTarget():d;if(["string","number","boolean"].includes(typeof c)||c instanceof Date||c instanceof at||c instanceof ArrayBuffer||typeof c=="object"&&"buffer"in c)return c;const y=o instanceof Array;if(s==="toString")return function(){return`[LiveDataProxy for "${e.path}"]`};if(typeof c=="undefined")return s==="push"?function(d){const f=e.push();return n.flag("write",n.target.concat(f.key)),o[f.key]=d,f.key}:s==="getTarget"?function(d=!0){return d&&console.warn("Use getTarget with caution - any changes will not be synchronized!"),o}:s==="getRef"?function(){return xh(n.root.ref,n.target)}:s==="forEach"?function(d){const f=Object.keys(o);let g=!1;for(let _=0;!g&&_<f.length;_++){const A=f[_],P=u(A);g=d(P,A,_)===!1}}:["values","entries","keys"].includes(s)?function*(){const d=Object.keys(o);for(const f of d)if(s==="keys")yield f;else{const g=u(f);s==="entries"?yield[f,g]:yield g}}:s==="toArray"?function(d){const f=Object.keys(o).map(g=>u(g));return d&&f.sort(d),f}:s==="onChanged"?function(d){return n.flag("onChange",n.target,{callback:d})}:s==="subscribe"?function(){return n.flag("subscribe",n.target)}:s==="getObservable"?function(){return n.flag("observe",n.target)}:s==="getOrderedCollection"?function(d,f){return new J2(this,d,f)}:s==="startTransaction"?function(){return n.flag("transaction",n.target)}:s==="remove"&&!y?function(){if(n.target.length===0)throw new Error("Can't remove proxy root value");const d=$n(n.root.cache,n.target.slice(0,-1)),f=n.target.slice(-1)[0];n.flag("write",n.target),delete d[f]}:void 0;if(typeof c=="function"){if(y){const d=g=>(n.flag("write",n.target),g()),f=g=>g.map(_=>(_=h(_),Eh(_),_));if(s==="push")return function(...g){return g=f(g),d(()=>o.push(...g))};if(s==="pop")return function(){return d(()=>o.pop())};if(s==="splice")return function(g,_,...A){return A=f(A),d(()=>o.splice(g,_,...A))};if(s==="shift")return function(){return d(()=>o.shift())};if(s==="unshift")return function(...g){return g=f(g),d(()=>o.unshift(...g))};if(s==="sort")return function(g){return d(()=>o.sort(g))};if(s==="reverse")return function(){return d(()=>o.reverse())};if(["indexOf","lastIndexOf"].includes(s))return function(g,_){return g!==null&&typeof g=="object"&&g[$i]&&(g=g.getTarget(!1)),o[s](g,_)};if(["forEach","every","some","filter","map"].includes(s))return function(g){return o[s]((_,A)=>g(u(A),A,i))};if(["reduce","reduceRight"].includes(s))return function(g,_){return o[s]((A,P,B)=>g(A,u(B),B,i),_)};if(["find","findIndex"].includes(s))return function(g){let _=o[s]((A,P)=>g(u(P),P,i));if(s==="find"&&_){const A=o.indexOf(_);_=u(A)}return _};if(["values","entries","keys"].includes(s))return function*(){for(let g=0;g<o.length;g++)if(s==="keys")yield g;else{const _=u(g);s==="entries"?yield[g,_]:yield _}}}return c}return u(s)},set(o,s,a,c){if(o=$n(n.root.cache,n.target),typeof s=="symbol")return Reflect.set(o,s,a,c);if(o===null||typeof o!="object")throw new Error(`Cannot set property "${s}" of ${o}. Value of path "/${e.path}" is not an object`);if(o instanceof Array&&typeof s=="string"){if(!/^[0-9]+$/.test(s))throw new Error(`Cannot set property "${s}" on array value of path "/${e.path}"`);s=parseInt(s)}return a!==null&&(typeof a=="object"&&(a[$i]&&(a=a.valueOf()),a=zn(a)),ac(a,o[s]))||(n.target.some(l=>typeof l=="number")?n.flag("write",n.target.slice(0,n.target.findIndex(l=>typeof l=="number"))):o instanceof Array?n.flag("write",n.target):n.flag("write",n.target.concat(s)),a===null?delete o[s]:(Eh(a),o[s]=a)),!0},deleteProperty(o,s){if(o=$n(n.root.cache,n.target),o===null)throw new Error(`Cannot delete property ${s.toString()} of null`);return typeof s=="symbol"?Reflect.deleteProperty(o,s):(s in o&&(n.flag("write",n.target.concat(s)),delete o[s]),!0)},ownKeys(o){return o=$n(n.root.cache,n.target),Reflect.ownKeys(o)},has(o,s){return o=$n(n.root.cache,n.target),Reflect.has(o,s)},getOwnPropertyDescriptor(o,s){o=$n(n.root.cache,n.target);const a=Reflect.getOwnPropertyDescriptor(o,s);return a&&(a.configurable=!0),a},getPrototypeOf(o){return o=$n(n.root.cache,n.target),Reflect.getPrototypeOf(o)}},i=new Proxy({},r);return i}function Eh(n){typeof n=="object"&&Object.keys(n).forEach(e=>{const t=n[e];t===null||typeof t=="undefined"?delete n[e]:typeof t=="object"&&Eh(t)})}function Ua(n){if(typeof n!="object"||!n[$i])throw new Error("Given value is not proxied. Make sure you are referencing the value through the live data proxy.");return n}class J2{constructor(e,t="order",r=10){if(this.collection=e,this.orderProperty=t,this.orderIncrement=r,typeof e!="object"||!e[$i])throw new Error("Collection is not proxied");if(e.valueOf()instanceof Array)throw new Error("Collection is an array, not an object collection");if(!Object.keys(e).every(i=>typeof e[i]=="object"))throw new Error("Collection has non-object children");if(!Object.keys(e).every(i=>typeof e[i][t]=="number")){const i=Object.keys(e);for(let o=0;o<i.length;o++){const s=e[i[o]];s[t]=o*r}}}getObservable(){return Ua(this.collection).getObservable()}getArrayObservable(){const e=df();return new e(t=>{const r=this.getObservable().subscribe(()=>{const i=this.getArray();t.next(i)});return function(){r.unsubscribe()}})}getArray(){return Ua(this.collection).toArray((e,t)=>e[this.orderProperty]-t[this.orderProperty])}add(e,t,r){const i=this.getArray();let o=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;for(let c=0;c<i.length;c++){const l=i[c][this.orderProperty];o=Math.min(l,o),s=Math.max(l,s)}let a;if(typeof r=="number"){if(a=Object.keys(this.collection).find(c=>this.collection[c]===e),!a)throw new Error("item not found in collection");if(r===t)return{key:a,index:t};if(Math.abs(r-t)===1){const c=i[t],l=c[this.orderProperty];return c[this.orderProperty]=e[this.orderProperty],e[this.orderProperty]=l,{key:a,index:t}}else i.splice(r,1)}if(typeof t!="number"||t>=i.length)t=i.length,e[this.orderProperty]=i.length==0?0:s+this.orderIncrement;else if(t===0)e[this.orderProperty]=i.length==0?0:o-this.orderIncrement;else{const c=i.map(u=>u[this.orderProperty]),l=c[t]-c[t-1];if(l>1)e[this.orderProperty]=c[t]-Math.floor(l/2);else{i.splice(t,0,e);for(let u=0;u<i.length;u++)i[u][this.orderProperty]=u*this.orderIncrement}}return{key:typeof a=="string"?a:Ua(this.collection).push(e),index:t}}delete(e){const t=this.getArray()[e];if(!t)throw new Error(`Item at index ${e} not found`);const r=Object.keys(this.collection).find(i=>this.collection[i]===t);if(!r)throw new Error("Cannot find target object to delete");return this.collection[r]=null,{key:r,index:e}}move(e,t){const r=this.getArray();return this.add(r[e],t,e)}sort(e){const t=this.getArray();t.sort(e);for(let r=0;r<t.length;r++)t[r][this.orderProperty]=r*this.orderIncrement}}class _w{constructor(e){if(e||(e={}),typeof e.include!="undefined"&&!(e.include instanceof Array))throw new TypeError("options.include must be an array");if(typeof e.exclude!="undefined"&&!(e.exclude instanceof Array))throw new TypeError("options.exclude must be an array");if(typeof e.child_objects!="undefined"&&typeof e.child_objects!="boolean")throw new TypeError("options.child_objects must be a boolean");if(typeof e.cache_mode=="string"&&!["allow","bypass","force"].includes(e.cache_mode))throw new TypeError("invalid value for options.cache_mode");this.include=e.include||void 0,this.exclude=e.exclude||void 0,this.child_objects=typeof e.child_objects=="boolean"?e.child_objects:void 0,this.cache_mode=typeof e.cache_mode=="string"?e.cache_mode:typeof e.allow_cache=="boolean"?e.allow_cache?"allow":"bypass":"allow",this.cache_cursor=typeof e.cache_cursor=="string"?e.cache_cursor:void 0}}class Y2 extends _w{constructor(e){if(super(e),!["undefined","boolean"].includes(typeof e.snapshots))throw new TypeError("options.snapshots must be a boolean");this.snapshots=typeof e.snapshots=="boolean"?e.snapshots:!0}}const Te=Symbol("private");class Xn{constructor(e,t,r){this.db=e,t||(t=""),t=t.replace(/^\/|\/$/g,"");const i=G.get(t).key,o=[];this[Te]={get path(){return t},get key(){return i},get callbacks(){return o},vars:r||{},context:{},pushed:!1,cursor:null}}context(e,t=!1){const r=this[Te].context;if(typeof e=="object"){const i=e?t?r||{}:e:{};return e&&Object.keys(e).forEach(o=>{i[o]=e[o]}),this[Te].context=i,this}else{if(typeof e=="undefined")return console.warn("Use snap.context() instead of snap.ref.context() to get updating context in event callbacks"),r;throw new Error("Invalid context argument")}}get cursor(){return this[Te].cursor}set cursor(e){var t;this[Te].cursor=e,(t=this.onCursor)==null||t.call(this,e)}get path(){return this[Te].path}get key(){const e=this[Te].key;return typeof e=="number"?`[${e}]`:e}get index(){const e=this[Te].key;if(typeof e!="number")throw new Error(`"${e}" is not a number`);return e}get parent(){const e=G.fillVariables2(this.path,this.vars),t=G.get(e);return t.parentPath===null?null:new Xn(this.db,t.parentPath).context(this[Te].context)}get vars(){return this[Te].vars}child(e){e=typeof e=="number"?e:e.replace(/^\/|\/$/g,"");const t=G.fillVariables2(this.path,this.vars),r=G.getChildPath(t,e);return new Xn(this.db,r).context(this[Te].context)}set(e,t){return W(this,null,function*(){try{if(this.isWildcardPath)throw new Error(`Cannot set the value of wildcard path "/${this.path}"`);if(this.parent===null)throw new Error("Cannot set the root object. Use update, or set individual child properties");if(typeof e=="undefined")throw new TypeError(`Cannot store undefined value in "/${this.path}"`);this.db.isReady||(yield this.db.ready()),e=this.db.types.serialize(this.path,e);const{cursor:r}=yield this.db.api.set(this.path,e,{context:this[Te].context});if(this.cursor=r,typeof t=="function")try{t(null,this)}catch(i){console.error("Error in onComplete callback:",i)}}catch(r){if(typeof t=="function")try{t(r,this)}catch(i){console.error("Error in onComplete callback:",i)}else throw r}return this})}update(e,t){return W(this,null,function*(){try{if(this.isWildcardPath)throw new Error(`Cannot update the value of wildcard path "/${this.path}"`);if(this.db.isReady||(yield this.db.ready()),typeof e!="object"||e instanceof Array||e instanceof ArrayBuffer||e instanceof Date)yield this.set(e);else if(Object.keys(e).length===0)console.warn(`update called on path "/${this.path}", but there is nothing to update`);else{e=this.db.types.serialize(this.path,e);const{cursor:r}=yield this.db.api.update(this.path,e,{context:this[Te].context});this.cursor=r}if(typeof t=="function")try{t(null,this)}catch(r){console.error("Error in onComplete callback:",r)}}catch(r){if(typeof t=="function")try{t(r,this)}catch(i){console.error("Error in onComplete callback:",i)}else throw r}return this})}transaction(e){return W(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot start a transaction on wildcard path "/${this.path}"`);this.db.isReady||(yield this.db.ready());let t;const r=o=>{o=this.db.types.deserialize(this.path,o);const s=new st(this,o);let a;try{a=e(s)}catch(c){t=c;return}return a instanceof Promise?a.then(c=>this.db.types.serialize(this.path,c)).catch(c=>{t=c}):this.db.types.serialize(this.path,a)},{cursor:i}=yield this.db.api.transaction(this.path,r,{context:this[Te].context});if(this.cursor=i,t)throw t;return this})}on(e,t,r){this.path===""&&["value","child_changed"].includes(e)&&console.warn("WARNING: Listening for value and child_changed events on the root node is a bad practice. These events require loading of all data (value event), or potentially lots of data (child_changed event) each time they are fired");let i=null;const o=new A2(c=>{i=c}),s={event:e,stream:o,userCallback:typeof t=="function"&&t,ourCallback:(c,l,u,h,y)=>{if(c){this.db.debug.error(`Error getting data for event ${e} on path "${l}"`,c);return}const d=this.db.ref(l);d[Te].vars=G.extractVariables(this.path,l);let f;if(e.startsWith("notify_"))f=d.context(y||{});else{const g={previous:this.db.types.deserialize(l,h),current:this.db.types.deserialize(l,u)};if(e==="child_removed")f=new st(d,g.previous,!0,g.previous,y);else if(e==="mutations")f=new qa(d,g.current,y);else{const _=e==="mutated"&&g.current===null;f=new st(d,g.current,_,g.previous,y)}}i.publish(f),y!=null&&y.acebase_cursor&&(this.cursor=y.acebase_cursor)}};this[Te].callbacks.push(s);const a=()=>{typeof t=="function"&&o.subscribe(t,(y,d)=>{y||r&&r(d)});const c=typeof t=="object"?t:{newOnly:!t};typeof c.newOnly!="boolean"&&(c.newOnly=!1),this.isWildcardPath&&(c.newOnly=!0);const l=y=>{const d=this[Te].callbacks;d.splice(d.indexOf(s),1),this.db.api.unsubscribe(this.path,e,s.ourCallback),this.db.debug.error(`Subscription "${e}" on path "/${this.path}" canceled because of an error: ${y.message}`),i.cancel(y.message)},u=this.db.api.subscribe(this.path,e,s.ourCallback,{newOnly:c.newOnly,cancelCallback:l,syncFallback:c.syncFallback}),h=()=>{const y=this[Te].callbacks;return y.splice(y.indexOf(s),1),this.db.api.unsubscribe(this.path,e,s.ourCallback)};if(u instanceof Promise?u.then(()=>{i.start(h)}).catch(l):i.start(h),!c.newOnly){if(e==="value")this.get(y=>{i.publish(y)});else if(e==="child_added")this.get(y=>{const d=y.val();d===null||typeof d!="object"||Object.keys(d).forEach(f=>{const g=new st(this.child(f),d[f]);i.publish(g)})});else if(e==="notify_child_added"){let y=0;const d=()=>W(this,null,function*(){const f=yield this.db.api.reflect(this.path,"children",{limit:100,skip:y});f.list.forEach(g=>{const _=this.child(g.key);i.publish(_)}),f.more&&(y+=100,d())});d()}}};return this.db.isReady?a():this.db.ready(a),o}off(e,t){const r=this[Te].callbacks.filter(i=>(!e||i.event===e)&&(!t||i.userCallback===t));return r.length===0&&this.db.debug.warn(`Can't find event subscriptions to stop (path: "${this.path}", event: ${e||"(any)"}, callback: ${t})`),r.forEach(i=>{i.stream.stop()}),this}get(e,t){if(!this.db.isReady){const o=this.db.ready().then(()=>this.get(e,t));return typeof e!="function"&&typeof t!="function"?o:void 0}if(t=typeof e=="function"?e:typeof t=="function"?t:void 0,this.isWildcardPath){const o=new Error(`Cannot get value of wildcard path "/${this.path}". Use .query() instead`);if(typeof t=="function")throw o;return Promise.reject(o)}const r=new _w(typeof e=="object"?e:{cache_mode:"allow"}),i=this.db.api.get(this.path,r).then(o=>{var s;"context"in o&&"value"in o||(console.warn("AceBase api.get method returned an old response value. Update your acebase or acebase-client package"),o={value:o,context:{}});const a=this.db.types.deserialize(this.path,o.value),c=new st(this,a,void 0,void 0,o.context);return(s=o.context)!=null&&s.acebase_cursor&&(this.cursor=o.context.acebase_cursor),c});if(t){i.then(t).catch(o=>{console.error("Uncaught error:",o)});return}else return i}once(e,t){return e==="value"&&!this.isWildcardPath?this.get(t):new Promise(r=>{const i=o=>{this.off(e,i),r(o)};this.on(e,i)})}push(e,t){if(this.isWildcardPath){const o=new Error(`Cannot push to wildcard path "/${this.path}"`);if(typeof e=="undefined"||typeof t=="function")throw o;return Promise.reject(o)}const r=Kt.generate(),i=this.child(r);return i[Te].pushed=!0,typeof e!="undefined"?i.set(e,t).then(()=>i):i}remove(){return W(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot remove wildcard path "/${this.path}". Use query().remove instead`);if(this.parent===null)throw new Error("Cannot remove the root node");return this.set(null)})}exists(){return W(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot check wildcard path "/${this.path}" existence`);return this.db.isReady||(yield this.db.ready()),this.db.api.exists(this.path)})}get isWildcardPath(){return this.path.indexOf("*")>=0||this.path.indexOf("$")>=0}query(){return new $w(this)}count(){return W(this,null,function*(){return(yield this.reflect("info",{child_count:!0})).children.count})}reflect(e,t){return W(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot reflect on wildcard path "/${this.path}"`);return this.db.isReady||(yield this.db.ready()),this.db.api.reflect(this.path,e,t)})}export(e){return W(this,arguments,function*(t,r={format:"json",type_safe:!0}){if(this.isWildcardPath)throw new Error(`Cannot export wildcard path "/${this.path}"`);this.db.isReady||(yield this.db.ready());const i=typeof t=="function"?t:t.write.bind(t);return this.db.api.export(this.path,i,r)})}import(e){return W(this,arguments,function*(t,r={format:"json",suppress_events:!1}){if(this.isWildcardPath)throw new Error(`Cannot import to wildcard path "/${this.path}"`);return this.db.isReady||(yield this.db.ready()),this.db.api.import(this.path,t,r)})}proxy(e){const t=typeof e=="object"&&(typeof e.cursor!="undefined"||typeof e.defaultValue!="undefined");return typeof e!="undefined"&&!t&&(this.db.debug.warn("Warning: live data proxy is being initialized with a deprecated method signature. Use ref.proxy(options) instead of ref.proxy(defaultValue)"),e={defaultValue:e}),H2.create(this,e)}observe(e){if(e)throw new Error("observe does not support data retrieval options yet");if(this.isWildcardPath)throw new Error(`Cannot observe wildcard path "/${this.path}"`);const t=df();return new t(r=>{let i,o=!1,s=this.get(e).then(c=>{o=!0,i=c.val(),r.next(i)});const a=c=>{if(!o){s=s.then(()=>a(c));return}const l=c.ref.path;if(l===this.path)return i=c.val(),r.next(i);const u=G.getPathKeys(l).slice(G.getPathKeys(this.path).length);let h=i;for(;u.length>1;){const f=u.shift();f in h||(h[f]=typeof u[0]=="number"?[]:{}),h=h[f]}const y=u.shift(),d=c.val();d===null?h instanceof Array&&typeof y=="number"?h.splice(y,1):delete h[y]:h[y]=d,r.next(i)};return this.on("mutated",a),()=>{this.off("mutated",a)}})}forEach(e,t){return W(this,null,function*(){let r;if(typeof e=="function"?t=e:r=e,typeof t!="function")throw new TypeError("No callback function given");const i=yield this.reflect("children",{limit:0,skip:0}),o={canceled:!1,total:i.list.length,processed:0};for(let s=0;s<i.list.length;s++){const a=i.list[s].key,c=yield this.child(a).get(r);if(o.processed++,!!c.exists()&&(yield t(c))===!1){o.canceled=!0;break}}return o})}getMutations(e){return W(this,null,function*(){const t=typeof e=="string"?e:void 0,r=e===null||typeof e=="undefined"?0:e instanceof Date?e.getTime():void 0;return this.db.api.getMutations({path:this.path,cursor:t,timestamp:r})})}getChanges(e){return W(this,null,function*(){const t=typeof e=="string"?e:void 0,r=e===null||typeof e=="undefined"?0:e instanceof Date?e.getTime():void 0;return this.db.api.getChanges({path:this.path,cursor:t,timestamp:r})})}}class $w{constructor(e){this.ref=e,this[Te]={filters:[],skip:0,take:0,order:[],events:{}}}filter(e,t,r){if((t==="in"||t==="!in")&&(!(r instanceof Array)||r.length===0))throw new Error(`${t} filter for ${e} must supply an Array compare argument containing at least 1 value`);if((t==="between"||t==="!between")&&(!(r instanceof Array)||r.length!==2))throw new Error(`${t} filter for ${e} must supply an Array compare argument containing 2 values`);if((t==="matches"||t==="!matches")&&!(r instanceof RegExp))throw new Error(`${t} filter for ${e} must supply a RegExp compare argument`);return this[Te].filters.push({key:e,op:t,compare:r}),this}where(e,t,r){return this.filter(e,t,r)}take(e){return this[Te].take=e,this}skip(e){return this[Te].skip=e,this}sort(e,t=!0){if(!["string","number"].includes(typeof e))throw"key must be a string or number";return this[Te].order.push({key:e,ascending:t}),this}order(e,t=!0){return this.sort(e,t)}get(e,t){if(!this.ref.db.isReady){const o=this.ref.db.ready().then(()=>this.get(e,t));return typeof e!="function"&&typeof t!="function"?o:void 0}t=typeof e=="function"?e:typeof t=="function"?t:void 0;const r=new Y2(typeof e=="object"?e:{snapshots:!0,cache_mode:"allow"});r.allow_cache=r.cache_mode!=="bypass",r.eventHandler=o=>{if(!this[Te].events[o.name])return!1;const s=this[Te].events[o.name];if(typeof s!="object"||s.length===0)return!1;if(["add","change","remove"].includes(o.name)){const a={name:o.name,ref:new Xn(this.ref.db,o.path)};if(r.snapshots&&o.name!=="remove"){const c=i.types.deserialize(o.path,o.value);a.snapshot=new st(a.ref,c,!1)}o=a}s.forEach(a=>{var c,l;try{a(o)}catch(u){this.ref.db.debug.error(`Error executing "${o.name}" event handler of realtime query on path "${this.ref.path}": ${(l=(c=u==null?void 0:u.stack)!=null?c:u==null?void 0:u.message)!=null?l:u}`)}})},r.monitor={add:!1,change:!1,remove:!1},this[Te].events&&(this[Te].events.add&&this[Te].events.add.length>0&&(r.monitor.add=!0),this[Te].events.change&&this[Te].events.change.length>0&&(r.monitor.change=!0),this[Te].events.remove&&this[Te].events.remove.length>0&&(r.monitor.remove=!0)),this.stop();const i=this.ref.db;return i.api.query(this.ref.path,this[Te],r).catch(o=>{throw new Error(o)}).then(o=>{const{stop:s}=o;let{results:a,context:c}=o;if(this.stop=()=>W(this,null,function*(){yield s()}),"results"in o&&"context"in o||(console.warn("Query results missing context. Update your acebase and/or acebase-client packages"),a=o,c={}),r.snapshots){const l=a.map(u=>{const h=i.types.deserialize(u.path,u.val);return new st(i.ref(u.path),h,!1,void 0,c)});return el.from(l)}else{const l=a.map(u=>i.ref(u));return pf.from(l)}}).then(o=>(t&&t(o),o))}stop(){return W(this,null,function*(){})}getRefs(e){return this.get({snapshots:!1},e)}find(){return this.get({snapshots:!1})}count(){return W(this,null,function*(){return(yield this.find()).length})}exists(){return W(this,null,function*(){const e=this[Te].take,t=this.take(1).find();return this.take(e),(yield t).length!==0})}remove(e){return W(this,null,function*(){const t=yield this.find(),r=t.reduce((a,c)=>{const l=a[c.parent.path];return l?l.push(c):a[c.parent.path]=[c],a},{}),i=this.ref.db,o=Object.keys(r).map(a=>W(this,null,function*(){const c=t.reduce((u,h)=>(u[h.key]=null,u),{}),l=i.ref(a);try{return yield l.update(c),{ref:l,success:!0}}catch(u){return{ref:l,success:!1,error:u}}})),s=yield Promise.all(o);return e&&e(s),s})}on(e,t){return this[Te].events[e]||(this[Te].events[e]=[]),this[Te].events[e].push(t),this}off(e,t){if(typeof e=="undefined")return this[Te].events={},this;if(!this[Te].events[e])return this;if(typeof t=="undefined")return delete this[Te].events[e],this;const r=this[Te].events[e].indexOf(t);return~r?(this[Te].events[e].splice(r,1),this):this}forEach(e,t){return W(this,null,function*(){let r;if(typeof e=="function"?t=e:r=e,typeof t!="function")throw new TypeError("No callback function given");const i=yield this.find(),o={canceled:!1,total:i.length,processed:0};for(let s=0;s<i.length;s++){const a=yield i[s].get(r);if(o.processed++,!!a.exists()&&(yield t(a))===!1){o.canceled=!0;break}}return o})}}class el extends Array{static from(e){const t=new el(e.length);return e.forEach((r,i)=>t[i]=r),t}getValues(){return this.map(e=>e.val())}}class pf extends Array{static from(e){const t=new pf(e.length);return e.forEach((r,i)=>t[i]=r),t}getPaths(){return this.map(e=>e.path)}}function G2(n,e){e=e.replace(/^\/|\/$/g,"");const t=G.getPathKeys(e),r=Object.keys(n).find(i=>{const o=G.getPathKeys(i);return o.length!==t.length?!1:o.every((s,a)=>s==="*"||typeof s=="string"&&s[0]==="$"?!0:s===t[a])});return n[r]}function X2(n,e){const t=G.get(e).parentPath;if(t!==null)return G2(n,t)}function Z2(n,e){e=e.replace(/^\/|\/$/g,"");const t=G.get(e).parentPath,r=t?G.getPathKeys(t):[];return Object.keys(n).reduce((i,o)=>{const s=G.getPathKeys(o);if(s.length<r.length)return i;let a=!0;if(r.length===0&&t!==null?a=s.length===1&&(s[0]==="*"||typeof s[0]=="string"&&s[0][0]==="$"):s.every((c,l)=>l>=r.length?!1:c==="*"||typeof c=="string"&&c[0]==="$"||c===r[l]?!0:(a=!1,!1)),a){const c=n[o];i.push({path:o,type:c})}return i},[])}function Yy(n,e,t,r,i){if(r===null||typeof r!="object")return r;const o=G.getPathKeys(t),s=Z2(e,t),a=[];return s.sort((c,l)=>G.getPathKeys(c.path).length>G.getPathKeys(l.path).length?-1:1),s.forEach(c=>{const l=G.getPathKeys(c.path);l.push("*");const u=l.slice(o.length);if(u.length===0){const y=G.extractVariables(c.path,t),d=new Xn(n,t,y);if(i==="serialize")r=c.type.serialize(r,d);else if(i==="deserialize"){const f=new st(d,r);r=c.type.deserialize(f)}return}const h=(y,d,f)=>{if(r===null||typeof r!="object")return r;const g=f[0];let _=[];if(g==="*"||typeof g=="string"&&g[0]==="$")d instanceof Array?_=d.map((A,P)=>({key:P,val:A})):_=Object.keys(d).map(A=>({key:A,val:d[A]}));else{const A=d[g];typeof A=="object"&&_.push({key:g,val:A})}_.forEach(A=>{const P=G.getChildPath(y,A.key),B=G.extractVariables(c.path,P),C=new Xn(n,P,B);if(f.length===1){if(i==="serialize")a.push({parent:d,key:A.key,original:d[A.key]}),d[A.key]=c.type.serialize(A.val,C);else if(i==="deserialize"){const L=new st(C,A.val);d[A.key]=c.type.deserialize(L)}}else h(P,A.val,f.slice(1))})};h(t,r,u)}),i==="serialize"&&(r=zn(r),a.length>0&&a.forEach(c=>{c.parent[c.key]=c.original})),r}const Hi=Symbol("mappings");class Ow{constructor(e){this.db=e,this[Hi]={}}get mappings(){return this[Hi]}map(e){return X2(this[Hi],e)}bind(e,t,r={}){if(typeof e!="string")throw new TypeError("path must be a string");if(typeof t!="function")throw new TypeError("constructor must be a function");if(typeof r.serializer!="undefined"){if(typeof r.serializer=="string")if(typeof t.prototype[r.serializer]=="function")r.serializer=t.prototype[r.serializer];else throw new TypeError(`${t.name}.prototype.${r.serializer} is not a function, cannot use it as serializer`);else if(typeof r.serializer!="function")throw new TypeError(`serializer for class ${t.name} must be a function, or the name of a prototype method`)}if(typeof r.creator=="undefined")typeof t.create=="function"&&(r.creator=t.create);else if(typeof r.creator=="string")if(typeof t[r.creator]=="function")r.creator=t[r.creator];else throw new TypeError(`${t.name}.${r.creator} is not a function, cannot use it as creator`);else if(typeof r.creator!="function")throw new TypeError(`creator for class ${t.name} must be a function, or the name of a static method`);e=e.replace(/^\/|\/$/g,""),this[Hi][e]={db:this.db,type:t,creator:r.creator,serializer:r.serializer,deserialize(i){let o;return this.creator?o=this.creator.call(this.type,i):o=new this.type(i),o},serialize(i,o){return this.serializer?i=this.serializer.call(i,o,i):i&&typeof i.serialize=="function"&&(i=i.serialize(o,i)),i}}}serialize(e,t){return Yy(this.db,this[Hi],e,t,"serialize")}deserialize(e,t){return Yy(this.db,this[Hi],e,t,"deserialize")}}const ra=()=>{};class Aw{constructor(e="log",t=""){this.level=e,this.prefix=t,this.setLevel(e)}setLevel(e){const t=this.prefix?this.prefix+" %s":"";this.verbose=["verbose"].includes(e)?t?console.log.bind(console,t):console.log.bind(console):ra,this.log=["verbose","log"].includes(e)?t?console.log.bind(console,t):console.log.bind(console):ra,this.warn=["verbose","log","warn"].includes(e)?t?console.warn.bind(console,t):console.warn.bind(console):ra,this.error=["verbose","log","warn","error"].includes(e)?t?console.error.bind(console,t):console.error.bind(console):ra,this.write=r=>{const i=typeof Tn!="undefined"&&Tn.env&&typeof{}.RUNKIT_ENDPOINT_PATH=="string";r&&i?r.split(`
`).forEach(o=>console.log(o)):console.log(r)}}}const Gy={bold:1,dim:2,italic:3,underline:4,inverse:7,hidden:8,strikethrough:94},Xy={black:30,red:31,green:32,yellow:33,blue:34,magenta:35,cyan:36,white:37,grey:90,brightRed:91},Zy={bgBlack:40,bgRed:41,bgGreen:42,bgYellow:43,bgBlue:44,bgMagenta:45,bgCyan:46,bgWhite:47,bgGrey:100,bgBrightRed:101},ia={all:0,color:39,background:49,bold:22,dim:22,italic:23,underline:24,inverse:27,hidden:28,strikethrough:29};var Tt;(function(n){n.reset="reset",n.bold="bold",n.dim="dim",n.italic="italic",n.underline="underline",n.inverse="inverse",n.hidden="hidden",n.strikethrough="strikethrough",n.black="black",n.red="red",n.green="green",n.yellow="yellow",n.blue="blue",n.magenta="magenta",n.cyan="cyan",n.grey="grey",n.bgBlack="bgBlack",n.bgRed="bgRed",n.bgGreen="bgGreen",n.bgYellow="bgYellow",n.bgBlue="bgBlue",n.bgMagenta="bgMagenta",n.bgCyan="bgCyan",n.bgWhite="bgWhite",n.bgGrey="bgGrey"})(Tt||(Tt={}));function Sw(){if(typeof Tn=="undefined"||!Tn.stdout||!Tn.env||!Tn.platform||Tn.platform==="browser")return!1;if(Tn.platform==="win32")return!0;const n=Tn.env;return n.COLORTERM?!0:n.TERM==="dumb"?!1:n.CI||n.TEAMCITY_VERSION?!!n.TRAVIS:!!(["iTerm.app","HyperTerm","Hyper","MacTerm","Apple_Terminal","vscode"].includes(n.TERM_PROGRAM)||/^xterm-256|^screen|^xterm|^vt100|color|ansi|cygwin|linux/i.test(n.TERM))}let Tw=Sw();function Q2(n){Tw=Sw()&&n}function eB(n,e){if(!Tw)return n;const t=[],r=[],i=a=>{a===Tt.reset?t.push(ia.all):a in Gy?(t.push(Gy[a]),r.push(ia[a])):a in Xy?(t.push(Xy[a]),r.push(ia.color)):a in Zy&&(t.push(Zy[a]),r.push(ia.background))};e instanceof Array?e.forEach(i):i(e);const o=t.map(a=>"\x1B["+a+"m").join(""),s=r.map(a=>"\x1B["+a+"m").join("");return n.split(`
`).map(a=>o+a+s).join(`
`)}String.prototype.colorize=function(n){return eB(this,n)};class Pw{constructor(e){this.logLevel="log",this.logColors=!0,this.info="realtime database",this.sponsor=!1,typeof e!="object"&&(e={}),typeof e.logLevel=="string"&&(this.logLevel=e.logLevel),typeof e.logColors=="boolean"&&(this.logColors=e.logColors),typeof e.info=="string"&&(this.info=e.info),typeof e.sponsor=="boolean"&&(this.sponsor=e.sponsor)}}class tB extends ho{constructor(e,t={}){super(),this._ready=!1,t=new Pw(t),this.name=e,this.debug=new Aw(t.logLevel,`[${e}]`),Q2(t.logColors);const r=[Tt.magenta,Tt.bold],i=`     ___          ______                
    / _ \\         | ___ \\               
   / /_\\ \\ ___ ___| |_/ / __ _ ___  ___ 
   |  _  |/ __/ _ \\ ___ \\/ _\` / __|/ _ \\
   | | | | (_|  __/ |_/ / (_| \\__ \\  __/
   \\_| |_/\\___\\___\\____/ \\__,_|___/\\___|`,o=t.info?"".padStart(40-t.info.length," ")+t.info+`
`:"";t.sponsor||(this.debug.write(i.colorize(r)),o&&this.debug.write(o.colorize(Tt.magenta))),this.types=new Ow(this),this.once("ready",()=>{this._ready=!0})}ready(e){return W(this,null,function*(){this._ready||(yield new Promise(t=>this.on("ready",t))),e==null||e()})}get isReady(){return this._ready}setObservable(e){z2(e)}ref(e){return new Xn(this,e)}get root(){return this.ref("")}query(e){const t=new Xn(this,e);return new $w(t)}get indexes(){return{get:()=>this.api.getIndexes(),create:(e,t,r)=>this.api.createIndex(e,t,r),delete:e=>W(this,null,function*(){return this.api.deleteIndex(e)})}}get schema(){return{get:e=>this.api.getSchema(e),set:(e,t,r=!1)=>this.api.setSchema(e,t,r),all:()=>this.api.getSchemas(),check:(e,t,r)=>this.api.validateSchema(e,t,r)}}}class ut extends Error{constructor(e){super(`${e} is not implemented`)}}class nB extends ho{constructor(){super()}stats(e){throw new ut("stats")}subscribe(e,t,r,i){throw new ut("subscribe")}unsubscribe(e,t,r){throw new ut("unsubscribe")}update(e,t,r){throw new ut("update")}set(e,t,r){throw new ut("set")}get(e,t){throw new ut("get")}transaction(e,t,r){throw new ut("transaction")}exists(e){throw new ut("exists")}query(e,t,r){throw new ut("query")}reflect(e,t,r){throw new ut("reflect")}export(e,t,r){throw new ut("export")}import(e,t,r){throw new ut("import")}createIndex(e,t,r){throw new ut("createIndex")}getIndexes(){throw new ut("getIndexes")}deleteIndex(e){throw new ut("deleteIndex")}setSchema(e,t,r){throw new ut("setSchema")}getSchema(e){throw new ut("getSchema")}getSchemas(){throw new ut("getSchemas")}validateSchema(e,t,r){throw new ut("validateSchema")}getMutations(e){throw new ut("getMutations")}getChanges(e){throw new ut("getChanges")}}function Qy(n,e,t){const r=[0,0,0,0,0];for(let i=0;i<e;i+=4){let o=((n[i]*256+n[i+1])*256+n[i+2])*256+n[i+3];if(!o)t.push("z");else{for(let s=0;s<5;r[s++]=o%85+33,o=Math.floor(o/85));t.push(String.fromCharCode(r[4],r[3],r[2],r[1],r[0]))}}}function rB(n){const e=n,t=[],r=e.length%4,i=e.length-r;if(Qy(e,i,t),r){const s=new Uint8Array(4);s.set(e.slice(i),0),Qy(s,4,t);let a=t.pop();a=="z"&&(a="!!!!!"),t.push(a.substr(0,r+1))}let o=t.join("");return o="<~"+o+"~>",o}const kr={encode:function(n){return n instanceof ArrayBuffer&&(n=new Uint8Array(n,0,n.byteLength)),rB(n)},decode:function(n){if(!n.startsWith("<~")||!n.endsWith("~>"))throw new Error("Invalid input string");n=n.substr(2,n.length-4);const e=n.length,t=[],r=[0,0,0,0,0];let i,o,s,a;for(let l=0;l<e;++l){if(n.charAt(l)=="z"){t.push(0,0,0,0);continue}for(let u=0;u<5;++u)r[u]=n.charCodeAt(l+u)-33;if(a=e-l,a<5){for(let u=a;u<4;r[++u]=0);r[a]=85}i=(((r[0]*85+r[1])*85+r[2])*85+r[3])*85+r[4],o=i&255,i>>>=8,s=i&255,i>>>=8,t.push(i>>>8,i&255,s,o);for(let u=a;u<5;++u,t.pop());l+=4}const c=new Uint8Array(t);return c.buffer.slice(c.byteOffset,c.byteOffset+c.byteLength)}},iB=n=>{if(n.map===null||typeof n.map=="undefined"){if(typeof n.val=="undefined")throw new Error("serialized value must have a val property");return n.val}const e=(t,r)=>t==="date"?new Date(r):t==="binary"?kr.decode(r):t==="reference"?new at(r):t==="regexp"?new RegExp(r.pattern,r.flags):t==="array"?new sc(r):t==="bigint"?BigInt(r):r;return typeof n.map=="string"?e(n.map,n.val):(Object.keys(n.map).forEach(t=>{const r=n.map[t],i=G.getPathKeys(t);let o=n,s="val",a=n.val;i.forEach(c=>{s=c,o=a,a=a[s]}),o[s]=e(r,a)}),n.val)},jw=n=>{var e;if(n===null||typeof n!="object"||n instanceof Date||n instanceof ArrayBuffer||n instanceof at||n instanceof RegExp){const o=jw({value:n});return{map:(e=o.map)==null?void 0:e.value,val:o.val.value}}n=zn(n);const t=(o,s,a)=>{o instanceof sc&&(s[a]="array"),Object.keys(o).forEach(c=>{const l=o[c],u=a.length===0?c:`${a}/${c}`;typeof l=="bigint"?(o[c]=l.toString(),s[u]="bigint"):l instanceof Date?(o[c]=l.toISOString(),s[u]="date"):l instanceof ArrayBuffer?(o[c]=kr.encode(l),s[u]="binary"):l instanceof at?(o[c]=l.path,s[u]="reference"):l instanceof RegExp?(o[c]={pattern:l.source,flags:l.flags},s[u]="regexp"):typeof l=="object"&&l!==null&&t(l,s,u)})},r={};t(n,r,"");const i={val:n};return Object.keys(r).length>0&&(i.map=r),i},eg=n=>n>0?Date.now()+n*1e3:1/0;class oB{get size(){return this.cache.size}constructor(e){var t;if(this.enabled=!0,typeof e=="number"&&(e={expirySeconds:e}),e.cloneValues=e.cloneValues!==!1,typeof e.expirySeconds!="number"&&typeof e.maxEntries!="number")throw new Error("Either expirySeconds or maxEntries must be specified");this.options=e,this.cache=new Map;const r=setInterval(()=>{this.cleanUp()},60*1e3);(t=r.unref)==null||t.call(r)}has(e){return this.enabled?this.cache.has(e):!1}get(e){if(!this.enabled)return null;const t=this.cache.get(e);return t?(t.expires=eg(this.options.expirySeconds),t.accessed=Date.now(),this.options.cloneValues?zn(t.value):t.value):null}set(e,t){if(this.options.maxEntries>0&&this.cache.size>=this.options.maxEntries&&!this.cache.has(e)){let r=null;const i=Date.now();for(const[o,s]of this.cache.entries()){if(s.expires<=i){this.cache.delete(o),r=null;break}(!r||s.accessed<r.accessed)&&(r={key:o,accessed:s.accessed})}r!==null&&this.cache.delete(r.key)}this.cache.set(e,{value:this.options.cloneValues?zn(t):t,added:Date.now(),accessed:Date.now(),expires:eg(this.options.expirySeconds)})}remove(e){this.cache.delete(e)}cleanUp(){const e=Date.now();this.cache.forEach((t,r)=>{t.expires<=e&&this.cache.delete(r)})}}function sB(n){let e=0;function t(){let a;for(;a=n[e],[" ","\r",`
`,"	"].includes(a);)e++}function r(a){if(n[e]!==a)throw new Error(`Unexpected character at position ${e}. Expected: '${a}', found '${n[e]}'`);e++}function i(){t();const a={name:"",optional:!1,wildcard:!1};let c;for(;c=n[e],c==="_"||c==="$"||c>="a"&&c<="z"||c>="A"&&c<="Z"||a.name.length>0&&c>="0"&&c<="9"||a.name.length===0&&c==="*";)a.name+=c,e++;if(a.name.length===0)throw new Error(`Property name expected at position ${e}, found: ${n.slice(e,e+10)}..`);return n[e]==="?"&&(a.optional=!0,e++),(a.name==="*"||a.name[0]==="$")&&(a.optional=!0,a.wildcard=!0),t(),r(":"),a}function o(){t();let a={typeOf:"any"},c,l="";for(;c=n[e],c>="a"&&c<="z"||c>="A"&&c<="Z";)l+=c,e++;if(l.length===0)if(n[e]==="*")r("*"),a.typeOf="any";else if(["'",'"',"`"].includes(n[e])){a.typeOf="string",a.value="";const u=n[e];for(r(u);c=n[e],c&&c!==u;)a.value+=c,e++;r(u)}else if(n[e]>="0"&&n[e]<="9"){a.typeOf="number";let u="";for(;c=n[e],c==="."||c==="n"||c>="0"&&c<="9";)u+=c,e++;u.endsWith("n")?a.value=BigInt(u):u.includes(".")?a.value=parseFloat(u):a.value=parseInt(u)}else if(n[e]==="{"){for(r("{"),a.typeOf="object",a.instanceOf=Object,a.children=[];;){const u=i(),h=s();if(a.children.push({name:u.name,optional:u.optional,wildcard:u.wildcard,types:h}),t(),(n[e]===";"||n[e]===",")&&(r(n[e]),t()),n[e]==="}")break}r("}")}else if(n[e]==="/"){r("/");let u="",h="";for(;c=n[e],c!=="/"||u.endsWith("\\");)u+=c,e++;for(r("/");c=n[e],["g","i","m","s","u","y","d"].includes(c);)h+=c,e++;a.typeOf="string",a.matches=new RegExp(u,h)}else throw new Error(`Expected a type definition at position ${e}, found character '${n[e]}'`);else if(["string","number","boolean","bigint","undefined","String","Number","Boolean","BigInt"].includes(l))a.typeOf=l.toLowerCase();else if(l==="Object"||l==="object")a.typeOf="object",a.instanceOf=Object;else if(l==="Date")a.typeOf="object",a.instanceOf=Date;else if(l==="Binary"||l==="binary")a.typeOf="object",a.instanceOf=ArrayBuffer;else if(l==="any")a.typeOf="any";else if(l==="null")a.typeOf="object",a.value=null;else if(l==="Array")r("<"),a.typeOf="object",a.instanceOf=Array,a.genericTypes=s(),r(">");else if(["true","false"].includes(l))a.typeOf="boolean",a.value=l==="true";else throw new Error(`Unknown type at position ${e}: "${a}"`);for(t();n[e]==="[";)r("["),r("]"),a={typeOf:"object",instanceOf:Array,genericTypes:[a]};return a}function s(){t();const a=[o()];for(;n[e]==="|";)r("|"),a.push(o()),t();return a}return o()}function aB(n,e,t,r){const i=e.find(h=>h.name==="*"||h.name[0]==="$")?[]:Object.keys(t).filter(h=>![null,void 0].includes(t[h])&&!e.find(y=>y.name===h));if(i.length>0)return{ok:!1,reason:`Object at path "${n}" cannot have propert${i.length===1?"y":"ies"} ${i.map(h=>`"${h}"`).join(", ")}`};function o(h){const y=![null,void 0].includes(t[h.name]);return!h.optional&&(r?t[h.name]===null:!y)?{ok:!1,reason:`Property at path "${n}/${h.name}" is not optional`}:y&&h.types.length===1?hs(`${n}/${h.name}`,h.types[0],t[h.name],!1):y&&!h.types.some(d=>hs(`${n}/${h.name}`,d,t[h.name],!1).ok)?{ok:!1,reason:`Property at path "${n}/${h.name}" does not match any of ${h.types.length} allowed types`}:{ok:!0}}const s=e.filter(h=>!h.wildcard),a=s.find(h=>!o(h).ok);if(a)return{ok:!1,reason:o(a).reason};const c=e.find(h=>h.wildcard);if(!c)return{ok:!0};const l=Object.keys(t).filter(h=>!s.find(y=>y.name===h));let u={ok:!0};for(let h=0;h<l.length&&u.ok;h++){const y=l[h];u=o({name:y,types:c.types,optional:!0,wildcard:!0})}return u}function hs(n,e,t,r,i){const o={ok:!0};if(e.typeOf==="any")return o;if(i instanceof Array&&i.length>0){if(e.typeOf!=="object")return{ok:!1,reason:`path "${n}" must be typeof ${e.typeOf}`};if(!e.children)return o;const s=i[0];let a=e.children.find(l=>l.name===s);if(a||(a=e.children.find(l=>l.name==="*"||l.name[0]==="$")),!a)return{ok:!1,reason:`Object at path "${n}" cannot have property "${s}"`};if(a.optional&&t===null&&i.length===1)return o;let c;return a.types.some(l=>{const u=typeof s=="number"?`${n}[${s}]`:`${n}/${s}`;return c=hs(u,l,t,r,i.slice(1)),c.ok}),c}return t===null?o:e.instanceOf===Object&&(typeof t!="object"||t instanceof Array||t instanceof Date)?{ok:!1,reason:`path "${n}" must be an object collection`}:e.instanceOf&&(typeof t!="object"||t.constructor!==e.instanceOf)?{ok:!1,reason:`path "${n}" must be an instance of ${e.instanceOf.name}`}:"value"in e&&t!==e.value?{ok:!1,reason:`path "${n}" must be value: ${e.value}`}:typeof t!==e.typeOf?{ok:!1,reason:`path "${n}" must be typeof ${e.typeOf}`}:e.instanceOf===Array&&e.genericTypes&&!t.every(s=>e.genericTypes.some(a=>hs(n,a,s,!1).ok))?{ok:!1,reason:`every array value of path "${n}" must match one of the specified types`}:e.typeOf==="object"&&e.children?aB(n,e.children,t,r):e.matches&&!e.matches.test(t)?{ok:!1,reason:`path "${n}" must match regular expression /${e.matches.source}/${e.matches.flags}`}:o}function cB(n){switch(n){case String:return"string";case Number:return"number";case Boolean:return"boolean";case Date:return"Date";case BigInt:return"bigint";case Array:throw new Error("Schema error: Array cannot be used without a type. Use string[] or Array<string> instead");default:throw new Error(`Schema error: unknown type used: ${n.name}`)}}class lB{constructor(e,t={warnOnly:!1}){if(this.handling=t,this.source=e,typeof e=="object"){const r=i=>"{"+Object.keys(i).map(o=>{let s=i[o];if(s===void 0)s="undefined";else if(s instanceof RegExp)s=`/${s.source}/${s.flags}`;else if(typeof s=="object")s=r(s);else if(typeof s=="function")s=cB(s);else if(!["string","number","boolean","bigint"].includes(typeof s))throw new Error(`Type definition for key "${o}" must be a string, number, boolean, bigint, object, regular expression, or one of these classes: String, Number, Boolean, Date, BigInt`);return`${o}:${s}`}).join(",")+"}";this.text=r(e)}else if(typeof e=="string")this.text=e;else throw new Error("Type definiton must be a string or an object");this.type=sB(this.text)}check(e,t,r,i){const o=hs(e,this.type,t,r,i);return!o.ok&&this.handling.warnOnly&&(o.warning=`${r?"Partial schema":"Schema"} check on path "${e}"${i?` for child "${i.join("/")}"`:""} failed: ${o.reason}`,o.ok=!0,this.handling.warnCallback(o.warning)),o}}class on{constructor(e="browser"){throw new Error(`This feature is not supported in ${e} context`)}}class nu extends on{}class _h extends on{}class tg extends on{}class uB extends on{}class ng extends on{}class hB extends on{}const dB={OBJECT:1,ARRAY:2,NUMBER:3,BOOLEAN:4,STRING:5,BIGINT:7,DATETIME:6,BINARY:8,REFERENCE:9},le=dB;function fB(n){switch(n){case le.ARRAY:return"array";case le.BINARY:return"binary";case le.BOOLEAN:return"boolean";case le.DATETIME:return"date";case le.NUMBER:return"number";case le.OBJECT:return"object";case le.REFERENCE:return"reference";case le.STRING:return"string";case le.BIGINT:return"bigint"}}class Rw{constructor(e){if(this.path=e.path,this.type=e.type,this.index=e.index,this.key=e.key,this.exists=e.exists,this.address=e.address,this.value=e.value,this.childCount=e.childCount,typeof this.path=="string"&&typeof this.key=="undefined"&&typeof this.index=="undefined"){const t=G.get(this.path);typeof t.key=="number"?this.index=t.key:this.key=t.key}typeof this.exists=="undefined"&&(this.exists=!0)}get valueType(){return this.type}get valueTypeName(){return fB(this.valueType)}toString(){return this.exists?this.address?`"${this.path}" is ${this.valueTypeName} stored at ${this.address.toString()}`:`"${this.path}" is ${this.valueTypeName} with value ${this.value}`:`"${this.path}" doesn't exist`}}function en(n,e){if(!n)throw new Error(`Assertion failed: ${e!=null?e:"check your code"}`)}const pB=120,tn={PENDING:"pending",LOCKED:"locked",EXPIRED:"expired",DONE:"done"};class Iw{constructor(e,t=pB){this._locks=[],this._lastTid=0,this.debug=e,this.timeout=t*1e3}setTimeout(e){this.timeout=e*1e3}createTid(){return Kt.generate()}_allowLock(e,t,r){const i=this._locks.find(o=>o.tid!==t&&o.state===tn.LOCKED&&(r||o.forWriting));return{allow:!i,conflict:i}}quit(){return new Promise(e=>{if(this._locks.length===0)return e();this._quit=e})}_rejectLock(e,t){this._locks.splice(this._locks.indexOf(e),1),clearTimeout(e.timeout);try{e.reject(t)}catch(r){console.error("Unhandled promise rejection:",r)}}_processLockQueue(){if(this._quit){const e=new Error("Quitting");this._locks.filter(t=>t.state===tn.PENDING).forEach(t=>this._rejectLock(t,e)),this._locks.length===0&&this._quit()}this._locks.filter(e=>e.state===tn.PENDING).sort((e,t)=>e.priority&&!t.priority?-1:!e.priority&&t.priority?1:e.requested-t.requested).forEach(e=>{const t=this._allowLock(e.path,e.tid,e.forWriting);e.waitingFor=t.conflict||null,t.allow&&this.lock(e).then(e.resolve).catch(r=>this._rejectLock(e,r))})}lock(e,t){return W(this,arguments,function*(r,i,o=!0,s="",a={withPriority:!1,noTimeout:!1}){let c,l;if(r instanceof ru)c=r,l=!0;else{if(this._locks.findIndex(u=>u.tid===i&&u.state===tn.EXPIRED)>=0)throw new Error(`lock on tid ${i} has expired, not allowed to continue`);if(this._quit&&!a.withPriority)throw new Error("Quitting");{c=new ru(this,r,i,o,a.withPriority===!0),c.comment=s,this._locks.push(c);const u=this._allowLock(r,i,o);c.waitingFor=u.conflict||null,l=u.allow}}if(l){if(c.state=tn.LOCKED,typeof c.granted!="number"&&(c.granted=Date.now(),a.noTimeout!==!0)){c.expires=Date.now()+this.timeout;let u=0;const h=()=>{if(c.state===tn.LOCKED){if(u++,u<=3){this.debug.warn(`${c.forWriting?"write":"read"} lock on path "/${c.path}" by tid ${c.tid} (${c.comment}) is taking a long time to complete [${u}]`),c.timeout=setTimeout(h,this.timeout/4);return}this.debug.error(`lock :: ${c.forWriting?"write":"read"} lock on path "/${c.path}" by tid ${c.tid} (${c.comment}) took too long`),c.state=tn.EXPIRED,this._processLockQueue()}};c.timeout=setTimeout(h,this.timeout/4)}return c}else return en(c.state===tn.PENDING),new Promise((u,h)=>{c.resolve=u,c.reject=h})})}unlock(e,t,r=!0){let i,o;if(e instanceof ru)i=e,o=this._locks.indexOf(i);else{const s=e;o=this._locks.findIndex(a=>a.id===s),i=this._locks[o]}if(o<0){const s=`lock on "/${i.path}" for tid ${i.tid} wasn't found; ${t}`;throw new Error(s)}return i.state=tn.DONE,clearTimeout(i.timeout),this._locks.splice(o,1),r&&this._processLockQueue(),i}list(){return this._locks||[]}isAllowed(e,t,r){return this._allowLock(e,t,r).allow}}let yB=0;class ru{static get LOCK_STATE(){return tn}constructor(e,t,r,i,o=!1){this.locker=e,this.path=t,this.tid=r,this.forWriting=i,this.priority=o,this.state=tn.PENDING,this.requested=Date.now(),this.comment="",this.waitingFor=null,this.id=++yB,this.history=[]}release(e){return W(this,null,function*(){return this.history.push({action:"release",path:this.path,forWriting:this.forWriting,comment:e}),this.locker.unlock(this,e||this.comment)})}moveToParent(){return W(this,null,function*(){const e=G.get(this.path).parentPath;if(this.locker.isAllowed(e,this.tid,this.forWriting))return this.history.push({path:this.path,forWriting:this.forWriting,action:"moving to parent"}),this.waitingFor=null,this.path=e,this;{this.locker.unlock(this,`moveLockToParent: ${this.comment}`,!1);const t=yield this.locker.lock(e,this.tid,this.forWriting,this.comment,{withPriority:!0});return t.history=this.history,t.history.push({path:this.path,forWriting:this.forWriting,action:"moving to parent through queue (priority)"}),t}})}}class yf extends Error{}class $h extends Error{}class gB extends Error{constructor(e){super(`Exiting: ${e}`)}}class mB extends ho{get isMaster(){return this.masterPeerId===this.id}constructor(e,t,r=e.name){super(),this.storage=e,this.id=t,this.dbname=r,this.ipcType="ipc",this.ourSubscriptions=[],this.remoteSubscriptions=[],this.peers=[],this._exiting=!1,this._locks=[],this._requests=new Map,this._eventsEnabled=!0,this._nodeLocker=new Iw(e.debug,e.settings.lockTimeout),e.on("subscribe",i=>{if(e.debug.verbose(`database subscription being added on peer ${this.id}`),this.remoteSubscriptions.find(a=>a.callback===i.callback))return;const o=this.ourSubscriptions.some(a=>a.event===i.event&&a.path===i.path);if(this.ourSubscriptions.push(i),o)return;const s={type:"subscribe",from:this.id,data:{path:i.path,event:i.event}};this.sendMessage(s)}),e.on("unsubscribe",i=>{const o=this.remoteSubscriptions.find(s=>s.callback===i.callback);if(o){this.remoteSubscriptions.splice(this.remoteSubscriptions.indexOf(o),1);return}this.ourSubscriptions.filter(s=>s.path===i.path&&(!i.event||s.event===i.event)&&(!i.callback||s.callback===i.callback)).forEach(s=>{this.ourSubscriptions.splice(this.ourSubscriptions.indexOf(s),1);const a={type:"unsubscribe",from:this.id,data:{path:s.path,event:s.event}};this.sendMessage(a)})})}exit(e=0){return W(this,null,function*(){if(this._exiting)return this.once("exit");this._exiting=!0,this.storage.debug.warn(`Received ${this.isMaster?"master":"worker "+this.id} process exit request`),this._locks.length>0&&(this.storage.debug.warn(`Waiting for ${this.isMaster?"master":"worker"} ${this.id} locks to clear`),yield this.once("locks-cleared")),this.sayGoodbye(this.id),this.storage.debug.warn(`${this.isMaster?"Master":"Worker "+this.id} will now exit`),this.emitOnce("exit",e)})}sayGoodbye(e){const t={type:"bye",from:e,data:void 0};this.sendMessage(t)}addPeer(e,t=!0){if(!this._exiting&&(this.peers.find(r=>r.id===e)||this.peers.push({id:e,lastSeen:Date.now()}),t)){const r={type:"hello",from:this.id,to:e,data:void 0};this.sendMessage(r),this.ourSubscriptions.forEach(i=>{const o={type:"subscribe",from:this.id,to:e,data:{path:i.path,event:i.event}};this.sendMessage(o)})}}removePeer(e,t=!1){if(this._exiting)return;const r=this.peers.find(i=>i.id===e);if(!r){if(!t)throw new Error("We are supposed to know this peer!");return}this.peers.splice(this.peers.indexOf(r),1),this.remoteSubscriptions.filter(i=>i.for===e).forEach(i=>{this.remoteSubscriptions.splice(this.remoteSubscriptions.indexOf(i),1),this.storage.subscriptions.remove(i.path,i.event,i.callback)})}addRemoteSubscription(e,t){if(this._exiting||this.remoteSubscriptions.some(i=>i.for===e&&i.event===t.event&&i.path===t.path))return;const r=(i,o,s,a,c)=>{const l={type:"event",from:this.id,to:e,path:t.path,event:t.event,data:{path:o,val:s,previous:a,context:c}};this.sendMessage(l)};this.remoteSubscriptions.push({for:e,event:t.event,path:t.path,callback:r}),this.storage.subscriptions.add(t.path,t.event,r)}cancelRemoteSubscription(e,t){const r=this.remoteSubscriptions.find(i=>i.for===e&&i.event===t.event&&i.path===t.event);!r||this.storage.subscriptions.remove(t.path,t.event,r.callback)}handleMessage(e){return W(this,null,function*(){switch(e.type){case"hello":return this.addPeer(e.from,e.to!==this.id);case"bye":return this.removePeer(e.from,!0);case"subscribe":return this.addRemoteSubscription(e.from,e.data);case"unsubscribe":return this.cancelRemoteSubscription(e.from,e.data);case"event":{if(!this._eventsEnabled)break;const t=e,r=t.data.context||{};r.acebase_ipc={type:this.ipcType,origin:t.from},this.ourSubscriptions.filter(i=>i.event===t.event&&i.path===t.path).forEach(i=>{i.callback(null,t.data.path,t.data.val,t.data.previous,r)});break}case"lock-request":{if(!this.isMaster)throw new Error("Workers are not supposed to receive lock requests!");const t=e,r={type:"lock-result",id:t.id,from:this.id,to:t.from,ok:!0,data:void 0};try{const i=yield this.lock(t.data);r.data={id:i.id,path:i.path,tid:i.tid,write:i.forWriting,expires:i.expires,comment:i.comment}}catch(i){r.ok=!1,r.reason=i.stack||i.message||i}return this.sendMessage(r)}case"lock-result":{if(this.isMaster)throw new Error("Masters are not supposed to receive results for lock requests!");const t=e,r=this._requests.get(t.id);if(typeof r!="object")throw new Error("The request must be known to us!");t.ok?r.resolve(t.data):r.reject(new Error(t.reason));return}case"unlock-request":{if(!this.isMaster)throw new Error("Workers are not supposed to receive unlock requests!");const t=e,r={type:"unlock-result",id:t.id,from:this.id,to:t.from,ok:!0,data:{id:t.data.id}};try{yield this._locks.find(i=>{var o;return((o=i.lock)==null?void 0:o.id)===t.data.id}).lock.release()}catch(i){r.ok=!1,r.reason=i.stack||i.message||i}return this.sendMessage(r)}case"unlock-result":{if(this.isMaster)throw new Error("Masters are not supposed to receive results for unlock requests!");const t=e,r=this._requests.get(t.id);if(typeof r!="object")throw new Error("The request must be known to us!");t.ok?r.resolve(t.data):r.reject(new Error(t.reason));return}case"move-lock-request":{if(!this.isMaster)throw new Error("Workers are not supposed to receive move lock requests!");const t=e,r={type:"lock-result",id:t.id,from:this.id,to:t.from,ok:!0,data:void 0};try{let i;const o=this._locks.find(s=>{var a;return((a=s.lock)==null?void 0:a.id)===t.data.id});if(t.data.move_to==="parent")i=yield o.lock.moveToParent();else throw new Error(`Unknown lock move_to "${t.data.move_to}"`);o.lock=i,r.data={id:i.id,path:i.path,tid:i.tid,write:i.forWriting,expires:i.expires,comment:i.comment}}catch(i){r.ok=!1,r.reason=i.stack||i.message||i}return this.sendMessage(r)}case"notification":return this.emit("notification",e);case"request":return this.emit("request",e);case"result":{const t=e,r=this._requests.get(t.id);if(typeof r!="object")throw new Error("Result of unknown request received");t.ok?r.resolve(t.data):r.reject(new Error(t.reason))}}})}lock(e){return W(this,null,function*(){if(this._exiting&&!this._locks.find(r=>r.tid===e.tid&&r.granted))throw new gB("new transaction lock denied because the IPC peer is exiting");const t=r=>{this._locks.splice(this._locks.indexOf(r),1),this._locks.length===0&&this.emit("locks-cleared")};if(this.isMaster){const r={tid:e.tid,granted:!1,request:e,lock:null};this._locks.push(r);const i=yield this._nodeLocker.lock(e.path,e.tid,e.write,e.comment);r.tid=i.tid,r.granted=!0;const o=s=>({get id(){return s.id},get tid(){return s.tid},get path(){return s.path},get forWriting(){return s.forWriting},get expires(){return s.expires},get comment(){return s.comment},get state(){return s.state},release:()=>W(this,null,function*(){yield s.release(),t(r)}),moveToParent:()=>W(this,null,function*(){const a=yield s.moveToParent();return r.lock=o(a),r.lock})});return r.lock=o(i),r.lock}else{const r={tid:e.tid,granted:!1,request:e,lock:null};this._locks.push(r);const i=c=>(r.granted=!0,r.tid=c.tid,r.lock={id:c.id,tid:c.tid,path:c.path,forWriting:c.write,state:tn.LOCKED,expires:c.expires,comment:c.comment,release:()=>W(this,null,function*(){const l={type:"unlock-request",id:Kt.generate(),from:this.id,to:this.masterPeerId,data:{id:r.lock.id}};yield this.request(l),r.lock.state=tn.DONE,this.storage.debug.verbose(`Worker ${this.id} released lock ${r.lock.id} (tid ${r.lock.tid}, ${r.lock.comment}, "/${r.lock.path}", ${r.lock.forWriting?"write":"read"})`),t(r)}),moveToParent:()=>W(this,null,function*(){const l={type:"move-lock-request",id:Kt.generate(),from:this.id,to:this.masterPeerId,data:{id:r.lock.id,move_to:"parent"}};let u;try{u=yield this.request(l)}catch(h){throw r.lock.state=tn.DONE,t(r),h}return r.lock=i(u),r.lock})},r.lock),o={type:"lock-request",id:Kt.generate(),from:this.id,to:this.masterPeerId,data:e};let s,a;try{s=yield this.request(o)}catch(c){a=c,s=null}if(a)throw t(r),a;return i(s)}})}request(e){return W(this,null,function*(){let t,r;const i=new Promise((o,s)=>{t=a=>{this._requests.delete(e.id),o(a)},r=a=>{this._requests.delete(e.id),s(a)}});return this._requests.set(e.id,{resolve:t,reject:r,request:e}),this.sendMessage(e),i})}sendRequest(e){const t={type:"request",from:this.id,to:this.masterPeerId,id:Kt.generate(),data:e};return this.request(t).catch(r=>{throw this.storage.debug.error(r),r})}replyRequest(e,t){const r={type:"result",id:e.id,ok:!0,from:this.id,to:e.from,data:t};this.sendMessage(r)}sendNotification(e){const t={type:"notification",from:this.id,data:e};this.sendMessage(t)}get eventsEnabled(){return this._eventsEnabled}set eventsEnabled(e){this.storage.debug.log(`ipc events ${e?"enabled":"disabled"}`),this._eventsEnabled=e}}class vB extends mB{constructor(e){if(super(e,Kt.generate()),this.masterPeerId=this.id,this.ipcType="browser.bcc",window.addEventListener("beforeunload",()=>{this.exit()}),typeof window.BroadcastChannel!="undefined")this.channel=new BroadcastChannel(`acebase:${e.name}`);else{const r=[null],i=()=>{throw new Error("Not implemented")};this.channel={name:`acebase:${e.name}`,postMessage:o=>{const s=Kt.generate(),a=`acebase:${e.name}:${this.id}:${s}`,c=JSON.stringify(jw(o));localStorage.setItem(a,c),setTimeout(()=>localStorage.removeItem(a),10)},set onmessage(o){r[0]=o},set onmessageerror(o){i()},close(){i()},addEventListener(o,s){o!=="message"&&i(),r.push(s)},removeEventListener(o,s){const a=r.indexOf(s);a>=1&&r.splice(a,1)},dispatchEvent(o){return r.forEach(s=>{try{s&&s(o)}catch(a){console.error(a)}}),!0}},window.addEventListener("storage",o=>{const[s,a,c,l]=o.key.split(":");if(s!=="acebase"||a!==e.name||c===this.id||o.newValue===null)return;const u=iB(JSON.parse(o.newValue));this.channel.dispatchEvent({data:u})})}this.channel.addEventListener("message",r=>W(this,null,function*(){const i=r.data;if(!(i.to&&i.to!==this.id)){if(e.debug.verbose("[BroadcastChannel] received: ",i),i.type==="hello"&&i.from<this.masterPeerId)this.masterPeerId=i.from,e.debug.log(`[BroadcastChannel] Tab ${this.masterPeerId} is the master.`);else if(i.type==="bye"&&i.from===this.masterPeerId){e.debug.log(`[BroadcastChannel] Master tab ${this.masterPeerId} is leaving`);const o=this.peers.map(a=>a.id).concat(this.id).filter(a=>a!==this.masterPeerId);this.masterPeerId=o.sort()[0],e.debug.log(`[BroadcastChannel] ${this.masterPeerId===this.id?"We are":`tab ${this.masterPeerId} is`} the new master. Requesting ${this._locks.length} locks (${this._locks.filter(a=>!a.granted).length} pending)`);const s=this._locks.splice(0);yield Promise.all(s.filter(a=>a.granted).map(a=>W(this,null,function*(){let c,l;a.lock.release=()=>new Promise(h=>c=h),a.lock.moveToParent=()=>new Promise(h=>l=h);const u=yield this.lock({path:a.lock.path,write:a.lock.forWriting,tid:a.lock.tid,comment:a.lock.comment});if(l){const h=yield u.moveToParent();l(h)}c&&(yield u.release(),c())}))),yield Promise.all(s.filter(a=>!a.granted).map(a=>W(this,null,function*(){yield this.lock(a.request)})))}return this.handleMessage(i)}}));const t={type:"hello",from:this.id,data:void 0};this.sendMessage(t)}sendMessage(e){this.storage.debug.verbose("[BroadcastChannel] sending: ",e),this.channel.postMessage(e)}}class Ko{static get hasFileSystem(){return!1}static get fs(){return null}}class gf extends on{}class Cw extends on{}class bB extends on{}class wB extends on{}function kB(n,e,t,r){return W(this,null,function*(){if(!n.storage.indexes.supported)throw new Error("Indexes are not supported in current environment because it requires Node.js fs");const{ipc:i,debug:o,indexes:s,storage:a}=n,c=r&&r.rebuild===!0,l=r&&r.type||"normal";let u=r&&r.include||[];typeof u=="string"&&(u=[u]);const h=s.find(d=>d.path===e&&d.key===t&&d.type===l&&d.includeKeys.length===u.length&&d.includeKeys.every((f,g)=>u[g]===f));if(h&&r.config&&(h.config=r.config),h&&c!==!0)return o.log(`Index on "/${e}/*/${t}" already exists`.colorize(Tt.inverse)),h;if(!i.isMaster){const d=yield i.sendRequest({type:"index.create",path:e,key:t,options:r});if(d.ok)return a.indexes.add(d.fileName);throw new Error(d.reason)}yield Ko.mkdir(`${a.settings.path}/${a.name}.acebase`).catch(d=>{if(d.code!=="EEXIST")throw d});const y=h||(()=>{const{include:d,caseSensitive:f,textLocale:g,textLocaleKey:_}=r,A={include:d,caseSensitive:f,textLocale:g,textLocaleKey:_};switch(l){case"array":return new wB(a,e,t,ie({},A));case"fulltext":return new Cw(a,e,t,et(ie({},A),{config:r.config}));case"geo":return new bB(a,e,t,ie({},A));default:return new gf(a,e,t,ie({},A))}})();h||s.push(y);try{yield y.build()}catch(d){throw n.debug.error(`Index build on "/${e}/*/${t}" failed: ${d.message} (code: ${d.code})`.colorize(Tt.red)),h||s.splice(s.indexOf(y),1),d}return i.sendNotification({type:"index.created",fileName:y.fileName,path:e,key:t,options:r}),y})}const{compareValues:oa,getChildValues:gi,encodeString:rg,defer:xB}=kw,Oh=["value","child_added","child_changed","child_removed","mutated","mutations"];Oh.push(...Oh.map(n=>`notify_${n}`));const EB=()=>{};class _B extends Error{constructor(e){super(`Schema validation failed: ${e}`),this.reason=e}}class mf{constructor(e={}){this.maxInlineValueSize=50,this.removeVoidProperties=!1,this.path=".",this.lockTimeout=120,this.type="data",this.readOnly=!1,typeof e.maxInlineValueSize=="number"&&(this.maxInlineValueSize=e.maxInlineValueSize),typeof e.removeVoidProperties=="boolean"&&(this.removeVoidProperties=e.removeVoidProperties),typeof e.path=="string"&&(this.path=e.path),this.path.endsWith("/")&&(this.path=this.path.slice(0,-1)),typeof e.lockTimeout=="number"&&(this.lockTimeout=e.lockTimeout),typeof e.type=="string"&&(this.type=e.type),typeof e.readOnly=="boolean"&&(this.readOnly=e.readOnly),["object","string"].includes(typeof e.ipc)&&(this.ipc=e.ipc)}}class $B extends ho{createTid(){return Kt.generate()}constructor(e,t,r){super(),this.name=e,this.settings=t,this._schemas=[],this._indexes=[],this._annoucedIndexes=new Map,this.indexes={get supported(){return Ko==null?void 0:Ko.hasFileSystem},create:(o,s,a={rebuild:!1})=>{const c={storage:this,debug:this.debug,indexes:this._indexes,ipc:this.ipc};return kB(c,o,s,a)},get:(o,s=null)=>{if(o.includes("$")){const a=G.getPathKeys(o).map(c=>typeof c=="string"&&c.startsWith("$")?"*":c);o=new G(a).path}return this._indexes.filter(a=>a.path===o&&(s===null||s===a.key))},getAll:(o,s={parentPaths:!0,childPaths:!0})=>{const a=G.getPathKeys(o);return this._indexes.filter(c=>{const l=G.getPathKeys(c.path+"/*");return s.parentPaths&&l.every((u,h)=>u==="*"||a[h]===u)&&[c.key].concat(...c.includeKeys).includes(a[l.length])?!0:l.length<a.length||!s.childPaths&&l.length!==a.length?!1:a.every((u,h)=>[u,"*"].includes(l[h]))})},list:()=>this._indexes.slice(),load:()=>W(this,null,function*(){if(this._indexes.splice(0),!Ko.hasFileSystem)return;let o=[];try{o=yield Ko.readdir(`${this.settings.path}/${this.name}.acebase`)}catch(a){a.code!=="ENOENT"&&this.debug.error(a)}const s=[];o.forEach(a=>{if(!a.endsWith(".idx"))return;const c=this.settings.type!=="data",l=/^\[[a-z]+\]-/.test(a);if(!c&&!l||c&&a.startsWith(`[${this.settings.type}]-`)){const u=this.indexes.add(a);s.push(u)}}),yield Promise.all(s)}),add:o=>W(this,null,function*(){const s=this._indexes.find(a=>a.fileName===o);if(s)return s;if(this._annoucedIndexes.has(o))return yield this._annoucedIndexes.get(o);try{const a=gf.readFromFile(this,o);this._annoucedIndexes.set(o,a);const c=yield a;return this._indexes.push(c),this._annoucedIndexes.delete(o),c}catch(a){return this.debug.error(a),null}}),delete:o=>W(this,null,function*(){const s=yield this.indexes.remove(o);yield s.delete(),this.ipc.sendNotification({type:"index.deleted",fileName:s.fileName,path:s.path,keys:s.key})}),remove:o=>W(this,null,function*(){const s=this._indexes.find(a=>a.fileName===o);if(!s)throw new Error(`Index ${o} not found`);return this._indexes.splice(this._indexes.indexOf(s),1),s}),close:()=>W(this,null,function*(){const o=this.indexes.list().map(s=>s.close().catch(a=>this.debug.error(a)));yield Promise.all(o)})},this._eventSubscriptions={},this.subscriptions={add:(o,s,a)=>{if(Oh.indexOf(s)<0)throw new TypeError(`Invalid event type "${s}"`);let c=this._eventSubscriptions[o];c||(c=this._eventSubscriptions[o]=[]),c.push({created:Date.now(),type:s,callback:a}),this.emit("subscribe",{path:o,event:s,callback:a})},remove:(o,s,a)=>{const c=this._eventSubscriptions[o];if(!c)return;const l=()=>c.findIndex(h=>(s?h.type===s:!0)&&(a?h.callback===a:!0));let u;for(;(u=l())>=0;)c.splice(u,1);this.emit("unsubscribe",{path:o,event:s,callback:a})},hasValueSubscribersForPath(o){return!!this.getValueSubscribersForPath(o)},getValueSubscribersForPath:o=>{const s=new G(o),a=[];return Object.keys(this._eventSubscriptions).forEach(c=>{if(s.equals(c)||s.isDescendantOf(c)){const l=this._eventSubscriptions[c],u=G.fillVariables(c,o);l.filter(h=>!h.type.startsWith("notify_")).forEach(h=>{let y=null;if(h.type==="value")y=u;else if(["mutated","mutations"].includes(h.type)&&s.isDescendantOf(u))y=o;else if(h.type==="child_changed"&&o!==u){const d=G.getPathKeys(o.slice(u.length).replace(/^\//,""))[0];y=G.getChildPath(u,d)}else if(["child_added","child_removed"].includes(h.type)&&s.isChildOf(u)){const d=G.getPathKeys(o.slice(u.length).replace(/^\//,""))[0];y=G.getChildPath(u,d)}y!==null&&!a.some(d=>d.type===h.type&&d.eventPath===u)&&a.push({type:h.type,eventPath:u,dataPath:y,subscriptionPath:c})})}}),a},getAllSubscribersForPath:o=>{const s=G.get(o),a=[];return Object.keys(this._eventSubscriptions).forEach(c=>{if(s.isOnTrailOf(c)){const l=this._eventSubscriptions[c],u=G.fillVariables(c,o);l.forEach(h=>{let y=null;if(h.type==="value"||h.type==="notify_value")y=u;else if(["child_changed","notify_child_changed"].includes(h.type)){const d=o===u||s.isAncestorOf(u)?"*":G.getPathKeys(o.slice(u.length).replace(/^\//,""))[0];y=G.getChildPath(u,d)}else if(["mutated","mutations","notify_mutated","notify_mutations"].includes(h.type))y=o;else if(["child_added","child_removed","notify_child_added","notify_child_removed"].includes(h.type)&&(s.isChildOf(u)||o===u||s.isAncestorOf(u))){const d=o===u||s.isAncestorOf(u)?"*":G.getPathKeys(o.slice(u.length).replace(/^\//,""))[0];y=G.getChildPath(u,d)}y!==null&&!a.some(d=>d.type===h.type&&d.eventPath===u&&d.subscriptionPath===c)&&a.push({type:h.type,eventPath:u,dataPath:y,subscriptionPath:c})})}}),a},trigger:(o,s,a,c,l,u)=>{(this._eventSubscriptions[s]||[]).filter(h=>h.type===o).forEach(h=>{h.callback(null,a,l,c,u)})}},this.debug=new Aw(r.logLevel,`[${e}${typeof t.type=="string"&&t.type!=="data"?`:${t.type}`:""}]`);const i=e+(typeof t.type=="string"?`_${t.type}`:"");if(t.ipc==="socket"||t.ipc instanceof on){const o={ipcName:i,server:t.ipc instanceof on?t.ipc:null};this.ipc=new on(this,o)}else if(t.ipc){if(typeof t.ipc.port!="number")throw new Error("IPC port number must be a number");if(!["master","worker"].includes(t.ipc.role))throw new Error(`IPC client role must be either "master" or "worker", not "${t.ipc.role}"`);const o=Object.assign({dbname:i},t.ipc);this.ipc=new on(this,o)}else this.ipc=new vB(this,i);this.ipc.once("exit",o=>{this.indexes.supported&&this.indexes.close()}),this.nodeLocker={lock:(o,s,a,c)=>this.ipc.lock({path:o,tid:s,write:a,comment:c})},this._lastTid=0}close(){return W(this,null,function*(){yield this.ipc.exit()})}get path(){return`${this.settings.path}/${this.name}.acebase`}valueFitsInline(e){if(typeof e=="number"||typeof e=="boolean"||e instanceof Date)return!0;if(typeof e=="string")return e.length>this.settings.maxInlineValueSize?!1:rg(e).length<this.settings.maxInlineValueSize;if(e instanceof at)return e.path.length>this.settings.maxInlineValueSize?!1:rg(e.path).length<this.settings.maxInlineValueSize;if(e instanceof ArrayBuffer)return e.byteLength<this.settings.maxInlineValueSize;if(e instanceof Array)return e.length===0;if(typeof e=="object")return Object.keys(e).length===0;throw new TypeError("What else is there?")}_writeNode(e,t,r){throw new Error("This method must be implemented by subclass")}getUpdateImpact(e,t){let r=e,i=!1;const o=t?[]:this.subscriptions.getAllSubscribersForPath(e),s=t?[]:this.subscriptions.getValueSubscribersForPath(e);s.length>0&&(i=!0,r=s.map(l=>({path:l.dataPath,keys:G.getPathKeys(l.dataPath)})).sort((l,u)=>l.keys.length<u.keys.length?-1:l.keys.length>u.keys.length?1:0)[0].path,s.filter(l=>l.dataPath===r).every(l=>l.type==="mutated"||l.type.startsWith("notify_"))&&(i=!1),r=G.fillVariables(r,e));const a=this.indexes.getAll(e,{childPaths:!0,parentPaths:!0}).map(l=>({index:l,keys:G.getPathKeys(l.path)})).sort((l,u)=>l.keys.length<u.keys.length?-1:l.keys.length>u.keys.length?1:0).map(l=>l.index),c=[];if(a.length>0){a.sort((h,y)=>(typeof h._pathKeys=="undefined"&&(h._pathKeys=G.getPathKeys(h.path)),typeof y._pathKeys=="undefined"&&(y._pathKeys=G.getPathKeys(y.path)),h._pathKeys.length<y._pathKeys.length?-1:h._pathKeys.length>y._pathKeys.length?1:0));const l=a[0],u=l.path===e?e:G.fillVariables(`${l.path}/*`,e);u.length<r.length&&(r=u,a.filter(h=>h.path===l.path).forEach(h=>{[h.key].concat(h.includeKeys).forEach(y=>!c.includes(y)&&c.push(y))}))}return{topEventPath:r,eventSubscriptions:o,valueSubscribers:s,hasValueSubscribers:i,indexes:a,keysFilter:c}}_writeNodeWithTracking(e,t){return W(this,arguments,function*(r,i,o={merge:!1,waitForIndexUpdates:!0,suppress_events:!1,context:null,impact:null}){if(o=o||{},!o.tid&&!o.transaction)throw new Error("_writeNodeWithTracking MUST be executed with a tid OR transaction!");o.merge=o.merge===!0;const s=this.validateSchema(r,i,{updates:o.merge});if(!s.ok)throw new _B(s.reason);const a=o.tid,c=o.transaction;let l=null;const u=o.impact?o.impact:this.getUpdateImpact(r,o.suppress_events),{topEventPath:h,eventSubscriptions:y,hasValueSubscribers:d,indexes:f}=u;let{keysFilter:g}=u;const _=()=>{if(typeof o._customWriteFunction=="function")return o._customWriteFunction();if(l){const O=G.getPathKeys(r),p=G.getPathKeys(h),v=O.slice(p.length);let m=l;for(;v.length>0&&m!==null;){const w=v.shift();m=typeof m=="object"&&w in m?m[w]:null}o.currentValue=m}return this._writeNode(r,i,o)},A=this.settings.transactions&&this.settings.transactions.log===!0;if(y.length===0&&f.length===0&&!A)return _();if(!d&&o.merge===!0&&g.length===0&&(g=Object.keys(i),h!==r)){const O=r.slice(h.length);g=g.map(p=>`${O}/${p}`)}const P=yield this.getNodeInfo(h,{transaction:c,tid:a});let B=null;if(P.exists){const O={transaction:c,tid:a};g.length>0&&(O.include=g),h===""&&typeof O.include=="undefined"&&this.debug.warn('WARNING: One or more value event listeners on the root node are causing the entire database value to be read to facilitate change tracking. Using "value", "notify_value", "child_changed" and "notify_child_changed" events on the root node are a bad practice because of the significant performance impact. Use "mutated" or "mutations" events instead'),B=(yield this.getNode(h,O)).value}l=B;const C=(yield _())||{};let L,q;if(r===h)o.merge?l===null?L=i instanceof Array?[]:{}:(L=l instanceof Array?[]:{},Object.keys(l).forEach(O=>{L[O]=l[O]})):L=i,q=L;else{const O=r.slice(h.length).replace(/^\//,""),p=G.getPathKeys(O);for(l===null?L=typeof p[0]=="number"?[]:{}:(L=l instanceof Array?[]:{},Object.keys(l).forEach(v=>{L[v]=l[v]})),q=L;p.length>0;){const v=p.shift();if(!o.merge&&p.length===0)q[v]=i;else{const m=q[v],w=typeof v=="number"?[...m]:ie({},m);q[v]=w}q=q[v]}}o.merge&&Object.keys(i).forEach(O=>{q[O]=i[O]});const H=oa(l,L);if(H==="identical")return C.mutations=[],C;function j(O){if(O===null||typeof O!="object")return O;Object.keys(O).forEach(p=>{const v=O[p];v===null&&(delete O[p],O instanceof Array&&O.length--),typeof v=="object"&&j(v)})}j(L);const I=[];f.map(O=>({index:O,keys:G.getPathKeys(O.path)})).sort((O,p)=>O.keys.length<p.keys.length?1:O.keys.length>p.keys.length?-1:0).forEach(({index:O})=>{const p=G.getPathKeys(h),v=G.getPathKeys(O.path+"/*"),m=v.slice(p.length),w=l,E=L;if(m.length===0){en(p.length===v.length,"check logic");const k=this.ipc.isMaster?O.handleRecordUpdate(h,w,E):this.ipc.sendRequest({type:"index.update",fileName:O.fileName,path:h,oldValue:w,newValue:E});I.push(k);return}const b=(k,x,$)=>{if(x===null&&$===null)return[];const S=G.getPathKeys(k),T=G.getPathKeys(O.path+"/*"),R=T.slice(S.length);if(R.length===0)return en(S.length===T.length,"check logic"),[{path:k,oldValue:x,newValue:$}];let N=[],z="";for(;R.length>0;){const F=R.shift();if(typeof F=="string"&&(F==="*"||F.startsWith("$"))){const ne=x===null?[]:Object.keys(x);$!==null&&Object.keys($).forEach(te=>{ne.indexOf(te)<0&&ne.push(te)}),ne.forEach(te=>{const pe=G.getChildPath(z,te),oe=gi(te,x,$),re=G.getChildPath(k,pe),ue=b(re,oe.oldValue,oe.newValue);N=N.concat(ue)});break}else{const ne=gi(F,x,$);if(x=ne.oldValue,$=ne.newValue,x===null&&$===null)break;z=G.getChildPath(z,F)}}return N};b(h,w,E).forEach(k=>{const x=this.ipc.isMaster?O.handleRecordUpdate(k.path,k.oldValue,k.newValue):this.ipc.sendRequest({type:"index.update",fileName:O.fileName,path:k.path,oldValue:k.oldValue,newValue:k.newValue});I.push(x)})});const D=(O,p,v,m=[])=>{let w=!0,E=O.type;if(E.startsWith("notify_")&&(E=E.slice(7)),E==="mutated"||(E==="child_changed"&&(p===null||v===null)?w=!1:E==="value"||E==="child_changed"?w=oa(p,v)!=="identical":E==="child_added"?w=p===null&&v!==null:E==="child_removed"&&(w=p!==null&&v===null),!w))return;const b=G.getPathKeys(O.dataPath);m.forEach(x=>{const $=b.indexOf(x.name);en($>=0,`Variable "${x.name}" not found in subscription dataPath "${O.dataPath}"`),b[$]=x.value});const k=b.reduce((x,$)=>G.getChildPath(x,$),"");this.subscriptions.trigger(O.type,O.subscriptionPath,k,p,v,o.context)},M=(O,p,v,m)=>{const w=[],E=m||oa(p,v);return E==="identical"||(typeof E=="string"?w.push({path:O,oldValue:p,newValue:v}):(E.changed.forEach(b=>{const k=G.getChildPath(O,b.key),x=gi(b.key,p,v),$=M(k,x.oldValue,x.newValue,b.change);w.push(...$)}),E.added.forEach(b=>{const k=G.getChildPath(O,b);w.push({path:k,oldValue:null,newValue:v[b]})}),p instanceof Array&&v instanceof Array&&E.removed.sort((b,k)=>b<k?1:-1),E.removed.forEach(b=>{const k=G.getChildPath(O,b);w.push({path:k,oldValue:p[b],newValue:null})}))),w};A&&this.settings.type!=="transaction"&&(C.mutations=(()=>{const O=r.slice(h.length).replace(/^\//,""),p=G.getPathKeys(O);let v=l,m=L;for(;p.length>0;){const E=p.shift();({oldValue:v,newValue:m}=gi(E,v,m))}const w=oa(v,m);return M(r,v,m,w).map(E=>({target:G.getPathKeys(E.path.slice(r.length)),prev:E.oldValue,val:E.newValue}))})());const U=()=>{y.filter(O=>!["mutated","mutations","notify_mutated","notify_mutations"].includes(O.type)).map(O=>{const p=G.getPathKeys(O.dataPath);return{sub:O,keys:p}}).sort((O,p)=>O.keys.length<p.keys.length?1:O.keys.length>p.keys.length?-1:0).forEach(({sub:O})=>{const p=(v,m,w,E=[])=>{const b=O.dataPath.slice(v.length).replace(/^\//,""),k=G.getPathKeys(b);for(;k.length>0;){const x=k.shift();if(typeof x=="string"&&(x==="*"||x[0]==="$")){const $=m===null?[]:Object.keys(m).map(S=>m instanceof Array?parseInt(S):S);w!==null&&Object.keys(w).forEach(S=>{const T=w instanceof Array?parseInt(S):S;!$.includes(T)&&$.push(S)}),$.forEach(S=>{const T=gi(S,m,w),R=E.concat({name:x,value:S});k.length===0?D(O,T.oldValue,T.newValue,R):p(G.getChildPath(v,x),T.oldValue,T.newValue,R)});return}else{v=G.getChildPath(v,x);const $=gi(x,m,w);m=$.oldValue,w=$.newValue}}D(O,m,w,E)};if(O.type.startsWith("notify_")&&G.get(O.eventPath).isAncestorOf(h)){const v=G.get(O.eventPath).isParentOf(h);(O.type==="notify_value"||O.type==="notify_child_changed"&&(!v||!["added","removed"].includes(H))||O.type==="notify_child_removed"&&H==="removed"&&v||O.type==="notify_child_added"&&H==="added"&&v)&&this.subscriptions.trigger(O.type,O.subscriptionPath,O.dataPath,null,null,o.context)}else p(h,l,L)}),y.filter(O=>["mutated","mutations","notify_mutated","notify_mutations"].includes(O.type)).forEach(O=>{let p=h;const v=O.eventPath.slice(p.length).replace(/^\//,""),m=G.getPathKeys(v);let w=l,E=L;for(;m.length>0;){const x=m.shift();p=G.getChildPath(p,x);const $=gi(x,w,E);w=$.oldValue,E=$.newValue}const b=M(p,w,E);if(b.length===0)return;const k=O.type.startsWith("notify_");if(["mutated","notify_mutated"].includes(O.type))b.forEach((x,$)=>{const S=o.context,T=k?null:x.oldValue,R=k?null:x.newValue;this.subscriptions.trigger(O.type,O.subscriptionPath,x.path,T,R,S)});else if(["mutations","notify_mutations"].includes(O.type)){const x=k?null:b.map($=>({target:G.getPathKeys($.path.slice(O.subscriptionPath.length)),prev:$.oldValue,val:$.newValue}));this.subscriptions.trigger(O.type,O.subscriptionPath,O.subscriptionPath,null,x,o.context)}})};return o.waitForIndexUpdates===!1&&I.splice(0),yield Promise.all(I),xB(U),C})}getChildren(e,t){throw new Error("This method must be implemented by subclass")}getNodeValue(e){return W(this,arguments,function*(t,r={}){return(yield this.getNode(t,r)).value})}getNode(e,t){throw new Error("This method must be implemented by subclass")}getNodeInfo(e,t){throw new Error("This method must be implemented by subclass")}setNode(e,t,r){throw new Error("This method must be implemented by subclass")}updateNode(e,t,r){throw new Error("This method must be implemented by subclass")}transactNode(e,t){return W(this,arguments,function*(r,i,o={no_lock:!1,suppress_events:!1,context:null}){const s=o&&o.no_lock===!0,a=this.createTid(),c=s?{tid:a,release:EB}:yield this.nodeLocker.lock(r,a,!0,"transactNode");try{let l=!1;const u=()=>{l=!0};s&&this.subscriptions.add(r,"notify_value",u);const h=yield this.getNode(r,{tid:a}),y=h.revision;let d;try{d=i(h.value),d instanceof Promise&&(d=yield d.catch(f=>{this.debug.error(`Error in transaction callback: ${f.message}`)}))}catch(f){this.debug.error(`Error in transaction callback: ${f.message}`)}if(typeof d=="undefined")return;if(s&&this.subscriptions.remove(r,"notify_value",u),l)throw new $h("Node changed");return yield this.setNode(r,d,{assert_revision:y,tid:c.tid,suppress_events:o.suppress_events,context:o.context})}catch(l){if(l instanceof $h)return console.warn(`node value changed, running again. Error: ${l.message}`),this.transactNode(r,i,o);throw l}finally{c.release()}})}matchNode(e,t,r){return W(this,null,function*(){var i;const o=(i=r==null?void 0:r.tid)!=null?i:Kt.generate(),s=(c,l)=>W(this,null,function*(){if(l.length===0)return Promise.resolve(!0);const u=l.reduce((f,g)=>{let _=g.key;return typeof _=="string"&&_.includes("/")&&(_=_.slice(0,_.indexOf("/"))),f.indexOf(_)<0&&f.push(_),f},[]),h=u.slice();let y=!0;const d=[];try{return yield this.getChildren(c,{tid:o,keyFilter:u}).next(f=>{var g;const _=(g=f.key)!=null?g:f.index;h.includes(_)&&h.splice(h.indexOf(f.key),1);const A=l.filter(B=>B.key===_).map(B=>({op:B.op,compare:B.compare})),P=A.length>0?a(f,A):{isMatch:!0,promises:[]};if(y=P.isMatch,y){d.push(...P.promises);const B=l.filter(C=>typeof C.key=="string"&&C.key.startsWith(`${typeof _=="number"?`[${_}]`:_}/`)).map(C=>({key:C.key.slice(C.key.indexOf("/")+1),op:C.op,compare:C.compare}));if(B.length>0){const C=G.getChildPath(c,f.key),L=s(C,B).then(q=>({isMatch:q}));d.push(L)}}if(!y||h.length===0)return!1}),y&&(y=(yield Promise.all(d)).every(f=>f.isMatch)),y?(y=h.every(f=>{const g=new Rw(et(ie(ie({},typeof f=="number"&&{index:f}),typeof f=="string"&&{key:f}),{exists:!1})),_=l.filter(P=>typeof P.key=="string"&&P.key.startsWith(`${typeof f=="number"?`[${f}]`:f}/`)).map(P=>({op:P.op,compare:P.compare}));if(_.length>0&&!a(g,_).isMatch)return!1;const A=l.filter(P=>P.key===f).map(P=>({op:P.op,compare:P.compare}));return A.length===0?!0:a(g,A).isMatch}),y):!1}catch(f){throw this.debug.error(`Error matching on "${c}": `,f),f}}),a=(c,l)=>{const u=[];return{isMatch:l.every(h=>{let y=!0;if(h.op==="!exists"||h.op==="=="&&(typeof h.compare=="undefined"||h.compare===null))y=!c.exists;else if(h.op==="exists"||h.op==="!="&&(typeof h.compare=="undefined"||h.compare===null))y=c.exists;else if((h.op==="contains"||h.op==="!contains")&&h.compare instanceof Array&&h.compare.length===0)y=!0;else if(!c.exists)y=!1;else if(c.address)if(c.valueType===le.OBJECT&&["has","!has"].indexOf(h.op)>=0){const d=h.op==="has"?"exists":"!exists",f=s(c.path,[{key:h.compare,op:d}]).then(g=>({key:c.key,isMatch:g}));u.push(f),y=!0}else if(c.valueType===le.ARRAY&&["contains","!contains"].indexOf(h.op)>=0){const d=this.getNode(c.path,{tid:o}).then(({value:f})=>{const g=h.op==="contains"?h.compare instanceof Array?h.compare.every(_=>f.includes(_)):f.includes(h.compare):h.compare instanceof Array?!h.compare.some(_=>f.includes(_)):!f.includes(h.compare);return{key:c.key,isMatch:g}});u.push(d),y=!0}else if(c.valueType===le.STRING){const d=this.getNode(c.path,{tid:o}).then(f=>({key:c.key,isMatch:this.test(f.value,h.op,h.compare)}));u.push(d),y=!0}else y=!1;else if(c.type===le.OBJECT&&["has","!has"].indexOf(h.op)>=0){const d=h.compare in c.value;y=d&&h.op==="has"||!d&&h.op==="!has"}else if(c.type===le.ARRAY&&["contains","!contains"].indexOf(h.op)>=0){const d=c.value.indexOf(h.compare)>=0;y=d&&h.op==="contains"||!d&&h.op==="!contains"}else{let d=this.test(c.value,h.op,h.compare);d instanceof Promise&&(u.push(d),d=!0),y=d}return y}),promises:u}};return s(e,t)})}test(e,t,r){if(t==="<")return e<r;if(t==="<=")return e<=r;if(t==="==")return e===r;if(t==="!=")return e!==r;if(t===">")return e>r;if(t===">=")return e>=r;if(t==="in")return r.indexOf(e)>=0;if(t==="!in")return r.indexOf(e)<0;if(t==="like"||t==="!like"){const i="^"+r.replace(/[-[\]{}()+.,\\^$|#\s]/g,"\\$&").replace(/\?/g,".").replace(/\*/g,".*?")+"$",o=new RegExp(i,"i").test(e.toString());return t==="like"?o:!o}if(t==="matches")return r.test(e.toString());if(t==="!matches")return!r.test(e.toString());if(t==="between")return e>=r[0]&&e<=r[1];if(t==="!between")return e<r[0]||e>r[1];if(t==="has"||t==="!has"){const i=typeof e=="object"&&r in e;return t==="has"?i:!i}if(t==="contains"||t==="!contains"){const i=typeof e=="object"&&e instanceof Array&&e.includes(r);return t==="contains"?i:!i}return!1}exportNode(e,t){return W(this,arguments,function*(r,i,o={format:"json",type_safe:!0}){if((o==null?void 0:o.format)!=="json")throw new Error("Only json output is currently supported");const s=typeof i!="function"?i.write.bind(i):i,a=(f,g)=>{const _=A=>A.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/[\u0000-\u001f]/g,P=>`\\u${P.charCodeAt(0).toString(16).padStart(4,"0")}`);return f===le.DATETIME?(g=`"${g.toISOString()}"`,o.type_safe&&(g=`{".type":"date",".val":${g}}`)):f===le.STRING?g=`"${_(g)}"`:f===le.ARRAY?g="[]":f===le.OBJECT?g="{}":f===le.BINARY?(g=`"${_(kr.encode(g))}"`,o.type_safe&&(g=`{".type":"binary",".val":${g}}`)):f===le.REFERENCE?(g=`"${g.path}"`,o.type_safe&&(g=`{".type":"reference",".val":${g}}`)):f===le.BIGINT&&(g=`"${g}"`,o.type_safe&&(g=`{".type":"bigint",".val":${g}}`)),g};let c="",l="";const u=yield this.getNodeInfo(r);if(u.exists)if(u.type===le.OBJECT)c="{",l="}";else if(u.type===le.ARRAY)c="[",l="]";else{const f=yield this.getNode(r),g=a(u.type,f.value);return s(g)}else return s("null");if(c){const f=s(c);f instanceof Promise&&(yield f)}let h="",y=0;const d=[];if(yield this.getChildren(r).next(f=>{f.address?d.push(f):(y++>0&&(h+=","),typeof f.key=="string"&&(h+=`"${f.key}":`),h+=a(f.type,f.value))}),h){const f=s(h);f instanceof Promise&&(yield f)}for(;d.length>0;){const f=d.shift();let g=y++>0?",":"";const _=typeof f.index=="number"?f.index:f.key;if(typeof _=="string"&&(g+=`"${_}":`),g){const A=s(g);A instanceof Promise&&(yield A)}yield this.exportNode(G.getChildPath(r,_),s,o)}if(l){const f=s(l);f instanceof Promise&&(yield f)}})}importNode(e,t){return W(this,arguments,function*(r,i,o={format:"json",method:"set"}){const s={data:"",index:0,offset:0,queue:[],queueStartByte:0,timesFlushed:0,get processedBytes(){return this.offset+this.index}},a=(j=!1)=>W(this,null,function*(){let I=yield i(262144);if(I===null)throw s.data?new Error(`Unexpected EOF at index ${s.offset+s.data.length}`):new Error("Unable to read data from stream");typeof I=="object"&&(I=mw(I)),j?s.data+=I:(s.offset+=s.data.length,s.data=I,s.index=0)}),c=j=>W(this,null,function*(){let I="";return s.index+j>=s.data.length&&(I=s.data.slice(s.index),j-=I.length,yield a()),I+=s.data.slice(s.index,s.index+j),s.index+=j,I}),l=j=>W(this,null,function*(){if(s.index+j>s.data.length&&(yield a(!0)),s.index+j>s.data.length)throw new Error("Not enough data available from stream")}),u=j=>W(this,null,function*(){const I=yield c(j.length);if(I!==j)throw new Error(`Unexpected character "${I[0]}" at index ${s.offset+s.index}, expected "${j}"`)}),h=()=>W(this,null,function*(){const j=[" ","	","\r",`
`];for(;s.index>=s.data.length&&(yield a()),j.includes(s.data[s.index]);)s.index++}),y=j=>W(this,null,function*(){yield l(j);const I=s.index;return s.data.slice(I,I+j)}),d=()=>W(this,null,function*(){yield h();const j=yield y(1);switch(j){case'"':return"string";case"{":return"object";case"[":return"array";case"n":return"null";case"u":return"undefined";case"t":case"f":return"boolean";default:{if(j==="-"||j>="0"&&j<="9")return"number";throw new Error(`Unknown value at index ${s.offset+s.index}`)}}}),f=()=>W(this,null,function*(){yield u('"');let j="",I=s.index;for(;s.data[I]!=='"'||s.data[I-1]==="\\";)I++,I>=s.data.length&&(j+=s.data.slice(s.index),yield a(),I=0);return j+=s.data.slice(s.index,I),s.index=I+1,P(j)}),g=()=>W(this,null,function*(){throw s.data[s.index]==="t"?yield u("true"):s.data[s.index]==="f"&&(yield u("false")),new Error(`Expected true or false at index ${s.offset+s.index}`)}),_=()=>W(this,null,function*(){let j="",I=s.index;const D=["-","0","1","2","3","4","5","6","7","8","9",".","e","b","f","x","o","n"];for(;D.includes(s.data[I]);)I++,I>=s.data.length&&(j+=s.data.slice(s.index),yield a(),I=0);return j+=s.data.slice(s.index,I),s.index=I,j.endsWith("n")?BigInt(j.slice(0,-1)):j.includes(".")?parseFloat(j):parseInt(j)}),A=()=>W(this,null,function*(){yield h();const j=yield d(),I=yield(()=>{switch(j){case"string":return f();case"object":return{};case"array":return[];case"number":return _();case"null":return null;case"undefined":return;case"boolean":return g()}})();return{type:j,value:I}}),P=j=>j.replace(/\\n/g,`
`).replace(/\\"/g,'"'),B=(j,I)=>{const D=I[".type"];let M=I[".val"];switch(D){case"Date":case"date":{M=new Date(M);break}case"Buffer":case"binary":{if(M=P(M),M.startsWith("<~"))M=kr.decode(M);else throw new Error(`Import error: Unexpected encoding for value for value at path "/${j}"`);break}case"PathReference":case"reference":{M=new at(M);break}case"bigint":{M=BigInt(M);break}default:throw new Error(`Import error: Unsupported type "${D}" for value at path "/${j}"`)}return M},C={acebase_import_id:Kt.generate()},L={suppress_events:o.suppress_events,context:C},q=j=>W(this,null,function*(){if(yield u("{"),yield h(),(yield y(1))==="}")return s.index++,this.setNode(j.path,{},L);let I=0,D={},M=!1;const U=()=>W(this,null,function*(){let p;M?Object.keys(D).length>0&&(p=this.updateNode(j.path,D,L)):(M=!0,p=this.setNode(j.path,D,L)),D={},p&&(yield p)}),O=[];for(;;){yield h();const p=yield f();yield h(),yield u(":"),yield h();const{value:v,type:m}=yield A();if(D[p]=v,I++,["object","array"].includes(m)&&(O.push(U()),m==="object"?yield q(j.child(p)):yield H(j.child(p))),yield h(),(yield y(1))==="}"){s.index++;break}yield u(",")}if(I===2&&".type"in D&&".val"in D){const p=B(j.path,D);return this.setNode(j.path,p,L)}O.push(U()),yield Promise.all(O)}),H=j=>W(this,null,function*(){if(yield u("["),yield h(),(yield y(1))==="]")return s.index++,this.setNode(j.path,[],L);let I=!1,D=[],M={};const U=()=>W(this,null,function*(){let m;I?Object.keys(M).length>0&&(m=this.updateNode(j.path,M,L),M={}):(I=!0,m=this.setNode(j.path,D,L),D=null),m&&(yield m)}),O=(m,w)=>{I?M[w]=m:D.push(m)},p=[];let v=0;for(;;){yield h();const{value:m,type:w}=yield A();if(O(m,v),["object","array"].includes(w)&&(p.push(U()),w==="object"?yield q(j.child(v)):yield H(j.child(v))),yield h(),(yield y(1))==="]"){s.index++;break}yield u(","),v++}p.push(U()),yield Promise.all(p)});return(()=>W(this,null,function*(){const{value:j,type:I}=yield A();if(["object","array"].includes(I)){const D=G.get(r);I==="object"?yield q(D):yield H(D)}else yield this.setNode(r,j,L)}))()})}setSchema(e,t,r=!1){if(typeof t=="undefined")throw new TypeError("schema argument must be given");if(t===null){const s=this._schemas.findIndex(a=>a.path===e);s>=0&&this._schemas.splice(s,1);return}const i=new lB(t,{warnOnly:r,warnCallback:s=>this.debug.warn(s)}),o=this._schemas.find(s=>s.path===e);o?o.schema=i:(this._schemas.push({path:e,schema:i}),this._schemas.sort((s,a)=>{const c=G.getPathKeys(s.path),l=G.getPathKeys(a.path);return c.length===l.length?0:c.length<l.length?-1:1}))}getSchema(e){const t=this._schemas.find(r=>r.path===e);return t?{path:e,schema:t.schema.source,text:t.schema.text}:null}getSchemas(){return this._schemas.map(e=>({path:e.path,schema:e.schema.source,text:e.schema.text}))}validateSchema(e,t,r={updates:!1}){let i={ok:!0};const o=G.get(e);return this._schemas.filter(s=>o.isOnTrailOf(s.path)).every(s=>{if(o.isDescendantOf(s.path)){const u=G.fillVariables(s.path,e),h=o.keys.slice(G.getPathKeys(s.path).length);return i=s.schema.check(u,t,r.updates,h),i.ok}const a=G.getPathKeys(s.path).slice(o.keys.length);if(r.updates===!0&&a.length>0&&!(a[0]in t))return i.ok;const c=r.updates===!0&&a.length===0,l=(u,h,y)=>{if(y.length===0)return s.schema.check(u,h,c);if(h===null)return{ok:!0};const d=y[0];if(typeof d=="string"&&(d==="*"||d[0]==="$")){if(h===null||typeof h!="object")return{ok:!0};let f;return Object.keys(h).every(g=>{const _=G.getChildPath(u,g),A=h[g];return f=l(_,A,y.slice(1)),f.ok}),f}else{const f=G.getChildPath(u,d),g=h[d];return l(f,g,y.slice(1))}};return i=l(e,t,a),i.ok}),i}}class ds{static ChildPathsSql(e,t="path"){return e===""?`${t} <> '' AND ${t} NOT LIKE '%/%'`:`(${t} LIKE '${e}/%' OR ${t} LIKE '${e}[%') AND ${t} NOT LIKE '${e}/%/%' AND ${t} NOT LIKE '${e}[%]/%' AND ${t} NOT LIKE '${e}[%][%'`}static ChildPathsRegex(e){return new RegExp(`^${e}(?:/[^/[]+|\\[[0-9]+\\])$`)}static DescendantPathsSql(e,t="path"){return e===""?`${t} <> ''`:`${t} LIKE '${e}/%' OR ${t} LIKE '${e}[%'`}static DescendantPathsRegex(e){return new RegExp(`^${e}(?:/[^/[]+|\\[[0-9]+\\])`)}static get PathInfo(){return G}}class ig{constructor(e){this.path=e}toString(){return`"/${this.path}"`}equals(e){return this.path===e.path}}const{compareValues:OB}=kw;class vf{constructor(e){this.production=!1,this.target={get originalPath(){return e.path},path:e.path,get write(){return e.write}},this.id=Kt.generate()}getChildCount(e){return W(this,null,function*(){let t=0;return yield this.childrenOf(e,{metadata:!1,value:!1},()=>(t++,!1)),t})}getMultiple(e){return W(this,null,function*(){const t=new Map;return yield Promise.all(e.map(r=>this.get(r).then(i=>t.set(r,i)))),t})}setMultiple(e){return W(this,null,function*(){yield Promise.all(e.map(({path:t,node:r})=>this.set(t,r)))})}removeMultiple(e){return W(this,null,function*(){yield Promise.all(e.map(t=>this.remove(t)))})}commit(){return W(this,null,function*(){throw new Error("CustomStorageTransaction.rollback must be overridden by subclass")})}moveToParentPath(e){return W(this,null,function*(){const t=this._lock&&this._lock.path||this.target.path;if(t===e)return e;if(ds.PathInfo.get(e).isParentOf(t))this._lock&&(this._lock=yield this._lock.moveToParent());else throw new Error(`Locking issue. Locked path "${this._lock.path}" is not a child/descendant of "${e}"`);return this.target.path=e,e})}}class fs extends mf{constructor(e){if(super(e),this.locking=!0,typeof e!="object")throw new Error("settings missing");if(typeof e.ready!="function")throw new Error("ready must be a function");if(typeof e.getTransaction!="function")throw new Error("getTransaction must be a function");this.name=e.name,this.locking=e.locking!==!1,this.locking&&(this.lockTimeout=typeof e.lockTimeout=="number"?e.lockTimeout:120),this.ready=e.ready;const t=this.locking,r=t?new Iw(console,this.lockTimeout):null;this.getTransaction=i=>W(this,[i],function*({path:o,write:s}){const a=yield e.getTransaction({path:o,write:s});en(typeof a.id=="string","transaction id not set");const c=a.rollback,l=a.commit;return a.commit=()=>W(this,null,function*(){const u=yield l.call(a);return t&&(yield a._lock.release("commit")),u}),a.rollback=u=>W(this,null,function*(){const h=yield c.call(a,u);return t&&(yield a._lock.release("rollback")),h}),t&&(a._lock=yield r.lock(o,a.id,s,`${this.name}::getTransaction`)),a})}}class iu extends Rw{constructor(e){super(e),this.revision=e.revision,this.revision_nr=e.revision_nr,this.created=e.created,this.modified=e.modified}}class AB extends $B{constructor(e,t,r){super(e,t,r),this._customImplementation=t,this._init()}_init(){return W(this,null,function*(){this.debug.log(`Database "${this.name}" details:`.colorize(Tt.dim)),this.debug.log("- Type: CustomStorage".colorize(Tt.dim)),this.debug.log(`- Path: ${this.settings.path}`.colorize(Tt.dim)),this.debug.log(`- Max inline value size: ${this.settings.maxInlineValueSize}`.colorize(Tt.dim)),this.debug.log(`- Autoremove undefined props: ${this.settings.removeVoidProperties}`.colorize(Tt.dim)),yield this._customImplementation.ready();const e=yield this._customImplementation.getTransaction({path:"",write:!0});(yield this.getNodeInfo("",{transaction:e})).exists||(yield this._writeNode("",{},{transaction:e})),yield e.commit(),this.indexes.supported&&(yield this.indexes.load()),this.emit("ready")})}throwImplementationError(e){throw new Error(`CustomStorage "${this._customImplementation.name}" ${e}`)}_storeNode(e,t,r){const i=s=>{if(s===null)throw new Error("Not allowed to store null values. remove the property");if(["string","number","boolean"].includes(typeof s))return s;if(s instanceof Date)return{type:le.DATETIME,value:s.getTime()};if(s instanceof at)return{type:le.REFERENCE,value:s.path};if(s instanceof ArrayBuffer)return{type:le.BINARY,value:kr.encode(s)};if(typeof s=="object")return en(Object.keys(s).length===0,"child object stored in parent can only be empty"),s},o="Caller should have pre-processed the value by converting it to a string";if(t.type===le.ARRAY&&t.value instanceof Array){console.warn(`Unprocessed array. ${o}`);const s={};for(let a=0;a<t.value.length;a++)s[a]=t.value[a];t.value=s}if(t.type===le.BINARY&&typeof t.value!="string"&&(console.warn(`Unprocessed binary value. ${o}`),t.value=kr.encode(t.value)),t.type===le.REFERENCE&&t.value instanceof at&&(console.warn(`Unprocessed path reference. ${o}`),t.value=t.value.path),[le.OBJECT,le.ARRAY].includes(t.type)){const s=t.value;t.value={},Object.keys(s).forEach(a=>{t.value[a]=i(s[a])})}return r.transaction.set(e,t)}_processReadNodeValue(e){const t=r=>{if(r.type===le.BINARY)return kr.decode(r.value);if(r.type===le.DATETIME)return new Date(r.value);if(r.type===le.REFERENCE)return new at(r.value);throw new Error(`Unhandled child value type ${r.type}`)};switch(e.type){case le.ARRAY:case le.OBJECT:{const r=e.value;Object.keys(r).forEach(i=>{const o=r[i];typeof o=="object"&&"type"in o&&(r[i]=t(o))}),e.value=r;break}case le.BINARY:{e.value=kr.decode(e.value);break}case le.REFERENCE:{e.value=new at(e.value);break}case le.STRING:break;default:throw new Error("Invalid standalone record value type")}}_readNode(e,t){return W(this,null,function*(){const r=yield t.transaction.get(e);return r===null?null:(typeof r!="object"&&this.throwImplementationError("transaction.get must return an ICustomStorageNode object. Use JSON.parse if your set function stored it as a string"),this._processReadNodeValue(r),r)})}_getTypeFromStoredValue(e){let t;if(typeof e=="string")t=le.STRING;else if(typeof e=="number")t=le.NUMBER;else if(typeof e=="boolean")t=le.BOOLEAN;else if(e instanceof Array)t=le.ARRAY;else if(typeof e=="object")if("type"in e){const r=e;t=r.type,e=r.value,t===le.DATETIME?e=new Date(e):t===le.REFERENCE&&(e=new at(e))}else t=le.OBJECT;else throw new Error("Unknown value type");return{type:t,value:e}}_writeNode(e,t,r){return W(this,null,function*(){if(!r.merge&&this.valueFitsInline(t)&&e!=="")throw new Error("invalid value to store in its own node");if(e===""&&(typeof t!="object"||t instanceof Array))throw new Error("Invalid root node value. Must be an object");if(typeof r.diff=="undefined"&&typeof r.currentValue!="undefined"){const f=OB(r.currentValue,t);r.merge&&typeof f=="object"&&(f.removed=f.removed.filter(g=>t[g]===null)),r.diff=f}if(r.diff==="identical")return;const i=r.transaction,o=r.currentValue===null?null:yield this._readNode(e,{transaction:i});if(r.merge&&o){if(o.type===le.ARRAY&&!(t instanceof Array)&&typeof t=="object"&&Object.keys(t).some(f=>isNaN(parseInt(f))))throw new Error(`Cannot merge existing array of path "${e}" with an object`);if(t instanceof Array&&o.type!==le.ARRAY)throw new Error(`Cannot merge existing object of path "${e}" with an array`)}const s=r.revision||Kt.generate(),a={type:o&&o.type===le.ARRAY?le.ARRAY:le.OBJECT,value:{}},c={};if(t instanceof Array){a.type=le.ARRAY;const f={};for(let g=0;g<t.length;g++)f[g]=t[g];t=f}else t instanceof at?(a.type=le.REFERENCE,a.value=t.path):t instanceof ArrayBuffer?(a.type=le.BINARY,a.value=kr.encode(t)):typeof t=="string"&&(a.type=le.STRING,a.value=t);const l=o?[le.OBJECT,le.ARRAY].includes(o.type):!1,u=[le.OBJECT,le.ARRAY].includes(a.type),h={current:[],new:[]};let y=null;l&&(y=o.value,h.current=Object.keys(y),u&&(a.value=y)),u&&(r.merge||Object.keys(a.value).forEach(f=>{f in t||(t[f]=null)}),Object.keys(t).forEach(f=>{const g=t[f];if(delete a.value[f],g!==null){if(typeof g=="undefined")if(this.settings.removeVoidProperties===!0){delete t[f];return}else throw new Error(`Property "${f}" has invalid value. Cannot store undefined values. Set removeVoidProperties option to true to automatically remove undefined properties`);this.valueFitsInline(g)?a.value[f]=g:c[f]=g}}));const d=a.type===le.ARRAY;if(o){if(this.debug.log(`Node "/${e}" is being ${r.merge?"updated":"overwritten"}`.colorize(Tt.cyan)),l||u){const g=G.get(e),_=[];let A=!1;const P=I=>(A=!0,!i.production&&!g.isParentOf(I)&&this.throwImplementationError(`"${I}" is not a child of "${e}" - childrenOf must only check and return paths that are children`),!0),B=I=>{A||this.throwImplementationError("childrenOf did not call checkCallback before addCallback");const D=G.get(I).key;return _.push(D.toString()),!0};yield i.childrenOf(e,{metadata:!1,value:!1},P,B),h.current=h.current.concat(_),u&&(r&&r.merge&&(h.new=h.current.slice()),Object.keys(t).forEach(I=>{h.new.includes(I)||h.new.push(I)}));const C={insert:h.new.filter(I=>!h.current.includes(I)),update:[],delete:r&&r.merge?Object.keys(t).filter(I=>t[I]===null):h.current.filter(I=>!h.new.includes(I))};if(C.update=h.new.filter(I=>h.current.includes(I)&&!C.delete.includes(I)),d&&r.merge&&(C.insert.length>0||C.delete.length>0)&&!C.update.concat(C.insert).every((I,D,M)=>M.includes(D.toString())))throw new Error(`Elements cannot be inserted beyond, or removed before the end of an array. Rewrite the whole array at path "${e}" or change your schema to use an object collection instead`);const L=Object.keys(c).map(I=>{const D=d?parseInt(I):I,M=typeof r.diff=="object"?r.diff.forChild(D):void 0;if(M==="identical")return;const U=g.childPath(D),O=c[D],p=typeof r.currentValue=="undefined"?void 0:r.currentValue!==null&&typeof r.currentValue=="object"&&D in r.currentValue?r.currentValue[D]:null;return this._writeNode(U,O,{transaction:i,revision:s,merge:!1,currentValue:p,diff:M})}),q=u?_.filter(I=>I in a.value):[],H=C.delete.concat(q).map(I=>{const D=d?parseInt(I):I,M=g.childPath(D);return this._deleteNode(M,{transaction:i})}),j=L.concat(H);yield Promise.all(j)}const f=this._storeNode(e,{type:a.type,value:a.value,revision:o.revision,revision_nr:o.revision_nr+1,created:o.created,modified:Date.now()},{transaction:i});if(f instanceof Promise)return yield f}else{if(this.debug.log(`Node "/${e}" is being created`.colorize(Tt.cyan)),d&&!Object.keys(a.value).concat(Object.keys(c)).every((_,A,P)=>P.includes(A.toString())))throw new Error("Cannot store arrays with missing entries");const f=Object.keys(c).map(_=>{const A=d?parseInt(_):_,P=G.getChildPath(e,A),B=c[A];return this._writeNode(P,B,{transaction:i,revision:s,merge:!1,currentValue:null})}),g=this._storeNode(e,{type:a.type,value:a.value,revision:s,revision_nr:1,created:Date.now(),modified:Date.now()},{transaction:i});g instanceof Promise&&f.push(g),yield Promise.all(f)}})}_deleteNode(e,t){return W(this,null,function*(){const r=G.get(e);this.debug.log(`Node "/${e}" is being deleted`.colorize(Tt.cyan));const i=[e];let o=!1;const s=l=>(o=!0,!c.production&&!r.isAncestorOf(l)&&this.throwImplementationError(`"${l}" is not a descendant of "${e}" - descendantsOf must only check and return paths that are descendants`),!0),a=l=>(o||this.throwImplementationError("descendantsOf did not call checkCallback before addCallback"),i.push(l),!0),c=t.transaction;return yield c.descendantsOf(e,{metadata:!1,value:!1},s,a),this.debug.log(`Nodes ${i.map(l=>`"/${l}"`).join(",")} are being deleted`.colorize(Tt.cyan)),c.removeMultiple(i)})}getChildren(e,t={}){let r;const i={next(s){return r=s,o()}},o=()=>W(this,null,function*(){const s=t.transaction||(yield this._customImplementation.getTransaction({path:e,write:!1}));try{let a=!1;return yield(()=>W(this,null,function*(){const c=yield this._readNode(e,{transaction:s});if(!c)throw new yf(`Node "/${e}" does not exist`);if(![le.OBJECT,le.ARRAY].includes(c.type))return;const l=c.type===le.ARRAY,u=c.value;let h=Object.keys(u).map(_=>l?parseInt(_):_);t.keyFilter&&(h=h.filter(_=>t.keyFilter.includes(_)));const y=G.get(e);if(h.length>0&&h.every(_=>{const A=this._getTypeFromStoredValue(u[_]),P=new iu({path:y.childPath(_),key:l?null:_,index:l?_:null,type:A.type,address:null,exists:!0,value:A.value,revision:c.revision,revision_nr:c.revision_nr,created:new Date(c.created),modified:new Date(c.modified)});return a=r(P)===!1,!a}),a)return;let d=!1;const f=_=>{if(d=!0,!s.production&&!y.isParentOf(_)&&this.throwImplementationError(`"${_}" is not a child of "${e}" - childrenOf must only check and return paths that are children`),t.keyFilter){const A=G.get(_).key;return t.keyFilter.includes(A)}return!0},g=(_,A)=>{d||this.throwImplementationError("childrenOf did not call checkCallback before addCallback");const P=G.get(_).key,B=new iu({path:_,type:A.type,key:l?null:P,index:l?P:null,address:new ig(_),exists:!0,value:null,revision:A.revision,revision_nr:A.revision_nr,created:new Date(A.created),modified:new Date(A.modified)});return a=r(B)===!1,!a};yield s.childrenOf(e,{metadata:!0,value:!1},f,g)}))(),t.transaction||(yield s.commit()),a}catch(a){throw t.transaction||(yield s.rollback(a)),a}});return i}getNode(e,t){return W(this,null,function*(){t=t||{};const r=t.transaction||(yield this._customImplementation.getTransaction({path:e,write:!1}));try{const i=yield(()=>W(this,null,function*(){const o=t.include&&t.include.length>0||t.exclude&&t.exclude.length>0||t.child_objects===!1,s=G.get(e),a=yield this._readNode(e,{transaction:r});if(!a){if(e==="")return{value:null};const B=yield r.moveToParentPath(s.parentPath);en(B===s.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${e}"`);const C=yield this._readNode(s.parentPath,{transaction:r});if(C&&[le.OBJECT,le.ARRAY].includes(C.type)&&s.key in C.value){const L=this._getTypeFromStoredValue(C.value[s.key]);return{revision:C.revision,revision_nr:C.revision_nr,created:C.created,modified:C.modified,type:L.type,value:L.value}}return{value:null}}const c=a.type===le.ARRAY,l=B=>{const C=L=>/^[0-9]+$/.test(L);return B.map(L=>G.get(c&&C(L)?`[${L}]`:L))},u=t.include?l(t.include):[],h=t.exclude?l(t.exclude):[],y=(B,C)=>{if([le.OBJECT,le.ARRAY].includes(C.type)&&u.length>0){const L=G.getPathKeys(B).slice(s.keys.length),q=new G(L),H=[],j=u.filter(D=>D.isDescendantOf(q));if(j.length>0){const D=C.type===le.ARRAY;H.push(...Object.keys(C.value).map(M=>D?+M:M));for(const M of j){const U=M.keys[L.length];if(typeof U=="string"&&(U==="*"||U.startsWith("$"))){H.splice(0);break}const O=H.indexOf(U);O>=0&&H.splice(O,1)}}const I=u.some(D=>D.isChildOf(q));if(h.some(D=>D.isChildOf(q))&&!I){const D=h.filter(M=>M.isChildOf(q));for(let M=0;M<H.length;M++)D.find(U=>U.equals(H[M]))||(H.splice(M,1),M--)}for(const D of H)delete C.value[D]}};y(e,a);let d=!1;const f=(B,C)=>{if(d=!0,!r.production&&!s.isAncestorOf(B)&&this.throwImplementationError(`"${B}" is not a descendant of "${e}" - descendantsOf must only check and return paths that are descendants`),!o)return!0;const L=G.getPathKeys(B).slice(s.keys.length),q=new G(L);let H=(u.length>0?u.some(j=>q.isOnTrailOf(j)):!0)&&(h.length>0?!h.some(j=>j.equals(q)||j.isAncestorOf(q)):!0);return H&&t.child_objects===!1&&(s.isParentOf(B)&&[le.OBJECT,le.ARRAY].includes(C?C.type:-1)||G.getPathKeys(B).length>s.pathKeys.length+1)&&(H=!1),H},g=[],_=(B,C)=>{if(d||this.throwImplementationError("descendantsOf did not call checkCallback before addCallback"),t.child_objects===!1&&[le.OBJECT,le.ARRAY].includes(C.type))return!0;y(B,C),this._processReadNodeValue(C);const L=C;return L.path=B,g.push(L),!0};yield r.descendantsOf(e,{metadata:!0,value:!0},f,_),this.debug.log(`Read node "/${e}" and ${o?"(filtered) ":""}descendants from ${g.length+1} records`.colorize(Tt.magenta));const A=a,P=B=>{const C=[];return Object.keys(B).forEach(L=>{const q=parseInt(L);C[q]=B[q]}),C};if(a.type===le.ARRAY&&(A.value=P(A.value)),a.type===le.OBJECT||a.type===le.ARRAY){const B=G.getPathKeys(e),C=a.value;for(let L=0;L<g.length;L++){const q=g[L],H=G.getPathKeys(q.path).slice(B.length);let j=C;for(let I=0;I<H.length;I++){en(typeof j=="object","parent must be an object/array to have children!!");const D=H[I],M=I===H.length-1,U=M?q.type:typeof H[I+1]=="number"?le.ARRAY:le.OBJECT;let O;M?(O=q.value,U===le.ARRAY&&(O=P(O))):O=U===le.OBJECT?{}:[],D in j?typeof j[D]==typeof O&&[le.OBJECT,le.ARRAY].includes(U)?Object.keys(O).forEach(p=>{p in j[D]&&this.throwImplementationError(`Custom storage merge error: child key "${p}" is in parent value already! Make sure the get/childrenOf/descendantsOf methods of the custom storage class return values that can be modified by AceBase without affecting the stored source`),j[D][p]=O[p]}):this.debug.error(`The value stored in node "${q.path}" cannot be merged with the parent node, value will be ignored. This error should disappear once the target node value is updated. See issue #20 for more information`,{path:e,parent:j,key:D,nodeType:U,nodeValue:O}):j[D]=O,j=j[D]}}}else g.length>0&&this.throwImplementationError("multiple records found for non-object value!");if(t.child_objects===!1&&Object.keys(A.value).forEach(B=>{typeof A.value[B]=="object"&&A.value[B].constructor===Object&&(en(Object.keys(A.value[B]).length===0),delete A.value[B])}),t.include,t.exclude){const B=(C,L)=>{if(typeof C!="object")return;const q=L[0];q==="*"?Object.keys(C).forEach(H=>{B(C[H],L.slice(1))}):L.length>1?q in C&&B(C[q],L.slice(1)):delete C[q]};t.exclude.forEach(C=>{const L=G.getPathKeys(C);B(A.value,L)})}return A}))();return t.transaction||(yield r.commit()),i}catch(i){throw t.transaction||(yield r.rollback(i)),i}})}getNodeInfo(e){return W(this,arguments,function*(t,r={}){r=r||{};const i=G.get(t),o=r.transaction||(yield this._customImplementation.getTransaction({path:t,write:!1}));try{const s=yield this._readNode(t,{transaction:o}),a=new iu({path:t,key:typeof i.key=="string"?i.key:null,index:typeof i.key=="number"?i.key:null,type:s?s.type:0,exists:s!==null,address:s?new ig(t):null,created:s?new Date(s.created):null,modified:s?new Date(s.modified):null,revision:s?s.revision:null,revision_nr:s?s.revision_nr:null});if(!s&&t!==""){const c=yield o.moveToParentPath(i.parentPath);en(c===i.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${t}"`);const l=yield this._readNode(i.parentPath,{transaction:o});l&&[le.OBJECT,le.ARRAY].includes(l.type)&&i.key in l.value?(a.exists=!0,a.value=l.value[i.key],a.address=null,a.type=l.type,a.created=new Date(l.created),a.modified=new Date(l.modified),a.revision=l.revision,a.revision_nr=l.revision_nr):a.address=null}return r.include_child_count&&(a.childCount=0,[le.OBJECT,le.ARRAY].includes(a.valueType)&&a.address&&(a.childCount=s.value?Object.keys(s.value).length:0,a.childCount+=yield o.getChildCount(t))),r.transaction||(yield o.commit()),a}catch(s){throw r.transaction||(yield o.rollback(s)),s}})}setNode(e,t){return W(this,arguments,function*(r,i,o={suppress_events:!1,context:null}){if(this.settings.readOnly)throw new Error("Database is opened in read-only mode");const s=G.get(r),a=o.transaction||(yield this._customImplementation.getTransaction({path:r,write:!0}));try{if(r===""){if(i===null||typeof i!="object"||i instanceof Array||i instanceof ArrayBuffer||"buffer"in i&&i.buffer instanceof ArrayBuffer)throw new Error(`Invalid value for root node: ${i}`);yield this._writeNodeWithTracking("",i,{merge:!1,transaction:a,suppress_events:o.suppress_events,context:o.context})}else if(typeof o.assert_revision!="undefined"){const c=yield this.getNodeInfo(r,{transaction:a});if(c.revision!==o.assert_revision)throw new $h(`revision '${c.revision}' does not match requested revision '${o.assert_revision}'`);if(c.address&&c.address.path===r&&i!==null&&!this.valueFitsInline(i))yield this._writeNodeWithTracking(r,i,{merge:!1,transaction:a,suppress_events:o.suppress_events,context:o.context});else{const l=yield a.moveToParentPath(s.parentPath);en(l===s.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${r}"`),yield this._writeNodeWithTracking(s.parentPath,{[s.key]:i},{merge:!0,transaction:a,suppress_events:o.suppress_events,context:o.context})}}else{const c=yield a.moveToParentPath(s.parentPath);en(c===s.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${r}"`),yield this.updateNode(s.parentPath,{[s.key]:i},{transaction:a,suppress_events:o.suppress_events,context:o.context})}o.transaction||(yield a.commit())}catch(c){throw o.transaction||(yield a.rollback(c)),c}})}updateNode(e,t){return W(this,arguments,function*(r,i,o={suppress_events:!1,context:null}){if(this.settings.readOnly)throw new Error("Database is opened in read-only mode");if(typeof i!="object")throw new Error("invalid updates argument");if(Object.keys(i).length===0)return;const s=o.transaction||(yield this._customImplementation.getTransaction({path:r,write:!0}));try{const a=yield this.getNodeInfo(r,{transaction:s}),c=G.get(r);if(a.exists&&a.address&&a.address.path===r)yield this._writeNodeWithTracking(r,i,{transaction:s,merge:!0,suppress_events:o.suppress_events,context:o.context});else if(a.exists){const l=G.get(r),u=yield s.moveToParentPath(l.parentPath);en(u===l.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${r}"`),yield this._writeNodeWithTracking(l.parentPath,{[l.key]:i},{transaction:s,merge:!0,suppress_events:o.suppress_events,context:o.context})}else{const l=yield s.moveToParentPath(c.parentPath);en(l===c.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${r}"`),yield this.updateNode(c.parentPath,{[c.key]:i},{transaction:s,suppress_events:o.suppress_events,context:o.context})}o.transaction||(yield s.commit())}catch(a){throw o.transaction||(yield s.rollback(a)),a}})}}class SB{constructor(e=1e3,t){this.limit=e,this.options=t,this.added=0,this.scheduled=[],this.running=0,this.results=[],this.done=!1}execute(e,t){return W(this,null,function*(){var r,i;try{this.running++;const o=yield e();if(this.results[t]=o,this.running--,this.running===0&&this.scheduled.length===0)this.done=!0,(r=this.doneCallback)==null||r.call(this,this.results);else if(this.scheduled.length>0){const s=this.scheduled.shift();this.execute(s.task,s.index)}}catch(o){this.done=!0,(i=this.errorCallback)==null||i.call(this,o)}})}add(e){var t;if(this.done)throw new Error("Cannot add to a batch that has already finished. Use wait option and start batch processing manually if you are adding tasks in an async loop");const r=this.added++;((t=this.options)==null?void 0:t.wait)!==!0&&this.running<this.limit?this.execute(e,r):this.scheduled.push({task:e,index:r})}start(){for(;this.running<this.limit;){const e=this.scheduled.shift();this.execute(e.task,e.index)}}finish(){return W(this,null,function*(){return this.running===0&&this.scheduled.length===0?this.results:(yield new Promise((e,t)=>{this.doneCallback=e,this.errorCallback=t}),this.results)})}}const TB=()=>{};function Nw(n,e,t){return W(this,arguments,function*(r,i,o,s={snapshots:!1,include:void 0,exclude:void 0,child_objects:void 0,eventHandler:TB}){var a,c,l,u,h,y;typeof s!="object"&&(s={}),typeof s.snapshots=="undefined"&&(s.snapshots=!1);const d={};(a=r.storage.settings.transactions)!=null&&a.log&&(d.acebase_cursor=Kt.generate());const f=o.filters.map(O=>ie({},O)),g=o.order.map(O=>ie({},O)),_=O=>{O.sort((p,v)=>{const m=w=>{const E=g[w],b=G.getPathKeys(typeof E.key=="number"?`[${E.key}]`:E.key),k=b.reduce(($,S)=>$!==null&&typeof $=="object"&&S in $?$[S]:null,p.val),x=b.reduce(($,S)=>$!==null&&typeof $=="object"&&S in $?$[S]:null,v.val);return k===null?x===null?0:E.ascending?-1:1:x===null?E.ascending?1:-1:k==x?w<g.length-1?m(w+1):p.path<v.path?-1:1:k<x?E.ascending?-1:1:E.ascending?1:-1};return m(0)})},A=(O,p)=>W(this,null,function*(){if(O.length===0)return[];const v=50,m=new SB(v),w=[];return O.forEach(({path:E},b)=>m.add(()=>W(this,null,function*(){const k=(yield r.storage.getNode(E,p)).value;if(k===null){r.storage.debug.warn(`Indexed result "/${E}" does not have a record!`);return}const x={path:E,val:k};U.sorted?w[b]=x:(w.push(x),!U.skipped&&w.length>o.skip+Math.abs(o.take)&&(_(w),w.pop()))}))),yield m.finish(),w}),P=G.get(i),B=P.keys.some(O=>O==="*"||O.toString().startsWith("$")),C=r.storage.indexes.get(i),L=[];let q=()=>W(this,null,function*(){});if(B){const O=P.keys.filter(m=>typeof m=="string"&&m.startsWith("$")),p=O.length>0&&O.every(m=>o.filters.some(w=>w.key===m&&["==","in"].includes(w.op))),v=typeof s.monitor=="object"&&[(c=s.monitor)==null?void 0:c.add,(l=s.monitor)==null?void 0:l.change,(u=s.monitor)==null?void 0:u.remove].some(m=>m===!0);if(p&&!v){const m=[];for(const $ of O){const S=o.filters.filter(R=>R.key===$).reduce((R,N)=>{if(N.op==="=="&&R.push(N.compare),N.op==="in"){if(!(N.compare instanceof Array))throw new Error("compare argument for 'in' operator must be an Array");R.push(...N.compare)}return R},[]),T=m.splice(0);S.forEach(R=>{T.length===0?m.push({[$]:R}):m.push(...T.map(N=>et(ie({},N),{[$]:R})))})}const w=o.filters.filter($=>!O.includes($.key)),E=m.map($=>G.get(G.getPathKeys(i).map(S=>{var T;return(T=$[S])!=null?T:S})).path),b=o.order.length>0,k=E.map($=>{var S;return Nw(r,$,{filters:w,take:0,skip:0,order:[]},{snapshots:b,cache_mode:s.cache_mode,include:[...(S=s.include)!=null?S:[],...o.order.map(T=>T.key)],exclude:s.exclude})});let x=(yield Promise.all(k)).reduce(($,S)=>($.push(...S.results),$),[]);if(b&&_(x),o.skip>0&&x.splice(0,o.skip),o.take>0&&x.splice(o.take),s.snapshots&&(!b||((h=s.include)==null?void 0:h.length)>0||((y=s.exclude)==null?void 0:y.length)>0||!s.child_objects)){const{include:$,exclude:S,child_objects:T}=s;x=yield A(x,{include:$,exclude:S,child_objects:T})}return{results:x,context:null,stop:q}}else if(C.length===0){const m=new Error(`Query on wildcard path "/${i}" requires an index`);return Promise.reject(m)}if(f.length===0){const m=C.filter(w=>w.type==="normal")[0];f.push({key:m.key,op:"!=",compare:null})}}f.forEach(O=>{if(O.index)return;const p=C.filter(v=>v.key===O.key).filter(v=>v.validOperators.includes(O.op));if(p.length>=1){const v=f.filter(b=>b!==O).map(b=>b.key),m=g.map(b=>b.key).filter(b=>b!==O.key),w=p.map(b=>{const k=b.includeKeys.concat(b.key),x=k.filter(R=>v.includes(R)),$=k.filter(R=>m.includes(R)),S=x.concat($.filter(R=>!x.includes(R))),T={filters:x.length,sorting:$.length*(o.take!==0?$.length:1),both:S.length*S.length,get total(){return this.filters+this.sorting+this.both}};return{index:b,points:T.total,filterKeys:x,sortKeys:$}});w.sort((b,k)=>b.points>k.points?-1:1);const E=w[0];O.index=E.index,E.filterKeys.forEach(b=>{f.filter(k=>k!==O&&k.key===b).forEach(k=>{!gf.validOperators.includes(k.op)||(k.indexUsage="filter",k.index=E.index)})}),E.sortKeys.forEach(b=>{g.filter(k=>k.key===b).forEach(k=>{k.index=E.index})})}O.index&&L.push({index:O.index,description:O.index.description})}),g.length>0&&o.take!==0&&f.length===0&&g.forEach(O=>{O.index||(O.index=C.filter(p=>p.key===O.key).find(p=>p.type==="normal"))});const H=L.map(O=>O.description).join(", ");L.length>0&&r.storage.debug.log(`Using indexes for query: ${H}`);const j=f.filter(O=>!O.index),I=/^[a-z]+:/i;if(j.some(O=>I.test(O.op))){const O=j.find(v=>I.test(v.op)),p=new Error(`query contains operator "${O.op}" which requires a special index that was not found on path "${i}", key "${O.key}"`);return Promise.reject(p)}const D=["<","<=","==","!=",">=",">","like","!like","in","!in","matches","!matches","between","!between","has","!has","contains","!contains","exists","!exists"];for(let O=0;O<j.length;O++){const p=j[O];if(!D.includes(p.op))return Promise.reject(new Error(`query contains unknown filter operator "${p.op}" on path "${i}", key "${p.key}"`))}if(B&&j.length>0){const O=j.reduce((v,m)=>(v.indexOf(m.key)<0&&v.push(m.key),v),[]).map(v=>`"${v}"`),p=new Error(`This wildcard path query on "/${i}" requires index(es) on key(s): ${O.join(", ")}. Create the index(es) and retry`);return Promise.reject(p)}const M=[];f.forEach(O=>{if(O.index&&O.indexUsage!=="filter"){let p=O.index.query(O.op,O.compare).then(m=>(s.eventHandler&&s.eventHandler({name:"stats",type:"index_query",source:O.index.description,stats:m.stats}),m.hints.length>0&&s.eventHandler&&s.eventHandler({name:"hints",type:"index_query",source:O.index.description,hints:m.hints}),m));const v=f.filter(m=>m.index===O.index&&m.indexUsage==="filter");v.length>0&&(p=p.then(m=>(v.forEach(w=>{const{key:E,op:b,index:k}=w;let{compare:x}=w;typeof x=="string"&&!k.caseSensitive&&(x=x.toLocaleLowerCase(k.textLocale)),m=m.filterMetadata(E,b,x)}),m))),M.push(p)}});const U={filtered:f.length===0,skipped:o.skip===0,taken:o.take===0,sorted:g.length===0,preDataLoaded:!1,dataLoaded:!1};if(f.length===0&&o.take===0&&(r.storage.debug.warn(`Filterless queries must use .take to limit the results. Defaulting to 100 for query on path "${i}"`),o.take=100),g.length>0&&g[0].index){const O=g[0].index,p=o.take<0?!g[0].ascending:g[0].ascending;if(f.length===0&&g.slice(1).every(v=>O.allMetadataKeys.includes(v.key))){r.storage.debug.log(`Using index for sorting: ${O.description}`);const v=g.slice(1).map(w=>(w.index=O,{key:w.key,ascending:w.ascending})),m=O.take(o.skip,Math.abs(o.take),{ascending:p,metadataSort:v}).then(w=>(s.eventHandler&&s.eventHandler({name:"stats",type:"sort_index_take",source:O.description,stats:w.stats}),w.hints.length>0&&s.eventHandler&&s.eventHandler({name:"hints",type:"sort_index_take",source:O.description,hints:w.hints}),w));M.push(m),U.skipped=!0,U.taken=!0,U.sorted=!0}}return Promise.all(M).then(O=>W(this,null,function*(){let p=[];if(O.length===1){const x=O[0];p=x.map($=>{const S={key:$.key,path:$.path,val:{[x.filterKey]:$.value}};return $.metadata&&Object.assign(S.val,$.metadata),S}),U.filtered=!0}else if(O.length>1){O.sort((S,T)=>S.length<T.length?-1:1);const x=O[0],$=O.slice(1);p=x.reduce((S,T)=>{const R={key:T.key,path:T.path,val:{[x.filterKey]:T.value}};return $.every(N=>N.findIndex(z=>z.path===T.path)>=0)&&(T.metadata&&Object.assign(R.val,T.metadata),$.forEach(N=>{const z=N.find(F=>F.path===R.path);R.val[N.filterKey]=z.value,z.metadata&&Object.assign(R.val,z.metadata)}),S.push(R)),S},[]),U.filtered=!0}if(B||M.length>0&&j.length===0){if(g.length===0||g.every(x=>x.index)){if(U.preDataLoaded=!0,!U.sorted&&g.length>0&&_(p),U.sorted=!0,!U.skipped&&o.skip>0&&(p=o.take<0?p.slice(0,-o.skip):p.slice(o.skip)),!U.taken&&o.take!==0&&(p=o.take<0?p.slice(o.take):p.slice(0,o.take)),U.skipped=!0,U.taken=!0,!s.snapshots)return p;const x={include:s.include,exclude:s.exclude,child_objects:s.child_objects};return A(p,x).then($=>(U.dataLoaded=!0,$))}if(s.snapshots||!U.sorted){const x=g.length>0,$=x?{include:g.map(S=>S.key)}:{include:s.include,exclude:s.exclude,child_objects:s.child_objects};return A(p,$).then(S=>(g.length>0&&_(S),U.sorted=!0,o.skip>0&&(S=o.take<0?S.slice(0,-o.skip):S.slice(o.skip)),o.take!==0&&(S=o.take<0?S.slice(o.take):S.slice(0,o.take)),U.skipped=!0,U.taken=!0,s.snapshots&&x?A(S,{include:s.include,exclude:s.exclude,child_objects:s.child_objects}):S))}else return p}let v;p.length>0&&(v=p.map(x=>x.key));let m=[],w=!1;const E=g.length>0,b=E?{include:g.map(x=>x.key)}:{include:s.include,exclude:s.exclude,child_objects:s.child_objects},k={promises:[],add(x){if(this.promises.push(x),this.promises.length>=1e3)return Promise.all(this.promises.splice(0)).then($=>{})}};try{yield r.storage.getChildren(i,{keyFilter:v,async:!0}).next(x=>{if(x.type!==le.OBJECT||!x.address)return;if(w)return!1;const $=()=>W(this,null,function*(){if(!(yield r.storage.matchNode(x.address.path,j)))return;const T=x.address.path;let R;if(s.snapshots||g.length>0){const N=yield r.storage.getNode(T,b);R={path:T,val:N.value}}else R={path:T};m.push(R),o.take!==0&&m.length>Math.abs(o.take)+o.skip&&(g.length>0?_(m):o.take>0&&(w=!0),m.pop())}),S=k.add($());if(S instanceof Promise)return S})}catch(x){return x instanceof yf||r.storage.debug.warn(`Error getting child stream: ${x}`),[]}return yield Promise.all(k.promises),U.preDataLoaded=E,U.dataLoaded=!E,g.length>0&&_(m),U.sorted=!0,o.skip>0&&(m=o.take<0?m.slice(0,-o.skip):m.slice(o.skip)),U.skipped=!0,o.take!==0&&(m=o.take<0?m.slice(o.take):m.slice(0,o.take)),U.taken=!0,U.dataLoaded||(m=yield A(m,{include:s.include,exclude:s.exclude,child_objects:s.child_objects}),U.dataLoaded=!0),m})).then(O=>{if(!U.sorted&&g.length>0&&_(O),s.snapshots||(O=O.map(p=>p.path)),!U.skipped&&o.skip>0&&(O=o.take<0?O.slice(0,-o.skip):O.slice(o.skip)),!U.taken&&o.take!==0&&(O=o.take<0?O.slice(o.take):O.slice(0,o.take)),s.monitor===!0&&(s.monitor={add:!0,change:!0,remove:!0}),typeof s.monitor=="object"&&(s.monitor.add||s.monitor.change||s.monitor.remove)){const p=s.monitor,v=s.snapshots?O.map(S=>S.path):O.slice(),m=r.db.ref(i),w=S=>{const T=v.indexOf(S);T<0||v.splice(T,1)},E=S=>{v.includes(S)||v.push(S)},b=()=>{r.unsubscribe(m.path,"child_changed",k),r.unsubscribe(m.path,"child_added",x),r.unsubscribe(m.path,"notify_child_removed",$)};q=()=>W(this,null,function*(){b()});const k=(S,T,R,N)=>W(this,null,function*(){const z=v.includes(T);let F=!0;const ne=[];f.forEach(re=>!ne.includes(re.key)&&ne.push(re.key));const te=[];typeof N=="object"&&Object.keys(N).forEach(re=>!te.includes(re)&&te.push(re)),typeof R=="object"&&Object.keys(R).forEach(re=>!te.includes(re)&&te.push(re));const pe=[];let oe=te.every(re=>ne.includes(re)?f.filter(ue=>ue.key===re).every(ue=>{var Ne;return((Ne=ue.index)==null?void 0:Ne.textLocaleKey)&&!te.includes(ue.index.textLocaleKey)?(pe.push(ue.index.textLocaleKey),!0):D.includes(ue.op)?r.storage.test(R[re],ue.op,ue.compare):ue.index.test(R,ue.op,ue.compare)}):!0);if(oe&&(pe.push(...ne.filter(re=>!te.includes(re))),!z&&pe.length>0)){const re=f.filter(ye=>pe.includes(ye.key)),ue=re.filter(ye=>D.includes(ye.op)),Ne=re.filter(ye=>!D.includes(ye.op));if(ue.length>0&&(oe=yield r.storage.matchNode(T,ue)),oe&&Ne.length>0){const ye=Ne.reduce((Ce,He)=>(Ce.includes(He.key)||Ce.push(He.key),He.index instanceof Cw&&He.index.config.localeKey&&!Ce.includes(He.index.config.localeKey)&&Ce.push(He.index.config.localeKey),Ce),[]),It=yield r.storage.getNode(T,{include:ye});if(It.value===null)return!1;oe=Ne.every(Ce=>Ce.index.test(It.value,Ce.op,Ce.compare))}}if(oe){if(z||E(T),s.snapshots){const re={include:s.include,exclude:s.exclude,child_objects:s.child_objects};R=(yield r.storage.getNode(T,re)).value}z&&p.change?F=s.eventHandler({name:"change",path:T,value:R})!==!1:!z&&p.add&&(F=s.eventHandler({name:"add",path:T,value:R})!==!1)}else z&&(w(T),p.remove&&(F=s.eventHandler({name:"remove",path:T,value:N})!==!1));F===!1&&b()}),x=(S,T,R)=>{const N=f.every(F=>D.includes(F.op)?r.storage.test(R[F.key],F.op,F.compare):F.index.test(R,F.op,F.compare));let z=!0;N&&(E(T),p.add&&(z=s.eventHandler({name:"add",path:T,value:s.snapshots?R:null})!==!1)),z===!1&&b()},$=(S,T,R,N)=>{let z=!0;w(T),p.remove&&(z=s.eventHandler({name:"remove",path:T,value:s.snapshots?N:null})!==!1),z===!1&&b()};(s.monitor.add||s.monitor.change||s.monitor.remove)&&r.subscribe(m.path,"child_changed",k),s.monitor.remove&&r.subscribe(m.path,"notify_child_removed",$),s.monitor.add&&r.subscribe(m.path,"child_added",x)}return{results:O,context:d,stop:q}})})}class PB extends nB{constructor(e="default",t,r){super(),this.db=t.db;const i={logLevel:t.settings.logLevel};if(typeof t.settings.storage=="object")if(tg&&t.settings.storage instanceof tg)this.storage=new uB(e,t.settings.storage,i);else if(ng&&t.settings.storage instanceof ng)this.storage=new hB(e,t.settings.storage,i);else if(fs&&t.settings.storage instanceof fs)this.storage=new AB(e,t.settings.storage,i);else{const o=t.settings.storage instanceof nu?t.settings.storage:new nu(t.settings.storage);this.storage=new _h(e,o,i)}else this.storage=new _h(e,new nu,i);this.storage.on("ready",r)}stats(e){return W(this,null,function*(){return this.storage.stats})}subscribe(e,t,r){this.storage.subscriptions.add(e,t,r)}unsubscribe(e,t,r){this.storage.subscriptions.remove(e,t,r)}set(e,t){return W(this,arguments,function*(r,i,o={suppress_events:!1,context:null}){const s=yield this.storage.setNode(r,i,{suppress_events:o.suppress_events,context:o.context});return ie({},s&&{cursor:s})})}update(e,t){return W(this,arguments,function*(r,i,o={suppress_events:!1,context:null}){const s=yield this.storage.updateNode(r,i,{suppress_events:o.suppress_events,context:o.context});return ie({},s&&{cursor:s})})}get transactionLoggingEnabled(){return this.storage.settings.transactions&&this.storage.settings.transactions.log===!0}get(e,t){return W(this,null,function*(){if(t||(t={}),typeof t.include!="undefined"&&!(t.include instanceof Array))throw new TypeError("options.include must be an array of key names");if(typeof t.exclude!="undefined"&&!(t.exclude instanceof Array))throw new TypeError("options.exclude must be an array of key names");if(["undefined","boolean"].indexOf(typeof t.child_objects)<0)throw new TypeError("options.child_objects must be a boolean");const r=yield this.storage.getNode(e,t);return{value:r.value,context:{acebase_cursor:r.cursor},cursor:r.cursor}})}transaction(e,t){return W(this,arguments,function*(r,i,o={suppress_events:!1,context:null}){const s=yield this.storage.transactNode(r,i,{suppress_events:o.suppress_events,context:o.context});return ie({},s&&{cursor:s})})}exists(e){return W(this,null,function*(){return(yield this.storage.getNodeInfo(e)).exists})}query(e,t){return W(this,arguments,function*(r,i,o={snapshots:!1}){return yield Nw(this,r,i,o)})}createIndex(e,t,r){return this.storage.indexes.create(e,t,r)}getIndexes(){return W(this,null,function*(){return this.storage.indexes.list()})}deleteIndex(e){return W(this,null,function*(){return this.storage.indexes.delete(e)})}reflect(e,t,r){return W(this,null,function*(){r=r||{};const i=(o,s=50,a=0,c=null)=>W(this,null,function*(){typeof s=="string"&&(s=parseInt(s)),typeof a=="string"&&(a=parseInt(a)),["null","undefined"].includes(c)&&(c=null);const l=[];let u=0,h=!1,y=!1;return yield this.storage.getChildren(o).next(d=>{if(h)return y=!0,!1;u++,(c!==null?d.key>c:a===0||u>a)&&l.push(ie({key:typeof d.key=="string"?d.key:d.index,type:d.valueTypeName,value:d.value},typeof d.address=="object"&&"pageNr"in d.address&&{address:{pageNr:d.address.pageNr,recordNr:d.address.recordNr}})),h=s>0&&l.length===s}).catch(d=>{if(!(d instanceof yf))throw d}),{more:y,list:l}});switch(t){case"children":return yield i(e,r.limit,r.skip,r.from);case"info":{const o={key:"",exists:!1,type:"unknown",value:void 0,address:void 0,children:{count:0,more:!1,list:[]}},s=yield this.storage.getNodeInfo(e,{include_child_count:r.child_count===!0});o.key=typeof s.key!="undefined"?s.key:s.index,o.exists=s.exists,o.type=s.exists?s.valueTypeName:void 0,o.value=s.value,o.address=typeof s.address=="object"&&"pageNr"in s.address?{pageNr:s.address.pageNr,recordNr:s.address.recordNr}:void 0;const a=s.exists&&s.address&&[le.OBJECT,le.ARRAY].includes(s.type);return r.child_count===!0?o.children={count:a?s.childCount:0}:typeof r.child_limit=="number"&&r.child_limit>0&&a&&(o.children=yield i(e,r.child_limit,r.child_skip,r.child_from)),o}}})}export(e,t,r={format:"json",type_safe:!0}){return this.storage.exportNode(e,t,r)}import(e,t,r={format:"json",suppress_events:!1,method:"set"}){return this.storage.importNode(e,t,r)}setSchema(e,t,r=!1){return W(this,null,function*(){return this.storage.setSchema(e,t,r)})}getSchema(e){return W(this,null,function*(){return this.storage.getSchema(e)})}getSchemas(){return W(this,null,function*(){return this.storage.getSchemas()})}validateSchema(e,t,r){return W(this,null,function*(){return this.storage.validateSchema(e,t,{updates:r})})}getMutations(e){return W(this,null,function*(){if(typeof this.storage.getMutations!="function")throw new Error("Used storage type does not support getMutations");if(typeof e!="object")throw new Error("No filter specified");if(typeof e.cursor!="string"&&typeof e.timestamp!="number")throw new Error("No cursor or timestamp given");return this.storage.getMutations(e)})}getChanges(e){return W(this,null,function*(){if(typeof this.storage.getChanges!="function")throw new Error("Used storage type does not support getChanges");if(typeof e!="object")throw new Error("No filter specified");if(typeof e.cursor!="string"&&typeof e.timestamp!="number")throw new Error("No cursor or timestamp given");return this.storage.getChanges(e)})}}class jB extends mf{constructor(e){super(e),this.temp=!1,this.multipleTabs=!1,typeof e.temp=="boolean"&&(this.temp=e.temp),typeof e.provider=="object"&&(this.provider=e.provider),typeof e.multipleTabs=="boolean"&&(this.multipleTabs=e.multipleTabs),typeof e.logLevel=="string"&&(this.logLevel=e.logLevel),typeof e.sponsor=="boolean"&&(this.sponsor=e.sponsor),["type","ipc","path"].forEach(t=>{t in e&&console.warn(`${t} setting is not supported for AceBase LocalStorage`)})}}class RB extends vf{constructor(e,t){super(t),this.context=e,this._storageKeysPrefix=`${this.context.dbname}.acebase::`}commit(){return W(this,null,function*(){})}rollback(e){return W(this,null,function*(){})}get(e){return W(this,null,function*(){const t=this.context.localStorage.getItem(this.getStorageKeyForPath(e));return JSON.parse(t)})}set(e,t){return W(this,null,function*(){const r=JSON.stringify(t);this.context.localStorage.setItem(this.getStorageKeyForPath(e),r)})}remove(e){return W(this,null,function*(){this.context.localStorage.removeItem(this.getStorageKeyForPath(e))})}childrenOf(e,t,r,i){return W(this,null,function*(){const o=ds.PathInfo.get(e);for(let s=0;s<this.context.localStorage.length;s++){const a=this.context.localStorage.key(s);if(!a.startsWith(this._storageKeysPrefix))continue;const c=this.getPathFromStorageKey(a);if(o.isParentOf(c)&&r(c)){let l;if(t.metadata||t.value){const u=this.context.localStorage.getItem(a);l=JSON.parse(u)}if(!i(c,l))break}}})}descendantsOf(e,t,r,i){return W(this,null,function*(){const o=ds.PathInfo.get(e);for(let s=0;s<this.context.localStorage.length;s++){const a=this.context.localStorage.key(s);if(!a.startsWith(this._storageKeysPrefix))continue;const c=this.getPathFromStorageKey(a);if(o.isAncestorOf(c)&&r(c)){let l;if(t.metadata||t.value){const u=this.context.localStorage.getItem(a);l=JSON.parse(u)}if(!i(c,l))break}}})}getPathFromStorageKey(e){return e.slice(this._storageKeysPrefix.length)}getStorageKeyForPath(e){return`${this._storageKeysPrefix}${e}`}}function IB(n,e={}){const t=new jB(e),r=t.provider?t.provider:t.temp?window.localStorage:window.sessionStorage,i=new fs({name:"LocalStorage",locking:!0,removeVoidProperties:t.removeVoidProperties,maxInlineValueSize:t.maxInlineValueSize,ready(){return W(this,null,function*(){})},getTransaction(s){return W(this,null,function*(){const a={debug:!0,dbname:n,localStorage:r};return new RB(a,s)})}}),o=new Cs(n,{logLevel:t.logLevel,storage:i,sponsor:t.sponsor});return o.settings.ipcEvents=t.multipleTabs===!0,o}class CB extends mf{constructor(e){super(e),this.multipleTabs=!1,this.cacheSeconds=60,this.sponsor=!1,typeof e.logLevel=="string"&&(this.logLevel=e.logLevel),typeof e.multipleTabs=="boolean"&&(this.multipleTabs=e.multipleTabs),typeof e.cacheSeconds=="number"&&(this.cacheSeconds=e.cacheSeconds),typeof e.sponsor=="boolean"&&(this.sponsor=e.sponsor),["type","ipc","path"].forEach(t=>{t in e&&console.warn(`${t} setting is not supported for AceBase IndexedDBStorage`)})}}class Bw extends Pw{constructor(e={}){super(e),e.storage&&(this.storage=e.storage,e.ipc&&(this.storage.ipc=e.ipc),e.transactions&&(this.storage.transactions=e.transactions))}}class NB extends tB{constructor(e,t={}){const r=new Bw(t);super(e,r),this.recovery={repairNode:(o,s)=>W(this,null,function*(){if(yield this.ready(),this.api.storage instanceof _h)yield this.api.storage.repairNode(o,s);else if(!this.api.storage.repairNode)throw new Error("repairNode is not supported with chosen storage engine")}),repairNodeTree:o=>W(this,null,function*(){yield this.ready(),yield this.api.storage.repairNodeTree(o)})};const i={db:this,settings:r};this.api=new PB(e,i,()=>{this.emit("ready")})}close(){return W(this,null,function*(){yield this.api.storage.close()})}get settings(){const e=this.api.storage.ipc,t=this.debug;return{get logLevel(){return t.level},set logLevel(r){t.setLevel(r)},get ipcEvents(){return e.eventsEnabled},set ipcEvents(r){e.eventsEnabled=r}}}static WithLocalStorage(e,t={}){return IB(e,t)}static WithIndexedDB(e,t={}){throw new Error("IndexedDB storage can only be used in browser contexts")}}function og(n){return new Promise((e,t)=>{n.onsuccess=r=>e(n.result||null),n.onerror=t})}class BB extends vf{constructor(e,t){super(t),this.context=e,this.production=!0,this._pending=[]}_createTransaction(e=!1){return this.context.db.transaction(["nodes","content"],e?"readwrite":"readonly")}_splitMetadata(e){const t=e.value,r=ie({},e);return delete r.value,{metadata:r,value:t}}commit(){return W(this,null,function*(){if(this._pending.length===0)return;const e=this._pending.splice(0);this.context.ipc.sendNotification({action:"cache.invalidate",paths:e.map(r=>r.path)});const t=this._createTransaction(!0);try{yield new Promise((r,i)=>{let o=!1,s=0;const a=l=>{o=!0,i(l)},c=()=>{++s===e.length&&r()};e.forEach((l,u)=>{if(o)return;let h,y;const d=l.path;if(l.action==="set"){const{metadata:g,value:_}=this._splitMetadata(l.node),A={path:d,metadata:g};h=t.objectStore("nodes").put(A),y=t.objectStore("content").put(_,d),this.context.cache.set(d,l.node)}else l.action==="remove"?(h=t.objectStore("content").delete(d),y=t.objectStore("nodes").delete(d),this.context.cache.set(d,null)):a(new Error(`Unknown pending operation "${l.action}" on path "${d}" `));let f=0;h.onsuccess=y.onsuccess=()=>{++f===2&&c()},h.onerror=y.onerror=a})}),t.commit&&t.commit()}catch(r){throw console.error(r),t.abort&&t.abort(),r}})}rollback(e){return W(this,null,function*(){this._pending=[]})}get(e){return W(this,null,function*(){if(this.context.cache.has(e))return this.context.cache.get(e);const t=this._createTransaction(!1),r=og(t.objectStore("nodes").get(e)),i=og(t.objectStore("content").get(e));try{const o=yield Promise.all([r,i]);t.commit&&t.commit();const s=o[0];if(!s)return this.context.cache.set(e,null),null;const a=s.metadata;return a.value=o[1],this.context.cache.set(e,a),a}catch(o){throw console.error("IndexedDB get error",o),t.abort&&t.abort(),o}})}set(e,t){this._pending.push({action:"set",path:e,node:t})}remove(e){this._pending.push({action:"remove",path:e})}removeMultiple(e){return W(this,null,function*(){e.forEach(t=>{this._pending.push({action:"remove",path:t})})})}childrenOf(e,t,r,i){return this._getChildrenOf(e,et(ie({},t),{descendants:!1}),r,i)}descendantsOf(e,t,r,i){return this._getChildrenOf(e,et(ie({},t),{descendants:!0}),r,i)}_getChildrenOf(e,t,r,i){return new Promise((o,s)=>{const a=ds.PathInfo.get(e),c=this._createTransaction(!1),l=c.objectStore("nodes"),u=IDBKeyRange.lowerBound(e,!0),h=t.metadata?l.openCursor(u):l.openKeyCursor(u);h.onerror=y=>{var d;(d=c.abort)==null||d.call(c),s(y)},h.onsuccess=y=>W(this,null,function*(){var d,f,g;const _=(f=(d=h.result)==null?void 0:d.key)!=null?f:null;let A=!0;if(_===null)A=!1;else if(!a.isAncestorOf(_))A=!1;else if(t.descendants||a.isParentOf(_)){let P;if(t.metadata&&(P=h.result.value.metadata),r(_,P)){if(t.value)if(this.context.cache.has(_)){const B=this.context.cache.get(_);P.value=B.value}else{const B=c.objectStore("content").get(_);P.value=yield new Promise((C,L)=>{B.onerror=q=>{C(null)},B.onsuccess=q=>{C(B.result)}}),this.context.cache.set(_,P.value===null?null:P)}A=i(_,P)}}if(A)try{h.result.continue()}catch(P){A=!1}A||((g=c.commit)==null||g.call(c),o())})})}}function LB(n,e={}){const t=new CB(e),r=(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB).open(`${n}.acebase`,1);r.onupgradeneeded=u=>{const h=r.result;h.createObjectStore("nodes",{keyPath:"path"}),h.createObjectStore("content")};let i;const o=new Promise((u,h)=>{r.onsuccess=y=>{i=r.result,u()},r.onerror=y=>{h(y)}}),s=new oB(typeof t.cacheSeconds=="number"?t.cacheSeconds:60),a=new fs({name:"IndexedDB",locking:!0,removeVoidProperties:t.removeVoidProperties,maxInlineValueSize:t.maxInlineValueSize,lockTimeout:t.lockTimeout,ready(){return o},getTransaction(u){return W(this,null,function*(){yield o;const h={debug:!1,db:i,cache:s,ipc:l};return new BB(h,u)})}}),c=new Cs(n,{logLevel:t.logLevel,storage:a,sponsor:t.sponsor}),l=c.api.storage.ipc;return c.settings.ipcEvents=t.multipleTabs===!0,l.on("notification",u=>W(this,null,function*(){const h=u.data;if(typeof h=="object"&&h.action==="cache.invalidate")for(const y of h.paths)s.remove(y)})),c}const DB=`Using AceBase constructor in the browser to use localStorage is deprecated!
Switch to:
IndexedDB implementation (FASTER, MORE RELIABLE):
    let db = AceBase.WithIndexedDB(name, settings)
Or, new LocalStorage implementation:
    let db = AceBase.WithLocalStorage(name, settings)
Or, write your own CustomStorage adapter:
    let myCustomStorage = new CustomStorageSettings({ ... });
    let db = new AceBase(name, { storage: myCustomStorage })`;class Cs extends NB{constructor(e,t){if(typeof t!="object"||typeof t.storage!="object")throw new Error(DB);super(e,t),this.settings.ipcEvents=t.multipleTabs===!0}static WithIndexedDB(e,t={}){return LB(e,t)}}const qB={AceBase:Cs,AceBaseLocalSettings:Bw,DataReference:Xn,DataSnapshot:st,EventSubscription:yw,PathReference:at,TypeMappings:Ow,CustomStorageSettings:fs,CustomStorageTransaction:vf,CustomStorageHelpers:ds,ID:Kt,proxyAccess:Ua,DataSnapshotsArray:el};window.acebase=qB;window.AceBase=Cs;let UB=()=>Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),ou=(()=>"/ps"+UB()+"/pe")();const Lt={req:"/custom",create:{one:"/create-one",many:"/create-many"},send:{one:"/send-one",many:"/send-many"},find:{one:"/find-one",many:"/find-many"},get:{one:"/get-one",many:"/get-many"},query:{many:"/get-many"},update:{one:"/update-one",many:"/update-many"},delete:{one:"/delete-one",many:"/delete-many"}},Jt={create:"/create",find:"/find",get:"/get",query:"/get",update:"/update",delete:"/delete",req:"/custom",upload:"/upload",send:"/send",user:{base:"/user",example:"/user/device-connected",join:"",status:"/user/status",device:{connected:"/user/device-connected",removed:"/user/device-removed",disconnected:"/user/device-disconnected"}}},su={base:"/auth",login:"/login/get-one",verify_token_code:"/verify-token-code/get-one",verify_pass_code:"/verify-pass-code/get-one",verify_email_code:"/verify-email-code/get-one",req:"/custom",user:"/user/"+ou+"/get-one",register:"/register/get-one",forgotPassword:"/forgot-password/get-one"+ou+"/get-one",deleteAccount:"/delete-account/get-one",refreshToken:"/refresh-token"+ou+"/get-one",users:{base:"/users"}},Co={base:"/storage",upload:"/upload",download:{one:"download-one",many:"download-many"}};var Wo,bi,Zi,zo,Yt,Lw,Ho,Ah,Ma,wi,Zr,Qi,Ht;class MB{constructor(e={}){wn(this,Wo,"/on"),wn(this,bi,!0),wn(this,Zi,void 0),wn(this,zo,void 0),wn(this,Yt,void 0),wn(this,Lw,void 0),wn(this,Ho,void 0),wn(this,Ah,void 0),wn(this,Ma,new _2),wn(this,wi,void 0),wn(this,Zr,void 0),wn(this,Qi,void 0),wn(this,Ht,void 0),dC(this,"init",o=>{var s,a,c,l,u;let{ENV:h,HOST_SERVER:y,API_VERSION:d}=Ee(this,Qi),f=()=>W(this,null,function*(){var p,v,m,w,E,b,k,x,$,S,T,R;let N="/transaction",z="/database",F=yield(m=(v=(p=Ee(this,Ht))==null?void 0:p.ref(N))==null?void 0:v.get())==null?void 0:m.catch(te=>{}),ne=yield(b=(E=(w=Ee(this,Ht))==null?void 0:w.ref(z))==null?void 0:E.get())==null?void 0:b.catch(te=>{});if(F.exists()){F=F.val();let te=Object.keys(F);if((te==null?void 0:te.length)>0){for(let pe in te){let oe=F[pe];(oe==null?void 0:oe.path)&&(oe==null?void 0:oe.method)&&(oe==null?void 0:oe.value)&&(yield this.init(o).database().ref(oe==null?void 0:oe.path).req(oe==null?void 0:oe.method,oe==null?void 0:oe.path,oe==null?void 0:oe.value).val())}ne.exists()&&(yield($=(x=(k=Ee(this,Ht))==null?void 0:k.ref(z))==null?void 0:x.remove())==null?void 0:$.catch(pe=>{})),yield(R=(T=(S=Ee(this,Ht))==null?void 0:S.ref(N))==null?void 0:T.remove())==null?void 0:R.catch(pe=>{})}}});(a=(s=o==null?void 0:o.socket)==null?void 0:s.storage)==null||a.on("connect",()=>{Un(this,Zr,!0),f()}),(l=(c=o==null?void 0:o.socket)==null?void 0:c.storage)==null||l.on("disconnect",()=>{Un(this,Zr,!1)});const g=(p={})=>{var v,m,w;let E={};if(p&&Object.keys(p).length>0&&(E.data=p),Ee(this,Yt)&&(E.storage=Ee(this,Yt),E.config=Ee(this,Ho)),Ee(this,Ah)){let b=new FormData;Array.isArray(p)?(p.map((k,x)=>{typeof k=="object"&&(k.attachmentName="attachment"+x,k==null||k.attachments.forEach($=>{$!=null&&$.data?b.append("attachments"+x,$==null?void 0:$.data,$==null?void 0:$.name):b.append("attachments"+x,$)}))}),b.append("field",JSON.stringify(E))):Array.isArray(p==null?void 0:p.attachments)&&(p==null||p.attachments.forEach(k=>{k!=null&&k.data?b.append("attachments",k==null?void 0:k.data,k==null?void 0:k.name):b.append("attachments",k)}),delete E.data.attachments,b.append("field",JSON.stringify(E))),E=b}else if(Ee(this,Yt)&&(p==null?void 0:p.file)){let b=new FormData;p!=null&&p.file?((v=p.file)!=null&&v.data?b.append("file",(m=p.file)==null?void 0:m.data,(w=p.file)==null?void 0:w.name):b.append("file",p.file),delete E.data.file,b.append("field",JSON.stringify(E))):Array.isArray(p==null?void 0:p.directory)&&(p==null||p.directory.forEach(k=>{k!=null&&k.data?b.append("file",k==null?void 0:k.data,k==null?void 0:k.name):b.append("file",k)}),delete E.data.directory,b.append("field",JSON.stringify(E)),E=b),E=b}return E};let _=(p,v)=>W(this,null,function*(){var m,w,E,b,k,x,$,S;if(((m=p==null?void 0:p.error)==null?void 0:m.token)&&Ee(this,bi)){if(Un(this,bi,!1),localStorage.getItem("refreshToken")){h==="dev"&&console.log("Token expired or not found: ",(w=p.error)==null?void 0:w.token," Trying to request a new refresh token");let T=yield(b=(E=this==null?void 0:this.init(o))==null?void 0:E.auth())==null?void 0:b.req(su.refreshToken,{token:localStorage.getItem("refreshToken")}).val();if(T!=null&&T.error)return h==="dev"&&console.log("Refresh token expired or not found: ",T),Ee(this,Zi)&&(window.top.location.href=Ee(this,Zi)),T;if(T!=null&&T.data&&(h==="dev"&&console.log("We got a new refresh token ,",T==null?void 0:T.data),(k=T==null?void 0:T.data)!=null&&k.token&&localStorage.setItem("accessToken",(x=T==null?void 0:T.data)==null?void 0:x.token),($=T==null?void 0:T.data)!=null&&$.refreshToken&&localStorage.setItem("refreshToken",(S=T==null?void 0:T.data)==null?void 0:S.refreshToken),h==="dev"&&console.log("Trying to restart your request..."),typeof v=="function"))return yield v()}}else return p});const A=(p,v,m,w=()=>{})=>{const E=Ee(this,Wo);let b=v.version+E+v.base+m;b=b.replace(/\/\//g,"/"),h==="dev"&&console.log("socket listen local path: ",b),p==null||p.on(b,w)},P=(p,v=()=>{})=>{var m;const w=Ee(this,Wo);let E=(d==null?void 0:d.STORAGE)+w+p;E=E.replace(/\/\//g,"/"),h==="dev"&&console.log("emitter listen local path: ",E),(m=Ee(this,Ma))==null||m.on(E,v)};let B=(p,v,m,w)=>{Ee(this,zo)&&(w=w+Ee(this,zo));let E={req:b=>(A(p,v,w+Jt.req,k=>{var x,$,S;(!(($=(x=k==null?void 0:k.error)==null?void 0:x.error)!=null&&$.token)&&!((S=k==null?void 0:k.error)!=null&&S.token)||(k==null?void 0:k.data))&&typeof b=="function"&&b(et(ie({},m),{value:k}))}),m),create:b=>(A(p,v,w+Jt.create,k=>{var x,$,S;(!(($=(x=k==null?void 0:k.error)==null?void 0:x.error)!=null&&$.token)&&!((S=k==null?void 0:k.error)!=null&&S.token)||(k==null?void 0:k.data))&&typeof b=="function"&&b(et(ie({},m),{value:k}))}),m),find:b=>(A(p,v,w+Jt.find,k=>{var x,$,S;(!(($=(x=k==null?void 0:k.error)==null?void 0:x.error)!=null&&$.token)&&!((S=k==null?void 0:k.error)!=null&&S.token)||(k==null?void 0:k.data))&&typeof b=="function"&&b(et(ie({},m),{value:k}))}),m),get:b=>(A(p,v,w+Jt.get,k=>{var x,$,S;(!(($=(x=k==null?void 0:k.error)==null?void 0:x.error)!=null&&$.token)&&!((S=k==null?void 0:k.error)!=null&&S.token)||(k==null?void 0:k.data))&&typeof b=="function"&&b(et(ie({},m),{value:k}))}),m),query:b=>(A(p,v,w+Jt.query,k=>{var x,$,S;(!(($=(x=k==null?void 0:k.error)==null?void 0:x.error)!=null&&$.token)&&!((S=k==null?void 0:k.error)!=null&&S.token)||(k==null?void 0:k.data))&&typeof b=="function"&&b(et(ie({},m),{value:k}))}),m),update:b=>(A(p,v,w+Jt.update,k=>{var x,$,S;(!(($=(x=k==null?void 0:k.error)==null?void 0:x.error)!=null&&$.token)&&!((S=k==null?void 0:k.error)!=null&&S.token)||(k==null?void 0:k.data))&&typeof b=="function"&&b(et(ie({},m),{value:k}))}),m),delete:b=>(A(p,v,w+Jt.delete,k=>{var x,$,S;(!(($=(x=k==null?void 0:k.error)==null?void 0:x.error)!=null&&$.token)&&!((S=k==null?void 0:k.error)!=null&&S.token)||(k==null?void 0:k.data))&&typeof b=="function"&&b(et(ie({},m),{value:k}))}),m)};return Ee(this,Yt)&&(E.upload=b=>(A(p,v,w+Jt.upload,k=>{var x,$,S;(!(($=(x=k==null?void 0:k.error)==null?void 0:x.error)!=null&&$.token)&&!((S=k==null?void 0:k.error)!=null&&S.token)||(k==null?void 0:k.data))&&typeof b=="function"&&b(et(ie({},m),{value:k}))}),m)),E},C=(p,v)=>({create:m=>(P(p+Jt.create,w=>{(!(w!=null&&w.error)||(w==null?void 0:w.data))&&typeof m=="function"&&m(et(ie({},v),{value:w}))}),v),find:m=>(P(p+Jt.find,w=>{(!(w!=null&&w.error)||(w==null?void 0:w.data))&&typeof m=="function"&&m(et(ie({},v),{value:w}))}),v),get:m=>(P(p+Jt.get,w=>{(!(w!=null&&w.error)||(w==null?void 0:w.data))&&typeof m=="function"&&m(et(ie({},v),{value:w}))}),v),query:m=>(P(p+Jt.query,w=>{(!(w!=null&&w.error)||(w==null?void 0:w.data))&&typeof m=="function"&&m(et(ie({},v),{value:w}))}),v),update:m=>(P(p+Jt.update,w=>{(!(w!=null&&w.error)||(w==null?void 0:w.data))&&typeof m=="function"&&m(et(ie({},v),{value:w}))}),v),delete:m=>(P(p+Jt.delete,w=>{(!(w!=null&&w.error)||(w==null?void 0:w.data))&&typeof m=="function"&&m(et(ie({},v),{value:w}))}),v)}),L=Fy.init(Ee(this,Qi)),q=(p="",v={},m={},w={},E)=>{p=p.trim(),p.charAt(p.length-1)==="/"&&(p=p.slice(0,-1));let b=(()=>W(this,null,function*(){let k=()=>W(this,null,function*(){return yield L("post",y.AUTH+d.AUTH+su.base+p,g(v))}),x=yield k();return Ee(this,bi)&&(x=yield _(x,()=>W(this,null,function*(){return yield k()}))),typeof E=="function"&&E(et(ie({},w),{value:x})),x}))();return et(ie({},w),{val:()=>b})},H=(p,v,m,w={},E={},b)=>{let k=(()=>W(this,null,function*(){let x=()=>W(this,null,function*(){return yield L(p,v,g(m),w)}),$=yield x();return Ee(this,bi)&&($=yield _($,()=>W(this,null,function*(){return yield x()}))),typeof b=="function"&&b(et(ie({},E),{value:$})),$}))();return et(ie({},E),{val:()=>k})},j=p=>{let v={},m,[w={},,,]=p;if(p.length===1&&typeof w=="function"&&(m=p[0],w={}),p.length===2&&(typeof p[1]=="object"?v=p[1]:typeof p[1]=="function"&&(m=p[1])),p.length>=3){let[,E,b]=p;typeof E=="object"&&(v=E),m=b}return{data:w,onRequest:v,callback:m}},I=()=>Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),D=(p,v,m={},w,E)=>{v=v.replace(/\/\//g,"/");let b=(()=>W(this,null,function*(){var k,x,$,S,T,R,N,z,F,ne,te,pe,oe,re,ue,Ne,ye,It,Ce,He,Cr,Nr,Br;let Lr="/transaction",ge,Dr,ze={error:{message:"We could not execute the "+p+" method for path: "+v}};switch(p){case"create":yield($=(x=(k=Ee(this,Ht))==null?void 0:k.ref(v))==null?void 0:x.set(m))==null?void 0:$.catch(Ie=>ze);break;case"update":yield(R=(T=(S=Ee(this,Ht))==null?void 0:S.ref(v))==null?void 0:T.update(m))==null?void 0:R.catch(Ie=>ze);break;case"query":let we=(N=Ee(this,Ht))==null?void 0:N.query(v);Array.isArray(m==null?void 0:m.where)&&(yield Promise.all(m==null?void 0:m.where.map(Ie=>W(this,null,function*(){return yield new Promise(ht=>{we==null||we.filter(...Ie),ht()})})))),m!=null&&m.take&&(we==null||we.take(m==null?void 0:m.take)),m!=null&&m.skip&&(we==null||we.take(m==null?void 0:m.skip)),m!=null&&m.order&&Array.isArray(m==null?void 0:m.order)&&(yield Promise.all(m==null?void 0:m.order.map(Ie=>W(this,null,function*(){return yield new Promise(ht=>{we==null||we.sort(...Ie),ht()})})))),Dr=yield we==null?void 0:we.count(),ge=yield(z=we==null?void 0:we.get(ie({},m==null?void 0:m.$option)))==null?void 0:z.catch(Ie=>ze);break;case"delete":ge=yield(te=(ne=(F=Ee(this,Ht))==null?void 0:F.ref(v))==null?void 0:ne.get())==null?void 0:te.catch(Ie=>ze),yield(re=(oe=(pe=Ee(this,Ht))==null?void 0:pe.ref(v))==null?void 0:oe.remove())==null?void 0:re.catch(Ie=>ze);break}if(p!=="delete"&&p!=="query"&&(ge=yield(ye=(Ne=(ue=Ee(this,Ht))==null?void 0:ue.ref(v))==null?void 0:Ne.get(ie({},m==null?void 0:m.$option)))==null?void 0:ye.catch(we=>ze)),p==="query"?ge.exists()?(ge=ge==null?void 0:ge.getValues(),ge={data:ge,max:Dr,take:m==null?void 0:m.take,skip:m==null?void 0:m.skip}):ge=ie({},ze):ge.exists()?(ge=ge==null?void 0:ge.val(),ge={data:ge}):ge=ie({},ze),Ee(this,wi)&&w.auth().$currentUserId&&!Ee(this,Zr)&&["create","delete","update"].includes(p)&&ge!=null&&ge.data){let we=yield(He=(Ce=(It=Ee(this,Ht))==null?void 0:It.ref(Lr))==null?void 0:Ce.get())==null?void 0:He.catch(_o=>ze);we.exists()?we=we.val():we={};let Ie,ht=Object.keys(we);switch(ht.length>0?Ie=ht.length+1:Ie=0,p){case"create":p="post";break;case"update":p="put";break;case"delete":p="delete";break}p!=="get"&&(yield(Br=(Nr=(Cr=Ee(this,Ht))==null?void 0:Cr.ref(Lr+"/"+Ie))==null?void 0:Nr.set({path:v,method:p,uid:Ie,value:ge.data}))==null?void 0:Br.catch(_o=>ze))}const Eo=Ee(this,Wo);let qn=(d==null?void 0:d.STORAGE)+Eo+v+"/"+p;return qn=qn.replace(/\/\//g,"/"),Ee(this,Ma).emit(qn,ge),typeof E=="function"&&E(et(ie({},w),{value:ge})),ge}))();return et(ie({},w),{val:()=>b})},M=(p,v)=>{typeof p=="function"&&(v==null||v.on("connect",p))},U=(p,v)=>{let m="%"+p,w=this.init(o);return delete w.auth().login,delete w.auth().register,{private:(E=I())=>w.event(p+E),child:E=>w.event(p+E),emit:(E,b)=>(v==null||v.emit(m,E),typeof b=="function"&&w.event(p).do(b),ie(ie({},w.event(p)),w)),do:E=>(v==null||v.on(m,b=>{typeof E=="function"&&E(et(ie(ie({},w.event(p)),w),{value:b}))}),ie(ie({},w.event(p)),w)),onAny:E=>{v==null||v.onAny((b,k)=>{typeof E=="function"&&E(b,ie(ie({value:k},w.event(b)),w))})}}},O=(p,v,m)=>et(ie({},p),{$io:m,connected:()=>m==null?void 0:m.connected,event:w=>U(w,m),ready:w=>M(w,m),ref:(w="")=>p.ref(w,v,m)});return{$connected:Ee(this,Zr),activity:()=>{let p=this.init(o);return{onStart:v=>(typeof v=="function"&&document.addEventListener("DOMContentLoaded",v),ie(ie({},p),p.activity())),onCreate:v=>(typeof v=="function"&&(window.onload=v),ie(ie({},p),p.activity())),onPause:v=>(window.addEventListener("beforeunload",function(m){typeof v=="function"&&v(),m.returnValue="onbeforeunload"}),ie(ie({},p),p.activity())),onResume:()=>ie(ie({},p),p.activity()),onLeave:v=>(typeof v=="function"&&(window.onunload=v),ie(ie({},p),p.activity()))}},socket:{storage:(u=o==null?void 0:o.socket)==null?void 0:u.storage},$randomUID:()=>Xl(),$randomId:()=>I(),$axios:Fy,local:(p={})=>{const v=this.init(o);return delete v.local,delete v.auth().register,delete v.auth().login,{database:(m="/database")=>({ref:(w="/database")=>{let E=this.init(o);return delete E.auth().login,delete E.auth().register,w=w.trim(),w=w.replace(/\/\//g,"/"),m=m+"/"+w,m=m.replace(/\/\//g,"/"),w.charAt(w.length-1)==="/"&&(w=w.slice(0,-1)),{child:(b="")=>{var k,x;return b=b.trim(),b=b.replace(/\/\//g,"/"),b.charAt(b.length-1)==="/"&&(b=b.slice(0,-1)),b.charAt(0)!=="/"&&(b="/"+b),(x=(k=E.local())==null?void 0:k.database())==null?void 0:x.ref(w+b)},push:(...b)=>{var k,x;let $=Xl();return!b.length>0?{getKey:()=>$}:(x=(k=E.local())==null?void 0:k.database())==null?void 0:x.ref(w+"/"+$).create(b)},create:(...b)=>{var k,x;let $=ie(ie({},(x=(k=E.local(p))==null?void 0:k.database())==null?void 0:x.ref(w)),E),{data:S,callback:T}=j(b);return D(p,"create",m,S,$)},get:(...b)=>{var k,x;let $=ie(ie({},(x=(k=E.local())==null?void 0:k.database())==null?void 0:x.ref(w)),E),{data:S,callback:T}=j(b);return D("get",m,S,$,T)},find:(...b)=>{var k,x;let $=ie(ie({},(x=(k=E.local())==null?void 0:k.database())==null?void 0:x.ref(w)),E),{data:S,callback:T}=j(b);return D("get",m,S,$,T)},query:()=>{},update:(...b)=>{var k,x;let $=ie(ie({},(x=(k=E.local())==null?void 0:k.database())==null?void 0:x.ref(w)),E),{data:S,callback:T}=j(b);return D("update",m,S,$,T)},delete:(...b)=>{var k,x;let $=ie(ie({},(x=(k=E.local())==null?void 0:k.database())==null?void 0:x.ref(w)),E),{data:S,callback:T}=j(b);return D("delete",m,S,$,T)},on:()=>{var b,k;let x=ie(ie({},(k=(b=E.local())==null?void 0:b.database())==null?void 0:k.ref(w)),E);return C(w,x)},onValue:b=>{var k,x,$,S,T,R,N;let z=ie(ie({},(x=(k=E.local())==null?void 0:k.database())==null?void 0:x.ref(w)),E),F=(S=($=E.local())==null?void 0:$.database())==null?void 0:S.ref(w);return(T=F==null?void 0:F.on())==null||T.create(b),(R=F==null?void 0:F.on())==null||R.update(b),(N=F==null?void 0:F.on())==null||N.delete(b),z}}}}),cache:(m="/cache")=>{var w;let E=this.init(o);return delete E.auth().login,delete E.auth().register,(w=E.local())==null?void 0:w.database(m)},storage:()=>({})}},cron:p=>{},task:p=>{},storage:(p="local",v)=>{var m;switch(Un(this,wi,!1),Un(this,Yt,p),p){case"aws":break;case"discord":Un(this,Ho,{token:v==null?void 0:v.token,channelId:v==null?void 0:v.channelId});break}const w=this.init(o);return delete w.storage,delete w.auth().register,delete w.auth().login,O(w,{host:y.STORAGE,version:d.STORAGE,base:Co.base},(m=o==null?void 0:o.socket)==null?void 0:m.storage)},$online:navigator==null?void 0:navigator.onLine,auth:()=>({req:(p,v,m)=>{let w=this.init(o);delete w.auth().login,delete w.auth().register;let E=ie(ie({},w),w.auth());return q(p+su.req,v,null,E,m)}}),syncDatabase:(p=!0)=>{const v=this.init(o);return Un(this,wi,typeof p=="boolean"?p:!0),v.database()},ref:(p="",v={host:y.STORAGE,version:d.STORAGE,base:Co.base},m=(E=>(E=o==null?void 0:o.socket)==null?void 0:E.database)(),w=!0)=>{p=p.trim(),p=p.replace(/\/\//g,"/"),p.charAt(0)==="/"&&p.length<=1&&(p="/root"),p.charAt(p.length-1)==="/"&&(p=p.slice(0,-1));const E=v.host+v.version+v.base+p;let b=this.init(o);delete b.auth().login,delete b.auth().register,Un(this,bi,w);let k={push:(...x)=>{let $=Xl();return!x.length>0?{getKey:()=>$}:b.ref(p+"/"+$,v,m).create(x)},private:(x=I())=>b.ref(p+"/ps"+x+"/pe",v,m),setAuthAccess:(x=!0,$=Ee(this,Zi))=>(Un(this,Zi,$),b.ref(p,v,m,x)),req:(...x)=>{let $=ie(ie({},b.ref(p,v,m)),b);if(x.length>=2){let[S="post",T={},R={},N]=x;if(typeof S=="string"&&["post","put","delete","get"].includes(S)){let z=Lt.req;return H(S,E+z,T,R,$,N)}return $}else{let S=x.filter(T=>typeof T=="function");if(S.length>0)S=S[0],typeof S=="function"&&S($);else return $}},child:(x="")=>(x=x.trim(),x=x.replace(/\/\//g,"/"),x.charAt(x.length-1)==="/"&&(x=x.slice(0,-1)),x.charAt(0)!=="/"&&(x="/"+x),b.ref(p+x,v,m)),set:(...x)=>{var $;return($=b.ref(p,v,m))==null?void 0:$.create(...x)},create:(...x)=>{var $;let{data:S,onRequest:T,callback:R}=j(x),N=Lt.create.one;if(Ee(this,Yt)){if((S==null?void 0:S.file)||(S==null?void 0:S.directory))return($=b.ref(p))==null?void 0:$.upload(S,null,R);Array.isArray(S.folders)&&(N=Lt.create.many)}else Array!=null&&Array.isArray(S)&&(N=Lt.create.many);return H("post",E+N,S,T,node,R)},find:(...x)=>{var $;h==="dev"&&console.log("Find: We are online");let S=ie(ie({},b.ref(p,v,m)),b),{data:T,onRequest:R,callback:N}=j(x),z=Lt.find.one;return Ee(this,Yt)?(Array.isArray(T==null?void 0:T.files)||Array.isArray(T==null?void 0:T.folders))&&(Array.isArray(T==null?void 0:T.files)&&(T.isFolder=!1),Array.isArray(T==null?void 0:T.folders)&&(T.isFolder=!0),z=Lt.find.many):((($=Object.keys(T))==null?void 0:$.length)<=0||T.order||T.where||T.$option||T.skip||T.take)&&(z=Lt.find.many),H("post",E+z,T,R,S,N)},get:(...x)=>{var $;let S=ie(ie({},b.ref(p,v,m)),b),{data:T,onRequest:R,callback:N}=j(x),z=Lt.get.one;return Ee(this,Yt)?(Array.isArray(T==null?void 0:T.files)||Array.isArray(T==null?void 0:T.folders))&&(Array.isArray(T==null?void 0:T.files)&&(T.isFolder=!1),Array.isArray(T==null?void 0:T.folders)&&(T.isFolder=!0),z=Lt.get.many):((($=Object.keys(T))==null?void 0:$.length)<=0||T.order||T.where||T.$option||T.skip||T.take)&&(z=Lt.get.many),H("get",E+z+"?query="+JSON.stringify(g(T)),null,R,S,N)},query:(...x)=>{var $,S,T;if(b.auth().$currentUserId&&(v==null?void 0:v.host)===(y==null?void 0:y.DATABASE)&&Ee(this,wi)&&!Ee(this,Zr))return(T=(S=($=b.local())==null?void 0:$.database())==null?void 0:S.ref(p))==null?void 0:T.query(...x);{let R=ie(ie({},b.ref(p,v,m)),b),{data:N,onRequest:z,callback:F}=j(x);return(!N||N==="")&&(N={take:15},!Ee(this,zo)&&!N.order&&(N.order={uid:"ASC"})),H("get",E+Lt.get.many+"?query="+JSON.stringify(g(N)),null,z,R,F)}},update:(...x)=>{let $=ie(ie({},b.ref(p,v,m)),b),{data:S,onRequest:T,callback:R}=j(x),N=Lt.update.one;return Ee(this,Yt)?(Array.isArray(S==null?void 0:S.files)||Array.isArray(S==null?void 0:S.folders))&&(Array.isArray(S==null?void 0:S.files)&&(S.isFolder=!1),Array.isArray(S==null?void 0:S.folders)&&(S.isFolder=!0),N=Lt.update.many):Array.isArray(S)&&(N=Lt.find.many),H("put",E+N,S,T,$,R)},delete:(...x)=>{var $,S,T;if(b.auth().$currentUserId&&(v==null?void 0:v.host)===(y==null?void 0:y.STORAGE)&&Ee(this,wi)&&!Ee(this,Zr))return(T=(S=($=b.local())==null?void 0:$.database())==null?void 0:S.ref(p))==null?void 0:T.delete(...x);{let R=ie(ie({},b.ref(p,v,m)),b),{data:N,onRequest:z,callback:F}=j(x),ne=Lt.delete.one;return Ee(this,Yt)?(Array.isArray(N==null?void 0:N.files)||Array.isArray(N==null?void 0:N.folders))&&(Array.isArray(N==null?void 0:N.files)&&(N.isFolder=!1),Array.isArray(N==null?void 0:N.folders)&&(N.isFolder=!0),Object.keys(N).length<=0&&(N.isFolder=!0),ne=Lt.delete.many):(Array.isArray(N)||N.where)&&(ne=Lt.delete.many),H("delete",E+ne,N,z,R,F)}},on:()=>{let x=ie(ie({},b.ref(p,v,m)),b);return B(m,v,x,p)},onValue:x=>{let $=ie(ie({},b.ref(p,v,m)),b),S=b.ref(p,v,m);return S==null||S.on().create(x),S==null||S.on().update(x),S==null||S.on().delete(x),S==null||S.on().upload(x),$}};return Ee(this,Yt)&&(k.download=(...x)=>{let $=ie(ie({},b.ref(p,v,m)),b),{data:S,onRequest:T,callback:R}=j(x),N=Co.download.one;return(Array.isArray(S==null?void 0:S.files)||Array.isArray(S==null?void 0:S.folders))&&(N=Co.download.many),H("get",E+N+"?query="+JSON.stringify(g(S)),null,T,$,R)},k.upload=(...x)=>{let $=ie(ie({},b.ref(p,v,m)),b),{data:S,onRequest:T,callback:R}=j(x),N=Co.upload+"?query="+JSON.stringify({storage:Ee(this,Yt),config:Ee(this,Ho)});return H("post",E+N,S,T,$,R)}),k}}}),Un(this,Qi,e);let{ENV:t,OFFLINE_DB_NAME:r}=Ee(this,Qi);Un(this,Ht,Cs.WithIndexedDB((r==null?void 0:r.STORAGE)||"swyger_storage"));let i=()=>W(this,null,function*(){try{let o,s=localStorage.getItem("accessToken");if((()=>{var a;try{o=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");let c=nN(s);return(Date==null?void 0:Date.parse((a=new Date((c==null?void 0:c.exp)*1e3))==null?void 0:a.toString()))<Date.now()}catch(c){return!1}})()&&o.uid)try{t==="dev"&&console.log("Token expired on inactivity, Trying to request a new refresh token")}catch(a){}}catch(o){}});"requestIdleCallback"in window&&requestIdleCallback(i)}}Wo=new WeakMap,bi=new WeakMap,Zi=new WeakMap,zo=new WeakMap,Yt=new WeakMap,Lw=new WeakMap,Ho=new WeakMap,Ah=new WeakMap,Ma=new WeakMap,wi=new WeakMap,Zr=new WeakMap,Qi=new WeakMap,Ht=new WeakMap;const FB={init:n=>{try{return(e={})=>new MB(n).init(e)}catch(e){return{}}}};let VB={init:n=>{var e,t,r,i,o;return{OFFLINE_DB_NAME:{STORAGE:((e=n==null?void 0:n.OFFLINE_DB_NAME)==null?void 0:e.STORAGE)||"swyger_storage"},ENV:(n==null?void 0:n.ENV)||"prod",HOST_SERVER:{AUTH:((t=n==null?void 0:n.HOST_SERVER)==null?void 0:t.AUTH)||"http://localhost:4100",STORAGE:((r=n==null?void 0:n.HOST_SERVER)==null?void 0:r.STORAGE)||"http://localhost:4500"},API_VERSION:{AUTH:((i=n==null?void 0:n.API_VERSION)==null?void 0:i.AUTH)||"/api/v1",STORAGE:((o=n==null?void 0:n.API_VERSION)==null?void 0:o.STORAGE)||"/api/v1"},AUTO_REFRESH_TOKEN_TIMEOUT:(n==null?void 0:n.AUTO_REFRESH_TOKEN_TIMEOUT)||15e5,API_KEY:(n==null?void 0:n.API_KEY)||"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJzd3lnZXIuY29tIiwiaWF0IjoxNjUzNDQwOTkxLCJleHAiOjE2ODQ5NzY5OTEsImF1ZCI6ImRheW52ZXIuY29tIiwic3ViIjoidGVhbUBzd3lnZXIuY29tIiwiR2l2ZW5OYW1lIjoiSXZhbiBKb2VsIiwiU3VybmFtZSI6IlNvYmd1aSIsIkVtYWlsIjoidGVhbUBhZ2dsb215LmNvbSIsIlJvbGUiOlsiQWRtaW4iLCJQcm9qZWN0IEFkbWluaXN0cmF0b3IiXX0.UvlcjBahR9G8dKxIeENJ7k4I87t3_oNJQ16eyPsRcSE"}}};const KB={init:n=>{let e=VB.init(n);const t=eN.init(e),r={socket:{storage:t==null?void 0:t.storage}};return FB.init(e)(r)}};var Sh=function(n,e){return Sh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])},Sh(n,e)};function wt(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Sh(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function WB(n,e,t,r){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{l(r.next(u))}catch(h){s(h)}}function c(u){try{l(r.throw(u))}catch(h){s(h)}}function l(u){u.done?o(u.value):i(u.value).then(a,c)}l((r=r.apply(n,e||[])).next())})}function bf(n,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(l){return function(u){return c([l,u])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,l[0]&&(t=0)),t;)try{if(r=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){t.label=l[1];break}if(l[0]===6&&t.label<o[1]){t.label=o[1],o=l;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(l);break}o[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(n,t)}catch(u){l=[6,u],i=0}finally{r=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function un(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ze(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(s)throw s.error}}return o}function Qe(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return n.concat(o||Array.prototype.slice.call(e))}function ro(n){return this instanceof ro?(this.v=n,this):new ro(n)}function zB(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),i,o=[];return i={},s("next"),s("throw"),s("return"),i[Symbol.asyncIterator]=function(){return this},i;function s(y){r[y]&&(i[y]=function(d){return new Promise(function(f,g){o.push([y,d,f,g])>1||a(y,d)})})}function a(y,d){try{c(r[y](d))}catch(f){h(o[0][3],f)}}function c(y){y.value instanceof ro?Promise.resolve(y.value.v).then(l,u):h(o[0][2],y)}function l(y){a("next",y)}function u(y){a("throw",y)}function h(y,d){y(d),o.shift(),o.length&&a(o[0][0],o[0][1])}}function HB(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof un=="function"?un(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(o){t[o]=n[o]&&function(s){return new Promise(function(a,c){s=n[o](s),i(a,c,s.done,s.value)})}}function i(o,s,a,c){Promise.resolve(c).then(function(l){o({value:l,done:a})},s)}}function Re(n){return typeof n=="function"}function Ui(n){var e=function(r){Error.call(r),r.stack=new Error().stack},t=n(e);return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var Fa=Ui(function(n){return function(e){n(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(t,r){return r+1+") "+t.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function Ar(n,e){if(n){var t=n.indexOf(e);0<=t&&n.splice(t,1)}}var pn=function(){function n(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return n.prototype.unsubscribe=function(){var e,t,r,i,o;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var a=un(s),c=a.next();!c.done;c=a.next()){var l=c.value;l.remove(this)}}catch(g){e={error:g}}finally{try{c&&!c.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}else s.remove(this);var u=this.initialTeardown;if(Re(u))try{u()}catch(g){o=g instanceof Fa?g.errors:[g]}var h=this._finalizers;if(h){this._finalizers=null;try{for(var y=un(h),d=y.next();!d.done;d=y.next()){var f=d.value;try{sg(f)}catch(g){o=o!=null?o:[],g instanceof Fa?o=Qe(Qe([],Ze(o)),Ze(g.errors)):o.push(g)}}}catch(g){r={error:g}}finally{try{d&&!d.done&&(i=y.return)&&i.call(y)}finally{if(r)throw r.error}}}if(o)throw new Fa(o)}},n.prototype.add=function(e){var t;if(e&&e!==this)if(this.closed)sg(e);else{if(e instanceof n){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}},n.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},n.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},n.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&Ar(t,e)},n.prototype.remove=function(e){var t=this._finalizers;t&&Ar(t,e),e instanceof n&&e._removeParent(this)},n.EMPTY=function(){var e=new n;return e.closed=!0,e}(),n}(),Dw=pn.EMPTY;function qw(n){return n instanceof pn||n&&"closed"in n&&Re(n.remove)&&Re(n.add)&&Re(n.unsubscribe)}function sg(n){Re(n)?n():n.unsubscribe()}var fi={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},wf={setTimeout:function(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];var i=wf.delegate;return i!=null&&i.setTimeout?i.setTimeout.apply(i,Qe([n,e],Ze(t))):setTimeout.apply(void 0,Qe([n,e],Ze(t)))},clearTimeout:function(n){return clearTimeout(n)},delegate:void 0};function Uw(n){wf.setTimeout(function(){var e=fi.onUnhandledError;if(e)e(n);else throw n})}function mt(){}var JB=function(){return kf("C",void 0,void 0)}();function YB(n){return kf("E",void 0,n)}function GB(n){return kf("N",n,void 0)}function kf(n,e,t){return{kind:n,value:e,error:t}}var Oi=null;function Va(n){if(fi.useDeprecatedSynchronousErrorHandling){var e=!Oi;if(e&&(Oi={errorThrown:!1,error:null}),n(),e){var t=Oi,r=t.errorThrown,i=t.error;if(Oi=null,r)throw i}}else n()}function XB(n){fi.useDeprecatedSynchronousErrorHandling&&Oi&&(Oi.errorThrown=!0,Oi.error=n)}var tl=function(n){wt(e,n);function e(t){var r=n.call(this)||this;return r.isStopped=!1,t?(r.destination=t,qw(t)&&t.add(r)):r.destination=tL,r}return e.create=function(t,r,i){return new fo(t,r,i)},e.prototype.next=function(t){this.isStopped?cu(GB(t),this):this._next(t)},e.prototype.error=function(t){this.isStopped?cu(YB(t),this):(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped?cu(JB,this):(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,n.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(pn),ZB=Function.prototype.bind;function au(n,e){return ZB.call(n,e)}var QB=function(){function n(e){this.partialObserver=e}return n.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(r){sa(r)}},n.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(r){sa(r)}else sa(e)},n.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(t){sa(t)}},n}(),fo=function(n){wt(e,n);function e(t,r,i){var o=n.call(this)||this,s;if(Re(t)||!t)s={next:t!=null?t:void 0,error:r!=null?r:void 0,complete:i!=null?i:void 0};else{var a;o&&fi.useDeprecatedNextContext?(a=Object.create(t),a.unsubscribe=function(){return o.unsubscribe()},s={next:t.next&&au(t.next,a),error:t.error&&au(t.error,a),complete:t.complete&&au(t.complete,a)}):s=t}return o.destination=new QB(s),o}return e}(tl);function sa(n){fi.useDeprecatedSynchronousErrorHandling?XB(n):Uw(n)}function eL(n){throw n}function cu(n,e){var t=fi.onStoppedNotification;t&&wf.setTimeout(function(){return t(n,e)})}var tL={closed:!0,next:mt,error:eL,complete:mt},nl=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Rt(n){return n}function xf(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return Mw(n)}function Mw(n){return n.length===0?Rt:n.length===1?n[0]:function(e){return n.reduce(function(t,r){return r(t)},e)}}var Fe=function(){function n(e){e&&(this._subscribe=e)}return n.prototype.lift=function(e){var t=new n;return t.source=this,t.operator=e,t},n.prototype.subscribe=function(e,t,r){var i=this,o=rL(e)?e:new fo(e,t,r);return Va(function(){var s=i,a=s.operator,c=s.source;o.add(a?a.call(o,c):c?i._subscribe(o):i._trySubscribe(o))}),o},n.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},n.prototype.forEach=function(e,t){var r=this;return t=ag(t),new t(function(i,o){var s=new fo({next:function(a){try{e(a)}catch(c){o(c),s.unsubscribe()}},error:o,complete:i});r.subscribe(s)})},n.prototype._subscribe=function(e){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(e)},n.prototype[nl]=function(){return this},n.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Mw(e)(this)},n.prototype.toPromise=function(e){var t=this;return e=ag(e),new e(function(r,i){var o;t.subscribe(function(s){return o=s},function(s){return i(s)},function(){return r(o)})})},n.create=function(e){return new n(e)},n}();function ag(n){var e;return(e=n!=null?n:fi.Promise)!==null&&e!==void 0?e:Promise}function nL(n){return n&&Re(n.next)&&Re(n.error)&&Re(n.complete)}function rL(n){return n&&n instanceof tl||nL(n)&&qw(n)}function Fw(n){return Re(n==null?void 0:n.lift)}function be(n){return function(e){if(Fw(e))return e.lift(function(t){try{return n(t,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function fe(n,e,t,r,i){return new Ef(n,e,t,r,i)}var Ef=function(n){wt(e,n);function e(t,r,i,o,s,a){var c=n.call(this,t)||this;return c.onFinalize=s,c.shouldUnsubscribe=a,c._next=r?function(l){try{r(l)}catch(u){t.error(u)}}:n.prototype._next,c._error=o?function(l){try{o(l)}catch(u){t.error(u)}finally{this.unsubscribe()}}:n.prototype._error,c._complete=i?function(){try{i()}catch(l){t.error(l)}finally{this.unsubscribe()}}:n.prototype._complete,c}return e.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;n.prototype.unsubscribe.call(this),!r&&((t=this.onFinalize)===null||t===void 0||t.call(this))}},e}(tl);function Vw(){return be(function(n,e){var t=null;n._refCount++;var r=fe(e,void 0,void 0,void 0,function(){if(!n||n._refCount<=0||0<--n._refCount){t=null;return}var i=n._connection,o=t;t=null,i&&(!o||i===o)&&i.unsubscribe(),e.unsubscribe()});n.subscribe(r),r.closed||(t=n.connect())})}var rl=function(n){wt(e,n);function e(t,r){var i=n.call(this)||this;return i.source=t,i.subjectFactory=r,i._subject=null,i._refCount=0,i._connection=null,Fw(t)&&(i.lift=t.lift),i}return e.prototype._subscribe=function(t){return this.getSubject().subscribe(t)},e.prototype.getSubject=function(){var t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject},e.prototype._teardown=function(){this._refCount=0;var t=this._connection;this._subject=this._connection=null,t==null||t.unsubscribe()},e.prototype.connect=function(){var t=this,r=this._connection;if(!r){r=this._connection=new pn;var i=this.getSubject();r.add(this.source.subscribe(fe(i,void 0,function(){t._teardown(),i.complete()},function(o){t._teardown(),i.error(o)},function(){return t._teardown()}))),r.closed&&(this._connection=null,r=pn.EMPTY)}return r},e.prototype.refCount=function(){return Vw()(this)},e}(Fe),Kw={now:function(){return(Kw.delegate||performance).now()},delegate:void 0},ps={schedule:function(n){var e=requestAnimationFrame,t=cancelAnimationFrame,r=e(function(i){t=void 0,n(i)});return new pn(function(){return t==null?void 0:t(r)})},requestAnimationFrame:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=ps.delegate;return((t==null?void 0:t.requestAnimationFrame)||requestAnimationFrame).apply(void 0,Qe([],Ze(n)))},cancelAnimationFrame:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return cancelAnimationFrame.apply(void 0,Qe([],Ze(n)))},delegate:void 0};function iL(n){return n?Ww(n):oL}function Ww(n){return new Fe(function(e){var t=n||Kw,r=t.now(),i=0,o=function(){e.closed||(i=ps.requestAnimationFrame(function(s){i=0;var a=t.now();e.next({timestamp:n?a:s,elapsed:a-r}),o()}))};return o(),function(){i&&ps.cancelAnimationFrame(i)}})}var oL=Ww(),zw=Ui(function(n){return function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),Ot=function(n){wt(e,n);function e(){var t=n.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return e.prototype.lift=function(t){var r=new cg(this,this);return r.operator=t,r},e.prototype._throwIfClosed=function(){if(this.closed)throw new zw},e.prototype.next=function(t){var r=this;Va(function(){var i,o;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var s=un(r.currentObservers),a=s.next();!a.done;a=s.next()){var c=a.value;c.next(t)}}catch(l){i={error:l}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}}})},e.prototype.error=function(t){var r=this;Va(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=t;for(var i=r.observers;i.length;)i.shift().error(t)}})},e.prototype.complete=function(){var t=this;Va(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var r=t.observers;r.length;)r.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(t){return this._throwIfClosed(),n.prototype._trySubscribe.call(this,t)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var r=this,i=this,o=i.hasError,s=i.isStopped,a=i.observers;return o||s?Dw:(this.currentObservers=null,a.push(t),new pn(function(){r.currentObservers=null,Ar(a,t)}))},e.prototype._checkFinalizedStatuses=function(t){var r=this,i=r.hasError,o=r.thrownError,s=r.isStopped;i?t.error(o):s&&t.complete()},e.prototype.asObservable=function(){var t=new Fe;return t.source=this,t},e.create=function(t,r){return new cg(t,r)},e}(Fe),cg=function(n){wt(e,n);function e(t,r){var i=n.call(this)||this;return i.destination=t,i.source=r,i}return e.prototype.next=function(t){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.next)===null||i===void 0||i.call(r,t)},e.prototype.error=function(t){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.error)===null||i===void 0||i.call(r,t)},e.prototype.complete=function(){var t,r;(r=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||r===void 0||r.call(t)},e.prototype._subscribe=function(t){var r,i;return(i=(r=this.source)===null||r===void 0?void 0:r.subscribe(t))!==null&&i!==void 0?i:Dw},e}(Ot),Hw=function(n){wt(e,n);function e(t){var r=n.call(this)||this;return r._value=t,r}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(t){var r=n.prototype._subscribe.call(this,t);return!r.closed&&t.next(this._value),r},e.prototype.getValue=function(){var t=this,r=t.hasError,i=t.thrownError,o=t._value;if(r)throw i;return this._throwIfClosed(),o},e.prototype.next=function(t){n.prototype.next.call(this,this._value=t)},e}(Ot),il={now:function(){return(il.delegate||Date).now()},delegate:void 0},_f=function(n){wt(e,n);function e(t,r,i){t===void 0&&(t=1/0),r===void 0&&(r=1/0),i===void 0&&(i=il);var o=n.call(this)||this;return o._bufferSize=t,o._windowTime=r,o._timestampProvider=i,o._buffer=[],o._infiniteTimeWindow=!0,o._infiniteTimeWindow=r===1/0,o._bufferSize=Math.max(1,t),o._windowTime=Math.max(1,r),o}return e.prototype.next=function(t){var r=this,i=r.isStopped,o=r._buffer,s=r._infiniteTimeWindow,a=r._timestampProvider,c=r._windowTime;i||(o.push(t),!s&&o.push(a.now()+c)),this._trimBuffer(),n.prototype.next.call(this,t)},e.prototype._subscribe=function(t){this._throwIfClosed(),this._trimBuffer();for(var r=this._innerSubscribe(t),i=this,o=i._infiniteTimeWindow,s=i._buffer,a=s.slice(),c=0;c<a.length&&!t.closed;c+=o?1:2)t.next(a[c]);return this._checkFinalizedStatuses(t),r},e.prototype._trimBuffer=function(){var t=this,r=t._bufferSize,i=t._timestampProvider,o=t._buffer,s=t._infiniteTimeWindow,a=(s?1:2)*r;if(r<1/0&&a<o.length&&o.splice(0,o.length-a),!s){for(var c=i.now(),l=0,u=1;u<o.length&&o[u]<=c;u+=2)l=u;l&&o.splice(0,l+1)}},e}(Ot),$f=function(n){wt(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t._value=null,t._hasValue=!1,t._isComplete=!1,t}return e.prototype._checkFinalizedStatuses=function(t){var r=this,i=r.hasError,o=r._hasValue,s=r._value,a=r.thrownError,c=r.isStopped,l=r._isComplete;i?t.error(a):(c||l)&&(o&&t.next(s),t.complete())},e.prototype.next=function(t){this.isStopped||(this._value=t,this._hasValue=!0)},e.prototype.complete=function(){var t=this,r=t._hasValue,i=t._value,o=t._isComplete;o||(this._isComplete=!0,r&&n.prototype.next.call(this,i),n.prototype.complete.call(this))},e}(Ot),sL=function(n){wt(e,n);function e(t,r){return n.call(this)||this}return e.prototype.schedule=function(t,r){return this},e}(pn),Th={setInterval:function(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];var i=Th.delegate;return i!=null&&i.setInterval?i.setInterval.apply(i,Qe([n,e],Ze(t))):setInterval.apply(void 0,Qe([n,e],Ze(t)))},clearInterval:function(n){return clearInterval(n)},delegate:void 0},Ns=function(n){wt(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.scheduler=t,i.work=r,i.pending=!1,i}return e.prototype.schedule=function(t,r){var i;if(r===void 0&&(r=0),this.closed)return this;this.state=t;var o=this.id,s=this.scheduler;return o!=null&&(this.id=this.recycleAsyncId(s,o,r)),this.pending=!0,this.delay=r,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(s,this.id,r),this},e.prototype.requestAsyncId=function(t,r,i){return i===void 0&&(i=0),Th.setInterval(t.flush.bind(t,this),i)},e.prototype.recycleAsyncId=function(t,r,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return r;r!=null&&Th.clearInterval(r)},e.prototype.execute=function(t,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(t,r);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,r){var i=!1,o;try{this.work(t)}catch(s){i=!0,o=s||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),o},e.prototype.unsubscribe=function(){if(!this.closed){var t=this,r=t.id,i=t.scheduler,o=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,Ar(o,this),r!=null&&(this.id=this.recycleAsyncId(i,r,null)),this.delay=null,n.prototype.unsubscribe.call(this)}},e}(sL),aL=1,lu,Ph={};function lg(n){return n in Ph?(delete Ph[n],!0):!1}var Jw={setImmediate:function(n){var e=aL++;return Ph[e]=!0,lu||(lu=Promise.resolve()),lu.then(function(){return lg(e)&&n()}),e},clearImmediate:function(n){lg(n)}},cL=Jw.setImmediate,lL=Jw.clearImmediate,jh={setImmediate:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=jh.delegate;return((t==null?void 0:t.setImmediate)||cL).apply(void 0,Qe([],Ze(n)))},clearImmediate:function(n){return lL(n)},delegate:void 0},uL=function(n){wt(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.scheduler=t,i.work=r,i}return e.prototype.requestAsyncId=function(t,r,i){return i===void 0&&(i=0),i!==null&&i>0?n.prototype.requestAsyncId.call(this,t,r,i):(t.actions.push(this),t._scheduled||(t._scheduled=jh.setImmediate(t.flush.bind(t,void 0))))},e.prototype.recycleAsyncId=function(t,r,i){var o;if(i===void 0&&(i=0),i!=null?i>0:this.delay>0)return n.prototype.recycleAsyncId.call(this,t,r,i);var s=t.actions;r!=null&&((o=s[s.length-1])===null||o===void 0?void 0:o.id)!==r&&(jh.clearImmediate(r),t._scheduled===r&&(t._scheduled=void 0))},e}(Ns),Rh=function(){function n(e,t){t===void 0&&(t=n.now),this.schedulerActionCtor=e,this.now=t}return n.prototype.schedule=function(e,t,r){return t===void 0&&(t=0),new this.schedulerActionCtor(this,e).schedule(r,t)},n.now=il.now,n}(),Bs=function(n){wt(e,n);function e(t,r){r===void 0&&(r=Rh.now);var i=n.call(this,t,r)||this;return i.actions=[],i._active=!1,i}return e.prototype.flush=function(t){var r=this.actions;if(this._active){r.push(t);return}var i;this._active=!0;do if(i=t.execute(t.state,t.delay))break;while(t=r.shift());if(this._active=!1,i){for(;t=r.shift();)t.unsubscribe();throw i}},e}(Rh),hL=function(n){wt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.flush=function(t){this._active=!0;var r=this._scheduled;this._scheduled=void 0;var i=this.actions,o;t=t||i.shift();do if(o=t.execute(t.state,t.delay))break;while((t=i[0])&&t.id===r&&i.shift());if(this._active=!1,o){for(;(t=i[0])&&t.id===r&&i.shift();)t.unsubscribe();throw o}},e}(Bs),Yw=new hL(uL),dL=Yw,Dn=new Bs(Ns),Of=Dn,fL=function(n){wt(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.scheduler=t,i.work=r,i}return e.prototype.schedule=function(t,r){return r===void 0&&(r=0),r>0?n.prototype.schedule.call(this,t,r):(this.delay=r,this.state=t,this.scheduler.flush(this),this)},e.prototype.execute=function(t,r){return r>0||this.closed?n.prototype.execute.call(this,t,r):this._execute(t,r)},e.prototype.requestAsyncId=function(t,r,i){return i===void 0&&(i=0),i!=null&&i>0||i==null&&this.delay>0?n.prototype.requestAsyncId.call(this,t,r,i):(t.flush(this),0)},e}(Ns),pL=function(n){wt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e}(Bs),Gw=new pL(fL),yL=Gw,gL=function(n){wt(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.scheduler=t,i.work=r,i}return e.prototype.requestAsyncId=function(t,r,i){return i===void 0&&(i=0),i!==null&&i>0?n.prototype.requestAsyncId.call(this,t,r,i):(t.actions.push(this),t._scheduled||(t._scheduled=ps.requestAnimationFrame(function(){return t.flush(void 0)})))},e.prototype.recycleAsyncId=function(t,r,i){var o;if(i===void 0&&(i=0),i!=null?i>0:this.delay>0)return n.prototype.recycleAsyncId.call(this,t,r,i);var s=t.actions;r!=null&&((o=s[s.length-1])===null||o===void 0?void 0:o.id)!==r&&(ps.cancelAnimationFrame(r),t._scheduled=void 0)},e}(Ns),mL=function(n){wt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.flush=function(t){this._active=!0;var r=this._scheduled;this._scheduled=void 0;var i=this.actions,o;t=t||i.shift();do if(o=t.execute(t.state,t.delay))break;while((t=i[0])&&t.id===r&&i.shift());if(this._active=!1,o){for(;(t=i[0])&&t.id===r&&i.shift();)t.unsubscribe();throw o}},e}(Bs),Xw=new mL(gL),vL=Xw,bL=function(n){wt(e,n);function e(t,r){t===void 0&&(t=Zw),r===void 0&&(r=1/0);var i=n.call(this,t,function(){return i.frame})||this;return i.maxFrames=r,i.frame=0,i.index=-1,i}return e.prototype.flush=function(){for(var t=this,r=t.actions,i=t.maxFrames,o,s;(s=r[0])&&s.delay<=i&&(r.shift(),this.frame=s.delay,!(o=s.execute(s.state,s.delay))););if(o){for(;s=r.shift();)s.unsubscribe();throw o}},e.frameTimeFactor=10,e}(Bs),Zw=function(n){wt(e,n);function e(t,r,i){i===void 0&&(i=t.index+=1);var o=n.call(this,t,r)||this;return o.scheduler=t,o.work=r,o.index=i,o.active=!0,o.index=t.index=i,o}return e.prototype.schedule=function(t,r){if(r===void 0&&(r=0),Number.isFinite(r)){if(!this.id)return n.prototype.schedule.call(this,t,r);this.active=!1;var i=new e(this.scheduler,this.work);return this.add(i),i.schedule(t,r)}else return pn.EMPTY},e.prototype.requestAsyncId=function(t,r,i){i===void 0&&(i=0),this.delay=t.frame+i;var o=t.actions;return o.push(this),o.sort(e.sortActions),1},e.prototype.recycleAsyncId=function(t,r,i){},e.prototype._execute=function(t,r){if(this.active===!0)return n.prototype._execute.call(this,t,r)},e.sortActions=function(t,r){return t.delay===r.delay?t.index===r.index?0:t.index>r.index?1:-1:t.delay>r.delay?1:-1},e}(Ns),vr=new Fe(function(n){return n.complete()});function wL(n){return n?kL(n):vr}function kL(n){return new Fe(function(e){return n.schedule(function(){return e.complete()})})}function ol(n){return n&&Re(n.schedule)}function Af(n){return n[n.length-1]}function Ls(n){return Re(Af(n))?n.pop():void 0}function Rr(n){return ol(Af(n))?n.pop():void 0}function Qw(n,e){return typeof Af(n)=="number"?n.pop():e}var Sf=function(n){return n&&typeof n.length=="number"&&typeof n!="function"};function e1(n){return Re(n==null?void 0:n.then)}function t1(n){return Re(n[nl])}function n1(n){return Symbol.asyncIterator&&Re(n==null?void 0:n[Symbol.asyncIterator])}function r1(n){return new TypeError("You provided "+(n!==null&&typeof n=="object"?"an invalid object":"'"+n+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function xL(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var i1=xL();function o1(n){return Re(n==null?void 0:n[i1])}function s1(n){return zB(this,arguments,function(){var e,t,r,i;return bf(this,function(o){switch(o.label){case 0:e=n.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,ro(e.read())];case 3:return t=o.sent(),r=t.value,i=t.done,i?[4,ro(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,ro(r)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function a1(n){return Re(n==null?void 0:n.getReader)}function Oe(n){if(n instanceof Fe)return n;if(n!=null){if(t1(n))return EL(n);if(Sf(n))return _L(n);if(e1(n))return $L(n);if(n1(n))return c1(n);if(o1(n))return OL(n);if(a1(n))return AL(n)}throw r1(n)}function EL(n){return new Fe(function(e){var t=n[nl]();if(Re(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function _L(n){return new Fe(function(e){for(var t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}function $L(n){return new Fe(function(e){n.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,Uw)})}function OL(n){return new Fe(function(e){var t,r;try{for(var i=un(n),o=i.next();!o.done;o=i.next()){var s=o.value;if(e.next(s),e.closed)return}}catch(a){t={error:a}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}e.complete()})}function c1(n){return new Fe(function(e){SL(n,e).catch(function(t){return e.error(t)})})}function AL(n){return c1(s1(n))}function SL(n,e){var t,r,i,o;return WB(this,void 0,void 0,function(){var s,a;return bf(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),t=HB(n),c.label=1;case 1:return[4,t.next()];case 2:if(r=c.sent(),!!r.done)return[3,4];if(s=r.value,e.next(s),e.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),i={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),r&&!r.done&&(o=t.return)?[4,o.call(t)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function hn(n,e,t,r,i){r===void 0&&(r=0),i===void 0&&(i=!1);var o=e.schedule(function(){t(),i?n.add(this.schedule(null,r)):this.unsubscribe()},r);if(n.add(o),!i)return o}function sl(n,e){return e===void 0&&(e=0),be(function(t,r){t.subscribe(fe(r,function(i){return hn(r,n,function(){return r.next(i)},e)},function(){return hn(r,n,function(){return r.complete()},e)},function(i){return hn(r,n,function(){return r.error(i)},e)}))})}function al(n,e){return e===void 0&&(e=0),be(function(t,r){r.add(n.schedule(function(){return t.subscribe(r)},e))})}function TL(n,e){return Oe(n).pipe(al(e),sl(e))}function PL(n,e){return Oe(n).pipe(al(e),sl(e))}function jL(n,e){return new Fe(function(t){var r=0;return e.schedule(function(){r===n.length?t.complete():(t.next(n[r++]),t.closed||this.schedule())})})}function l1(n,e){return new Fe(function(t){var r;return hn(t,e,function(){r=n[i1](),hn(t,e,function(){var i,o,s;try{i=r.next(),o=i.value,s=i.done}catch(a){t.error(a);return}s?t.complete():t.next(o)},0,!0)}),function(){return Re(r==null?void 0:r.return)&&r.return()}})}function u1(n,e){if(!n)throw new Error("Iterable cannot be null");return new Fe(function(t){hn(t,e,function(){var r=n[Symbol.asyncIterator]();hn(t,e,function(){r.next().then(function(i){i.done?t.complete():t.next(i.value)})},0,!0)})})}function RL(n,e){return u1(s1(n),e)}function h1(n,e){if(n!=null){if(t1(n))return TL(n,e);if(Sf(n))return jL(n,e);if(e1(n))return PL(n,e);if(n1(n))return u1(n,e);if(o1(n))return l1(n,e);if(a1(n))return RL(n,e)}throw r1(n)}function Ir(n,e){return e?h1(n,e):Oe(n)}function Tf(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Rr(n);return Ir(n,t)}function d1(n,e){var t=Re(n)?n:function(){return n},r=function(i){return i.error(t())};return new Fe(e?function(i){return e.schedule(r,0,i)}:r)}var Ih;(function(n){n.NEXT="N",n.ERROR="E",n.COMPLETE="C"})(Ih||(Ih={}));var Ka=function(){function n(e,t,r){this.kind=e,this.value=t,this.error=r,this.hasValue=e==="N"}return n.prototype.observe=function(e){return f1(this,e)},n.prototype.do=function(e,t,r){var i=this,o=i.kind,s=i.value,a=i.error;return o==="N"?e==null?void 0:e(s):o==="E"?t==null?void 0:t(a):r==null?void 0:r()},n.prototype.accept=function(e,t,r){var i;return Re((i=e)===null||i===void 0?void 0:i.next)?this.observe(e):this.do(e,t,r)},n.prototype.toObservable=function(){var e=this,t=e.kind,r=e.value,i=e.error,o=t==="N"?Tf(r):t==="E"?d1(function(){return i}):t==="C"?vr:0;if(!o)throw new TypeError("Unexpected notification kind "+t);return o},n.createNext=function(e){return new n("N",e)},n.createError=function(e){return new n("E",void 0,e)},n.createComplete=function(){return n.completeNotification},n.completeNotification=new n("C"),n}();function f1(n,e){var t,r,i,o=n,s=o.kind,a=o.value,c=o.error;if(typeof s!="string")throw new TypeError('Invalid notification, missing "kind"');s==="N"?(t=e.next)===null||t===void 0||t.call(e,a):s==="E"?(r=e.error)===null||r===void 0||r.call(e,c):(i=e.complete)===null||i===void 0||i.call(e)}function IL(n){return!!n&&(n instanceof Fe||Re(n.lift)&&Re(n.subscribe))}var Mi=Ui(function(n){return function(){n(this),this.name="EmptyError",this.message="no elements in sequence"}});function CL(n,e){var t=typeof e=="object";return new Promise(function(r,i){var o=!1,s;n.subscribe({next:function(a){s=a,o=!0},error:i,complete:function(){o?r(s):t?r(e.defaultValue):i(new Mi)}})})}function NL(n,e){var t=typeof e=="object";return new Promise(function(r,i){var o=new fo({next:function(s){r(s),o.unsubscribe()},error:i,complete:function(){t?r(e.defaultValue):i(new Mi)}});n.subscribe(o)})}var Ch=Ui(function(n){return function(){n(this),this.name="ArgumentOutOfRangeError",this.message="argument out of range"}}),p1=Ui(function(n){return function(e){n(this),this.name="NotFoundError",this.message=e}}),y1=Ui(function(n){return function(e){n(this),this.name="SequenceError",this.message=e}});function Pf(n){return n instanceof Date&&!isNaN(n)}var g1=Ui(function(n){return function(e){e===void 0&&(e=null),n(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=e}});function m1(n,e){var t=Pf(n)?{first:n}:typeof n=="number"?{each:n}:n,r=t.first,i=t.each,o=t.with,s=o===void 0?BL:o,a=t.scheduler,c=a===void 0?e!=null?e:Dn:a,l=t.meta,u=l===void 0?null:l;if(r==null&&i==null)throw new TypeError("No timeout provided.");return be(function(h,y){var d,f,g=null,_=0,A=function(P){f=hn(y,c,function(){try{d.unsubscribe(),Oe(s({meta:u,lastValue:g,seen:_})).subscribe(y)}catch(B){y.error(B)}},P)};d=h.subscribe(fe(y,function(P){f==null||f.unsubscribe(),_++,y.next(g=P),i>0&&A(i)},void 0,void 0,function(){f!=null&&f.closed||f==null||f.unsubscribe(),g=null})),!_&&A(r!=null?typeof r=="number"?r:+r-c.now():i)})}function BL(n){throw new g1(n)}function Fi(n,e){return be(function(t,r){var i=0;t.subscribe(fe(r,function(o){r.next(n.call(e,o,i++))}))})}var LL=Array.isArray;function DL(n,e){return LL(e)?n.apply(void 0,Qe([],Ze(e))):n(e)}function Vi(n){return Fi(function(e){return DL(n,e)})}function cc(n,e,t,r){if(t)if(ol(t))r=t;else return function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return cc(n,e,r).apply(this,i).pipe(Vi(t))};return r?function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return cc(n,e).apply(this,i).pipe(al(r),sl(r))}:function(){for(var i=this,o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];var a=new $f,c=!0;return new Fe(function(l){var u=a.subscribe(l);if(c){c=!1;var h=!1,y=!1;e.apply(i,Qe(Qe([],Ze(o)),[function(){for(var d=[],f=0;f<arguments.length;f++)d[f]=arguments[f];if(n){var g=d.shift();if(g!=null){a.error(g);return}}a.next(1<d.length?d:d[0]),y=!0,h&&a.complete()}])),y&&a.complete(),h=!0}return u})}}function qL(n,e,t){return cc(!1,n,e,t)}function UL(n,e,t){return cc(!0,n,e,t)}var ML=Array.isArray,FL=Object.getPrototypeOf,VL=Object.prototype,KL=Object.keys;function v1(n){if(n.length===1){var e=n[0];if(ML(e))return{args:e,keys:null};if(WL(e)){var t=KL(e);return{args:t.map(function(r){return e[r]}),keys:t}}}return{args:n,keys:null}}function WL(n){return n&&typeof n=="object"&&FL(n)===VL}function b1(n,e){return n.reduce(function(t,r,i){return t[r]=e[i],t},{})}function w1(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Rr(n),r=Ls(n),i=v1(n),o=i.args,s=i.keys;if(o.length===0)return Ir([],t);var a=new Fe(k1(o,t,s?function(c){return b1(s,c)}:Rt));return r?a.pipe(Vi(r)):a}function k1(n,e,t){return t===void 0&&(t=Rt),function(r){ug(e,function(){for(var i=n.length,o=new Array(i),s=i,a=i,c=function(u){ug(e,function(){var h=Ir(n[u],e),y=!1;h.subscribe(fe(r,function(d){o[u]=d,y||(y=!0,a--),a||r.next(t(o.slice()))},function(){--s||r.complete()}))},r)},l=0;l<i;l++)c(l)},r)}}function ug(n,e,t){n?hn(t,n,e):e()}function jf(n,e,t,r,i,o,s,a){var c=[],l=0,u=0,h=!1,y=function(){h&&!c.length&&!l&&e.complete()},d=function(g){return l<r?f(g):c.push(g)},f=function(g){o&&e.next(g),l++;var _=!1;Oe(t(g,u++)).subscribe(fe(e,function(A){i==null||i(A),o?d(A):e.next(A)},function(){_=!0},void 0,function(){if(_)try{l--;for(var A=function(){var P=c.shift();s?hn(e,s,function(){return f(P)}):f(P)};c.length&&l<r;)A();y()}catch(P){e.error(P)}}))};return n.subscribe(fe(e,d,function(){h=!0,y()})),function(){a==null||a()}}function Zn(n,e,t){return t===void 0&&(t=1/0),Re(e)?Zn(function(r,i){return Fi(function(o,s){return e(r,o,i,s)})(Oe(n(r,i)))},t):(typeof e=="number"&&(t=e),be(function(r,i){return jf(r,i,n,t)}))}function cl(n){return n===void 0&&(n=1/0),Zn(Rt,n)}function Rf(){return cl(1)}function ys(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return Rf()(Ir(n,Rr(n)))}function ll(n){return new Fe(function(e){Oe(n()).subscribe(e)})}var zL={connector:function(){return new Ot},resetOnDisconnect:!0};function HL(n,e){e===void 0&&(e=zL);var t=null,r=e.connector,i=e.resetOnDisconnect,o=i===void 0?!0:i,s=r(),a=new Fe(function(c){return s.subscribe(c)});return a.connect=function(){return(!t||t.closed)&&(t=ll(function(){return n}).subscribe(s),o&&t.add(function(){return s=r()})),t},a}function JL(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Ls(n),r=v1(n),i=r.args,o=r.keys,s=new Fe(function(a){var c=i.length;if(!c){a.complete();return}for(var l=new Array(c),u=c,h=c,y=function(f){var g=!1;Oe(i[f]).subscribe(fe(a,function(_){g||(g=!0,h--),l[f]=_},function(){return u--},void 0,function(){(!u||!g)&&(h||a.next(o?b1(o,l):l),a.complete())}))},d=0;d<c;d++)y(d)});return t?s.pipe(Vi(t)):s}var YL=["addListener","removeListener"],GL=["addEventListener","removeEventListener"],XL=["on","off"];function Nh(n,e,t,r){if(Re(t)&&(r=t,t=void 0),r)return Nh(n,e,t).pipe(Vi(r));var i=Ze(eD(n)?GL.map(function(a){return function(c){return n[a](e,c,t)}}):ZL(n)?YL.map(hg(n,e)):QL(n)?XL.map(hg(n,e)):[],2),o=i[0],s=i[1];if(!o&&Sf(n))return Zn(function(a){return Nh(a,e,t)})(Oe(n));if(!o)throw new TypeError("Invalid event target");return new Fe(function(a){var c=function(){for(var l=[],u=0;u<arguments.length;u++)l[u]=arguments[u];return a.next(1<l.length?l:l[0])};return o(c),function(){return s(c)}})}function hg(n,e){return function(t){return function(r){return n[t](e,r)}}}function ZL(n){return Re(n.addListener)&&Re(n.removeListener)}function QL(n){return Re(n.on)&&Re(n.off)}function eD(n){return Re(n.addEventListener)&&Re(n.removeEventListener)}function x1(n,e,t){return t?x1(n,e).pipe(Vi(t)):new Fe(function(r){var i=function(){for(var s=[],a=0;a<arguments.length;a++)s[a]=arguments[a];return r.next(s.length===1?s[0]:s)},o=n(i);return Re(e)?function(){return e(i,o)}:void 0})}function tD(n,e,t,r,i){var o,s,a,c;arguments.length===1?(o=n,c=o.initialState,e=o.condition,t=o.iterate,s=o.resultSelector,a=s===void 0?Rt:s,i=o.scheduler):(c=n,!r||ol(r)?(a=Rt,i=r):a=r);function l(){var u;return bf(this,function(h){switch(h.label){case 0:u=c,h.label=1;case 1:return!e||e(u)?[4,a(u)]:[3,4];case 2:h.sent(),h.label=3;case 3:return u=t(u),[3,1];case 4:return[2]}})}return ll(i?function(){return l1(l(),i)}:l)}function nD(n,e,t){return ll(function(){return n()?e:t})}function Ki(n,e,t){n===void 0&&(n=0),t===void 0&&(t=Of);var r=-1;return e!=null&&(ol(e)?t=e:r=e),new Fe(function(i){var o=Pf(n)?+n-t.now():n;o<0&&(o=0);var s=0;return t.schedule(function(){i.closed||(i.next(s++),0<=r?this.schedule(void 0,r):i.complete())},o)})}function E1(n,e){return n===void 0&&(n=0),e===void 0&&(e=Dn),n<0&&(n=0),Ki(n,n,e)}function rD(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Rr(n),r=Qw(n,1/0),i=n;return i.length?i.length===1?Oe(i[0]):cl(r)(Ir(i,t)):vr}var _1=new Fe(mt);function iD(){return _1}var oD=Array.isArray;function xo(n){return n.length===1&&oD(n[0])?n[0]:n}function $1(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=xo(n);return new Fe(function(r){var i=0,o=function(){if(i<t.length){var s=void 0;try{s=Oe(t[i++])}catch(c){o();return}var a=new Ef(r,void 0,mt,mt);s.subscribe(a),a.add(o)}else r.complete()};o()})}function sD(n,e){return Ir(Object.entries(n),e)}function aD(n,e){return function(t,r){return!n.call(e,t,r)}}function Ti(n,e){return be(function(t,r){var i=0;t.subscribe(fe(r,function(o){return n.call(e,o,i++)&&r.next(o)}))})}function cD(n,e,t){return[Ti(e,t)(Oe(n)),Ti(aD(e,t))(Oe(n))]}function lD(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return n=xo(n),n.length===1?Oe(n[0]):new Fe(O1(n))}function O1(n){return function(e){for(var t=[],r=function(o){t.push(Oe(n[o]).subscribe(fe(e,function(s){if(t){for(var a=0;a<t.length;a++)a!==o&&t[a].unsubscribe();t=null}e.next(s)})))},i=0;t&&!e.closed&&i<n.length;i++)r(i)}}function uD(n,e,t){if(e==null&&(e=n,n=0),e<=0)return vr;var r=e+n;return new Fe(t?function(i){var o=n;return t.schedule(function(){o<r?(i.next(o++),this.schedule()):i.complete()})}:function(i){for(var o=n;o<r&&!i.closed;)i.next(o++);i.complete()})}function hD(n,e){return new Fe(function(t){var r=n(),i=e(r),o=i?Oe(i):vr;return o.subscribe(t),function(){r&&r.unsubscribe()}})}function If(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Ls(n),r=xo(n);return r.length?new Fe(function(i){var o=r.map(function(){return[]}),s=r.map(function(){return!1});i.add(function(){o=s=null});for(var a=function(l){Oe(r[l]).subscribe(fe(i,function(u){if(o[l].push(u),o.every(function(y){return y.length})){var h=o.map(function(y){return y.shift()});i.next(t?t.apply(void 0,Qe([],Ze(h))):h),o.some(function(y,d){return!y.length&&s[d]})&&i.complete()}},function(){s[l]=!0,!o[l].length&&i.complete()}))},c=0;!i.closed&&c<r.length;c++)a(c);return function(){o=s=null}}):vr}function A1(n){return be(function(e,t){var r=!1,i=null,o=null,s=!1,a=function(){if(o==null||o.unsubscribe(),o=null,r){r=!1;var l=i;i=null,t.next(l)}s&&t.complete()},c=function(){o=null,s&&t.complete()};e.subscribe(fe(t,function(l){r=!0,i=l,o||Oe(n(l)).subscribe(o=fe(t,a,c))},function(){s=!0,(!r||!o||o.closed)&&t.complete()}))})}function dD(n,e){return e===void 0&&(e=Dn),A1(function(){return Ki(n,e)})}function fD(n){return be(function(e,t){var r=[];return e.subscribe(fe(t,function(i){return r.push(i)},function(){t.next(r),t.complete()})),Oe(n).subscribe(fe(t,function(){var i=r;r=[],t.next(i)},mt)),function(){r=null}})}function pD(n,e){return e===void 0&&(e=null),e=e!=null?e:n,be(function(t,r){var i=[],o=0;t.subscribe(fe(r,function(s){var a,c,l,u,h=null;o++%e===0&&i.push([]);try{for(var y=un(i),d=y.next();!d.done;d=y.next()){var f=d.value;f.push(s),n<=f.length&&(h=h!=null?h:[],h.push(f))}}catch(A){a={error:A}}finally{try{d&&!d.done&&(c=y.return)&&c.call(y)}finally{if(a)throw a.error}}if(h)try{for(var g=un(h),_=g.next();!_.done;_=g.next()){var f=_.value;Ar(i,f),r.next(f)}}catch(A){l={error:A}}finally{try{_&&!_.done&&(u=g.return)&&u.call(g)}finally{if(l)throw l.error}}},function(){var s,a;try{for(var c=un(i),l=c.next();!l.done;l=c.next()){var u=l.value;r.next(u)}}catch(h){s={error:h}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(s)throw s.error}}r.complete()},void 0,function(){i=null}))})}function yD(n){for(var e,t,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];var o=(e=Rr(r))!==null&&e!==void 0?e:Dn,s=(t=r[0])!==null&&t!==void 0?t:null,a=r[1]||1/0;return be(function(c,l){var u=[],h=!1,y=function(g){var _=g.buffer,A=g.subs;A.unsubscribe(),Ar(u,g),l.next(_),h&&d()},d=function(){if(u){var g=new pn;l.add(g);var _=[],A={buffer:_,subs:g};u.push(A),hn(g,o,function(){return y(A)},n)}};s!==null&&s>=0?hn(l,o,d,s,!0):h=!0,d();var f=fe(l,function(g){var _,A,P=u.slice();try{for(var B=un(P),C=B.next();!C.done;C=B.next()){var L=C.value,q=L.buffer;q.push(g),a<=q.length&&y(L)}}catch(H){_={error:H}}finally{try{C&&!C.done&&(A=B.return)&&A.call(B)}finally{if(_)throw _.error}}},function(){for(;u!=null&&u.length;)l.next(u.shift().buffer);f==null||f.unsubscribe(),l.complete(),l.unsubscribe()},void 0,function(){return u=null});c.subscribe(f)})}function gD(n,e){return be(function(t,r){var i=[];Oe(n).subscribe(fe(r,function(o){var s=[];i.push(s);var a=new pn,c=function(){Ar(i,s),r.next(s),a.unsubscribe()};a.add(Oe(e(o)).subscribe(fe(r,c,mt)))},mt)),t.subscribe(fe(r,function(o){var s,a;try{for(var c=un(i),l=c.next();!l.done;l=c.next()){var u=l.value;u.push(o)}}catch(h){s={error:h}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(s)throw s.error}}},function(){for(;i.length>0;)r.next(i.shift());r.complete()}))})}function mD(n){return be(function(e,t){var r=null,i=null,o=function(){i==null||i.unsubscribe();var s=r;r=[],s&&t.next(s),Oe(n()).subscribe(i=fe(t,o,mt))};o(),e.subscribe(fe(t,function(s){return r==null?void 0:r.push(s)},function(){r&&t.next(r),t.complete()},void 0,function(){return r=i=null}))})}function S1(n){return be(function(e,t){var r=null,i=!1,o;r=e.subscribe(fe(t,void 0,void 0,function(s){o=Oe(n(s,S1(n)(e))),r?(r.unsubscribe(),r=null,o.subscribe(t)):i=!0})),i&&(r.unsubscribe(),r=null,o.subscribe(t))})}function T1(n,e,t,r,i){return function(o,s){var a=t,c=e,l=0;o.subscribe(fe(s,function(u){var h=l++;c=a?n(c,u,h):(a=!0,u),r&&s.next(c)},i&&function(){a&&s.next(c),s.complete()}))}}function Ds(n,e){return be(T1(n,e,arguments.length>=2,!1,!0))}var vD=function(n,e){return n.push(e),n};function P1(){return be(function(n,e){Ds(vD,[])(n).subscribe(e)})}function j1(n,e){return xf(P1(),Zn(function(t){return n(t)}),e?Vi(e):Rt)}function R1(n){return j1(w1,n)}var bD=R1;function I1(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Ls(n);return t?xf(I1.apply(void 0,Qe([],Ze(n))),Vi(t)):be(function(r,i){k1(Qe([r],Ze(xo(n))))(i)})}function wD(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return I1.apply(void 0,Qe([],Ze(n)))}function Bh(n,e){return Re(e)?Zn(n,e,1):Zn(n,1)}function kD(n,e){return Re(e)?Bh(function(){return n},e):Bh(function(){return n})}function xD(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Rr(n);return be(function(r,i){Rf()(Ir(Qe([r],Ze(n)),t)).subscribe(i)})}function ED(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return xD.apply(void 0,Qe([],Ze(n)))}function _D(n){return new Fe(function(e){return n.subscribe(e)})}var $D={connector:function(){return new Ot}};function Cf(n,e){e===void 0&&(e=$D);var t=e.connector;return be(function(r,i){var o=t();Oe(n(_D(o))).subscribe(i),i.add(r.subscribe(o))})}function OD(n){return Ds(function(e,t,r){return!n||n(t,r)?e+1:e},0)}function AD(n){return be(function(e,t){var r=!1,i=null,o=null,s=function(){if(o==null||o.unsubscribe(),o=null,r){r=!1;var a=i;i=null,t.next(a)}};e.subscribe(fe(t,function(a){o==null||o.unsubscribe(),r=!0,i=a,o=fe(t,s,mt),Oe(n(a)).subscribe(o)},function(){s(),t.complete()},void 0,function(){i=o=null}))})}function SD(n,e){return e===void 0&&(e=Dn),be(function(t,r){var i=null,o=null,s=null,a=function(){if(i){i.unsubscribe(),i=null;var l=o;o=null,r.next(l)}};function c(){var l=s+n,u=e.now();if(u<l){i=this.schedule(void 0,l-u),r.add(i);return}a()}t.subscribe(fe(r,function(l){o=l,s=e.now(),i||(i=e.schedule(c,n),r.add(i))},function(){a(),r.complete()},void 0,function(){o=i=null}))})}function ul(n){return be(function(e,t){var r=!1;e.subscribe(fe(t,function(i){r=!0,t.next(i)},function(){r||t.next(n),t.complete()}))})}function gs(n){return n<=0?function(){return vr}:be(function(e,t){var r=0;e.subscribe(fe(t,function(i){++r<=n&&(t.next(i),n<=r&&t.complete())}))})}function C1(){return be(function(n,e){n.subscribe(fe(e,mt))})}function N1(n){return Fi(function(){return n})}function Nf(n,e){return e?function(t){return ys(e.pipe(gs(1),C1()),t.pipe(Nf(n)))}:Zn(function(t,r){return Oe(n(t,r)).pipe(gs(1),N1(t))})}function TD(n,e){e===void 0&&(e=Dn);var t=Ki(n,e);return Nf(function(){return t})}function PD(){return be(function(n,e){n.subscribe(fe(e,function(t){return f1(t,e)}))})}function jD(n,e){return be(function(t,r){var i=new Set;t.subscribe(fe(r,function(o){var s=n?n(o):o;i.has(s)||(i.add(s),r.next(o))})),e&&Oe(e).subscribe(fe(r,function(){return i.clear()},mt))})}function B1(n,e){return e===void 0&&(e=Rt),n=n!=null?n:RD,be(function(t,r){var i,o=!0;t.subscribe(fe(r,function(s){var a=e(s);(o||!n(i,a))&&(o=!1,i=a,r.next(s))}))})}function RD(n,e){return n===e}function ID(n,e){return B1(function(t,r){return e?e(t[n],r[n]):t[n]===r[n]})}function hl(n){return n===void 0&&(n=CD),be(function(e,t){var r=!1;e.subscribe(fe(t,function(i){r=!0,t.next(i)},function(){return r?t.complete():t.error(n())}))})}function CD(){return new Mi}function ND(n,e){if(n<0)throw new Ch;var t=arguments.length>=2;return function(r){return r.pipe(Ti(function(i,o){return o===n}),gs(1),t?ul(e):hl(function(){return new Ch}))}}function BD(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return function(t){return ys(t,Tf.apply(void 0,Qe([],Ze(n))))}}function LD(n,e){return be(function(t,r){var i=0;t.subscribe(fe(r,function(o){n.call(e,o,i++,t)||(r.next(!1),r.complete())},function(){r.next(!0),r.complete()}))})}function Bf(n,e){return e?function(t){return t.pipe(Bf(function(r,i){return Oe(n(r,i)).pipe(Fi(function(o,s){return e(r,o,i,s)}))}))}:be(function(t,r){var i=0,o=null,s=!1;t.subscribe(fe(r,function(a){o||(o=fe(r,void 0,function(){o=null,s&&r.complete()}),Oe(n(a,i++)).subscribe(o))},function(){s=!0,!o&&r.complete()}))})}function L1(){return Bf(Rt)}var DD=L1;function qD(n,e,t){return e===void 0&&(e=1/0),e=(e||0)<1?1/0:e,be(function(r,i){return jf(r,i,n,e,void 0,!0,t)})}function UD(n){return be(function(e,t){try{e.subscribe(t)}finally{t.add(n)}})}function MD(n,e){return be(D1(n,e,"value"))}function D1(n,e,t){var r=t==="index";return function(i,o){var s=0;i.subscribe(fe(o,function(a){var c=s++;n.call(e,a,c,i)&&(o.next(r?c:a),o.complete())},function(){o.next(r?-1:void 0),o.complete()}))}}function FD(n,e){return be(D1(n,e,"index"))}function VD(n,e){var t=arguments.length>=2;return function(r){return r.pipe(n?Ti(function(i,o){return n(i,o,r)}):Rt,gs(1),t?ul(e):hl(function(){return new Mi}))}}function KD(n,e,t,r){return be(function(i,o){var s;!e||typeof e=="function"?s=e:(t=e.duration,s=e.element,r=e.connector);var a=new Map,c=function(f){a.forEach(f),f(o)},l=function(f){return c(function(g){return g.error(f)})},u=0,h=!1,y=new Ef(o,function(f){try{var g=n(f),_=a.get(g);if(!_){a.set(g,_=r?r():new Ot);var A=d(g,_);if(o.next(A),t){var P=fe(_,function(){_.complete(),P==null||P.unsubscribe()},void 0,void 0,function(){return a.delete(g)});y.add(Oe(t(A)).subscribe(P))}}_.next(s?s(f):f)}catch(B){l(B)}},function(){return c(function(f){return f.complete()})},l,function(){return a.clear()},function(){return h=!0,u===0});i.subscribe(y);function d(f,g){var _=new Fe(function(A){u++;var P=g.subscribe(A);return function(){P.unsubscribe(),--u===0&&h&&y.unsubscribe()}});return _.key=f,_}})}function WD(){return be(function(n,e){n.subscribe(fe(e,function(){e.next(!1),e.complete()},function(){e.next(!0),e.complete()}))})}function q1(n){return n<=0?function(){return vr}:be(function(e,t){var r=[];e.subscribe(fe(t,function(i){r.push(i),n<r.length&&r.shift()},function(){var i,o;try{for(var s=un(r),a=s.next();!a.done;a=s.next()){var c=a.value;t.next(c)}}catch(l){i={error:l}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}t.complete()},void 0,function(){r=null}))})}function zD(n,e){var t=arguments.length>=2;return function(r){return r.pipe(n?Ti(function(i,o){return n(i,o,r)}):Rt,q1(1),t?ul(e):hl(function(){return new Mi}))}}function HD(){return be(function(n,e){n.subscribe(fe(e,function(t){e.next(Ka.createNext(t))},function(){e.next(Ka.createComplete()),e.complete()},function(t){e.next(Ka.createError(t)),e.complete()}))})}function JD(n){return Ds(Re(n)?function(e,t){return n(e,t)>0?e:t}:function(e,t){return e>t?e:t})}var YD=Zn;function GD(n,e,t){return t===void 0&&(t=1/0),Re(e)?Zn(function(){return n},e,t):(typeof e=="number"&&(t=e),Zn(function(){return n},t))}function XD(n,e,t){return t===void 0&&(t=1/0),be(function(r,i){var o=e;return jf(r,i,function(s,a){return n(o,s,a)},t,function(s){o=s},!1,void 0,function(){return o=null})})}function ZD(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Rr(n),r=Qw(n,1/0);return n=xo(n),be(function(i,o){cl(r)(Ir(Qe([i],Ze(n)),t)).subscribe(o)})}function QD(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return ZD.apply(void 0,Qe([],Ze(n)))}function eq(n){return Ds(Re(n)?function(e,t){return n(e,t)<0?e:t}:function(e,t){return e<t?e:t})}function Lf(n,e){var t=Re(n)?n:function(){return n};return Re(e)?Cf(e,{connector:t}):function(r){return new rl(r,t)}}function tq(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=xo(n);return function(r){return $1.apply(void 0,Qe([r],Ze(t)))}}function nq(){return be(function(n,e){var t,r=!1;n.subscribe(fe(e,function(i){var o=t;t=i,r&&e.next([o,i]),r=!0}))})}function rq(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=n.length;if(t===0)throw new Error("list of properties cannot be empty.");return Fi(function(r){for(var i=r,o=0;o<t;o++){var s=i==null?void 0:i[n[o]];if(typeof s!="undefined")i=s;else return}return i})}function iq(n){return n?function(e){return Cf(n)(e)}:function(e){return Lf(new Ot)(e)}}function oq(n){return function(e){var t=new Hw(n);return new rl(e,function(){return t})}}function sq(){return function(n){var e=new $f;return new rl(n,function(){return e})}}function aq(n,e,t,r){t&&!Re(t)&&(r=t);var i=Re(t)?t:void 0;return function(o){return Lf(new _f(n,e,r),i)(o)}}function cq(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return n.length?be(function(t,r){O1(Qe([t],Ze(n)))(r)}):Rt}function lq(n){var e,t=1/0,r;return n!=null&&(typeof n=="object"?(e=n.count,t=e===void 0?1/0:e,r=n.delay):t=n),t<=0?function(){return vr}:be(function(i,o){var s=0,a,c=function(){if(a==null||a.unsubscribe(),a=null,r!=null){var u=typeof r=="number"?Ki(r):Oe(r(s)),h=fe(o,function(){h.unsubscribe(),l()});u.subscribe(h)}else l()},l=function(){var u=!1;a=i.subscribe(fe(o,void 0,function(){++s<t?a?c():u=!0:o.complete()})),u&&c()};l()})}function uq(n){return be(function(e,t){var r,i=!1,o,s=!1,a=!1,c=function(){return a&&s&&(t.complete(),!0)},l=function(){return o||(o=new Ot,Oe(n(o)).subscribe(fe(t,function(){r?u():i=!0},function(){s=!0,c()}))),o},u=function(){a=!1,r=e.subscribe(fe(t,void 0,function(){a=!0,!c()&&l().next()})),i&&(r.unsubscribe(),r=null,i=!1,u())};u()})}function hq(n){n===void 0&&(n=1/0);var e;n&&typeof n=="object"?e=n:e={count:n};var t=e.count,r=t===void 0?1/0:t,i=e.delay,o=e.resetOnSuccess,s=o===void 0?!1:o;return r<=0?Rt:be(function(a,c){var l=0,u,h=function(){var y=!1;u=a.subscribe(fe(c,function(d){s&&(l=0),c.next(d)},void 0,function(d){if(l++<r){var f=function(){u?(u.unsubscribe(),u=null,h()):y=!0};if(i!=null){var g=typeof i=="number"?Ki(i):Oe(i(d,l)),_=fe(c,function(){_.unsubscribe(),f()},function(){c.complete()});g.subscribe(_)}else f()}else c.error(d)})),y&&(u.unsubscribe(),u=null,h())};h()})}function dq(n){return be(function(e,t){var r,i=!1,o,s=function(){r=e.subscribe(fe(t,void 0,void 0,function(a){o||(o=new Ot,Oe(n(o)).subscribe(fe(t,function(){return r?s():i=!0}))),o&&o.next(a)})),i&&(r.unsubscribe(),r=null,i=!1,s())};s()})}function U1(n){return be(function(e,t){var r=!1,i=null;e.subscribe(fe(t,function(o){r=!0,i=o})),Oe(n).subscribe(fe(t,function(){if(r){r=!1;var o=i;i=null,t.next(o)}},mt))})}function fq(n,e){return e===void 0&&(e=Dn),U1(E1(n,e))}function pq(n,e){return be(T1(n,e,arguments.length>=2,!0))}function yq(n,e){return e===void 0&&(e=function(t,r){return t===r}),be(function(t,r){var i=dg(),o=dg(),s=function(c){r.next(c),r.complete()},a=function(c,l){var u=fe(r,function(h){var y=l.buffer,d=l.complete;y.length===0?d?s(!1):c.buffer.push(h):!e(h,y.shift())&&s(!1)},function(){c.complete=!0;var h=l.complete,y=l.buffer;h&&s(y.length===0),u==null||u.unsubscribe()});return u};t.subscribe(a(i,o)),Oe(n).subscribe(a(o,i))})}function dg(){return{buffer:[],complete:!1}}function M1(n){n===void 0&&(n={});var e=n.connector,t=e===void 0?function(){return new Ot}:e,r=n.resetOnError,i=r===void 0?!0:r,o=n.resetOnComplete,s=o===void 0?!0:o,a=n.resetOnRefCountZero,c=a===void 0?!0:a;return function(l){var u,h,y,d=0,f=!1,g=!1,_=function(){h==null||h.unsubscribe(),h=void 0},A=function(){_(),u=y=void 0,f=g=!1},P=function(){var B=u;A(),B==null||B.unsubscribe()};return be(function(B,C){d++,!g&&!f&&_();var L=y=y!=null?y:t();C.add(function(){d--,d===0&&!g&&!f&&(h=uu(P,c))}),L.subscribe(C),!u&&d>0&&(u=new fo({next:function(q){return L.next(q)},error:function(q){g=!0,_(),h=uu(A,i,q),L.error(q)},complete:function(){f=!0,_(),h=uu(A,s),L.complete()}}),Oe(B).subscribe(u))})(l)}}function uu(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];if(e===!0){n();return}if(e!==!1){var i=new fo({next:function(){i.unsubscribe(),n()}});return Oe(e.apply(void 0,Qe([],Ze(t)))).subscribe(i)}}function gq(n,e,t){var r,i,o,s,a=!1;return n&&typeof n=="object"?(r=n.bufferSize,s=r===void 0?1/0:r,i=n.windowTime,e=i===void 0?1/0:i,o=n.refCount,a=o===void 0?!1:o,t=n.scheduler):s=n!=null?n:1/0,M1({connector:function(){return new _f(s,e,t)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:a})}function mq(n){return be(function(e,t){var r=!1,i,o=!1,s=0;e.subscribe(fe(t,function(a){o=!0,(!n||n(a,s++,e))&&(r&&t.error(new y1("Too many matching values")),r=!0,i=a)},function(){r?(t.next(i),t.complete()):t.error(o?new p1("No matching values"):new Mi)}))})}function vq(n){return Ti(function(e,t){return n<=t})}function bq(n){return n<=0?Rt:be(function(e,t){var r=new Array(n),i=0;return e.subscribe(fe(t,function(o){var s=i++;if(s<n)r[s]=o;else{var a=s%n,c=r[a];r[a]=o,t.next(c)}})),function(){r=null}})}function wq(n){return be(function(e,t){var r=!1,i=fe(t,function(){i==null||i.unsubscribe(),r=!0},mt);Oe(n).subscribe(i),e.subscribe(fe(t,function(o){return r&&t.next(o)}))})}function kq(n){return be(function(e,t){var r=!1,i=0;e.subscribe(fe(t,function(o){return(r||(r=!n(o,i++)))&&t.next(o)}))})}function xq(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Rr(n);return be(function(r,i){(t?ys(n,r,t):ys(n,r)).subscribe(i)})}function ms(n,e){return be(function(t,r){var i=null,o=0,s=!1,a=function(){return s&&!i&&r.complete()};t.subscribe(fe(r,function(c){i==null||i.unsubscribe();var l=0,u=o++;Oe(n(c,u)).subscribe(i=fe(r,function(h){return r.next(e?e(c,h,u,l++):h)},function(){i=null,a()}))},function(){s=!0,a()}))})}function Eq(){return ms(Rt)}function _q(n,e){return Re(e)?ms(function(){return n},e):ms(function(){return n})}function $q(n,e){return be(function(t,r){var i=e;return ms(function(o,s){return n(i,o,s)},function(o,s){return i=s,s})(t).subscribe(r),function(){i=null}})}function Oq(n){return be(function(e,t){Oe(n).subscribe(fe(t,function(){return t.complete()},mt)),!t.closed&&e.subscribe(t)})}function Aq(n,e){return e===void 0&&(e=!1),be(function(t,r){var i=0;t.subscribe(fe(r,function(o){var s=n(o,i++);(s||e)&&r.next(o),!s&&r.complete()}))})}function Sq(n,e,t){var r=Re(n)||e||t?{next:n,error:e,complete:t}:n;return r?be(function(i,o){var s;(s=r.subscribe)===null||s===void 0||s.call(r);var a=!0;i.subscribe(fe(o,function(c){var l;(l=r.next)===null||l===void 0||l.call(r,c),o.next(c)},function(){var c;a=!1,(c=r.complete)===null||c===void 0||c.call(r),o.complete()},function(c){var l;a=!1,(l=r.error)===null||l===void 0||l.call(r,c),o.error(c)},function(){var c,l;a&&((c=r.unsubscribe)===null||c===void 0||c.call(r)),(l=r.finalize)===null||l===void 0||l.call(r)}))}):Rt}function F1(n,e){return be(function(t,r){var i=e!=null?e:{},o=i.leading,s=o===void 0?!0:o,a=i.trailing,c=a===void 0?!1:a,l=!1,u=null,h=null,y=!1,d=function(){h==null||h.unsubscribe(),h=null,c&&(_(),y&&r.complete())},f=function(){h=null,y&&r.complete()},g=function(A){return h=Oe(n(A)).subscribe(fe(r,d,f))},_=function(){if(l){l=!1;var A=u;u=null,r.next(A),!y&&g(A)}};t.subscribe(fe(r,function(A){l=!0,u=A,!(h&&!h.closed)&&(s?_():g(A))},function(){y=!0,!(c&&l&&h&&!h.closed)&&r.complete()}))})}function Tq(n,e,t){e===void 0&&(e=Dn);var r=Ki(n,e);return F1(function(){return r},t)}function Pq(n){return n===void 0&&(n=Dn),be(function(e,t){var r=n.now();e.subscribe(fe(t,function(i){var o=n.now(),s=o-r;r=o,t.next(new jq(i,s))}))})}var jq=function(){function n(e,t){this.value=e,this.interval=t}return n}();function Rq(n,e,t){var r,i,o;if(t=t!=null?t:Of,Pf(n)?r=n:typeof n=="number"&&(i=n),e)o=function(){return e};else throw new TypeError("No observable provided to switch to");if(r==null&&i==null)throw new TypeError("No timeout provided.");return m1({first:r,each:i,scheduler:t,with:o})}function Iq(n){return n===void 0&&(n=il),Fi(function(e){return{value:e,timestamp:n.now()}})}function Cq(n){return be(function(e,t){var r=new Ot;t.next(r.asObservable());var i=function(o){r.error(o),t.error(o)};return e.subscribe(fe(t,function(o){return r==null?void 0:r.next(o)},function(){r.complete(),t.complete()},i)),Oe(n).subscribe(fe(t,function(){r.complete(),t.next(r=new Ot)},mt,i)),function(){r==null||r.unsubscribe(),r=null}})}function Nq(n,e){e===void 0&&(e=0);var t=e>0?e:n;return be(function(r,i){var o=[new Ot],s=[],a=0;i.next(o[0].asObservable()),r.subscribe(fe(i,function(c){var l,u;try{for(var h=un(o),y=h.next();!y.done;y=h.next()){var d=y.value;d.next(c)}}catch(_){l={error:_}}finally{try{y&&!y.done&&(u=h.return)&&u.call(h)}finally{if(l)throw l.error}}var f=a-n+1;if(f>=0&&f%t===0&&o.shift().complete(),++a%t===0){var g=new Ot;o.push(g),i.next(g.asObservable())}},function(){for(;o.length>0;)o.shift().complete();i.complete()},function(c){for(;o.length>0;)o.shift().error(c);i.error(c)},function(){s=null,o=null}))})}function Bq(n){for(var e,t,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];var o=(e=Rr(r))!==null&&e!==void 0?e:Dn,s=(t=r[0])!==null&&t!==void 0?t:null,a=r[1]||1/0;return be(function(c,l){var u=[],h=!1,y=function(_){var A=_.window,P=_.subs;A.complete(),P.unsubscribe(),Ar(u,_),h&&d()},d=function(){if(u){var _=new pn;l.add(_);var A=new Ot,P={window:A,subs:_,seen:0};u.push(P),l.next(A.asObservable()),hn(_,o,function(){return y(P)},n)}};s!==null&&s>=0?hn(l,o,d,s,!0):h=!0,d();var f=function(_){return u.slice().forEach(_)},g=function(_){f(function(A){var P=A.window;return _(P)}),_(l),l.unsubscribe()};return c.subscribe(fe(l,function(_){f(function(A){A.window.next(_),a<=++A.seen&&y(A)})},function(){return g(function(_){return _.complete()})},function(_){return g(function(A){return A.error(_)})})),function(){u=null}})}function Lq(n,e){return be(function(t,r){var i=[],o=function(s){for(;0<i.length;)i.shift().error(s);r.error(s)};Oe(n).subscribe(fe(r,function(s){var a=new Ot;i.push(a);var c=new pn,l=function(){Ar(i,a),a.complete(),c.unsubscribe()},u;try{u=Oe(e(s))}catch(h){o(h);return}r.next(a.asObservable()),c.add(u.subscribe(fe(r,l,mt,o)))},mt)),t.subscribe(fe(r,function(s){var a,c,l=i.slice();try{for(var u=un(l),h=u.next();!h.done;h=u.next()){var y=h.value;y.next(s)}}catch(d){a={error:d}}finally{try{h&&!h.done&&(c=u.return)&&c.call(u)}finally{if(a)throw a.error}}},function(){for(;0<i.length;)i.shift().complete();r.complete()},o,function(){for(;0<i.length;)i.shift().unsubscribe()}))})}function Dq(n){return be(function(e,t){var r,i,o=function(a){r.error(a),t.error(a)},s=function(){i==null||i.unsubscribe(),r==null||r.complete(),r=new Ot,t.next(r.asObservable());var a;try{a=Oe(n())}catch(c){o(c);return}a.subscribe(i=fe(t,s,s,o))};s(),e.subscribe(fe(t,function(a){return r.next(a)},function(){r.complete(),t.complete()},o,function(){i==null||i.unsubscribe(),r=null}))})}function qq(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Ls(n);return be(function(r,i){for(var o=n.length,s=new Array(o),a=n.map(function(){return!1}),c=!1,l=function(h){Oe(n[h]).subscribe(fe(i,function(y){s[h]=y,!c&&!a[h]&&(a[h]=!0,(c=a.every(Rt))&&(a=null))},mt))},u=0;u<o;u++)l(u);r.subscribe(fe(i,function(h){if(c){var y=Qe([h],Ze(s));i.next(t?t.apply(void 0,Qe([],Ze(y))):y)}}))})}function Uq(n){return j1(If,n)}function Mq(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return be(function(t,r){If.apply(void 0,Qe([t],Ze(n))).subscribe(r)})}function Fq(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return Mq.apply(void 0,Qe([],Ze(n)))}const Vq=Object.freeze(Object.defineProperty({__proto__:null,Observable:Fe,ConnectableObservable:rl,observable:nl,animationFrames:iL,Subject:Ot,BehaviorSubject:Hw,ReplaySubject:_f,AsyncSubject:$f,asap:dL,asapScheduler:Yw,async:Of,asyncScheduler:Dn,queue:yL,queueScheduler:Gw,animationFrame:vL,animationFrameScheduler:Xw,VirtualTimeScheduler:bL,VirtualAction:Zw,Scheduler:Rh,Subscription:pn,Subscriber:tl,Notification:Ka,get NotificationKind(){return Ih},pipe:xf,noop:mt,identity:Rt,isObservable:IL,lastValueFrom:CL,firstValueFrom:NL,ArgumentOutOfRangeError:Ch,EmptyError:Mi,NotFoundError:p1,ObjectUnsubscribedError:zw,SequenceError:y1,TimeoutError:g1,UnsubscriptionError:Fa,bindCallback:qL,bindNodeCallback:UL,combineLatest:w1,concat:ys,connectable:HL,defer:ll,empty:wL,forkJoin:JL,from:Ir,fromEvent:Nh,fromEventPattern:x1,generate:tD,iif:nD,interval:E1,merge:rD,never:iD,of:Tf,onErrorResumeNext:$1,pairs:sD,partition:cD,race:lD,range:uD,throwError:d1,timer:Ki,using:hD,zip:If,scheduled:h1,EMPTY:vr,NEVER:_1,config:fi,audit:A1,auditTime:dD,buffer:fD,bufferCount:pD,bufferTime:yD,bufferToggle:gD,bufferWhen:mD,catchError:S1,combineAll:bD,combineLatestAll:R1,combineLatestWith:wD,concatAll:Rf,concatMap:Bh,concatMapTo:kD,concatWith:ED,connect:Cf,count:OD,debounce:AD,debounceTime:SD,defaultIfEmpty:ul,delay:TD,delayWhen:Nf,dematerialize:PD,distinct:jD,distinctUntilChanged:B1,distinctUntilKeyChanged:ID,elementAt:ND,endWith:BD,every:LD,exhaust:DD,exhaustAll:L1,exhaustMap:Bf,expand:qD,filter:Ti,finalize:UD,find:MD,findIndex:FD,first:VD,groupBy:KD,ignoreElements:C1,isEmpty:WD,last:zD,map:Fi,mapTo:N1,materialize:HD,max:JD,mergeAll:cl,flatMap:YD,mergeMap:Zn,mergeMapTo:GD,mergeScan:XD,mergeWith:QD,min:eq,multicast:Lf,observeOn:sl,onErrorResumeNextWith:tq,pairwise:nq,pluck:rq,publish:iq,publishBehavior:oq,publishLast:sq,publishReplay:aq,raceWith:cq,reduce:Ds,repeat:lq,repeatWhen:uq,retry:hq,retryWhen:dq,refCount:Vw,sample:U1,sampleTime:fq,scan:pq,sequenceEqual:yq,share:M1,shareReplay:gq,single:mq,skip:vq,skipLast:bq,skipUntil:wq,skipWhile:kq,startWith:xq,subscribeOn:al,switchAll:Eq,switchMap:ms,switchMapTo:_q,switchScan:$q,take:gs,takeLast:q1,takeUntil:Oq,takeWhile:Aq,tap:Sq,throttle:F1,throttleTime:Tq,throwIfEmpty:hl,timeInterval:Pq,timeout:m1,timeoutWith:Rq,timestamp:Iq,toArray:P1,window:Cq,windowCount:Nq,windowTime:Bq,windowToggle:Lq,windowWhen:Dq,withLatestFrom:qq,zipAll:Uq,zipWith:Fq},Symbol.toStringTag,{value:"Module"})),Kq={init:n=>{const e=__.init(n),t=aj.init(n),r=KB.init(n);return{auth:e,database:t,storage:r}}};export{Kq as default};
//# sourceMappingURL=swyger-client.min.js.map
