var Wk=Object.defineProperty,zk=Object.defineProperties;var Hk=Object.getOwnPropertyDescriptors;var Ud=Object.getOwnPropertySymbols;var Jk=Object.prototype.hasOwnProperty,Yk=Object.prototype.propertyIsEnumerable;var gl=(n,e,t)=>e in n?Wk(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,re=(n,e)=>{for(var t in e||(e={}))Jk.call(e,t)&&gl(n,t,e[t]);if(Ud)for(var t of Ud(e))Yk.call(e,t)&&gl(n,t,e[t]);return n},Je=(n,e)=>zk(n,Hk(e));var Fd=(n,e,t)=>(gl(n,typeof e!="symbol"?e+"":e,t),t),Md=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)};var xe=(n,e,t)=>(Md(n,e,"read from private field"),t?t.call(n):e.get(n)),Gt=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)},$n=(n,e,t,r)=>(Md(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t);var V=(n,e,t)=>new Promise((r,i)=>{var s=c=>{try{a(t.next(c))}catch(l){i(l)}},o=c=>{try{a(t.throw(c))}catch(l){i(l)}},a=c=>c.done?r(c.value):Promise.resolve(c.value).then(s,o);a((t=t.apply(n,e)).next())});var Gk=Object.defineProperty,Qk=Object.defineProperties,Xk=Object.getOwnPropertyDescriptors,qd=Object.getOwnPropertySymbols,Zk=Object.prototype.hasOwnProperty,ex=Object.prototype.propertyIsEnumerable,gu=(n,e,t)=>e in n?Gk(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Q=(n,e)=>{for(var t in e||(e={}))Zk.call(e,t)&&gu(n,t,e[t]);if(qd)for(var t of qd(e))ex.call(e,t)&&gu(n,t,e[t]);return n},Ue=(n,e)=>Qk(n,Xk(e)),tx=(n,e,t)=>(gu(n,typeof e!="symbol"?e+"":e,t),t),mg=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)},be=(n,e,t)=>(mg(n,e,"read from private field"),t?t.call(n):e.get(n)),vn=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)},Mr=(n,e,t,r)=>(mg(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t),K=(n,e,t)=>new Promise((r,i)=>{var s=c=>{try{a(t.next(c))}catch(l){i(l)}},o=c=>{try{a(t.throw(c))}catch(l){i(l)}},a=c=>c.done?r(c.value):Promise.resolve(c.value).then(s,o);a((t=t.apply(n,e)).next())});const hr=Object.create(null);hr.open="0";hr.close="1";hr.ping="2";hr.pong="3";hr.message="4";hr.upgrade="5";hr.noop="6";const oa=Object.create(null);Object.keys(hr).forEach(n=>{oa[hr[n]]=n});const nx={type:"error",data:"parser error"},rx=typeof Blob=="function"||typeof Blob!="undefined"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",ix=typeof ArrayBuffer=="function",sx=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n&&n.buffer instanceof ArrayBuffer,vg=({type:n,data:e},t,r)=>rx&&e instanceof Blob?t?r(e):Vd(e,r):ix&&(e instanceof ArrayBuffer||sx(e))?t?r(e):Vd(new Blob([e]),r):r(hr[n]+(e||"")),Vd=(n,e)=>{const t=new FileReader;return t.onload=function(){const r=t.result.split(",")[1];e("b"+(r||""))},t.readAsDataURL(n)},Kd="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ls=typeof Uint8Array=="undefined"?[]:new Uint8Array(256);for(let n=0;n<Kd.length;n++)Ls[Kd.charCodeAt(n)]=n;const ox=n=>{let e=n.length*.75,t=n.length,r,i=0,s,o,a,c;n[n.length-1]==="="&&(e--,n[n.length-2]==="="&&e--);const l=new ArrayBuffer(e),u=new Uint8Array(l);for(r=0;r<t;r+=4)s=Ls[n.charCodeAt(r)],o=Ls[n.charCodeAt(r+1)],a=Ls[n.charCodeAt(r+2)],c=Ls[n.charCodeAt(r+3)],u[i++]=s<<2|o>>4,u[i++]=(o&15)<<4|a>>2,u[i++]=(a&3)<<6|c&63;return l},ax=typeof ArrayBuffer=="function",bg=(n,e)=>{if(typeof n!="string")return{type:"message",data:wg(n,e)};const t=n.charAt(0);return t==="b"?{type:"message",data:cx(n.substring(1),e)}:oa[t]?n.length>1?{type:oa[t],data:n.substring(1)}:{type:oa[t]}:nx},cx=(n,e)=>{if(ax){const t=ox(n);return wg(t,e)}else return{base64:!0,data:n}},wg=(n,e)=>{switch(e){case"blob":return n instanceof ArrayBuffer?new Blob([n]):n;case"arraybuffer":default:return n}},kg=String.fromCharCode(30),lx=(n,e)=>{const t=n.length,r=new Array(t);let i=0;n.forEach((s,o)=>{vg(s,!1,a=>{r[o]=a,++i===t&&e(r.join(kg))})})},ux=(n,e)=>{const t=n.split(kg),r=[];for(let i=0;i<t.length;i++){const s=bg(t[i],e);if(r.push(s),s.type==="error")break}return r},xg=4;function ft(n){if(n)return hx(n)}function hx(n){for(var e in ft.prototype)n[e]=ft.prototype[e];return n}ft.prototype.on=ft.prototype.addEventListener=function(n,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+n]=this._callbacks["$"+n]||[]).push(e),this};ft.prototype.once=function(n,e){function t(){this.off(n,t),e.apply(this,arguments)}return t.fn=e,this.on(n,t),this};ft.prototype.off=ft.prototype.removeListener=ft.prototype.removeAllListeners=ft.prototype.removeEventListener=function(n,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+n];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+n],this;for(var r,i=0;i<t.length;i++)if(r=t[i],r===e||r.fn===e){t.splice(i,1);break}return t.length===0&&delete this._callbacks["$"+n],this};ft.prototype.emit=function(n){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+n],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(t){t=t.slice(0);for(var r=0,i=t.length;r<i;++r)t[r].apply(this,e)}return this};ft.prototype.emitReserved=ft.prototype.emit;ft.prototype.listeners=function(n){return this._callbacks=this._callbacks||{},this._callbacks["$"+n]||[]};ft.prototype.hasListeners=function(n){return!!this.listeners(n).length};const Cn=(()=>typeof self!="undefined"?self:typeof window!="undefined"?window:Function("return this")())();function Eg(n,...e){return e.reduce((t,r)=>(n.hasOwnProperty(r)&&(t[r]=n[r]),t),{})}const fx=Cn.setTimeout,dx=Cn.clearTimeout;function fc(n,e){e.useNativeTimers?(n.setTimeoutFn=fx.bind(Cn),n.clearTimeoutFn=dx.bind(Cn)):(n.setTimeoutFn=Cn.setTimeout.bind(Cn),n.clearTimeoutFn=Cn.clearTimeout.bind(Cn))}const px=1.33;function yx(n){return typeof n=="string"?gx(n):Math.ceil((n.byteLength||n.size)*px)}function gx(n){let e=0,t=0;for(let r=0,i=n.length;r<i;r++)e=n.charCodeAt(r),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(r++,t+=4);return t}class mx extends Error{constructor(e,t,r){super(e),this.description=t,this.context=r,this.type="TransportError"}}class _g extends ft{constructor(e){super(),this.writable=!1,fc(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,r){return super.emitReserved("error",new mx(e,t,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=bg(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}}const Ag="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),mu=64,vx={};let Wd=0,Do=0,zd;function Hd(n){let e="";do e=Ag[n%mu]+e,n=Math.floor(n/mu);while(n>0);return e}function Og(){const n=Hd(+new Date);return n!==zd?(Wd=0,zd=n):n+"."+Hd(Wd++)}for(;Do<mu;Do++)vx[Ag[Do]]=Do;function Sg(n){let e="";for(let t in n)n.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(n[t]));return e}function bx(n){let e={},t=n.split("&");for(let r=0,i=t.length;r<i;r++){let s=t[r].split("=");e[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return e}let $g=!1;try{$g=typeof XMLHttpRequest!="undefined"&&"withCredentials"in new XMLHttpRequest}catch(n){}const wx=$g;function Tg(n){const e=n.xdomain;try{if(typeof XMLHttpRequest!="undefined"&&(!e||wx))return new XMLHttpRequest}catch(t){}if(!e)try{return new Cn[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch(t){}}function kx(){}const xx=function(){return new Tg({xdomain:!1}).responseType!=null}();class Ex extends _g{constructor(e){if(super(e),this.polling=!1,typeof location!="undefined"){const r=location.protocol==="https:";let i=location.port;i||(i=r?"443":"80"),this.xd=typeof location!="undefined"&&e.hostname!==location.hostname||i!==e.port,this.xs=e.secure!==r}const t=e&&e.forceBase64;this.supportsBinary=xx&&!t}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let r=0;this.polling&&(r++,this.once("pollComplete",function(){--r||t()})),this.writable||(r++,this.once("drain",function(){--r||t()}))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const t=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)};ux(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,lx(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let e=this.query||{};const t=this.opts.secure?"https":"http";let r="";this.opts.timestampRequests!==!1&&(e[this.opts.timestampParam]=Og()),!this.supportsBinary&&!e.sid&&(e.b64=1),this.opts.port&&(t==="https"&&Number(this.opts.port)!==443||t==="http"&&Number(this.opts.port)!==80)&&(r=":"+this.opts.port);const i=Sg(e),s=this.opts.hostname.indexOf(":")!==-1;return t+"://"+(s?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(i.length?"?"+i:"")}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new cr(this.uri(),e)}doWrite(e,t){const r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",(i,s)=>{this.onError("xhr post error",i,s)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,r)=>{this.onError("xhr poll error",t,r)}),this.pollXhr=e}}class cr extends ft{constructor(e,t){super(),fc(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.async=t.async!==!1,this.data=t.data!==void 0?t.data:null,this.create()}create(){const e=Eg(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;const t=this.xhr=new Tg(e);try{t.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(let r in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(r)&&t.setRequestHeader(r,this.opts.extraHeaders[r])}}catch(r){}if(this.method==="POST")try{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(r){}try{t.setRequestHeader("Accept","*/*")}catch(r){}"withCredentials"in t&&(t.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(t.timeout=this.opts.requestTimeout),t.onreadystatechange=()=>{t.readyState===4&&(t.status===200||t.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof t.status=="number"?t.status:0)},0))},t.send(this.data)}catch(r){this.setTimeoutFn(()=>{this.onError(r)},0);return}typeof document!="undefined"&&(this.index=cr.requestsCount++,cr.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr=="undefined"||this.xhr===null)){if(this.xhr.onreadystatechange=kx,e)try{this.xhr.abort()}catch(t){}typeof document!="undefined"&&delete cr.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}cr.requestsCount=0;cr.requests={};if(typeof document!="undefined"){if(typeof attachEvent=="function")attachEvent("onunload",Jd);else if(typeof addEventListener=="function"){const n="onpagehide"in Cn?"pagehide":"unload";addEventListener(n,Jd,!1)}}function Jd(){for(let n in cr.requests)cr.requests.hasOwnProperty(n)&&cr.requests[n].abort()}const Pg=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?n=>Promise.resolve().then(n):(n,e)=>e(n,0))(),Uo=Cn.WebSocket||Cn.MozWebSocket,Yd=!0,_x="arraybuffer",Gd=typeof navigator!="undefined"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class Ax extends _g{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,r=Gd?{}:Eg(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=Yd&&!Gd?t?new Uo(e,t):new Uo(e):new Uo(e,t,r)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType||_x,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],i=t===e.length-1;vg(r,this.supportsBinary,s=>{try{Yd&&this.ws.send(s)}catch(o){}i&&Pg(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws!="undefined"&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{};const t=this.opts.secure?"wss":"ws";let r="";this.opts.port&&(t==="wss"&&Number(this.opts.port)!==443||t==="ws"&&Number(this.opts.port)!==80)&&(r=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=Og()),this.supportsBinary||(e.b64=1);const i=Sg(e),s=this.opts.hostname.indexOf(":")!==-1;return t+"://"+(s?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(i.length?"?"+i:"")}check(){return!!Uo}}const Ox={websocket:Ax,polling:Ex},Sx=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,$x=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function vu(n){const e=n,t=n.indexOf("["),r=n.indexOf("]");t!=-1&&r!=-1&&(n=n.substring(0,t)+n.substring(t,r).replace(/:/g,";")+n.substring(r,n.length));let i=Sx.exec(n||""),s={},o=14;for(;o--;)s[$x[o]]=i[o]||"";return t!=-1&&r!=-1&&(s.source=e,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=Tx(s,s.path),s.queryKey=Px(s,s.query),s}function Tx(n,e){const t=/\/{2,9}/g,r=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&r.splice(0,1),e.slice(-1)=="/"&&r.splice(r.length-1,1),r}function Px(n,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,i,s){i&&(t[i]=s)}),t}class ei extends ft{constructor(e,t={}){super(),this.writeBuffer=[],e&&typeof e=="object"&&(t=e,e=null),e?(e=vu(e),t.hostname=e.host,t.secure=e.protocol==="https"||e.protocol==="wss",t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=vu(t.host).host),fc(this,t),this.secure=t.secure!=null?t.secure:typeof location!="undefined"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location!="undefined"?location.hostname:"localhost"),this.port=t.port||(typeof location!="undefined"&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=bx(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=xg,t.transport=e,this.id&&(t.sid=this.id);const r=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new Ox[e](r)}open(){let e;if(this.opts.rememberUpgrade&&ei.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch(t){this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",t=>this.onClose("transport close",t))}probe(e){let t=this.createTransport(e),r=!1;ei.priorWebsocketSuccess=!1;const i=()=>{r||(t.send([{type:"ping",data:"probe"}]),t.once("packet",h=>{if(!r)if(h.type==="pong"&&h.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;ei.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{r||this.readyState!=="closed"&&(u(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const p=new Error("probe error");p.transport=t.name,this.emitReserved("upgradeError",p)}}))};function s(){r||(r=!0,u(),t.close(),t=null)}const o=h=>{const p=new Error("probe error: "+h);p.transport=t.name,s(),this.emitReserved("upgradeError",p)};function a(){o("transport closed")}function c(){o("socket closed")}function l(h){t&&h.name!==t.name&&s()}const u=()=>{t.removeListener("open",i),t.removeListener("error",o),t.removeListener("close",a),this.off("close",c),this.off("upgrading",l)};t.once("open",i),t.once("error",o),t.once("close",a),this.once("close",c),this.once("upgrading",l),t.open()}onOpen(){if(this.readyState="open",ei.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let t=0;t<this.writeBuffer.length;t++){const r=this.writeBuffer[t].data;if(r&&(e+=yx(r)),t>0&&e>this.maxPayload)return this.writeBuffer.slice(0,t);e+=2}return this.writeBuffer}write(e,t,r){return this.sendPacket("message",e,t,r),this}send(e,t,r){return this.sendPacket("message",e,t,r),this}sendPacket(e,t,r,i){if(typeof t=="function"&&(i=t,t=void 0),typeof r=="function"&&(i=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;const s={type:e,data:t,options:r};this.emitReserved("packetCreate",s),this.writeBuffer.push(s),i&&this.once("flush",i),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},r=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():e()}):this.upgrading?r():e()),this}onError(e){ei.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let r=0;const i=e.length;for(;r<i;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}}ei.protocol=xg;function Ix(n,e="",t){let r=n;t=t||typeof location!="undefined"&&location,n==null&&(n=t.protocol+"//"+t.host),typeof n=="string"&&(n.charAt(0)==="/"&&(n.charAt(1)==="/"?n=t.protocol+n:n=t.host+n),/^(https?|wss?):\/\//.test(n)||(typeof t!="undefined"?n=t.protocol+"//"+n:n="https://"+n),r=vu(n)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const i=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+i+":"+r.port+e,r.href=r.protocol+"://"+i+(t&&t.port===r.port?"":":"+r.port),r}const Rx=typeof ArrayBuffer=="function",Cx=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n.buffer instanceof ArrayBuffer,Ig=Object.prototype.toString,Nx=typeof Blob=="function"||typeof Blob!="undefined"&&Ig.call(Blob)==="[object BlobConstructor]",jx=typeof File=="function"||typeof File!="undefined"&&Ig.call(File)==="[object FileConstructor]";function Uh(n){return Rx&&(n instanceof ArrayBuffer||Cx(n))||Nx&&n instanceof Blob||jx&&n instanceof File}function aa(n,e){if(!n||typeof n!="object")return!1;if(Array.isArray(n)){for(let t=0,r=n.length;t<r;t++)if(aa(n[t]))return!0;return!1}if(Uh(n))return!0;if(n.toJSON&&typeof n.toJSON=="function"&&arguments.length===1)return aa(n.toJSON(),!0);for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)&&aa(n[t]))return!0;return!1}function Bx(n){const e=[],t=n.data,r=n;return r.data=bu(t,e),r.attachments=e.length,{packet:r,buffers:e}}function bu(n,e){if(!n)return n;if(Uh(n)){const t={_placeholder:!0,num:e.length};return e.push(n),t}else if(Array.isArray(n)){const t=new Array(n.length);for(let r=0;r<n.length;r++)t[r]=bu(n[r],e);return t}else if(typeof n=="object"&&!(n instanceof Date)){const t={};for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=bu(n[r],e));return t}return n}function Lx(n,e){return n.data=wu(n.data,e),delete n.attachments,n}function wu(n,e){if(!n)return n;if(n&&n._placeholder===!0){if(typeof n.num=="number"&&n.num>=0&&n.num<e.length)return e[n.num];throw new Error("illegal attachments")}else if(Array.isArray(n))for(let t=0;t<n.length;t++)n[t]=wu(n[t],e);else if(typeof n=="object")for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&(n[t]=wu(n[t],e));return n}const Dx=5;var Be;(function(n){n[n.CONNECT=0]="CONNECT",n[n.DISCONNECT=1]="DISCONNECT",n[n.EVENT=2]="EVENT",n[n.ACK=3]="ACK",n[n.CONNECT_ERROR=4]="CONNECT_ERROR",n[n.BINARY_EVENT=5]="BINARY_EVENT",n[n.BINARY_ACK=6]="BINARY_ACK"})(Be||(Be={}));class Ux{constructor(e){this.replacer=e}encode(e){return(e.type===Be.EVENT||e.type===Be.ACK)&&aa(e)?this.encodeAsBinary({type:e.type===Be.EVENT?Be.BINARY_EVENT:Be.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===Be.BINARY_EVENT||e.type===Be.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=Bx(e),r=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(r),i}}class Fh extends ft{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const r=t.type===Be.BINARY_EVENT;r||t.type===Be.BINARY_ACK?(t.type=r?Be.EVENT:Be.ACK,this.reconstructor=new Fx(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(Uh(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const r={type:Number(e.charAt(0))};if(Be[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===Be.BINARY_EVENT||r.type===Be.BINARY_ACK){const s=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const o=e.substring(s,t);if(o!=Number(o)||e.charAt(t)!=="-")throw new Error("Illegal attachments");r.attachments=Number(o)}if(e.charAt(t+1)==="/"){const s=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););r.nsp=e.substring(s,t)}else r.nsp="/";const i=e.charAt(t+1);if(i!==""&&Number(i)==i){const s=t+1;for(;++t;){const o=e.charAt(t);if(o==null||Number(o)!=o){--t;break}if(t===e.length)break}r.id=Number(e.substring(s,t+1))}if(e.charAt(++t)){const s=this.tryParse(e.substr(t));if(Fh.isPayloadValid(r.type,s))r.data=s;else throw new Error("invalid payload")}return r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(t){return!1}}static isPayloadValid(e,t){switch(e){case Be.CONNECT:return typeof t=="object";case Be.DISCONNECT:return t===void 0;case Be.CONNECT_ERROR:return typeof t=="string"||typeof t=="object";case Be.EVENT:case Be.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="string"||typeof t[0]=="number");case Be.ACK:case Be.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Fx{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=Lx(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const Mx=Object.freeze(Object.defineProperty({__proto__:null,protocol:Dx,get PacketType(){return Be},Encoder:Ux,Decoder:Fh},Symbol.toStringTag,{value:"Module"}));function qn(n,e,t){return n.on(e,t),function(){n.off(e,t)}}const qx=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Rg extends ft{constructor(e,t,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[qn(e,"open",this.onopen.bind(this)),qn(e,"packet",this.onpacket.bind(this)),qn(e,"error",this.onerror.bind(this)),qn(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(qx.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const r={type:Be.EVENT,data:t};if(r.options={},r.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const s=this.ids++,o=t.pop();this._registerAckCallback(s,o),r.id=s}const i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!i||!this.connected)||(this.connected?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(e,t){var r;const i=(r=this.flags.timeout)!==null&&r!==void 0?r:this._opts.ackTimeout;if(i===void 0){this.acks[e]=t;return}const s=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let o=0;o<this.sendBuffer.length;o++)this.sendBuffer[o].id===e&&this.sendBuffer.splice(o,1);t.call(this,new Error("operation has timed out"))},i);this.acks[e]=(...o)=>{this.io.clearTimeoutFn(s),t.apply(this,[null,...o])}}emitWithAck(e,...t){const r=this.flags.timeout!==void 0||this._opts.ackTimeout!==void 0;return new Promise((i,s)=>{t.push((o,a)=>r?o?s(o):i(a):i(o)),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((i,...s)=>r!==this._queue[0]?void 0:(i!==null?r.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(i)):(this._queue.shift(),t&&t(null,...s)),r.pending=!1,this._drainQueue())),this._queue.push(r),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:Be.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case Be.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Be.EVENT:case Be.BINARY_EVENT:this.onevent(e);break;case Be.ACK:case Be.BINARY_ACK:this.onack(e);break;case Be.DISCONNECT:this.ondisconnect();break;case Be.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const r of t)r.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let r=!1;return function(...i){r||(r=!0,t.packet({type:Be.ACK,id:e,data:i}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Be.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const r of t)r.apply(this,e.data)}}}function vs(n){n=n||{},this.ms=n.min||100,this.max=n.max||1e4,this.factor=n.factor||2,this.jitter=n.jitter>0&&n.jitter<=1?n.jitter:0,this.attempts=0}vs.prototype.duration=function(){var n=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*n);n=(Math.floor(e*10)&1)==0?n-t:n+t}return Math.min(n,this.max)|0};vs.prototype.reset=function(){this.attempts=0};vs.prototype.setMin=function(n){this.ms=n};vs.prototype.setMax=function(n){this.max=n};vs.prototype.setJitter=function(n){this.jitter=n};class ku extends ft{constructor(e,t){var r;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,fc(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((r=t.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new vs({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const i=t.parser||Mx;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new ei(this.uri,this.opts);const t=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const i=qn(t,"open",function(){r.onopen(),e&&e()}),s=qn(t,"error",o=>{r.cleanup(),r._readyState="closed",this.emitReserved("error",o),e?e(o):r.maybeReconnectOnOpen()});if(this._timeout!==!1){const o=this._timeout;o===0&&i();const a=this.setTimeoutFn(()=>{i(),t.close(),t.emit("error",new Error("timeout"))},o);this.opts.autoUnref&&a.unref(),this.subs.push(function(){clearTimeout(a)})}return this.subs.push(i),this.subs.push(s),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(qn(e,"ping",this.onping.bind(this)),qn(e,"data",this.ondata.bind(this)),qn(e,"error",this.onerror.bind(this)),qn(e,"close",this.onclose.bind(this)),qn(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){Pg(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new Rg(this,e,t),this.nsps[e]=r),r}_destroy(e){const t=Object.keys(this.nsps);for(const r of t)if(this.nsps[r].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let r=0;r<t.length;r++)this.engine.write(t[r],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(i=>{i?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",i)):e.onreconnect()}))},t);this.opts.autoUnref&&r.unref(),this.subs.push(function(){clearTimeout(r)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const Ss={};function ca(n,e){typeof n=="object"&&(e=n,n=void 0),e=e||{};const t=Ix(n,e.path||"/socket.io"),r=t.source,i=t.id,s=t.path,o=Ss[i]&&s in Ss[i].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||o;let c;return a?c=new ku(r,e):(Ss[i]||(Ss[i]=new ku(r,e)),c=Ss[i]),t.query&&!e.query&&(e.query=t.queryKey),c.socket(t.path,e)}Object.assign(ca,{Manager:ku,Socket:Rg,io:ca,connect:ca});const Vx={init:({API_KEY:n,HOST_SERVER:e,CURRENT:t,ENV:r,API_VERSION:i})=>{var s,o;let a={};const c=localStorage.getItem("accessToken");try{const l={Accept:"application/json","Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Key":n,"Access-Control-Allow-Methods":"POST, GET, OPTIONS, PUT, DELETE, HEAD,PATCH","Access-Control-Allow-Headers":"X-PINGOTHER, Origin, X-Requested-With, Content-Type, Accept","Access-Control-Max-Age":"1728000"};return c&&(l.Authorization="Bearer "+c),a.auth=ca(e.AUTH,{extraHeaders:l}),(s=a==null?void 0:a.auth)==null||s.on("connect",()=>{var u,h,p,f,d;r==="dev"&&console.log("Swyger Auth Client JS is connected with Swyger Server!!!");let y=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");y.uid&&(u=a.auth)!=null&&u.id&&(r==="dev"&&console.log("The socket device id is: ",(h=a.auth)==null?void 0:h.id),(f=a==null?void 0:a.auth)==null||f.emit((i==null?void 0:i.AUTH)+"/user/join",{socketId:(p=a.auth)==null?void 0:p.id,currentUserId:y.uid}),(d=a==null?void 0:a.auth)==null||d.on((i==null?void 0:i.AUTH)+"/user/status",_=>{if(y.status!=="online"){let S;_.from===y.uid&&(S=_==null?void 0:_.value),S!=null&&S.status&&(r==="dev"&&console.log("user is online: ",S),y.status=S.status,localStorage.setItem("userInfo",JSON.stringify(y)))}}))}),(o=a==null?void 0:a.auth)==null||o.on("disconnect",u=>{r==="dev"&&console.log("The device is disconnected from Auth server!");let h=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");h.uid&&h.status!=="offline"&&(h.status="offline",localStorage.setItem("userInfo",JSON.stringify(h)))}),a}catch(l){}}};function xu(n){this.message=n}xu.prototype=new Error,xu.prototype.name="InvalidCharacterError";var Qd=typeof window!="undefined"&&window.atob&&window.atob.bind(window)||function(n){var e=String(n).replace(/=+$/,"");if(e.length%4==1)throw new xu("'atob' failed: The string to be decoded is not correctly encoded.");for(var t,r,i=0,s=0,o="";r=e.charAt(s++);~r&&(t=i%4?64*t+r:r,i++%4)?o+=String.fromCharCode(255&t>>(-2*i&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return o};function Kx(n){var e=n.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw"Illegal base64url string!"}try{return function(t){return decodeURIComponent(Qd(t).replace(/(.)/g,function(r,i){var s=i.charCodeAt(0).toString(16).toUpperCase();return s.length<2&&(s="0"+s),"%"+s}))}(e)}catch(t){return Qd(e)}}function Ka(n){this.message=n}function Xd(n,e){if(typeof n!="string")throw new Ka("Invalid token specified");var t=(e=e||{}).header===!0?0:1;try{return JSON.parse(Kx(n.split(".")[t]))}catch(r){throw new Ka("Invalid token specified: "+r.message)}}Ka.prototype=new Error,Ka.prototype.name="InvalidTokenError";function Cg(n,e){return function(){return n.apply(e,arguments)}}const{toString:Wx}=Object.prototype,{getPrototypeOf:Mh}=Object,dc=(n=>e=>{const t=Wx.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),pr=n=>(n=n.toLowerCase(),e=>dc(e)===n),pc=n=>e=>typeof e===n,{isArray:bs}=Array,zs=pc("undefined");function zx(n){return n!==null&&!zs(n)&&n.constructor!==null&&!zs(n.constructor)&&Bn(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const Ng=pr("ArrayBuffer");function Hx(n){let e;return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&Ng(n.buffer),e}const Jx=pc("string"),Bn=pc("function"),jg=pc("number"),yc=n=>n!==null&&typeof n=="object",Yx=n=>n===!0||n===!1,la=n=>{if(dc(n)!=="object")return!1;const e=Mh(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},Gx=pr("Date"),Qx=pr("File"),Xx=pr("Blob"),Zx=pr("FileList"),e1=n=>yc(n)&&Bn(n.pipe),t1=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||Bn(n.append)&&((e=dc(n))==="formdata"||e==="object"&&Bn(n.toString)&&n.toString()==="[object FormData]"))},n1=pr("URLSearchParams"),r1=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function mo(n,e,{allOwnKeys:t=!1}={}){if(n===null||typeof n=="undefined")return;let r,i;if(typeof n!="object"&&(n=[n]),bs(n))for(r=0,i=n.length;r<i;r++)e.call(null,n[r],r,n);else{const s=t?Object.getOwnPropertyNames(n):Object.keys(n),o=s.length;let a;for(r=0;r<o;r++)a=s[r],e.call(null,n[a],a,n)}}function Bg(n,e){e=e.toLowerCase();const t=Object.keys(n);let r=t.length,i;for(;r-- >0;)if(i=t[r],e===i.toLowerCase())return i;return null}const Lg=(()=>typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:global)(),Dg=n=>!zs(n)&&n!==Lg;function Eu(){const{caseless:n}=Dg(this)&&this||{},e={},t=(r,i)=>{const s=n&&Bg(e,i)||i;la(e[s])&&la(r)?e[s]=Eu(e[s],r):la(r)?e[s]=Eu({},r):bs(r)?e[s]=r.slice():e[s]=r};for(let r=0,i=arguments.length;r<i;r++)arguments[r]&&mo(arguments[r],t);return e}const i1=(n,e,t,{allOwnKeys:r}={})=>(mo(e,(i,s)=>{t&&Bn(i)?n[s]=Cg(i,t):n[s]=i},{allOwnKeys:r}),n),s1=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),o1=(n,e,t,r)=>{n.prototype=Object.create(e.prototype,r),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),t&&Object.assign(n.prototype,t)},a1=(n,e,t,r)=>{let i,s,o;const a={};if(e=e||{},n==null)return e;do{for(i=Object.getOwnPropertyNames(n),s=i.length;s-- >0;)o=i[s],(!r||r(o,n,e))&&!a[o]&&(e[o]=n[o],a[o]=!0);n=t!==!1&&Mh(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e},c1=(n,e,t)=>{n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;const r=n.indexOf(e,t);return r!==-1&&r===t},l1=n=>{if(!n)return null;if(bs(n))return n;let e=n.length;if(!jg(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=n[e];return t},u1=(n=>e=>n&&e instanceof n)(typeof Uint8Array!="undefined"&&Mh(Uint8Array)),h1=(n,e)=>{const t=(n&&n[Symbol.iterator]).call(n);let r;for(;(r=t.next())&&!r.done;){const i=r.value;e.call(n,i[0],i[1])}},f1=(n,e)=>{let t;const r=[];for(;(t=n.exec(e))!==null;)r.push(t);return r},d1=pr("HTMLFormElement"),p1=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,r){return t.toUpperCase()+r}),Zd=(({hasOwnProperty:n})=>(e,t)=>n.call(e,t))(Object.prototype),y1=pr("RegExp"),Ug=(n,e)=>{const t=Object.getOwnPropertyDescriptors(n),r={};mo(t,(i,s)=>{e(i,s,n)!==!1&&(r[s]=i)}),Object.defineProperties(n,r)},g1=n=>{Ug(n,(e,t)=>{if(Bn(n)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const r=n[t];if(Bn(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},m1=(n,e)=>{const t={},r=i=>{i.forEach(s=>{t[s]=!0})};return bs(n)?r(n):r(String(n).split(e)),t},v1=()=>{},b1=(n,e)=>(n=+n,Number.isFinite(n)?n:e),ml="abcdefghijklmnopqrstuvwxyz",ep="0123456789",Fg={DIGIT:ep,ALPHA:ml,ALPHA_DIGIT:ml+ml.toUpperCase()+ep},w1=(n=16,e=Fg.ALPHA_DIGIT)=>{let t="";const{length:r}=e;for(;n--;)t+=e[Math.random()*r|0];return t};function k1(n){return!!(n&&Bn(n.append)&&n[Symbol.toStringTag]==="FormData"&&n[Symbol.iterator])}const x1=n=>{const e=new Array(10),t=(r,i)=>{if(yc(r)){if(e.indexOf(r)>=0)return;if(!("toJSON"in r)){e[i]=r;const s=bs(r)?[]:{};return mo(r,(o,a)=>{const c=t(o,i+1);!zs(c)&&(s[a]=c)}),e[i]=void 0,s}}return r};return t(n,0)},E1=pr("AsyncFunction"),_1=n=>n&&(yc(n)||Bn(n))&&Bn(n.then)&&Bn(n.catch),X={isArray:bs,isArrayBuffer:Ng,isBuffer:zx,isFormData:t1,isArrayBufferView:Hx,isString:Jx,isNumber:jg,isBoolean:Yx,isObject:yc,isPlainObject:la,isUndefined:zs,isDate:Gx,isFile:Qx,isBlob:Xx,isRegExp:y1,isFunction:Bn,isStream:e1,isURLSearchParams:n1,isTypedArray:u1,isFileList:Zx,forEach:mo,merge:Eu,extend:i1,trim:r1,stripBOM:s1,inherits:o1,toFlatObject:a1,kindOf:dc,kindOfTest:pr,endsWith:c1,toArray:l1,forEachEntry:h1,matchAll:f1,isHTMLForm:d1,hasOwnProperty:Zd,hasOwnProp:Zd,reduceDescriptors:Ug,freezeMethods:g1,toObjectSet:m1,toCamelCase:p1,noop:v1,toFiniteNumber:b1,findKey:Bg,global:Lg,isContextDefined:Dg,ALPHABET:Fg,generateString:w1,isSpecCompliantForm:k1,toJSONObject:x1,isAsyncFn:E1,isThenable:_1};function Ve(n,e,t,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),r&&(this.request=r),i&&(this.response=i)}X.inherits(Ve,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:X.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const Mg=Ve.prototype,qg={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{qg[n]={value:n}});Object.defineProperties(Ve,qg);Object.defineProperty(Mg,"isAxiosError",{value:!0});Ve.from=(n,e,t,r,i,s)=>{const o=Object.create(Mg);return X.toFlatObject(n,o,function(a){return a!==Error.prototype},a=>a!=="isAxiosError"),Ve.call(o,n.message,e,t,r,i),o.cause=n,o.name=n.name,s&&Object.assign(o,s),o};const A1=null;function _u(n){return X.isPlainObject(n)||X.isArray(n)}function Vg(n){return X.endsWith(n,"[]")?n.slice(0,-2):n}function tp(n,e,t){return n?n.concat(e).map(function(r,i){return r=Vg(r),!t&&i?"["+r+"]":r}).join(t?".":""):e}function O1(n){return X.isArray(n)&&!n.some(_u)}const S1=X.toFlatObject(X,{},null,function(n){return/^is[A-Z]/.test(n)});function gc(n,e,t){if(!X.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,t=X.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(f,d){return!X.isUndefined(d[f])});const r=t.metaTokens,i=t.visitor||l,s=t.dots,o=t.indexes,a=(t.Blob||typeof Blob!="undefined"&&Blob)&&X.isSpecCompliantForm(e);if(!X.isFunction(i))throw new TypeError("visitor must be a function");function c(f){if(f===null)return"";if(X.isDate(f))return f.toISOString();if(!a&&X.isBlob(f))throw new Ve("Blob is not supported. Use a Buffer instead.");return X.isArrayBuffer(f)||X.isTypedArray(f)?a&&typeof Blob=="function"?new Blob([f]):Buffer.from(f):f}function l(f,d,y){let _=f;if(f&&!y&&typeof f=="object"){if(X.endsWith(d,"{}"))d=r?d:d.slice(0,-2),f=JSON.stringify(f);else if(X.isArray(f)&&O1(f)||(X.isFileList(f)||X.endsWith(d,"[]"))&&(_=X.toArray(f)))return d=Vg(d),_.forEach(function(S,I){!(X.isUndefined(S)||S===null)&&e.append(o===!0?tp([d],I,s):o===null?d:d+"[]",c(S))}),!1}return _u(f)?!0:(e.append(tp(y,d,s),c(f)),!1)}const u=[],h=Object.assign(S1,{defaultVisitor:l,convertValue:c,isVisitable:_u});function p(f,d){if(!X.isUndefined(f)){if(u.indexOf(f)!==-1)throw Error("Circular reference detected in "+d.join("."));u.push(f),X.forEach(f,function(y,_){(!(X.isUndefined(y)||y===null)&&i.call(e,y,X.isString(_)?_.trim():_,d,h))===!0&&p(y,d?d.concat(_):[_])}),u.pop()}}if(!X.isObject(n))throw new TypeError("data must be an object");return p(n),e}function np(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(t){return e[t]})}function qh(n,e){this._pairs=[],n&&gc(n,this,e)}const Kg=qh.prototype;Kg.append=function(n,e){this._pairs.push([n,e])};Kg.toString=function(n){const e=n?function(t){return n.call(this,t,np)}:np;return this._pairs.map(function(t){return e(t[0])+"="+e(t[1])},"").join("&")};function $1(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Wg(n,e,t){if(!e)return n;const r=t&&t.encode||$1,i=t&&t.serialize;let s;if(i?s=i(e,t):s=X.isURLSearchParams(e)?e.toString():new qh(e,t).toString(r),s){const o=n.indexOf("#");o!==-1&&(n=n.slice(0,o)),n+=(n.indexOf("?")===-1?"?":"&")+s}return n}class T1{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){X.forEach(this.handlers,function(t){t!==null&&e(t)})}}const rp=T1,zg={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},P1=typeof URLSearchParams!="undefined"?URLSearchParams:qh,I1=typeof FormData!="undefined"?FormData:null,R1=typeof Blob!="undefined"?Blob:null,C1=(()=>{let n;return typeof navigator!="undefined"&&((n=navigator.product)==="ReactNative"||n==="NativeScript"||n==="NS")?!1:typeof window!="undefined"&&typeof document!="undefined"})(),N1=(()=>typeof WorkerGlobalScope!="undefined"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),sr={isBrowser:!0,classes:{URLSearchParams:P1,FormData:I1,Blob:R1},isStandardBrowserEnv:C1,isStandardBrowserWebWorkerEnv:N1,protocols:["http","https","file","blob","url","data"]};function j1(n,e){return gc(n,new sr.classes.URLSearchParams,Object.assign({visitor:function(t,r,i,s){return sr.isNode&&X.isBuffer(t)?(this.append(r,t.toString("base64")),!1):s.defaultVisitor.apply(this,arguments)}},e))}function B1(n){return X.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function L1(n){const e={},t=Object.keys(n);let r;const i=t.length;let s;for(r=0;r<i;r++)s=t[r],e[s]=n[s];return e}function Hg(n){function e(t,r,i,s){let o=t[s++];const a=Number.isFinite(+o),c=s>=t.length;return o=!o&&X.isArray(i)?i.length:o,c?(X.hasOwnProp(i,o)?i[o]=[i[o],r]:i[o]=r,!a):((!i[o]||!X.isObject(i[o]))&&(i[o]=[]),e(t,r,i[o],s)&&X.isArray(i[o])&&(i[o]=L1(i[o])),!a)}if(X.isFormData(n)&&X.isFunction(n.entries)){const t={};return X.forEachEntry(n,(r,i)=>{e(B1(r),i,t,0)}),t}return null}const D1={"Content-Type":void 0};function U1(n,e,t){if(X.isString(n))try{return(e||JSON.parse)(n),X.trim(n)}catch(r){if(r.name!=="SyntaxError")throw r}return(t||JSON.stringify)(n)}const mc={transitional:zg,adapter:["xhr","http"],transformRequest:[function(n,e){const t=e.getContentType()||"",r=t.indexOf("application/json")>-1,i=X.isObject(n);if(i&&X.isHTMLForm(n)&&(n=new FormData(n)),X.isFormData(n))return r&&r?JSON.stringify(Hg(n)):n;if(X.isArrayBuffer(n)||X.isBuffer(n)||X.isStream(n)||X.isFile(n)||X.isBlob(n))return n;if(X.isArrayBufferView(n))return n.buffer;if(X.isURLSearchParams(n))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),n.toString();let s;if(i){if(t.indexOf("application/x-www-form-urlencoded")>-1)return j1(n,this.formSerializer).toString();if((s=X.isFileList(n))||t.indexOf("multipart/form-data")>-1){const o=this.env&&this.env.FormData;return gc(s?{"files[]":n}:n,o&&new o,this.formSerializer)}}return i||r?(e.setContentType("application/json",!1),U1(n)):n}],transformResponse:[function(n){const e=this.transitional||mc.transitional,t=e&&e.forcedJSONParsing,r=this.responseType==="json";if(n&&X.isString(n)&&(t&&!this.responseType||r)){const i=!(e&&e.silentJSONParsing)&&r;try{return JSON.parse(n)}catch(s){if(i)throw s.name==="SyntaxError"?Ve.from(s,Ve.ERR_BAD_RESPONSE,this,null,this.response):s}}return n}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:sr.classes.FormData,Blob:sr.classes.Blob},validateStatus:function(n){return n>=200&&n<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};X.forEach(["delete","get","head"],function(n){mc.headers[n]={}});X.forEach(["post","put","patch"],function(n){mc.headers[n]=X.merge(D1)});const Vh=mc,F1=X.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),M1=n=>{const e={};let t,r,i;return n&&n.split(`
`).forEach(function(s){i=s.indexOf(":"),t=s.substring(0,i).trim().toLowerCase(),r=s.substring(i+1).trim(),!(!t||e[t]&&F1[t])&&(t==="set-cookie"?e[t]?e[t].push(r):e[t]=[r]:e[t]=e[t]?e[t]+", "+r:r)}),e},ip=Symbol("internals");function $s(n){return n&&String(n).trim().toLowerCase()}function ua(n){return n===!1||n==null?n:X.isArray(n)?n.map(ua):String(n)}function q1(n){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=t.exec(n);)e[r[1]]=r[2];return e}const V1=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function vl(n,e,t,r,i){if(X.isFunction(r))return r.call(this,e,t);if(i&&(e=t),!!X.isString(e)){if(X.isString(r))return e.indexOf(r)!==-1;if(X.isRegExp(r))return r.test(e)}}function K1(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,r)=>t.toUpperCase()+r)}function W1(n,e){const t=X.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(n,r+t,{value:function(i,s,o){return this[r].call(this,e,i,s,o)},configurable:!0})})}class vc{constructor(e){e&&this.set(e)}set(e,t,r){const i=this;function s(a,c,l){const u=$s(c);if(!u)throw new Error("header name must be a non-empty string");const h=X.findKey(i,u);(!h||i[h]===void 0||l===!0||l===void 0&&i[h]!==!1)&&(i[h||c]=ua(a))}const o=(a,c)=>X.forEach(a,(l,u)=>s(l,u,c));return X.isPlainObject(e)||e instanceof this.constructor?o(e,t):X.isString(e)&&(e=e.trim())&&!V1(e)?o(M1(e),t):e!=null&&s(t,e,r),this}get(e,t){if(e=$s(e),e){const r=X.findKey(this,e);if(r){const i=this[r];if(!t)return i;if(t===!0)return q1(i);if(X.isFunction(t))return t.call(this,i,r);if(X.isRegExp(t))return t.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=$s(e),e){const r=X.findKey(this,e);return!!(r&&this[r]!==void 0&&(!t||vl(this,this[r],r,t)))}return!1}delete(e,t){const r=this;let i=!1;function s(o){if(o=$s(o),o){const a=X.findKey(r,o);a&&(!t||vl(r,r[a],a,t))&&(delete r[a],i=!0)}}return X.isArray(e)?e.forEach(s):s(e),i}clear(e){const t=Object.keys(this);let r=t.length,i=!1;for(;r--;){const s=t[r];(!e||vl(this,this[s],s,e,!0))&&(delete this[s],i=!0)}return i}normalize(e){const t=this,r={};return X.forEach(this,(i,s)=>{const o=X.findKey(r,s);if(o){t[o]=ua(i),delete t[s];return}const a=e?K1(s):String(s).trim();a!==s&&delete t[s],t[a]=ua(i),r[a]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return X.forEach(this,(r,i)=>{r!=null&&r!==!1&&(t[i]=e&&X.isArray(r)?r.join(", "):r)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const r=new this(e);return t.forEach(i=>r.set(i)),r}static accessor(e){const t=(this[ip]=this[ip]={accessors:{}}).accessors,r=this.prototype;function i(s){const o=$s(s);t[o]||(W1(r,s),t[o]=!0)}return X.isArray(e)?e.forEach(i):i(e),this}}vc.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);X.freezeMethods(vc.prototype);X.freezeMethods(vc);const _r=vc;function bl(n,e){const t=this||Vh,r=e||t,i=_r.from(r.headers);let s=r.data;return X.forEach(n,function(o){s=o.call(t,s,i.normalize(),e?e.status:void 0)}),i.normalize(),s}function Jg(n){return!!(n&&n.__CANCEL__)}function vo(n,e,t){Ve.call(this,n==null?"canceled":n,Ve.ERR_CANCELED,e,t),this.name="CanceledError"}X.inherits(vo,Ve,{__CANCEL__:!0});function z1(n,e,t){const r=t.config.validateStatus;!t.status||!r||r(t.status)?n(t):e(new Ve("Request failed with status code "+t.status,[Ve.ERR_BAD_REQUEST,Ve.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}const H1=sr.isStandardBrowserEnv?function(){return{write:function(n,e,t,r,i,s){const o=[];o.push(n+"="+encodeURIComponent(e)),X.isNumber(t)&&o.push("expires="+new Date(t).toGMTString()),X.isString(r)&&o.push("path="+r),X.isString(i)&&o.push("domain="+i),s===!0&&o.push("secure"),document.cookie=o.join("; ")},read:function(n){const e=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(n){this.write(n,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}();function J1(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function Y1(n,e){return e?n.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):n}function Yg(n,e){return n&&!J1(e)?Y1(n,e):e}const G1=sr.isStandardBrowserEnv?function(){const n=/(msie|trident)/i.test(navigator.userAgent),e=document.createElement("a");let t;function r(i){let s=i;return n&&(e.setAttribute("href",s),s=e.href),e.setAttribute("href",s),{href:e.href,protocol:e.protocol?e.protocol.replace(/:$/,""):"",host:e.host,search:e.search?e.search.replace(/^\?/,""):"",hash:e.hash?e.hash.replace(/^#/,""):"",hostname:e.hostname,port:e.port,pathname:e.pathname.charAt(0)==="/"?e.pathname:"/"+e.pathname}}return t=r(window.location.href),function(i){const s=X.isString(i)?r(i):i;return s.protocol===t.protocol&&s.host===t.host}}():function(){return function(){return!0}}();function Q1(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function X1(n,e){n=n||10;const t=new Array(n),r=new Array(n);let i=0,s=0,o;return e=e!==void 0?e:1e3,function(a){const c=Date.now(),l=r[s];o||(o=c),t[i]=a,r[i]=c;let u=s,h=0;for(;u!==i;)h+=t[u++],u=u%n;if(i=(i+1)%n,i===s&&(s=(s+1)%n),c-o<e)return;const p=l&&c-l;return p?Math.round(h*1e3/p):void 0}}function sp(n,e){let t=0;const r=X1(50,250);return i=>{const s=i.loaded,o=i.lengthComputable?i.total:void 0,a=s-t,c=r(a),l=s<=o;t=s;const u={loaded:s,total:o,progress:o?s/o:void 0,bytes:a,rate:c||void 0,estimated:c&&o&&l?(o-s)/c:void 0,event:i};u[e?"download":"upload"]=!0,n(u)}}const Z1=typeof XMLHttpRequest!="undefined",eE=Z1&&function(n){return new Promise(function(e,t){let r=n.data;const i=_r.from(n.headers).normalize(),s=n.responseType;let o;function a(){n.cancelToken&&n.cancelToken.unsubscribe(o),n.signal&&n.signal.removeEventListener("abort",o)}X.isFormData(r)&&(sr.isStandardBrowserEnv||sr.isStandardBrowserWebWorkerEnv?i.setContentType(!1):i.setContentType("multipart/form-data;",!1));let c=new XMLHttpRequest;if(n.auth){const p=n.auth.username||"",f=n.auth.password?unescape(encodeURIComponent(n.auth.password)):"";i.set("Authorization","Basic "+btoa(p+":"+f))}const l=Yg(n.baseURL,n.url);c.open(n.method.toUpperCase(),Wg(l,n.params,n.paramsSerializer),!0),c.timeout=n.timeout;function u(){if(!c)return;const p=_r.from("getAllResponseHeaders"in c&&c.getAllResponseHeaders()),f={data:!s||s==="text"||s==="json"?c.responseText:c.response,status:c.status,statusText:c.statusText,headers:p,config:n,request:c};z1(function(d){e(d),a()},function(d){t(d),a()},f),c=null}if("onloadend"in c?c.onloadend=u:c.onreadystatechange=function(){!c||c.readyState!==4||c.status===0&&!(c.responseURL&&c.responseURL.indexOf("file:")===0)||setTimeout(u)},c.onabort=function(){!c||(t(new Ve("Request aborted",Ve.ECONNABORTED,n,c)),c=null)},c.onerror=function(){t(new Ve("Network Error",Ve.ERR_NETWORK,n,c)),c=null},c.ontimeout=function(){let p=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const f=n.transitional||zg;n.timeoutErrorMessage&&(p=n.timeoutErrorMessage),t(new Ve(p,f.clarifyTimeoutError?Ve.ETIMEDOUT:Ve.ECONNABORTED,n,c)),c=null},sr.isStandardBrowserEnv){const p=(n.withCredentials||G1(l))&&n.xsrfCookieName&&H1.read(n.xsrfCookieName);p&&i.set(n.xsrfHeaderName,p)}r===void 0&&i.setContentType(null),"setRequestHeader"in c&&X.forEach(i.toJSON(),function(p,f){c.setRequestHeader(f,p)}),X.isUndefined(n.withCredentials)||(c.withCredentials=!!n.withCredentials),s&&s!=="json"&&(c.responseType=n.responseType),typeof n.onDownloadProgress=="function"&&c.addEventListener("progress",sp(n.onDownloadProgress,!0)),typeof n.onUploadProgress=="function"&&c.upload&&c.upload.addEventListener("progress",sp(n.onUploadProgress)),(n.cancelToken||n.signal)&&(o=p=>{!c||(t(!p||p.type?new vo(null,n,c):p),c.abort(),c=null)},n.cancelToken&&n.cancelToken.subscribe(o),n.signal&&(n.signal.aborted?o():n.signal.addEventListener("abort",o)));const h=Q1(l);if(h&&sr.protocols.indexOf(h)===-1){t(new Ve("Unsupported protocol "+h+":",Ve.ERR_BAD_REQUEST,n));return}c.send(r||null)})},ha={http:A1,xhr:eE};X.forEach(ha,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch(t){}Object.defineProperty(n,"adapterName",{value:e})}});const tE={getAdapter:n=>{n=X.isArray(n)?n:[n];const{length:e}=n;let t,r;for(let i=0;i<e&&(t=n[i],!(r=X.isString(t)?ha[t.toLowerCase()]:t));i++);if(!r)throw r===!1?new Ve(`Adapter ${t} is not supported by the environment`,"ERR_NOT_SUPPORT"):new Error(X.hasOwnProp(ha,t)?`Adapter '${t}' is not available in the build`:`Unknown adapter '${t}'`);if(!X.isFunction(r))throw new TypeError("adapter is not a function");return r},adapters:ha};function wl(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new vo(null,n)}function op(n){return wl(n),n.headers=_r.from(n.headers),n.data=bl.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),tE.getAdapter(n.adapter||Vh.adapter)(n).then(function(e){return wl(n),e.data=bl.call(n,n.transformResponse,e),e.headers=_r.from(e.headers),e},function(e){return Jg(e)||(wl(n),e&&e.response&&(e.response.data=bl.call(n,n.transformResponse,e.response),e.response.headers=_r.from(e.response.headers))),Promise.reject(e)})}const ap=n=>n instanceof _r?n.toJSON():n;function ls(n,e){e=e||{};const t={};function r(l,u,h){return X.isPlainObject(l)&&X.isPlainObject(u)?X.merge.call({caseless:h},l,u):X.isPlainObject(u)?X.merge({},u):X.isArray(u)?u.slice():u}function i(l,u,h){if(X.isUndefined(u)){if(!X.isUndefined(l))return r(void 0,l,h)}else return r(l,u,h)}function s(l,u){if(!X.isUndefined(u))return r(void 0,u)}function o(l,u){if(X.isUndefined(u)){if(!X.isUndefined(l))return r(void 0,l)}else return r(void 0,u)}function a(l,u,h){if(h in e)return r(l,u);if(h in n)return r(void 0,l)}const c={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(l,u)=>i(ap(l),ap(u),!0)};return X.forEach(Object.keys(Object.assign({},n,e)),function(l){const u=c[l]||i,h=u(n[l],e[l],l);X.isUndefined(h)&&u!==a||(t[l]=h)}),t}const Gg="1.4.0",Kh={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{Kh[n]=function(t){return typeof t===n||"a"+(e<1?"n ":" ")+n}});const cp={};Kh.transitional=function(n,e,t){function r(i,s){return"[Axios v"+Gg+"] Transitional option '"+i+"'"+s+(t?". "+t:"")}return(i,s,o)=>{if(n===!1)throw new Ve(r(s," has been removed"+(e?" in "+e:"")),Ve.ERR_DEPRECATED);return e&&!cp[s]&&(cp[s]=!0,console.warn(r(s," has been deprecated since v"+e+" and will be removed in the near future"))),n?n(i,s,o):!0}};function nE(n,e,t){if(typeof n!="object")throw new Ve("options must be an object",Ve.ERR_BAD_OPTION_VALUE);const r=Object.keys(n);let i=r.length;for(;i-- >0;){const s=r[i],o=e[s];if(o){const a=n[s],c=a===void 0||o(a,s,n);if(c!==!0)throw new Ve("option "+s+" must be "+c,Ve.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new Ve("Unknown option "+s,Ve.ERR_BAD_OPTION)}}const Au={assertOptions:nE,validators:Kh},qr=Au.validators;class Wa{constructor(e){this.defaults=e,this.interceptors={request:new rp,response:new rp}}request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=ls(this.defaults,t);const{transitional:r,paramsSerializer:i,headers:s}=t;r!==void 0&&Au.assertOptions(r,{silentJSONParsing:qr.transitional(qr.boolean),forcedJSONParsing:qr.transitional(qr.boolean),clarifyTimeoutError:qr.transitional(qr.boolean)},!1),i!=null&&(X.isFunction(i)?t.paramsSerializer={serialize:i}:Au.assertOptions(i,{encode:qr.function,serialize:qr.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o;o=s&&X.merge(s.common,s[t.method]),o&&X.forEach(["delete","get","head","post","put","patch","common"],d=>{delete s[d]}),t.headers=_r.concat(o,s);const a=[];let c=!0;this.interceptors.request.forEach(function(d){typeof d.runWhen=="function"&&d.runWhen(t)===!1||(c=c&&d.synchronous,a.unshift(d.fulfilled,d.rejected))});const l=[];this.interceptors.response.forEach(function(d){l.push(d.fulfilled,d.rejected)});let u,h=0,p;if(!c){const d=[op.bind(this),void 0];for(d.unshift.apply(d,a),d.push.apply(d,l),p=d.length,u=Promise.resolve(t);h<p;)u=u.then(d[h++],d[h++]);return u}p=a.length;let f=t;for(h=0;h<p;){const d=a[h++],y=a[h++];try{f=d(f)}catch(_){y.call(this,_);break}}try{u=op.call(this,f)}catch(d){return Promise.reject(d)}for(h=0,p=l.length;h<p;)u=u.then(l[h++],l[h++]);return u}getUri(e){e=ls(this.defaults,e);const t=Yg(e.baseURL,e.url);return Wg(t,e.params,e.paramsSerializer)}}X.forEach(["delete","get","head","options"],function(n){Wa.prototype[n]=function(e,t){return this.request(ls(t||{},{method:n,url:e,data:(t||{}).data}))}});X.forEach(["post","put","patch"],function(n){function e(t){return function(r,i,s){return this.request(ls(s||{},{method:n,headers:t?{"Content-Type":"multipart/form-data"}:{},url:r,data:i}))}}Wa.prototype[n]=e(),Wa.prototype[n+"Form"]=e(!0)});const fa=Wa;class Wh{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(i){t=i});const r=this;this.promise.then(i=>{if(!r._listeners)return;let s=r._listeners.length;for(;s-- >0;)r._listeners[s](i);r._listeners=null}),this.promise.then=i=>{let s;const o=new Promise(a=>{r.subscribe(a),s=a}).then(i);return o.cancel=function(){r.unsubscribe(s)},o},e(function(i,s,o){r.reason||(r.reason=new vo(i,s,o),t(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}static source(){let e;return{token:new Wh(function(t){e=t}),cancel:e}}}const rE=Wh;function iE(n){return function(e){return n.apply(null,e)}}function sE(n){return X.isObject(n)&&n.isAxiosError===!0}const Ou={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Ou).forEach(([n,e])=>{Ou[e]=n});const oE=Ou;function Qg(n){const e=new fa(n),t=Cg(fa.prototype.request,e);return X.extend(t,fa.prototype,e,{allOwnKeys:!0}),X.extend(t,e,null,{allOwnKeys:!0}),t.create=function(r){return Qg(ls(n,r))},t}const kt=Qg(Vh);kt.Axios=fa;kt.CanceledError=vo;kt.CancelToken=rE;kt.isCancel=Jg;kt.VERSION=Gg;kt.toFormData=gc;kt.AxiosError=Ve;kt.Cancel=kt.CanceledError;kt.all=function(n){return Promise.all(n)};kt.spread=iE;kt.isAxiosError=sE;kt.mergeConfig=ls;kt.AxiosHeaders=_r;kt.formToJSON=n=>Hg(X.isHTMLForm(n)?new FormData(n):n);kt.HttpStatusCode=oE;kt.default=kt;const aE=kt,lp={init:({API_KEY:n})=>(...e)=>K(void 0,[...e],function*(t="post",r="/",i={},s={}){var o,a,c,l;const u=localStorage.getItem("accessToken");let h={Accept:"application/json","Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Key":n,"Access-Control-Allow-Methods":"POST, GET, OPTIONS, PUT, DELETE, HEAD,PATCH","Access-Control-Allow-Headers":"X-PINGOTHER, Origin, X-Requested-With, Content-Type, Accept","Access-Control-Max-Age":"1728000"};u&&(h.Authorization="Bearer "+u);const p=r;typeof(i==null?void 0:i.get)=="function"&&(i==null?void 0:i.get("file"))&&(h["Content-Type"]="multipart/form-data"),s!=null&&s.headers&&(h=Object.assign(...h,...s.headers),delete s.headers);const f=Object.assign({mode:"cors",method:t,url:p,data:i,headers:h},s);let d={};try{const y=yield aE(f);d.data=((o=y==null?void 0:y.data)==null?void 0:o.data)||(y==null?void 0:y.data),d.data||(d.data={})}catch(y){d.error=((c=(a=y.response)==null?void 0:a.data)==null?void 0:c.error)||((l=y.response)==null?void 0:l.error),d.error||(d.error={})}return d})};let Fo;const cE=new Uint8Array(16);function lE(){if(!Fo&&(Fo=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Fo))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Fo(cE)}const Dt=[];for(let n=0;n<256;++n)Dt.push((n+256).toString(16).slice(1));function uE(n,e=0){return(Dt[n[e+0]]+Dt[n[e+1]]+Dt[n[e+2]]+Dt[n[e+3]]+"-"+Dt[n[e+4]]+Dt[n[e+5]]+"-"+Dt[n[e+6]]+Dt[n[e+7]]+"-"+Dt[n[e+8]]+Dt[n[e+9]]+"-"+Dt[n[e+10]]+Dt[n[e+11]]+Dt[n[e+12]]+Dt[n[e+13]]+Dt[n[e+14]]+Dt[n[e+15]]).toLowerCase()}const hE=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),up={randomUUID:hE};function kl(n,e,t){if(up.randomUUID&&!e&&!n)return up.randomUUID();n=n||{};const r=n.random||(n.rng||lE)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let i=0;i<16;++i)e[t+i]=r[i];return e}return uE(r)}var Xg={exports:{}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function i(c,l,u){this.fn=c,this.context=l,this.once=u||!1}function s(c,l,u,h,p){if(typeof u!="function")throw new TypeError("The listener must be a function");var f=new i(u,h||c,p),d=t?t+l:l;return c._events[d]?c._events[d].fn?c._events[d]=[c._events[d],f]:c._events[d].push(f):(c._events[d]=f,c._eventsCount++),c}function o(c,l){--c._eventsCount===0?c._events=new r:delete c._events[l]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var c=[],l,u;if(this._eventsCount===0)return c;for(u in l=this._events)e.call(l,u)&&c.push(t?u.slice(1):u);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(l)):c},a.prototype.listeners=function(c){var l=t?t+c:c,u=this._events[l];if(!u)return[];if(u.fn)return[u.fn];for(var h=0,p=u.length,f=new Array(p);h<p;h++)f[h]=u[h].fn;return f},a.prototype.listenerCount=function(c){var l=t?t+c:c,u=this._events[l];return u?u.fn?1:u.length:0},a.prototype.emit=function(c,l,u,h,p,f){var d=t?t+c:c;if(!this._events[d])return!1;var y=this._events[d],_=arguments.length,S,I;if(y.fn){switch(y.once&&this.removeListener(c,y.fn,void 0,!0),_){case 1:return y.fn.call(y.context),!0;case 2:return y.fn.call(y.context,l),!0;case 3:return y.fn.call(y.context,l,u),!0;case 4:return y.fn.call(y.context,l,u,h),!0;case 5:return y.fn.call(y.context,l,u,h,p),!0;case 6:return y.fn.call(y.context,l,u,h,p,f),!0}for(I=1,S=new Array(_-1);I<_;I++)S[I-1]=arguments[I];y.fn.apply(y.context,S)}else{var B=y.length,j;for(I=0;I<B;I++)switch(y[I].once&&this.removeListener(c,y[I].fn,void 0,!0),_){case 1:y[I].fn.call(y[I].context);break;case 2:y[I].fn.call(y[I].context,l);break;case 3:y[I].fn.call(y[I].context,l,u);break;case 4:y[I].fn.call(y[I].context,l,u,h);break;default:if(!S)for(j=1,S=new Array(_-1);j<_;j++)S[j-1]=arguments[j];y[I].fn.apply(y[I].context,S)}}return!0},a.prototype.on=function(c,l,u){return s(this,c,l,u,!1)},a.prototype.once=function(c,l,u){return s(this,c,l,u,!0)},a.prototype.removeListener=function(c,l,u,h){var p=t?t+c:c;if(!this._events[p])return this;if(!l)return o(this,p),this;var f=this._events[p];if(f.fn)f.fn===l&&(!h||f.once)&&(!u||f.context===u)&&o(this,p);else{for(var d=0,y=[],_=f.length;d<_;d++)(f[d].fn!==l||h&&!f[d].once||u&&f[d].context!==u)&&y.push(f[d]);y.length?this._events[p]=y.length===1?y[0]:y:o(this,p)}return this},a.prototype.removeAllListeners=function(c){var l;return c?(l=t?t+c:c,this._events[l]&&o(this,l)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,n.exports=a})(Xg);const fE=Xg.exports;function xl(n,e){try{n(e)}catch(t){console.error("Error in subscription callback",t)}}const Vr=Symbol("subscriptions"),Kr=Symbol("oneTimeEvents");class us{constructor(){this[Vr]=[],this[Kr]=new Map}on(e,t){return this[Kr].has(e)?xl(t,this[Kr].get(e)):(this[Vr].push({event:e,callback:t,once:!1}),this)}off(e,t){return this[Vr]=this[Vr].filter(r=>r.event!==e||t&&r.callback!==t),this}once(e,t){return new Promise(r=>{const i=s=>{r(s),t==null||t(s)};this[Kr].has(e)?xl(i,this[Kr].get(e)):this[Vr].push({event:e,callback:i,once:!0})})}emit(e,t){if(this[Kr].has(e))throw new Error(`Event "${e}" was supposed to be emitted only once`);for(let r=0;r<this[Vr].length;r++){const i=this[Vr][r];i.event===e&&(xl(i.callback,t),i.once&&(this[Vr].splice(r,1),r--))}return this}emitOnce(e,t){if(this[Kr].has(e))throw new Error(`Event "${e}" was supposed to be emitted only once`);return this.emit(e,t),this[Kr].set(e,t),this.off(e),this}pipe(e,t){this.on(e,r=>{t.emit(e,r)})}pipeOnce(e,t){this.once(e,r=>{t.emitOnce(e,r)})}}function Wr(n){return n=n.replace(/\[/g,"/[").replace(/^\/+/,"").replace(/\/+$/,""),n.length===0?[]:n.split("/").map(e=>e.startsWith("[")?parseInt(e.slice(1,-1)):e)}class J{static get(e){return new J(e)}static getChildPath(e,t){return J.get(e).child(t).path}static getPathKeys(e){return Wr(e)}constructor(e){typeof e=="string"?this.keys=Wr(e):e instanceof Array&&(this.keys=e),this.path=this.keys.reduce((t,r,i)=>i===0?`${r}`:typeof r=="string"?`${t}/${r}`:`${t}[${r}]`,"")}get key(){return this.keys.length===0?null:this.keys.slice(-1)[0]}get parent(){if(this.keys.length==0)return null;const e=this.keys.slice(0,-1);return new J(e)}get parentPath(){return this.keys.length===0?null:this.parent.path}child(e){if(typeof e=="string"){if(e.length===0)throw new Error(`child key for path "${this.path}" cannot be empty`);const t=Wr(e);t.forEach(r=>{if(typeof r=="string"){if(/[\x00-\x08\x0b\x0c\x0e-\x1f/[\]\\]/.test(r))throw new Error(`Invalid child key "${r}" for path "${this.path}". Keys cannot contain control characters or any of the following characters: \\ / [ ]`);if(r.length>128)throw new Error(`child key "${r}" for path "${this.path}" is too long. Max key length is 128`);if(r.length===0)throw new Error(`child key for path "${this.path}" cannot be empty`)}}),e=t}return new J(this.keys.concat(e))}childPath(e){return this.child(e).path}get pathKeys(){return this.keys}static extractVariables(e,t){if(!e.includes("*")&&!e.includes("$"))return[];const r=Wr(e),i=Wr(t);let s=0;const o={get length(){return s}};return r.forEach((a,c)=>{const l=i[c];if(a==="*")o[s++]=l;else if(typeof a=="string"&&a[0]==="$"){o[s++]=l,o[a]=l;const u=a.slice(1);typeof o[u]=="undefined"&&(o[u]=l)}}),o}static fillVariables(e,t){if(e.indexOf("*")<0&&e.indexOf("$")<0)return e;const r=Wr(e),i=Wr(t),s=r.map((a,c)=>{if(a===i[c]||c>=i.length)return a;if(typeof a=="string"&&(a==="*"||a[0]==="$"))return i[c];throw new Error(`Path "${t}" cannot be used to fill variables of path "${e}" because they do not match`)});let o="";return s.forEach(a=>{typeof a=="number"?o+=`[${a}]`:(o.length>0&&(o+="/"),o+=a)}),o}static fillVariables2(e,t){if(typeof t!="object"||Object.keys(t).length===0)return e;const r=Wr(e);let i=0;return r.reduce((s,o)=>typeof o=="string"&&(o==="*"||o.startsWith("$"))?J.getChildPath(s,t[i++]):J.getChildPath(s,o),"")}equals(e){const t=e instanceof J?e:new J(e);return this.path===t.path?!0:this.keys.length!==t.keys.length?!1:this.keys.every((r,i)=>{const s=t.keys[i];return s===r||typeof s=="string"&&(s==="*"||s[0]==="$")||typeof r=="string"&&(r==="*"||r[0]==="$")})}isAncestorOf(e){const t=e instanceof J?e:new J(e);return t.path===""||this.path===t.path?!1:this.path===""?!0:this.keys.length>=t.keys.length?!1:this.keys.every((r,i)=>{const s=t.keys[i];return s===r||typeof s=="string"&&(s==="*"||s[0]==="$")||typeof r=="string"&&(r==="*"||r[0]==="$")})}isDescendantOf(e){const t=e instanceof J?e:new J(e);return this.path===""||this.path===t.path?!1:e===""?!0:t.keys.length>=this.keys.length?!1:t.keys.every((r,i)=>{const s=this.keys[i];return s===r||typeof s=="string"&&(s==="*"||s[0]==="$")||typeof r=="string"&&(r==="*"||r[0]==="$")})}isOnTrailOf(e){const t=e instanceof J?e:new J(e);return this.path.length===0||t.path.length===0||this.path===t.path?!0:this.pathKeys.every((r,i)=>{if(i>=t.keys.length)return!0;const s=t.keys[i];return s===r||typeof s=="string"&&(s==="*"||s[0]==="$")||typeof r=="string"&&(r==="*"||r[0]==="$")})}isChildOf(e){const t=e instanceof J?e:new J(e);return this.path===""?!1:this.parent.equals(t)}isParentOf(e){const t=e instanceof J?e:new J(e);return t.path===""?!1:this.equals(t.parent)}}function El(n,e,t=!1){if(!n.exists())return null;let r=t?n.previous():n.val();return typeof e=="number"?r[e]:(J.getPathKeys(e).every(i=>(r=r[i],typeof r!="undefined")),r||null)}function _l(n){if(!n.exists())return[];const e=n.val();return e instanceof Array?new Array(e.length).map((t,r)=>r):typeof e=="object"?Object.keys(e):[]}class rt{exists(){return!1}constructor(e,t,r=!1,i,s){this.ref=e,this.val=()=>t,this.previous=()=>i,this.exists=()=>r?!1:t!==null&&typeof t!="undefined",this.context=()=>s||{}}static for(e,t){return new rt(e,t)}child(e){const t=El(this,e,!1),r=El(this,e,!0);return new rt(this.ref.child(e),t,!1,r)}hasChild(e){return El(this,e)!==null}hasChildren(){return _l(this).length>0}numChildren(){return _l(this).length}forEach(e){const t=this.val(),r=this.previous();return _l(this).every(i=>{const s=new rt(this.ref.child(i),t[i],!1,r[i]);return e(s)})}get key(){return this.ref.key}}class da extends rt{constructor(e,t,r){super(e,t,!1,void 0,r),this.previous=()=>{throw new Error("Iterate values to get previous values for each mutation")},this.val=(i=!0)=>(i&&console.warn("Unless you know what you are doing, it is best not to use the value of a mutations snapshot directly. Use child methods and forEach to iterate the mutations instead"),t)}forEach(e){return this.val(!1).every(t=>{const r=t.target.reduce((s,o)=>s.child(o),this.ref),i=new rt(r,t.val,!1,t.prev);return e(i)})}child(e){if(typeof e!="number")throw new Error("child index must be a number");const t=this.val(!1)[e],r=t.target.reduce((i,s)=>i.child(s),this.ref);return new rt(r,t.val,!1,t.prev)}}class Zg{constructor(e){this.stop=e,this._internal={state:"init",activatePromises:[]}}activated(e){return e&&(this._internal.activatePromises.push({callback:e}),this._internal.state==="active"?e(!0):this._internal.state==="canceled"&&e(!1,this._internal.cancelReason)),new Promise((t,r)=>{if(this._internal.state==="active")return t();if(this._internal.state==="canceled"&&!e)return r(new Error(this._internal.cancelReason));const i=()=>{};this._internal.activatePromises.push({resolve:t,reject:e?i:r})})}_setActivationState(e,t){for(this._internal.cancelReason=t,this._internal.state=e?"active":"canceled";this._internal.activatePromises.length>0;){const r=this._internal.activatePromises.shift();e?(r.callback&&r.callback(!0),r.resolve&&r.resolve()):(r.callback&&r.callback(!1,t),r.reject&&r.reject(t))}}}class dE{constructor(e,t,r){this.publish=e,this.start=t,this.cancel=r}}class pE{constructor(e){const t=[];let r,i;const s="stopped (no more subscribers)";this.subscribe=(h,p)=>{if(typeof h!="function")throw new TypeError("callback must be a function");if(i===s)throw new Error("stream can't be used anymore because all subscribers were stopped");const f={callback:h,activationCallback:function(d,y){p==null||p(d,y),this.subscription._setActivationState(d,y)},subscription:new Zg(function(){return t.splice(t.indexOf(this),1),o()})};return t.push(f),typeof i!="undefined"&&(i===!0?(p==null||p(!0),f.subscription._setActivationState(!0)):typeof i=="string"&&(p==null||p(!1,i),f.subscription._setActivationState(!1,i))),f.subscription};const o=()=>{let h;return t.length===0&&(h=r==null?void 0:r(),i=s),Promise.resolve(h)};this.unsubscribe=h=>{(h?t.filter(p=>p.callback===h):t).forEach(p=>{const f=t.indexOf(p);t.splice(f,1)}),o()},this.stop=()=>{t.splice(0),o()};const a=h=>(t.forEach(p=>{try{p.callback(h)}catch(f){console.error(`Error running subscriber callback: ${f.message}`)}}),t.length===0&&o(),t.length>0),c=h=>{i=!0,r=h,t.forEach(p=>{var f;(f=p.activationCallback)==null||f.call(p,!0)})},l=h=>{i=h,t.forEach(p=>{var f;(f=p.activationCallback)==null||f.call(p,!1,h||new Error("unknown reason"))}),t.splice(0)},u=new dE(a,c,l);e(u)}}function zh(n,e){const t="000000000"+n;return t.substr(t.length-e)}const yE=typeof window=="object"?window:self,gE=Object.keys(yE).length;var hp,fp;const mE=(fp=(hp=navigator.mimeTypes)==null?void 0:hp.length)!=null?fp:0,vE=zh((mE+navigator.userAgent.length).toString(36)+gE.toString(36),4);function bE(){return vE}let Ts=0;const Hh=4,za=36,em=Math.pow(za,Hh);function dp(){return zh((Math.random()*em<<0).toString(za),Hh)}function wE(){return Ts=Ts<em?Ts:0,Ts++,Ts-1}function kE(n=0){const e="c",t=(new Date().getTime()+n).toString(za),r=zh(wE().toString(za),Hh),i=bE(),s=dp()+dp();return e+t+r+i+s}let pp=0;class Vt{static set timeBias(e){typeof e=="number"&&(pp=e)}static generate(){return kE(pp).slice(1)}}class it{constructor(e){this.path=e}}const Pn={nextTick(n){setTimeout(n,0)}};class Ha{constructor(e){if(e instanceof Array)for(let t=0;t<e.length;t++)typeof e[t]!="undefined"&&(this[t]=e[t]);else e&&Object.assign(this,e)}}function xE(n){const e=new Uint8Array(8);return new DataView(e.buffer).setFloat64(0,n),new Array(...e)}function EE(n){if((Array.isArray(n)?n.length:n.byteLength)!==8)throw new TypeError("must be 8 bytes");const e=new Uint8Array(n);return new DataView(e.buffer).getFloat64(0)}const ti={zero:BigInt(0),one:BigInt(1),two:BigInt(2),eight:BigInt(8),ff:BigInt(255)};function _E(n){if(typeof n!="bigint")throw new Error("number must be a bigint");const e=[],t=n<ti.zero;do{const r=Number(n&ti.ff);e.push(r),n=n>>ti.eight}while(n!==(t?-ti.one:ti.zero));return e.reverse(),(t?e[0]<128:e[0]>=128)&&e.unshift(t?255:0),e}function AE(n){const e=n[0]>=128;let t=ti.zero;for(let r of n)e&&(r=~r&255),t=(t<<ti.eight)+BigInt(r);return e&&(t=-(t+ti.one)),t}function OE(n){if(typeof TextEncoder!="undefined")return new TextEncoder().encode(n);if(typeof Buffer=="function"){const e=Buffer.from(n,"utf-8");return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}else{const e=[];for(let t=0;t<n.length;t++){let r=n.charCodeAt(t);if(r>128){if((r&55296)===55296){const i=n.charCodeAt(t+1);if((i&56320)!==56320)throw new Error("follow-up utf-16 character does not start with 0xDC00");t++;const s=r&1023,o=i&1023;r=65536|s<<10|o}if(r<2048){const i=192|r>>6&31,s=128|r&63;e.push(i,s)}else if(r<65536){const i=224|r>>12&15,s=128|r>>6&63,o=128|r&63;e.push(i,s,o)}else if(r<2097152){const i=240|r>>18&7,s=128|r>>12&63,o=128|r>>6&63,a=128|r&63;e.push(i,s,o,a)}else throw new Error(`Cannot convert character ${n.charAt(t)} (code ${r}) to utf-8`)}else e.push(r<128?r:63)}return new Uint8Array(e)}}function tm(n){if(typeof TextDecoder!="undefined"){const e=new TextDecoder;if(n instanceof Uint8Array)return e.decode(n);const t=Uint8Array.from(n);return e.decode(t)}else if(typeof Buffer=="function"){if(n instanceof Array&&(n=Uint8Array.from(n)),!(n instanceof Buffer)&&"buffer"in n&&n.buffer instanceof ArrayBuffer){const e=n;n=Buffer.from(e.buffer,e.byteOffset,e.byteLength)}if(!(n instanceof Buffer))throw new Error("Unsupported buffer argument");return n.toString("utf-8")}else{if(!(n instanceof Uint8Array)&&"buffer"in n&&n.buffer instanceof ArrayBuffer){const e=n;n=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}if(n instanceof Buffer||n instanceof Array||n instanceof Uint8Array){let e="";for(let t=0;t<n.length;t++){let r=n[t];if(r>128)if((r&240)===240){const i=r,s=n[t+1],o=n[t+2],a=n[t+3];r=(i&7)<<18|(s&63)<<12|(o&63)<<6|a&63,t+=3}else if((r&224)===224){const i=r,s=n[t+1],o=n[t+2];r=(i&15)<<12|(s&63)<<6|o&63,t+=2}else if((r&192)===192){const i=r,s=n[t+1];r=(i&31)<<6|s&63,t++}else throw new Error("invalid utf-8 data");if(r>=65536){r^=65536;const i=55296|r>>10,s=56320|r&1023;e+=String.fromCharCode(i),e+=String.fromCharCode(s)}else e+=String.fromCharCode(r)}return e}else throw new Error("Unsupported buffer argument")}}function SE(n,e){const t=new n.constructor(n.length+e.length);return t.set(n),t.set(e,n.length),t}function Wn(n,e){var t;if(((t=n==null?void 0:n.constructor)==null?void 0:t.name)==="DataSnapshot")throw new TypeError(`Object to clone is a DataSnapshot (path "${n.ref.path}")`);const r=o=>(o!==null&&typeof o=="object"&&typeof o.constructor=="function"&&typeof o.constructor.name=="string"&&["Buffer","Uint8Array","Int8Array","Uint16Array","Int16Array","Uint32Array","Int32Array","BigUint64Array","BigInt64Array"].includes(o.constructor.name)&&(o=o.buffer.slice(o.byteOffset,o.byteOffset+o.byteLength)),o);if(n=r(n),typeof n!="object"||n===null||n instanceof Date||n instanceof ArrayBuffer||n instanceof it||n instanceof RegExp)return n;const i=o=>{if(e.indexOf(o)>=0)throw new ReferenceError("object contains a circular reference");return o=r(o),o===null||o instanceof Date||o instanceof ArrayBuffer||o instanceof it||o instanceof RegExp||typeof o=="object"&&(e.push(o),o=Wn(o,e),e.pop()),o};typeof e=="undefined"&&(e=[n]);const s=n instanceof Array?[]:n instanceof Ha?new Ha:{};return Object.keys(n).forEach(o=>{const a=n[o];typeof a!="function"&&(s[o]=i(a))}),s}const ci=n=>typeof n=="object"&&["ArrayBuffer","Buffer","Uint8Array","Uint16Array","Uint32Array","Int8Array","Int16Array","Int32Array"].includes(n.constructor.name);function Ja(n,e){if(n===e)return!0;if(typeof n!=typeof e)return!1;if(typeof n=="object"||typeof e=="object"){if(n===null||e===null)return!1;if(n instanceof it||e instanceof it)return n instanceof it&&e instanceof it&&n.path===e.path;if(n instanceof Date||e instanceof Date)return n instanceof Date&&e instanceof Date&&n.getTime()===e.getTime();if(n instanceof Array||e instanceof Array)return n instanceof Array&&e instanceof Array&&n.length===e.length&&n.every((i,s)=>Ja(n[s],e[s]));if(ci(n)||ci(e)){if(!ci(n)||!ci(e)||n.byteLength===e.byteLength)return!1;const i=n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength),s=e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength);return i.every((o,a)=>s[a]===o)}const t=Object.keys(n),r=Object.keys(e);return t.length===r.length&&t.every(i=>r.includes(i))&&t.every(i=>Ja(n[i],e[i]))}return!1}class nm{constructor(e,t,r){this.added=e,this.removed=t,this.changed=r}forChild(e){if(this.added.includes(e))return"added";if(this.removed.includes(e))return"removed";const t=this.changed.find(r=>r.key===e);return t?t.change:"identical"}}function Jh(n,e,t=!1){const r=[void 0,null];if(n===e)return"identical";if(r.indexOf(n)>=0&&r.indexOf(e)<0)return"added";if(r.indexOf(n)<0&&r.indexOf(e)>=0)return"removed";if(typeof n!=typeof e)return"changed";if(ci(n)||ci(e)){if(!ci(n)||!ci(e))return"changed";const i=n instanceof Uint8Array?n:n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength),s=e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength);return i.byteLength===s.byteLength&&i.every((o,a)=>s[a]===o)?"identical":"changed"}else{if(n instanceof Date||e instanceof Date)return n instanceof Date&&e instanceof Date&&n.getTime()===e.getTime()?"identical":"changed";if(n instanceof it||e instanceof it)return n instanceof it&&e instanceof it&&n.path===e.path?"identical":"changed";if(typeof n=="object"){const i=n instanceof Array,s=h=>{let p=Object.keys(h).filter(f=>!r.includes(h[f]));return i&&(p=p.map(f=>parseInt(f))),p},o=s(n),a=s(e),c=o.filter(h=>!a.includes(h)),l=a.filter(h=>!o.includes(h)),u=a.reduce((h,p)=>{if(o.includes(p)){const f=n[p],d=e[p],y=Jh(f,d);y!=="identical"&&h.push({key:p,change:y})}return h},[]);return l.length===0&&c.length===0&&u.length===0?"identical":new nm(l,c,t?u.sort((h,p)=>h.key<p.key?-1:1):u)}}return"changed"}function rm(n,e,t=!1){const r=(s,o,a,c)=>{switch(o){case"identical":return[];case"changed":return[{target:s,prev:a,val:c}];case"added":return[{target:s,prev:null,val:c}];case"removed":return[{target:s,prev:a,val:null}];default:{let l=[];return o.added.forEach(u=>l.push({target:s.concat(u),prev:null,val:c[u]})),o.removed.forEach(u=>l.push({target:s.concat(u),prev:a[u],val:null})),o.changed.forEach(u=>{const h=r(s.concat(u.key),u.change,a[u.key],c[u.key]);l=l.concat(h)}),l}}},i=Jh(n,e,t);return r([],i,n,e)}function $E(n,e,t){return e=e===null?null:e[n],typeof e=="undefined"&&(e=null),t=t===null?null:t[n],typeof t=="undefined"&&(t=null),{oldValue:e,newValue:t}}function TE(n){Pn.nextTick(n)}function im(){var n;return typeof globalThis!="undefined"?globalThis:typeof global!="undefined"?global:typeof window!="undefined"?window:typeof self!="undefined"?self:(n=function(){return this}())!=null?n:Function("return this")()}const sm=Object.freeze(Object.defineProperty({__proto__:null,numberToBytes:xE,bytesToNumber:EE,bigintToBytes:_E,bytesToBigint:AE,encodeString:OE,decodeString:tm,concatTypedArrays:SE,cloneObject:Wn,valuesAreEqual:Ja,ObjectDifferences:nm,compareValues:Jh,getMutations:rm,getChildValues:$E,defer:TE,getGlobalObject:im},Symbol.toStringTag,{value:"Module"})),PE="modulepreload",IE=function(n){return"/"+n},yp={},RE=function(n,e,t){if(!e||e.length===0)return n();const r=document.getElementsByTagName("link");return Promise.all(e.map(i=>{if(i=IE(i),i in yp)return;yp[i]=!0;const s=i.endsWith(".css"),o=s?'[rel="stylesheet"]':"";if(t)for(let c=r.length-1;c>=0;c--){const l=r[c];if(l.href===i&&(!s||l.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${o}`))return;const a=document.createElement("link");if(a.rel=s?"stylesheet":PE,s||(a.as="script",a.crossOrigin=""),a.href=i,document.head.appendChild(a),s)return new Promise((c,l)=>{a.addEventListener("load",c),a.addEventListener("error",()=>l(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>n())};let om=!1,hi;K(void 0,null,function*(){const n=im();if(typeof n.Observable!="undefined"){hi=n.Observable;return}try{const{Observable:e}=yield RE(()=>Promise.resolve().then(()=>PS),void 0);hi=e}catch(e){hi=Gh}});function Yh(){if(hi===Gh&&!om&&console.warn(`Using AceBase's simple Observable implementation because rxjs is not available. Add it to your project with "npm install rxjs", add it to AceBase using db.setObservable(Observable), or call db.setObservable("shim") to suppress this warning`),hi)return hi;throw new Error("RxJS Observable could not be loaded. ")}function CE(n){n==="shim"?(hi=Gh,om=!0):hi=n}class Gh{constructor(e){this._active=!1,this._subscribers=[],this._create=e}subscribe(e){if(!this._active){const t={next:r=>{this._subscribers.forEach(i=>{try{i(r)}catch(s){console.error("Error in subscriber callback:",s)}})}};this._cleanup=this._create(t),this._active=!0}return this._subscribers.push(e),{unsubscribe:()=>{this._subscribers.splice(this._subscribers.indexOf(e),1),this._subscribers.length===0&&(this._active=!1,this._cleanup())}}}}class bn extends Array{static areEqual(e,t){return e.length===t.length&&e.every((r,i)=>t[i]===r)}static isAncestor(e,t){return e.length<t.length&&e.every((r,i)=>t[i]===r)}static isDescendant(e,t){return e.length>t.length&&t.every((r,i)=>e[i]===r)}}const xi=Symbol("isProxy");class NE{static create(e,t){return K(this,null,function*(){var r;e=new Jn(e.db,e.path);let i,s=!1,o=t==null?void 0:t.cursor,a;const c=Vt.generate(),l=[],u=new us;u.on("cursor",m=>o=m),u.on("error",m=>{console.error(m.message,m.details)});const h=(m,v)=>{if(m.length===0)return i=v,!0;let g=i;const k=m.slice();for(;k.length>1;){const b=k.shift();if(!(b in g))return!1;g=g[b]}const x=k.shift();return v===null?g instanceof Array?g.splice(x,1):delete g[x]:g[x]=v,!0},p=()=>K(this,null,function*(){!s||(yield E())}),f=e.on("mutations",{syncFallback:p}).subscribe(m=>K(this,null,function*(){var v;if(!s)return;const g=m.context(),k=((v=g.acebase_proxy)==null?void 0:v.id)!==c;!k||(m.val(!1).every(x=>{if(!h(x.target,x.val))return!1;const b=x.target.reduce((A,O)=>A.child(O),e),w=new rt(b,x.val,!1,x.prev,m.context());return u.emit("mutation",{snapshot:w,isRemote:k}),!0})?(u.emit("cursor",g.acebase_cursor),L.emit("mutations",{origin:"remote",snap:m})):(console.warn(`Cached value of live data proxy on "${e.path}" appears outdated, will be reloaded`),yield E()))}));let d=Promise.resolve();const y=[],_=[],S=()=>K(this,null,function*(){const m=[];for(let v=0,g=y[0];v<y.length;v++,g=y[v])_.find(k=>bn.areEqual(k.target,g.target)||bn.isAncestor(k.target,g.target))||(y.splice(v,1),v--,m.push(g));m.length!==0&&(m.forEach(v=>{v.value=Wn(An(i,v.target))}),Pn.nextTick(()=>{const v={acebase_proxy:{id:c,source:"update"}};m.forEach(k=>{const x=k.target.reduce((w,A)=>w.child(A),e),b=new rt(x,k.value,!1,k.previous,v);u.emit("mutation",{snapshot:b,isRemote:!1})});const g=new da(e,m.map(k=>({target:k.target,val:k.value,prev:k.previous})),v);L.emit("mutations",{origin:"local",snap:g})}),d=m.reduce((v,g,k,x)=>(x.some(b=>bn.isAncestor(b.target,g.target))||v.push(g),v),[]).reduce((v,g)=>{const k=g.target;if(k.length===0)v.push({ref:e,target:k,value:i,type:"set",previous:g.previous});else{const x=k.slice(0,-1),b=k.slice(-1)[0],w=x.reduce((P,N)=>P.child(N),e),A=v.find(P=>P.ref.path===w.path),O=An(i,k),$=g.previous;A?(A.value[b]=O,A.previous[b]=$):v.push({ref:w,target:x,value:{[b]:O},type:"update",previous:{[b]:$}})}return v},[]).reduce((v,g)=>K(this,null,function*(){const k={acebase_proxy:{id:c,source:g.type}};yield v,yield g.ref.context(k)[g.type](g.value).catch(x=>{u.emit("error",{source:"update",message:`Error processing update of "/${e.path}"`,details:x});const b={acebase_proxy:{id:c,source:"update-rollback"}},w=[];if(g.type==="set"){Al(i,g.target,g.previous);const O=new rt(g.ref,g.previous,!1,g.value,b);u.emit("mutation",{snapshot:O,isRemote:!1}),w.push({target:g.target,val:g.previous,prev:g.value})}else Object.keys(g.previous).forEach(O=>{Al(i,g.target.concat(O),g.previous[O]);const $=new rt(g.ref.child(O),g.previous[O],!1,g.value[O],b);u.emit("mutation",{snapshot:$,isRemote:!1}),w.push({target:g.target.concat(O),val:g.previous[O],prev:g.value[O]})});w.forEach(O=>{const $=O.target.reduce((N,D)=>N.child(D),e),P=new rt($,O.val,!1,O.prev,b);u.emit("mutation",{snapshot:P,isRemote:!1})});const A=new da(g.ref,w,b);L.emit("mutations",{origin:"local",snap:A})}),g.ref.cursor&&u.emit("cursor",g.ref.cursor)}),d),yield d)});let I=!1;const B=[],j=()=>{let m;const v=new Promise(g=>m=g);return B.push({resolve:m}),v};let U=null;const M=()=>{U||(U=setTimeout(()=>K(this,null,function*(){I=!0,U=null,yield S(),I=!1,B.splice(0).forEach(m=>m.resolve())}),0))},H=m=>{y.find(v=>bn.areEqual(v.target,m))||y.push({target:m,previous:Wn(An(i,m))}),M()},L=new us,F=(m,v)=>{const g=b=>b!==null&&typeof b=="object",k=b=>K(this,null,function*(){var w;const{snap:A,origin:O}=b,$=A.context(),P=((w=$.acebase_proxy)==null?void 0:w.id)===c;if(b.origin==="remote"&&P){console.error("DEV ISSUE: mutationsHandler was called from remote event originating from our own proxy");return}const N=A.val(!1).filter(ne=>ne.target.slice(0,m.length).every((te,ue)=>m[ue]===te));if(N.length===0)return;let D,z;const q=N.find(ne=>ne.target.length<=m.length);if(q){const ne=m.slice(q.target.length);D=ne.reduce((te,ue)=>!g(te)||!(ue in te)?null:te[ue],q.val),z=ne.reduce((te,ue)=>!g(te)||!(ue in te)?null:te[ue],q.prev)}else{const ne=An(i,m);D=Wn(ne),z=Wn(D),N.forEach(te=>{const ue=te.target.slice(m.length);for(let le=0,ie=D,pe=z;le<ue.length;le++){const ke=le+1===ue.length,ve=ue[le];ke?(ie[ve]=te.val,ie[ve]===null&&delete ie[ve],pe[ve]=te.prev,pe[ve]===null&&delete pe[ve]):(ie=ie[ve]=ve in ie?ie[ve]:{},pe=pe[ve]=ve in pe?pe[ve]:{})}})}Pn.nextTick(()=>{let ne=!0;try{ne=v(Object.freeze(D),Object.freeze(z),!P,$)!==!1}catch(te){u.emit("error",{source:O==="remote"?"remote_update":"local_update",message:"Error running subscription callback",details:te})}ne===!1&&x()})});L.on("mutations",k);const x=()=>{L.off("mutations",k),l.splice(l.findIndex(b=>b.stop===x),1)};return l.push({target:m,stop:x}),{stop:x}},T=(m,v,g)=>{if(m==="write")return H(v);if(m==="onChange")return F(v,g.callback);if(m==="subscribe"||m==="observe"){const k=b=>{const w=An(i,v);b.next(w);const A=F(v,O=>{b.next(O)});return function(){A.stop()}};if(m==="subscribe")return k;const x=Yh();return new x(k)}else if(m==="transaction")return _.some(k=>bn.areEqual(v,k.target)||bn.isAncestor(v,k.target)||bn.isDescendant(v,k.target))?Promise.reject(new Error("Cannot start transaction because it conflicts with another transaction")):new Promise(k=>K(this,null,function*(){y.some(b=>bn.areEqual(v,b.target)||bn.isAncestor(v,b.target))&&(I||M(),yield j());const x={target:v,status:"started",transaction:null};_.push(x),x.transaction={get status(){return x.status},get completed(){return x.status!=="started"},get mutations(){return y.filter(b=>bn.areEqual(x.target,b.target)||bn.isAncestor(x.target,b.target))},get hasMutations(){return this.mutations.length>0},commit(){return K(this,null,function*(){if(this.completed)throw new Error(`Transaction has completed already (status '${x.status}')`);x.status="finished",_.splice(_.indexOf(x),1),I&&(yield j()),M(),yield j()})},rollback(){if(this.completed)throw new Error(`Transaction has completed already (status '${x.status}')`);x.status="canceled";const b=[];for(let w=0;w<y.length;w++){const A=y[w];(bn.areEqual(x.target,A.target)||bn.isAncestor(x.target,A.target))&&(y.splice(w,1),w--,b.push(A))}b.reverse().forEach(w=>{w.target.length===0?i=w.previous:Al(i,w.target,w.previous)}),_.splice(_.indexOf(x),1)}},k(x.transaction)}))},R=yield e.get({cache_mode:"allow",cache_cursor:t==null?void 0:t.cursor});if(R.context().acebase_origin!=="cache"&&u.emit("cursor",(r=e.cursor)!=null?r:null),s=!0,i=R.val(),i===null&&typeof(t==null?void 0:t.defaultValue)!="undefined"){i=t.defaultValue;const m={acebase_proxy:{id:c,source:"default"}};yield e.context(m).set(i)}a=am({root:{ref:e,get cache(){return i}},target:[],id:c,flag:T});const C=()=>{if(a===null)throw new Error("Proxy was destroyed")},E=()=>K(this,null,function*(){C(),y.splice(0);const m=yield e.get({allow_cache:!1}),v=i,g=m.val();i=g;const k=rm(v,g);if(k.length===0)return;const x=m.context();x.acebase_proxy={id:c,source:"reload"},k.forEach(w=>{const A=Su(e,w.target),O=new rt(A,w.val,w.val===null,w.prev,x);u.emit("mutation",{snapshot:O,isRemote:!0})});const b=new da(e,k,x);L.emit("mutations",{origin:"local",snap:b})});return{destroy(){return K(this,null,function*(){yield d;const m=[f.stop(),...l.map(v=>v.stop())];yield Promise.all(m),["cursor","mutation","error"].forEach(v=>u.off(v)),i=null,a=null})},stop(){this.destroy()},get value(){return C(),a},get hasValue(){return C(),i!==null},set value(m){C(),m!==null&&typeof m=="object"&&m[xi]&&(m=m.valueOf()),H([]),i=m},get ref(){return e},get cursor(){return o},reload:E,onMutation(m){C(),u.off("mutation"),u.on("mutation",({snapshot:v,isRemote:g})=>{try{m(v,g)}catch(k){u.emit("error",{source:"mutation_callback",message:"Error in dataproxy onMutation callback",details:k})}})},onError(m){C(),u.off("error"),u.on("error",v=>{try{m(v)}catch(g){console.error(`Error in dataproxy onError callback: ${g.message}`)}})},on(m,v){u.on(m,v)},off(m,v){u.off(m,v)}}})}}function An(n,e){let t=n;for(const r of e)t=typeof t=="object"&&t!==null&&r in t?t[r]:null;return t}function Al(n,e,t){if(e.length===0)throw new Error("Cannot update root target, caller must do that itself!");const r=e.slice(0,-1).reduce((s,o)=>s[o],n),i=e.slice(-1)[0];t===null||typeof t=="undefined"?r instanceof Array?r.splice(i,1):delete r[i]:r[i]=t}function Su(n,e){const t=J.get(n.path).childPath(e);return new Jn(n.db,t)}function am(n){const e=Su(n.root.ref,n.target),t=[],r={get(s,o,a){if(s=An(n.root.cache,n.target),typeof o=="symbol")if(o.toString()===Symbol.iterator.toString())o="values";else return o.toString()===xi.toString()?!0:Reflect.get(s,o,a);if(o==="valueOf")return function(){return s};if(s===null||typeof s!="object")throw new Error(`Cannot read property "${o}" of ${s}. Value of path "/${e.path}" is not an object (anymore)`);s instanceof Array&&typeof o=="string"&&/^[0-9]+$/.test(o)&&(o=parseInt(o));const c=s[o];if(c===null){delete s[o];return}const l=t.find(f=>f.prop===o);if(l){if(l.typeof===typeof c)return l.value;t.splice(t.indexOf(l),1)}const u=f=>{const d=s[f],y=t.find(S=>S.prop===f);if(y){if(y.typeof===typeof d)return y.value;t.splice(t.indexOf(y),1)}if(typeof d!="object")return d;const _=am({root:n.root,target:n.target.concat(f),id:n.id,flag:n.flag});return t.push({typeof:typeof d,prop:f,value:_}),_},h=f=>f!==null&&typeof f=="object"&&f[xi]?f.getTarget():f;if(["string","number","boolean"].includes(typeof c)||c instanceof Date||c instanceof it||c instanceof ArrayBuffer||typeof c=="object"&&"buffer"in c)return c;const p=s instanceof Array;if(o==="toString")return function(){return`[LiveDataProxy for "${e.path}"]`};if(typeof c=="undefined")return o==="push"?function(f){const d=e.push();return n.flag("write",n.target.concat(d.key)),s[d.key]=f,d.key}:o==="getTarget"?function(f=!0){return f&&console.warn("Use getTarget with caution - any changes will not be synchronized!"),s}:o==="getRef"?function(){return Su(n.root.ref,n.target)}:o==="forEach"?function(f){const d=Object.keys(s);let y=!1;for(let _=0;!y&&_<d.length;_++){const S=d[_],I=u(S);y=f(I,S,_)===!1}}:["values","entries","keys"].includes(o)?function*(){const f=Object.keys(s);for(const d of f)if(o==="keys")yield d;else{const y=u(d);o==="entries"?yield[d,y]:yield y}}:o==="toArray"?function(f){const d=Object.keys(s).map(y=>u(y));return f&&d.sort(f),d}:o==="onChanged"?function(f){return n.flag("onChange",n.target,{callback:f})}:o==="subscribe"?function(){return n.flag("subscribe",n.target)}:o==="getObservable"?function(){return n.flag("observe",n.target)}:o==="getOrderedCollection"?function(f,d){return new jE(this,f,d)}:o==="startTransaction"?function(){return n.flag("transaction",n.target)}:o==="remove"&&!p?function(){if(n.target.length===0)throw new Error("Can't remove proxy root value");const f=An(n.root.cache,n.target.slice(0,-1)),d=n.target.slice(-1)[0];n.flag("write",n.target),delete f[d]}:void 0;if(typeof c=="function"){if(p){const f=y=>(n.flag("write",n.target),y()),d=y=>y.map(_=>(_=h(_),$u(_),_));if(o==="push")return function(...y){return y=d(y),f(()=>s.push(...y))};if(o==="pop")return function(){return f(()=>s.pop())};if(o==="splice")return function(y,_,...S){return S=d(S),f(()=>s.splice(y,_,...S))};if(o==="shift")return function(){return f(()=>s.shift())};if(o==="unshift")return function(...y){return y=d(y),f(()=>s.unshift(...y))};if(o==="sort")return function(y){return f(()=>s.sort(y))};if(o==="reverse")return function(){return f(()=>s.reverse())};if(["indexOf","lastIndexOf"].includes(o))return function(y,_){return y!==null&&typeof y=="object"&&y[xi]&&(y=y.getTarget(!1)),s[o](y,_)};if(["forEach","every","some","filter","map"].includes(o))return function(y){return s[o]((_,S)=>y(u(S),S,i))};if(["reduce","reduceRight"].includes(o))return function(y,_){return s[o]((S,I,B)=>y(S,u(B),B,i),_)};if(["find","findIndex"].includes(o))return function(y){let _=s[o]((S,I)=>y(u(I),I,i));if(o==="find"&&_){const S=s.indexOf(_);_=u(S)}return _};if(["values","entries","keys"].includes(o))return function*(){for(let y=0;y<s.length;y++)if(o==="keys")yield y;else{const _=u(y);o==="entries"?yield[y,_]:yield _}}}return c}return u(o)},set(s,o,a,c){if(s=An(n.root.cache,n.target),typeof o=="symbol")return Reflect.set(s,o,a,c);if(s===null||typeof s!="object")throw new Error(`Cannot set property "${o}" of ${s}. Value of path "/${e.path}" is not an object`);if(s instanceof Array&&typeof o=="string"){if(!/^[0-9]+$/.test(o))throw new Error(`Cannot set property "${o}" on array value of path "/${e.path}"`);o=parseInt(o)}return a!==null&&(typeof a=="object"&&(a[xi]&&(a=a.valueOf()),a=Wn(a)),Ja(a,s[o]))||(n.target.some(l=>typeof l=="number")?n.flag("write",n.target.slice(0,n.target.findIndex(l=>typeof l=="number"))):s instanceof Array?n.flag("write",n.target):n.flag("write",n.target.concat(o)),a===null?delete s[o]:($u(a),s[o]=a)),!0},deleteProperty(s,o){if(s=An(n.root.cache,n.target),s===null)throw new Error(`Cannot delete property ${o.toString()} of null`);return typeof o=="symbol"?Reflect.deleteProperty(s,o):(o in s&&(n.flag("write",n.target.concat(o)),delete s[o]),!0)},ownKeys(s){return s=An(n.root.cache,n.target),Reflect.ownKeys(s)},has(s,o){return s=An(n.root.cache,n.target),Reflect.has(s,o)},getOwnPropertyDescriptor(s,o){s=An(n.root.cache,n.target);const a=Reflect.getOwnPropertyDescriptor(s,o);return a&&(a.configurable=!0),a},getPrototypeOf(s){return s=An(n.root.cache,n.target),Reflect.getPrototypeOf(s)}},i=new Proxy({},r);return i}function $u(n){typeof n=="object"&&Object.keys(n).forEach(e=>{const t=n[e];t===null||typeof t=="undefined"?delete n[e]:typeof t=="object"&&$u(t)})}function pa(n){if(typeof n!="object"||!n[xi])throw new Error("Given value is not proxied. Make sure you are referencing the value through the live data proxy.");return n}class jE{constructor(e,t="order",r=10){if(this.collection=e,this.orderProperty=t,this.orderIncrement=r,typeof e!="object"||!e[xi])throw new Error("Collection is not proxied");if(e.valueOf()instanceof Array)throw new Error("Collection is an array, not an object collection");if(!Object.keys(e).every(i=>typeof e[i]=="object"))throw new Error("Collection has non-object children");if(!Object.keys(e).every(i=>typeof e[i][t]=="number")){const i=Object.keys(e);for(let s=0;s<i.length;s++){const o=e[i[s]];o[t]=s*r}}}getObservable(){return pa(this.collection).getObservable()}getArrayObservable(){const e=Yh();return new e(t=>{const r=this.getObservable().subscribe(()=>{const i=this.getArray();t.next(i)});return function(){r.unsubscribe()}})}getArray(){return pa(this.collection).toArray((e,t)=>e[this.orderProperty]-t[this.orderProperty])}add(e,t,r){const i=this.getArray();let s=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;for(let c=0;c<i.length;c++){const l=i[c][this.orderProperty];s=Math.min(l,s),o=Math.max(l,o)}let a;if(typeof r=="number"){if(a=Object.keys(this.collection).find(c=>this.collection[c]===e),!a)throw new Error("item not found in collection");if(r===t)return{key:a,index:t};if(Math.abs(r-t)===1){const c=i[t],l=c[this.orderProperty];return c[this.orderProperty]=e[this.orderProperty],e[this.orderProperty]=l,{key:a,index:t}}else i.splice(r,1)}if(typeof t!="number"||t>=i.length)t=i.length,e[this.orderProperty]=i.length==0?0:o+this.orderIncrement;else if(t===0)e[this.orderProperty]=i.length==0?0:s-this.orderIncrement;else{const c=i.map(u=>u[this.orderProperty]),l=c[t]-c[t-1];if(l>1)e[this.orderProperty]=c[t]-Math.floor(l/2);else{i.splice(t,0,e);for(let u=0;u<i.length;u++)i[u][this.orderProperty]=u*this.orderIncrement}}return{key:typeof a=="string"?a:pa(this.collection).push(e),index:t}}delete(e){const t=this.getArray()[e];if(!t)throw new Error(`Item at index ${e} not found`);const r=Object.keys(this.collection).find(i=>this.collection[i]===t);if(!r)throw new Error("Cannot find target object to delete");return this.collection[r]=null,{key:r,index:e}}move(e,t){const r=this.getArray();return this.add(r[e],t,e)}sort(e){const t=this.getArray();t.sort(e);for(let r=0;r<t.length;r++)t[r][this.orderProperty]=r*this.orderIncrement}}class cm{constructor(e){if(e||(e={}),typeof e.include!="undefined"&&!(e.include instanceof Array))throw new TypeError("options.include must be an array");if(typeof e.exclude!="undefined"&&!(e.exclude instanceof Array))throw new TypeError("options.exclude must be an array");if(typeof e.child_objects!="undefined"&&typeof e.child_objects!="boolean")throw new TypeError("options.child_objects must be a boolean");if(typeof e.cache_mode=="string"&&!["allow","bypass","force"].includes(e.cache_mode))throw new TypeError("invalid value for options.cache_mode");this.include=e.include||void 0,this.exclude=e.exclude||void 0,this.child_objects=typeof e.child_objects=="boolean"?e.child_objects:void 0,this.cache_mode=typeof e.cache_mode=="string"?e.cache_mode:typeof e.allow_cache=="boolean"?e.allow_cache?"allow":"bypass":"allow",this.cache_cursor=typeof e.cache_cursor=="string"?e.cache_cursor:void 0}}class BE extends cm{constructor(e){if(super(e),!["undefined","boolean"].includes(typeof e.snapshots))throw new TypeError("options.snapshots must be a boolean");this.snapshots=typeof e.snapshots=="boolean"?e.snapshots:!0}}const $e=Symbol("private");class Jn{constructor(e,t,r){this.db=e,t||(t=""),t=t.replace(/^\/|\/$/g,"");const i=J.get(t).key,s=[];this[$e]={get path(){return t},get key(){return i},get callbacks(){return s},vars:r||{},context:{},pushed:!1,cursor:null}}context(e,t=!1){const r=this[$e].context;if(typeof e=="object"){const i=e?t?r||{}:e:{};return e&&Object.keys(e).forEach(s=>{i[s]=e[s]}),this[$e].context=i,this}else{if(typeof e=="undefined")return console.warn("Use snap.context() instead of snap.ref.context() to get updating context in event callbacks"),r;throw new Error("Invalid context argument")}}get cursor(){return this[$e].cursor}set cursor(e){var t;this[$e].cursor=e,(t=this.onCursor)==null||t.call(this,e)}get path(){return this[$e].path}get key(){const e=this[$e].key;return typeof e=="number"?`[${e}]`:e}get index(){const e=this[$e].key;if(typeof e!="number")throw new Error(`"${e}" is not a number`);return e}get parent(){const e=J.fillVariables2(this.path,this.vars),t=J.get(e);return t.parentPath===null?null:new Jn(this.db,t.parentPath).context(this[$e].context)}get vars(){return this[$e].vars}child(e){e=typeof e=="number"?e:e.replace(/^\/|\/$/g,"");const t=J.fillVariables2(this.path,this.vars),r=J.getChildPath(t,e);return new Jn(this.db,r).context(this[$e].context)}set(e,t){return K(this,null,function*(){try{if(this.isWildcardPath)throw new Error(`Cannot set the value of wildcard path "/${this.path}"`);if(this.parent===null)throw new Error("Cannot set the root object. Use update, or set individual child properties");if(typeof e=="undefined")throw new TypeError(`Cannot store undefined value in "/${this.path}"`);this.db.isReady||(yield this.db.ready()),e=this.db.types.serialize(this.path,e);const{cursor:r}=yield this.db.api.set(this.path,e,{context:this[$e].context});if(this.cursor=r,typeof t=="function")try{t(null,this)}catch(i){console.error("Error in onComplete callback:",i)}}catch(r){if(typeof t=="function")try{t(r,this)}catch(i){console.error("Error in onComplete callback:",i)}else throw r}return this})}update(e,t){return K(this,null,function*(){try{if(this.isWildcardPath)throw new Error(`Cannot update the value of wildcard path "/${this.path}"`);if(this.db.isReady||(yield this.db.ready()),typeof e!="object"||e instanceof Array||e instanceof ArrayBuffer||e instanceof Date)yield this.set(e);else if(Object.keys(e).length===0)console.warn(`update called on path "/${this.path}", but there is nothing to update`);else{e=this.db.types.serialize(this.path,e);const{cursor:r}=yield this.db.api.update(this.path,e,{context:this[$e].context});this.cursor=r}if(typeof t=="function")try{t(null,this)}catch(r){console.error("Error in onComplete callback:",r)}}catch(r){if(typeof t=="function")try{t(r,this)}catch(i){console.error("Error in onComplete callback:",i)}else throw r}return this})}transaction(e){return K(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot start a transaction on wildcard path "/${this.path}"`);this.db.isReady||(yield this.db.ready());let t;const r=s=>{s=this.db.types.deserialize(this.path,s);const o=new rt(this,s);let a;try{a=e(o)}catch(c){t=c;return}return a instanceof Promise?a.then(c=>this.db.types.serialize(this.path,c)).catch(c=>{t=c}):this.db.types.serialize(this.path,a)},{cursor:i}=yield this.db.api.transaction(this.path,r,{context:this[$e].context});if(this.cursor=i,t)throw t;return this})}on(e,t,r){this.path===""&&["value","child_changed"].includes(e)&&console.warn("WARNING: Listening for value and child_changed events on the root node is a bad practice. These events require loading of all data (value event), or potentially lots of data (child_changed event) each time they are fired");let i=null;const s=new pE(c=>{i=c}),o={event:e,stream:s,userCallback:typeof t=="function"&&t,ourCallback:(c,l,u,h,p)=>{if(c){this.db.debug.error(`Error getting data for event ${e} on path "${l}"`,c);return}const f=this.db.ref(l);f[$e].vars=J.extractVariables(this.path,l);let d;if(e.startsWith("notify_"))d=f.context(p||{});else{const y={previous:this.db.types.deserialize(l,h),current:this.db.types.deserialize(l,u)};if(e==="child_removed")d=new rt(f,y.previous,!0,y.previous,p);else if(e==="mutations")d=new da(f,y.current,p);else{const _=e==="mutated"&&y.current===null;d=new rt(f,y.current,_,y.previous,p)}}i.publish(d),p!=null&&p.acebase_cursor&&(this.cursor=p.acebase_cursor)}};this[$e].callbacks.push(o);const a=()=>{typeof t=="function"&&s.subscribe(t,(p,f)=>{p||r&&r(f)});const c=typeof t=="object"?t:{newOnly:!t};typeof c.newOnly!="boolean"&&(c.newOnly=!1),this.isWildcardPath&&(c.newOnly=!0);const l=p=>{const f=this[$e].callbacks;f.splice(f.indexOf(o),1),this.db.api.unsubscribe(this.path,e,o.ourCallback),this.db.debug.error(`Subscription "${e}" on path "/${this.path}" canceled because of an error: ${p.message}`),i.cancel(p.message)},u=this.db.api.subscribe(this.path,e,o.ourCallback,{newOnly:c.newOnly,cancelCallback:l,syncFallback:c.syncFallback}),h=()=>{const p=this[$e].callbacks;return p.splice(p.indexOf(o),1),this.db.api.unsubscribe(this.path,e,o.ourCallback)};if(u instanceof Promise?u.then(()=>{i.start(h)}).catch(l):i.start(h),!c.newOnly){if(e==="value")this.get(p=>{i.publish(p)});else if(e==="child_added")this.get(p=>{const f=p.val();f===null||typeof f!="object"||Object.keys(f).forEach(d=>{const y=new rt(this.child(d),f[d]);i.publish(y)})});else if(e==="notify_child_added"){let p=0;const f=()=>K(this,null,function*(){const d=yield this.db.api.reflect(this.path,"children",{limit:100,skip:p});d.list.forEach(y=>{const _=this.child(y.key);i.publish(_)}),d.more&&(p+=100,f())});f()}}};return this.db.isReady?a():this.db.ready(a),s}off(e,t){const r=this[$e].callbacks.filter(i=>(!e||i.event===e)&&(!t||i.userCallback===t));return r.length===0&&this.db.debug.warn(`Can't find event subscriptions to stop (path: "${this.path}", event: ${e||"(any)"}, callback: ${t})`),r.forEach(i=>{i.stream.stop()}),this}get(e,t){if(!this.db.isReady){const s=this.db.ready().then(()=>this.get(e,t));return typeof e!="function"&&typeof t!="function"?s:void 0}if(t=typeof e=="function"?e:typeof t=="function"?t:void 0,this.isWildcardPath){const s=new Error(`Cannot get value of wildcard path "/${this.path}". Use .query() instead`);if(typeof t=="function")throw s;return Promise.reject(s)}const r=new cm(typeof e=="object"?e:{cache_mode:"allow"}),i=this.db.api.get(this.path,r).then(s=>{var o;"context"in s&&"value"in s||(console.warn("AceBase api.get method returned an old response value. Update your acebase or acebase-client package"),s={value:s,context:{}});const a=this.db.types.deserialize(this.path,s.value),c=new rt(this,a,void 0,void 0,s.context);return(o=s.context)!=null&&o.acebase_cursor&&(this.cursor=s.context.acebase_cursor),c});if(t){i.then(t).catch(s=>{console.error("Uncaught error:",s)});return}else return i}once(e,t){return e==="value"&&!this.isWildcardPath?this.get(t):new Promise(r=>{const i=s=>{this.off(e,i),r(s)};this.on(e,i)})}push(e,t){if(this.isWildcardPath){const s=new Error(`Cannot push to wildcard path "/${this.path}"`);if(typeof e=="undefined"||typeof t=="function")throw s;return Promise.reject(s)}const r=Vt.generate(),i=this.child(r);return i[$e].pushed=!0,typeof e!="undefined"?i.set(e,t).then(()=>i):i}remove(){return K(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot remove wildcard path "/${this.path}". Use query().remove instead`);if(this.parent===null)throw new Error("Cannot remove the root node");return this.set(null)})}exists(){return K(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot check wildcard path "/${this.path}" existence`);return this.db.isReady||(yield this.db.ready()),this.db.api.exists(this.path)})}get isWildcardPath(){return this.path.indexOf("*")>=0||this.path.indexOf("$")>=0}query(){return new lm(this)}count(){return K(this,null,function*(){return(yield this.reflect("info",{child_count:!0})).children.count})}reflect(e,t){return K(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot reflect on wildcard path "/${this.path}"`);return this.db.isReady||(yield this.db.ready()),this.db.api.reflect(this.path,e,t)})}export(e){return K(this,arguments,function*(t,r={format:"json",type_safe:!0}){if(this.isWildcardPath)throw new Error(`Cannot export wildcard path "/${this.path}"`);this.db.isReady||(yield this.db.ready());const i=typeof t=="function"?t:t.write.bind(t);return this.db.api.export(this.path,i,r)})}import(e){return K(this,arguments,function*(t,r={format:"json",suppress_events:!1}){if(this.isWildcardPath)throw new Error(`Cannot import to wildcard path "/${this.path}"`);return this.db.isReady||(yield this.db.ready()),this.db.api.import(this.path,t,r)})}proxy(e){const t=typeof e=="object"&&(typeof e.cursor!="undefined"||typeof e.defaultValue!="undefined");return typeof e!="undefined"&&!t&&(this.db.debug.warn("Warning: live data proxy is being initialized with a deprecated method signature. Use ref.proxy(options) instead of ref.proxy(defaultValue)"),e={defaultValue:e}),NE.create(this,e)}observe(e){if(e)throw new Error("observe does not support data retrieval options yet");if(this.isWildcardPath)throw new Error(`Cannot observe wildcard path "/${this.path}"`);const t=Yh();return new t(r=>{let i,s=!1,o=this.get(e).then(c=>{s=!0,i=c.val(),r.next(i)});const a=c=>{if(!s){o=o.then(()=>a(c));return}const l=c.ref.path;if(l===this.path)return i=c.val(),r.next(i);const u=J.getPathKeys(l).slice(J.getPathKeys(this.path).length);let h=i;for(;u.length>1;){const d=u.shift();d in h||(h[d]=typeof u[0]=="number"?[]:{}),h=h[d]}const p=u.shift(),f=c.val();f===null?h instanceof Array&&typeof p=="number"?h.splice(p,1):delete h[p]:h[p]=f,r.next(i)};return this.on("mutated",a),()=>{this.off("mutated",a)}})}forEach(e,t){return K(this,null,function*(){let r;if(typeof e=="function"?t=e:r=e,typeof t!="function")throw new TypeError("No callback function given");const i=yield this.reflect("children",{limit:0,skip:0}),s={canceled:!1,total:i.list.length,processed:0};for(let o=0;o<i.list.length;o++){const a=i.list[o].key,c=yield this.child(a).get(r);if(s.processed++,!!c.exists()&&(yield t(c))===!1){s.canceled=!0;break}}return s})}getMutations(e){return K(this,null,function*(){const t=typeof e=="string"?e:void 0,r=e===null||typeof e=="undefined"?0:e instanceof Date?e.getTime():void 0;return this.db.api.getMutations({path:this.path,cursor:t,timestamp:r})})}getChanges(e){return K(this,null,function*(){const t=typeof e=="string"?e:void 0,r=e===null||typeof e=="undefined"?0:e instanceof Date?e.getTime():void 0;return this.db.api.getChanges({path:this.path,cursor:t,timestamp:r})})}}class lm{constructor(e){this.ref=e,this[$e]={filters:[],skip:0,take:0,order:[],events:{}}}filter(e,t,r){if((t==="in"||t==="!in")&&(!(r instanceof Array)||r.length===0))throw new Error(`${t} filter for ${e} must supply an Array compare argument containing at least 1 value`);if((t==="between"||t==="!between")&&(!(r instanceof Array)||r.length!==2))throw new Error(`${t} filter for ${e} must supply an Array compare argument containing 2 values`);if((t==="matches"||t==="!matches")&&!(r instanceof RegExp))throw new Error(`${t} filter for ${e} must supply a RegExp compare argument`);return this[$e].filters.push({key:e,op:t,compare:r}),this}where(e,t,r){return this.filter(e,t,r)}take(e){return this[$e].take=e,this}skip(e){return this[$e].skip=e,this}sort(e,t=!0){if(!["string","number"].includes(typeof e))throw"key must be a string or number";return this[$e].order.push({key:e,ascending:t}),this}order(e,t=!0){return this.sort(e,t)}get(e,t){if(!this.ref.db.isReady){const s=this.ref.db.ready().then(()=>this.get(e,t));return typeof e!="function"&&typeof t!="function"?s:void 0}t=typeof e=="function"?e:typeof t=="function"?t:void 0;const r=new BE(typeof e=="object"?e:{snapshots:!0,cache_mode:"allow"});r.allow_cache=r.cache_mode!=="bypass",r.eventHandler=s=>{if(!this[$e].events[s.name])return!1;const o=this[$e].events[s.name];if(typeof o!="object"||o.length===0)return!1;if(["add","change","remove"].includes(s.name)){const a={name:s.name,ref:new Jn(this.ref.db,s.path)};if(r.snapshots&&s.name!=="remove"){const c=i.types.deserialize(s.path,s.value);a.snapshot=new rt(a.ref,c,!1)}s=a}o.forEach(a=>{var c,l;try{a(s)}catch(u){this.ref.db.debug.error(`Error executing "${s.name}" event handler of realtime query on path "${this.ref.path}": ${(l=(c=u==null?void 0:u.stack)!=null?c:u==null?void 0:u.message)!=null?l:u}`)}})},r.monitor={add:!1,change:!1,remove:!1},this[$e].events&&(this[$e].events.add&&this[$e].events.add.length>0&&(r.monitor.add=!0),this[$e].events.change&&this[$e].events.change.length>0&&(r.monitor.change=!0),this[$e].events.remove&&this[$e].events.remove.length>0&&(r.monitor.remove=!0)),this.stop();const i=this.ref.db;return i.api.query(this.ref.path,this[$e],r).catch(s=>{throw new Error(s)}).then(s=>{const{stop:o}=s;let{results:a,context:c}=s;if(this.stop=()=>K(this,null,function*(){yield o()}),"results"in s&&"context"in s||(console.warn("Query results missing context. Update your acebase and/or acebase-client packages"),a=s,c={}),r.snapshots){const l=a.map(u=>{const h=i.types.deserialize(u.path,u.val);return new rt(i.ref(u.path),h,!1,void 0,c)});return bc.from(l)}else{const l=a.map(u=>i.ref(u));return Qh.from(l)}}).then(s=>(t&&t(s),s))}stop(){return K(this,null,function*(){})}getRefs(e){return this.get({snapshots:!1},e)}find(){return this.get({snapshots:!1})}count(){return K(this,null,function*(){return(yield this.find()).length})}exists(){return K(this,null,function*(){const e=this[$e].take,t=this.take(1).find();return this.take(e),(yield t).length!==0})}remove(e){return K(this,null,function*(){const t=yield this.find(),r=t.reduce((a,c)=>{const l=a[c.parent.path];return l?l.push(c):a[c.parent.path]=[c],a},{}),i=this.ref.db,s=Object.keys(r).map(a=>K(this,null,function*(){const c=t.reduce((u,h)=>(u[h.key]=null,u),{}),l=i.ref(a);try{return yield l.update(c),{ref:l,success:!0}}catch(u){return{ref:l,success:!1,error:u}}})),o=yield Promise.all(s);return e&&e(o),o})}on(e,t){return this[$e].events[e]||(this[$e].events[e]=[]),this[$e].events[e].push(t),this}off(e,t){if(typeof e=="undefined")return this[$e].events={},this;if(!this[$e].events[e])return this;if(typeof t=="undefined")return delete this[$e].events[e],this;const r=this[$e].events[e].indexOf(t);return~r?(this[$e].events[e].splice(r,1),this):this}forEach(e,t){return K(this,null,function*(){let r;if(typeof e=="function"?t=e:r=e,typeof t!="function")throw new TypeError("No callback function given");const i=yield this.find(),s={canceled:!1,total:i.length,processed:0};for(let o=0;o<i.length;o++){const a=yield i[o].get(r);if(s.processed++,!!a.exists()&&(yield t(a))===!1){s.canceled=!0;break}}return s})}}class bc extends Array{static from(e){const t=new bc(e.length);return e.forEach((r,i)=>t[i]=r),t}getValues(){return this.map(e=>e.val())}}class Qh extends Array{static from(e){const t=new Qh(e.length);return e.forEach((r,i)=>t[i]=r),t}getPaths(){return this.map(e=>e.path)}}function LE(n,e){e=e.replace(/^\/|\/$/g,"");const t=J.getPathKeys(e),r=Object.keys(n).find(i=>{const s=J.getPathKeys(i);return s.length!==t.length?!1:s.every((o,a)=>o==="*"||typeof o=="string"&&o[0]==="$"?!0:o===t[a])});return n[r]}function DE(n,e){const t=J.get(e).parentPath;if(t!==null)return LE(n,t)}function UE(n,e){e=e.replace(/^\/|\/$/g,"");const t=J.get(e).parentPath,r=t?J.getPathKeys(t):[];return Object.keys(n).reduce((i,s)=>{const o=J.getPathKeys(s);if(o.length<r.length)return i;let a=!0;if(r.length===0&&t!==null?a=o.length===1&&(o[0]==="*"||typeof o[0]=="string"&&o[0][0]==="$"):o.every((c,l)=>l>=r.length?!1:c==="*"||typeof c=="string"&&c[0]==="$"||c===r[l]?!0:(a=!1,!1)),a){const c=n[s];i.push({path:s,type:c})}return i},[])}function gp(n,e,t,r,i){if(r===null||typeof r!="object")return r;const s=J.getPathKeys(t),o=UE(e,t),a=[];return o.sort((c,l)=>J.getPathKeys(c.path).length>J.getPathKeys(l.path).length?-1:1),o.forEach(c=>{const l=J.getPathKeys(c.path);l.push("*");const u=l.slice(s.length);if(u.length===0){const p=J.extractVariables(c.path,t),f=new Jn(n,t,p);if(i==="serialize")r=c.type.serialize(r,f);else if(i==="deserialize"){const d=new rt(f,r);r=c.type.deserialize(d)}return}const h=(p,f,d)=>{if(r===null||typeof r!="object")return r;const y=d[0];let _=[];if(y==="*"||typeof y=="string"&&y[0]==="$")f instanceof Array?_=f.map((S,I)=>({key:I,val:S})):_=Object.keys(f).map(S=>({key:S,val:f[S]}));else{const S=f[y];typeof S=="object"&&_.push({key:y,val:S})}_.forEach(S=>{const I=J.getChildPath(p,S.key),B=J.extractVariables(c.path,I),j=new Jn(n,I,B);if(d.length===1){if(i==="serialize")a.push({parent:f,key:S.key,original:f[S.key]}),f[S.key]=c.type.serialize(S.val,j);else if(i==="deserialize"){const U=new rt(j,S.val);f[S.key]=c.type.deserialize(U)}}else h(I,S.val,d.slice(1))})};h(t,r,u)}),i==="serialize"&&(r=Wn(r),a.length>0&&a.forEach(c=>{c.parent[c.key]=c.original})),r}const Yi=Symbol("mappings");class um{constructor(e){this.db=e,this[Yi]={}}get mappings(){return this[Yi]}map(e){return DE(this[Yi],e)}bind(e,t,r={}){if(typeof e!="string")throw new TypeError("path must be a string");if(typeof t!="function")throw new TypeError("constructor must be a function");if(typeof r.serializer!="undefined"){if(typeof r.serializer=="string")if(typeof t.prototype[r.serializer]=="function")r.serializer=t.prototype[r.serializer];else throw new TypeError(`${t.name}.prototype.${r.serializer} is not a function, cannot use it as serializer`);else if(typeof r.serializer!="function")throw new TypeError(`serializer for class ${t.name} must be a function, or the name of a prototype method`)}if(typeof r.creator=="undefined")typeof t.create=="function"&&(r.creator=t.create);else if(typeof r.creator=="string")if(typeof t[r.creator]=="function")r.creator=t[r.creator];else throw new TypeError(`${t.name}.${r.creator} is not a function, cannot use it as creator`);else if(typeof r.creator!="function")throw new TypeError(`creator for class ${t.name} must be a function, or the name of a static method`);e=e.replace(/^\/|\/$/g,""),this[Yi][e]={db:this.db,type:t,creator:r.creator,serializer:r.serializer,deserialize(i){let s;return this.creator?s=this.creator.call(this.type,i):s=new this.type(i),s},serialize(i,s){return this.serializer?i=this.serializer.call(i,s,i):i&&typeof i.serialize=="function"&&(i=i.serialize(s,i)),i}}}serialize(e,t){return gp(this.db,this[Yi],e,t,"serialize")}deserialize(e,t){return gp(this.db,this[Yi],e,t,"deserialize")}}const Mo=()=>{};class hm{constructor(e="log",t=""){this.level=e,this.prefix=t,this.setLevel(e)}setLevel(e){const t=this.prefix?this.prefix+" %s":"";this.verbose=["verbose"].includes(e)?t?console.log.bind(console,t):console.log.bind(console):Mo,this.log=["verbose","log"].includes(e)?t?console.log.bind(console,t):console.log.bind(console):Mo,this.warn=["verbose","log","warn"].includes(e)?t?console.warn.bind(console,t):console.warn.bind(console):Mo,this.error=["verbose","log","warn","error"].includes(e)?t?console.error.bind(console,t):console.error.bind(console):Mo,this.write=r=>{const i=typeof Pn!="undefined"&&Pn.env&&typeof{}.RUNKIT_ENDPOINT_PATH=="string";r&&i?r.split(`
`).forEach(s=>console.log(s)):console.log(r)}}}const mp={bold:1,dim:2,italic:3,underline:4,inverse:7,hidden:8,strikethrough:94},vp={black:30,red:31,green:32,yellow:33,blue:34,magenta:35,cyan:36,white:37,grey:90,brightRed:91},bp={bgBlack:40,bgRed:41,bgGreen:42,bgYellow:43,bgBlue:44,bgMagenta:45,bgCyan:46,bgWhite:47,bgGrey:100,bgBrightRed:101},qo={all:0,color:39,background:49,bold:22,dim:22,italic:23,underline:24,inverse:27,hidden:28,strikethrough:29};var St;(function(n){n.reset="reset",n.bold="bold",n.dim="dim",n.italic="italic",n.underline="underline",n.inverse="inverse",n.hidden="hidden",n.strikethrough="strikethrough",n.black="black",n.red="red",n.green="green",n.yellow="yellow",n.blue="blue",n.magenta="magenta",n.cyan="cyan",n.grey="grey",n.bgBlack="bgBlack",n.bgRed="bgRed",n.bgGreen="bgGreen",n.bgYellow="bgYellow",n.bgBlue="bgBlue",n.bgMagenta="bgMagenta",n.bgCyan="bgCyan",n.bgWhite="bgWhite",n.bgGrey="bgGrey"})(St||(St={}));function fm(){if(typeof Pn=="undefined"||!Pn.stdout||!Pn.env||!Pn.platform||Pn.platform==="browser")return!1;if(Pn.platform==="win32")return!0;const n=Pn.env;return n.COLORTERM?!0:n.TERM==="dumb"?!1:n.CI||n.TEAMCITY_VERSION?!!n.TRAVIS:!!(["iTerm.app","HyperTerm","Hyper","MacTerm","Apple_Terminal","vscode"].includes(n.TERM_PROGRAM)||/^xterm-256|^screen|^xterm|^vt100|color|ansi|cygwin|linux/i.test(n.TERM))}let dm=fm();function FE(n){dm=fm()&&n}function ME(n,e){if(!dm)return n;const t=[],r=[],i=a=>{a===St.reset?t.push(qo.all):a in mp?(t.push(mp[a]),r.push(qo[a])):a in vp?(t.push(vp[a]),r.push(qo.color)):a in bp&&(t.push(bp[a]),r.push(qo.background))};e instanceof Array?e.forEach(i):i(e);const s=t.map(a=>"\x1B["+a+"m").join(""),o=r.map(a=>"\x1B["+a+"m").join("");return n.split(`
`).map(a=>s+a+o).join(`
`)}String.prototype.colorize=function(n){return ME(this,n)};class pm{constructor(e){this.logLevel="log",this.logColors=!0,this.info="realtime database",this.sponsor=!1,typeof e!="object"&&(e={}),typeof e.logLevel=="string"&&(this.logLevel=e.logLevel),typeof e.logColors=="boolean"&&(this.logColors=e.logColors),typeof e.info=="string"&&(this.info=e.info),typeof e.sponsor=="boolean"&&(this.sponsor=e.sponsor)}}class qE extends us{constructor(e,t={}){super(),this._ready=!1,t=new pm(t),this.name=e,this.debug=new hm(t.logLevel,`[${e}]`),FE(t.logColors);const r=[St.magenta,St.bold],i=`     ___          ______                
    / _ \\         | ___ \\               
   / /_\\ \\ ___ ___| |_/ / __ _ ___  ___ 
   |  _  |/ __/ _ \\ ___ \\/ _\` / __|/ _ \\
   | | | | (_|  __/ |_/ / (_| \\__ \\  __/
   \\_| |_/\\___\\___\\____/ \\__,_|___/\\___|`,s=t.info?"".padStart(40-t.info.length," ")+t.info+`
`:"";t.sponsor||(this.debug.write(i.colorize(r)),s&&this.debug.write(s.colorize(St.magenta))),this.types=new um(this),this.once("ready",()=>{this._ready=!0})}ready(e){return K(this,null,function*(){this._ready||(yield new Promise(t=>this.on("ready",t))),e==null||e()})}get isReady(){return this._ready}setObservable(e){CE(e)}ref(e){return new Jn(this,e)}get root(){return this.ref("")}query(e){const t=new Jn(this,e);return new lm(t)}get indexes(){return{get:()=>this.api.getIndexes(),create:(e,t,r)=>this.api.createIndex(e,t,r),delete:e=>K(this,null,function*(){return this.api.deleteIndex(e)})}}get schema(){return{get:e=>this.api.getSchema(e),set:(e,t,r=!1)=>this.api.setSchema(e,t,r),all:()=>this.api.getSchemas(),check:(e,t,r)=>this.api.validateSchema(e,t,r)}}}class lt extends Error{constructor(e){super(`${e} is not implemented`)}}class VE extends us{constructor(){super()}stats(e){throw new lt("stats")}subscribe(e,t,r,i){throw new lt("subscribe")}unsubscribe(e,t,r){throw new lt("unsubscribe")}update(e,t,r){throw new lt("update")}set(e,t,r){throw new lt("set")}get(e,t){throw new lt("get")}transaction(e,t,r){throw new lt("transaction")}exists(e){throw new lt("exists")}query(e,t,r){throw new lt("query")}reflect(e,t,r){throw new lt("reflect")}export(e,t,r){throw new lt("export")}import(e,t,r){throw new lt("import")}createIndex(e,t,r){throw new lt("createIndex")}getIndexes(){throw new lt("getIndexes")}deleteIndex(e){throw new lt("deleteIndex")}setSchema(e,t,r){throw new lt("setSchema")}getSchema(e){throw new lt("getSchema")}getSchemas(){throw new lt("getSchemas")}validateSchema(e,t,r){throw new lt("validateSchema")}getMutations(e){throw new lt("getMutations")}getChanges(e){throw new lt("getChanges")}}function wp(n,e,t){const r=[0,0,0,0,0];for(let i=0;i<e;i+=4){let s=((n[i]*256+n[i+1])*256+n[i+2])*256+n[i+3];if(!s)t.push("z");else{for(let o=0;o<5;r[o++]=s%85+33,s=Math.floor(s/85));t.push(String.fromCharCode(r[4],r[3],r[2],r[1],r[0]))}}}function KE(n){const e=n,t=[],r=e.length%4,i=e.length-r;if(wp(e,i,t),r){const o=new Uint8Array(4);o.set(e.slice(i),0),wp(o,4,t);let a=t.pop();a=="z"&&(a="!!!!!"),t.push(a.substr(0,r+1))}let s=t.join("");return s="<~"+s+"~>",s}const kr={encode:function(n){return n instanceof ArrayBuffer&&(n=new Uint8Array(n,0,n.byteLength)),KE(n)},decode:function(n){if(!n.startsWith("<~")||!n.endsWith("~>"))throw new Error("Invalid input string");n=n.substr(2,n.length-4);const e=n.length,t=[],r=[0,0,0,0,0];let i,s,o,a;for(let l=0;l<e;++l){if(n.charAt(l)=="z"){t.push(0,0,0,0);continue}for(let u=0;u<5;++u)r[u]=n.charCodeAt(l+u)-33;if(a=e-l,a<5){for(let u=a;u<4;r[++u]=0);r[a]=85}i=(((r[0]*85+r[1])*85+r[2])*85+r[3])*85+r[4],s=i&255,i>>>=8,o=i&255,i>>>=8,t.push(i>>>8,i&255,o,s);for(let u=a;u<5;++u,t.pop());l+=4}const c=new Uint8Array(t);return c.buffer.slice(c.byteOffset,c.byteOffset+c.byteLength)}},WE=n=>{if(n.map===null||typeof n.map=="undefined"){if(typeof n.val=="undefined")throw new Error("serialized value must have a val property");return n.val}const e=(t,r)=>t==="date"?new Date(r):t==="binary"?kr.decode(r):t==="reference"?new it(r):t==="regexp"?new RegExp(r.pattern,r.flags):t==="array"?new Ha(r):t==="bigint"?BigInt(r):r;return typeof n.map=="string"?e(n.map,n.val):(Object.keys(n.map).forEach(t=>{const r=n.map[t],i=J.getPathKeys(t);let s=n,o="val",a=n.val;i.forEach(c=>{o=c,s=a,a=a[o]}),s[o]=e(r,a)}),n.val)},ym=n=>{var e;if(n===null||typeof n!="object"||n instanceof Date||n instanceof ArrayBuffer||n instanceof it||n instanceof RegExp){const s=ym({value:n});return{map:(e=s.map)==null?void 0:e.value,val:s.val.value}}n=Wn(n);const t=(s,o,a)=>{s instanceof Ha&&(o[a]="array"),Object.keys(s).forEach(c=>{const l=s[c],u=a.length===0?c:`${a}/${c}`;typeof l=="bigint"?(s[c]=l.toString(),o[u]="bigint"):l instanceof Date?(s[c]=l.toISOString(),o[u]="date"):l instanceof ArrayBuffer?(s[c]=kr.encode(l),o[u]="binary"):l instanceof it?(s[c]=l.path,o[u]="reference"):l instanceof RegExp?(s[c]={pattern:l.source,flags:l.flags},o[u]="regexp"):typeof l=="object"&&l!==null&&t(l,o,u)})},r={};t(n,r,"");const i={val:n};return Object.keys(r).length>0&&(i.map=r),i},kp=n=>n>0?Date.now()+n*1e3:1/0;class zE{get size(){return this.cache.size}constructor(e){var t;if(this.enabled=!0,typeof e=="number"&&(e={expirySeconds:e}),e.cloneValues=e.cloneValues!==!1,typeof e.expirySeconds!="number"&&typeof e.maxEntries!="number")throw new Error("Either expirySeconds or maxEntries must be specified");this.options=e,this.cache=new Map;const r=setInterval(()=>{this.cleanUp()},60*1e3);(t=r.unref)==null||t.call(r)}has(e){return this.enabled?this.cache.has(e):!1}get(e){if(!this.enabled)return null;const t=this.cache.get(e);return t?(t.expires=kp(this.options.expirySeconds),t.accessed=Date.now(),this.options.cloneValues?Wn(t.value):t.value):null}set(e,t){if(this.options.maxEntries>0&&this.cache.size>=this.options.maxEntries&&!this.cache.has(e)){let r=null;const i=Date.now();for(const[s,o]of this.cache.entries()){if(o.expires<=i){this.cache.delete(s),r=null;break}(!r||o.accessed<r.accessed)&&(r={key:s,accessed:o.accessed})}r!==null&&this.cache.delete(r.key)}this.cache.set(e,{value:this.options.cloneValues?Wn(t):t,added:Date.now(),accessed:Date.now(),expires:kp(this.options.expirySeconds)})}remove(e){this.cache.delete(e)}cleanUp(){const e=Date.now();this.cache.forEach((t,r)=>{t.expires<=e&&this.cache.delete(r)})}}function HE(n){let e=0;function t(){let a;for(;a=n[e],[" ","\r",`
`,"	"].includes(a);)e++}function r(a){if(n[e]!==a)throw new Error(`Unexpected character at position ${e}. Expected: '${a}', found '${n[e]}'`);e++}function i(){t();const a={name:"",optional:!1,wildcard:!1};let c;for(;c=n[e],c==="_"||c==="$"||c>="a"&&c<="z"||c>="A"&&c<="Z"||a.name.length>0&&c>="0"&&c<="9"||a.name.length===0&&c==="*";)a.name+=c,e++;if(a.name.length===0)throw new Error(`Property name expected at position ${e}, found: ${n.slice(e,e+10)}..`);return n[e]==="?"&&(a.optional=!0,e++),(a.name==="*"||a.name[0]==="$")&&(a.optional=!0,a.wildcard=!0),t(),r(":"),a}function s(){t();let a={typeOf:"any"},c,l="";for(;c=n[e],c>="a"&&c<="z"||c>="A"&&c<="Z";)l+=c,e++;if(l.length===0)if(n[e]==="*")r("*"),a.typeOf="any";else if(["'",'"',"`"].includes(n[e])){a.typeOf="string",a.value="";const u=n[e];for(r(u);c=n[e],c&&c!==u;)a.value+=c,e++;r(u)}else if(n[e]>="0"&&n[e]<="9"){a.typeOf="number";let u="";for(;c=n[e],c==="."||c==="n"||c>="0"&&c<="9";)u+=c,e++;u.endsWith("n")?a.value=BigInt(u):u.includes(".")?a.value=parseFloat(u):a.value=parseInt(u)}else if(n[e]==="{"){for(r("{"),a.typeOf="object",a.instanceOf=Object,a.children=[];;){const u=i(),h=o();if(a.children.push({name:u.name,optional:u.optional,wildcard:u.wildcard,types:h}),t(),(n[e]===";"||n[e]===",")&&(r(n[e]),t()),n[e]==="}")break}r("}")}else if(n[e]==="/"){r("/");let u="",h="";for(;c=n[e],c!=="/"||u.endsWith("\\");)u+=c,e++;for(r("/");c=n[e],["g","i","m","s","u","y","d"].includes(c);)h+=c,e++;a.typeOf="string",a.matches=new RegExp(u,h)}else throw new Error(`Expected a type definition at position ${e}, found character '${n[e]}'`);else if(["string","number","boolean","bigint","undefined","String","Number","Boolean","BigInt"].includes(l))a.typeOf=l.toLowerCase();else if(l==="Object"||l==="object")a.typeOf="object",a.instanceOf=Object;else if(l==="Date")a.typeOf="object",a.instanceOf=Date;else if(l==="Binary"||l==="binary")a.typeOf="object",a.instanceOf=ArrayBuffer;else if(l==="any")a.typeOf="any";else if(l==="null")a.typeOf="object",a.value=null;else if(l==="Array")r("<"),a.typeOf="object",a.instanceOf=Array,a.genericTypes=o(),r(">");else if(["true","false"].includes(l))a.typeOf="boolean",a.value=l==="true";else throw new Error(`Unknown type at position ${e}: "${a}"`);for(t();n[e]==="[";)r("["),r("]"),a={typeOf:"object",instanceOf:Array,genericTypes:[a]};return a}function o(){t();const a=[s()];for(;n[e]==="|";)r("|"),a.push(s()),t();return a}return s()}function JE(n,e,t,r){const i=e.find(h=>h.name==="*"||h.name[0]==="$")?[]:Object.keys(t).filter(h=>![null,void 0].includes(t[h])&&!e.find(p=>p.name===h));if(i.length>0)return{ok:!1,reason:`Object at path "${n}" cannot have propert${i.length===1?"y":"ies"} ${i.map(h=>`"${h}"`).join(", ")}`};function s(h){const p=![null,void 0].includes(t[h.name]);return!h.optional&&(r?t[h.name]===null:!p)?{ok:!1,reason:`Property at path "${n}/${h.name}" is not optional`}:p&&h.types.length===1?Hs(`${n}/${h.name}`,h.types[0],t[h.name],!1):p&&!h.types.some(f=>Hs(`${n}/${h.name}`,f,t[h.name],!1).ok)?{ok:!1,reason:`Property at path "${n}/${h.name}" does not match any of ${h.types.length} allowed types`}:{ok:!0}}const o=e.filter(h=>!h.wildcard),a=o.find(h=>!s(h).ok);if(a)return{ok:!1,reason:s(a).reason};const c=e.find(h=>h.wildcard);if(!c)return{ok:!0};const l=Object.keys(t).filter(h=>!o.find(p=>p.name===h));let u={ok:!0};for(let h=0;h<l.length&&u.ok;h++){const p=l[h];u=s({name:p,types:c.types,optional:!0,wildcard:!0})}return u}function Hs(n,e,t,r,i){const s={ok:!0};if(e.typeOf==="any")return s;if(i instanceof Array&&i.length>0){if(e.typeOf!=="object")return{ok:!1,reason:`path "${n}" must be typeof ${e.typeOf}`};if(!e.children)return s;const o=i[0];let a=e.children.find(l=>l.name===o);if(a||(a=e.children.find(l=>l.name==="*"||l.name[0]==="$")),!a)return{ok:!1,reason:`Object at path "${n}" cannot have property "${o}"`};if(a.optional&&t===null&&i.length===1)return s;let c;return a.types.some(l=>{const u=typeof o=="number"?`${n}[${o}]`:`${n}/${o}`;return c=Hs(u,l,t,r,i.slice(1)),c.ok}),c}return t===null?s:e.instanceOf===Object&&(typeof t!="object"||t instanceof Array||t instanceof Date)?{ok:!1,reason:`path "${n}" must be an object collection`}:e.instanceOf&&(typeof t!="object"||t.constructor!==e.instanceOf)?{ok:!1,reason:`path "${n}" must be an instance of ${e.instanceOf.name}`}:"value"in e&&t!==e.value?{ok:!1,reason:`path "${n}" must be value: ${e.value}`}:typeof t!==e.typeOf?{ok:!1,reason:`path "${n}" must be typeof ${e.typeOf}`}:e.instanceOf===Array&&e.genericTypes&&!t.every(o=>e.genericTypes.some(a=>Hs(n,a,o,!1).ok))?{ok:!1,reason:`every array value of path "${n}" must match one of the specified types`}:e.typeOf==="object"&&e.children?JE(n,e.children,t,r):e.matches&&!e.matches.test(t)?{ok:!1,reason:`path "${n}" must match regular expression /${e.matches.source}/${e.matches.flags}`}:s}function YE(n){switch(n){case String:return"string";case Number:return"number";case Boolean:return"boolean";case Date:return"Date";case BigInt:return"bigint";case Array:throw new Error("Schema error: Array cannot be used without a type. Use string[] or Array<string> instead");default:throw new Error(`Schema error: unknown type used: ${n.name}`)}}class GE{constructor(e,t={warnOnly:!1}){if(this.handling=t,this.source=e,typeof e=="object"){const r=i=>"{"+Object.keys(i).map(s=>{let o=i[s];if(o===void 0)o="undefined";else if(o instanceof RegExp)o=`/${o.source}/${o.flags}`;else if(typeof o=="object")o=r(o);else if(typeof o=="function")o=YE(o);else if(!["string","number","boolean","bigint"].includes(typeof o))throw new Error(`Type definition for key "${s}" must be a string, number, boolean, bigint, object, regular expression, or one of these classes: String, Number, Boolean, Date, BigInt`);return`${s}:${o}`}).join(",")+"}";this.text=r(e)}else if(typeof e=="string")this.text=e;else throw new Error("Type definiton must be a string or an object");this.type=HE(this.text)}check(e,t,r,i){const s=Hs(e,this.type,t,r,i);return!s.ok&&this.handling.warnOnly&&(s.warning=`${r?"Partial schema":"Schema"} check on path "${e}"${i?` for child "${i.join("/")}"`:""} failed: ${s.reason}`,s.ok=!0,this.handling.warnCallback(s.warning)),s}}class sn{constructor(e="browser"){throw new Error(`This feature is not supported in ${e} context`)}}class Ol extends sn{}class Tu extends sn{}class xp extends sn{}class QE extends sn{}class Ep extends sn{}class XE extends sn{}const ZE={OBJECT:1,ARRAY:2,NUMBER:3,BOOLEAN:4,STRING:5,BIGINT:7,DATETIME:6,BINARY:8,REFERENCE:9},oe=ZE;function e_(n){switch(n){case oe.ARRAY:return"array";case oe.BINARY:return"binary";case oe.BOOLEAN:return"boolean";case oe.DATETIME:return"date";case oe.NUMBER:return"number";case oe.OBJECT:return"object";case oe.REFERENCE:return"reference";case oe.STRING:return"string";case oe.BIGINT:return"bigint"}}class gm{constructor(e){if(this.path=e.path,this.type=e.type,this.index=e.index,this.key=e.key,this.exists=e.exists,this.address=e.address,this.value=e.value,this.childCount=e.childCount,typeof this.path=="string"&&typeof this.key=="undefined"&&typeof this.index=="undefined"){const t=J.get(this.path);typeof t.key=="number"?this.index=t.key:this.key=t.key}typeof this.exists=="undefined"&&(this.exists=!0)}get valueType(){return this.type}get valueTypeName(){return e_(this.valueType)}toString(){return this.exists?this.address?`"${this.path}" is ${this.valueTypeName} stored at ${this.address.toString()}`:`"${this.path}" is ${this.valueTypeName} with value ${this.value}`:`"${this.path}" doesn't exist`}}function Xt(n,e){if(!n)throw new Error(`Assertion failed: ${e!=null?e:"check your code"}`)}const t_=120,Zt={PENDING:"pending",LOCKED:"locked",EXPIRED:"expired",DONE:"done"};class mm{constructor(e,t=t_){this._locks=[],this._lastTid=0,this.debug=e,this.timeout=t*1e3}setTimeout(e){this.timeout=e*1e3}createTid(){return Vt.generate()}_allowLock(e,t,r){const i=this._locks.find(s=>s.tid!==t&&s.state===Zt.LOCKED&&(r||s.forWriting));return{allow:!i,conflict:i}}quit(){return new Promise(e=>{if(this._locks.length===0)return e();this._quit=e})}_rejectLock(e,t){this._locks.splice(this._locks.indexOf(e),1),clearTimeout(e.timeout);try{e.reject(t)}catch(r){console.error("Unhandled promise rejection:",r)}}_processLockQueue(){if(this._quit){const e=new Error("Quitting");this._locks.filter(t=>t.state===Zt.PENDING).forEach(t=>this._rejectLock(t,e)),this._locks.length===0&&this._quit()}this._locks.filter(e=>e.state===Zt.PENDING).sort((e,t)=>e.priority&&!t.priority?-1:!e.priority&&t.priority?1:e.requested-t.requested).forEach(e=>{const t=this._allowLock(e.path,e.tid,e.forWriting);e.waitingFor=t.conflict||null,t.allow&&this.lock(e).then(e.resolve).catch(r=>this._rejectLock(e,r))})}lock(e,t){return K(this,arguments,function*(r,i,s=!0,o="",a={withPriority:!1,noTimeout:!1}){let c,l;if(r instanceof Sl)c=r,l=!0;else{if(this._locks.findIndex(u=>u.tid===i&&u.state===Zt.EXPIRED)>=0)throw new Error(`lock on tid ${i} has expired, not allowed to continue`);if(this._quit&&!a.withPriority)throw new Error("Quitting");{c=new Sl(this,r,i,s,a.withPriority===!0),c.comment=o,this._locks.push(c);const u=this._allowLock(r,i,s);c.waitingFor=u.conflict||null,l=u.allow}}if(l){if(c.state=Zt.LOCKED,typeof c.granted!="number"&&(c.granted=Date.now(),a.noTimeout!==!0)){c.expires=Date.now()+this.timeout;let u=0;const h=()=>{if(c.state===Zt.LOCKED){if(u++,u<=3){this.debug.warn(`${c.forWriting?"write":"read"} lock on path "/${c.path}" by tid ${c.tid} (${c.comment}) is taking a long time to complete [${u}]`),c.timeout=setTimeout(h,this.timeout/4);return}this.debug.error(`lock :: ${c.forWriting?"write":"read"} lock on path "/${c.path}" by tid ${c.tid} (${c.comment}) took too long`),c.state=Zt.EXPIRED,this._processLockQueue()}};c.timeout=setTimeout(h,this.timeout/4)}return c}else return Xt(c.state===Zt.PENDING),new Promise((u,h)=>{c.resolve=u,c.reject=h})})}unlock(e,t,r=!0){let i,s;if(e instanceof Sl)i=e,s=this._locks.indexOf(i);else{const o=e;s=this._locks.findIndex(a=>a.id===o),i=this._locks[s]}if(s<0){const o=`lock on "/${i.path}" for tid ${i.tid} wasn't found; ${t}`;throw new Error(o)}return i.state=Zt.DONE,clearTimeout(i.timeout),this._locks.splice(s,1),r&&this._processLockQueue(),i}list(){return this._locks||[]}isAllowed(e,t,r){return this._allowLock(e,t,r).allow}}let n_=0;class Sl{static get LOCK_STATE(){return Zt}constructor(e,t,r,i,s=!1){this.locker=e,this.path=t,this.tid=r,this.forWriting=i,this.priority=s,this.state=Zt.PENDING,this.requested=Date.now(),this.comment="",this.waitingFor=null,this.id=++n_,this.history=[]}release(e){return K(this,null,function*(){return this.history.push({action:"release",path:this.path,forWriting:this.forWriting,comment:e}),this.locker.unlock(this,e||this.comment)})}moveToParent(){return K(this,null,function*(){const e=J.get(this.path).parentPath;if(this.locker.isAllowed(e,this.tid,this.forWriting))return this.history.push({path:this.path,forWriting:this.forWriting,action:"moving to parent"}),this.waitingFor=null,this.path=e,this;{this.locker.unlock(this,`moveLockToParent: ${this.comment}`,!1);const t=yield this.locker.lock(e,this.tid,this.forWriting,this.comment,{withPriority:!0});return t.history=this.history,t.history.push({path:this.path,forWriting:this.forWriting,action:"moving to parent through queue (priority)"}),t}})}}class Xh extends Error{}class Pu extends Error{}class r_ extends Error{constructor(e){super(`Exiting: ${e}`)}}class i_ extends us{get isMaster(){return this.masterPeerId===this.id}constructor(e,t,r=e.name){super(),this.storage=e,this.id=t,this.dbname=r,this.ipcType="ipc",this.ourSubscriptions=[],this.remoteSubscriptions=[],this.peers=[],this._exiting=!1,this._locks=[],this._requests=new Map,this._eventsEnabled=!0,this._nodeLocker=new mm(e.debug,e.settings.lockTimeout),e.on("subscribe",i=>{if(e.debug.verbose(`database subscription being added on peer ${this.id}`),this.remoteSubscriptions.find(a=>a.callback===i.callback))return;const s=this.ourSubscriptions.some(a=>a.event===i.event&&a.path===i.path);if(this.ourSubscriptions.push(i),s)return;const o={type:"subscribe",from:this.id,data:{path:i.path,event:i.event}};this.sendMessage(o)}),e.on("unsubscribe",i=>{const s=this.remoteSubscriptions.find(o=>o.callback===i.callback);if(s){this.remoteSubscriptions.splice(this.remoteSubscriptions.indexOf(s),1);return}this.ourSubscriptions.filter(o=>o.path===i.path&&(!i.event||o.event===i.event)&&(!i.callback||o.callback===i.callback)).forEach(o=>{this.ourSubscriptions.splice(this.ourSubscriptions.indexOf(o),1);const a={type:"unsubscribe",from:this.id,data:{path:o.path,event:o.event}};this.sendMessage(a)})})}exit(e=0){return K(this,null,function*(){if(this._exiting)return this.once("exit");this._exiting=!0,this.storage.debug.warn(`Received ${this.isMaster?"master":"worker "+this.id} process exit request`),this._locks.length>0&&(this.storage.debug.warn(`Waiting for ${this.isMaster?"master":"worker"} ${this.id} locks to clear`),yield this.once("locks-cleared")),this.sayGoodbye(this.id),this.storage.debug.warn(`${this.isMaster?"Master":"Worker "+this.id} will now exit`),this.emitOnce("exit",e)})}sayGoodbye(e){const t={type:"bye",from:e,data:void 0};this.sendMessage(t)}addPeer(e,t=!0){if(!this._exiting&&(this.peers.find(r=>r.id===e)||this.peers.push({id:e,lastSeen:Date.now()}),t)){const r={type:"hello",from:this.id,to:e,data:void 0};this.sendMessage(r),this.ourSubscriptions.forEach(i=>{const s={type:"subscribe",from:this.id,to:e,data:{path:i.path,event:i.event}};this.sendMessage(s)})}}removePeer(e,t=!1){if(this._exiting)return;const r=this.peers.find(i=>i.id===e);if(!r){if(!t)throw new Error("We are supposed to know this peer!");return}this.peers.splice(this.peers.indexOf(r),1),this.remoteSubscriptions.filter(i=>i.for===e).forEach(i=>{this.remoteSubscriptions.splice(this.remoteSubscriptions.indexOf(i),1),this.storage.subscriptions.remove(i.path,i.event,i.callback)})}addRemoteSubscription(e,t){if(this._exiting||this.remoteSubscriptions.some(i=>i.for===e&&i.event===t.event&&i.path===t.path))return;const r=(i,s,o,a,c)=>{const l={type:"event",from:this.id,to:e,path:t.path,event:t.event,data:{path:s,val:o,previous:a,context:c}};this.sendMessage(l)};this.remoteSubscriptions.push({for:e,event:t.event,path:t.path,callback:r}),this.storage.subscriptions.add(t.path,t.event,r)}cancelRemoteSubscription(e,t){const r=this.remoteSubscriptions.find(i=>i.for===e&&i.event===t.event&&i.path===t.event);!r||this.storage.subscriptions.remove(t.path,t.event,r.callback)}handleMessage(e){return K(this,null,function*(){switch(e.type){case"hello":return this.addPeer(e.from,e.to!==this.id);case"bye":return this.removePeer(e.from,!0);case"subscribe":return this.addRemoteSubscription(e.from,e.data);case"unsubscribe":return this.cancelRemoteSubscription(e.from,e.data);case"event":{if(!this._eventsEnabled)break;const t=e,r=t.data.context||{};r.acebase_ipc={type:this.ipcType,origin:t.from},this.ourSubscriptions.filter(i=>i.event===t.event&&i.path===t.path).forEach(i=>{i.callback(null,t.data.path,t.data.val,t.data.previous,r)});break}case"lock-request":{if(!this.isMaster)throw new Error("Workers are not supposed to receive lock requests!");const t=e,r={type:"lock-result",id:t.id,from:this.id,to:t.from,ok:!0,data:void 0};try{const i=yield this.lock(t.data);r.data={id:i.id,path:i.path,tid:i.tid,write:i.forWriting,expires:i.expires,comment:i.comment}}catch(i){r.ok=!1,r.reason=i.stack||i.message||i}return this.sendMessage(r)}case"lock-result":{if(this.isMaster)throw new Error("Masters are not supposed to receive results for lock requests!");const t=e,r=this._requests.get(t.id);if(typeof r!="object")throw new Error("The request must be known to us!");t.ok?r.resolve(t.data):r.reject(new Error(t.reason));return}case"unlock-request":{if(!this.isMaster)throw new Error("Workers are not supposed to receive unlock requests!");const t=e,r={type:"unlock-result",id:t.id,from:this.id,to:t.from,ok:!0,data:{id:t.data.id}};try{yield this._locks.find(i=>{var s;return((s=i.lock)==null?void 0:s.id)===t.data.id}).lock.release()}catch(i){r.ok=!1,r.reason=i.stack||i.message||i}return this.sendMessage(r)}case"unlock-result":{if(this.isMaster)throw new Error("Masters are not supposed to receive results for unlock requests!");const t=e,r=this._requests.get(t.id);if(typeof r!="object")throw new Error("The request must be known to us!");t.ok?r.resolve(t.data):r.reject(new Error(t.reason));return}case"move-lock-request":{if(!this.isMaster)throw new Error("Workers are not supposed to receive move lock requests!");const t=e,r={type:"lock-result",id:t.id,from:this.id,to:t.from,ok:!0,data:void 0};try{let i;const s=this._locks.find(o=>{var a;return((a=o.lock)==null?void 0:a.id)===t.data.id});if(t.data.move_to==="parent")i=yield s.lock.moveToParent();else throw new Error(`Unknown lock move_to "${t.data.move_to}"`);s.lock=i,r.data={id:i.id,path:i.path,tid:i.tid,write:i.forWriting,expires:i.expires,comment:i.comment}}catch(i){r.ok=!1,r.reason=i.stack||i.message||i}return this.sendMessage(r)}case"notification":return this.emit("notification",e);case"request":return this.emit("request",e);case"result":{const t=e,r=this._requests.get(t.id);if(typeof r!="object")throw new Error("Result of unknown request received");t.ok?r.resolve(t.data):r.reject(new Error(t.reason))}}})}lock(e){return K(this,null,function*(){if(this._exiting&&!this._locks.find(r=>r.tid===e.tid&&r.granted))throw new r_("new transaction lock denied because the IPC peer is exiting");const t=r=>{this._locks.splice(this._locks.indexOf(r),1),this._locks.length===0&&this.emit("locks-cleared")};if(this.isMaster){const r={tid:e.tid,granted:!1,request:e,lock:null};this._locks.push(r);const i=yield this._nodeLocker.lock(e.path,e.tid,e.write,e.comment);r.tid=i.tid,r.granted=!0;const s=o=>({get id(){return o.id},get tid(){return o.tid},get path(){return o.path},get forWriting(){return o.forWriting},get expires(){return o.expires},get comment(){return o.comment},get state(){return o.state},release:()=>K(this,null,function*(){yield o.release(),t(r)}),moveToParent:()=>K(this,null,function*(){const a=yield o.moveToParent();return r.lock=s(a),r.lock})});return r.lock=s(i),r.lock}else{const r={tid:e.tid,granted:!1,request:e,lock:null};this._locks.push(r);const i=c=>(r.granted=!0,r.tid=c.tid,r.lock={id:c.id,tid:c.tid,path:c.path,forWriting:c.write,state:Zt.LOCKED,expires:c.expires,comment:c.comment,release:()=>K(this,null,function*(){const l={type:"unlock-request",id:Vt.generate(),from:this.id,to:this.masterPeerId,data:{id:r.lock.id}};yield this.request(l),r.lock.state=Zt.DONE,this.storage.debug.verbose(`Worker ${this.id} released lock ${r.lock.id} (tid ${r.lock.tid}, ${r.lock.comment}, "/${r.lock.path}", ${r.lock.forWriting?"write":"read"})`),t(r)}),moveToParent:()=>K(this,null,function*(){const l={type:"move-lock-request",id:Vt.generate(),from:this.id,to:this.masterPeerId,data:{id:r.lock.id,move_to:"parent"}};let u;try{u=yield this.request(l)}catch(h){throw r.lock.state=Zt.DONE,t(r),h}return r.lock=i(u),r.lock})},r.lock),s={type:"lock-request",id:Vt.generate(),from:this.id,to:this.masterPeerId,data:e};let o,a;try{o=yield this.request(s)}catch(c){a=c,o=null}if(a)throw t(r),a;return i(o)}})}request(e){return K(this,null,function*(){let t,r;const i=new Promise((s,o)=>{t=a=>{this._requests.delete(e.id),s(a)},r=a=>{this._requests.delete(e.id),o(a)}});return this._requests.set(e.id,{resolve:t,reject:r,request:e}),this.sendMessage(e),i})}sendRequest(e){const t={type:"request",from:this.id,to:this.masterPeerId,id:Vt.generate(),data:e};return this.request(t).catch(r=>{throw this.storage.debug.error(r),r})}replyRequest(e,t){const r={type:"result",id:e.id,ok:!0,from:this.id,to:e.from,data:t};this.sendMessage(r)}sendNotification(e){const t={type:"notification",from:this.id,data:e};this.sendMessage(t)}get eventsEnabled(){return this._eventsEnabled}set eventsEnabled(e){this.storage.debug.log(`ipc events ${e?"enabled":"disabled"}`),this._eventsEnabled=e}}class s_ extends i_{constructor(e){if(super(e,Vt.generate()),this.masterPeerId=this.id,this.ipcType="browser.bcc",window.addEventListener("beforeunload",()=>{this.exit()}),typeof window.BroadcastChannel!="undefined")this.channel=new BroadcastChannel(`acebase:${e.name}`);else{const r=[null],i=()=>{throw new Error("Not implemented")};this.channel={name:`acebase:${e.name}`,postMessage:s=>{const o=Vt.generate(),a=`acebase:${e.name}:${this.id}:${o}`,c=JSON.stringify(ym(s));localStorage.setItem(a,c),setTimeout(()=>localStorage.removeItem(a),10)},set onmessage(s){r[0]=s},set onmessageerror(s){i()},close(){i()},addEventListener(s,o){s!=="message"&&i(),r.push(o)},removeEventListener(s,o){const a=r.indexOf(o);a>=1&&r.splice(a,1)},dispatchEvent(s){return r.forEach(o=>{try{o&&o(s)}catch(a){console.error(a)}}),!0}},window.addEventListener("storage",s=>{const[o,a,c,l]=s.key.split(":");if(o!=="acebase"||a!==e.name||c===this.id||s.newValue===null)return;const u=WE(JSON.parse(s.newValue));this.channel.dispatchEvent({data:u})})}this.channel.addEventListener("message",r=>K(this,null,function*(){const i=r.data;if(!(i.to&&i.to!==this.id)){if(e.debug.verbose("[BroadcastChannel] received: ",i),i.type==="hello"&&i.from<this.masterPeerId)this.masterPeerId=i.from,e.debug.log(`[BroadcastChannel] Tab ${this.masterPeerId} is the master.`);else if(i.type==="bye"&&i.from===this.masterPeerId){e.debug.log(`[BroadcastChannel] Master tab ${this.masterPeerId} is leaving`);const s=this.peers.map(a=>a.id).concat(this.id).filter(a=>a!==this.masterPeerId);this.masterPeerId=s.sort()[0],e.debug.log(`[BroadcastChannel] ${this.masterPeerId===this.id?"We are":`tab ${this.masterPeerId} is`} the new master. Requesting ${this._locks.length} locks (${this._locks.filter(a=>!a.granted).length} pending)`);const o=this._locks.splice(0);yield Promise.all(o.filter(a=>a.granted).map(a=>K(this,null,function*(){let c,l;a.lock.release=()=>new Promise(h=>c=h),a.lock.moveToParent=()=>new Promise(h=>l=h);const u=yield this.lock({path:a.lock.path,write:a.lock.forWriting,tid:a.lock.tid,comment:a.lock.comment});if(l){const h=yield u.moveToParent();l(h)}c&&(yield u.release(),c())}))),yield Promise.all(o.filter(a=>!a.granted).map(a=>K(this,null,function*(){yield this.lock(a.request)})))}return this.handleMessage(i)}}));const t={type:"hello",from:this.id,data:void 0};this.sendMessage(t)}sendMessage(e){this.storage.debug.verbose("[BroadcastChannel] sending: ",e),this.channel.postMessage(e)}}class Ds{static get hasFileSystem(){return!1}static get fs(){return null}}class Zh extends sn{}class vm extends sn{}class o_ extends sn{}class a_ extends sn{}function c_(n,e,t,r){return K(this,null,function*(){if(!n.storage.indexes.supported)throw new Error("Indexes are not supported in current environment because it requires Node.js fs");const{ipc:i,debug:s,indexes:o,storage:a}=n,c=r&&r.rebuild===!0,l=r&&r.type||"normal";let u=r&&r.include||[];typeof u=="string"&&(u=[u]);const h=o.find(f=>f.path===e&&f.key===t&&f.type===l&&f.includeKeys.length===u.length&&f.includeKeys.every((d,y)=>u[y]===d));if(h&&r.config&&(h.config=r.config),h&&c!==!0)return s.log(`Index on "/${e}/*/${t}" already exists`.colorize(St.inverse)),h;if(!i.isMaster){const f=yield i.sendRequest({type:"index.create",path:e,key:t,options:r});if(f.ok)return a.indexes.add(f.fileName);throw new Error(f.reason)}yield Ds.mkdir(`${a.settings.path}/${a.name}.acebase`).catch(f=>{if(f.code!=="EEXIST")throw f});const p=h||(()=>{const{include:f,caseSensitive:d,textLocale:y,textLocaleKey:_}=r,S={include:f,caseSensitive:d,textLocale:y,textLocaleKey:_};switch(l){case"array":return new a_(a,e,t,Q({},S));case"fulltext":return new vm(a,e,t,Ue(Q({},S),{config:r.config}));case"geo":return new o_(a,e,t,Q({},S));default:return new Zh(a,e,t,Q({},S))}})();h||o.push(p);try{yield p.build()}catch(f){throw n.debug.error(`Index build on "/${e}/*/${t}" failed: ${f.message} (code: ${f.code})`.colorize(St.red)),h||o.splice(o.indexOf(p),1),f}return i.sendNotification({type:"index.created",fileName:p.fileName,path:e,key:t,options:r}),p})}const{compareValues:Vo,getChildValues:mi,encodeString:_p,defer:l_}=sm,Iu=["value","child_added","child_changed","child_removed","mutated","mutations"];Iu.push(...Iu.map(n=>`notify_${n}`));const u_=()=>{};class h_ extends Error{constructor(e){super(`Schema validation failed: ${e}`),this.reason=e}}class ef{constructor(e={}){this.maxInlineValueSize=50,this.removeVoidProperties=!1,this.path=".",this.lockTimeout=120,this.type="data",this.readOnly=!1,typeof e.maxInlineValueSize=="number"&&(this.maxInlineValueSize=e.maxInlineValueSize),typeof e.removeVoidProperties=="boolean"&&(this.removeVoidProperties=e.removeVoidProperties),typeof e.path=="string"&&(this.path=e.path),this.path.endsWith("/")&&(this.path=this.path.slice(0,-1)),typeof e.lockTimeout=="number"&&(this.lockTimeout=e.lockTimeout),typeof e.type=="string"&&(this.type=e.type),typeof e.readOnly=="boolean"&&(this.readOnly=e.readOnly),["object","string"].includes(typeof e.ipc)&&(this.ipc=e.ipc)}}class f_ extends us{createTid(){return Vt.generate()}constructor(e,t,r){super(),this.name=e,this.settings=t,this._schemas=[],this._indexes=[],this._annoucedIndexes=new Map,this.indexes={get supported(){return Ds==null?void 0:Ds.hasFileSystem},create:(s,o,a={rebuild:!1})=>{const c={storage:this,debug:this.debug,indexes:this._indexes,ipc:this.ipc};return c_(c,s,o,a)},get:(s,o=null)=>{if(s.includes("$")){const a=J.getPathKeys(s).map(c=>typeof c=="string"&&c.startsWith("$")?"*":c);s=new J(a).path}return this._indexes.filter(a=>a.path===s&&(o===null||o===a.key))},getAll:(s,o={parentPaths:!0,childPaths:!0})=>{const a=J.getPathKeys(s);return this._indexes.filter(c=>{const l=J.getPathKeys(c.path+"/*");return o.parentPaths&&l.every((u,h)=>u==="*"||a[h]===u)&&[c.key].concat(...c.includeKeys).includes(a[l.length])?!0:l.length<a.length||!o.childPaths&&l.length!==a.length?!1:a.every((u,h)=>[u,"*"].includes(l[h]))})},list:()=>this._indexes.slice(),load:()=>K(this,null,function*(){if(this._indexes.splice(0),!Ds.hasFileSystem)return;let s=[];try{s=yield Ds.readdir(`${this.settings.path}/${this.name}.acebase`)}catch(a){a.code!=="ENOENT"&&this.debug.error(a)}const o=[];s.forEach(a=>{if(!a.endsWith(".idx"))return;const c=this.settings.type!=="data",l=/^\[[a-z]+\]-/.test(a);if(!c&&!l||c&&a.startsWith(`[${this.settings.type}]-`)){const u=this.indexes.add(a);o.push(u)}}),yield Promise.all(o)}),add:s=>K(this,null,function*(){const o=this._indexes.find(a=>a.fileName===s);if(o)return o;if(this._annoucedIndexes.has(s))return yield this._annoucedIndexes.get(s);try{const a=Zh.readFromFile(this,s);this._annoucedIndexes.set(s,a);const c=yield a;return this._indexes.push(c),this._annoucedIndexes.delete(s),c}catch(a){return this.debug.error(a),null}}),delete:s=>K(this,null,function*(){const o=yield this.indexes.remove(s);yield o.delete(),this.ipc.sendNotification({type:"index.deleted",fileName:o.fileName,path:o.path,keys:o.key})}),remove:s=>K(this,null,function*(){const o=this._indexes.find(a=>a.fileName===s);if(!o)throw new Error(`Index ${s} not found`);return this._indexes.splice(this._indexes.indexOf(o),1),o}),close:()=>K(this,null,function*(){const s=this.indexes.list().map(o=>o.close().catch(a=>this.debug.error(a)));yield Promise.all(s)})},this._eventSubscriptions={},this.subscriptions={add:(s,o,a)=>{if(Iu.indexOf(o)<0)throw new TypeError(`Invalid event type "${o}"`);let c=this._eventSubscriptions[s];c||(c=this._eventSubscriptions[s]=[]),c.push({created:Date.now(),type:o,callback:a}),this.emit("subscribe",{path:s,event:o,callback:a})},remove:(s,o,a)=>{const c=this._eventSubscriptions[s];if(!c)return;const l=()=>c.findIndex(h=>(o?h.type===o:!0)&&(a?h.callback===a:!0));let u;for(;(u=l())>=0;)c.splice(u,1);this.emit("unsubscribe",{path:s,event:o,callback:a})},hasValueSubscribersForPath(s){return!!this.getValueSubscribersForPath(s)},getValueSubscribersForPath:s=>{const o=new J(s),a=[];return Object.keys(this._eventSubscriptions).forEach(c=>{if(o.equals(c)||o.isDescendantOf(c)){const l=this._eventSubscriptions[c],u=J.fillVariables(c,s);l.filter(h=>!h.type.startsWith("notify_")).forEach(h=>{let p=null;if(h.type==="value")p=u;else if(["mutated","mutations"].includes(h.type)&&o.isDescendantOf(u))p=s;else if(h.type==="child_changed"&&s!==u){const f=J.getPathKeys(s.slice(u.length).replace(/^\//,""))[0];p=J.getChildPath(u,f)}else if(["child_added","child_removed"].includes(h.type)&&o.isChildOf(u)){const f=J.getPathKeys(s.slice(u.length).replace(/^\//,""))[0];p=J.getChildPath(u,f)}p!==null&&!a.some(f=>f.type===h.type&&f.eventPath===u)&&a.push({type:h.type,eventPath:u,dataPath:p,subscriptionPath:c})})}}),a},getAllSubscribersForPath:s=>{const o=J.get(s),a=[];return Object.keys(this._eventSubscriptions).forEach(c=>{if(o.isOnTrailOf(c)){const l=this._eventSubscriptions[c],u=J.fillVariables(c,s);l.forEach(h=>{let p=null;if(h.type==="value"||h.type==="notify_value")p=u;else if(["child_changed","notify_child_changed"].includes(h.type)){const f=s===u||o.isAncestorOf(u)?"*":J.getPathKeys(s.slice(u.length).replace(/^\//,""))[0];p=J.getChildPath(u,f)}else if(["mutated","mutations","notify_mutated","notify_mutations"].includes(h.type))p=s;else if(["child_added","child_removed","notify_child_added","notify_child_removed"].includes(h.type)&&(o.isChildOf(u)||s===u||o.isAncestorOf(u))){const f=s===u||o.isAncestorOf(u)?"*":J.getPathKeys(s.slice(u.length).replace(/^\//,""))[0];p=J.getChildPath(u,f)}p!==null&&!a.some(f=>f.type===h.type&&f.eventPath===u&&f.subscriptionPath===c)&&a.push({type:h.type,eventPath:u,dataPath:p,subscriptionPath:c})})}}),a},trigger:(s,o,a,c,l,u)=>{(this._eventSubscriptions[o]||[]).filter(h=>h.type===s).forEach(h=>{h.callback(null,a,l,c,u)})}},this.debug=new hm(r.logLevel,`[${e}${typeof t.type=="string"&&t.type!=="data"?`:${t.type}`:""}]`);const i=e+(typeof t.type=="string"?`_${t.type}`:"");if(t.ipc==="socket"||t.ipc instanceof sn){const s={ipcName:i,server:t.ipc instanceof sn?t.ipc:null};this.ipc=new sn(this,s)}else if(t.ipc){if(typeof t.ipc.port!="number")throw new Error("IPC port number must be a number");if(!["master","worker"].includes(t.ipc.role))throw new Error(`IPC client role must be either "master" or "worker", not "${t.ipc.role}"`);const s=Object.assign({dbname:i},t.ipc);this.ipc=new sn(this,s)}else this.ipc=new s_(this,i);this.ipc.once("exit",s=>{this.indexes.supported&&this.indexes.close()}),this.nodeLocker={lock:(s,o,a,c)=>this.ipc.lock({path:s,tid:o,write:a,comment:c})},this._lastTid=0}close(){return K(this,null,function*(){yield this.ipc.exit()})}get path(){return`${this.settings.path}/${this.name}.acebase`}valueFitsInline(e){if(typeof e=="number"||typeof e=="boolean"||e instanceof Date)return!0;if(typeof e=="string")return e.length>this.settings.maxInlineValueSize?!1:_p(e).length<this.settings.maxInlineValueSize;if(e instanceof it)return e.path.length>this.settings.maxInlineValueSize?!1:_p(e.path).length<this.settings.maxInlineValueSize;if(e instanceof ArrayBuffer)return e.byteLength<this.settings.maxInlineValueSize;if(e instanceof Array)return e.length===0;if(typeof e=="object")return Object.keys(e).length===0;throw new TypeError("What else is there?")}_writeNode(e,t,r){throw new Error("This method must be implemented by subclass")}getUpdateImpact(e,t){let r=e,i=!1;const s=t?[]:this.subscriptions.getAllSubscribersForPath(e),o=t?[]:this.subscriptions.getValueSubscribersForPath(e);o.length>0&&(i=!0,r=o.map(l=>({path:l.dataPath,keys:J.getPathKeys(l.dataPath)})).sort((l,u)=>l.keys.length<u.keys.length?-1:l.keys.length>u.keys.length?1:0)[0].path,o.filter(l=>l.dataPath===r).every(l=>l.type==="mutated"||l.type.startsWith("notify_"))&&(i=!1),r=J.fillVariables(r,e));const a=this.indexes.getAll(e,{childPaths:!0,parentPaths:!0}).map(l=>({index:l,keys:J.getPathKeys(l.path)})).sort((l,u)=>l.keys.length<u.keys.length?-1:l.keys.length>u.keys.length?1:0).map(l=>l.index),c=[];if(a.length>0){a.sort((h,p)=>(typeof h._pathKeys=="undefined"&&(h._pathKeys=J.getPathKeys(h.path)),typeof p._pathKeys=="undefined"&&(p._pathKeys=J.getPathKeys(p.path)),h._pathKeys.length<p._pathKeys.length?-1:h._pathKeys.length>p._pathKeys.length?1:0));const l=a[0],u=l.path===e?e:J.fillVariables(`${l.path}/*`,e);u.length<r.length&&(r=u,a.filter(h=>h.path===l.path).forEach(h=>{[h.key].concat(h.includeKeys).forEach(p=>!c.includes(p)&&c.push(p))}))}return{topEventPath:r,eventSubscriptions:s,valueSubscribers:o,hasValueSubscribers:i,indexes:a,keysFilter:c}}_writeNodeWithTracking(e,t){return K(this,arguments,function*(r,i,s={merge:!1,waitForIndexUpdates:!0,suppress_events:!1,context:null,impact:null}){if(s=s||{},!s.tid&&!s.transaction)throw new Error("_writeNodeWithTracking MUST be executed with a tid OR transaction!");s.merge=s.merge===!0;const o=this.validateSchema(r,i,{updates:s.merge});if(!o.ok)throw new h_(o.reason);const a=s.tid,c=s.transaction;let l=null;const u=s.impact?s.impact:this.getUpdateImpact(r,s.suppress_events),{topEventPath:h,eventSubscriptions:p,hasValueSubscribers:f,indexes:d}=u;let{keysFilter:y}=u;const _=()=>{if(typeof s._customWriteFunction=="function")return s._customWriteFunction();if(l){const E=J.getPathKeys(r),m=J.getPathKeys(h),v=E.slice(m.length);let g=l;for(;v.length>0&&g!==null;){const k=v.shift();g=typeof g=="object"&&k in g?g[k]:null}s.currentValue=g}return this._writeNode(r,i,s)},S=this.settings.transactions&&this.settings.transactions.log===!0;if(p.length===0&&d.length===0&&!S)return _();if(!f&&s.merge===!0&&y.length===0&&(y=Object.keys(i),h!==r)){const E=r.slice(h.length);y=y.map(m=>`${E}/${m}`)}const I=yield this.getNodeInfo(h,{transaction:c,tid:a});let B=null;if(I.exists){const E={transaction:c,tid:a};y.length>0&&(E.include=y),h===""&&typeof E.include=="undefined"&&this.debug.warn('WARNING: One or more value event listeners on the root node are causing the entire database value to be read to facilitate change tracking. Using "value", "notify_value", "child_changed" and "notify_child_changed" events on the root node are a bad practice because of the significant performance impact. Use "mutated" or "mutations" events instead'),B=(yield this.getNode(h,E)).value}l=B;const j=(yield _())||{};let U,M;if(r===h)s.merge?l===null?U=i instanceof Array?[]:{}:(U=l instanceof Array?[]:{},Object.keys(l).forEach(E=>{U[E]=l[E]})):U=i,M=U;else{const E=r.slice(h.length).replace(/^\//,""),m=J.getPathKeys(E);for(l===null?U=typeof m[0]=="number"?[]:{}:(U=l instanceof Array?[]:{},Object.keys(l).forEach(v=>{U[v]=l[v]})),M=U;m.length>0;){const v=m.shift();if(!s.merge&&m.length===0)M[v]=i;else{const g=M[v],k=typeof v=="number"?[...g]:Q({},g);M[v]=k}M=M[v]}}s.merge&&Object.keys(i).forEach(E=>{M[E]=i[E]});const H=Vo(l,U);if(H==="identical")return j.mutations=[],j;function L(E){if(E===null||typeof E!="object")return E;Object.keys(E).forEach(m=>{const v=E[m];v===null&&(delete E[m],E instanceof Array&&E.length--),typeof v=="object"&&L(v)})}L(U);const F=[];d.map(E=>({index:E,keys:J.getPathKeys(E.path)})).sort((E,m)=>E.keys.length<m.keys.length?1:E.keys.length>m.keys.length?-1:0).forEach(({index:E})=>{const m=J.getPathKeys(h),v=J.getPathKeys(E.path+"/*"),g=v.slice(m.length),k=l,x=U;if(g.length===0){Xt(m.length===v.length,"check logic");const w=this.ipc.isMaster?E.handleRecordUpdate(h,k,x):this.ipc.sendRequest({type:"index.update",fileName:E.fileName,path:h,oldValue:k,newValue:x});F.push(w);return}const b=(w,A,O)=>{if(A===null&&O===null)return[];const $=J.getPathKeys(w),P=J.getPathKeys(E.path+"/*"),N=P.slice($.length);if(N.length===0)return Xt($.length===P.length,"check logic"),[{path:w,oldValue:A,newValue:O}];let D=[],z="";for(;N.length>0;){const q=N.shift();if(typeof q=="string"&&(q==="*"||q.startsWith("$"))){const ne=A===null?[]:Object.keys(A);O!==null&&Object.keys(O).forEach(te=>{ne.indexOf(te)<0&&ne.push(te)}),ne.forEach(te=>{const ue=J.getChildPath(z,te),le=mi(te,A,O),ie=J.getChildPath(w,ue),pe=b(ie,le.oldValue,le.newValue);D=D.concat(pe)});break}else{const ne=mi(q,A,O);if(A=ne.oldValue,O=ne.newValue,A===null&&O===null)break;z=J.getChildPath(z,q)}}return D};b(h,k,x).forEach(w=>{const A=this.ipc.isMaster?E.handleRecordUpdate(w.path,w.oldValue,w.newValue):this.ipc.sendRequest({type:"index.update",fileName:E.fileName,path:w.path,oldValue:w.oldValue,newValue:w.newValue});F.push(A)})});const T=(E,m,v,g=[])=>{let k=!0,x=E.type;if(x.startsWith("notify_")&&(x=x.slice(7)),x==="mutated"||(x==="child_changed"&&(m===null||v===null)?k=!1:x==="value"||x==="child_changed"?k=Vo(m,v)!=="identical":x==="child_added"?k=m===null&&v!==null:x==="child_removed"&&(k=m!==null&&v===null),!k))return;const b=J.getPathKeys(E.dataPath);g.forEach(A=>{const O=b.indexOf(A.name);Xt(O>=0,`Variable "${A.name}" not found in subscription dataPath "${E.dataPath}"`),b[O]=A.value});const w=b.reduce((A,O)=>J.getChildPath(A,O),"");this.subscriptions.trigger(E.type,E.subscriptionPath,w,m,v,s.context)},R=(E,m,v,g)=>{const k=[],x=g||Vo(m,v);return x==="identical"||(typeof x=="string"?k.push({path:E,oldValue:m,newValue:v}):(x.changed.forEach(b=>{const w=J.getChildPath(E,b.key),A=mi(b.key,m,v),O=R(w,A.oldValue,A.newValue,b.change);k.push(...O)}),x.added.forEach(b=>{const w=J.getChildPath(E,b);k.push({path:w,oldValue:null,newValue:v[b]})}),m instanceof Array&&v instanceof Array&&x.removed.sort((b,w)=>b<w?1:-1),x.removed.forEach(b=>{const w=J.getChildPath(E,b);k.push({path:w,oldValue:m[b],newValue:null})}))),k};S&&this.settings.type!=="transaction"&&(j.mutations=(()=>{const E=r.slice(h.length).replace(/^\//,""),m=J.getPathKeys(E);let v=l,g=U;for(;m.length>0;){const x=m.shift();({oldValue:v,newValue:g}=mi(x,v,g))}const k=Vo(v,g);return R(r,v,g,k).map(x=>({target:J.getPathKeys(x.path.slice(r.length)),prev:x.oldValue,val:x.newValue}))})());const C=()=>{p.filter(E=>!["mutated","mutations","notify_mutated","notify_mutations"].includes(E.type)).map(E=>{const m=J.getPathKeys(E.dataPath);return{sub:E,keys:m}}).sort((E,m)=>E.keys.length<m.keys.length?1:E.keys.length>m.keys.length?-1:0).forEach(({sub:E})=>{const m=(v,g,k,x=[])=>{const b=E.dataPath.slice(v.length).replace(/^\//,""),w=J.getPathKeys(b);for(;w.length>0;){const A=w.shift();if(typeof A=="string"&&(A==="*"||A[0]==="$")){const O=g===null?[]:Object.keys(g).map($=>g instanceof Array?parseInt($):$);k!==null&&Object.keys(k).forEach($=>{const P=k instanceof Array?parseInt($):$;!O.includes(P)&&O.push($)}),O.forEach($=>{const P=mi($,g,k),N=x.concat({name:A,value:$});w.length===0?T(E,P.oldValue,P.newValue,N):m(J.getChildPath(v,A),P.oldValue,P.newValue,N)});return}else{v=J.getChildPath(v,A);const O=mi(A,g,k);g=O.oldValue,k=O.newValue}}T(E,g,k,x)};if(E.type.startsWith("notify_")&&J.get(E.eventPath).isAncestorOf(h)){const v=J.get(E.eventPath).isParentOf(h);(E.type==="notify_value"||E.type==="notify_child_changed"&&(!v||!["added","removed"].includes(H))||E.type==="notify_child_removed"&&H==="removed"&&v||E.type==="notify_child_added"&&H==="added"&&v)&&this.subscriptions.trigger(E.type,E.subscriptionPath,E.dataPath,null,null,s.context)}else m(h,l,U)}),p.filter(E=>["mutated","mutations","notify_mutated","notify_mutations"].includes(E.type)).forEach(E=>{let m=h;const v=E.eventPath.slice(m.length).replace(/^\//,""),g=J.getPathKeys(v);let k=l,x=U;for(;g.length>0;){const A=g.shift();m=J.getChildPath(m,A);const O=mi(A,k,x);k=O.oldValue,x=O.newValue}const b=R(m,k,x);if(b.length===0)return;const w=E.type.startsWith("notify_");if(["mutated","notify_mutated"].includes(E.type))b.forEach((A,O)=>{const $=s.context,P=w?null:A.oldValue,N=w?null:A.newValue;this.subscriptions.trigger(E.type,E.subscriptionPath,A.path,P,N,$)});else if(["mutations","notify_mutations"].includes(E.type)){const A=w?null:b.map(O=>({target:J.getPathKeys(O.path.slice(E.subscriptionPath.length)),prev:O.oldValue,val:O.newValue}));this.subscriptions.trigger(E.type,E.subscriptionPath,E.subscriptionPath,null,A,s.context)}})};return s.waitForIndexUpdates===!1&&F.splice(0),yield Promise.all(F),l_(C),j})}getChildren(e,t){throw new Error("This method must be implemented by subclass")}getNodeValue(e){return K(this,arguments,function*(t,r={}){return(yield this.getNode(t,r)).value})}getNode(e,t){throw new Error("This method must be implemented by subclass")}getNodeInfo(e,t){throw new Error("This method must be implemented by subclass")}setNode(e,t,r){throw new Error("This method must be implemented by subclass")}updateNode(e,t,r){throw new Error("This method must be implemented by subclass")}transactNode(e,t){return K(this,arguments,function*(r,i,s={no_lock:!1,suppress_events:!1,context:null}){const o=s&&s.no_lock===!0,a=this.createTid(),c=o?{tid:a,release:u_}:yield this.nodeLocker.lock(r,a,!0,"transactNode");try{let l=!1;const u=()=>{l=!0};o&&this.subscriptions.add(r,"notify_value",u);const h=yield this.getNode(r,{tid:a}),p=h.revision;let f;try{f=i(h.value),f instanceof Promise&&(f=yield f.catch(d=>{this.debug.error(`Error in transaction callback: ${d.message}`)}))}catch(d){this.debug.error(`Error in transaction callback: ${d.message}`)}if(typeof f=="undefined")return;if(o&&this.subscriptions.remove(r,"notify_value",u),l)throw new Pu("Node changed");return yield this.setNode(r,f,{assert_revision:p,tid:c.tid,suppress_events:s.suppress_events,context:s.context})}catch(l){if(l instanceof Pu)return console.warn(`node value changed, running again. Error: ${l.message}`),this.transactNode(r,i,s);throw l}finally{c.release()}})}matchNode(e,t,r){return K(this,null,function*(){var i;const s=(i=r==null?void 0:r.tid)!=null?i:Vt.generate(),o=(c,l)=>K(this,null,function*(){if(l.length===0)return Promise.resolve(!0);const u=l.reduce((d,y)=>{let _=y.key;return typeof _=="string"&&_.includes("/")&&(_=_.slice(0,_.indexOf("/"))),d.indexOf(_)<0&&d.push(_),d},[]),h=u.slice();let p=!0;const f=[];try{return yield this.getChildren(c,{tid:s,keyFilter:u}).next(d=>{var y;const _=(y=d.key)!=null?y:d.index;h.includes(_)&&h.splice(h.indexOf(d.key),1);const S=l.filter(B=>B.key===_).map(B=>({op:B.op,compare:B.compare})),I=S.length>0?a(d,S):{isMatch:!0,promises:[]};if(p=I.isMatch,p){f.push(...I.promises);const B=l.filter(j=>typeof j.key=="string"&&j.key.startsWith(`${typeof _=="number"?`[${_}]`:_}/`)).map(j=>({key:j.key.slice(j.key.indexOf("/")+1),op:j.op,compare:j.compare}));if(B.length>0){const j=J.getChildPath(c,d.key),U=o(j,B).then(M=>({isMatch:M}));f.push(U)}}if(!p||h.length===0)return!1}),p&&(p=(yield Promise.all(f)).every(d=>d.isMatch)),p?(p=h.every(d=>{const y=new gm(Ue(Q(Q({},typeof d=="number"&&{index:d}),typeof d=="string"&&{key:d}),{exists:!1})),_=l.filter(I=>typeof I.key=="string"&&I.key.startsWith(`${typeof d=="number"?`[${d}]`:d}/`)).map(I=>({op:I.op,compare:I.compare}));if(_.length>0&&!a(y,_).isMatch)return!1;const S=l.filter(I=>I.key===d).map(I=>({op:I.op,compare:I.compare}));return S.length===0?!0:a(y,S).isMatch}),p):!1}catch(d){throw this.debug.error(`Error matching on "${c}": `,d),d}}),a=(c,l)=>{const u=[];return{isMatch:l.every(h=>{let p=!0;if(h.op==="!exists"||h.op==="=="&&(typeof h.compare=="undefined"||h.compare===null))p=!c.exists;else if(h.op==="exists"||h.op==="!="&&(typeof h.compare=="undefined"||h.compare===null))p=c.exists;else if((h.op==="contains"||h.op==="!contains")&&h.compare instanceof Array&&h.compare.length===0)p=!0;else if(!c.exists)p=!1;else if(c.address)if(c.valueType===oe.OBJECT&&["has","!has"].indexOf(h.op)>=0){const f=h.op==="has"?"exists":"!exists",d=o(c.path,[{key:h.compare,op:f}]).then(y=>({key:c.key,isMatch:y}));u.push(d),p=!0}else if(c.valueType===oe.ARRAY&&["contains","!contains"].indexOf(h.op)>=0){const f=this.getNode(c.path,{tid:s}).then(({value:d})=>{const y=h.op==="contains"?h.compare instanceof Array?h.compare.every(_=>d.includes(_)):d.includes(h.compare):h.compare instanceof Array?!h.compare.some(_=>d.includes(_)):!d.includes(h.compare);return{key:c.key,isMatch:y}});u.push(f),p=!0}else if(c.valueType===oe.STRING){const f=this.getNode(c.path,{tid:s}).then(d=>({key:c.key,isMatch:this.test(d.value,h.op,h.compare)}));u.push(f),p=!0}else p=!1;else if(c.type===oe.OBJECT&&["has","!has"].indexOf(h.op)>=0){const f=h.compare in c.value;p=f&&h.op==="has"||!f&&h.op==="!has"}else if(c.type===oe.ARRAY&&["contains","!contains"].indexOf(h.op)>=0){const f=c.value.indexOf(h.compare)>=0;p=f&&h.op==="contains"||!f&&h.op==="!contains"}else{let f=this.test(c.value,h.op,h.compare);f instanceof Promise&&(u.push(f),f=!0),p=f}return p}),promises:u}};return o(e,t)})}test(e,t,r){if(t==="<")return e<r;if(t==="<=")return e<=r;if(t==="==")return e===r;if(t==="!=")return e!==r;if(t===">")return e>r;if(t===">=")return e>=r;if(t==="in")return r.indexOf(e)>=0;if(t==="!in")return r.indexOf(e)<0;if(t==="like"||t==="!like"){const i="^"+r.replace(/[-[\]{}()+.,\\^$|#\s]/g,"\\$&").replace(/\?/g,".").replace(/\*/g,".*?")+"$",s=new RegExp(i,"i").test(e.toString());return t==="like"?s:!s}if(t==="matches")return r.test(e.toString());if(t==="!matches")return!r.test(e.toString());if(t==="between")return e>=r[0]&&e<=r[1];if(t==="!between")return e<r[0]||e>r[1];if(t==="has"||t==="!has"){const i=typeof e=="object"&&r in e;return t==="has"?i:!i}if(t==="contains"||t==="!contains"){const i=typeof e=="object"&&e instanceof Array&&e.includes(r);return t==="contains"?i:!i}return!1}exportNode(e,t){return K(this,arguments,function*(r,i,s={format:"json",type_safe:!0}){if((s==null?void 0:s.format)!=="json")throw new Error("Only json output is currently supported");const o=typeof i!="function"?i.write.bind(i):i,a=(d,y)=>{const _=S=>S.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/[\u0000-\u001f]/g,I=>`\\u${I.charCodeAt(0).toString(16).padStart(4,"0")}`);return d===oe.DATETIME?(y=`"${y.toISOString()}"`,s.type_safe&&(y=`{".type":"date",".val":${y}}`)):d===oe.STRING?y=`"${_(y)}"`:d===oe.ARRAY?y="[]":d===oe.OBJECT?y="{}":d===oe.BINARY?(y=`"${_(kr.encode(y))}"`,s.type_safe&&(y=`{".type":"binary",".val":${y}}`)):d===oe.REFERENCE?(y=`"${y.path}"`,s.type_safe&&(y=`{".type":"reference",".val":${y}}`)):d===oe.BIGINT&&(y=`"${y}"`,s.type_safe&&(y=`{".type":"bigint",".val":${y}}`)),y};let c="",l="";const u=yield this.getNodeInfo(r);if(u.exists)if(u.type===oe.OBJECT)c="{",l="}";else if(u.type===oe.ARRAY)c="[",l="]";else{const d=yield this.getNode(r),y=a(u.type,d.value);return o(y)}else return o("null");if(c){const d=o(c);d instanceof Promise&&(yield d)}let h="",p=0;const f=[];if(yield this.getChildren(r).next(d=>{d.address?f.push(d):(p++>0&&(h+=","),typeof d.key=="string"&&(h+=`"${d.key}":`),h+=a(d.type,d.value))}),h){const d=o(h);d instanceof Promise&&(yield d)}for(;f.length>0;){const d=f.shift();let y=p++>0?",":"";const _=typeof d.index=="number"?d.index:d.key;if(typeof _=="string"&&(y+=`"${_}":`),y){const S=o(y);S instanceof Promise&&(yield S)}yield this.exportNode(J.getChildPath(r,_),o,s)}if(l){const d=o(l);d instanceof Promise&&(yield d)}})}importNode(e,t){return K(this,arguments,function*(r,i,s={format:"json",method:"set"}){const o={data:"",index:0,offset:0,queue:[],queueStartByte:0,timesFlushed:0,get processedBytes(){return this.offset+this.index}},a=(L=!1)=>K(this,null,function*(){let F=yield i(262144);if(F===null)throw o.data?new Error(`Unexpected EOF at index ${o.offset+o.data.length}`):new Error("Unable to read data from stream");typeof F=="object"&&(F=tm(F)),L?o.data+=F:(o.offset+=o.data.length,o.data=F,o.index=0)}),c=L=>K(this,null,function*(){let F="";return o.index+L>=o.data.length&&(F=o.data.slice(o.index),L-=F.length,yield a()),F+=o.data.slice(o.index,o.index+L),o.index+=L,F}),l=L=>K(this,null,function*(){if(o.index+L>o.data.length&&(yield a(!0)),o.index+L>o.data.length)throw new Error("Not enough data available from stream")}),u=L=>K(this,null,function*(){const F=yield c(L.length);if(F!==L)throw new Error(`Unexpected character "${F[0]}" at index ${o.offset+o.index}, expected "${L}"`)}),h=()=>K(this,null,function*(){const L=[" ","	","\r",`
`];for(;o.index>=o.data.length&&(yield a()),L.includes(o.data[o.index]);)o.index++}),p=L=>K(this,null,function*(){yield l(L);const F=o.index;return o.data.slice(F,F+L)}),f=()=>K(this,null,function*(){yield h();const L=yield p(1);switch(L){case'"':return"string";case"{":return"object";case"[":return"array";case"n":return"null";case"u":return"undefined";case"t":case"f":return"boolean";default:{if(L==="-"||L>="0"&&L<="9")return"number";throw new Error(`Unknown value at index ${o.offset+o.index}`)}}}),d=()=>K(this,null,function*(){yield u('"');let L="",F=o.index;for(;o.data[F]!=='"'||o.data[F-1]==="\\";)F++,F>=o.data.length&&(L+=o.data.slice(o.index),yield a(),F=0);return L+=o.data.slice(o.index,F),o.index=F+1,I(L)}),y=()=>K(this,null,function*(){throw o.data[o.index]==="t"?yield u("true"):o.data[o.index]==="f"&&(yield u("false")),new Error(`Expected true or false at index ${o.offset+o.index}`)}),_=()=>K(this,null,function*(){let L="",F=o.index;const T=["-","0","1","2","3","4","5","6","7","8","9",".","e","b","f","x","o","n"];for(;T.includes(o.data[F]);)F++,F>=o.data.length&&(L+=o.data.slice(o.index),yield a(),F=0);return L+=o.data.slice(o.index,F),o.index=F,L.endsWith("n")?BigInt(L.slice(0,-1)):L.includes(".")?parseFloat(L):parseInt(L)}),S=()=>K(this,null,function*(){yield h();const L=yield f(),F=yield(()=>{switch(L){case"string":return d();case"object":return{};case"array":return[];case"number":return _();case"null":return null;case"undefined":return;case"boolean":return y()}})();return{type:L,value:F}}),I=L=>L.replace(/\\n/g,`
`).replace(/\\"/g,'"'),B=(L,F)=>{const T=F[".type"];let R=F[".val"];switch(T){case"Date":case"date":{R=new Date(R);break}case"Buffer":case"binary":{if(R=I(R),R.startsWith("<~"))R=kr.decode(R);else throw new Error(`Import error: Unexpected encoding for value for value at path "/${L}"`);break}case"PathReference":case"reference":{R=new it(R);break}case"bigint":{R=BigInt(R);break}default:throw new Error(`Import error: Unsupported type "${T}" for value at path "/${L}"`)}return R},j={acebase_import_id:Vt.generate()},U={suppress_events:s.suppress_events,context:j},M=L=>K(this,null,function*(){if(yield u("{"),yield h(),(yield p(1))==="}")return o.index++,this.setNode(L.path,{},U);let F=0,T={},R=!1;const C=()=>K(this,null,function*(){let m;R?Object.keys(T).length>0&&(m=this.updateNode(L.path,T,U)):(R=!0,m=this.setNode(L.path,T,U)),T={},m&&(yield m)}),E=[];for(;;){yield h();const m=yield d();yield h(),yield u(":"),yield h();const{value:v,type:g}=yield S();if(T[m]=v,F++,["object","array"].includes(g)&&(E.push(C()),g==="object"?yield M(L.child(m)):yield H(L.child(m))),yield h(),(yield p(1))==="}"){o.index++;break}yield u(",")}if(F===2&&".type"in T&&".val"in T){const m=B(L.path,T);return this.setNode(L.path,m,U)}E.push(C()),yield Promise.all(E)}),H=L=>K(this,null,function*(){if(yield u("["),yield h(),(yield p(1))==="]")return o.index++,this.setNode(L.path,[],U);let F=!1,T=[],R={};const C=()=>K(this,null,function*(){let g;F?Object.keys(R).length>0&&(g=this.updateNode(L.path,R,U),R={}):(F=!0,g=this.setNode(L.path,T,U),T=null),g&&(yield g)}),E=(g,k)=>{F?R[k]=g:T.push(g)},m=[];let v=0;for(;;){yield h();const{value:g,type:k}=yield S();if(E(g,v),["object","array"].includes(k)&&(m.push(C()),k==="object"?yield M(L.child(v)):yield H(L.child(v))),yield h(),(yield p(1))==="]"){o.index++;break}yield u(","),v++}m.push(C()),yield Promise.all(m)});return(()=>K(this,null,function*(){const{value:L,type:F}=yield S();if(["object","array"].includes(F)){const T=J.get(r);F==="object"?yield M(T):yield H(T)}else yield this.setNode(r,L,U)}))()})}setSchema(e,t,r=!1){if(typeof t=="undefined")throw new TypeError("schema argument must be given");if(t===null){const o=this._schemas.findIndex(a=>a.path===e);o>=0&&this._schemas.splice(o,1);return}const i=new GE(t,{warnOnly:r,warnCallback:o=>this.debug.warn(o)}),s=this._schemas.find(o=>o.path===e);s?s.schema=i:(this._schemas.push({path:e,schema:i}),this._schemas.sort((o,a)=>{const c=J.getPathKeys(o.path),l=J.getPathKeys(a.path);return c.length===l.length?0:c.length<l.length?-1:1}))}getSchema(e){const t=this._schemas.find(r=>r.path===e);return t?{path:e,schema:t.schema.source,text:t.schema.text}:null}getSchemas(){return this._schemas.map(e=>({path:e.path,schema:e.schema.source,text:e.schema.text}))}validateSchema(e,t,r={updates:!1}){let i={ok:!0};const s=J.get(e);return this._schemas.filter(o=>s.isOnTrailOf(o.path)).every(o=>{if(s.isDescendantOf(o.path)){const u=J.fillVariables(o.path,e),h=s.keys.slice(J.getPathKeys(o.path).length);return i=o.schema.check(u,t,r.updates,h),i.ok}const a=J.getPathKeys(o.path).slice(s.keys.length);if(r.updates===!0&&a.length>0&&!(a[0]in t))return i.ok;const c=r.updates===!0&&a.length===0,l=(u,h,p)=>{if(p.length===0)return o.schema.check(u,h,c);if(h===null)return{ok:!0};const f=p[0];if(typeof f=="string"&&(f==="*"||f[0]==="$")){if(h===null||typeof h!="object")return{ok:!0};let d;return Object.keys(h).every(y=>{const _=J.getChildPath(u,y),S=h[y];return d=l(_,S,p.slice(1)),d.ok}),d}else{const d=J.getChildPath(u,f),y=h[f];return l(d,y,p.slice(1))}};return i=l(e,t,a),i.ok}),i}}class Js{static ChildPathsSql(e,t="path"){return e===""?`${t} <> '' AND ${t} NOT LIKE '%/%'`:`(${t} LIKE '${e}/%' OR ${t} LIKE '${e}[%') AND ${t} NOT LIKE '${e}/%/%' AND ${t} NOT LIKE '${e}[%]/%' AND ${t} NOT LIKE '${e}[%][%'`}static ChildPathsRegex(e){return new RegExp(`^${e}(?:/[^/[]+|\\[[0-9]+\\])$`)}static DescendantPathsSql(e,t="path"){return e===""?`${t} <> ''`:`${t} LIKE '${e}/%' OR ${t} LIKE '${e}[%'`}static DescendantPathsRegex(e){return new RegExp(`^${e}(?:/[^/[]+|\\[[0-9]+\\])`)}static get PathInfo(){return J}}class Ap{constructor(e){this.path=e}toString(){return`"/${this.path}"`}equals(e){return this.path===e.path}}const{compareValues:d_}=sm;class tf{constructor(e){this.production=!1,this.target={get originalPath(){return e.path},path:e.path,get write(){return e.write}},this.id=Vt.generate()}getChildCount(e){return K(this,null,function*(){let t=0;return yield this.childrenOf(e,{metadata:!1,value:!1},()=>(t++,!1)),t})}getMultiple(e){return K(this,null,function*(){const t=new Map;return yield Promise.all(e.map(r=>this.get(r).then(i=>t.set(r,i)))),t})}setMultiple(e){return K(this,null,function*(){yield Promise.all(e.map(({path:t,node:r})=>this.set(t,r)))})}removeMultiple(e){return K(this,null,function*(){yield Promise.all(e.map(t=>this.remove(t)))})}commit(){return K(this,null,function*(){throw new Error("CustomStorageTransaction.rollback must be overridden by subclass")})}moveToParentPath(e){return K(this,null,function*(){const t=this._lock&&this._lock.path||this.target.path;if(t===e)return e;if(Js.PathInfo.get(e).isParentOf(t))this._lock&&(this._lock=yield this._lock.moveToParent());else throw new Error(`Locking issue. Locked path "${this._lock.path}" is not a child/descendant of "${e}"`);return this.target.path=e,e})}}class Ys extends ef{constructor(e){if(super(e),this.locking=!0,typeof e!="object")throw new Error("settings missing");if(typeof e.ready!="function")throw new Error("ready must be a function");if(typeof e.getTransaction!="function")throw new Error("getTransaction must be a function");this.name=e.name,this.locking=e.locking!==!1,this.locking&&(this.lockTimeout=typeof e.lockTimeout=="number"?e.lockTimeout:120),this.ready=e.ready;const t=this.locking,r=t?new mm(console,this.lockTimeout):null;this.getTransaction=i=>K(this,[i],function*({path:s,write:o}){const a=yield e.getTransaction({path:s,write:o});Xt(typeof a.id=="string","transaction id not set");const c=a.rollback,l=a.commit;return a.commit=()=>K(this,null,function*(){const u=yield l.call(a);return t&&(yield a._lock.release("commit")),u}),a.rollback=u=>K(this,null,function*(){const h=yield c.call(a,u);return t&&(yield a._lock.release("rollback")),h}),t&&(a._lock=yield r.lock(s,a.id,o,`${this.name}::getTransaction`)),a})}}class $l extends gm{constructor(e){super(e),this.revision=e.revision,this.revision_nr=e.revision_nr,this.created=e.created,this.modified=e.modified}}class p_ extends f_{constructor(e,t,r){super(e,t,r),this._customImplementation=t,this._init()}_init(){return K(this,null,function*(){this.debug.log(`Database "${this.name}" details:`.colorize(St.dim)),this.debug.log("- Type: CustomStorage".colorize(St.dim)),this.debug.log(`- Path: ${this.settings.path}`.colorize(St.dim)),this.debug.log(`- Max inline value size: ${this.settings.maxInlineValueSize}`.colorize(St.dim)),this.debug.log(`- Autoremove undefined props: ${this.settings.removeVoidProperties}`.colorize(St.dim)),yield this._customImplementation.ready();const e=yield this._customImplementation.getTransaction({path:"",write:!0});(yield this.getNodeInfo("",{transaction:e})).exists||(yield this._writeNode("",{},{transaction:e})),yield e.commit(),this.indexes.supported&&(yield this.indexes.load()),this.emit("ready")})}throwImplementationError(e){throw new Error(`CustomStorage "${this._customImplementation.name}" ${e}`)}_storeNode(e,t,r){const i=o=>{if(o===null)throw new Error("Not allowed to store null values. remove the property");if(["string","number","boolean"].includes(typeof o))return o;if(o instanceof Date)return{type:oe.DATETIME,value:o.getTime()};if(o instanceof it)return{type:oe.REFERENCE,value:o.path};if(o instanceof ArrayBuffer)return{type:oe.BINARY,value:kr.encode(o)};if(typeof o=="object")return Xt(Object.keys(o).length===0,"child object stored in parent can only be empty"),o},s="Caller should have pre-processed the value by converting it to a string";if(t.type===oe.ARRAY&&t.value instanceof Array){console.warn(`Unprocessed array. ${s}`);const o={};for(let a=0;a<t.value.length;a++)o[a]=t.value[a];t.value=o}if(t.type===oe.BINARY&&typeof t.value!="string"&&(console.warn(`Unprocessed binary value. ${s}`),t.value=kr.encode(t.value)),t.type===oe.REFERENCE&&t.value instanceof it&&(console.warn(`Unprocessed path reference. ${s}`),t.value=t.value.path),[oe.OBJECT,oe.ARRAY].includes(t.type)){const o=t.value;t.value={},Object.keys(o).forEach(a=>{t.value[a]=i(o[a])})}return r.transaction.set(e,t)}_processReadNodeValue(e){const t=r=>{if(r.type===oe.BINARY)return kr.decode(r.value);if(r.type===oe.DATETIME)return new Date(r.value);if(r.type===oe.REFERENCE)return new it(r.value);throw new Error(`Unhandled child value type ${r.type}`)};switch(e.type){case oe.ARRAY:case oe.OBJECT:{const r=e.value;Object.keys(r).forEach(i=>{const s=r[i];typeof s=="object"&&"type"in s&&(r[i]=t(s))}),e.value=r;break}case oe.BINARY:{e.value=kr.decode(e.value);break}case oe.REFERENCE:{e.value=new it(e.value);break}case oe.STRING:break;default:throw new Error("Invalid standalone record value type")}}_readNode(e,t){return K(this,null,function*(){const r=yield t.transaction.get(e);return r===null?null:(typeof r!="object"&&this.throwImplementationError("transaction.get must return an ICustomStorageNode object. Use JSON.parse if your set function stored it as a string"),this._processReadNodeValue(r),r)})}_getTypeFromStoredValue(e){let t;if(typeof e=="string")t=oe.STRING;else if(typeof e=="number")t=oe.NUMBER;else if(typeof e=="boolean")t=oe.BOOLEAN;else if(e instanceof Array)t=oe.ARRAY;else if(typeof e=="object")if("type"in e){const r=e;t=r.type,e=r.value,t===oe.DATETIME?e=new Date(e):t===oe.REFERENCE&&(e=new it(e))}else t=oe.OBJECT;else throw new Error("Unknown value type");return{type:t,value:e}}_writeNode(e,t,r){return K(this,null,function*(){if(!r.merge&&this.valueFitsInline(t)&&e!=="")throw new Error("invalid value to store in its own node");if(e===""&&(typeof t!="object"||t instanceof Array))throw new Error("Invalid root node value. Must be an object");if(typeof r.diff=="undefined"&&typeof r.currentValue!="undefined"){const d=d_(r.currentValue,t);r.merge&&typeof d=="object"&&(d.removed=d.removed.filter(y=>t[y]===null)),r.diff=d}if(r.diff==="identical")return;const i=r.transaction,s=r.currentValue===null?null:yield this._readNode(e,{transaction:i});if(r.merge&&s){if(s.type===oe.ARRAY&&!(t instanceof Array)&&typeof t=="object"&&Object.keys(t).some(d=>isNaN(parseInt(d))))throw new Error(`Cannot merge existing array of path "${e}" with an object`);if(t instanceof Array&&s.type!==oe.ARRAY)throw new Error(`Cannot merge existing object of path "${e}" with an array`)}const o=r.revision||Vt.generate(),a={type:s&&s.type===oe.ARRAY?oe.ARRAY:oe.OBJECT,value:{}},c={};if(t instanceof Array){a.type=oe.ARRAY;const d={};for(let y=0;y<t.length;y++)d[y]=t[y];t=d}else t instanceof it?(a.type=oe.REFERENCE,a.value=t.path):t instanceof ArrayBuffer?(a.type=oe.BINARY,a.value=kr.encode(t)):typeof t=="string"&&(a.type=oe.STRING,a.value=t);const l=s?[oe.OBJECT,oe.ARRAY].includes(s.type):!1,u=[oe.OBJECT,oe.ARRAY].includes(a.type),h={current:[],new:[]};let p=null;l&&(p=s.value,h.current=Object.keys(p),u&&(a.value=p)),u&&(r.merge||Object.keys(a.value).forEach(d=>{d in t||(t[d]=null)}),Object.keys(t).forEach(d=>{const y=t[d];if(delete a.value[d],y!==null){if(typeof y=="undefined")if(this.settings.removeVoidProperties===!0){delete t[d];return}else throw new Error(`Property "${d}" has invalid value. Cannot store undefined values. Set removeVoidProperties option to true to automatically remove undefined properties`);this.valueFitsInline(y)?a.value[d]=y:c[d]=y}}));const f=a.type===oe.ARRAY;if(s){if(this.debug.log(`Node "/${e}" is being ${r.merge?"updated":"overwritten"}`.colorize(St.cyan)),l||u){const y=J.get(e),_=[];let S=!1;const I=F=>(S=!0,!i.production&&!y.isParentOf(F)&&this.throwImplementationError(`"${F}" is not a child of "${e}" - childrenOf must only check and return paths that are children`),!0),B=F=>{S||this.throwImplementationError("childrenOf did not call checkCallback before addCallback");const T=J.get(F).key;return _.push(T.toString()),!0};yield i.childrenOf(e,{metadata:!1,value:!1},I,B),h.current=h.current.concat(_),u&&(r&&r.merge&&(h.new=h.current.slice()),Object.keys(t).forEach(F=>{h.new.includes(F)||h.new.push(F)}));const j={insert:h.new.filter(F=>!h.current.includes(F)),update:[],delete:r&&r.merge?Object.keys(t).filter(F=>t[F]===null):h.current.filter(F=>!h.new.includes(F))};if(j.update=h.new.filter(F=>h.current.includes(F)&&!j.delete.includes(F)),f&&r.merge&&(j.insert.length>0||j.delete.length>0)&&!j.update.concat(j.insert).every((F,T,R)=>R.includes(T.toString())))throw new Error(`Elements cannot be inserted beyond, or removed before the end of an array. Rewrite the whole array at path "${e}" or change your schema to use an object collection instead`);const U=Object.keys(c).map(F=>{const T=f?parseInt(F):F,R=typeof r.diff=="object"?r.diff.forChild(T):void 0;if(R==="identical")return;const C=y.childPath(T),E=c[T],m=typeof r.currentValue=="undefined"?void 0:r.currentValue!==null&&typeof r.currentValue=="object"&&T in r.currentValue?r.currentValue[T]:null;return this._writeNode(C,E,{transaction:i,revision:o,merge:!1,currentValue:m,diff:R})}),M=u?_.filter(F=>F in a.value):[],H=j.delete.concat(M).map(F=>{const T=f?parseInt(F):F,R=y.childPath(T);return this._deleteNode(R,{transaction:i})}),L=U.concat(H);yield Promise.all(L)}const d=this._storeNode(e,{type:a.type,value:a.value,revision:s.revision,revision_nr:s.revision_nr+1,created:s.created,modified:Date.now()},{transaction:i});if(d instanceof Promise)return yield d}else{if(this.debug.log(`Node "/${e}" is being created`.colorize(St.cyan)),f&&!Object.keys(a.value).concat(Object.keys(c)).every((_,S,I)=>I.includes(S.toString())))throw new Error("Cannot store arrays with missing entries");const d=Object.keys(c).map(_=>{const S=f?parseInt(_):_,I=J.getChildPath(e,S),B=c[S];return this._writeNode(I,B,{transaction:i,revision:o,merge:!1,currentValue:null})}),y=this._storeNode(e,{type:a.type,value:a.value,revision:o,revision_nr:1,created:Date.now(),modified:Date.now()},{transaction:i});y instanceof Promise&&d.push(y),yield Promise.all(d)}})}_deleteNode(e,t){return K(this,null,function*(){const r=J.get(e);this.debug.log(`Node "/${e}" is being deleted`.colorize(St.cyan));const i=[e];let s=!1;const o=l=>(s=!0,!c.production&&!r.isAncestorOf(l)&&this.throwImplementationError(`"${l}" is not a descendant of "${e}" - descendantsOf must only check and return paths that are descendants`),!0),a=l=>(s||this.throwImplementationError("descendantsOf did not call checkCallback before addCallback"),i.push(l),!0),c=t.transaction;return yield c.descendantsOf(e,{metadata:!1,value:!1},o,a),this.debug.log(`Nodes ${i.map(l=>`"/${l}"`).join(",")} are being deleted`.colorize(St.cyan)),c.removeMultiple(i)})}getChildren(e,t={}){let r;const i={next(o){return r=o,s()}},s=()=>K(this,null,function*(){const o=t.transaction||(yield this._customImplementation.getTransaction({path:e,write:!1}));try{let a=!1;return yield(()=>K(this,null,function*(){const c=yield this._readNode(e,{transaction:o});if(!c)throw new Xh(`Node "/${e}" does not exist`);if(![oe.OBJECT,oe.ARRAY].includes(c.type))return;const l=c.type===oe.ARRAY,u=c.value;let h=Object.keys(u).map(_=>l?parseInt(_):_);t.keyFilter&&(h=h.filter(_=>t.keyFilter.includes(_)));const p=J.get(e);if(h.length>0&&h.every(_=>{const S=this._getTypeFromStoredValue(u[_]),I=new $l({path:p.childPath(_),key:l?null:_,index:l?_:null,type:S.type,address:null,exists:!0,value:S.value,revision:c.revision,revision_nr:c.revision_nr,created:new Date(c.created),modified:new Date(c.modified)});return a=r(I)===!1,!a}),a)return;let f=!1;const d=_=>{if(f=!0,!o.production&&!p.isParentOf(_)&&this.throwImplementationError(`"${_}" is not a child of "${e}" - childrenOf must only check and return paths that are children`),t.keyFilter){const S=J.get(_).key;return t.keyFilter.includes(S)}return!0},y=(_,S)=>{f||this.throwImplementationError("childrenOf did not call checkCallback before addCallback");const I=J.get(_).key,B=new $l({path:_,type:S.type,key:l?null:I,index:l?I:null,address:new Ap(_),exists:!0,value:null,revision:S.revision,revision_nr:S.revision_nr,created:new Date(S.created),modified:new Date(S.modified)});return a=r(B)===!1,!a};yield o.childrenOf(e,{metadata:!0,value:!1},d,y)}))(),t.transaction||(yield o.commit()),a}catch(a){throw t.transaction||(yield o.rollback(a)),a}});return i}getNode(e,t){return K(this,null,function*(){t=t||{};const r=t.transaction||(yield this._customImplementation.getTransaction({path:e,write:!1}));try{const i=yield(()=>K(this,null,function*(){const s=t.include&&t.include.length>0||t.exclude&&t.exclude.length>0||t.child_objects===!1,o=J.get(e),a=yield this._readNode(e,{transaction:r});if(!a){if(e==="")return{value:null};const B=yield r.moveToParentPath(o.parentPath);Xt(B===o.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${e}"`);const j=yield this._readNode(o.parentPath,{transaction:r});if(j&&[oe.OBJECT,oe.ARRAY].includes(j.type)&&o.key in j.value){const U=this._getTypeFromStoredValue(j.value[o.key]);return{revision:j.revision,revision_nr:j.revision_nr,created:j.created,modified:j.modified,type:U.type,value:U.value}}return{value:null}}const c=a.type===oe.ARRAY,l=B=>{const j=U=>/^[0-9]+$/.test(U);return B.map(U=>J.get(c&&j(U)?`[${U}]`:U))},u=t.include?l(t.include):[],h=t.exclude?l(t.exclude):[],p=(B,j)=>{if([oe.OBJECT,oe.ARRAY].includes(j.type)&&u.length>0){const U=J.getPathKeys(B).slice(o.keys.length),M=new J(U),H=[],L=u.filter(T=>T.isDescendantOf(M));if(L.length>0){const T=j.type===oe.ARRAY;H.push(...Object.keys(j.value).map(R=>T?+R:R));for(const R of L){const C=R.keys[U.length];if(typeof C=="string"&&(C==="*"||C.startsWith("$"))){H.splice(0);break}const E=H.indexOf(C);E>=0&&H.splice(E,1)}}const F=u.some(T=>T.isChildOf(M));if(h.some(T=>T.isChildOf(M))&&!F){const T=h.filter(R=>R.isChildOf(M));for(let R=0;R<H.length;R++)T.find(C=>C.equals(H[R]))||(H.splice(R,1),R--)}for(const T of H)delete j.value[T]}};p(e,a);let f=!1;const d=(B,j)=>{if(f=!0,!r.production&&!o.isAncestorOf(B)&&this.throwImplementationError(`"${B}" is not a descendant of "${e}" - descendantsOf must only check and return paths that are descendants`),!s)return!0;const U=J.getPathKeys(B).slice(o.keys.length),M=new J(U);let H=(u.length>0?u.some(L=>M.isOnTrailOf(L)):!0)&&(h.length>0?!h.some(L=>L.equals(M)||L.isAncestorOf(M)):!0);return H&&t.child_objects===!1&&(o.isParentOf(B)&&[oe.OBJECT,oe.ARRAY].includes(j?j.type:-1)||J.getPathKeys(B).length>o.pathKeys.length+1)&&(H=!1),H},y=[],_=(B,j)=>{if(f||this.throwImplementationError("descendantsOf did not call checkCallback before addCallback"),t.child_objects===!1&&[oe.OBJECT,oe.ARRAY].includes(j.type))return!0;p(B,j),this._processReadNodeValue(j);const U=j;return U.path=B,y.push(U),!0};yield r.descendantsOf(e,{metadata:!0,value:!0},d,_),this.debug.log(`Read node "/${e}" and ${s?"(filtered) ":""}descendants from ${y.length+1} records`.colorize(St.magenta));const S=a,I=B=>{const j=[];return Object.keys(B).forEach(U=>{const M=parseInt(U);j[M]=B[M]}),j};if(a.type===oe.ARRAY&&(S.value=I(S.value)),a.type===oe.OBJECT||a.type===oe.ARRAY){const B=J.getPathKeys(e),j=a.value;for(let U=0;U<y.length;U++){const M=y[U],H=J.getPathKeys(M.path).slice(B.length);let L=j;for(let F=0;F<H.length;F++){Xt(typeof L=="object","parent must be an object/array to have children!!");const T=H[F],R=F===H.length-1,C=R?M.type:typeof H[F+1]=="number"?oe.ARRAY:oe.OBJECT;let E;R?(E=M.value,C===oe.ARRAY&&(E=I(E))):E=C===oe.OBJECT?{}:[],T in L?typeof L[T]==typeof E&&[oe.OBJECT,oe.ARRAY].includes(C)?Object.keys(E).forEach(m=>{m in L[T]&&this.throwImplementationError(`Custom storage merge error: child key "${m}" is in parent value already! Make sure the get/childrenOf/descendantsOf methods of the custom storage class return values that can be modified by AceBase without affecting the stored source`),L[T][m]=E[m]}):this.debug.error(`The value stored in node "${M.path}" cannot be merged with the parent node, value will be ignored. This error should disappear once the target node value is updated. See issue #20 for more information`,{path:e,parent:L,key:T,nodeType:C,nodeValue:E}):L[T]=E,L=L[T]}}}else y.length>0&&this.throwImplementationError("multiple records found for non-object value!");if(t.child_objects===!1&&Object.keys(S.value).forEach(B=>{typeof S.value[B]=="object"&&S.value[B].constructor===Object&&(Xt(Object.keys(S.value[B]).length===0),delete S.value[B])}),t.include,t.exclude){const B=(j,U)=>{if(typeof j!="object")return;const M=U[0];M==="*"?Object.keys(j).forEach(H=>{B(j[H],U.slice(1))}):U.length>1?M in j&&B(j[M],U.slice(1)):delete j[M]};t.exclude.forEach(j=>{const U=J.getPathKeys(j);B(S.value,U)})}return S}))();return t.transaction||(yield r.commit()),i}catch(i){throw t.transaction||(yield r.rollback(i)),i}})}getNodeInfo(e){return K(this,arguments,function*(t,r={}){r=r||{};const i=J.get(t),s=r.transaction||(yield this._customImplementation.getTransaction({path:t,write:!1}));try{const o=yield this._readNode(t,{transaction:s}),a=new $l({path:t,key:typeof i.key=="string"?i.key:null,index:typeof i.key=="number"?i.key:null,type:o?o.type:0,exists:o!==null,address:o?new Ap(t):null,created:o?new Date(o.created):null,modified:o?new Date(o.modified):null,revision:o?o.revision:null,revision_nr:o?o.revision_nr:null});if(!o&&t!==""){const c=yield s.moveToParentPath(i.parentPath);Xt(c===i.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${t}"`);const l=yield this._readNode(i.parentPath,{transaction:s});l&&[oe.OBJECT,oe.ARRAY].includes(l.type)&&i.key in l.value?(a.exists=!0,a.value=l.value[i.key],a.address=null,a.type=l.type,a.created=new Date(l.created),a.modified=new Date(l.modified),a.revision=l.revision,a.revision_nr=l.revision_nr):a.address=null}return r.include_child_count&&(a.childCount=0,[oe.OBJECT,oe.ARRAY].includes(a.valueType)&&a.address&&(a.childCount=o.value?Object.keys(o.value).length:0,a.childCount+=yield s.getChildCount(t))),r.transaction||(yield s.commit()),a}catch(o){throw r.transaction||(yield s.rollback(o)),o}})}setNode(e,t){return K(this,arguments,function*(r,i,s={suppress_events:!1,context:null}){if(this.settings.readOnly)throw new Error("Database is opened in read-only mode");const o=J.get(r),a=s.transaction||(yield this._customImplementation.getTransaction({path:r,write:!0}));try{if(r===""){if(i===null||typeof i!="object"||i instanceof Array||i instanceof ArrayBuffer||"buffer"in i&&i.buffer instanceof ArrayBuffer)throw new Error(`Invalid value for root node: ${i}`);yield this._writeNodeWithTracking("",i,{merge:!1,transaction:a,suppress_events:s.suppress_events,context:s.context})}else if(typeof s.assert_revision!="undefined"){const c=yield this.getNodeInfo(r,{transaction:a});if(c.revision!==s.assert_revision)throw new Pu(`revision '${c.revision}' does not match requested revision '${s.assert_revision}'`);if(c.address&&c.address.path===r&&i!==null&&!this.valueFitsInline(i))yield this._writeNodeWithTracking(r,i,{merge:!1,transaction:a,suppress_events:s.suppress_events,context:s.context});else{const l=yield a.moveToParentPath(o.parentPath);Xt(l===o.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${r}"`),yield this._writeNodeWithTracking(o.parentPath,{[o.key]:i},{merge:!0,transaction:a,suppress_events:s.suppress_events,context:s.context})}}else{const c=yield a.moveToParentPath(o.parentPath);Xt(c===o.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${r}"`),yield this.updateNode(o.parentPath,{[o.key]:i},{transaction:a,suppress_events:s.suppress_events,context:s.context})}s.transaction||(yield a.commit())}catch(c){throw s.transaction||(yield a.rollback(c)),c}})}updateNode(e,t){return K(this,arguments,function*(r,i,s={suppress_events:!1,context:null}){if(this.settings.readOnly)throw new Error("Database is opened in read-only mode");if(typeof i!="object")throw new Error("invalid updates argument");if(Object.keys(i).length===0)return;const o=s.transaction||(yield this._customImplementation.getTransaction({path:r,write:!0}));try{const a=yield this.getNodeInfo(r,{transaction:o}),c=J.get(r);if(a.exists&&a.address&&a.address.path===r)yield this._writeNodeWithTracking(r,i,{transaction:o,merge:!0,suppress_events:s.suppress_events,context:s.context});else if(a.exists){const l=J.get(r),u=yield o.moveToParentPath(l.parentPath);Xt(u===l.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${r}"`),yield this._writeNodeWithTracking(l.parentPath,{[l.key]:i},{transaction:o,merge:!0,suppress_events:s.suppress_events,context:s.context})}else{const l=yield o.moveToParentPath(c.parentPath);Xt(l===c.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${r}"`),yield this.updateNode(c.parentPath,{[c.key]:i},{transaction:o,suppress_events:s.suppress_events,context:s.context})}s.transaction||(yield o.commit())}catch(a){throw s.transaction||(yield o.rollback(a)),a}})}}class y_{constructor(e=1e3,t){this.limit=e,this.options=t,this.added=0,this.scheduled=[],this.running=0,this.results=[],this.done=!1}execute(e,t){return K(this,null,function*(){var r,i;try{this.running++;const s=yield e();if(this.results[t]=s,this.running--,this.running===0&&this.scheduled.length===0)this.done=!0,(r=this.doneCallback)==null||r.call(this,this.results);else if(this.scheduled.length>0){const o=this.scheduled.shift();this.execute(o.task,o.index)}}catch(s){this.done=!0,(i=this.errorCallback)==null||i.call(this,s)}})}add(e){var t;if(this.done)throw new Error("Cannot add to a batch that has already finished. Use wait option and start batch processing manually if you are adding tasks in an async loop");const r=this.added++;((t=this.options)==null?void 0:t.wait)!==!0&&this.running<this.limit?this.execute(e,r):this.scheduled.push({task:e,index:r})}start(){for(;this.running<this.limit;){const e=this.scheduled.shift();this.execute(e.task,e.index)}}finish(){return K(this,null,function*(){return this.running===0&&this.scheduled.length===0?this.results:(yield new Promise((e,t)=>{this.doneCallback=e,this.errorCallback=t}),this.results)})}}const g_=()=>{};function bm(n,e,t){return K(this,arguments,function*(r,i,s,o={snapshots:!1,include:void 0,exclude:void 0,child_objects:void 0,eventHandler:g_}){var a,c,l,u,h,p;typeof o!="object"&&(o={}),typeof o.snapshots=="undefined"&&(o.snapshots=!1);const f={};(a=r.storage.settings.transactions)!=null&&a.log&&(f.acebase_cursor=Vt.generate());const d=s.filters.map(E=>Q({},E)),y=s.order.map(E=>Q({},E)),_=E=>{E.sort((m,v)=>{const g=k=>{const x=y[k],b=J.getPathKeys(typeof x.key=="number"?`[${x.key}]`:x.key),w=b.reduce((O,$)=>O!==null&&typeof O=="object"&&$ in O?O[$]:null,m.val),A=b.reduce((O,$)=>O!==null&&typeof O=="object"&&$ in O?O[$]:null,v.val);return w===null?A===null?0:x.ascending?-1:1:A===null?x.ascending?1:-1:w==A?k<y.length-1?g(k+1):m.path<v.path?-1:1:w<A?x.ascending?-1:1:x.ascending?1:-1};return g(0)})},S=(E,m)=>K(this,null,function*(){if(E.length===0)return[];const v=50,g=new y_(v),k=[];return E.forEach(({path:x},b)=>g.add(()=>K(this,null,function*(){const w=(yield r.storage.getNode(x,m)).value;if(w===null){r.storage.debug.warn(`Indexed result "/${x}" does not have a record!`);return}const A={path:x,val:w};C.sorted?k[b]=A:(k.push(A),!C.skipped&&k.length>s.skip+Math.abs(s.take)&&(_(k),k.pop()))}))),yield g.finish(),k}),I=J.get(i),B=I.keys.some(E=>E==="*"||E.toString().startsWith("$")),j=r.storage.indexes.get(i),U=[];let M=()=>K(this,null,function*(){});if(B){const E=I.keys.filter(g=>typeof g=="string"&&g.startsWith("$")),m=E.length>0&&E.every(g=>s.filters.some(k=>k.key===g&&["==","in"].includes(k.op))),v=typeof o.monitor=="object"&&[(c=o.monitor)==null?void 0:c.add,(l=o.monitor)==null?void 0:l.change,(u=o.monitor)==null?void 0:u.remove].some(g=>g===!0);if(m&&!v){const g=[];for(const O of E){const $=s.filters.filter(N=>N.key===O).reduce((N,D)=>{if(D.op==="=="&&N.push(D.compare),D.op==="in"){if(!(D.compare instanceof Array))throw new Error("compare argument for 'in' operator must be an Array");N.push(...D.compare)}return N},[]),P=g.splice(0);$.forEach(N=>{P.length===0?g.push({[O]:N}):g.push(...P.map(D=>Ue(Q({},D),{[O]:N})))})}const k=s.filters.filter(O=>!E.includes(O.key)),x=g.map(O=>J.get(J.getPathKeys(i).map($=>{var P;return(P=O[$])!=null?P:$})).path),b=s.order.length>0,w=x.map(O=>{var $;return bm(r,O,{filters:k,take:0,skip:0,order:[]},{snapshots:b,cache_mode:o.cache_mode,include:[...($=o.include)!=null?$:[],...s.order.map(P=>P.key)],exclude:o.exclude})});let A=(yield Promise.all(w)).reduce((O,$)=>(O.push(...$.results),O),[]);if(b&&_(A),s.skip>0&&A.splice(0,s.skip),s.take>0&&A.splice(s.take),o.snapshots&&(!b||((h=o.include)==null?void 0:h.length)>0||((p=o.exclude)==null?void 0:p.length)>0||!o.child_objects)){const{include:O,exclude:$,child_objects:P}=o;A=yield S(A,{include:O,exclude:$,child_objects:P})}return{results:A,context:null,stop:M}}else if(j.length===0){const g=new Error(`Query on wildcard path "/${i}" requires an index`);return Promise.reject(g)}if(d.length===0){const g=j.filter(k=>k.type==="normal")[0];d.push({key:g.key,op:"!=",compare:null})}}d.forEach(E=>{if(E.index)return;const m=j.filter(v=>v.key===E.key).filter(v=>v.validOperators.includes(E.op));if(m.length>=1){const v=d.filter(b=>b!==E).map(b=>b.key),g=y.map(b=>b.key).filter(b=>b!==E.key),k=m.map(b=>{const w=b.includeKeys.concat(b.key),A=w.filter(N=>v.includes(N)),O=w.filter(N=>g.includes(N)),$=A.concat(O.filter(N=>!A.includes(N))),P={filters:A.length,sorting:O.length*(s.take!==0?O.length:1),both:$.length*$.length,get total(){return this.filters+this.sorting+this.both}};return{index:b,points:P.total,filterKeys:A,sortKeys:O}});k.sort((b,w)=>b.points>w.points?-1:1);const x=k[0];E.index=x.index,x.filterKeys.forEach(b=>{d.filter(w=>w!==E&&w.key===b).forEach(w=>{!Zh.validOperators.includes(w.op)||(w.indexUsage="filter",w.index=x.index)})}),x.sortKeys.forEach(b=>{y.filter(w=>w.key===b).forEach(w=>{w.index=x.index})})}E.index&&U.push({index:E.index,description:E.index.description})}),y.length>0&&s.take!==0&&d.length===0&&y.forEach(E=>{E.index||(E.index=j.filter(m=>m.key===E.key).find(m=>m.type==="normal"))});const H=U.map(E=>E.description).join(", ");U.length>0&&r.storage.debug.log(`Using indexes for query: ${H}`);const L=d.filter(E=>!E.index),F=/^[a-z]+:/i;if(L.some(E=>F.test(E.op))){const E=L.find(v=>F.test(v.op)),m=new Error(`query contains operator "${E.op}" which requires a special index that was not found on path "${i}", key "${E.key}"`);return Promise.reject(m)}const T=["<","<=","==","!=",">=",">","like","!like","in","!in","matches","!matches","between","!between","has","!has","contains","!contains","exists","!exists"];for(let E=0;E<L.length;E++){const m=L[E];if(!T.includes(m.op))return Promise.reject(new Error(`query contains unknown filter operator "${m.op}" on path "${i}", key "${m.key}"`))}if(B&&L.length>0){const E=L.reduce((v,g)=>(v.indexOf(g.key)<0&&v.push(g.key),v),[]).map(v=>`"${v}"`),m=new Error(`This wildcard path query on "/${i}" requires index(es) on key(s): ${E.join(", ")}. Create the index(es) and retry`);return Promise.reject(m)}const R=[];d.forEach(E=>{if(E.index&&E.indexUsage!=="filter"){let m=E.index.query(E.op,E.compare).then(g=>(o.eventHandler&&o.eventHandler({name:"stats",type:"index_query",source:E.index.description,stats:g.stats}),g.hints.length>0&&o.eventHandler&&o.eventHandler({name:"hints",type:"index_query",source:E.index.description,hints:g.hints}),g));const v=d.filter(g=>g.index===E.index&&g.indexUsage==="filter");v.length>0&&(m=m.then(g=>(v.forEach(k=>{const{key:x,op:b,index:w}=k;let{compare:A}=k;typeof A=="string"&&!w.caseSensitive&&(A=A.toLocaleLowerCase(w.textLocale)),g=g.filterMetadata(x,b,A)}),g))),R.push(m)}});const C={filtered:d.length===0,skipped:s.skip===0,taken:s.take===0,sorted:y.length===0,preDataLoaded:!1,dataLoaded:!1};if(d.length===0&&s.take===0&&(r.storage.debug.warn(`Filterless queries must use .take to limit the results. Defaulting to 100 for query on path "${i}"`),s.take=100),y.length>0&&y[0].index){const E=y[0].index,m=s.take<0?!y[0].ascending:y[0].ascending;if(d.length===0&&y.slice(1).every(v=>E.allMetadataKeys.includes(v.key))){r.storage.debug.log(`Using index for sorting: ${E.description}`);const v=y.slice(1).map(k=>(k.index=E,{key:k.key,ascending:k.ascending})),g=E.take(s.skip,Math.abs(s.take),{ascending:m,metadataSort:v}).then(k=>(o.eventHandler&&o.eventHandler({name:"stats",type:"sort_index_take",source:E.description,stats:k.stats}),k.hints.length>0&&o.eventHandler&&o.eventHandler({name:"hints",type:"sort_index_take",source:E.description,hints:k.hints}),k));R.push(g),C.skipped=!0,C.taken=!0,C.sorted=!0}}return Promise.all(R).then(E=>K(this,null,function*(){let m=[];if(E.length===1){const A=E[0];m=A.map(O=>{const $={key:O.key,path:O.path,val:{[A.filterKey]:O.value}};return O.metadata&&Object.assign($.val,O.metadata),$}),C.filtered=!0}else if(E.length>1){E.sort(($,P)=>$.length<P.length?-1:1);const A=E[0],O=E.slice(1);m=A.reduce(($,P)=>{const N={key:P.key,path:P.path,val:{[A.filterKey]:P.value}};return O.every(D=>D.findIndex(z=>z.path===P.path)>=0)&&(P.metadata&&Object.assign(N.val,P.metadata),O.forEach(D=>{const z=D.find(q=>q.path===N.path);N.val[D.filterKey]=z.value,z.metadata&&Object.assign(N.val,z.metadata)}),$.push(N)),$},[]),C.filtered=!0}if(B||R.length>0&&L.length===0){if(y.length===0||y.every(A=>A.index)){if(C.preDataLoaded=!0,!C.sorted&&y.length>0&&_(m),C.sorted=!0,!C.skipped&&s.skip>0&&(m=s.take<0?m.slice(0,-s.skip):m.slice(s.skip)),!C.taken&&s.take!==0&&(m=s.take<0?m.slice(s.take):m.slice(0,s.take)),C.skipped=!0,C.taken=!0,!o.snapshots)return m;const A={include:o.include,exclude:o.exclude,child_objects:o.child_objects};return S(m,A).then(O=>(C.dataLoaded=!0,O))}if(o.snapshots||!C.sorted){const A=y.length>0,O=A?{include:y.map($=>$.key)}:{include:o.include,exclude:o.exclude,child_objects:o.child_objects};return S(m,O).then($=>(y.length>0&&_($),C.sorted=!0,s.skip>0&&($=s.take<0?$.slice(0,-s.skip):$.slice(s.skip)),s.take!==0&&($=s.take<0?$.slice(s.take):$.slice(0,s.take)),C.skipped=!0,C.taken=!0,o.snapshots&&A?S($,{include:o.include,exclude:o.exclude,child_objects:o.child_objects}):$))}else return m}let v;m.length>0&&(v=m.map(A=>A.key));let g=[],k=!1;const x=y.length>0,b=x?{include:y.map(A=>A.key)}:{include:o.include,exclude:o.exclude,child_objects:o.child_objects},w={promises:[],add(A){if(this.promises.push(A),this.promises.length>=1e3)return Promise.all(this.promises.splice(0)).then(O=>{})}};try{yield r.storage.getChildren(i,{keyFilter:v,async:!0}).next(A=>{if(A.type!==oe.OBJECT||!A.address)return;if(k)return!1;const O=()=>K(this,null,function*(){if(!(yield r.storage.matchNode(A.address.path,L)))return;const P=A.address.path;let N;if(o.snapshots||y.length>0){const D=yield r.storage.getNode(P,b);N={path:P,val:D.value}}else N={path:P};g.push(N),s.take!==0&&g.length>Math.abs(s.take)+s.skip&&(y.length>0?_(g):s.take>0&&(k=!0),g.pop())}),$=w.add(O());if($ instanceof Promise)return $})}catch(A){return A instanceof Xh||r.storage.debug.warn(`Error getting child stream: ${A}`),[]}return yield Promise.all(w.promises),C.preDataLoaded=x,C.dataLoaded=!x,y.length>0&&_(g),C.sorted=!0,s.skip>0&&(g=s.take<0?g.slice(0,-s.skip):g.slice(s.skip)),C.skipped=!0,s.take!==0&&(g=s.take<0?g.slice(s.take):g.slice(0,s.take)),C.taken=!0,C.dataLoaded||(g=yield S(g,{include:o.include,exclude:o.exclude,child_objects:o.child_objects}),C.dataLoaded=!0),g})).then(E=>{if(!C.sorted&&y.length>0&&_(E),o.snapshots||(E=E.map(m=>m.path)),!C.skipped&&s.skip>0&&(E=s.take<0?E.slice(0,-s.skip):E.slice(s.skip)),!C.taken&&s.take!==0&&(E=s.take<0?E.slice(s.take):E.slice(0,s.take)),o.monitor===!0&&(o.monitor={add:!0,change:!0,remove:!0}),typeof o.monitor=="object"&&(o.monitor.add||o.monitor.change||o.monitor.remove)){const m=o.monitor,v=o.snapshots?E.map($=>$.path):E.slice(),g=r.db.ref(i),k=$=>{const P=v.indexOf($);P<0||v.splice(P,1)},x=$=>{v.includes($)||v.push($)},b=()=>{r.unsubscribe(g.path,"child_changed",w),r.unsubscribe(g.path,"child_added",A),r.unsubscribe(g.path,"notify_child_removed",O)};M=()=>K(this,null,function*(){b()});const w=($,P,N,D)=>K(this,null,function*(){const z=v.includes(P);let q=!0;const ne=[];d.forEach(ie=>!ne.includes(ie.key)&&ne.push(ie.key));const te=[];typeof D=="object"&&Object.keys(D).forEach(ie=>!te.includes(ie)&&te.push(ie)),typeof N=="object"&&Object.keys(N).forEach(ie=>!te.includes(ie)&&te.push(ie));const ue=[];let le=te.every(ie=>ne.includes(ie)?d.filter(pe=>pe.key===ie).every(pe=>{var ke;return((ke=pe.index)==null?void 0:ke.textLocaleKey)&&!te.includes(pe.index.textLocaleKey)?(ue.push(pe.index.textLocaleKey),!0):T.includes(pe.op)?r.storage.test(N[ie],pe.op,pe.compare):pe.index.test(N,pe.op,pe.compare)}):!0);if(le&&(ue.push(...ne.filter(ie=>!te.includes(ie))),!z&&ue.length>0)){const ie=d.filter(ve=>ue.includes(ve.key)),pe=ie.filter(ve=>T.includes(ve.op)),ke=ie.filter(ve=>!T.includes(ve.op));if(pe.length>0&&(le=yield r.storage.matchNode(P,pe)),le&&ke.length>0){const ve=ke.reduce((je,He)=>(je.includes(He.key)||je.push(He.key),He.index instanceof vm&&He.index.config.localeKey&&!je.includes(He.index.config.localeKey)&&je.push(He.index.config.localeKey),je),[]),ze=yield r.storage.getNode(P,{include:ve});if(ze.value===null)return!1;le=ke.every(je=>je.index.test(ze.value,je.op,je.compare))}}if(le){if(z||x(P),o.snapshots){const ie={include:o.include,exclude:o.exclude,child_objects:o.child_objects};N=(yield r.storage.getNode(P,ie)).value}z&&m.change?q=o.eventHandler({name:"change",path:P,value:N})!==!1:!z&&m.add&&(q=o.eventHandler({name:"add",path:P,value:N})!==!1)}else z&&(k(P),m.remove&&(q=o.eventHandler({name:"remove",path:P,value:D})!==!1));q===!1&&b()}),A=($,P,N)=>{const D=d.every(q=>T.includes(q.op)?r.storage.test(N[q.key],q.op,q.compare):q.index.test(N,q.op,q.compare));let z=!0;D&&(x(P),m.add&&(z=o.eventHandler({name:"add",path:P,value:o.snapshots?N:null})!==!1)),z===!1&&b()},O=($,P,N,D)=>{let z=!0;k(P),m.remove&&(z=o.eventHandler({name:"remove",path:P,value:o.snapshots?D:null})!==!1),z===!1&&b()};(o.monitor.add||o.monitor.change||o.monitor.remove)&&r.subscribe(g.path,"child_changed",w),o.monitor.remove&&r.subscribe(g.path,"notify_child_removed",O),o.monitor.add&&r.subscribe(g.path,"child_added",A)}return{results:E,context:f,stop:M}})})}class m_ extends VE{constructor(e="default",t,r){super(),this.db=t.db;const i={logLevel:t.settings.logLevel};if(typeof t.settings.storage=="object")if(xp&&t.settings.storage instanceof xp)this.storage=new QE(e,t.settings.storage,i);else if(Ep&&t.settings.storage instanceof Ep)this.storage=new XE(e,t.settings.storage,i);else if(Ys&&t.settings.storage instanceof Ys)this.storage=new p_(e,t.settings.storage,i);else{const s=t.settings.storage instanceof Ol?t.settings.storage:new Ol(t.settings.storage);this.storage=new Tu(e,s,i)}else this.storage=new Tu(e,new Ol,i);this.storage.on("ready",r)}stats(e){return K(this,null,function*(){return this.storage.stats})}subscribe(e,t,r){this.storage.subscriptions.add(e,t,r)}unsubscribe(e,t,r){this.storage.subscriptions.remove(e,t,r)}set(e,t){return K(this,arguments,function*(r,i,s={suppress_events:!1,context:null}){const o=yield this.storage.setNode(r,i,{suppress_events:s.suppress_events,context:s.context});return Q({},o&&{cursor:o})})}update(e,t){return K(this,arguments,function*(r,i,s={suppress_events:!1,context:null}){const o=yield this.storage.updateNode(r,i,{suppress_events:s.suppress_events,context:s.context});return Q({},o&&{cursor:o})})}get transactionLoggingEnabled(){return this.storage.settings.transactions&&this.storage.settings.transactions.log===!0}get(e,t){return K(this,null,function*(){if(t||(t={}),typeof t.include!="undefined"&&!(t.include instanceof Array))throw new TypeError("options.include must be an array of key names");if(typeof t.exclude!="undefined"&&!(t.exclude instanceof Array))throw new TypeError("options.exclude must be an array of key names");if(["undefined","boolean"].indexOf(typeof t.child_objects)<0)throw new TypeError("options.child_objects must be a boolean");const r=yield this.storage.getNode(e,t);return{value:r.value,context:{acebase_cursor:r.cursor},cursor:r.cursor}})}transaction(e,t){return K(this,arguments,function*(r,i,s={suppress_events:!1,context:null}){const o=yield this.storage.transactNode(r,i,{suppress_events:s.suppress_events,context:s.context});return Q({},o&&{cursor:o})})}exists(e){return K(this,null,function*(){return(yield this.storage.getNodeInfo(e)).exists})}query(e,t){return K(this,arguments,function*(r,i,s={snapshots:!1}){return yield bm(this,r,i,s)})}createIndex(e,t,r){return this.storage.indexes.create(e,t,r)}getIndexes(){return K(this,null,function*(){return this.storage.indexes.list()})}deleteIndex(e){return K(this,null,function*(){return this.storage.indexes.delete(e)})}reflect(e,t,r){return K(this,null,function*(){r=r||{};const i=(s,o=50,a=0,c=null)=>K(this,null,function*(){typeof o=="string"&&(o=parseInt(o)),typeof a=="string"&&(a=parseInt(a)),["null","undefined"].includes(c)&&(c=null);const l=[];let u=0,h=!1,p=!1;return yield this.storage.getChildren(s).next(f=>{if(h)return p=!0,!1;u++,(c!==null?f.key>c:a===0||u>a)&&l.push(Q({key:typeof f.key=="string"?f.key:f.index,type:f.valueTypeName,value:f.value},typeof f.address=="object"&&"pageNr"in f.address&&{address:{pageNr:f.address.pageNr,recordNr:f.address.recordNr}})),h=o>0&&l.length===o}).catch(f=>{if(!(f instanceof Xh))throw f}),{more:p,list:l}});switch(t){case"children":return yield i(e,r.limit,r.skip,r.from);case"info":{const s={key:"",exists:!1,type:"unknown",value:void 0,address:void 0,children:{count:0,more:!1,list:[]}},o=yield this.storage.getNodeInfo(e,{include_child_count:r.child_count===!0});s.key=typeof o.key!="undefined"?o.key:o.index,s.exists=o.exists,s.type=o.exists?o.valueTypeName:void 0,s.value=o.value,s.address=typeof o.address=="object"&&"pageNr"in o.address?{pageNr:o.address.pageNr,recordNr:o.address.recordNr}:void 0;const a=o.exists&&o.address&&[oe.OBJECT,oe.ARRAY].includes(o.type);return r.child_count===!0?s.children={count:a?o.childCount:0}:typeof r.child_limit=="number"&&r.child_limit>0&&a&&(s.children=yield i(e,r.child_limit,r.child_skip,r.child_from)),s}}})}export(e,t,r={format:"json",type_safe:!0}){return this.storage.exportNode(e,t,r)}import(e,t,r={format:"json",suppress_events:!1,method:"set"}){return this.storage.importNode(e,t,r)}setSchema(e,t,r=!1){return K(this,null,function*(){return this.storage.setSchema(e,t,r)})}getSchema(e){return K(this,null,function*(){return this.storage.getSchema(e)})}getSchemas(){return K(this,null,function*(){return this.storage.getSchemas()})}validateSchema(e,t,r){return K(this,null,function*(){return this.storage.validateSchema(e,t,{updates:r})})}getMutations(e){return K(this,null,function*(){if(typeof this.storage.getMutations!="function")throw new Error("Used storage type does not support getMutations");if(typeof e!="object")throw new Error("No filter specified");if(typeof e.cursor!="string"&&typeof e.timestamp!="number")throw new Error("No cursor or timestamp given");return this.storage.getMutations(e)})}getChanges(e){return K(this,null,function*(){if(typeof this.storage.getChanges!="function")throw new Error("Used storage type does not support getChanges");if(typeof e!="object")throw new Error("No filter specified");if(typeof e.cursor!="string"&&typeof e.timestamp!="number")throw new Error("No cursor or timestamp given");return this.storage.getChanges(e)})}}class v_ extends ef{constructor(e){super(e),this.temp=!1,this.multipleTabs=!1,typeof e.temp=="boolean"&&(this.temp=e.temp),typeof e.provider=="object"&&(this.provider=e.provider),typeof e.multipleTabs=="boolean"&&(this.multipleTabs=e.multipleTabs),typeof e.logLevel=="string"&&(this.logLevel=e.logLevel),typeof e.sponsor=="boolean"&&(this.sponsor=e.sponsor),["type","ipc","path"].forEach(t=>{t in e&&console.warn(`${t} setting is not supported for AceBase LocalStorage`)})}}class b_ extends tf{constructor(e,t){super(t),this.context=e,this._storageKeysPrefix=`${this.context.dbname}.acebase::`}commit(){return K(this,null,function*(){})}rollback(e){return K(this,null,function*(){})}get(e){return K(this,null,function*(){const t=this.context.localStorage.getItem(this.getStorageKeyForPath(e));return JSON.parse(t)})}set(e,t){return K(this,null,function*(){const r=JSON.stringify(t);this.context.localStorage.setItem(this.getStorageKeyForPath(e),r)})}remove(e){return K(this,null,function*(){this.context.localStorage.removeItem(this.getStorageKeyForPath(e))})}childrenOf(e,t,r,i){return K(this,null,function*(){const s=Js.PathInfo.get(e);for(let o=0;o<this.context.localStorage.length;o++){const a=this.context.localStorage.key(o);if(!a.startsWith(this._storageKeysPrefix))continue;const c=this.getPathFromStorageKey(a);if(s.isParentOf(c)&&r(c)){let l;if(t.metadata||t.value){const u=this.context.localStorage.getItem(a);l=JSON.parse(u)}if(!i(c,l))break}}})}descendantsOf(e,t,r,i){return K(this,null,function*(){const s=Js.PathInfo.get(e);for(let o=0;o<this.context.localStorage.length;o++){const a=this.context.localStorage.key(o);if(!a.startsWith(this._storageKeysPrefix))continue;const c=this.getPathFromStorageKey(a);if(s.isAncestorOf(c)&&r(c)){let l;if(t.metadata||t.value){const u=this.context.localStorage.getItem(a);l=JSON.parse(u)}if(!i(c,l))break}}})}getPathFromStorageKey(e){return e.slice(this._storageKeysPrefix.length)}getStorageKeyForPath(e){return`${this._storageKeysPrefix}${e}`}}function w_(n,e={}){const t=new v_(e),r=t.provider?t.provider:t.temp?window.localStorage:window.sessionStorage,i=new Ys({name:"LocalStorage",locking:!0,removeVoidProperties:t.removeVoidProperties,maxInlineValueSize:t.maxInlineValueSize,ready(){return K(this,null,function*(){})},getTransaction(o){return K(this,null,function*(){const a={debug:!0,dbname:n,localStorage:r};return new b_(a,o)})}}),s=new bo(n,{logLevel:t.logLevel,storage:i,sponsor:t.sponsor});return s.settings.ipcEvents=t.multipleTabs===!0,s}class k_ extends ef{constructor(e){super(e),this.multipleTabs=!1,this.cacheSeconds=60,this.sponsor=!1,typeof e.logLevel=="string"&&(this.logLevel=e.logLevel),typeof e.multipleTabs=="boolean"&&(this.multipleTabs=e.multipleTabs),typeof e.cacheSeconds=="number"&&(this.cacheSeconds=e.cacheSeconds),typeof e.sponsor=="boolean"&&(this.sponsor=e.sponsor),["type","ipc","path"].forEach(t=>{t in e&&console.warn(`${t} setting is not supported for AceBase IndexedDBStorage`)})}}class wm extends pm{constructor(e={}){super(e),e.storage&&(this.storage=e.storage,e.ipc&&(this.storage.ipc=e.ipc),e.transactions&&(this.storage.transactions=e.transactions))}}class x_ extends qE{constructor(e,t={}){const r=new wm(t);super(e,r),this.recovery={repairNode:(s,o)=>K(this,null,function*(){if(yield this.ready(),this.api.storage instanceof Tu)yield this.api.storage.repairNode(s,o);else if(!this.api.storage.repairNode)throw new Error("repairNode is not supported with chosen storage engine")}),repairNodeTree:s=>K(this,null,function*(){yield this.ready(),yield this.api.storage.repairNodeTree(s)})};const i={db:this,settings:r};this.api=new m_(e,i,()=>{this.emit("ready")})}close(){return K(this,null,function*(){yield this.api.storage.close()})}get settings(){const e=this.api.storage.ipc,t=this.debug;return{get logLevel(){return t.level},set logLevel(r){t.setLevel(r)},get ipcEvents(){return e.eventsEnabled},set ipcEvents(r){e.eventsEnabled=r}}}static WithLocalStorage(e,t={}){return w_(e,t)}static WithIndexedDB(e,t={}){throw new Error("IndexedDB storage can only be used in browser contexts")}}function Op(n){return new Promise((e,t)=>{n.onsuccess=r=>e(n.result||null),n.onerror=t})}class E_ extends tf{constructor(e,t){super(t),this.context=e,this.production=!0,this._pending=[]}_createTransaction(e=!1){return this.context.db.transaction(["nodes","content"],e?"readwrite":"readonly")}_splitMetadata(e){const t=e.value,r=Q({},e);return delete r.value,{metadata:r,value:t}}commit(){return K(this,null,function*(){if(this._pending.length===0)return;const e=this._pending.splice(0);this.context.ipc.sendNotification({action:"cache.invalidate",paths:e.map(r=>r.path)});const t=this._createTransaction(!0);try{yield new Promise((r,i)=>{let s=!1,o=0;const a=l=>{s=!0,i(l)},c=()=>{++o===e.length&&r()};e.forEach((l,u)=>{if(s)return;let h,p;const f=l.path;if(l.action==="set"){const{metadata:y,value:_}=this._splitMetadata(l.node),S={path:f,metadata:y};h=t.objectStore("nodes").put(S),p=t.objectStore("content").put(_,f),this.context.cache.set(f,l.node)}else l.action==="remove"?(h=t.objectStore("content").delete(f),p=t.objectStore("nodes").delete(f),this.context.cache.set(f,null)):a(new Error(`Unknown pending operation "${l.action}" on path "${f}" `));let d=0;h.onsuccess=p.onsuccess=()=>{++d===2&&c()},h.onerror=p.onerror=a})}),t.commit&&t.commit()}catch(r){throw console.error(r),t.abort&&t.abort(),r}})}rollback(e){return K(this,null,function*(){this._pending=[]})}get(e){return K(this,null,function*(){if(this.context.cache.has(e))return this.context.cache.get(e);const t=this._createTransaction(!1),r=Op(t.objectStore("nodes").get(e)),i=Op(t.objectStore("content").get(e));try{const s=yield Promise.all([r,i]);t.commit&&t.commit();const o=s[0];if(!o)return this.context.cache.set(e,null),null;const a=o.metadata;return a.value=s[1],this.context.cache.set(e,a),a}catch(s){throw console.error("IndexedDB get error",s),t.abort&&t.abort(),s}})}set(e,t){this._pending.push({action:"set",path:e,node:t})}remove(e){this._pending.push({action:"remove",path:e})}removeMultiple(e){return K(this,null,function*(){e.forEach(t=>{this._pending.push({action:"remove",path:t})})})}childrenOf(e,t,r,i){return this._getChildrenOf(e,Ue(Q({},t),{descendants:!1}),r,i)}descendantsOf(e,t,r,i){return this._getChildrenOf(e,Ue(Q({},t),{descendants:!0}),r,i)}_getChildrenOf(e,t,r,i){return new Promise((s,o)=>{const a=Js.PathInfo.get(e),c=this._createTransaction(!1),l=c.objectStore("nodes"),u=IDBKeyRange.lowerBound(e,!0),h=t.metadata?l.openCursor(u):l.openKeyCursor(u);h.onerror=p=>{var f;(f=c.abort)==null||f.call(c),o(p)},h.onsuccess=p=>K(this,null,function*(){var f,d,y;const _=(d=(f=h.result)==null?void 0:f.key)!=null?d:null;let S=!0;if(_===null)S=!1;else if(!a.isAncestorOf(_))S=!1;else if(t.descendants||a.isParentOf(_)){let I;if(t.metadata&&(I=h.result.value.metadata),r(_,I)){if(t.value)if(this.context.cache.has(_)){const B=this.context.cache.get(_);I.value=B.value}else{const B=c.objectStore("content").get(_);I.value=yield new Promise((j,U)=>{B.onerror=M=>{j(null)},B.onsuccess=M=>{j(B.result)}}),this.context.cache.set(_,I.value===null?null:I)}S=i(_,I)}}if(S)try{h.result.continue()}catch(I){S=!1}S||((y=c.commit)==null||y.call(c),s())})})}}function __(n,e={}){const t=new k_(e),r=(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB).open(`${n}.acebase`,1);r.onupgradeneeded=u=>{const h=r.result;h.createObjectStore("nodes",{keyPath:"path"}),h.createObjectStore("content")};let i;const s=new Promise((u,h)=>{r.onsuccess=p=>{i=r.result,u()},r.onerror=p=>{h(p)}}),o=new zE(typeof t.cacheSeconds=="number"?t.cacheSeconds:60),a=new Ys({name:"IndexedDB",locking:!0,removeVoidProperties:t.removeVoidProperties,maxInlineValueSize:t.maxInlineValueSize,lockTimeout:t.lockTimeout,ready(){return s},getTransaction(u){return K(this,null,function*(){yield s;const h={debug:!1,db:i,cache:o,ipc:l};return new E_(h,u)})}}),c=new bo(n,{logLevel:t.logLevel,storage:a,sponsor:t.sponsor}),l=c.api.storage.ipc;return c.settings.ipcEvents=t.multipleTabs===!0,l.on("notification",u=>K(this,null,function*(){const h=u.data;if(typeof h=="object"&&h.action==="cache.invalidate")for(const p of h.paths)o.remove(p)})),c}const A_=`Using AceBase constructor in the browser to use localStorage is deprecated!
Switch to:
IndexedDB implementation (FASTER, MORE RELIABLE):
    let db = AceBase.WithIndexedDB(name, settings)
Or, new LocalStorage implementation:
    let db = AceBase.WithLocalStorage(name, settings)
Or, write your own CustomStorage adapter:
    let myCustomStorage = new CustomStorageSettings({ ... });
    let db = new AceBase(name, { storage: myCustomStorage })`;class bo extends x_{constructor(e,t){if(typeof t!="object"||typeof t.storage!="object")throw new Error(A_);super(e,t),this.settings.ipcEvents=t.multipleTabs===!0}static WithIndexedDB(e,t={}){return __(e,t)}}const O_={AceBase:bo,AceBaseLocalSettings:wm,DataReference:Jn,DataSnapshot:rt,EventSubscription:Zg,PathReference:it,TypeMappings:um,CustomStorageSettings:Ys,CustomStorageTransaction:tf,CustomStorageHelpers:Js,ID:Vt,proxyAccess:pa,DataSnapshotsArray:bc};window.acebase=O_;window.AceBase=bo;let S_=()=>Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),Tl=(()=>"/ps"+S_()+"/pe")();const Nt={req:"/custom",create:{one:"/create-one",many:"/create-many"},send:{one:"/send-one",many:"/send-many"},find:{one:"/find-one",many:"/find-many"},get:{one:"/get-one",many:"/get-many"},query:{many:"/get-many"},update:{one:"/update-one",many:"/update-many"},delete:{one:"/delete-one",many:"/delete-many"}},jt={create:"/create",find:"/find",get:"/get",query:"/get",update:"/update",delete:"/delete",req:"/custom",upload:"/upload",send:"/send",user:{base:"/user",example:"/user/device-connected",join:"",status:"/user/status",device:{connected:"/user/device-connected",removed:"/user/device-removed",disconnected:"/user/device-disconnected"}}},Ko={user:{base:"/user",device:{remove:"/user/device-remove",list:"/user/device-list"}},users:{base:"/users",device:{list:"/users/device-list"}}},Tn={base:"/auth",login:"/login/get-one",verify_token_code:"/verify-token-code/get-one",verify_pass_code:"/verify-pass-code/get-one",verify_email_code:"/verify-email-code/get-one",req:"/custom",user:"/user/"+Tl+"/get-one",register:"/register/get-one",forgotPassword:"/forgot-password/get-one"+Tl+"/get-one",deleteAccount:"/delete-account/get-one",refreshToken:"/refresh-token"+Tl+"/get-one",users:{base:"/users"}};var Us,wi,Xi,Fs,tr,km,Ru,Cu,ya,nr,_n,Zi,Ut;class $_{constructor(e={}){vn(this,Us,"/on"),vn(this,wi,!0),vn(this,Xi,void 0),vn(this,Fs,void 0),vn(this,tr,void 0),vn(this,km,void 0),vn(this,Ru,void 0),vn(this,Cu,void 0),vn(this,ya,new fE),vn(this,nr,void 0),vn(this,_n,void 0),vn(this,Zi,void 0),vn(this,Ut,void 0),tx(this,"init",s=>{var o,a,c,l,u;let{ENV:h,HOST_SERVER:p,API_VERSION:f}=be(this,Zi),d=()=>K(this,null,function*(){var m,v,g,k,x,b,w,A,O,$,P,N;let D="/transaction",z="/database",q=yield(g=(v=(m=be(this,Ut))==null?void 0:m.ref(D))==null?void 0:v.get())==null?void 0:g.catch(te=>{}),ne=yield(b=(x=(k=be(this,Ut))==null?void 0:k.ref(z))==null?void 0:x.get())==null?void 0:b.catch(te=>{});if(q.exists()){q=q.val();let te=Object.keys(q);if((te==null?void 0:te.length)>0){for(let ue in te){let le=q[ue];(le==null?void 0:le.path)&&(le==null?void 0:le.method)&&(le==null?void 0:le.value)&&(yield this.init(s).database().ref(le==null?void 0:le.path).req(le==null?void 0:le.method,le==null?void 0:le.path,le==null?void 0:le.value).val())}ne.exists()&&(yield(O=(A=(w=be(this,Ut))==null?void 0:w.ref(z))==null?void 0:A.remove())==null?void 0:O.catch(ue=>{})),yield(N=(P=($=be(this,Ut))==null?void 0:$.ref(D))==null?void 0:P.remove())==null?void 0:N.catch(ue=>{})}}});(a=(o=s==null?void 0:s.socket)==null?void 0:o.auth)==null||a.on("connect",()=>{Mr(this,_n,!0),d()}),(l=(c=s==null?void 0:s.socket)==null?void 0:c.auth)==null||l.on("disconnect",()=>{Mr(this,_n,!1)});const y=(m={})=>{var v,g,k;let x={};if(m&&Object.keys(m).length>0&&(x.data=m),be(this,tr)&&(x.storage=be(this,tr),x.config=be(this,Ru)),be(this,Cu)){let b=new FormData;Array.isArray(m)?(m.map((w,A)=>{typeof w=="object"&&(w.attachmentName="attachment"+A,w==null||w.attachments.forEach(O=>{O!=null&&O.data?b.append("attachments"+A,O==null?void 0:O.data,O==null?void 0:O.name):b.append("attachments"+A,O)}))}),b.append("field",JSON.stringify(x))):Array.isArray(m==null?void 0:m.attachments)&&(m==null||m.attachments.forEach(w=>{w!=null&&w.data?b.append("attachments",w==null?void 0:w.data,w==null?void 0:w.name):b.append("attachments",w)}),delete x.data.attachments,b.append("field",JSON.stringify(x))),x=b}else if(be(this,tr)&&(m==null?void 0:m.file)){let b=new FormData;m!=null&&m.file?((v=m.file)!=null&&v.data?b.append("file",(g=m.file)==null?void 0:g.data,(k=m.file)==null?void 0:k.name):b.append("file",m.file),delete x.data.file,b.append("field",JSON.stringify(x))):Array.isArray(m==null?void 0:m.directory)&&(m==null||m.directory.forEach(w=>{w!=null&&w.data?b.append("file",w==null?void 0:w.data,w==null?void 0:w.name):b.append("file",w)}),delete x.data.directory,b.append("field",JSON.stringify(x)),x=b),x=b}return x};let _=(m,v)=>K(this,null,function*(){var g,k,x,b,w,A,O,$;if(((g=m==null?void 0:m.error)==null?void 0:g.token)&&be(this,wi)){if(Mr(this,wi,!1),localStorage.getItem("refreshToken")){h==="dev"&&console.log("Token expired or not found: ",(k=m.error)==null?void 0:k.token," Trying to request a new refresh token");let P=yield(b=(x=this==null?void 0:this.init(s))==null?void 0:x.auth())==null?void 0:b.req(Tn.refreshToken,{token:localStorage.getItem("refreshToken")}).val();if(P!=null&&P.error)return h==="dev"&&console.log("Refresh token expired or not found: ",P),be(this,Xi)&&(window.top.location.href=be(this,Xi)),P;if(P!=null&&P.data&&(h==="dev"&&console.log("We got a new refresh token ,",P==null?void 0:P.data),(w=P==null?void 0:P.data)!=null&&w.token&&localStorage.setItem("accessToken",(A=P==null?void 0:P.data)==null?void 0:A.token),(O=P==null?void 0:P.data)!=null&&O.refreshToken&&localStorage.setItem("refreshToken",($=P==null?void 0:P.data)==null?void 0:$.refreshToken),h==="dev"&&console.log("Trying to restart your request..."),typeof v=="function"))return yield v()}}else return m});const S=(m,v,g,k=()=>{})=>{const x=be(this,Us);let b=v.version+x+v.base+g;b=b.replace(/\/\//g,"/"),h==="dev"&&console.log("socket listen local path: ",b),m==null||m.on(b,k)},I=(m,v=()=>{})=>{var g;const k=be(this,Us);let x=(f==null?void 0:f.AUTH)+k+m;x=x.replace(/\/\//g,"/"),h==="dev"&&console.log("emitter listen local path: ",x),(g=be(this,ya))==null||g.on(x,v)};let B=(m,v,g,k)=>(be(this,Fs)&&(k=k+be(this,Fs)),{req:x=>(S(m,v,k+jt.req,b=>{var w,A,O;(!((A=(w=b==null?void 0:b.error)==null?void 0:w.error)!=null&&A.token)&&!((O=b==null?void 0:b.error)!=null&&O.token)||(b==null?void 0:b.data))&&typeof x=="function"&&x(Ue(Q({},g),{value:b}))}),g),create:x=>(S(m,v,k+jt.create,b=>{var w,A,O;(!((A=(w=b==null?void 0:b.error)==null?void 0:w.error)!=null&&A.token)&&!((O=b==null?void 0:b.error)!=null&&O.token)||(b==null?void 0:b.data))&&typeof x=="function"&&x(Ue(Q({},g),{value:b}))}),g),find:x=>(S(m,v,k+jt.find,b=>{var w,A,O;(!((A=(w=b==null?void 0:b.error)==null?void 0:w.error)!=null&&A.token)&&!((O=b==null?void 0:b.error)!=null&&O.token)||(b==null?void 0:b.data))&&typeof x=="function"&&x(Ue(Q({},g),{value:b}))}),g),get:x=>(S(m,v,k+jt.get,b=>{var w,A,O;(!((A=(w=b==null?void 0:b.error)==null?void 0:w.error)!=null&&A.token)&&!((O=b==null?void 0:b.error)!=null&&O.token)||(b==null?void 0:b.data))&&typeof x=="function"&&x(Ue(Q({},g),{value:b}))}),g),query:x=>(S(m,v,k+jt.query,b=>{var w,A,O;(!((A=(w=b==null?void 0:b.error)==null?void 0:w.error)!=null&&A.token)&&!((O=b==null?void 0:b.error)!=null&&O.token)||(b==null?void 0:b.data))&&typeof x=="function"&&x(Ue(Q({},g),{value:b}))}),g),update:x=>(S(m,v,k+jt.update,b=>{var w,A,O;(!((A=(w=b==null?void 0:b.error)==null?void 0:w.error)!=null&&A.token)&&!((O=b==null?void 0:b.error)!=null&&O.token)||(b==null?void 0:b.data))&&typeof x=="function"&&x(Ue(Q({},g),{value:b}))}),g),delete:x=>(S(m,v,k+jt.delete,b=>{var w,A,O;(!((A=(w=b==null?void 0:b.error)==null?void 0:w.error)!=null&&A.token)&&!((O=b==null?void 0:b.error)!=null&&O.token)||(b==null?void 0:b.data))&&typeof x=="function"&&x(Ue(Q({},g),{value:b}))}),g)}),j=(m,v)=>({create:g=>(I(m+jt.create,k=>{(!(k!=null&&k.error)||(k==null?void 0:k.data))&&typeof g=="function"&&g(Ue(Q({},v),{value:k}))}),v),find:g=>(I(m+jt.find,k=>{(!(k!=null&&k.error)||(k==null?void 0:k.data))&&typeof g=="function"&&g(Ue(Q({},v),{value:k}))}),v),get:g=>(I(m+jt.get,k=>{(!(k!=null&&k.error)||(k==null?void 0:k.data))&&typeof g=="function"&&g(Ue(Q({},v),{value:k}))}),v),query:g=>(I(m+jt.query,k=>{(!(k!=null&&k.error)||(k==null?void 0:k.data))&&typeof g=="function"&&g(Ue(Q({},v),{value:k}))}),v),update:g=>(I(m+jt.update,k=>{(!(k!=null&&k.error)||(k==null?void 0:k.data))&&typeof g=="function"&&g(Ue(Q({},v),{value:k}))}),v),delete:g=>(I(m+jt.delete,k=>{(!(k!=null&&k.error)||(k==null?void 0:k.data))&&typeof g=="function"&&g(Ue(Q({},v),{value:k}))}),v)}),U=lp.init(be(this,Zi)),M=(m="",v={},g={},k={},x)=>{m=m.trim(),m.charAt(m.length-1)==="/"&&(m=m.slice(0,-1));let b=(()=>K(this,null,function*(){let w=()=>K(this,null,function*(){return yield U("post",p.AUTH+f.AUTH+Tn.base+m,y(v))}),A=yield w();return be(this,wi)&&(A=yield _(A,()=>K(this,null,function*(){return yield w()}))),typeof x=="function"&&x(Ue(Q({},k),{value:A})),A}))();return Ue(Q({},k),{val:()=>b})},H=(m,v,g,k={},x={},b)=>{let w=(()=>K(this,null,function*(){let A=()=>K(this,null,function*(){return yield U(m,v,y(g),k)}),O=yield A();return be(this,wi)&&(O=yield _(O,()=>K(this,null,function*(){return yield A()}))),typeof b=="function"&&b(Ue(Q({},x),{value:O})),O}))();return Ue(Q({},x),{val:()=>w})},L=m=>{let v={},g,[k={},,,]=m;if(m.length===1&&typeof k=="function"&&(g=m[0],k={}),m.length===2&&(typeof m[1]=="object"?v=m[1]:typeof m[1]=="function"&&(g=m[1])),m.length>=3){let[,x,b]=m;typeof x=="object"&&(v=x),g=b}return{data:k,onRequest:v,callback:g}},F=()=>Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),T=(m,v,g={},k,x)=>{v=v.replace(/\/\//g,"/");let b=(()=>K(this,null,function*(){var w,A,O,$,P,N,D,z,q,ne,te,ue,le,ie,pe,ke,ve,ze,je,He,Br,Lr,Dr;let Ur="/transaction",Ee,Fr,_e={error:{message:"We could not execute the "+m+" method for path: "+v}};switch(m){case"create":yield(O=(A=(w=be(this,Ut))==null?void 0:w.ref(v))==null?void 0:A.set(g))==null?void 0:O.catch(tt=>_e);break;case"update":yield(N=(P=($=be(this,Ut))==null?void 0:$.ref(v))==null?void 0:P.update(g))==null?void 0:N.catch(tt=>_e);break;case"query":let Ne=(D=be(this,Ut))==null?void 0:D.query(v);Array.isArray(g==null?void 0:g.where)&&(yield Promise.all(g==null?void 0:g.where.map(tt=>K(this,null,function*(){return yield new Promise(mn=>{Ne==null||Ne.filter(...tt),mn()})})))),g!=null&&g.take&&(Ne==null||Ne.take(g==null?void 0:g.take)),g!=null&&g.skip&&(Ne==null||Ne.take(g==null?void 0:g.skip)),g!=null&&g.order&&Array.isArray(g==null?void 0:g.order)&&(yield Promise.all(g==null?void 0:g.order.map(tt=>K(this,null,function*(){return yield new Promise(mn=>{Ne==null||Ne.sort(...tt),mn()})})))),Fr=yield Ne==null?void 0:Ne.count(),Ee=yield(z=Ne==null?void 0:Ne.get(Q({},g==null?void 0:g.$option)))==null?void 0:z.catch(tt=>_e);break;case"delete":Ee=yield(te=(ne=(q=be(this,Ut))==null?void 0:q.ref(v))==null?void 0:ne.get())==null?void 0:te.catch(tt=>_e),yield(ie=(le=(ue=be(this,Ut))==null?void 0:ue.ref(v))==null?void 0:le.remove())==null?void 0:ie.catch(tt=>_e);break}if(m!=="delete"&&m!=="query"&&(Ee=yield(ve=(ke=(pe=be(this,Ut))==null?void 0:pe.ref(v))==null?void 0:ke.get(Q({},g==null?void 0:g.$option)))==null?void 0:ve.catch(Ne=>_e)),m==="query"?Ee.exists()?(Ee=Ee==null?void 0:Ee.getValues(),Ee={data:Ee,max:Fr,take:g==null?void 0:g.take,skip:g==null?void 0:g.skip}):Ee=Q({},_e):Ee.exists()?(Ee=Ee==null?void 0:Ee.val(),Ee={data:Ee}):Ee=Q({},_e),be(this,nr)&&k.auth().$currentUserId&&!be(this,_n)&&["create","delete","update"].includes(m)&&Ee!=null&&Ee.data){let Ne=yield(He=(je=(ze=be(this,Ut))==null?void 0:ze.ref(Ur))==null?void 0:je.get())==null?void 0:He.catch(yl=>_e);Ne.exists()?Ne=Ne.val():Ne={};let tt,mn=Object.keys(Ne);switch(mn.length>0?tt=mn.length+1:tt=0,m){case"create":m="post";break;case"update":m="put";break;case"delete":m="delete";break}m!=="get"&&(yield(Dr=(Lr=(Br=be(this,Ut))==null?void 0:Br.ref(Ur+"/"+tt))==null?void 0:Lr.set({path:v,method:m,uid:tt,value:Ee.data}))==null?void 0:Dr.catch(yl=>_e))}const Ct=be(this,Us);let Yt=(f==null?void 0:f.AUTH)+Ct+v+"/"+m;return Yt=Yt.replace(/\/\//g,"/"),be(this,ya).emit(Yt,Ee),typeof x=="function"&&x(Ue(Q({},k),{value:Ee})),Ee}))();return Ue(Q({},k),{val:()=>b})},R=({value:m,node:v},g)=>{var k,x,b,w;let A=m;if((k=A==null?void 0:A.data)!=null&&k.data){let O=(x=A==null?void 0:A.data)==null?void 0:x.data,$=(b=A==null?void 0:A.data)==null?void 0:b.refreshToken,P=(w=A==null?void 0:A.data)==null?void 0:w.token;P&&localStorage.setItem("accessToken",P),$&&localStorage.setItem("refreshToken",$),O&&localStorage.setItem("userInfo",JSON.stringify(O))}typeof g=="function"&&g(Ue(Q({},v),{value:A}))},C=(m,v)=>{typeof m=="function"&&(v==null||v.on("connect",m))},E=(m,v)=>{let g="%"+m,k=this.init(s);return delete k.auth().login,delete k.auth().register,{$connected:be(this,_n),private:(x=F())=>k.event(m+x),child:x=>k.event(m+x),emit:(x,b)=>(v==null||v.emit(g,x),typeof b=="function"&&k.event(m).do(b),Q(Q({},k.event(m)),k)),do:x=>(v==null||v.on(g,b=>{typeof x=="function"&&x(Ue(Q(Q({},k.event(m)),k),{value:b}))}),Q(Q({},k.event(m)),k)),onAny:x=>{v==null||v.onAny((b,w)=>{typeof x=="function"&&x(b,Q(Q({value:w},k.event(b)),k))})}}};return{activity:()=>{let m=this.init(s);return{onStart:v=>(typeof v=="function"&&document.addEventListener("DOMContentLoaded",v),Q(Q({},m),m.activity())),onCreate:v=>(typeof v=="function"&&(window.onload=v),Q(Q({},m),m.activity())),onPause:v=>(window.addEventListener("beforeunload",function(g){typeof v=="function"&&v(),g.returnValue="onbeforeunload"}),Q(Q({},m),m.activity())),onResume:()=>Q(Q({},m),m.activity()),onLeave:v=>(typeof v=="function"&&(window.onunload=v),Q(Q({},m),m.activity()))}},socket:{auth:(u=s==null?void 0:s.socket)==null?void 0:u.auth},$randomUID:()=>kl(),$randomId:()=>F(),$axios:lp,local:(m={})=>{const v=this.init(s);return delete v.local,delete v.auth().register,delete v.auth().login,{database:(g="/database")=>({ref:(k="/database")=>{let x=this.init(s);return delete x.auth().login,delete x.auth().register,k=k.trim(),k=k.replace(/\/\//g,"/"),g=g+"/"+k,g=g.replace(/\/\//g,"/"),k.charAt(k.length-1)==="/"&&(k=k.slice(0,-1)),{child:(b="")=>{var w,A;return b=b.trim(),b=b.replace(/\/\//g,"/"),b.charAt(b.length-1)==="/"&&(b=b.slice(0,-1)),b.charAt(0)!=="/"&&(b="/"+b),(A=(w=x.local())==null?void 0:w.database())==null?void 0:A.ref(k+b)},push:(...b)=>{var w,A;let O=kl();return!b.length>0?{getKey:()=>O}:(A=(w=x.local())==null?void 0:w.database())==null?void 0:A.ref(k+"/"+O).create(b)},create:(...b)=>{var w,A;let O=Q(Q({},(A=(w=x.local(m))==null?void 0:w.database())==null?void 0:A.ref(k)),x),{data:$,callback:P}=L(b);return T(m,"create",g,$,O)},get:(...b)=>{var w,A;let O=Q(Q({},(A=(w=x.local())==null?void 0:w.database())==null?void 0:A.ref(k)),x),{data:$,callback:P}=L(b);return T("get",g,$,O,P)},find:(...b)=>{var w,A;let O=Q(Q({},(A=(w=x.local())==null?void 0:w.database())==null?void 0:A.ref(k)),x),{data:$,callback:P}=L(b);return T("get",g,$,O,P)},query:()=>{},update:(...b)=>{var w,A;let O=Q(Q({},(A=(w=x.local())==null?void 0:w.database())==null?void 0:A.ref(k)),x),{data:$,callback:P}=L(b);return T("update",g,$,O,P)},delete:(...b)=>{var w,A;let O=Q(Q({},(A=(w=x.local())==null?void 0:w.database())==null?void 0:A.ref(k)),x),{data:$,callback:P}=L(b);return T("delete",g,$,O,P)},on:()=>{var b,w;let A=Q(Q({},(w=(b=x.local())==null?void 0:b.database())==null?void 0:w.ref(k)),x);return j(k,A)},onValue:b=>{var w,A,O,$,P,N,D;let z=Q(Q({},(A=(w=x.local())==null?void 0:w.database())==null?void 0:A.ref(k)),x),q=($=(O=x.local())==null?void 0:O.database())==null?void 0:$.ref(k);return(P=q==null?void 0:q.on())==null||P.create(b),(N=q==null?void 0:q.on())==null||N.update(b),(D=q==null?void 0:q.on())==null||D.delete(b),z}}}}),cache:(g="/cache")=>{var k;let x=this.init(s);return delete x.auth().login,delete x.auth().register,(k=x.local())==null?void 0:k.database(g)},storage:()=>({})}},$online:navigator==null?void 0:navigator.onLine,auth:()=>{var m;return{$io:(m=s==null?void 0:s.socket)==null?void 0:m.auth,connected:()=>{var v,g;return(g=(v=s==null?void 0:s.socket)==null?void 0:v.auth)==null?void 0:g.connected},event:v=>{var g;return E(v,(g=s==null?void 0:s.socket)==null?void 0:g.auth)},ready:v=>{var g;return C(v,(g=s==null?void 0:s.socket)==null?void 0:g.auth)},$currentUserId:(()=>{let v=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");return v.uid?v.uid:!1})(),$status:(()=>{let v=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");if(v.status)return v.status})(),status:(...v)=>{var g,k,x,b;let w,A,O=this.init(s);if(delete O.auth().login,delete O.auth().register,v.length===1)typeof v[0]=="string"?w=v[0]:typeof v[0]=="function"&&(A=v[0]);else if(v.length>=2){const[P,N]=v;typeof P=="string"&&(w=P),A=N}let $=(k=(g=s==null?void 0:s.socket)==null?void 0:g.auth)==null?void 0:k.id;if($){if(!w){let P=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");P.uid&&(w=P.uid)}w&&$&&((b=(x=s==null?void 0:s.socket)==null?void 0:x.auth)==null||b.on((f==null?void 0:f.AUTH)+jt.user.status,P=>{h==="dev"&&console.log("The user with id: ",w," is disconnected/connected: ",P==null?void 0:P.value),typeof A=="function"&&A(Q({value:P},O))}))}return Q({},O)},device:{connected:(...v)=>{var g,k,x,b;let w=this.init(s);delete w.auth().login,delete w.auth().register;let A,O;if(v.length===1)typeof v[0]=="string"?A=v[0]:typeof v[0]=="function"&&(O=v[0]);else if(v.length>=2){const[P,N]=v;typeof P=="string"&&(A=P),O=N}let $=(k=(g=s==null?void 0:s.socket)==null?void 0:g.auth)==null?void 0:k.id;if($){if(!A){let P=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");P.uid&&(A=P.uid)}A&&$&&((b=(x=s==null?void 0:s.socket)==null?void 0:x.auth)==null||b.on((f==null?void 0:f.AUTH)+jt.user.device.connected,P=>{h==="dev"&&console.log("The user with id: ",A," has this device connected: ",P==null?void 0:P.value),typeof O=="function"&&O(Ue(Q(Q({},w.auth().device),w),{value:P}))}))}return Q(Q({},w.auth().device),w)},disconnected:(...v)=>{var g,k,x,b;let w=this.init(s);delete w.auth().login,delete w.auth().register;let A,O;if(v.length===1)typeof v[0]=="string"?A=v[0]:typeof v[0]=="function"&&(O=v[0]);else if(v.length>=2){const[P,N]=v;typeof P=="string"&&(A=P),O=N}let $=(k=(g=s==null?void 0:s.socket)==null?void 0:g.auth)==null?void 0:k.id;if($){if(!A){let P=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");P.uid&&(A=P.uid)}A&&$&&((b=(x=s==null?void 0:s.socket)==null?void 0:x.auth)==null||b.on((f==null?void 0:f.AUTH)+jt.user.device.disconnected,P=>{h==="dev"&&console.log("The user with id: ",A," has this device connected: ",P==null?void 0:P.value),typeof O=="function"&&O(Ue(Q(Q({},w.auth().device),w),{value:P}))}))}return Q(Q({},w.auth().device),w)},remove:(...v)=>{var g,k,x,b,w,A;let O=this.init(s);delete O.auth().login,delete O.auth().register;let $,P;if(v.length===1)typeof v[0]=="string"?$=v[0]:typeof v[0]=="function"&&(P=v[0]);else if(v.length>=2){const[z,q]=v;(typeof z=="string"||Array.isArray(z))&&($=z),P=q}let N=(k=(g=s==null?void 0:s.socket)==null?void 0:g.auth)==null?void 0:k.id,D=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");return $&&D.uid&&N&&((b=(x=s==null?void 0:s.socket)==null?void 0:x.auth)==null||b.emit((f==null?void 0:f.AUTH)+Ko.user.device.remove,{socketId:N,userId:$,currentUserId:D.uid}),(A=(w=s==null?void 0:s.socket)==null?void 0:w.auth)==null||A.on((f==null?void 0:f.AUTH)+jt.user.device.removed,z=>{h==="dev"&&console.log("The user with id: ",$," has this device connected: ",z==null?void 0:z.value),typeof P=="function"&&P(Ue(Q(Q({},O.auth().device),O),{value:z}))})),Q(Q({},O.auth().device),O)},list:(...v)=>{var g,k,x,b;let w=this.init(s);delete w.auth().login,delete w.auth().register;let A=Ko.users.device.list,O,$;if(v.length===1)typeof v[0]=="string"?O=v[0]:typeof v[0]=="function"&&($=v[0]);else if(v.length>=2){const[D,z]=v;typeof D=="string"&&(O=D,A=Ko.user.device.list),$=z}let P=(k=(g=s==null?void 0:s.socket)==null?void 0:g.auth)==null?void 0:k.id,N=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");return P&&N.uid&&(O||(A=Ko.user.device.list,O=N.uid),O&&P&&((x=s==null?void 0:s.socket.auth)==null||x.emit((f==null?void 0:f.AUTH)+A,{socketId:P,userId:O,currenUserId:N.uid}),(b=s==null?void 0:s.socket.auth)==null||b.on((f==null?void 0:f.AUTH)+A+"/",D=>{h==="dev"&&console.log("The user with id: ",O," has these devices connected: ",res==null?void 0:res.value),typeof $=="function"&&$(Ue(Q(Q({},w.auth().device),w),{value:D}))}))),Q(Q({},w.auth().device),w)}},req:(v,g,k)=>{let x=this.init(s);delete x.auth().login,delete x.auth().register;let b=Q(Q({},x),x.auth());return M(v+Tn.req,g,null,b,k)},$user:(()=>{let v=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");if(v.uid)return v})(),user:(...v)=>{let g,k;v.length>1?(typeof v[0]=="string"&&(g=v[0]),typeof v[1]=="function"&&(k=v[1])):v.length===1&&(typeof v[0]=="string"&&(g=v[0]),typeof v[0]=="function"&&(k=v[0]));let x=this.init(s);delete x.auth().login,delete x.auth().register;let b=Q(Q({},x),x.auth());if(!g||typeof g!="string"){let w=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}"),A=localStorage.getItem("accessToken"),O=(()=>{var $;try{let P=Xd(A);return(Date==null?void 0:Date.parse(($=new Date((P==null?void 0:P.exp)*1e3))==null?void 0:$.toString()))>Date.now()}catch(P){return!1}})();return w.uid&&O?(typeof k=="function"&&k(Ue(Q({},b),{value:w})),Ue(Q({},b),{val:()=>w})):M(Tn.user,{},null,null,({value:$})=>{var P;let N=$;N!=null&&N.data&&(N={data:(P=N==null?void 0:N.data)==null?void 0:P.data},N.data&&localStorage.setItem("userInfo",JSON.stringify(N.data))),typeof k=="function"&&k(Ue(Q({},b),{value:N}))})}else return M(Tn.user,{uid:g},null,null,({value:w})=>{var A;let O=w;O!=null&&O.data&&(O={data:(A=O==null?void 0:O.data)==null?void 0:A.data}),typeof k=="function"&&k(Ue(Q({},b),{value:O}))})},verifyEmailCode:(v,g)=>{let k=this.init(s);return delete k.auth().login,delete k.auth().register,M(Tn.verify_email_code,v,null,null,({value:x})=>{R({value:x,node:k},g)})},verifyTokenCode:(v,g)=>{let k=this.init(s);return delete k.auth().login,delete k.auth().register,M(Tn.verify_token_code,v,null,null,({value:x})=>{R({value:x,node:k},g)})},verifyPassCode:(v,g)=>{let k=this.init(s);return delete k.auth().login,delete k.auth().register,M(Tn.verify_pass_code,v,null,null,({value:x})=>{R({value:x,node:k},g)})},login:(v,g)=>{let k=this.init(s);return delete k.auth().login,delete k.auth().register,M(Tn.login,v,null,null,({value:x})=>{R({value:x,node:k},g)})},loginWithToken:(v,g)=>{let k=this.init(s);return delete k.auth().login,delete k.auth().register,localStorage.setItem("userInfo","{}"),localStorage.setItem("accessToken",""),localStorage.setItem("refreshToken",v),this.init(s).auth.user(null,g)},logout:v=>{let g=this.init(s);return localStorage.removeItem("refreshToken"),localStorage.removeItem("userInfo"),localStorage.removeItem("accessToken"),(()=>K(this,null,function*(){var k,x,b,w,A,O;yield(b=(x=(k=be(this,Ut))==null?void 0:k.ref("/database"))==null?void 0:x.remove())==null?void 0:b.catch($=>{}),yield(O=(A=(w=be(this,Ut))==null?void 0:w.ref("/transaction"))==null?void 0:A.remove())==null?void 0:O.catch($=>{})}))().then(k=>{}).catch(k=>{}),typeof v=="function"&&v(Q(Q({},g),g.auth())),Q(Q({},g),g.auth())},register:(v,g)=>{let k=this.init(s);return delete k.auth().login,delete k.auth().register,M(Tn.register,v,null,null,({value:x})=>{R({value:x,node:k},g)})},forgotPassword:(v,g)=>M(Tn.forgotPassword,v,null,null,g),users:()=>{let v=this.init(s);return delete v.auth().login,delete v.auth().register,v.ref("/users")},tokens:()=>{let v=this.init(s);return delete v.auth().login,delete v.auth().register,v.ref("/tokens")}}},syncDatabase:(m=!0)=>{const v=this.init(s);return Mr(this,nr,typeof m=="boolean"?m:!0),v.database()},ref:(m="",v={host:p.AUTH,version:f.AUTH,base:Tn.base},g=(x=>(x=s==null?void 0:s.socket)==null?void 0:x.socket)(),k=!0)=>{m=m.trim(),m=m.replace(/\/\//g,"/"),m.charAt(0)==="/"&&m.length<=1&&(m="/root"),m.charAt(m.length-1)==="/"&&(m=m.slice(0,-1));const x=v.host+v.version+v.base+m;let b=this.init(s);return delete b.auth().login,delete b.auth().register,Mr(this,wi,k),{push:(...w)=>{let A=kl();return!w.length>0?{getKey:()=>A}:b.ref(m+"/"+A,v,g).create(w)},private:(w=F())=>b.ref(m+"/ps"+w+"/pe",v,g),setAuthAccess:(w=!0,A=be(this,Xi))=>(Mr(this,Xi,A),b.ref(m,v,g,w)),req:(...w)=>{let A=Q(Q({},b.ref(m,v,g)),b);if(w.length>=2){let[O="post",$={},P={},N]=w;if(typeof O=="string"&&["post","put","delete","get"].includes(O)){let D=Nt.req;return H(O,x+D,$,P,A,N)}return A}else{let O=w.filter($=>typeof $=="function");if(O.length>0)O=O[0],typeof O=="function"&&O(A);else return A}},child:(w="")=>(w=w.trim(),w=w.replace(/\/\//g,"/"),w.charAt(w.length-1)==="/"&&(w=w.slice(0,-1)),w.charAt(0)!=="/"&&(w="/"+w),b.ref(m+w,v,g)),set:(...w)=>{var A;return(A=b.ref(m,v,g))==null?void 0:A.create(...w)},create:(...w)=>{var A,O,$,P;let N=Q(Q({},b.ref(m,v,g)),b);if(b.auth().$currentUserId&&m.includes("/users")&&be(this,nr)&&!be(this,_n))return($=(O=(A=b.local())==null?void 0:A.database())==null?void 0:O.ref(m))==null?void 0:$.create(...w);{let{data:D,onRequest:z,callback:q}=L(w),ne=Nt.create.one;if(be(this,tr)){if((D==null?void 0:D.file)||(D==null?void 0:D.directory))return(P=b.ref(m))==null?void 0:P.upload(D,null,q);Array.isArray(D.folders)&&(ne=Nt.create.many)}else Array!=null&&Array.isArray(D)&&(ne=Nt.create.many);return H("post",x+ne,D,z,N,q)}},find:(...w)=>{var A,O,$,P;if(console.log("Database connected: ",be(this,_n)),b.auth().$currentUserId&&m.includes("/users")&&be(this,nr)&&!be(this,_n))return h==="dev"&&console.log("Find: We are offline"),($=(O=(A=b.local())==null?void 0:A.database())==null?void 0:O.ref(m))==null?void 0:$.find(...w);{h==="dev"&&console.log("Find: We are online");let N=Q(Q({},b.ref(m,v,g)),b),{data:D,onRequest:z,callback:q}=L(w),ne=Nt.find.one;return be(this,tr)?(Array.isArray(D==null?void 0:D.files)||Array.isArray(D==null?void 0:D.folders))&&(Array.isArray(D==null?void 0:D.files)&&(D.isFolder=!1),Array.isArray(D==null?void 0:D.folders)&&(D.isFolder=!0),ne=Nt.find.many):(((P=Object.keys(D))==null?void 0:P.length)<=0||D.order||D.where||D.$option||D.skip||D.take)&&(ne=Nt.find.many),H("post",x+ne,D,z,N,q)}},get:(...w)=>{var A,O,$,P;if(b.auth().$currentUserId&&m.includes("/users")&&be(this,nr)&&!be(this,_n))return($=(O=(A=b.local())==null?void 0:A.database())==null?void 0:O.ref(m))==null?void 0:$.get(...w);{let N=Q(Q({},b.ref(m,v,g)),b),{data:D,onRequest:z,callback:q}=L(w),ne=Nt.get.one;return be(this,tr)?(Array.isArray(D==null?void 0:D.files)||Array.isArray(D==null?void 0:D.folders))&&(Array.isArray(D==null?void 0:D.files)&&(D.isFolder=!1),Array.isArray(D==null?void 0:D.folders)&&(D.isFolder=!0),ne=Nt.get.many):(((P=Object.keys(D))==null?void 0:P.length)<=0||D.order||D.where||D.$option||D.skip||D.take)&&(ne=Nt.get.many),H("get",x+ne+"?query="+JSON.stringify(y(D)),null,z,N,q)}},query:(...w)=>{var A,O,$;if(b.auth().$currentUserId&&m.includes("/users")&&be(this,nr)&&!be(this,_n))return($=(O=(A=b.local())==null?void 0:A.database())==null?void 0:O.ref(m))==null?void 0:$.query(...w);{let P=Q(Q({},b.ref(m,v,g)),b),{data:N,onRequest:D,callback:z}=L(w);return(!N||N==="")&&(N={take:15},!be(this,Fs)&&!N.order&&(N.order={uid:"ASC"})),H("get",x+Nt.get.many+"?query="+JSON.stringify(y(N)),null,D,P,z)}},update:(...w)=>{var A,O,$;if(b.auth().$currentUserId&&m.includes("/users")&&be(this,nr)&&!be(this,_n))return($=(O=(A=b.local())==null?void 0:A.database())==null?void 0:O.ref(m))==null?void 0:$.update(...w);{let P=Q(Q({},b.ref(m,v,g)),b),{data:N,onRequest:D,callback:z}=L(w),q=Nt.update.one;return be(this,tr)?(Array.isArray(N==null?void 0:N.files)||Array.isArray(N==null?void 0:N.folders))&&(Array.isArray(N==null?void 0:N.files)&&(N.isFolder=!1),Array.isArray(N==null?void 0:N.folders)&&(N.isFolder=!0),q=Nt.update.many):Array.isArray(N)&&(q=Nt.find.many),H("put",x+q,N,D,P,z)}},delete:(...w)=>{var A,O,$;if(b.auth().$currentUserId&&m.includes("/users")&&be(this,nr)&&!be(this,_n))return($=(O=(A=b.local())==null?void 0:A.database())==null?void 0:O.ref(m))==null?void 0:$.delete(...w);{let P=Q(Q({},b.ref(m,v,g)),b),{data:N,onRequest:D,callback:z}=L(w),q=Nt.delete.one;return be(this,tr)?(Array.isArray(N==null?void 0:N.files)||Array.isArray(N==null?void 0:N.folders))&&(Array.isArray(N==null?void 0:N.files)&&(N.isFolder=!1),Array.isArray(N==null?void 0:N.folders)&&(N.isFolder=!0),Object.keys(N).length<=0&&(N.isFolder=!0),q=Nt.delete.many):(Array.isArray(N)||N.where)&&(q=Nt.delete.many),H("delete",x+q,N,D,P,z)}},on:()=>{let w=Q(Q({},b.ref(m,v,g)),b);return B(g,v,w,m)},onValue:w=>{let A=Q(Q({},b.ref(m,v,g)),b),O=b.ref(m,v,g);return O==null||O.on().create(w),O==null||O.on().update(w),O==null||O.on().delete(w),O==null||O.on().upload(w),A}}}}}),Mr(this,Zi,e);let{ENV:t,OFFLINE_DB_NAME:r}=be(this,Zi);Mr(this,Ut,bo.WithIndexedDB((r==null?void 0:r.AUTH)||"swyger_auth"));let i=()=>K(this,null,function*(){try{let s,o=localStorage.getItem("accessToken");if((()=>{var a;try{s=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");let c=Xd(o);return(Date==null?void 0:Date.parse((a=new Date((c==null?void 0:c.exp)*1e3))==null?void 0:a.toString()))<Date.now()}catch(c){return!1}})()&&s.uid)try{t==="dev"&&console.log("Token expired on inactivity, Trying to request a new refresh token")}catch(a){}}catch(s){}});"requestIdleCallback"in window&&requestIdleCallback(i)}}Us=new WeakMap,wi=new WeakMap,Xi=new WeakMap,Fs=new WeakMap,tr=new WeakMap,km=new WeakMap,Ru=new WeakMap,Cu=new WeakMap,ya=new WeakMap,nr=new WeakMap,_n=new WeakMap,Zi=new WeakMap,Ut=new WeakMap;const T_={init:n=>{try{return(e={})=>new $_(n).init(e)}catch(e){return{}}}};let P_={init:n=>{var e,t,r;return{OFFLINE_DB_NAME:{AUTH:((e=n==null?void 0:n.OFFLINE_DB_NAME)==null?void 0:e.AUTH)||"swyger_auth"},ENV:(n==null?void 0:n.ENV)||"prod",HOST_SERVER:{AUTH:((t=n==null?void 0:n.HOST_SERVER)==null?void 0:t.AUTH)||"http://localhost:4100"},API_VERSION:{AUTH:((r=n==null?void 0:n.API_VERSION)==null?void 0:r.AUTH)||"/api/v1"},AUTO_REFRESH_TOKEN_TIMEOUT:(n==null?void 0:n.AUTO_REFRESH_TOKEN_TIMEOUT)||15e5,API_KEY:(n==null?void 0:n.API_KEY)||"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJzd3lnZXIuY29tIiwiaWF0IjoxNjUzNDQwOTkxLCJleHAiOjE2ODQ5NzY5OTEsImF1ZCI6ImRheW52ZXIuY29tIiwic3ViIjoidGVhbUBzd3lnZXIuY29tIiwiR2l2ZW5OYW1lIjoiSXZhbiBKb2VsIiwiU3VybmFtZSI6IlNvYmd1aSIsIkVtYWlsIjoidGVhbUBhZ2dsb215LmNvbSIsIlJvbGUiOlsiQWRtaW4iLCJQcm9qZWN0IEFkbWluaXN0cmF0b3IiXX0.UvlcjBahR9G8dKxIeENJ7k4I87t3_oNJQ16eyPsRcSE"}}};const I_={init:n=>{let e=P_.init(n);const t=Vx.init(e),r={socket:{auth:t==null?void 0:t.auth,database:t==null?void 0:t.database,storage:t==null?void 0:t.storage}};return T_.init(e)(r)}};var Nu=function(n,e){return Nu=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])},Nu(n,e)};function vt(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Nu(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function R_(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{l(r.next(u))}catch(h){o(h)}}function c(u){try{l(r.throw(u))}catch(h){o(h)}}function l(u){u.done?s(u.value):i(u.value).then(a,c)}l((r=r.apply(n,e||[])).next())})}function nf(n,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(t=0)),t;)try{if(r=1,i&&(s=l[0]&2?i.return:l[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,l[1])).done)return s;switch(i=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){t.label=l[1];break}if(l[0]===6&&t.label<s[1]){t.label=s[1],s=l;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(l);break}s[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(n,t)}catch(u){l=[6,u],i=0}finally{r=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function cn(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ye(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return s}function Ge(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return n.concat(s||Array.prototype.slice.call(e))}function rs(n){return this instanceof rs?(this.v=n,this):new rs(n)}function C_(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(p){r[p]&&(i[p]=function(f){return new Promise(function(d,y){s.push([p,f,d,y])>1||a(p,f)})})}function a(p,f){try{c(r[p](f))}catch(d){h(s[0][3],d)}}function c(p){p.value instanceof rs?Promise.resolve(p.value.v).then(l,u):h(s[0][2],p)}function l(p){a("next",p)}function u(p){a("throw",p)}function h(p,f){p(f),s.shift(),s.length&&a(s[0][0],s[0][1])}}function N_(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof cn=="function"?cn(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(s){t[s]=n[s]&&function(o){return new Promise(function(a,c){o=n[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}function Ie(n){return typeof n=="function"}function Ni(n){var e=function(r){Error.call(r),r.stack=new Error().stack},t=n(e);return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var ga=Ni(function(n){return function(e){n(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(t,r){return r+1+") "+t.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function Sr(n,e){if(n){var t=n.indexOf(e);0<=t&&n.splice(t,1)}}var pn=function(){function n(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return n.prototype.unsubscribe=function(){var e,t,r,i,s;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var a=cn(o),c=a.next();!c.done;c=a.next()){var l=c.value;l.remove(this)}}catch(y){e={error:y}}finally{try{c&&!c.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}else o.remove(this);var u=this.initialTeardown;if(Ie(u))try{u()}catch(y){s=y instanceof ga?y.errors:[y]}var h=this._finalizers;if(h){this._finalizers=null;try{for(var p=cn(h),f=p.next();!f.done;f=p.next()){var d=f.value;try{Sp(d)}catch(y){s=s!=null?s:[],y instanceof ga?s=Ge(Ge([],Ye(s)),Ye(y.errors)):s.push(y)}}}catch(y){r={error:y}}finally{try{f&&!f.done&&(i=p.return)&&i.call(p)}finally{if(r)throw r.error}}}if(s)throw new ga(s)}},n.prototype.add=function(e){var t;if(e&&e!==this)if(this.closed)Sp(e);else{if(e instanceof n){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}},n.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},n.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},n.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&Sr(t,e)},n.prototype.remove=function(e){var t=this._finalizers;t&&Sr(t,e),e instanceof n&&e._removeParent(this)},n.EMPTY=function(){var e=new n;return e.closed=!0,e}(),n}(),xm=pn.EMPTY;function Em(n){return n instanceof pn||n&&"closed"in n&&Ie(n.remove)&&Ie(n.add)&&Ie(n.unsubscribe)}function Sp(n){Ie(n)?n():n.unsubscribe()}var pi={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},rf={setTimeout:function(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];var i=rf.delegate;return i!=null&&i.setTimeout?i.setTimeout.apply(i,Ge([n,e],Ye(t))):setTimeout.apply(void 0,Ge([n,e],Ye(t)))},clearTimeout:function(n){return clearTimeout(n)},delegate:void 0};function _m(n){rf.setTimeout(function(){var e=pi.onUnhandledError;if(e)e(n);else throw n})}function yt(){}var j_=function(){return sf("C",void 0,void 0)}();function B_(n){return sf("E",void 0,n)}function L_(n){return sf("N",n,void 0)}function sf(n,e,t){return{kind:n,value:e,error:t}}var Ei=null;function ma(n){if(pi.useDeprecatedSynchronousErrorHandling){var e=!Ei;if(e&&(Ei={errorThrown:!1,error:null}),n(),e){var t=Ei,r=t.errorThrown,i=t.error;if(Ei=null,r)throw i}}else n()}function D_(n){pi.useDeprecatedSynchronousErrorHandling&&Ei&&(Ei.errorThrown=!0,Ei.error=n)}var wc=function(n){vt(e,n);function e(t){var r=n.call(this)||this;return r.isStopped=!1,t?(r.destination=t,Em(t)&&t.add(r)):r.destination=q_,r}return e.create=function(t,r,i){return new hs(t,r,i)},e.prototype.next=function(t){this.isStopped?Il(L_(t),this):this._next(t)},e.prototype.error=function(t){this.isStopped?Il(B_(t),this):(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped?Il(j_,this):(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,n.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(pn),U_=Function.prototype.bind;function Pl(n,e){return U_.call(n,e)}var F_=function(){function n(e){this.partialObserver=e}return n.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(r){Wo(r)}},n.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(r){Wo(r)}else Wo(e)},n.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(t){Wo(t)}},n}(),hs=function(n){vt(e,n);function e(t,r,i){var s=n.call(this)||this,o;if(Ie(t)||!t)o={next:t!=null?t:void 0,error:r!=null?r:void 0,complete:i!=null?i:void 0};else{var a;s&&pi.useDeprecatedNextContext?(a=Object.create(t),a.unsubscribe=function(){return s.unsubscribe()},o={next:t.next&&Pl(t.next,a),error:t.error&&Pl(t.error,a),complete:t.complete&&Pl(t.complete,a)}):o=t}return s.destination=new F_(o),s}return e}(wc);function Wo(n){pi.useDeprecatedSynchronousErrorHandling?D_(n):_m(n)}function M_(n){throw n}function Il(n,e){var t=pi.onStoppedNotification;t&&rf.setTimeout(function(){return t(n,e)})}var q_={closed:!0,next:yt,error:M_,complete:yt},kc=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Pt(n){return n}function of(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return Am(n)}function Am(n){return n.length===0?Pt:n.length===1?n[0]:function(e){return n.reduce(function(t,r){return r(t)},e)}}var Fe=function(){function n(e){e&&(this._subscribe=e)}return n.prototype.lift=function(e){var t=new n;return t.source=this,t.operator=e,t},n.prototype.subscribe=function(e,t,r){var i=this,s=K_(e)?e:new hs(e,t,r);return ma(function(){var o=i,a=o.operator,c=o.source;s.add(a?a.call(s,c):c?i._subscribe(s):i._trySubscribe(s))}),s},n.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},n.prototype.forEach=function(e,t){var r=this;return t=$p(t),new t(function(i,s){var o=new hs({next:function(a){try{e(a)}catch(c){s(c),o.unsubscribe()}},error:s,complete:i});r.subscribe(o)})},n.prototype._subscribe=function(e){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(e)},n.prototype[kc]=function(){return this},n.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Am(e)(this)},n.prototype.toPromise=function(e){var t=this;return e=$p(e),new e(function(r,i){var s;t.subscribe(function(o){return s=o},function(o){return i(o)},function(){return r(s)})})},n.create=function(e){return new n(e)},n}();function $p(n){var e;return(e=n!=null?n:pi.Promise)!==null&&e!==void 0?e:Promise}function V_(n){return n&&Ie(n.next)&&Ie(n.error)&&Ie(n.complete)}function K_(n){return n&&n instanceof wc||V_(n)&&Em(n)}function Om(n){return Ie(n==null?void 0:n.lift)}function ye(n){return function(e){if(Om(e))return e.lift(function(t){try{return n(t,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function he(n,e,t,r,i){return new af(n,e,t,r,i)}var af=function(n){vt(e,n);function e(t,r,i,s,o,a){var c=n.call(this,t)||this;return c.onFinalize=o,c.shouldUnsubscribe=a,c._next=r?function(l){try{r(l)}catch(u){t.error(u)}}:n.prototype._next,c._error=s?function(l){try{s(l)}catch(u){t.error(u)}finally{this.unsubscribe()}}:n.prototype._error,c._complete=i?function(){try{i()}catch(l){t.error(l)}finally{this.unsubscribe()}}:n.prototype._complete,c}return e.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;n.prototype.unsubscribe.call(this),!r&&((t=this.onFinalize)===null||t===void 0||t.call(this))}},e}(wc);function Sm(){return ye(function(n,e){var t=null;n._refCount++;var r=he(e,void 0,void 0,void 0,function(){if(!n||n._refCount<=0||0<--n._refCount){t=null;return}var i=n._connection,s=t;t=null,i&&(!s||i===s)&&i.unsubscribe(),e.unsubscribe()});n.subscribe(r),r.closed||(t=n.connect())})}var xc=function(n){vt(e,n);function e(t,r){var i=n.call(this)||this;return i.source=t,i.subjectFactory=r,i._subject=null,i._refCount=0,i._connection=null,Om(t)&&(i.lift=t.lift),i}return e.prototype._subscribe=function(t){return this.getSubject().subscribe(t)},e.prototype.getSubject=function(){var t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject},e.prototype._teardown=function(){this._refCount=0;var t=this._connection;this._subject=this._connection=null,t==null||t.unsubscribe()},e.prototype.connect=function(){var t=this,r=this._connection;if(!r){r=this._connection=new pn;var i=this.getSubject();r.add(this.source.subscribe(he(i,void 0,function(){t._teardown(),i.complete()},function(s){t._teardown(),i.error(s)},function(){return t._teardown()}))),r.closed&&(this._connection=null,r=pn.EMPTY)}return r},e.prototype.refCount=function(){return Sm()(this)},e}(Fe),$m={now:function(){return($m.delegate||performance).now()},delegate:void 0},Gs={schedule:function(n){var e=requestAnimationFrame,t=cancelAnimationFrame,r=e(function(i){t=void 0,n(i)});return new pn(function(){return t==null?void 0:t(r)})},requestAnimationFrame:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Gs.delegate;return((t==null?void 0:t.requestAnimationFrame)||requestAnimationFrame).apply(void 0,Ge([],Ye(n)))},cancelAnimationFrame:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return cancelAnimationFrame.apply(void 0,Ge([],Ye(n)))},delegate:void 0};function W_(n){return n?Tm(n):z_}function Tm(n){return new Fe(function(e){var t=n||$m,r=t.now(),i=0,s=function(){e.closed||(i=Gs.requestAnimationFrame(function(o){i=0;var a=t.now();e.next({timestamp:n?a:o,elapsed:a-r}),s()}))};return s(),function(){i&&Gs.cancelAnimationFrame(i)}})}var z_=Tm(),Pm=Ni(function(n){return function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),xt=function(n){vt(e,n);function e(){var t=n.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return e.prototype.lift=function(t){var r=new Tp(this,this);return r.operator=t,r},e.prototype._throwIfClosed=function(){if(this.closed)throw new Pm},e.prototype.next=function(t){var r=this;ma(function(){var i,s;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var o=cn(r.currentObservers),a=o.next();!a.done;a=o.next()){var c=a.value;c.next(t)}}catch(l){i={error:l}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}}})},e.prototype.error=function(t){var r=this;ma(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=t;for(var i=r.observers;i.length;)i.shift().error(t)}})},e.prototype.complete=function(){var t=this;ma(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var r=t.observers;r.length;)r.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(t){return this._throwIfClosed(),n.prototype._trySubscribe.call(this,t)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var r=this,i=this,s=i.hasError,o=i.isStopped,a=i.observers;return s||o?xm:(this.currentObservers=null,a.push(t),new pn(function(){r.currentObservers=null,Sr(a,t)}))},e.prototype._checkFinalizedStatuses=function(t){var r=this,i=r.hasError,s=r.thrownError,o=r.isStopped;i?t.error(s):o&&t.complete()},e.prototype.asObservable=function(){var t=new Fe;return t.source=this,t},e.create=function(t,r){return new Tp(t,r)},e}(Fe),Tp=function(n){vt(e,n);function e(t,r){var i=n.call(this)||this;return i.destination=t,i.source=r,i}return e.prototype.next=function(t){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.next)===null||i===void 0||i.call(r,t)},e.prototype.error=function(t){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.error)===null||i===void 0||i.call(r,t)},e.prototype.complete=function(){var t,r;(r=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||r===void 0||r.call(t)},e.prototype._subscribe=function(t){var r,i;return(i=(r=this.source)===null||r===void 0?void 0:r.subscribe(t))!==null&&i!==void 0?i:xm},e}(xt),Im=function(n){vt(e,n);function e(t){var r=n.call(this)||this;return r._value=t,r}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(t){var r=n.prototype._subscribe.call(this,t);return!r.closed&&t.next(this._value),r},e.prototype.getValue=function(){var t=this,r=t.hasError,i=t.thrownError,s=t._value;if(r)throw i;return this._throwIfClosed(),s},e.prototype.next=function(t){n.prototype.next.call(this,this._value=t)},e}(xt),Ec={now:function(){return(Ec.delegate||Date).now()},delegate:void 0},cf=function(n){vt(e,n);function e(t,r,i){t===void 0&&(t=1/0),r===void 0&&(r=1/0),i===void 0&&(i=Ec);var s=n.call(this)||this;return s._bufferSize=t,s._windowTime=r,s._timestampProvider=i,s._buffer=[],s._infiniteTimeWindow=!0,s._infiniteTimeWindow=r===1/0,s._bufferSize=Math.max(1,t),s._windowTime=Math.max(1,r),s}return e.prototype.next=function(t){var r=this,i=r.isStopped,s=r._buffer,o=r._infiniteTimeWindow,a=r._timestampProvider,c=r._windowTime;i||(s.push(t),!o&&s.push(a.now()+c)),this._trimBuffer(),n.prototype.next.call(this,t)},e.prototype._subscribe=function(t){this._throwIfClosed(),this._trimBuffer();for(var r=this._innerSubscribe(t),i=this,s=i._infiniteTimeWindow,o=i._buffer,a=o.slice(),c=0;c<a.length&&!t.closed;c+=s?1:2)t.next(a[c]);return this._checkFinalizedStatuses(t),r},e.prototype._trimBuffer=function(){var t=this,r=t._bufferSize,i=t._timestampProvider,s=t._buffer,o=t._infiniteTimeWindow,a=(o?1:2)*r;if(r<1/0&&a<s.length&&s.splice(0,s.length-a),!o){for(var c=i.now(),l=0,u=1;u<s.length&&s[u]<=c;u+=2)l=u;l&&s.splice(0,l+1)}},e}(xt),lf=function(n){vt(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t._value=null,t._hasValue=!1,t._isComplete=!1,t}return e.prototype._checkFinalizedStatuses=function(t){var r=this,i=r.hasError,s=r._hasValue,o=r._value,a=r.thrownError,c=r.isStopped,l=r._isComplete;i?t.error(a):(c||l)&&(s&&t.next(o),t.complete())},e.prototype.next=function(t){this.isStopped||(this._value=t,this._hasValue=!0)},e.prototype.complete=function(){var t=this,r=t._hasValue,i=t._value,s=t._isComplete;s||(this._isComplete=!0,r&&n.prototype.next.call(this,i),n.prototype.complete.call(this))},e}(xt),H_=function(n){vt(e,n);function e(t,r){return n.call(this)||this}return e.prototype.schedule=function(t,r){return this},e}(pn),ju={setInterval:function(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];var i=ju.delegate;return i!=null&&i.setInterval?i.setInterval.apply(i,Ge([n,e],Ye(t))):setInterval.apply(void 0,Ge([n,e],Ye(t)))},clearInterval:function(n){return clearInterval(n)},delegate:void 0},wo=function(n){vt(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.scheduler=t,i.work=r,i.pending=!1,i}return e.prototype.schedule=function(t,r){var i;if(r===void 0&&(r=0),this.closed)return this;this.state=t;var s=this.id,o=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(o,s,r)),this.pending=!0,this.delay=r,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(o,this.id,r),this},e.prototype.requestAsyncId=function(t,r,i){return i===void 0&&(i=0),ju.setInterval(t.flush.bind(t,this),i)},e.prototype.recycleAsyncId=function(t,r,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return r;r!=null&&ju.clearInterval(r)},e.prototype.execute=function(t,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(t,r);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,r){var i=!1,s;try{this.work(t)}catch(o){i=!0,s=o||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),s},e.prototype.unsubscribe=function(){if(!this.closed){var t=this,r=t.id,i=t.scheduler,s=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,Sr(s,this),r!=null&&(this.id=this.recycleAsyncId(i,r,null)),this.delay=null,n.prototype.unsubscribe.call(this)}},e}(H_),J_=1,Rl,Bu={};function Pp(n){return n in Bu?(delete Bu[n],!0):!1}var Rm={setImmediate:function(n){var e=J_++;return Bu[e]=!0,Rl||(Rl=Promise.resolve()),Rl.then(function(){return Pp(e)&&n()}),e},clearImmediate:function(n){Pp(n)}},Y_=Rm.setImmediate,G_=Rm.clearImmediate,Lu={setImmediate:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Lu.delegate;return((t==null?void 0:t.setImmediate)||Y_).apply(void 0,Ge([],Ye(n)))},clearImmediate:function(n){return G_(n)},delegate:void 0},Q_=function(n){vt(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.scheduler=t,i.work=r,i}return e.prototype.requestAsyncId=function(t,r,i){return i===void 0&&(i=0),i!==null&&i>0?n.prototype.requestAsyncId.call(this,t,r,i):(t.actions.push(this),t._scheduled||(t._scheduled=Lu.setImmediate(t.flush.bind(t,void 0))))},e.prototype.recycleAsyncId=function(t,r,i){var s;if(i===void 0&&(i=0),i!=null?i>0:this.delay>0)return n.prototype.recycleAsyncId.call(this,t,r,i);var o=t.actions;r!=null&&((s=o[o.length-1])===null||s===void 0?void 0:s.id)!==r&&(Lu.clearImmediate(r),t._scheduled===r&&(t._scheduled=void 0))},e}(wo),Du=function(){function n(e,t){t===void 0&&(t=n.now),this.schedulerActionCtor=e,this.now=t}return n.prototype.schedule=function(e,t,r){return t===void 0&&(t=0),new this.schedulerActionCtor(this,e).schedule(r,t)},n.now=Ec.now,n}(),ko=function(n){vt(e,n);function e(t,r){r===void 0&&(r=Du.now);var i=n.call(this,t,r)||this;return i.actions=[],i._active=!1,i}return e.prototype.flush=function(t){var r=this.actions;if(this._active){r.push(t);return}var i;this._active=!0;do if(i=t.execute(t.state,t.delay))break;while(t=r.shift());if(this._active=!1,i){for(;t=r.shift();)t.unsubscribe();throw i}},e}(Du),X_=function(n){vt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.flush=function(t){this._active=!0;var r=this._scheduled;this._scheduled=void 0;var i=this.actions,s;t=t||i.shift();do if(s=t.execute(t.state,t.delay))break;while((t=i[0])&&t.id===r&&i.shift());if(this._active=!1,s){for(;(t=i[0])&&t.id===r&&i.shift();)t.unsubscribe();throw s}},e}(ko),Cm=new X_(Q_),Z_=Cm,Un=new ko(wo),uf=Un,eA=function(n){vt(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.scheduler=t,i.work=r,i}return e.prototype.schedule=function(t,r){return r===void 0&&(r=0),r>0?n.prototype.schedule.call(this,t,r):(this.delay=r,this.state=t,this.scheduler.flush(this),this)},e.prototype.execute=function(t,r){return r>0||this.closed?n.prototype.execute.call(this,t,r):this._execute(t,r)},e.prototype.requestAsyncId=function(t,r,i){return i===void 0&&(i=0),i!=null&&i>0||i==null&&this.delay>0?n.prototype.requestAsyncId.call(this,t,r,i):(t.flush(this),0)},e}(wo),tA=function(n){vt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e}(ko),Nm=new tA(eA),nA=Nm,rA=function(n){vt(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.scheduler=t,i.work=r,i}return e.prototype.requestAsyncId=function(t,r,i){return i===void 0&&(i=0),i!==null&&i>0?n.prototype.requestAsyncId.call(this,t,r,i):(t.actions.push(this),t._scheduled||(t._scheduled=Gs.requestAnimationFrame(function(){return t.flush(void 0)})))},e.prototype.recycleAsyncId=function(t,r,i){var s;if(i===void 0&&(i=0),i!=null?i>0:this.delay>0)return n.prototype.recycleAsyncId.call(this,t,r,i);var o=t.actions;r!=null&&((s=o[o.length-1])===null||s===void 0?void 0:s.id)!==r&&(Gs.cancelAnimationFrame(r),t._scheduled=void 0)},e}(wo),iA=function(n){vt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.flush=function(t){this._active=!0;var r=this._scheduled;this._scheduled=void 0;var i=this.actions,s;t=t||i.shift();do if(s=t.execute(t.state,t.delay))break;while((t=i[0])&&t.id===r&&i.shift());if(this._active=!1,s){for(;(t=i[0])&&t.id===r&&i.shift();)t.unsubscribe();throw s}},e}(ko),jm=new iA(rA),sA=jm,oA=function(n){vt(e,n);function e(t,r){t===void 0&&(t=Bm),r===void 0&&(r=1/0);var i=n.call(this,t,function(){return i.frame})||this;return i.maxFrames=r,i.frame=0,i.index=-1,i}return e.prototype.flush=function(){for(var t=this,r=t.actions,i=t.maxFrames,s,o;(o=r[0])&&o.delay<=i&&(r.shift(),this.frame=o.delay,!(s=o.execute(o.state,o.delay))););if(s){for(;o=r.shift();)o.unsubscribe();throw s}},e.frameTimeFactor=10,e}(ko),Bm=function(n){vt(e,n);function e(t,r,i){i===void 0&&(i=t.index+=1);var s=n.call(this,t,r)||this;return s.scheduler=t,s.work=r,s.index=i,s.active=!0,s.index=t.index=i,s}return e.prototype.schedule=function(t,r){if(r===void 0&&(r=0),Number.isFinite(r)){if(!this.id)return n.prototype.schedule.call(this,t,r);this.active=!1;var i=new e(this.scheduler,this.work);return this.add(i),i.schedule(t,r)}else return pn.EMPTY},e.prototype.requestAsyncId=function(t,r,i){i===void 0&&(i=0),this.delay=t.frame+i;var s=t.actions;return s.push(this),s.sort(e.sortActions),1},e.prototype.recycleAsyncId=function(t,r,i){},e.prototype._execute=function(t,r){if(this.active===!0)return n.prototype._execute.call(this,t,r)},e.sortActions=function(t,r){return t.delay===r.delay?t.index===r.index?0:t.index>r.index?1:-1:t.delay>r.delay?1:-1},e}(wo),yr=new Fe(function(n){return n.complete()});function aA(n){return n?cA(n):yr}function cA(n){return new Fe(function(e){return n.schedule(function(){return e.complete()})})}function _c(n){return n&&Ie(n.schedule)}function hf(n){return n[n.length-1]}function xo(n){return Ie(hf(n))?n.pop():void 0}function Pr(n){return _c(hf(n))?n.pop():void 0}function Lm(n,e){return typeof hf(n)=="number"?n.pop():e}var ff=function(n){return n&&typeof n.length=="number"&&typeof n!="function"};function Dm(n){return Ie(n==null?void 0:n.then)}function Um(n){return Ie(n[kc])}function Fm(n){return Symbol.asyncIterator&&Ie(n==null?void 0:n[Symbol.asyncIterator])}function Mm(n){return new TypeError("You provided "+(n!==null&&typeof n=="object"?"an invalid object":"'"+n+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function lA(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var qm=lA();function Vm(n){return Ie(n==null?void 0:n[qm])}function Km(n){return C_(this,arguments,function(){var e,t,r,i;return nf(this,function(s){switch(s.label){case 0:e=n.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,rs(e.read())];case 3:return t=s.sent(),r=t.value,i=t.done,i?[4,rs(void 0)]:[3,5];case 4:return[2,s.sent()];case 5:return[4,rs(r)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function Wm(n){return Ie(n==null?void 0:n.getReader)}function Ae(n){if(n instanceof Fe)return n;if(n!=null){if(Um(n))return uA(n);if(ff(n))return hA(n);if(Dm(n))return fA(n);if(Fm(n))return zm(n);if(Vm(n))return dA(n);if(Wm(n))return pA(n)}throw Mm(n)}function uA(n){return new Fe(function(e){var t=n[kc]();if(Ie(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function hA(n){return new Fe(function(e){for(var t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}function fA(n){return new Fe(function(e){n.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,_m)})}function dA(n){return new Fe(function(e){var t,r;try{for(var i=cn(n),s=i.next();!s.done;s=i.next()){var o=s.value;if(e.next(o),e.closed)return}}catch(a){t={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}e.complete()})}function zm(n){return new Fe(function(e){yA(n,e).catch(function(t){return e.error(t)})})}function pA(n){return zm(Km(n))}function yA(n,e){var t,r,i,s;return R_(this,void 0,void 0,function(){var o,a;return nf(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),t=N_(n),c.label=1;case 1:return[4,t.next()];case 2:if(r=c.sent(),!!r.done)return[3,4];if(o=r.value,e.next(o),e.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),i={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),r&&!r.done&&(s=t.return)?[4,s.call(t)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function ln(n,e,t,r,i){r===void 0&&(r=0),i===void 0&&(i=!1);var s=e.schedule(function(){t(),i?n.add(this.schedule(null,r)):this.unsubscribe()},r);if(n.add(s),!i)return s}function Ac(n,e){return e===void 0&&(e=0),ye(function(t,r){t.subscribe(he(r,function(i){return ln(r,n,function(){return r.next(i)},e)},function(){return ln(r,n,function(){return r.complete()},e)},function(i){return ln(r,n,function(){return r.error(i)},e)}))})}function Oc(n,e){return e===void 0&&(e=0),ye(function(t,r){r.add(n.schedule(function(){return t.subscribe(r)},e))})}function gA(n,e){return Ae(n).pipe(Oc(e),Ac(e))}function mA(n,e){return Ae(n).pipe(Oc(e),Ac(e))}function vA(n,e){return new Fe(function(t){var r=0;return e.schedule(function(){r===n.length?t.complete():(t.next(n[r++]),t.closed||this.schedule())})})}function Hm(n,e){return new Fe(function(t){var r;return ln(t,e,function(){r=n[qm](),ln(t,e,function(){var i,s,o;try{i=r.next(),s=i.value,o=i.done}catch(a){t.error(a);return}o?t.complete():t.next(s)},0,!0)}),function(){return Ie(r==null?void 0:r.return)&&r.return()}})}function Jm(n,e){if(!n)throw new Error("Iterable cannot be null");return new Fe(function(t){ln(t,e,function(){var r=n[Symbol.asyncIterator]();ln(t,e,function(){r.next().then(function(i){i.done?t.complete():t.next(i.value)})},0,!0)})})}function bA(n,e){return Jm(Km(n),e)}function Ym(n,e){if(n!=null){if(Um(n))return gA(n,e);if(ff(n))return vA(n,e);if(Dm(n))return mA(n,e);if(Fm(n))return Jm(n,e);if(Vm(n))return Hm(n,e);if(Wm(n))return bA(n,e)}throw Mm(n)}function Ir(n,e){return e?Ym(n,e):Ae(n)}function df(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Pr(n);return Ir(n,t)}function Gm(n,e){var t=Ie(n)?n:function(){return n},r=function(i){return i.error(t())};return new Fe(e?function(i){return e.schedule(r,0,i)}:r)}var Uu;(function(n){n.NEXT="N",n.ERROR="E",n.COMPLETE="C"})(Uu||(Uu={}));var va=function(){function n(e,t,r){this.kind=e,this.value=t,this.error=r,this.hasValue=e==="N"}return n.prototype.observe=function(e){return Qm(this,e)},n.prototype.do=function(e,t,r){var i=this,s=i.kind,o=i.value,a=i.error;return s==="N"?e==null?void 0:e(o):s==="E"?t==null?void 0:t(a):r==null?void 0:r()},n.prototype.accept=function(e,t,r){var i;return Ie((i=e)===null||i===void 0?void 0:i.next)?this.observe(e):this.do(e,t,r)},n.prototype.toObservable=function(){var e=this,t=e.kind,r=e.value,i=e.error,s=t==="N"?df(r):t==="E"?Gm(function(){return i}):t==="C"?yr:0;if(!s)throw new TypeError("Unexpected notification kind "+t);return s},n.createNext=function(e){return new n("N",e)},n.createError=function(e){return new n("E",void 0,e)},n.createComplete=function(){return n.completeNotification},n.completeNotification=new n("C"),n}();function Qm(n,e){var t,r,i,s=n,o=s.kind,a=s.value,c=s.error;if(typeof o!="string")throw new TypeError('Invalid notification, missing "kind"');o==="N"?(t=e.next)===null||t===void 0||t.call(e,a):o==="E"?(r=e.error)===null||r===void 0||r.call(e,c):(i=e.complete)===null||i===void 0||i.call(e)}function wA(n){return!!n&&(n instanceof Fe||Ie(n.lift)&&Ie(n.subscribe))}var ji=Ni(function(n){return function(){n(this),this.name="EmptyError",this.message="no elements in sequence"}});function kA(n,e){var t=typeof e=="object";return new Promise(function(r,i){var s=!1,o;n.subscribe({next:function(a){o=a,s=!0},error:i,complete:function(){s?r(o):t?r(e.defaultValue):i(new ji)}})})}function xA(n,e){var t=typeof e=="object";return new Promise(function(r,i){var s=new hs({next:function(o){r(o),s.unsubscribe()},error:i,complete:function(){t?r(e.defaultValue):i(new ji)}});n.subscribe(s)})}var Fu=Ni(function(n){return function(){n(this),this.name="ArgumentOutOfRangeError",this.message="argument out of range"}}),Xm=Ni(function(n){return function(e){n(this),this.name="NotFoundError",this.message=e}}),Zm=Ni(function(n){return function(e){n(this),this.name="SequenceError",this.message=e}});function pf(n){return n instanceof Date&&!isNaN(n)}var ev=Ni(function(n){return function(e){e===void 0&&(e=null),n(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=e}});function tv(n,e){var t=pf(n)?{first:n}:typeof n=="number"?{each:n}:n,r=t.first,i=t.each,s=t.with,o=s===void 0?EA:s,a=t.scheduler,c=a===void 0?e!=null?e:Un:a,l=t.meta,u=l===void 0?null:l;if(r==null&&i==null)throw new TypeError("No timeout provided.");return ye(function(h,p){var f,d,y=null,_=0,S=function(I){d=ln(p,c,function(){try{f.unsubscribe(),Ae(o({meta:u,lastValue:y,seen:_})).subscribe(p)}catch(B){p.error(B)}},I)};f=h.subscribe(he(p,function(I){d==null||d.unsubscribe(),_++,p.next(y=I),i>0&&S(i)},void 0,void 0,function(){d!=null&&d.closed||d==null||d.unsubscribe(),y=null})),!_&&S(r!=null?typeof r=="number"?r:+r-c.now():i)})}function EA(n){throw new ev(n)}function Bi(n,e){return ye(function(t,r){var i=0;t.subscribe(he(r,function(s){r.next(n.call(e,s,i++))}))})}var _A=Array.isArray;function AA(n,e){return _A(e)?n.apply(void 0,Ge([],Ye(e))):n(e)}function Li(n){return Bi(function(e){return AA(n,e)})}function Ya(n,e,t,r){if(t)if(_c(t))r=t;else return function(){for(var i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];return Ya(n,e,r).apply(this,i).pipe(Li(t))};return r?function(){for(var i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];return Ya(n,e).apply(this,i).pipe(Oc(r),Ac(r))}:function(){for(var i=this,s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];var a=new lf,c=!0;return new Fe(function(l){var u=a.subscribe(l);if(c){c=!1;var h=!1,p=!1;e.apply(i,Ge(Ge([],Ye(s)),[function(){for(var f=[],d=0;d<arguments.length;d++)f[d]=arguments[d];if(n){var y=f.shift();if(y!=null){a.error(y);return}}a.next(1<f.length?f:f[0]),p=!0,h&&a.complete()}])),p&&a.complete(),h=!0}return u})}}function OA(n,e,t){return Ya(!1,n,e,t)}function SA(n,e,t){return Ya(!0,n,e,t)}var $A=Array.isArray,TA=Object.getPrototypeOf,PA=Object.prototype,IA=Object.keys;function nv(n){if(n.length===1){var e=n[0];if($A(e))return{args:e,keys:null};if(RA(e)){var t=IA(e);return{args:t.map(function(r){return e[r]}),keys:t}}}return{args:n,keys:null}}function RA(n){return n&&typeof n=="object"&&TA(n)===PA}function rv(n,e){return n.reduce(function(t,r,i){return t[r]=e[i],t},{})}function iv(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Pr(n),r=xo(n),i=nv(n),s=i.args,o=i.keys;if(s.length===0)return Ir([],t);var a=new Fe(sv(s,t,o?function(c){return rv(o,c)}:Pt));return r?a.pipe(Li(r)):a}function sv(n,e,t){return t===void 0&&(t=Pt),function(r){Ip(e,function(){for(var i=n.length,s=new Array(i),o=i,a=i,c=function(u){Ip(e,function(){var h=Ir(n[u],e),p=!1;h.subscribe(he(r,function(f){s[u]=f,p||(p=!0,a--),a||r.next(t(s.slice()))},function(){--o||r.complete()}))},r)},l=0;l<i;l++)c(l)},r)}}function Ip(n,e,t){n?ln(t,n,e):e()}function yf(n,e,t,r,i,s,o,a){var c=[],l=0,u=0,h=!1,p=function(){h&&!c.length&&!l&&e.complete()},f=function(y){return l<r?d(y):c.push(y)},d=function(y){s&&e.next(y),l++;var _=!1;Ae(t(y,u++)).subscribe(he(e,function(S){i==null||i(S),s?f(S):e.next(S)},function(){_=!0},void 0,function(){if(_)try{l--;for(var S=function(){var I=c.shift();o?ln(e,o,function(){return d(I)}):d(I)};c.length&&l<r;)S();p()}catch(I){e.error(I)}}))};return n.subscribe(he(e,f,function(){h=!0,p()})),function(){a==null||a()}}function Yn(n,e,t){return t===void 0&&(t=1/0),Ie(e)?Yn(function(r,i){return Bi(function(s,o){return e(r,s,i,o)})(Ae(n(r,i)))},t):(typeof e=="number"&&(t=e),ye(function(r,i){return yf(r,i,n,t)}))}function Sc(n){return n===void 0&&(n=1/0),Yn(Pt,n)}function gf(){return Sc(1)}function Qs(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return gf()(Ir(n,Pr(n)))}function $c(n){return new Fe(function(e){Ae(n()).subscribe(e)})}var CA={connector:function(){return new xt},resetOnDisconnect:!0};function NA(n,e){e===void 0&&(e=CA);var t=null,r=e.connector,i=e.resetOnDisconnect,s=i===void 0?!0:i,o=r(),a=new Fe(function(c){return o.subscribe(c)});return a.connect=function(){return(!t||t.closed)&&(t=$c(function(){return n}).subscribe(o),s&&t.add(function(){return o=r()})),t},a}function jA(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=xo(n),r=nv(n),i=r.args,s=r.keys,o=new Fe(function(a){var c=i.length;if(!c){a.complete();return}for(var l=new Array(c),u=c,h=c,p=function(d){var y=!1;Ae(i[d]).subscribe(he(a,function(_){y||(y=!0,h--),l[d]=_},function(){return u--},void 0,function(){(!u||!y)&&(h||a.next(s?rv(s,l):l),a.complete())}))},f=0;f<c;f++)p(f)});return t?o.pipe(Li(t)):o}var BA=["addListener","removeListener"],LA=["addEventListener","removeEventListener"],DA=["on","off"];function Mu(n,e,t,r){if(Ie(t)&&(r=t,t=void 0),r)return Mu(n,e,t).pipe(Li(r));var i=Ye(MA(n)?LA.map(function(a){return function(c){return n[a](e,c,t)}}):UA(n)?BA.map(Rp(n,e)):FA(n)?DA.map(Rp(n,e)):[],2),s=i[0],o=i[1];if(!s&&ff(n))return Yn(function(a){return Mu(a,e,t)})(Ae(n));if(!s)throw new TypeError("Invalid event target");return new Fe(function(a){var c=function(){for(var l=[],u=0;u<arguments.length;u++)l[u]=arguments[u];return a.next(1<l.length?l:l[0])};return s(c),function(){return o(c)}})}function Rp(n,e){return function(t){return function(r){return n[t](e,r)}}}function UA(n){return Ie(n.addListener)&&Ie(n.removeListener)}function FA(n){return Ie(n.on)&&Ie(n.off)}function MA(n){return Ie(n.addEventListener)&&Ie(n.removeEventListener)}function ov(n,e,t){return t?ov(n,e).pipe(Li(t)):new Fe(function(r){var i=function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];return r.next(o.length===1?o[0]:o)},s=n(i);return Ie(e)?function(){return e(i,s)}:void 0})}function qA(n,e,t,r,i){var s,o,a,c;arguments.length===1?(s=n,c=s.initialState,e=s.condition,t=s.iterate,o=s.resultSelector,a=o===void 0?Pt:o,i=s.scheduler):(c=n,!r||_c(r)?(a=Pt,i=r):a=r);function l(){var u;return nf(this,function(h){switch(h.label){case 0:u=c,h.label=1;case 1:return!e||e(u)?[4,a(u)]:[3,4];case 2:h.sent(),h.label=3;case 3:return u=t(u),[3,1];case 4:return[2]}})}return $c(i?function(){return Hm(l(),i)}:l)}function VA(n,e,t){return $c(function(){return n()?e:t})}function Di(n,e,t){n===void 0&&(n=0),t===void 0&&(t=uf);var r=-1;return e!=null&&(_c(e)?t=e:r=e),new Fe(function(i){var s=pf(n)?+n-t.now():n;s<0&&(s=0);var o=0;return t.schedule(function(){i.closed||(i.next(o++),0<=r?this.schedule(void 0,r):i.complete())},s)})}function av(n,e){return n===void 0&&(n=0),e===void 0&&(e=Un),n<0&&(n=0),Di(n,n,e)}function KA(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Pr(n),r=Lm(n,1/0),i=n;return i.length?i.length===1?Ae(i[0]):Sc(r)(Ir(i,t)):yr}var cv=new Fe(yt);function WA(){return cv}var zA=Array.isArray;function ws(n){return n.length===1&&zA(n[0])?n[0]:n}function lv(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=ws(n);return new Fe(function(r){var i=0,s=function(){if(i<t.length){var o=void 0;try{o=Ae(t[i++])}catch(c){s();return}var a=new af(r,void 0,yt,yt);o.subscribe(a),a.add(s)}else r.complete()};s()})}function HA(n,e){return Ir(Object.entries(n),e)}function JA(n,e){return function(t,r){return!n.call(e,t,r)}}function Ii(n,e){return ye(function(t,r){var i=0;t.subscribe(he(r,function(s){return n.call(e,s,i++)&&r.next(s)}))})}function YA(n,e,t){return[Ii(e,t)(Ae(n)),Ii(JA(e,t))(Ae(n))]}function GA(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return n=ws(n),n.length===1?Ae(n[0]):new Fe(uv(n))}function uv(n){return function(e){for(var t=[],r=function(s){t.push(Ae(n[s]).subscribe(he(e,function(o){if(t){for(var a=0;a<t.length;a++)a!==s&&t[a].unsubscribe();t=null}e.next(o)})))},i=0;t&&!e.closed&&i<n.length;i++)r(i)}}function QA(n,e,t){if(e==null&&(e=n,n=0),e<=0)return yr;var r=e+n;return new Fe(t?function(i){var s=n;return t.schedule(function(){s<r?(i.next(s++),this.schedule()):i.complete()})}:function(i){for(var s=n;s<r&&!i.closed;)i.next(s++);i.complete()})}function XA(n,e){return new Fe(function(t){var r=n(),i=e(r),s=i?Ae(i):yr;return s.subscribe(t),function(){r&&r.unsubscribe()}})}function mf(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=xo(n),r=ws(n);return r.length?new Fe(function(i){var s=r.map(function(){return[]}),o=r.map(function(){return!1});i.add(function(){s=o=null});for(var a=function(l){Ae(r[l]).subscribe(he(i,function(u){if(s[l].push(u),s.every(function(p){return p.length})){var h=s.map(function(p){return p.shift()});i.next(t?t.apply(void 0,Ge([],Ye(h))):h),s.some(function(p,f){return!p.length&&o[f]})&&i.complete()}},function(){o[l]=!0,!s[l].length&&i.complete()}))},c=0;!i.closed&&c<r.length;c++)a(c);return function(){s=o=null}}):yr}function hv(n){return ye(function(e,t){var r=!1,i=null,s=null,o=!1,a=function(){if(s==null||s.unsubscribe(),s=null,r){r=!1;var l=i;i=null,t.next(l)}o&&t.complete()},c=function(){s=null,o&&t.complete()};e.subscribe(he(t,function(l){r=!0,i=l,s||Ae(n(l)).subscribe(s=he(t,a,c))},function(){o=!0,(!r||!s||s.closed)&&t.complete()}))})}function ZA(n,e){return e===void 0&&(e=Un),hv(function(){return Di(n,e)})}function eO(n){return ye(function(e,t){var r=[];return e.subscribe(he(t,function(i){return r.push(i)},function(){t.next(r),t.complete()})),Ae(n).subscribe(he(t,function(){var i=r;r=[],t.next(i)},yt)),function(){r=null}})}function tO(n,e){return e===void 0&&(e=null),e=e!=null?e:n,ye(function(t,r){var i=[],s=0;t.subscribe(he(r,function(o){var a,c,l,u,h=null;s++%e===0&&i.push([]);try{for(var p=cn(i),f=p.next();!f.done;f=p.next()){var d=f.value;d.push(o),n<=d.length&&(h=h!=null?h:[],h.push(d))}}catch(S){a={error:S}}finally{try{f&&!f.done&&(c=p.return)&&c.call(p)}finally{if(a)throw a.error}}if(h)try{for(var y=cn(h),_=y.next();!_.done;_=y.next()){var d=_.value;Sr(i,d),r.next(d)}}catch(S){l={error:S}}finally{try{_&&!_.done&&(u=y.return)&&u.call(y)}finally{if(l)throw l.error}}},function(){var o,a;try{for(var c=cn(i),l=c.next();!l.done;l=c.next()){var u=l.value;r.next(u)}}catch(h){o={error:h}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(o)throw o.error}}r.complete()},void 0,function(){i=null}))})}function nO(n){for(var e,t,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];var s=(e=Pr(r))!==null&&e!==void 0?e:Un,o=(t=r[0])!==null&&t!==void 0?t:null,a=r[1]||1/0;return ye(function(c,l){var u=[],h=!1,p=function(y){var _=y.buffer,S=y.subs;S.unsubscribe(),Sr(u,y),l.next(_),h&&f()},f=function(){if(u){var y=new pn;l.add(y);var _=[],S={buffer:_,subs:y};u.push(S),ln(y,s,function(){return p(S)},n)}};o!==null&&o>=0?ln(l,s,f,o,!0):h=!0,f();var d=he(l,function(y){var _,S,I=u.slice();try{for(var B=cn(I),j=B.next();!j.done;j=B.next()){var U=j.value,M=U.buffer;M.push(y),a<=M.length&&p(U)}}catch(H){_={error:H}}finally{try{j&&!j.done&&(S=B.return)&&S.call(B)}finally{if(_)throw _.error}}},function(){for(;u!=null&&u.length;)l.next(u.shift().buffer);d==null||d.unsubscribe(),l.complete(),l.unsubscribe()},void 0,function(){return u=null});c.subscribe(d)})}function rO(n,e){return ye(function(t,r){var i=[];Ae(n).subscribe(he(r,function(s){var o=[];i.push(o);var a=new pn,c=function(){Sr(i,o),r.next(o),a.unsubscribe()};a.add(Ae(e(s)).subscribe(he(r,c,yt)))},yt)),t.subscribe(he(r,function(s){var o,a;try{for(var c=cn(i),l=c.next();!l.done;l=c.next()){var u=l.value;u.push(s)}}catch(h){o={error:h}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(o)throw o.error}}},function(){for(;i.length>0;)r.next(i.shift());r.complete()}))})}function iO(n){return ye(function(e,t){var r=null,i=null,s=function(){i==null||i.unsubscribe();var o=r;r=[],o&&t.next(o),Ae(n()).subscribe(i=he(t,s,yt))};s(),e.subscribe(he(t,function(o){return r==null?void 0:r.push(o)},function(){r&&t.next(r),t.complete()},void 0,function(){return r=i=null}))})}function fv(n){return ye(function(e,t){var r=null,i=!1,s;r=e.subscribe(he(t,void 0,void 0,function(o){s=Ae(n(o,fv(n)(e))),r?(r.unsubscribe(),r=null,s.subscribe(t)):i=!0})),i&&(r.unsubscribe(),r=null,s.subscribe(t))})}function dv(n,e,t,r,i){return function(s,o){var a=t,c=e,l=0;s.subscribe(he(o,function(u){var h=l++;c=a?n(c,u,h):(a=!0,u),r&&o.next(c)},i&&function(){a&&o.next(c),o.complete()}))}}function Eo(n,e){return ye(dv(n,e,arguments.length>=2,!1,!0))}var sO=function(n,e){return n.push(e),n};function pv(){return ye(function(n,e){Eo(sO,[])(n).subscribe(e)})}function yv(n,e){return of(pv(),Yn(function(t){return n(t)}),e?Li(e):Pt)}function gv(n){return yv(iv,n)}var oO=gv;function mv(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=xo(n);return t?of(mv.apply(void 0,Ge([],Ye(n))),Li(t)):ye(function(r,i){sv(Ge([r],Ye(ws(n))))(i)})}function aO(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return mv.apply(void 0,Ge([],Ye(n)))}function qu(n,e){return Ie(e)?Yn(n,e,1):Yn(n,1)}function cO(n,e){return Ie(e)?qu(function(){return n},e):qu(function(){return n})}function lO(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Pr(n);return ye(function(r,i){gf()(Ir(Ge([r],Ye(n)),t)).subscribe(i)})}function uO(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return lO.apply(void 0,Ge([],Ye(n)))}function hO(n){return new Fe(function(e){return n.subscribe(e)})}var fO={connector:function(){return new xt}};function vf(n,e){e===void 0&&(e=fO);var t=e.connector;return ye(function(r,i){var s=t();Ae(n(hO(s))).subscribe(i),i.add(r.subscribe(s))})}function dO(n){return Eo(function(e,t,r){return!n||n(t,r)?e+1:e},0)}function pO(n){return ye(function(e,t){var r=!1,i=null,s=null,o=function(){if(s==null||s.unsubscribe(),s=null,r){r=!1;var a=i;i=null,t.next(a)}};e.subscribe(he(t,function(a){s==null||s.unsubscribe(),r=!0,i=a,s=he(t,o,yt),Ae(n(a)).subscribe(s)},function(){o(),t.complete()},void 0,function(){i=s=null}))})}function yO(n,e){return e===void 0&&(e=Un),ye(function(t,r){var i=null,s=null,o=null,a=function(){if(i){i.unsubscribe(),i=null;var l=s;s=null,r.next(l)}};function c(){var l=o+n,u=e.now();if(u<l){i=this.schedule(void 0,l-u),r.add(i);return}a()}t.subscribe(he(r,function(l){s=l,o=e.now(),i||(i=e.schedule(c,n),r.add(i))},function(){a(),r.complete()},void 0,function(){s=i=null}))})}function Tc(n){return ye(function(e,t){var r=!1;e.subscribe(he(t,function(i){r=!0,t.next(i)},function(){r||t.next(n),t.complete()}))})}function Xs(n){return n<=0?function(){return yr}:ye(function(e,t){var r=0;e.subscribe(he(t,function(i){++r<=n&&(t.next(i),n<=r&&t.complete())}))})}function vv(){return ye(function(n,e){n.subscribe(he(e,yt))})}function bv(n){return Bi(function(){return n})}function bf(n,e){return e?function(t){return Qs(e.pipe(Xs(1),vv()),t.pipe(bf(n)))}:Yn(function(t,r){return Ae(n(t,r)).pipe(Xs(1),bv(t))})}function gO(n,e){e===void 0&&(e=Un);var t=Di(n,e);return bf(function(){return t})}function mO(){return ye(function(n,e){n.subscribe(he(e,function(t){return Qm(t,e)}))})}function vO(n,e){return ye(function(t,r){var i=new Set;t.subscribe(he(r,function(s){var o=n?n(s):s;i.has(o)||(i.add(o),r.next(s))})),e&&Ae(e).subscribe(he(r,function(){return i.clear()},yt))})}function wv(n,e){return e===void 0&&(e=Pt),n=n!=null?n:bO,ye(function(t,r){var i,s=!0;t.subscribe(he(r,function(o){var a=e(o);(s||!n(i,a))&&(s=!1,i=a,r.next(o))}))})}function bO(n,e){return n===e}function wO(n,e){return wv(function(t,r){return e?e(t[n],r[n]):t[n]===r[n]})}function Pc(n){return n===void 0&&(n=kO),ye(function(e,t){var r=!1;e.subscribe(he(t,function(i){r=!0,t.next(i)},function(){return r?t.complete():t.error(n())}))})}function kO(){return new ji}function xO(n,e){if(n<0)throw new Fu;var t=arguments.length>=2;return function(r){return r.pipe(Ii(function(i,s){return s===n}),Xs(1),t?Tc(e):Pc(function(){return new Fu}))}}function EO(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return function(t){return Qs(t,df.apply(void 0,Ge([],Ye(n))))}}function _O(n,e){return ye(function(t,r){var i=0;t.subscribe(he(r,function(s){n.call(e,s,i++,t)||(r.next(!1),r.complete())},function(){r.next(!0),r.complete()}))})}function wf(n,e){return e?function(t){return t.pipe(wf(function(r,i){return Ae(n(r,i)).pipe(Bi(function(s,o){return e(r,s,i,o)}))}))}:ye(function(t,r){var i=0,s=null,o=!1;t.subscribe(he(r,function(a){s||(s=he(r,void 0,function(){s=null,o&&r.complete()}),Ae(n(a,i++)).subscribe(s))},function(){o=!0,!s&&r.complete()}))})}function kv(){return wf(Pt)}var AO=kv;function OO(n,e,t){return e===void 0&&(e=1/0),e=(e||0)<1?1/0:e,ye(function(r,i){return yf(r,i,n,e,void 0,!0,t)})}function SO(n){return ye(function(e,t){try{e.subscribe(t)}finally{t.add(n)}})}function $O(n,e){return ye(xv(n,e,"value"))}function xv(n,e,t){var r=t==="index";return function(i,s){var o=0;i.subscribe(he(s,function(a){var c=o++;n.call(e,a,c,i)&&(s.next(r?c:a),s.complete())},function(){s.next(r?-1:void 0),s.complete()}))}}function TO(n,e){return ye(xv(n,e,"index"))}function PO(n,e){var t=arguments.length>=2;return function(r){return r.pipe(n?Ii(function(i,s){return n(i,s,r)}):Pt,Xs(1),t?Tc(e):Pc(function(){return new ji}))}}function IO(n,e,t,r){return ye(function(i,s){var o;!e||typeof e=="function"?o=e:(t=e.duration,o=e.element,r=e.connector);var a=new Map,c=function(d){a.forEach(d),d(s)},l=function(d){return c(function(y){return y.error(d)})},u=0,h=!1,p=new af(s,function(d){try{var y=n(d),_=a.get(y);if(!_){a.set(y,_=r?r():new xt);var S=f(y,_);if(s.next(S),t){var I=he(_,function(){_.complete(),I==null||I.unsubscribe()},void 0,void 0,function(){return a.delete(y)});p.add(Ae(t(S)).subscribe(I))}}_.next(o?o(d):d)}catch(B){l(B)}},function(){return c(function(d){return d.complete()})},l,function(){return a.clear()},function(){return h=!0,u===0});i.subscribe(p);function f(d,y){var _=new Fe(function(S){u++;var I=y.subscribe(S);return function(){I.unsubscribe(),--u===0&&h&&p.unsubscribe()}});return _.key=d,_}})}function RO(){return ye(function(n,e){n.subscribe(he(e,function(){e.next(!1),e.complete()},function(){e.next(!0),e.complete()}))})}function Ev(n){return n<=0?function(){return yr}:ye(function(e,t){var r=[];e.subscribe(he(t,function(i){r.push(i),n<r.length&&r.shift()},function(){var i,s;try{for(var o=cn(r),a=o.next();!a.done;a=o.next()){var c=a.value;t.next(c)}}catch(l){i={error:l}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}t.complete()},void 0,function(){r=null}))})}function CO(n,e){var t=arguments.length>=2;return function(r){return r.pipe(n?Ii(function(i,s){return n(i,s,r)}):Pt,Ev(1),t?Tc(e):Pc(function(){return new ji}))}}function NO(){return ye(function(n,e){n.subscribe(he(e,function(t){e.next(va.createNext(t))},function(){e.next(va.createComplete()),e.complete()},function(t){e.next(va.createError(t)),e.complete()}))})}function jO(n){return Eo(Ie(n)?function(e,t){return n(e,t)>0?e:t}:function(e,t){return e>t?e:t})}var BO=Yn;function LO(n,e,t){return t===void 0&&(t=1/0),Ie(e)?Yn(function(){return n},e,t):(typeof e=="number"&&(t=e),Yn(function(){return n},t))}function DO(n,e,t){return t===void 0&&(t=1/0),ye(function(r,i){var s=e;return yf(r,i,function(o,a){return n(s,o,a)},t,function(o){s=o},!1,void 0,function(){return s=null})})}function UO(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Pr(n),r=Lm(n,1/0);return n=ws(n),ye(function(i,s){Sc(r)(Ir(Ge([i],Ye(n)),t)).subscribe(s)})}function FO(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return UO.apply(void 0,Ge([],Ye(n)))}function MO(n){return Eo(Ie(n)?function(e,t){return n(e,t)<0?e:t}:function(e,t){return e<t?e:t})}function kf(n,e){var t=Ie(n)?n:function(){return n};return Ie(e)?vf(e,{connector:t}):function(r){return new xc(r,t)}}function qO(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=ws(n);return function(r){return lv.apply(void 0,Ge([r],Ye(t)))}}function VO(){return ye(function(n,e){var t,r=!1;n.subscribe(he(e,function(i){var s=t;t=i,r&&e.next([s,i]),r=!0}))})}function KO(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=n.length;if(t===0)throw new Error("list of properties cannot be empty.");return Bi(function(r){for(var i=r,s=0;s<t;s++){var o=i==null?void 0:i[n[s]];if(typeof o!="undefined")i=o;else return}return i})}function WO(n){return n?function(e){return vf(n)(e)}:function(e){return kf(new xt)(e)}}function zO(n){return function(e){var t=new Im(n);return new xc(e,function(){return t})}}function HO(){return function(n){var e=new lf;return new xc(n,function(){return e})}}function JO(n,e,t,r){t&&!Ie(t)&&(r=t);var i=Ie(t)?t:void 0;return function(s){return kf(new cf(n,e,r),i)(s)}}function YO(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return n.length?ye(function(t,r){uv(Ge([t],Ye(n)))(r)}):Pt}function GO(n){var e,t=1/0,r;return n!=null&&(typeof n=="object"?(e=n.count,t=e===void 0?1/0:e,r=n.delay):t=n),t<=0?function(){return yr}:ye(function(i,s){var o=0,a,c=function(){if(a==null||a.unsubscribe(),a=null,r!=null){var u=typeof r=="number"?Di(r):Ae(r(o)),h=he(s,function(){h.unsubscribe(),l()});u.subscribe(h)}else l()},l=function(){var u=!1;a=i.subscribe(he(s,void 0,function(){++o<t?a?c():u=!0:s.complete()})),u&&c()};l()})}function QO(n){return ye(function(e,t){var r,i=!1,s,o=!1,a=!1,c=function(){return a&&o&&(t.complete(),!0)},l=function(){return s||(s=new xt,Ae(n(s)).subscribe(he(t,function(){r?u():i=!0},function(){o=!0,c()}))),s},u=function(){a=!1,r=e.subscribe(he(t,void 0,function(){a=!0,!c()&&l().next()})),i&&(r.unsubscribe(),r=null,i=!1,u())};u()})}function XO(n){n===void 0&&(n=1/0);var e;n&&typeof n=="object"?e=n:e={count:n};var t=e.count,r=t===void 0?1/0:t,i=e.delay,s=e.resetOnSuccess,o=s===void 0?!1:s;return r<=0?Pt:ye(function(a,c){var l=0,u,h=function(){var p=!1;u=a.subscribe(he(c,function(f){o&&(l=0),c.next(f)},void 0,function(f){if(l++<r){var d=function(){u?(u.unsubscribe(),u=null,h()):p=!0};if(i!=null){var y=typeof i=="number"?Di(i):Ae(i(f,l)),_=he(c,function(){_.unsubscribe(),d()},function(){c.complete()});y.subscribe(_)}else d()}else c.error(f)})),p&&(u.unsubscribe(),u=null,h())};h()})}function ZO(n){return ye(function(e,t){var r,i=!1,s,o=function(){r=e.subscribe(he(t,void 0,void 0,function(a){s||(s=new xt,Ae(n(s)).subscribe(he(t,function(){return r?o():i=!0}))),s&&s.next(a)})),i&&(r.unsubscribe(),r=null,i=!1,o())};o()})}function _v(n){return ye(function(e,t){var r=!1,i=null;e.subscribe(he(t,function(s){r=!0,i=s})),Ae(n).subscribe(he(t,function(){if(r){r=!1;var s=i;i=null,t.next(s)}},yt))})}function eS(n,e){return e===void 0&&(e=Un),_v(av(n,e))}function tS(n,e){return ye(dv(n,e,arguments.length>=2,!0))}function nS(n,e){return e===void 0&&(e=function(t,r){return t===r}),ye(function(t,r){var i=Cp(),s=Cp(),o=function(c){r.next(c),r.complete()},a=function(c,l){var u=he(r,function(h){var p=l.buffer,f=l.complete;p.length===0?f?o(!1):c.buffer.push(h):!e(h,p.shift())&&o(!1)},function(){c.complete=!0;var h=l.complete,p=l.buffer;h&&o(p.length===0),u==null||u.unsubscribe()});return u};t.subscribe(a(i,s)),Ae(n).subscribe(a(s,i))})}function Cp(){return{buffer:[],complete:!1}}function Av(n){n===void 0&&(n={});var e=n.connector,t=e===void 0?function(){return new xt}:e,r=n.resetOnError,i=r===void 0?!0:r,s=n.resetOnComplete,o=s===void 0?!0:s,a=n.resetOnRefCountZero,c=a===void 0?!0:a;return function(l){var u,h,p,f=0,d=!1,y=!1,_=function(){h==null||h.unsubscribe(),h=void 0},S=function(){_(),u=p=void 0,d=y=!1},I=function(){var B=u;S(),B==null||B.unsubscribe()};return ye(function(B,j){f++,!y&&!d&&_();var U=p=p!=null?p:t();j.add(function(){f--,f===0&&!y&&!d&&(h=Cl(I,c))}),U.subscribe(j),!u&&f>0&&(u=new hs({next:function(M){return U.next(M)},error:function(M){y=!0,_(),h=Cl(S,i,M),U.error(M)},complete:function(){d=!0,_(),h=Cl(S,o),U.complete()}}),Ae(B).subscribe(u))})(l)}}function Cl(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];if(e===!0){n();return}if(e!==!1){var i=new hs({next:function(){i.unsubscribe(),n()}});return Ae(e.apply(void 0,Ge([],Ye(t)))).subscribe(i)}}function rS(n,e,t){var r,i,s,o,a=!1;return n&&typeof n=="object"?(r=n.bufferSize,o=r===void 0?1/0:r,i=n.windowTime,e=i===void 0?1/0:i,s=n.refCount,a=s===void 0?!1:s,t=n.scheduler):o=n!=null?n:1/0,Av({connector:function(){return new cf(o,e,t)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:a})}function iS(n){return ye(function(e,t){var r=!1,i,s=!1,o=0;e.subscribe(he(t,function(a){s=!0,(!n||n(a,o++,e))&&(r&&t.error(new Zm("Too many matching values")),r=!0,i=a)},function(){r?(t.next(i),t.complete()):t.error(s?new Xm("No matching values"):new ji)}))})}function sS(n){return Ii(function(e,t){return n<=t})}function oS(n){return n<=0?Pt:ye(function(e,t){var r=new Array(n),i=0;return e.subscribe(he(t,function(s){var o=i++;if(o<n)r[o]=s;else{var a=o%n,c=r[a];r[a]=s,t.next(c)}})),function(){r=null}})}function aS(n){return ye(function(e,t){var r=!1,i=he(t,function(){i==null||i.unsubscribe(),r=!0},yt);Ae(n).subscribe(i),e.subscribe(he(t,function(s){return r&&t.next(s)}))})}function cS(n){return ye(function(e,t){var r=!1,i=0;e.subscribe(he(t,function(s){return(r||(r=!n(s,i++)))&&t.next(s)}))})}function lS(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Pr(n);return ye(function(r,i){(t?Qs(n,r,t):Qs(n,r)).subscribe(i)})}function Zs(n,e){return ye(function(t,r){var i=null,s=0,o=!1,a=function(){return o&&!i&&r.complete()};t.subscribe(he(r,function(c){i==null||i.unsubscribe();var l=0,u=s++;Ae(n(c,u)).subscribe(i=he(r,function(h){return r.next(e?e(c,h,u,l++):h)},function(){i=null,a()}))},function(){o=!0,a()}))})}function uS(){return Zs(Pt)}function hS(n,e){return Ie(e)?Zs(function(){return n},e):Zs(function(){return n})}function fS(n,e){return ye(function(t,r){var i=e;return Zs(function(s,o){return n(i,s,o)},function(s,o){return i=o,o})(t).subscribe(r),function(){i=null}})}function dS(n){return ye(function(e,t){Ae(n).subscribe(he(t,function(){return t.complete()},yt)),!t.closed&&e.subscribe(t)})}function pS(n,e){return e===void 0&&(e=!1),ye(function(t,r){var i=0;t.subscribe(he(r,function(s){var o=n(s,i++);(o||e)&&r.next(s),!o&&r.complete()}))})}function yS(n,e,t){var r=Ie(n)||e||t?{next:n,error:e,complete:t}:n;return r?ye(function(i,s){var o;(o=r.subscribe)===null||o===void 0||o.call(r);var a=!0;i.subscribe(he(s,function(c){var l;(l=r.next)===null||l===void 0||l.call(r,c),s.next(c)},function(){var c;a=!1,(c=r.complete)===null||c===void 0||c.call(r),s.complete()},function(c){var l;a=!1,(l=r.error)===null||l===void 0||l.call(r,c),s.error(c)},function(){var c,l;a&&((c=r.unsubscribe)===null||c===void 0||c.call(r)),(l=r.finalize)===null||l===void 0||l.call(r)}))}):Pt}function Ov(n,e){return ye(function(t,r){var i=e!=null?e:{},s=i.leading,o=s===void 0?!0:s,a=i.trailing,c=a===void 0?!1:a,l=!1,u=null,h=null,p=!1,f=function(){h==null||h.unsubscribe(),h=null,c&&(_(),p&&r.complete())},d=function(){h=null,p&&r.complete()},y=function(S){return h=Ae(n(S)).subscribe(he(r,f,d))},_=function(){if(l){l=!1;var S=u;u=null,r.next(S),!p&&y(S)}};t.subscribe(he(r,function(S){l=!0,u=S,!(h&&!h.closed)&&(o?_():y(S))},function(){p=!0,!(c&&l&&h&&!h.closed)&&r.complete()}))})}function gS(n,e,t){e===void 0&&(e=Un);var r=Di(n,e);return Ov(function(){return r},t)}function mS(n){return n===void 0&&(n=Un),ye(function(e,t){var r=n.now();e.subscribe(he(t,function(i){var s=n.now(),o=s-r;r=s,t.next(new vS(i,o))}))})}var vS=function(){function n(e,t){this.value=e,this.interval=t}return n}();function bS(n,e,t){var r,i,s;if(t=t!=null?t:uf,pf(n)?r=n:typeof n=="number"&&(i=n),e)s=function(){return e};else throw new TypeError("No observable provided to switch to");if(r==null&&i==null)throw new TypeError("No timeout provided.");return tv({first:r,each:i,scheduler:t,with:s})}function wS(n){return n===void 0&&(n=Ec),Bi(function(e){return{value:e,timestamp:n.now()}})}function kS(n){return ye(function(e,t){var r=new xt;t.next(r.asObservable());var i=function(s){r.error(s),t.error(s)};return e.subscribe(he(t,function(s){return r==null?void 0:r.next(s)},function(){r.complete(),t.complete()},i)),Ae(n).subscribe(he(t,function(){r.complete(),t.next(r=new xt)},yt,i)),function(){r==null||r.unsubscribe(),r=null}})}function xS(n,e){e===void 0&&(e=0);var t=e>0?e:n;return ye(function(r,i){var s=[new xt],o=[],a=0;i.next(s[0].asObservable()),r.subscribe(he(i,function(c){var l,u;try{for(var h=cn(s),p=h.next();!p.done;p=h.next()){var f=p.value;f.next(c)}}catch(_){l={error:_}}finally{try{p&&!p.done&&(u=h.return)&&u.call(h)}finally{if(l)throw l.error}}var d=a-n+1;if(d>=0&&d%t===0&&s.shift().complete(),++a%t===0){var y=new xt;s.push(y),i.next(y.asObservable())}},function(){for(;s.length>0;)s.shift().complete();i.complete()},function(c){for(;s.length>0;)s.shift().error(c);i.error(c)},function(){o=null,s=null}))})}function ES(n){for(var e,t,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];var s=(e=Pr(r))!==null&&e!==void 0?e:Un,o=(t=r[0])!==null&&t!==void 0?t:null,a=r[1]||1/0;return ye(function(c,l){var u=[],h=!1,p=function(_){var S=_.window,I=_.subs;S.complete(),I.unsubscribe(),Sr(u,_),h&&f()},f=function(){if(u){var _=new pn;l.add(_);var S=new xt,I={window:S,subs:_,seen:0};u.push(I),l.next(S.asObservable()),ln(_,s,function(){return p(I)},n)}};o!==null&&o>=0?ln(l,s,f,o,!0):h=!0,f();var d=function(_){return u.slice().forEach(_)},y=function(_){d(function(S){var I=S.window;return _(I)}),_(l),l.unsubscribe()};return c.subscribe(he(l,function(_){d(function(S){S.window.next(_),a<=++S.seen&&p(S)})},function(){return y(function(_){return _.complete()})},function(_){return y(function(S){return S.error(_)})})),function(){u=null}})}function _S(n,e){return ye(function(t,r){var i=[],s=function(o){for(;0<i.length;)i.shift().error(o);r.error(o)};Ae(n).subscribe(he(r,function(o){var a=new xt;i.push(a);var c=new pn,l=function(){Sr(i,a),a.complete(),c.unsubscribe()},u;try{u=Ae(e(o))}catch(h){s(h);return}r.next(a.asObservable()),c.add(u.subscribe(he(r,l,yt,s)))},yt)),t.subscribe(he(r,function(o){var a,c,l=i.slice();try{for(var u=cn(l),h=u.next();!h.done;h=u.next()){var p=h.value;p.next(o)}}catch(f){a={error:f}}finally{try{h&&!h.done&&(c=u.return)&&c.call(u)}finally{if(a)throw a.error}}},function(){for(;0<i.length;)i.shift().complete();r.complete()},s,function(){for(;0<i.length;)i.shift().unsubscribe()}))})}function AS(n){return ye(function(e,t){var r,i,s=function(a){r.error(a),t.error(a)},o=function(){i==null||i.unsubscribe(),r==null||r.complete(),r=new xt,t.next(r.asObservable());var a;try{a=Ae(n())}catch(c){s(c);return}a.subscribe(i=he(t,o,o,s))};o(),e.subscribe(he(t,function(a){return r.next(a)},function(){r.complete(),t.complete()},s,function(){i==null||i.unsubscribe(),r=null}))})}function OS(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=xo(n);return ye(function(r,i){for(var s=n.length,o=new Array(s),a=n.map(function(){return!1}),c=!1,l=function(h){Ae(n[h]).subscribe(he(i,function(p){o[h]=p,!c&&!a[h]&&(a[h]=!0,(c=a.every(Pt))&&(a=null))},yt))},u=0;u<s;u++)l(u);r.subscribe(he(i,function(h){if(c){var p=Ge([h],Ye(o));i.next(t?t.apply(void 0,Ge([],Ye(p))):p)}}))})}function SS(n){return yv(mf,n)}function $S(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return ye(function(t,r){mf.apply(void 0,Ge([t],Ye(n))).subscribe(r)})}function TS(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return $S.apply(void 0,Ge([],Ye(n)))}const PS=Object.freeze(Object.defineProperty({__proto__:null,Observable:Fe,ConnectableObservable:xc,observable:kc,animationFrames:W_,Subject:xt,BehaviorSubject:Im,ReplaySubject:cf,AsyncSubject:lf,asap:Z_,asapScheduler:Cm,async:uf,asyncScheduler:Un,queue:nA,queueScheduler:Nm,animationFrame:sA,animationFrameScheduler:jm,VirtualTimeScheduler:oA,VirtualAction:Bm,Scheduler:Du,Subscription:pn,Subscriber:wc,Notification:va,get NotificationKind(){return Uu},pipe:of,noop:yt,identity:Pt,isObservable:wA,lastValueFrom:kA,firstValueFrom:xA,ArgumentOutOfRangeError:Fu,EmptyError:ji,NotFoundError:Xm,ObjectUnsubscribedError:Pm,SequenceError:Zm,TimeoutError:ev,UnsubscriptionError:ga,bindCallback:OA,bindNodeCallback:SA,combineLatest:iv,concat:Qs,connectable:NA,defer:$c,empty:aA,forkJoin:jA,from:Ir,fromEvent:Mu,fromEventPattern:ov,generate:qA,iif:VA,interval:av,merge:KA,never:WA,of:df,onErrorResumeNext:lv,pairs:HA,partition:YA,race:GA,range:QA,throwError:Gm,timer:Di,using:XA,zip:mf,scheduled:Ym,EMPTY:yr,NEVER:cv,config:pi,audit:hv,auditTime:ZA,buffer:eO,bufferCount:tO,bufferTime:nO,bufferToggle:rO,bufferWhen:iO,catchError:fv,combineAll:oO,combineLatestAll:gv,combineLatestWith:aO,concatAll:gf,concatMap:qu,concatMapTo:cO,concatWith:uO,connect:vf,count:dO,debounce:pO,debounceTime:yO,defaultIfEmpty:Tc,delay:gO,delayWhen:bf,dematerialize:mO,distinct:vO,distinctUntilChanged:wv,distinctUntilKeyChanged:wO,elementAt:xO,endWith:EO,every:_O,exhaust:AO,exhaustAll:kv,exhaustMap:wf,expand:OO,filter:Ii,finalize:SO,find:$O,findIndex:TO,first:PO,groupBy:IO,ignoreElements:vv,isEmpty:RO,last:CO,map:Bi,mapTo:bv,materialize:NO,max:jO,mergeAll:Sc,flatMap:BO,mergeMap:Yn,mergeMapTo:LO,mergeScan:DO,mergeWith:FO,min:MO,multicast:kf,observeOn:Ac,onErrorResumeNextWith:qO,pairwise:VO,pluck:KO,publish:WO,publishBehavior:zO,publishLast:HO,publishReplay:JO,raceWith:YO,reduce:Eo,repeat:GO,repeatWhen:QO,retry:XO,retryWhen:ZO,refCount:Sm,sample:_v,sampleTime:eS,scan:tS,sequenceEqual:nS,share:Av,shareReplay:rS,single:iS,skip:sS,skipLast:oS,skipUntil:aS,skipWhile:cS,startWith:lS,subscribeOn:Oc,switchAll:uS,switchMap:Zs,switchMapTo:hS,switchScan:fS,take:Xs,takeLast:Ev,takeUntil:dS,takeWhile:pS,tap:yS,throttle:Ov,throttleTime:gS,throwIfEmpty:Pc,timeInterval:mS,timeout:tv,timeoutWith:bS,timestamp:wS,toArray:pv,window:kS,windowCount:xS,windowTime:ES,windowToggle:_S,windowWhen:AS,withLatestFrom:OS,zipAll:SS,zipWith:TS},Symbol.toStringTag,{value:"Module"}));var IS=Object.defineProperty,RS=Object.defineProperties,CS=Object.getOwnPropertyDescriptors,Np=Object.getOwnPropertySymbols,NS=Object.prototype.hasOwnProperty,jS=Object.prototype.propertyIsEnumerable,Vu=(n,e,t)=>e in n?IS(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,se=(n,e)=>{for(var t in e||(e={}))NS.call(e,t)&&Vu(n,t,e[t]);if(Np)for(var t of Np(e))jS.call(e,t)&&Vu(n,t,e[t]);return n},nt=(n,e)=>RS(n,CS(e)),BS=(n,e,t)=>(Vu(n,typeof e!="symbol"?e+"":e,t),t),Sv=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)},we=(n,e,t)=>(Sv(n,e,"read from private field"),t?t.call(n):e.get(n)),wn=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)},er=(n,e,t,r)=>(Sv(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t),W=(n,e,t)=>new Promise((r,i)=>{var s=c=>{try{a(t.next(c))}catch(l){i(l)}},o=c=>{try{a(t.throw(c))}catch(l){i(l)}},a=c=>c.done?r(c.value):Promise.resolve(c.value).then(s,o);a((t=t.apply(n,e)).next())});const fr=Object.create(null);fr.open="0";fr.close="1";fr.ping="2";fr.pong="3";fr.message="4";fr.upgrade="5";fr.noop="6";const ba=Object.create(null);Object.keys(fr).forEach(n=>{ba[fr[n]]=n});const LS={type:"error",data:"parser error"},DS=typeof Blob=="function"||typeof Blob!="undefined"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",US=typeof ArrayBuffer=="function",FS=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n&&n.buffer instanceof ArrayBuffer,$v=({type:n,data:e},t,r)=>DS&&e instanceof Blob?t?r(e):jp(e,r):US&&(e instanceof ArrayBuffer||FS(e))?t?r(e):jp(new Blob([e]),r):r(fr[n]+(e||"")),jp=(n,e)=>{const t=new FileReader;return t.onload=function(){const r=t.result.split(",")[1];e("b"+(r||""))},t.readAsDataURL(n)},Bp="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ms=typeof Uint8Array=="undefined"?[]:new Uint8Array(256);for(let n=0;n<Bp.length;n++)Ms[Bp.charCodeAt(n)]=n;const MS=n=>{let e=n.length*.75,t=n.length,r,i=0,s,o,a,c;n[n.length-1]==="="&&(e--,n[n.length-2]==="="&&e--);const l=new ArrayBuffer(e),u=new Uint8Array(l);for(r=0;r<t;r+=4)s=Ms[n.charCodeAt(r)],o=Ms[n.charCodeAt(r+1)],a=Ms[n.charCodeAt(r+2)],c=Ms[n.charCodeAt(r+3)],u[i++]=s<<2|o>>4,u[i++]=(o&15)<<4|a>>2,u[i++]=(a&3)<<6|c&63;return l},qS=typeof ArrayBuffer=="function",Tv=(n,e)=>{if(typeof n!="string")return{type:"message",data:Pv(n,e)};const t=n.charAt(0);return t==="b"?{type:"message",data:VS(n.substring(1),e)}:ba[t]?n.length>1?{type:ba[t],data:n.substring(1)}:{type:ba[t]}:LS},VS=(n,e)=>{if(qS){const t=MS(n);return Pv(t,e)}else return{base64:!0,data:n}},Pv=(n,e)=>{switch(e){case"blob":return n instanceof ArrayBuffer?new Blob([n]):n;case"arraybuffer":default:return n}},Iv=String.fromCharCode(30),KS=(n,e)=>{const t=n.length,r=new Array(t);let i=0;n.forEach((s,o)=>{$v(s,!1,a=>{r[o]=a,++i===t&&e(r.join(Iv))})})},WS=(n,e)=>{const t=n.split(Iv),r=[];for(let i=0;i<t.length;i++){const s=Tv(t[i],e);if(r.push(s),s.type==="error")break}return r},Rv=4;function dt(n){if(n)return zS(n)}function zS(n){for(var e in dt.prototype)n[e]=dt.prototype[e];return n}dt.prototype.on=dt.prototype.addEventListener=function(n,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+n]=this._callbacks["$"+n]||[]).push(e),this};dt.prototype.once=function(n,e){function t(){this.off(n,t),e.apply(this,arguments)}return t.fn=e,this.on(n,t),this};dt.prototype.off=dt.prototype.removeListener=dt.prototype.removeAllListeners=dt.prototype.removeEventListener=function(n,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+n];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+n],this;for(var r,i=0;i<t.length;i++)if(r=t[i],r===e||r.fn===e){t.splice(i,1);break}return t.length===0&&delete this._callbacks["$"+n],this};dt.prototype.emit=function(n){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+n],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(t){t=t.slice(0);for(var r=0,i=t.length;r<i;++r)t[r].apply(this,e)}return this};dt.prototype.emitReserved=dt.prototype.emit;dt.prototype.listeners=function(n){return this._callbacks=this._callbacks||{},this._callbacks["$"+n]||[]};dt.prototype.hasListeners=function(n){return!!this.listeners(n).length};const Nn=(()=>typeof self!="undefined"?self:typeof window!="undefined"?window:Function("return this")())();function Cv(n,...e){return e.reduce((t,r)=>(n.hasOwnProperty(r)&&(t[r]=n[r]),t),{})}const HS=Nn.setTimeout,JS=Nn.clearTimeout;function Ic(n,e){e.useNativeTimers?(n.setTimeoutFn=HS.bind(Nn),n.clearTimeoutFn=JS.bind(Nn)):(n.setTimeoutFn=Nn.setTimeout.bind(Nn),n.clearTimeoutFn=Nn.clearTimeout.bind(Nn))}const YS=1.33;function GS(n){return typeof n=="string"?QS(n):Math.ceil((n.byteLength||n.size)*YS)}function QS(n){let e=0,t=0;for(let r=0,i=n.length;r<i;r++)e=n.charCodeAt(r),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(r++,t+=4);return t}class XS extends Error{constructor(e,t,r){super(e),this.description=t,this.context=r,this.type="TransportError"}}class Nv extends dt{constructor(e){super(),this.writable=!1,Ic(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,r){return super.emitReserved("error",new XS(e,t,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=Tv(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}}const jv="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Ku=64,ZS={};let Lp=0,zo=0,Dp;function Up(n){let e="";do e=jv[n%Ku]+e,n=Math.floor(n/Ku);while(n>0);return e}function Bv(){const n=Up(+new Date);return n!==Dp?(Lp=0,Dp=n):n+"."+Up(Lp++)}for(;zo<Ku;zo++)ZS[jv[zo]]=zo;function Lv(n){let e="";for(let t in n)n.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(n[t]));return e}function e$(n){let e={},t=n.split("&");for(let r=0,i=t.length;r<i;r++){let s=t[r].split("=");e[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return e}let Dv=!1;try{Dv=typeof XMLHttpRequest!="undefined"&&"withCredentials"in new XMLHttpRequest}catch(n){}const t$=Dv;function Uv(n){const e=n.xdomain;try{if(typeof XMLHttpRequest!="undefined"&&(!e||t$))return new XMLHttpRequest}catch(t){}if(!e)try{return new Nn[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch(t){}}function n$(){}const r$=function(){return new Uv({xdomain:!1}).responseType!=null}();class i$ extends Nv{constructor(e){if(super(e),this.polling=!1,typeof location!="undefined"){const r=location.protocol==="https:";let i=location.port;i||(i=r?"443":"80"),this.xd=typeof location!="undefined"&&e.hostname!==location.hostname||i!==e.port,this.xs=e.secure!==r}const t=e&&e.forceBase64;this.supportsBinary=r$&&!t}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let r=0;this.polling&&(r++,this.once("pollComplete",function(){--r||t()})),this.writable||(r++,this.once("drain",function(){--r||t()}))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const t=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)};WS(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,KS(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let e=this.query||{};const t=this.opts.secure?"https":"http";let r="";this.opts.timestampRequests!==!1&&(e[this.opts.timestampParam]=Bv()),!this.supportsBinary&&!e.sid&&(e.b64=1),this.opts.port&&(t==="https"&&Number(this.opts.port)!==443||t==="http"&&Number(this.opts.port)!==80)&&(r=":"+this.opts.port);const i=Lv(e),s=this.opts.hostname.indexOf(":")!==-1;return t+"://"+(s?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(i.length?"?"+i:"")}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new lr(this.uri(),e)}doWrite(e,t){const r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",(i,s)=>{this.onError("xhr post error",i,s)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,r)=>{this.onError("xhr poll error",t,r)}),this.pollXhr=e}}class lr extends dt{constructor(e,t){super(),Ic(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.async=t.async!==!1,this.data=t.data!==void 0?t.data:null,this.create()}create(){const e=Cv(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;const t=this.xhr=new Uv(e);try{t.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(let r in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(r)&&t.setRequestHeader(r,this.opts.extraHeaders[r])}}catch(r){}if(this.method==="POST")try{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(r){}try{t.setRequestHeader("Accept","*/*")}catch(r){}"withCredentials"in t&&(t.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(t.timeout=this.opts.requestTimeout),t.onreadystatechange=()=>{t.readyState===4&&(t.status===200||t.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof t.status=="number"?t.status:0)},0))},t.send(this.data)}catch(r){this.setTimeoutFn(()=>{this.onError(r)},0);return}typeof document!="undefined"&&(this.index=lr.requestsCount++,lr.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr=="undefined"||this.xhr===null)){if(this.xhr.onreadystatechange=n$,e)try{this.xhr.abort()}catch(t){}typeof document!="undefined"&&delete lr.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}lr.requestsCount=0;lr.requests={};if(typeof document!="undefined"){if(typeof attachEvent=="function")attachEvent("onunload",Fp);else if(typeof addEventListener=="function"){const n="onpagehide"in Nn?"pagehide":"unload";addEventListener(n,Fp,!1)}}function Fp(){for(let n in lr.requests)lr.requests.hasOwnProperty(n)&&lr.requests[n].abort()}const Fv=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?n=>Promise.resolve().then(n):(n,e)=>e(n,0))(),Ho=Nn.WebSocket||Nn.MozWebSocket,Mp=!0,s$="arraybuffer",qp=typeof navigator!="undefined"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class o$ extends Nv{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,r=qp?{}:Cv(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=Mp&&!qp?t?new Ho(e,t):new Ho(e):new Ho(e,t,r)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType||s$,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],i=t===e.length-1;$v(r,this.supportsBinary,s=>{try{Mp&&this.ws.send(s)}catch(o){}i&&Fv(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws!="undefined"&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{};const t=this.opts.secure?"wss":"ws";let r="";this.opts.port&&(t==="wss"&&Number(this.opts.port)!==443||t==="ws"&&Number(this.opts.port)!==80)&&(r=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=Bv()),this.supportsBinary||(e.b64=1);const i=Lv(e),s=this.opts.hostname.indexOf(":")!==-1;return t+"://"+(s?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(i.length?"?"+i:"")}check(){return!!Ho}}const a$={websocket:o$,polling:i$},c$=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,l$=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Wu(n){const e=n,t=n.indexOf("["),r=n.indexOf("]");t!=-1&&r!=-1&&(n=n.substring(0,t)+n.substring(t,r).replace(/:/g,";")+n.substring(r,n.length));let i=c$.exec(n||""),s={},o=14;for(;o--;)s[l$[o]]=i[o]||"";return t!=-1&&r!=-1&&(s.source=e,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=u$(s,s.path),s.queryKey=h$(s,s.query),s}function u$(n,e){const t=/\/{2,9}/g,r=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&r.splice(0,1),e.slice(-1)=="/"&&r.splice(r.length-1,1),r}function h$(n,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,i,s){i&&(t[i]=s)}),t}class ni extends dt{constructor(e,t={}){super(),this.writeBuffer=[],e&&typeof e=="object"&&(t=e,e=null),e?(e=Wu(e),t.hostname=e.host,t.secure=e.protocol==="https"||e.protocol==="wss",t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=Wu(t.host).host),Ic(this,t),this.secure=t.secure!=null?t.secure:typeof location!="undefined"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location!="undefined"?location.hostname:"localhost"),this.port=t.port||(typeof location!="undefined"&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=e$(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=Rv,t.transport=e,this.id&&(t.sid=this.id);const r=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new a$[e](r)}open(){let e;if(this.opts.rememberUpgrade&&ni.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch(t){this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",t=>this.onClose("transport close",t))}probe(e){let t=this.createTransport(e),r=!1;ni.priorWebsocketSuccess=!1;const i=()=>{r||(t.send([{type:"ping",data:"probe"}]),t.once("packet",h=>{if(!r)if(h.type==="pong"&&h.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;ni.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{r||this.readyState!=="closed"&&(u(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const p=new Error("probe error");p.transport=t.name,this.emitReserved("upgradeError",p)}}))};function s(){r||(r=!0,u(),t.close(),t=null)}const o=h=>{const p=new Error("probe error: "+h);p.transport=t.name,s(),this.emitReserved("upgradeError",p)};function a(){o("transport closed")}function c(){o("socket closed")}function l(h){t&&h.name!==t.name&&s()}const u=()=>{t.removeListener("open",i),t.removeListener("error",o),t.removeListener("close",a),this.off("close",c),this.off("upgrading",l)};t.once("open",i),t.once("error",o),t.once("close",a),this.once("close",c),this.once("upgrading",l),t.open()}onOpen(){if(this.readyState="open",ni.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let t=0;t<this.writeBuffer.length;t++){const r=this.writeBuffer[t].data;if(r&&(e+=GS(r)),t>0&&e>this.maxPayload)return this.writeBuffer.slice(0,t);e+=2}return this.writeBuffer}write(e,t,r){return this.sendPacket("message",e,t,r),this}send(e,t,r){return this.sendPacket("message",e,t,r),this}sendPacket(e,t,r,i){if(typeof t=="function"&&(i=t,t=void 0),typeof r=="function"&&(i=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;const s={type:e,data:t,options:r};this.emitReserved("packetCreate",s),this.writeBuffer.push(s),i&&this.once("flush",i),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},r=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():e()}):this.upgrading?r():e()),this}onError(e){ni.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let r=0;const i=e.length;for(;r<i;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}}ni.protocol=Rv;function f$(n,e="",t){let r=n;t=t||typeof location!="undefined"&&location,n==null&&(n=t.protocol+"//"+t.host),typeof n=="string"&&(n.charAt(0)==="/"&&(n.charAt(1)==="/"?n=t.protocol+n:n=t.host+n),/^(https?|wss?):\/\//.test(n)||(typeof t!="undefined"?n=t.protocol+"//"+n:n="https://"+n),r=Wu(n)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const i=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+i+":"+r.port+e,r.href=r.protocol+"://"+i+(t&&t.port===r.port?"":":"+r.port),r}const d$=typeof ArrayBuffer=="function",p$=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n.buffer instanceof ArrayBuffer,Mv=Object.prototype.toString,y$=typeof Blob=="function"||typeof Blob!="undefined"&&Mv.call(Blob)==="[object BlobConstructor]",g$=typeof File=="function"||typeof File!="undefined"&&Mv.call(File)==="[object FileConstructor]";function xf(n){return d$&&(n instanceof ArrayBuffer||p$(n))||y$&&n instanceof Blob||g$&&n instanceof File}function wa(n,e){if(!n||typeof n!="object")return!1;if(Array.isArray(n)){for(let t=0,r=n.length;t<r;t++)if(wa(n[t]))return!0;return!1}if(xf(n))return!0;if(n.toJSON&&typeof n.toJSON=="function"&&arguments.length===1)return wa(n.toJSON(),!0);for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)&&wa(n[t]))return!0;return!1}function m$(n){const e=[],t=n.data,r=n;return r.data=zu(t,e),r.attachments=e.length,{packet:r,buffers:e}}function zu(n,e){if(!n)return n;if(xf(n)){const t={_placeholder:!0,num:e.length};return e.push(n),t}else if(Array.isArray(n)){const t=new Array(n.length);for(let r=0;r<n.length;r++)t[r]=zu(n[r],e);return t}else if(typeof n=="object"&&!(n instanceof Date)){const t={};for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=zu(n[r],e));return t}return n}function v$(n,e){return n.data=Hu(n.data,e),delete n.attachments,n}function Hu(n,e){if(!n)return n;if(n&&n._placeholder===!0){if(typeof n.num=="number"&&n.num>=0&&n.num<e.length)return e[n.num];throw new Error("illegal attachments")}else if(Array.isArray(n))for(let t=0;t<n.length;t++)n[t]=Hu(n[t],e);else if(typeof n=="object")for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&(n[t]=Hu(n[t],e));return n}const b$=5;var Le;(function(n){n[n.CONNECT=0]="CONNECT",n[n.DISCONNECT=1]="DISCONNECT",n[n.EVENT=2]="EVENT",n[n.ACK=3]="ACK",n[n.CONNECT_ERROR=4]="CONNECT_ERROR",n[n.BINARY_EVENT=5]="BINARY_EVENT",n[n.BINARY_ACK=6]="BINARY_ACK"})(Le||(Le={}));class w${constructor(e){this.replacer=e}encode(e){return(e.type===Le.EVENT||e.type===Le.ACK)&&wa(e)?this.encodeAsBinary({type:e.type===Le.EVENT?Le.BINARY_EVENT:Le.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===Le.BINARY_EVENT||e.type===Le.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=m$(e),r=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(r),i}}class Ef extends dt{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const r=t.type===Le.BINARY_EVENT;r||t.type===Le.BINARY_ACK?(t.type=r?Le.EVENT:Le.ACK,this.reconstructor=new k$(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(xf(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const r={type:Number(e.charAt(0))};if(Le[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===Le.BINARY_EVENT||r.type===Le.BINARY_ACK){const s=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const o=e.substring(s,t);if(o!=Number(o)||e.charAt(t)!=="-")throw new Error("Illegal attachments");r.attachments=Number(o)}if(e.charAt(t+1)==="/"){const s=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););r.nsp=e.substring(s,t)}else r.nsp="/";const i=e.charAt(t+1);if(i!==""&&Number(i)==i){const s=t+1;for(;++t;){const o=e.charAt(t);if(o==null||Number(o)!=o){--t;break}if(t===e.length)break}r.id=Number(e.substring(s,t+1))}if(e.charAt(++t)){const s=this.tryParse(e.substr(t));if(Ef.isPayloadValid(r.type,s))r.data=s;else throw new Error("invalid payload")}return r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(t){return!1}}static isPayloadValid(e,t){switch(e){case Le.CONNECT:return typeof t=="object";case Le.DISCONNECT:return t===void 0;case Le.CONNECT_ERROR:return typeof t=="string"||typeof t=="object";case Le.EVENT:case Le.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="string"||typeof t[0]=="number");case Le.ACK:case Le.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class k${constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=v$(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const x$=Object.freeze(Object.defineProperty({__proto__:null,protocol:b$,get PacketType(){return Le},Encoder:w$,Decoder:Ef},Symbol.toStringTag,{value:"Module"}));function Vn(n,e,t){return n.on(e,t),function(){n.off(e,t)}}const E$=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class qv extends dt{constructor(e,t,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Vn(e,"open",this.onopen.bind(this)),Vn(e,"packet",this.onpacket.bind(this)),Vn(e,"error",this.onerror.bind(this)),Vn(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(E$.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const r={type:Le.EVENT,data:t};if(r.options={},r.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const s=this.ids++,o=t.pop();this._registerAckCallback(s,o),r.id=s}const i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!i||!this.connected)||(this.connected?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(e,t){var r;const i=(r=this.flags.timeout)!==null&&r!==void 0?r:this._opts.ackTimeout;if(i===void 0){this.acks[e]=t;return}const s=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let o=0;o<this.sendBuffer.length;o++)this.sendBuffer[o].id===e&&this.sendBuffer.splice(o,1);t.call(this,new Error("operation has timed out"))},i);this.acks[e]=(...o)=>{this.io.clearTimeoutFn(s),t.apply(this,[null,...o])}}emitWithAck(e,...t){const r=this.flags.timeout!==void 0||this._opts.ackTimeout!==void 0;return new Promise((i,s)=>{t.push((o,a)=>r?o?s(o):i(a):i(o)),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((i,...s)=>r!==this._queue[0]?void 0:(i!==null?r.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(i)):(this._queue.shift(),t&&t(null,...s)),r.pending=!1,this._drainQueue())),this._queue.push(r),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:Le.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case Le.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Le.EVENT:case Le.BINARY_EVENT:this.onevent(e);break;case Le.ACK:case Le.BINARY_ACK:this.onack(e);break;case Le.DISCONNECT:this.ondisconnect();break;case Le.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const r of t)r.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let r=!1;return function(...i){r||(r=!0,t.packet({type:Le.ACK,id:e,data:i}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Le.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const r of t)r.apply(this,e.data)}}}function ks(n){n=n||{},this.ms=n.min||100,this.max=n.max||1e4,this.factor=n.factor||2,this.jitter=n.jitter>0&&n.jitter<=1?n.jitter:0,this.attempts=0}ks.prototype.duration=function(){var n=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*n);n=(Math.floor(e*10)&1)==0?n-t:n+t}return Math.min(n,this.max)|0};ks.prototype.reset=function(){this.attempts=0};ks.prototype.setMin=function(n){this.ms=n};ks.prototype.setMax=function(n){this.max=n};ks.prototype.setJitter=function(n){this.jitter=n};class Ju extends dt{constructor(e,t){var r;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,Ic(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((r=t.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new ks({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const i=t.parser||x$;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new ni(this.uri,this.opts);const t=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const i=Vn(t,"open",function(){r.onopen(),e&&e()}),s=Vn(t,"error",o=>{r.cleanup(),r._readyState="closed",this.emitReserved("error",o),e?e(o):r.maybeReconnectOnOpen()});if(this._timeout!==!1){const o=this._timeout;o===0&&i();const a=this.setTimeoutFn(()=>{i(),t.close(),t.emit("error",new Error("timeout"))},o);this.opts.autoUnref&&a.unref(),this.subs.push(function(){clearTimeout(a)})}return this.subs.push(i),this.subs.push(s),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Vn(e,"ping",this.onping.bind(this)),Vn(e,"data",this.ondata.bind(this)),Vn(e,"error",this.onerror.bind(this)),Vn(e,"close",this.onclose.bind(this)),Vn(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){Fv(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new qv(this,e,t),this.nsps[e]=r),r}_destroy(e){const t=Object.keys(this.nsps);for(const r of t)if(this.nsps[r].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let r=0;r<t.length;r++)this.engine.write(t[r],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(i=>{i?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",i)):e.onreconnect()}))},t);this.opts.autoUnref&&r.unref(),this.subs.push(function(){clearTimeout(r)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const Ps={};function ka(n,e){typeof n=="object"&&(e=n,n=void 0),e=e||{};const t=f$(n,e.path||"/socket.io"),r=t.source,i=t.id,s=t.path,o=Ps[i]&&s in Ps[i].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||o;let c;return a?c=new Ju(r,e):(Ps[i]||(Ps[i]=new Ju(r,e)),c=Ps[i]),t.query&&!e.query&&(e.query=t.queryKey),c.socket(t.path,e)}Object.assign(ka,{Manager:Ju,Socket:qv,io:ka,connect:ka});const _$={init:({API_KEY:n,HOST_SERVER:e,CURRENT:t,ENV:r,API_VERSION:i})=>{var s,o;let a={};const c=localStorage.getItem("accessToken");try{const l={Accept:"application/json","Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Key":n,"Access-Control-Allow-Methods":"POST, GET, OPTIONS, PUT, DELETE, HEAD,PATCH","Access-Control-Allow-Headers":"X-PINGOTHER, Origin, X-Requested-With, Content-Type, Accept","Access-Control-Max-Age":"1728000"};return c&&(l.Authorization="Bearer "+c),a.database=ka(e.DATABASE,{extraHeaders:l}),(s=a==null?void 0:a.database)==null||s.on("connect",()=>{r==="dev"&&console.log("Swyger Database Client JS is connected with Swyger Server!!!")}),(o=a==null?void 0:a.database)==null||o.on("disconnect",u=>{r==="dev"&&console.log("The device is disconnected from Database server!")}),a}catch(l){}}};function Yu(n){this.message=n}Yu.prototype=new Error,Yu.prototype.name="InvalidCharacterError";var Vp=typeof window!="undefined"&&window.atob&&window.atob.bind(window)||function(n){var e=String(n).replace(/=+$/,"");if(e.length%4==1)throw new Yu("'atob' failed: The string to be decoded is not correctly encoded.");for(var t,r,i=0,s=0,o="";r=e.charAt(s++);~r&&(t=i%4?64*t+r:r,i++%4)?o+=String.fromCharCode(255&t>>(-2*i&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return o};function A$(n){var e=n.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw"Illegal base64url string!"}try{return function(t){return decodeURIComponent(Vp(t).replace(/(.)/g,function(r,i){var s=i.charCodeAt(0).toString(16).toUpperCase();return s.length<2&&(s="0"+s),"%"+s}))}(e)}catch(t){return Vp(e)}}function Ga(n){this.message=n}function O$(n,e){if(typeof n!="string")throw new Ga("Invalid token specified");var t=(e=e||{}).header===!0?0:1;try{return JSON.parse(A$(n.split(".")[t]))}catch(r){throw new Ga("Invalid token specified: "+r.message)}}Ga.prototype=new Error,Ga.prototype.name="InvalidTokenError";function Vv(n,e){return function(){return n.apply(e,arguments)}}const{toString:S$}=Object.prototype,{getPrototypeOf:_f}=Object,Rc=(n=>e=>{const t=S$.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),gr=n=>(n=n.toLowerCase(),e=>Rc(e)===n),Cc=n=>e=>typeof e===n,{isArray:xs}=Array,eo=Cc("undefined");function $$(n){return n!==null&&!eo(n)&&n.constructor!==null&&!eo(n.constructor)&&Ln(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const Kv=gr("ArrayBuffer");function T$(n){let e;return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&Kv(n.buffer),e}const P$=Cc("string"),Ln=Cc("function"),Wv=Cc("number"),Nc=n=>n!==null&&typeof n=="object",I$=n=>n===!0||n===!1,xa=n=>{if(Rc(n)!=="object")return!1;const e=_f(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},R$=gr("Date"),C$=gr("File"),N$=gr("Blob"),j$=gr("FileList"),B$=n=>Nc(n)&&Ln(n.pipe),L$=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||Ln(n.append)&&((e=Rc(n))==="formdata"||e==="object"&&Ln(n.toString)&&n.toString()==="[object FormData]"))},D$=gr("URLSearchParams"),U$=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function _o(n,e,{allOwnKeys:t=!1}={}){if(n===null||typeof n=="undefined")return;let r,i;if(typeof n!="object"&&(n=[n]),xs(n))for(r=0,i=n.length;r<i;r++)e.call(null,n[r],r,n);else{const s=t?Object.getOwnPropertyNames(n):Object.keys(n),o=s.length;let a;for(r=0;r<o;r++)a=s[r],e.call(null,n[a],a,n)}}function zv(n,e){e=e.toLowerCase();const t=Object.keys(n);let r=t.length,i;for(;r-- >0;)if(i=t[r],e===i.toLowerCase())return i;return null}const Hv=(()=>typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:global)(),Jv=n=>!eo(n)&&n!==Hv;function Gu(){const{caseless:n}=Jv(this)&&this||{},e={},t=(r,i)=>{const s=n&&zv(e,i)||i;xa(e[s])&&xa(r)?e[s]=Gu(e[s],r):xa(r)?e[s]=Gu({},r):xs(r)?e[s]=r.slice():e[s]=r};for(let r=0,i=arguments.length;r<i;r++)arguments[r]&&_o(arguments[r],t);return e}const F$=(n,e,t,{allOwnKeys:r}={})=>(_o(e,(i,s)=>{t&&Ln(i)?n[s]=Vv(i,t):n[s]=i},{allOwnKeys:r}),n),M$=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),q$=(n,e,t,r)=>{n.prototype=Object.create(e.prototype,r),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),t&&Object.assign(n.prototype,t)},V$=(n,e,t,r)=>{let i,s,o;const a={};if(e=e||{},n==null)return e;do{for(i=Object.getOwnPropertyNames(n),s=i.length;s-- >0;)o=i[s],(!r||r(o,n,e))&&!a[o]&&(e[o]=n[o],a[o]=!0);n=t!==!1&&_f(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e},K$=(n,e,t)=>{n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;const r=n.indexOf(e,t);return r!==-1&&r===t},W$=n=>{if(!n)return null;if(xs(n))return n;let e=n.length;if(!Wv(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=n[e];return t},z$=(n=>e=>n&&e instanceof n)(typeof Uint8Array!="undefined"&&_f(Uint8Array)),H$=(n,e)=>{const t=(n&&n[Symbol.iterator]).call(n);let r;for(;(r=t.next())&&!r.done;){const i=r.value;e.call(n,i[0],i[1])}},J$=(n,e)=>{let t;const r=[];for(;(t=n.exec(e))!==null;)r.push(t);return r},Y$=gr("HTMLFormElement"),G$=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,r){return t.toUpperCase()+r}),Kp=(({hasOwnProperty:n})=>(e,t)=>n.call(e,t))(Object.prototype),Q$=gr("RegExp"),Yv=(n,e)=>{const t=Object.getOwnPropertyDescriptors(n),r={};_o(t,(i,s)=>{e(i,s,n)!==!1&&(r[s]=i)}),Object.defineProperties(n,r)},X$=n=>{Yv(n,(e,t)=>{if(Ln(n)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const r=n[t];if(Ln(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},Z$=(n,e)=>{const t={},r=i=>{i.forEach(s=>{t[s]=!0})};return xs(n)?r(n):r(String(n).split(e)),t},eT=()=>{},tT=(n,e)=>(n=+n,Number.isFinite(n)?n:e),Nl="abcdefghijklmnopqrstuvwxyz",Wp="0123456789",Gv={DIGIT:Wp,ALPHA:Nl,ALPHA_DIGIT:Nl+Nl.toUpperCase()+Wp},nT=(n=16,e=Gv.ALPHA_DIGIT)=>{let t="";const{length:r}=e;for(;n--;)t+=e[Math.random()*r|0];return t};function rT(n){return!!(n&&Ln(n.append)&&n[Symbol.toStringTag]==="FormData"&&n[Symbol.iterator])}const iT=n=>{const e=new Array(10),t=(r,i)=>{if(Nc(r)){if(e.indexOf(r)>=0)return;if(!("toJSON"in r)){e[i]=r;const s=xs(r)?[]:{};return _o(r,(o,a)=>{const c=t(o,i+1);!eo(c)&&(s[a]=c)}),e[i]=void 0,s}}return r};return t(n,0)},sT=gr("AsyncFunction"),oT=n=>n&&(Nc(n)||Ln(n))&&Ln(n.then)&&Ln(n.catch),Z={isArray:xs,isArrayBuffer:Kv,isBuffer:$$,isFormData:L$,isArrayBufferView:T$,isString:P$,isNumber:Wv,isBoolean:I$,isObject:Nc,isPlainObject:xa,isUndefined:eo,isDate:R$,isFile:C$,isBlob:N$,isRegExp:Q$,isFunction:Ln,isStream:B$,isURLSearchParams:D$,isTypedArray:z$,isFileList:j$,forEach:_o,merge:Gu,extend:F$,trim:U$,stripBOM:M$,inherits:q$,toFlatObject:V$,kindOf:Rc,kindOfTest:gr,endsWith:K$,toArray:W$,forEachEntry:H$,matchAll:J$,isHTMLForm:Y$,hasOwnProperty:Kp,hasOwnProp:Kp,reduceDescriptors:Yv,freezeMethods:X$,toObjectSet:Z$,toCamelCase:G$,noop:eT,toFiniteNumber:tT,findKey:zv,global:Hv,isContextDefined:Jv,ALPHABET:Gv,generateString:nT,isSpecCompliantForm:rT,toJSONObject:iT,isAsyncFn:sT,isThenable:oT};function Ke(n,e,t,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),r&&(this.request=r),i&&(this.response=i)}Z.inherits(Ke,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Z.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const Qv=Ke.prototype,Xv={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{Xv[n]={value:n}});Object.defineProperties(Ke,Xv);Object.defineProperty(Qv,"isAxiosError",{value:!0});Ke.from=(n,e,t,r,i,s)=>{const o=Object.create(Qv);return Z.toFlatObject(n,o,function(a){return a!==Error.prototype},a=>a!=="isAxiosError"),Ke.call(o,n.message,e,t,r,i),o.cause=n,o.name=n.name,s&&Object.assign(o,s),o};const aT=null;function Qu(n){return Z.isPlainObject(n)||Z.isArray(n)}function Zv(n){return Z.endsWith(n,"[]")?n.slice(0,-2):n}function zp(n,e,t){return n?n.concat(e).map(function(r,i){return r=Zv(r),!t&&i?"["+r+"]":r}).join(t?".":""):e}function cT(n){return Z.isArray(n)&&!n.some(Qu)}const lT=Z.toFlatObject(Z,{},null,function(n){return/^is[A-Z]/.test(n)});function jc(n,e,t){if(!Z.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,t=Z.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(f,d){return!Z.isUndefined(d[f])});const r=t.metaTokens,i=t.visitor||l,s=t.dots,o=t.indexes,a=(t.Blob||typeof Blob!="undefined"&&Blob)&&Z.isSpecCompliantForm(e);if(!Z.isFunction(i))throw new TypeError("visitor must be a function");function c(f){if(f===null)return"";if(Z.isDate(f))return f.toISOString();if(!a&&Z.isBlob(f))throw new Ke("Blob is not supported. Use a Buffer instead.");return Z.isArrayBuffer(f)||Z.isTypedArray(f)?a&&typeof Blob=="function"?new Blob([f]):Buffer.from(f):f}function l(f,d,y){let _=f;if(f&&!y&&typeof f=="object"){if(Z.endsWith(d,"{}"))d=r?d:d.slice(0,-2),f=JSON.stringify(f);else if(Z.isArray(f)&&cT(f)||(Z.isFileList(f)||Z.endsWith(d,"[]"))&&(_=Z.toArray(f)))return d=Zv(d),_.forEach(function(S,I){!(Z.isUndefined(S)||S===null)&&e.append(o===!0?zp([d],I,s):o===null?d:d+"[]",c(S))}),!1}return Qu(f)?!0:(e.append(zp(y,d,s),c(f)),!1)}const u=[],h=Object.assign(lT,{defaultVisitor:l,convertValue:c,isVisitable:Qu});function p(f,d){if(!Z.isUndefined(f)){if(u.indexOf(f)!==-1)throw Error("Circular reference detected in "+d.join("."));u.push(f),Z.forEach(f,function(y,_){(!(Z.isUndefined(y)||y===null)&&i.call(e,y,Z.isString(_)?_.trim():_,d,h))===!0&&p(y,d?d.concat(_):[_])}),u.pop()}}if(!Z.isObject(n))throw new TypeError("data must be an object");return p(n),e}function Hp(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(t){return e[t]})}function Af(n,e){this._pairs=[],n&&jc(n,this,e)}const eb=Af.prototype;eb.append=function(n,e){this._pairs.push([n,e])};eb.toString=function(n){const e=n?function(t){return n.call(this,t,Hp)}:Hp;return this._pairs.map(function(t){return e(t[0])+"="+e(t[1])},"").join("&")};function uT(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function tb(n,e,t){if(!e)return n;const r=t&&t.encode||uT,i=t&&t.serialize;let s;if(i?s=i(e,t):s=Z.isURLSearchParams(e)?e.toString():new Af(e,t).toString(r),s){const o=n.indexOf("#");o!==-1&&(n=n.slice(0,o)),n+=(n.indexOf("?")===-1?"?":"&")+s}return n}class hT{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Z.forEach(this.handlers,function(t){t!==null&&e(t)})}}const Jp=hT,nb={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},fT=typeof URLSearchParams!="undefined"?URLSearchParams:Af,dT=typeof FormData!="undefined"?FormData:null,pT=typeof Blob!="undefined"?Blob:null,yT=(()=>{let n;return typeof navigator!="undefined"&&((n=navigator.product)==="ReactNative"||n==="NativeScript"||n==="NS")?!1:typeof window!="undefined"&&typeof document!="undefined"})(),gT=(()=>typeof WorkerGlobalScope!="undefined"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),or={isBrowser:!0,classes:{URLSearchParams:fT,FormData:dT,Blob:pT},isStandardBrowserEnv:yT,isStandardBrowserWebWorkerEnv:gT,protocols:["http","https","file","blob","url","data"]};function mT(n,e){return jc(n,new or.classes.URLSearchParams,Object.assign({visitor:function(t,r,i,s){return or.isNode&&Z.isBuffer(t)?(this.append(r,t.toString("base64")),!1):s.defaultVisitor.apply(this,arguments)}},e))}function vT(n){return Z.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function bT(n){const e={},t=Object.keys(n);let r;const i=t.length;let s;for(r=0;r<i;r++)s=t[r],e[s]=n[s];return e}function rb(n){function e(t,r,i,s){let o=t[s++];const a=Number.isFinite(+o),c=s>=t.length;return o=!o&&Z.isArray(i)?i.length:o,c?(Z.hasOwnProp(i,o)?i[o]=[i[o],r]:i[o]=r,!a):((!i[o]||!Z.isObject(i[o]))&&(i[o]=[]),e(t,r,i[o],s)&&Z.isArray(i[o])&&(i[o]=bT(i[o])),!a)}if(Z.isFormData(n)&&Z.isFunction(n.entries)){const t={};return Z.forEachEntry(n,(r,i)=>{e(vT(r),i,t,0)}),t}return null}const wT={"Content-Type":void 0};function kT(n,e,t){if(Z.isString(n))try{return(e||JSON.parse)(n),Z.trim(n)}catch(r){if(r.name!=="SyntaxError")throw r}return(t||JSON.stringify)(n)}const Bc={transitional:nb,adapter:["xhr","http"],transformRequest:[function(n,e){const t=e.getContentType()||"",r=t.indexOf("application/json")>-1,i=Z.isObject(n);if(i&&Z.isHTMLForm(n)&&(n=new FormData(n)),Z.isFormData(n))return r&&r?JSON.stringify(rb(n)):n;if(Z.isArrayBuffer(n)||Z.isBuffer(n)||Z.isStream(n)||Z.isFile(n)||Z.isBlob(n))return n;if(Z.isArrayBufferView(n))return n.buffer;if(Z.isURLSearchParams(n))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),n.toString();let s;if(i){if(t.indexOf("application/x-www-form-urlencoded")>-1)return mT(n,this.formSerializer).toString();if((s=Z.isFileList(n))||t.indexOf("multipart/form-data")>-1){const o=this.env&&this.env.FormData;return jc(s?{"files[]":n}:n,o&&new o,this.formSerializer)}}return i||r?(e.setContentType("application/json",!1),kT(n)):n}],transformResponse:[function(n){const e=this.transitional||Bc.transitional,t=e&&e.forcedJSONParsing,r=this.responseType==="json";if(n&&Z.isString(n)&&(t&&!this.responseType||r)){const i=!(e&&e.silentJSONParsing)&&r;try{return JSON.parse(n)}catch(s){if(i)throw s.name==="SyntaxError"?Ke.from(s,Ke.ERR_BAD_RESPONSE,this,null,this.response):s}}return n}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:or.classes.FormData,Blob:or.classes.Blob},validateStatus:function(n){return n>=200&&n<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};Z.forEach(["delete","get","head"],function(n){Bc.headers[n]={}});Z.forEach(["post","put","patch"],function(n){Bc.headers[n]=Z.merge(wT)});const Of=Bc,xT=Z.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),ET=n=>{const e={};let t,r,i;return n&&n.split(`
`).forEach(function(s){i=s.indexOf(":"),t=s.substring(0,i).trim().toLowerCase(),r=s.substring(i+1).trim(),!(!t||e[t]&&xT[t])&&(t==="set-cookie"?e[t]?e[t].push(r):e[t]=[r]:e[t]=e[t]?e[t]+", "+r:r)}),e},Yp=Symbol("internals");function Is(n){return n&&String(n).trim().toLowerCase()}function Ea(n){return n===!1||n==null?n:Z.isArray(n)?n.map(Ea):String(n)}function _T(n){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=t.exec(n);)e[r[1]]=r[2];return e}const AT=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function jl(n,e,t,r,i){if(Z.isFunction(r))return r.call(this,e,t);if(i&&(e=t),!!Z.isString(e)){if(Z.isString(r))return e.indexOf(r)!==-1;if(Z.isRegExp(r))return r.test(e)}}function OT(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,r)=>t.toUpperCase()+r)}function ST(n,e){const t=Z.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(n,r+t,{value:function(i,s,o){return this[r].call(this,e,i,s,o)},configurable:!0})})}class Lc{constructor(e){e&&this.set(e)}set(e,t,r){const i=this;function s(a,c,l){const u=Is(c);if(!u)throw new Error("header name must be a non-empty string");const h=Z.findKey(i,u);(!h||i[h]===void 0||l===!0||l===void 0&&i[h]!==!1)&&(i[h||c]=Ea(a))}const o=(a,c)=>Z.forEach(a,(l,u)=>s(l,u,c));return Z.isPlainObject(e)||e instanceof this.constructor?o(e,t):Z.isString(e)&&(e=e.trim())&&!AT(e)?o(ET(e),t):e!=null&&s(t,e,r),this}get(e,t){if(e=Is(e),e){const r=Z.findKey(this,e);if(r){const i=this[r];if(!t)return i;if(t===!0)return _T(i);if(Z.isFunction(t))return t.call(this,i,r);if(Z.isRegExp(t))return t.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Is(e),e){const r=Z.findKey(this,e);return!!(r&&this[r]!==void 0&&(!t||jl(this,this[r],r,t)))}return!1}delete(e,t){const r=this;let i=!1;function s(o){if(o=Is(o),o){const a=Z.findKey(r,o);a&&(!t||jl(r,r[a],a,t))&&(delete r[a],i=!0)}}return Z.isArray(e)?e.forEach(s):s(e),i}clear(e){const t=Object.keys(this);let r=t.length,i=!1;for(;r--;){const s=t[r];(!e||jl(this,this[s],s,e,!0))&&(delete this[s],i=!0)}return i}normalize(e){const t=this,r={};return Z.forEach(this,(i,s)=>{const o=Z.findKey(r,s);if(o){t[o]=Ea(i),delete t[s];return}const a=e?OT(s):String(s).trim();a!==s&&delete t[s],t[a]=Ea(i),r[a]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return Z.forEach(this,(r,i)=>{r!=null&&r!==!1&&(t[i]=e&&Z.isArray(r)?r.join(", "):r)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const r=new this(e);return t.forEach(i=>r.set(i)),r}static accessor(e){const t=(this[Yp]=this[Yp]={accessors:{}}).accessors,r=this.prototype;function i(s){const o=Is(s);t[o]||(ST(r,s),t[o]=!0)}return Z.isArray(e)?e.forEach(i):i(e),this}}Lc.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Z.freezeMethods(Lc.prototype);Z.freezeMethods(Lc);const Ar=Lc;function Bl(n,e){const t=this||Of,r=e||t,i=Ar.from(r.headers);let s=r.data;return Z.forEach(n,function(o){s=o.call(t,s,i.normalize(),e?e.status:void 0)}),i.normalize(),s}function ib(n){return!!(n&&n.__CANCEL__)}function Ao(n,e,t){Ke.call(this,n==null?"canceled":n,Ke.ERR_CANCELED,e,t),this.name="CanceledError"}Z.inherits(Ao,Ke,{__CANCEL__:!0});function $T(n,e,t){const r=t.config.validateStatus;!t.status||!r||r(t.status)?n(t):e(new Ke("Request failed with status code "+t.status,[Ke.ERR_BAD_REQUEST,Ke.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}const TT=or.isStandardBrowserEnv?function(){return{write:function(n,e,t,r,i,s){const o=[];o.push(n+"="+encodeURIComponent(e)),Z.isNumber(t)&&o.push("expires="+new Date(t).toGMTString()),Z.isString(r)&&o.push("path="+r),Z.isString(i)&&o.push("domain="+i),s===!0&&o.push("secure"),document.cookie=o.join("; ")},read:function(n){const e=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(n){this.write(n,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}();function PT(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function IT(n,e){return e?n.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):n}function sb(n,e){return n&&!PT(e)?IT(n,e):e}const RT=or.isStandardBrowserEnv?function(){const n=/(msie|trident)/i.test(navigator.userAgent),e=document.createElement("a");let t;function r(i){let s=i;return n&&(e.setAttribute("href",s),s=e.href),e.setAttribute("href",s),{href:e.href,protocol:e.protocol?e.protocol.replace(/:$/,""):"",host:e.host,search:e.search?e.search.replace(/^\?/,""):"",hash:e.hash?e.hash.replace(/^#/,""):"",hostname:e.hostname,port:e.port,pathname:e.pathname.charAt(0)==="/"?e.pathname:"/"+e.pathname}}return t=r(window.location.href),function(i){const s=Z.isString(i)?r(i):i;return s.protocol===t.protocol&&s.host===t.host}}():function(){return function(){return!0}}();function CT(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function NT(n,e){n=n||10;const t=new Array(n),r=new Array(n);let i=0,s=0,o;return e=e!==void 0?e:1e3,function(a){const c=Date.now(),l=r[s];o||(o=c),t[i]=a,r[i]=c;let u=s,h=0;for(;u!==i;)h+=t[u++],u=u%n;if(i=(i+1)%n,i===s&&(s=(s+1)%n),c-o<e)return;const p=l&&c-l;return p?Math.round(h*1e3/p):void 0}}function Gp(n,e){let t=0;const r=NT(50,250);return i=>{const s=i.loaded,o=i.lengthComputable?i.total:void 0,a=s-t,c=r(a),l=s<=o;t=s;const u={loaded:s,total:o,progress:o?s/o:void 0,bytes:a,rate:c||void 0,estimated:c&&o&&l?(o-s)/c:void 0,event:i};u[e?"download":"upload"]=!0,n(u)}}const jT=typeof XMLHttpRequest!="undefined",BT=jT&&function(n){return new Promise(function(e,t){let r=n.data;const i=Ar.from(n.headers).normalize(),s=n.responseType;let o;function a(){n.cancelToken&&n.cancelToken.unsubscribe(o),n.signal&&n.signal.removeEventListener("abort",o)}Z.isFormData(r)&&(or.isStandardBrowserEnv||or.isStandardBrowserWebWorkerEnv?i.setContentType(!1):i.setContentType("multipart/form-data;",!1));let c=new XMLHttpRequest;if(n.auth){const p=n.auth.username||"",f=n.auth.password?unescape(encodeURIComponent(n.auth.password)):"";i.set("Authorization","Basic "+btoa(p+":"+f))}const l=sb(n.baseURL,n.url);c.open(n.method.toUpperCase(),tb(l,n.params,n.paramsSerializer),!0),c.timeout=n.timeout;function u(){if(!c)return;const p=Ar.from("getAllResponseHeaders"in c&&c.getAllResponseHeaders()),f={data:!s||s==="text"||s==="json"?c.responseText:c.response,status:c.status,statusText:c.statusText,headers:p,config:n,request:c};$T(function(d){e(d),a()},function(d){t(d),a()},f),c=null}if("onloadend"in c?c.onloadend=u:c.onreadystatechange=function(){!c||c.readyState!==4||c.status===0&&!(c.responseURL&&c.responseURL.indexOf("file:")===0)||setTimeout(u)},c.onabort=function(){!c||(t(new Ke("Request aborted",Ke.ECONNABORTED,n,c)),c=null)},c.onerror=function(){t(new Ke("Network Error",Ke.ERR_NETWORK,n,c)),c=null},c.ontimeout=function(){let p=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const f=n.transitional||nb;n.timeoutErrorMessage&&(p=n.timeoutErrorMessage),t(new Ke(p,f.clarifyTimeoutError?Ke.ETIMEDOUT:Ke.ECONNABORTED,n,c)),c=null},or.isStandardBrowserEnv){const p=(n.withCredentials||RT(l))&&n.xsrfCookieName&&TT.read(n.xsrfCookieName);p&&i.set(n.xsrfHeaderName,p)}r===void 0&&i.setContentType(null),"setRequestHeader"in c&&Z.forEach(i.toJSON(),function(p,f){c.setRequestHeader(f,p)}),Z.isUndefined(n.withCredentials)||(c.withCredentials=!!n.withCredentials),s&&s!=="json"&&(c.responseType=n.responseType),typeof n.onDownloadProgress=="function"&&c.addEventListener("progress",Gp(n.onDownloadProgress,!0)),typeof n.onUploadProgress=="function"&&c.upload&&c.upload.addEventListener("progress",Gp(n.onUploadProgress)),(n.cancelToken||n.signal)&&(o=p=>{!c||(t(!p||p.type?new Ao(null,n,c):p),c.abort(),c=null)},n.cancelToken&&n.cancelToken.subscribe(o),n.signal&&(n.signal.aborted?o():n.signal.addEventListener("abort",o)));const h=CT(l);if(h&&or.protocols.indexOf(h)===-1){t(new Ke("Unsupported protocol "+h+":",Ke.ERR_BAD_REQUEST,n));return}c.send(r||null)})},_a={http:aT,xhr:BT};Z.forEach(_a,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch(t){}Object.defineProperty(n,"adapterName",{value:e})}});const LT={getAdapter:n=>{n=Z.isArray(n)?n:[n];const{length:e}=n;let t,r;for(let i=0;i<e&&(t=n[i],!(r=Z.isString(t)?_a[t.toLowerCase()]:t));i++);if(!r)throw r===!1?new Ke(`Adapter ${t} is not supported by the environment`,"ERR_NOT_SUPPORT"):new Error(Z.hasOwnProp(_a,t)?`Adapter '${t}' is not available in the build`:`Unknown adapter '${t}'`);if(!Z.isFunction(r))throw new TypeError("adapter is not a function");return r},adapters:_a};function Ll(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new Ao(null,n)}function Qp(n){return Ll(n),n.headers=Ar.from(n.headers),n.data=Bl.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),LT.getAdapter(n.adapter||Of.adapter)(n).then(function(e){return Ll(n),e.data=Bl.call(n,n.transformResponse,e),e.headers=Ar.from(e.headers),e},function(e){return ib(e)||(Ll(n),e&&e.response&&(e.response.data=Bl.call(n,n.transformResponse,e.response),e.response.headers=Ar.from(e.response.headers))),Promise.reject(e)})}const Xp=n=>n instanceof Ar?n.toJSON():n;function fs(n,e){e=e||{};const t={};function r(l,u,h){return Z.isPlainObject(l)&&Z.isPlainObject(u)?Z.merge.call({caseless:h},l,u):Z.isPlainObject(u)?Z.merge({},u):Z.isArray(u)?u.slice():u}function i(l,u,h){if(Z.isUndefined(u)){if(!Z.isUndefined(l))return r(void 0,l,h)}else return r(l,u,h)}function s(l,u){if(!Z.isUndefined(u))return r(void 0,u)}function o(l,u){if(Z.isUndefined(u)){if(!Z.isUndefined(l))return r(void 0,l)}else return r(void 0,u)}function a(l,u,h){if(h in e)return r(l,u);if(h in n)return r(void 0,l)}const c={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(l,u)=>i(Xp(l),Xp(u),!0)};return Z.forEach(Object.keys(Object.assign({},n,e)),function(l){const u=c[l]||i,h=u(n[l],e[l],l);Z.isUndefined(h)&&u!==a||(t[l]=h)}),t}const ob="1.4.0",Sf={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{Sf[n]=function(t){return typeof t===n||"a"+(e<1?"n ":" ")+n}});const Zp={};Sf.transitional=function(n,e,t){function r(i,s){return"[Axios v"+ob+"] Transitional option '"+i+"'"+s+(t?". "+t:"")}return(i,s,o)=>{if(n===!1)throw new Ke(r(s," has been removed"+(e?" in "+e:"")),Ke.ERR_DEPRECATED);return e&&!Zp[s]&&(Zp[s]=!0,console.warn(r(s," has been deprecated since v"+e+" and will be removed in the near future"))),n?n(i,s,o):!0}};function DT(n,e,t){if(typeof n!="object")throw new Ke("options must be an object",Ke.ERR_BAD_OPTION_VALUE);const r=Object.keys(n);let i=r.length;for(;i-- >0;){const s=r[i],o=e[s];if(o){const a=n[s],c=a===void 0||o(a,s,n);if(c!==!0)throw new Ke("option "+s+" must be "+c,Ke.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new Ke("Unknown option "+s,Ke.ERR_BAD_OPTION)}}const Xu={assertOptions:DT,validators:Sf},zr=Xu.validators;class Qa{constructor(e){this.defaults=e,this.interceptors={request:new Jp,response:new Jp}}request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=fs(this.defaults,t);const{transitional:r,paramsSerializer:i,headers:s}=t;r!==void 0&&Xu.assertOptions(r,{silentJSONParsing:zr.transitional(zr.boolean),forcedJSONParsing:zr.transitional(zr.boolean),clarifyTimeoutError:zr.transitional(zr.boolean)},!1),i!=null&&(Z.isFunction(i)?t.paramsSerializer={serialize:i}:Xu.assertOptions(i,{encode:zr.function,serialize:zr.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o;o=s&&Z.merge(s.common,s[t.method]),o&&Z.forEach(["delete","get","head","post","put","patch","common"],d=>{delete s[d]}),t.headers=Ar.concat(o,s);const a=[];let c=!0;this.interceptors.request.forEach(function(d){typeof d.runWhen=="function"&&d.runWhen(t)===!1||(c=c&&d.synchronous,a.unshift(d.fulfilled,d.rejected))});const l=[];this.interceptors.response.forEach(function(d){l.push(d.fulfilled,d.rejected)});let u,h=0,p;if(!c){const d=[Qp.bind(this),void 0];for(d.unshift.apply(d,a),d.push.apply(d,l),p=d.length,u=Promise.resolve(t);h<p;)u=u.then(d[h++],d[h++]);return u}p=a.length;let f=t;for(h=0;h<p;){const d=a[h++],y=a[h++];try{f=d(f)}catch(_){y.call(this,_);break}}try{u=Qp.call(this,f)}catch(d){return Promise.reject(d)}for(h=0,p=l.length;h<p;)u=u.then(l[h++],l[h++]);return u}getUri(e){e=fs(this.defaults,e);const t=sb(e.baseURL,e.url);return tb(t,e.params,e.paramsSerializer)}}Z.forEach(["delete","get","head","options"],function(n){Qa.prototype[n]=function(e,t){return this.request(fs(t||{},{method:n,url:e,data:(t||{}).data}))}});Z.forEach(["post","put","patch"],function(n){function e(t){return function(r,i,s){return this.request(fs(s||{},{method:n,headers:t?{"Content-Type":"multipart/form-data"}:{},url:r,data:i}))}}Qa.prototype[n]=e(),Qa.prototype[n+"Form"]=e(!0)});const Aa=Qa;class $f{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(i){t=i});const r=this;this.promise.then(i=>{if(!r._listeners)return;let s=r._listeners.length;for(;s-- >0;)r._listeners[s](i);r._listeners=null}),this.promise.then=i=>{let s;const o=new Promise(a=>{r.subscribe(a),s=a}).then(i);return o.cancel=function(){r.unsubscribe(s)},o},e(function(i,s,o){r.reason||(r.reason=new Ao(i,s,o),t(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}static source(){let e;return{token:new $f(function(t){e=t}),cancel:e}}}const UT=$f;function FT(n){return function(e){return n.apply(null,e)}}function MT(n){return Z.isObject(n)&&n.isAxiosError===!0}const Zu={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Zu).forEach(([n,e])=>{Zu[e]=n});const qT=Zu;function ab(n){const e=new Aa(n),t=Vv(Aa.prototype.request,e);return Z.extend(t,Aa.prototype,e,{allOwnKeys:!0}),Z.extend(t,e,null,{allOwnKeys:!0}),t.create=function(r){return ab(fs(n,r))},t}const Et=ab(Of);Et.Axios=Aa;Et.CanceledError=Ao;Et.CancelToken=UT;Et.isCancel=ib;Et.VERSION=ob;Et.toFormData=jc;Et.AxiosError=Ke;Et.Cancel=Et.CanceledError;Et.all=function(n){return Promise.all(n)};Et.spread=FT;Et.isAxiosError=MT;Et.mergeConfig=fs;Et.AxiosHeaders=Ar;Et.formToJSON=n=>rb(Z.isHTMLForm(n)?new FormData(n):n);Et.HttpStatusCode=qT;Et.default=Et;const VT=Et,ey={init:({API_KEY:n})=>(...e)=>W(void 0,[...e],function*(t="post",r="/",i={},s={}){var o,a,c,l;const u=localStorage.getItem("accessToken");let h={Accept:"application/json","Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Key":n,"Access-Control-Allow-Methods":"POST, GET, OPTIONS, PUT, DELETE, HEAD,PATCH","Access-Control-Allow-Headers":"X-PINGOTHER, Origin, X-Requested-With, Content-Type, Accept","Access-Control-Max-Age":"1728000"};u&&(h.Authorization="Bearer "+u);const p=r;typeof(i==null?void 0:i.get)=="function"&&(i==null?void 0:i.get("file"))&&(h["Content-Type"]="multipart/form-data"),s!=null&&s.headers&&(h=Object.assign(...h,...s.headers),delete s.headers);const f=Object.assign({mode:"cors",method:t,url:p,data:i,headers:h},s);let d={};try{const y=yield VT(f);d.data=((o=y==null?void 0:y.data)==null?void 0:o.data)||(y==null?void 0:y.data),d.data||(d.data={})}catch(y){d.error=((c=(a=y.response)==null?void 0:a.data)==null?void 0:c.error)||((l=y.response)==null?void 0:l.error),d.error||(d.error={})}return d})};let Jo;const KT=new Uint8Array(16);function WT(){if(!Jo&&(Jo=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Jo))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Jo(KT)}const Ft=[];for(let n=0;n<256;++n)Ft.push((n+256).toString(16).slice(1));function zT(n,e=0){return(Ft[n[e+0]]+Ft[n[e+1]]+Ft[n[e+2]]+Ft[n[e+3]]+"-"+Ft[n[e+4]]+Ft[n[e+5]]+"-"+Ft[n[e+6]]+Ft[n[e+7]]+"-"+Ft[n[e+8]]+Ft[n[e+9]]+"-"+Ft[n[e+10]]+Ft[n[e+11]]+Ft[n[e+12]]+Ft[n[e+13]]+Ft[n[e+14]]+Ft[n[e+15]]).toLowerCase()}const HT=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ty={randomUUID:HT};function Dl(n,e,t){if(ty.randomUUID&&!e&&!n)return ty.randomUUID();n=n||{};const r=n.random||(n.rng||WT)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let i=0;i<16;++i)e[t+i]=r[i];return e}return zT(r)}var cb={exports:{}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function i(c,l,u){this.fn=c,this.context=l,this.once=u||!1}function s(c,l,u,h,p){if(typeof u!="function")throw new TypeError("The listener must be a function");var f=new i(u,h||c,p),d=t?t+l:l;return c._events[d]?c._events[d].fn?c._events[d]=[c._events[d],f]:c._events[d].push(f):(c._events[d]=f,c._eventsCount++),c}function o(c,l){--c._eventsCount===0?c._events=new r:delete c._events[l]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var c=[],l,u;if(this._eventsCount===0)return c;for(u in l=this._events)e.call(l,u)&&c.push(t?u.slice(1):u);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(l)):c},a.prototype.listeners=function(c){var l=t?t+c:c,u=this._events[l];if(!u)return[];if(u.fn)return[u.fn];for(var h=0,p=u.length,f=new Array(p);h<p;h++)f[h]=u[h].fn;return f},a.prototype.listenerCount=function(c){var l=t?t+c:c,u=this._events[l];return u?u.fn?1:u.length:0},a.prototype.emit=function(c,l,u,h,p,f){var d=t?t+c:c;if(!this._events[d])return!1;var y=this._events[d],_=arguments.length,S,I;if(y.fn){switch(y.once&&this.removeListener(c,y.fn,void 0,!0),_){case 1:return y.fn.call(y.context),!0;case 2:return y.fn.call(y.context,l),!0;case 3:return y.fn.call(y.context,l,u),!0;case 4:return y.fn.call(y.context,l,u,h),!0;case 5:return y.fn.call(y.context,l,u,h,p),!0;case 6:return y.fn.call(y.context,l,u,h,p,f),!0}for(I=1,S=new Array(_-1);I<_;I++)S[I-1]=arguments[I];y.fn.apply(y.context,S)}else{var B=y.length,j;for(I=0;I<B;I++)switch(y[I].once&&this.removeListener(c,y[I].fn,void 0,!0),_){case 1:y[I].fn.call(y[I].context);break;case 2:y[I].fn.call(y[I].context,l);break;case 3:y[I].fn.call(y[I].context,l,u);break;case 4:y[I].fn.call(y[I].context,l,u,h);break;default:if(!S)for(j=1,S=new Array(_-1);j<_;j++)S[j-1]=arguments[j];y[I].fn.apply(y[I].context,S)}}return!0},a.prototype.on=function(c,l,u){return s(this,c,l,u,!1)},a.prototype.once=function(c,l,u){return s(this,c,l,u,!0)},a.prototype.removeListener=function(c,l,u,h){var p=t?t+c:c;if(!this._events[p])return this;if(!l)return o(this,p),this;var f=this._events[p];if(f.fn)f.fn===l&&(!h||f.once)&&(!u||f.context===u)&&o(this,p);else{for(var d=0,y=[],_=f.length;d<_;d++)(f[d].fn!==l||h&&!f[d].once||u&&f[d].context!==u)&&y.push(f[d]);y.length?this._events[p]=y.length===1?y[0]:y:o(this,p)}return this},a.prototype.removeAllListeners=function(c){var l;return c?(l=t?t+c:c,this._events[l]&&o(this,l)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,n.exports=a})(cb);const JT=cb.exports;var YT={exports:{}};(function(n,e){(function(t){var r=this,i=Object.prototype.hasOwnProperty,s=function(c){for(var l=new Array(c.length),u=c.length,h=u-1;u--;)l[h-u]=c[u];return l},o=function(){var c=Array.prototype.slice.call(arguments);return c.length==2?o.find.apply(this,c):o.transform.apply(this,c)};o.find=function(c,l){return o.get(l,c)},o.memoizePath=!0;var a={};o.get=function(c,l,u){if(c===t||c===null||l===t||l===null)return u;var h;for(typeof l=="string"?o.memoizePath?a[l]?h=a[l].slice(0):(h=l.split(".").reverse(),a[l]=h.slice(0)):h=l.split(".").reverse():Array.isArray(l)&&(h=s(l));h.length&&(c=c[h.pop()])!==t&&c!==null;);return c===null&&h.length&&(c=t),c===t?u:c},o.exists=function(c,l){return o.get(c,l)!==t},o.set=function(c,l,u,h){var p=Array.isArray(l)?l:l.split("."),f=c,d,y=p.length;if(typeof f!="object")throw new Error("Parent is not an object.");for(var _=0;_<y;_++)if(d=p[_],(!i.call(f,d)||f[d]===t||(typeof f[d]!="object"||f[d]===null)&&h&&h.force===!0)&&(f[d]={}),_==y-1)f[d]=u;else{if(typeof f[d]!="object"||f[d]===null)throw new Error('Target key "'+d+'" is not suitable for a nested value. (It is in use as non-object. Set `force` to `true` to override.)');f=f[d]}f[d]=u},o.default=function(c,l,u){o.get(c,l)===t&&o.set(c,l,u)},o.transform=function(c,l){if(Array.isArray(c))return c.map(function(j){return o.transform(j,l)});l=l||{},l.delimiter=l.delimiter||".";var u,h,p,f,d={},y,_=Object.keys(c),S=_.length,I;for(I=0;I<S;I++)if(y=_[I],y.indexOf(l.delimiter)!==-1){u=y.split(l.delimiter),h=u.length,f=d;for(var B=0;B<h&&(p=u[B],B!=h-1&&!f.hasOwnProperty(p)&&(f[p]={}),B==h-1&&(f[p]=c[y]),f=f[p],f!==null);B++);}else d[y]=c[y];return d},o.flatten=function(c,l){typeof l=="undefined"&&(l=".");var u={},h,p;for(var f in c)if(i.call(c,f))if(h=c[f],Object.prototype.toString.call(h)==="[object Object]"){p=o.flatten(h,l);for(var d in p)u[f+l+d]=p[d]}else u[f]=h;return u},o.paths=function(c,l){var u=[],h,p;if(l=l||[],typeof c=="object")for(p in c)h=c[p],typeof h=="object"&&h!==null?u=u.concat(o.paths(h,l.concat([p]))):u.push(l.concat(p).join("."));else throw new Error("Paths was called with non-object argument.");return u},n.exports?n.exports=o:(r.Dottie=o,r.Dot=o,typeof t=="function"&&t([],function(){return o}))})()})(YT);function Ul(n,e){try{n(e)}catch(t){console.error("Error in subscription callback",t)}}const Hr=Symbol("subscriptions"),Jr=Symbol("oneTimeEvents");class ds{constructor(){this[Hr]=[],this[Jr]=new Map}on(e,t){return this[Jr].has(e)?Ul(t,this[Jr].get(e)):(this[Hr].push({event:e,callback:t,once:!1}),this)}off(e,t){return this[Hr]=this[Hr].filter(r=>r.event!==e||t&&r.callback!==t),this}once(e,t){return new Promise(r=>{const i=s=>{r(s),t==null||t(s)};this[Jr].has(e)?Ul(i,this[Jr].get(e)):this[Hr].push({event:e,callback:i,once:!0})})}emit(e,t){if(this[Jr].has(e))throw new Error(`Event "${e}" was supposed to be emitted only once`);for(let r=0;r<this[Hr].length;r++){const i=this[Hr][r];i.event===e&&(Ul(i.callback,t),i.once&&(this[Hr].splice(r,1),r--))}return this}emitOnce(e,t){if(this[Jr].has(e))throw new Error(`Event "${e}" was supposed to be emitted only once`);return this.emit(e,t),this[Jr].set(e,t),this.off(e),this}pipe(e,t){this.on(e,r=>{t.emit(e,r)})}pipeOnce(e,t){this.once(e,r=>{t.emitOnce(e,r)})}}function Yr(n){return n=n.replace(/\[/g,"/[").replace(/^\/+/,"").replace(/\/+$/,""),n.length===0?[]:n.split("/").map(e=>e.startsWith("[")?parseInt(e.slice(1,-1)):e)}class Y{static get(e){return new Y(e)}static getChildPath(e,t){return Y.get(e).child(t).path}static getPathKeys(e){return Yr(e)}constructor(e){typeof e=="string"?this.keys=Yr(e):e instanceof Array&&(this.keys=e),this.path=this.keys.reduce((t,r,i)=>i===0?`${r}`:typeof r=="string"?`${t}/${r}`:`${t}[${r}]`,"")}get key(){return this.keys.length===0?null:this.keys.slice(-1)[0]}get parent(){if(this.keys.length==0)return null;const e=this.keys.slice(0,-1);return new Y(e)}get parentPath(){return this.keys.length===0?null:this.parent.path}child(e){if(typeof e=="string"){if(e.length===0)throw new Error(`child key for path "${this.path}" cannot be empty`);const t=Yr(e);t.forEach(r=>{if(typeof r=="string"){if(/[\x00-\x08\x0b\x0c\x0e-\x1f/[\]\\]/.test(r))throw new Error(`Invalid child key "${r}" for path "${this.path}". Keys cannot contain control characters or any of the following characters: \\ / [ ]`);if(r.length>128)throw new Error(`child key "${r}" for path "${this.path}" is too long. Max key length is 128`);if(r.length===0)throw new Error(`child key for path "${this.path}" cannot be empty`)}}),e=t}return new Y(this.keys.concat(e))}childPath(e){return this.child(e).path}get pathKeys(){return this.keys}static extractVariables(e,t){if(!e.includes("*")&&!e.includes("$"))return[];const r=Yr(e),i=Yr(t);let s=0;const o={get length(){return s}};return r.forEach((a,c)=>{const l=i[c];if(a==="*")o[s++]=l;else if(typeof a=="string"&&a[0]==="$"){o[s++]=l,o[a]=l;const u=a.slice(1);typeof o[u]=="undefined"&&(o[u]=l)}}),o}static fillVariables(e,t){if(e.indexOf("*")<0&&e.indexOf("$")<0)return e;const r=Yr(e),i=Yr(t),s=r.map((a,c)=>{if(a===i[c]||c>=i.length)return a;if(typeof a=="string"&&(a==="*"||a[0]==="$"))return i[c];throw new Error(`Path "${t}" cannot be used to fill variables of path "${e}" because they do not match`)});let o="";return s.forEach(a=>{typeof a=="number"?o+=`[${a}]`:(o.length>0&&(o+="/"),o+=a)}),o}static fillVariables2(e,t){if(typeof t!="object"||Object.keys(t).length===0)return e;const r=Yr(e);let i=0;return r.reduce((s,o)=>typeof o=="string"&&(o==="*"||o.startsWith("$"))?Y.getChildPath(s,t[i++]):Y.getChildPath(s,o),"")}equals(e){const t=e instanceof Y?e:new Y(e);return this.path===t.path?!0:this.keys.length!==t.keys.length?!1:this.keys.every((r,i)=>{const s=t.keys[i];return s===r||typeof s=="string"&&(s==="*"||s[0]==="$")||typeof r=="string"&&(r==="*"||r[0]==="$")})}isAncestorOf(e){const t=e instanceof Y?e:new Y(e);return t.path===""||this.path===t.path?!1:this.path===""?!0:this.keys.length>=t.keys.length?!1:this.keys.every((r,i)=>{const s=t.keys[i];return s===r||typeof s=="string"&&(s==="*"||s[0]==="$")||typeof r=="string"&&(r==="*"||r[0]==="$")})}isDescendantOf(e){const t=e instanceof Y?e:new Y(e);return this.path===""||this.path===t.path?!1:e===""?!0:t.keys.length>=this.keys.length?!1:t.keys.every((r,i)=>{const s=this.keys[i];return s===r||typeof s=="string"&&(s==="*"||s[0]==="$")||typeof r=="string"&&(r==="*"||r[0]==="$")})}isOnTrailOf(e){const t=e instanceof Y?e:new Y(e);return this.path.length===0||t.path.length===0||this.path===t.path?!0:this.pathKeys.every((r,i)=>{if(i>=t.keys.length)return!0;const s=t.keys[i];return s===r||typeof s=="string"&&(s==="*"||s[0]==="$")||typeof r=="string"&&(r==="*"||r[0]==="$")})}isChildOf(e){const t=e instanceof Y?e:new Y(e);return this.path===""?!1:this.parent.equals(t)}isParentOf(e){const t=e instanceof Y?e:new Y(e);return t.path===""?!1:this.equals(t.parent)}}function Fl(n,e,t=!1){if(!n.exists())return null;let r=t?n.previous():n.val();return typeof e=="number"?r[e]:(Y.getPathKeys(e).every(i=>(r=r[i],typeof r!="undefined")),r||null)}function Ml(n){if(!n.exists())return[];const e=n.val();return e instanceof Array?new Array(e.length).map((t,r)=>r):typeof e=="object"?Object.keys(e):[]}class st{exists(){return!1}constructor(e,t,r=!1,i,s){this.ref=e,this.val=()=>t,this.previous=()=>i,this.exists=()=>r?!1:t!==null&&typeof t!="undefined",this.context=()=>s||{}}static for(e,t){return new st(e,t)}child(e){const t=Fl(this,e,!1),r=Fl(this,e,!0);return new st(this.ref.child(e),t,!1,r)}hasChild(e){return Fl(this,e)!==null}hasChildren(){return Ml(this).length>0}numChildren(){return Ml(this).length}forEach(e){const t=this.val(),r=this.previous();return Ml(this).every(i=>{const s=new st(this.ref.child(i),t[i],!1,r[i]);return e(s)})}get key(){return this.ref.key}}class Oa extends st{constructor(e,t,r){super(e,t,!1,void 0,r),this.previous=()=>{throw new Error("Iterate values to get previous values for each mutation")},this.val=(i=!0)=>(i&&console.warn("Unless you know what you are doing, it is best not to use the value of a mutations snapshot directly. Use child methods and forEach to iterate the mutations instead"),t)}forEach(e){return this.val(!1).every(t=>{const r=t.target.reduce((s,o)=>s.child(o),this.ref),i=new st(r,t.val,!1,t.prev);return e(i)})}child(e){if(typeof e!="number")throw new Error("child index must be a number");const t=this.val(!1)[e],r=t.target.reduce((i,s)=>i.child(s),this.ref);return new st(r,t.val,!1,t.prev)}}class lb{constructor(e){this.stop=e,this._internal={state:"init",activatePromises:[]}}activated(e){return e&&(this._internal.activatePromises.push({callback:e}),this._internal.state==="active"?e(!0):this._internal.state==="canceled"&&e(!1,this._internal.cancelReason)),new Promise((t,r)=>{if(this._internal.state==="active")return t();if(this._internal.state==="canceled"&&!e)return r(new Error(this._internal.cancelReason));const i=()=>{};this._internal.activatePromises.push({resolve:t,reject:e?i:r})})}_setActivationState(e,t){for(this._internal.cancelReason=t,this._internal.state=e?"active":"canceled";this._internal.activatePromises.length>0;){const r=this._internal.activatePromises.shift();e?(r.callback&&r.callback(!0),r.resolve&&r.resolve()):(r.callback&&r.callback(!1,t),r.reject&&r.reject(t))}}}class GT{constructor(e,t,r){this.publish=e,this.start=t,this.cancel=r}}class QT{constructor(e){const t=[];let r,i;const s="stopped (no more subscribers)";this.subscribe=(h,p)=>{if(typeof h!="function")throw new TypeError("callback must be a function");if(i===s)throw new Error("stream can't be used anymore because all subscribers were stopped");const f={callback:h,activationCallback:function(d,y){p==null||p(d,y),this.subscription._setActivationState(d,y)},subscription:new lb(function(){return t.splice(t.indexOf(this),1),o()})};return t.push(f),typeof i!="undefined"&&(i===!0?(p==null||p(!0),f.subscription._setActivationState(!0)):typeof i=="string"&&(p==null||p(!1,i),f.subscription._setActivationState(!1,i))),f.subscription};const o=()=>{let h;return t.length===0&&(h=r==null?void 0:r(),i=s),Promise.resolve(h)};this.unsubscribe=h=>{(h?t.filter(p=>p.callback===h):t).forEach(p=>{const f=t.indexOf(p);t.splice(f,1)}),o()},this.stop=()=>{t.splice(0),o()};const a=h=>(t.forEach(p=>{try{p.callback(h)}catch(f){console.error(`Error running subscriber callback: ${f.message}`)}}),t.length===0&&o(),t.length>0),c=h=>{i=!0,r=h,t.forEach(p=>{var f;(f=p.activationCallback)==null||f.call(p,!0)})},l=h=>{i=h,t.forEach(p=>{var f;(f=p.activationCallback)==null||f.call(p,!1,h||new Error("unknown reason"))}),t.splice(0)},u=new GT(a,c,l);e(u)}}function Tf(n,e){const t="000000000"+n;return t.substr(t.length-e)}const XT=typeof window=="object"?window:self,ZT=Object.keys(XT).length;var ny,ry;const eP=(ry=(ny=navigator.mimeTypes)==null?void 0:ny.length)!=null?ry:0,tP=Tf((eP+navigator.userAgent.length).toString(36)+ZT.toString(36),4);function nP(){return tP}let Rs=0;const Pf=4,Xa=36,ub=Math.pow(Xa,Pf);function iy(){return Tf((Math.random()*ub<<0).toString(Xa),Pf)}function rP(){return Rs=Rs<ub?Rs:0,Rs++,Rs-1}function iP(n=0){const e="c",t=(new Date().getTime()+n).toString(Xa),r=Tf(rP().toString(Xa),Pf),i=nP(),s=iy()+iy();return e+t+r+i+s}let sy=0;class Kt{static set timeBias(e){typeof e=="number"&&(sy=e)}static generate(){return iP(sy).slice(1)}}class ot{constructor(e){this.path=e}}const In={nextTick(n){setTimeout(n,0)}};class Za{constructor(e){if(e instanceof Array)for(let t=0;t<e.length;t++)typeof e[t]!="undefined"&&(this[t]=e[t]);else e&&Object.assign(this,e)}}function sP(n){const e=new Uint8Array(8);return new DataView(e.buffer).setFloat64(0,n),new Array(...e)}function oP(n){if((Array.isArray(n)?n.length:n.byteLength)!==8)throw new TypeError("must be 8 bytes");const e=new Uint8Array(n);return new DataView(e.buffer).getFloat64(0)}const ri={zero:BigInt(0),one:BigInt(1),two:BigInt(2),eight:BigInt(8),ff:BigInt(255)};function aP(n){if(typeof n!="bigint")throw new Error("number must be a bigint");const e=[],t=n<ri.zero;do{const r=Number(n&ri.ff);e.push(r),n=n>>ri.eight}while(n!==(t?-ri.one:ri.zero));return e.reverse(),(t?e[0]<128:e[0]>=128)&&e.unshift(t?255:0),e}function cP(n){const e=n[0]>=128;let t=ri.zero;for(let r of n)e&&(r=~r&255),t=(t<<ri.eight)+BigInt(r);return e&&(t=-(t+ri.one)),t}function lP(n){if(typeof TextEncoder!="undefined")return new TextEncoder().encode(n);if(typeof Buffer=="function"){const e=Buffer.from(n,"utf-8");return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}else{const e=[];for(let t=0;t<n.length;t++){let r=n.charCodeAt(t);if(r>128){if((r&55296)===55296){const i=n.charCodeAt(t+1);if((i&56320)!==56320)throw new Error("follow-up utf-16 character does not start with 0xDC00");t++;const s=r&1023,o=i&1023;r=65536|s<<10|o}if(r<2048){const i=192|r>>6&31,s=128|r&63;e.push(i,s)}else if(r<65536){const i=224|r>>12&15,s=128|r>>6&63,o=128|r&63;e.push(i,s,o)}else if(r<2097152){const i=240|r>>18&7,s=128|r>>12&63,o=128|r>>6&63,a=128|r&63;e.push(i,s,o,a)}else throw new Error(`Cannot convert character ${n.charAt(t)} (code ${r}) to utf-8`)}else e.push(r<128?r:63)}return new Uint8Array(e)}}function hb(n){if(typeof TextDecoder!="undefined"){const e=new TextDecoder;if(n instanceof Uint8Array)return e.decode(n);const t=Uint8Array.from(n);return e.decode(t)}else if(typeof Buffer=="function"){if(n instanceof Array&&(n=Uint8Array.from(n)),!(n instanceof Buffer)&&"buffer"in n&&n.buffer instanceof ArrayBuffer){const e=n;n=Buffer.from(e.buffer,e.byteOffset,e.byteLength)}if(!(n instanceof Buffer))throw new Error("Unsupported buffer argument");return n.toString("utf-8")}else{if(!(n instanceof Uint8Array)&&"buffer"in n&&n.buffer instanceof ArrayBuffer){const e=n;n=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}if(n instanceof Buffer||n instanceof Array||n instanceof Uint8Array){let e="";for(let t=0;t<n.length;t++){let r=n[t];if(r>128)if((r&240)===240){const i=r,s=n[t+1],o=n[t+2],a=n[t+3];r=(i&7)<<18|(s&63)<<12|(o&63)<<6|a&63,t+=3}else if((r&224)===224){const i=r,s=n[t+1],o=n[t+2];r=(i&15)<<12|(s&63)<<6|o&63,t+=2}else if((r&192)===192){const i=r,s=n[t+1];r=(i&31)<<6|s&63,t++}else throw new Error("invalid utf-8 data");if(r>=65536){r^=65536;const i=55296|r>>10,s=56320|r&1023;e+=String.fromCharCode(i),e+=String.fromCharCode(s)}else e+=String.fromCharCode(r)}return e}else throw new Error("Unsupported buffer argument")}}function uP(n,e){const t=new n.constructor(n.length+e.length);return t.set(n),t.set(e,n.length),t}function zn(n,e){var t;if(((t=n==null?void 0:n.constructor)==null?void 0:t.name)==="DataSnapshot")throw new TypeError(`Object to clone is a DataSnapshot (path "${n.ref.path}")`);const r=o=>(o!==null&&typeof o=="object"&&typeof o.constructor=="function"&&typeof o.constructor.name=="string"&&["Buffer","Uint8Array","Int8Array","Uint16Array","Int16Array","Uint32Array","Int32Array","BigUint64Array","BigInt64Array"].includes(o.constructor.name)&&(o=o.buffer.slice(o.byteOffset,o.byteOffset+o.byteLength)),o);if(n=r(n),typeof n!="object"||n===null||n instanceof Date||n instanceof ArrayBuffer||n instanceof ot||n instanceof RegExp)return n;const i=o=>{if(e.indexOf(o)>=0)throw new ReferenceError("object contains a circular reference");return o=r(o),o===null||o instanceof Date||o instanceof ArrayBuffer||o instanceof ot||o instanceof RegExp||typeof o=="object"&&(e.push(o),o=zn(o,e),e.pop()),o};typeof e=="undefined"&&(e=[n]);const s=n instanceof Array?[]:n instanceof Za?new Za:{};return Object.keys(n).forEach(o=>{const a=n[o];typeof a!="function"&&(s[o]=i(a))}),s}const li=n=>typeof n=="object"&&["ArrayBuffer","Buffer","Uint8Array","Uint16Array","Uint32Array","Int8Array","Int16Array","Int32Array"].includes(n.constructor.name);function ec(n,e){if(n===e)return!0;if(typeof n!=typeof e)return!1;if(typeof n=="object"||typeof e=="object"){if(n===null||e===null)return!1;if(n instanceof ot||e instanceof ot)return n instanceof ot&&e instanceof ot&&n.path===e.path;if(n instanceof Date||e instanceof Date)return n instanceof Date&&e instanceof Date&&n.getTime()===e.getTime();if(n instanceof Array||e instanceof Array)return n instanceof Array&&e instanceof Array&&n.length===e.length&&n.every((i,s)=>ec(n[s],e[s]));if(li(n)||li(e)){if(!li(n)||!li(e)||n.byteLength===e.byteLength)return!1;const i=n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength),s=e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength);return i.every((o,a)=>s[a]===o)}const t=Object.keys(n),r=Object.keys(e);return t.length===r.length&&t.every(i=>r.includes(i))&&t.every(i=>ec(n[i],e[i]))}return!1}class fb{constructor(e,t,r){this.added=e,this.removed=t,this.changed=r}forChild(e){if(this.added.includes(e))return"added";if(this.removed.includes(e))return"removed";const t=this.changed.find(r=>r.key===e);return t?t.change:"identical"}}function If(n,e,t=!1){const r=[void 0,null];if(n===e)return"identical";if(r.indexOf(n)>=0&&r.indexOf(e)<0)return"added";if(r.indexOf(n)<0&&r.indexOf(e)>=0)return"removed";if(typeof n!=typeof e)return"changed";if(li(n)||li(e)){if(!li(n)||!li(e))return"changed";const i=n instanceof Uint8Array?n:n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength),s=e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength);return i.byteLength===s.byteLength&&i.every((o,a)=>s[a]===o)?"identical":"changed"}else{if(n instanceof Date||e instanceof Date)return n instanceof Date&&e instanceof Date&&n.getTime()===e.getTime()?"identical":"changed";if(n instanceof ot||e instanceof ot)return n instanceof ot&&e instanceof ot&&n.path===e.path?"identical":"changed";if(typeof n=="object"){const i=n instanceof Array,s=h=>{let p=Object.keys(h).filter(f=>!r.includes(h[f]));return i&&(p=p.map(f=>parseInt(f))),p},o=s(n),a=s(e),c=o.filter(h=>!a.includes(h)),l=a.filter(h=>!o.includes(h)),u=a.reduce((h,p)=>{if(o.includes(p)){const f=n[p],d=e[p],y=If(f,d);y!=="identical"&&h.push({key:p,change:y})}return h},[]);return l.length===0&&c.length===0&&u.length===0?"identical":new fb(l,c,t?u.sort((h,p)=>h.key<p.key?-1:1):u)}}return"changed"}function db(n,e,t=!1){const r=(s,o,a,c)=>{switch(o){case"identical":return[];case"changed":return[{target:s,prev:a,val:c}];case"added":return[{target:s,prev:null,val:c}];case"removed":return[{target:s,prev:a,val:null}];default:{let l=[];return o.added.forEach(u=>l.push({target:s.concat(u),prev:null,val:c[u]})),o.removed.forEach(u=>l.push({target:s.concat(u),prev:a[u],val:null})),o.changed.forEach(u=>{const h=r(s.concat(u.key),u.change,a[u.key],c[u.key]);l=l.concat(h)}),l}}},i=If(n,e,t);return r([],i,n,e)}function hP(n,e,t){return e=e===null?null:e[n],typeof e=="undefined"&&(e=null),t=t===null?null:t[n],typeof t=="undefined"&&(t=null),{oldValue:e,newValue:t}}function fP(n){In.nextTick(n)}function pb(){var n;return typeof globalThis!="undefined"?globalThis:typeof global!="undefined"?global:typeof window!="undefined"?window:typeof self!="undefined"?self:(n=function(){return this}())!=null?n:Function("return this")()}const yb=Object.freeze(Object.defineProperty({__proto__:null,numberToBytes:sP,bytesToNumber:oP,bigintToBytes:aP,bytesToBigint:cP,encodeString:lP,decodeString:hb,concatTypedArrays:uP,cloneObject:zn,valuesAreEqual:ec,ObjectDifferences:fb,compareValues:If,getMutations:db,getChildValues:hP,defer:fP,getGlobalObject:pb},Symbol.toStringTag,{value:"Module"})),dP="modulepreload",pP=function(n){return"/"+n},oy={},yP=function(n,e,t){if(!e||e.length===0)return n();const r=document.getElementsByTagName("link");return Promise.all(e.map(i=>{if(i=pP(i),i in oy)return;oy[i]=!0;const s=i.endsWith(".css"),o=s?'[rel="stylesheet"]':"";if(t)for(let c=r.length-1;c>=0;c--){const l=r[c];if(l.href===i&&(!s||l.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${o}`))return;const a=document.createElement("link");if(a.rel=s?"stylesheet":dP,s||(a.as="script",a.crossOrigin=""),a.href=i,document.head.appendChild(a),s)return new Promise((c,l)=>{a.addEventListener("load",c),a.addEventListener("error",()=>l(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>n())};let gb=!1,fi;W(void 0,null,function*(){const n=pb();if(typeof n.Observable!="undefined"){fi=n.Observable;return}try{const{Observable:e}=yield yP(()=>Promise.resolve().then(()=>dN),void 0);fi=e}catch(e){fi=Cf}});function Rf(){if(fi===Cf&&!gb&&console.warn(`Using AceBase's simple Observable implementation because rxjs is not available. Add it to your project with "npm install rxjs", add it to AceBase using db.setObservable(Observable), or call db.setObservable("shim") to suppress this warning`),fi)return fi;throw new Error("RxJS Observable could not be loaded. ")}function gP(n){n==="shim"?(fi=Cf,gb=!0):fi=n}class Cf{constructor(e){this._active=!1,this._subscribers=[],this._create=e}subscribe(e){if(!this._active){const t={next:r=>{this._subscribers.forEach(i=>{try{i(r)}catch(s){console.error("Error in subscriber callback:",s)}})}};this._cleanup=this._create(t),this._active=!0}return this._subscribers.push(e),{unsubscribe:()=>{this._subscribers.splice(this._subscribers.indexOf(e),1),this._subscribers.length===0&&(this._active=!1,this._cleanup())}}}}class kn extends Array{static areEqual(e,t){return e.length===t.length&&e.every((r,i)=>t[i]===r)}static isAncestor(e,t){return e.length<t.length&&e.every((r,i)=>t[i]===r)}static isDescendant(e,t){return e.length>t.length&&t.every((r,i)=>e[i]===r)}}const _i=Symbol("isProxy");class mP{static create(e,t){return W(this,null,function*(){var r;e=new Gn(e.db,e.path);let i,s=!1,o=t==null?void 0:t.cursor,a;const c=Kt.generate(),l=[],u=new ds;u.on("cursor",m=>o=m),u.on("error",m=>{console.error(m.message,m.details)});const h=(m,v)=>{if(m.length===0)return i=v,!0;let g=i;const k=m.slice();for(;k.length>1;){const b=k.shift();if(!(b in g))return!1;g=g[b]}const x=k.shift();return v===null?g instanceof Array?g.splice(x,1):delete g[x]:g[x]=v,!0},p=()=>W(this,null,function*(){!s||(yield E())}),f=e.on("mutations",{syncFallback:p}).subscribe(m=>W(this,null,function*(){var v;if(!s)return;const g=m.context(),k=((v=g.acebase_proxy)==null?void 0:v.id)!==c;!k||(m.val(!1).every(x=>{if(!h(x.target,x.val))return!1;const b=x.target.reduce((A,O)=>A.child(O),e),w=new st(b,x.val,!1,x.prev,m.context());return u.emit("mutation",{snapshot:w,isRemote:k}),!0})?(u.emit("cursor",g.acebase_cursor),L.emit("mutations",{origin:"remote",snap:m})):(console.warn(`Cached value of live data proxy on "${e.path}" appears outdated, will be reloaded`),yield E()))}));let d=Promise.resolve();const y=[],_=[],S=()=>W(this,null,function*(){const m=[];for(let v=0,g=y[0];v<y.length;v++,g=y[v])_.find(k=>kn.areEqual(k.target,g.target)||kn.isAncestor(k.target,g.target))||(y.splice(v,1),v--,m.push(g));m.length!==0&&(m.forEach(v=>{v.value=zn(On(i,v.target))}),In.nextTick(()=>{const v={acebase_proxy:{id:c,source:"update"}};m.forEach(k=>{const x=k.target.reduce((w,A)=>w.child(A),e),b=new st(x,k.value,!1,k.previous,v);u.emit("mutation",{snapshot:b,isRemote:!1})});const g=new Oa(e,m.map(k=>({target:k.target,val:k.value,prev:k.previous})),v);L.emit("mutations",{origin:"local",snap:g})}),d=m.reduce((v,g,k,x)=>(x.some(b=>kn.isAncestor(b.target,g.target))||v.push(g),v),[]).reduce((v,g)=>{const k=g.target;if(k.length===0)v.push({ref:e,target:k,value:i,type:"set",previous:g.previous});else{const x=k.slice(0,-1),b=k.slice(-1)[0],w=x.reduce((P,N)=>P.child(N),e),A=v.find(P=>P.ref.path===w.path),O=On(i,k),$=g.previous;A?(A.value[b]=O,A.previous[b]=$):v.push({ref:w,target:x,value:{[b]:O},type:"update",previous:{[b]:$}})}return v},[]).reduce((v,g)=>W(this,null,function*(){const k={acebase_proxy:{id:c,source:g.type}};yield v,yield g.ref.context(k)[g.type](g.value).catch(x=>{u.emit("error",{source:"update",message:`Error processing update of "/${e.path}"`,details:x});const b={acebase_proxy:{id:c,source:"update-rollback"}},w=[];if(g.type==="set"){ql(i,g.target,g.previous);const O=new st(g.ref,g.previous,!1,g.value,b);u.emit("mutation",{snapshot:O,isRemote:!1}),w.push({target:g.target,val:g.previous,prev:g.value})}else Object.keys(g.previous).forEach(O=>{ql(i,g.target.concat(O),g.previous[O]);const $=new st(g.ref.child(O),g.previous[O],!1,g.value[O],b);u.emit("mutation",{snapshot:$,isRemote:!1}),w.push({target:g.target.concat(O),val:g.previous[O],prev:g.value[O]})});w.forEach(O=>{const $=O.target.reduce((N,D)=>N.child(D),e),P=new st($,O.val,!1,O.prev,b);u.emit("mutation",{snapshot:P,isRemote:!1})});const A=new Oa(g.ref,w,b);L.emit("mutations",{origin:"local",snap:A})}),g.ref.cursor&&u.emit("cursor",g.ref.cursor)}),d),yield d)});let I=!1;const B=[],j=()=>{let m;const v=new Promise(g=>m=g);return B.push({resolve:m}),v};let U=null;const M=()=>{U||(U=setTimeout(()=>W(this,null,function*(){I=!0,U=null,yield S(),I=!1,B.splice(0).forEach(m=>m.resolve())}),0))},H=m=>{y.find(v=>kn.areEqual(v.target,m))||y.push({target:m,previous:zn(On(i,m))}),M()},L=new ds,F=(m,v)=>{const g=b=>b!==null&&typeof b=="object",k=b=>W(this,null,function*(){var w;const{snap:A,origin:O}=b,$=A.context(),P=((w=$.acebase_proxy)==null?void 0:w.id)===c;if(b.origin==="remote"&&P){console.error("DEV ISSUE: mutationsHandler was called from remote event originating from our own proxy");return}const N=A.val(!1).filter(ne=>ne.target.slice(0,m.length).every((te,ue)=>m[ue]===te));if(N.length===0)return;let D,z;const q=N.find(ne=>ne.target.length<=m.length);if(q){const ne=m.slice(q.target.length);D=ne.reduce((te,ue)=>!g(te)||!(ue in te)?null:te[ue],q.val),z=ne.reduce((te,ue)=>!g(te)||!(ue in te)?null:te[ue],q.prev)}else{const ne=On(i,m);D=zn(ne),z=zn(D),N.forEach(te=>{const ue=te.target.slice(m.length);for(let le=0,ie=D,pe=z;le<ue.length;le++){const ke=le+1===ue.length,ve=ue[le];ke?(ie[ve]=te.val,ie[ve]===null&&delete ie[ve],pe[ve]=te.prev,pe[ve]===null&&delete pe[ve]):(ie=ie[ve]=ve in ie?ie[ve]:{},pe=pe[ve]=ve in pe?pe[ve]:{})}})}In.nextTick(()=>{let ne=!0;try{ne=v(Object.freeze(D),Object.freeze(z),!P,$)!==!1}catch(te){u.emit("error",{source:O==="remote"?"remote_update":"local_update",message:"Error running subscription callback",details:te})}ne===!1&&x()})});L.on("mutations",k);const x=()=>{L.off("mutations",k),l.splice(l.findIndex(b=>b.stop===x),1)};return l.push({target:m,stop:x}),{stop:x}},T=(m,v,g)=>{if(m==="write")return H(v);if(m==="onChange")return F(v,g.callback);if(m==="subscribe"||m==="observe"){const k=b=>{const w=On(i,v);b.next(w);const A=F(v,O=>{b.next(O)});return function(){A.stop()}};if(m==="subscribe")return k;const x=Rf();return new x(k)}else if(m==="transaction")return _.some(k=>kn.areEqual(v,k.target)||kn.isAncestor(v,k.target)||kn.isDescendant(v,k.target))?Promise.reject(new Error("Cannot start transaction because it conflicts with another transaction")):new Promise(k=>W(this,null,function*(){y.some(b=>kn.areEqual(v,b.target)||kn.isAncestor(v,b.target))&&(I||M(),yield j());const x={target:v,status:"started",transaction:null};_.push(x),x.transaction={get status(){return x.status},get completed(){return x.status!=="started"},get mutations(){return y.filter(b=>kn.areEqual(x.target,b.target)||kn.isAncestor(x.target,b.target))},get hasMutations(){return this.mutations.length>0},commit(){return W(this,null,function*(){if(this.completed)throw new Error(`Transaction has completed already (status '${x.status}')`);x.status="finished",_.splice(_.indexOf(x),1),I&&(yield j()),M(),yield j()})},rollback(){if(this.completed)throw new Error(`Transaction has completed already (status '${x.status}')`);x.status="canceled";const b=[];for(let w=0;w<y.length;w++){const A=y[w];(kn.areEqual(x.target,A.target)||kn.isAncestor(x.target,A.target))&&(y.splice(w,1),w--,b.push(A))}b.reverse().forEach(w=>{w.target.length===0?i=w.previous:ql(i,w.target,w.previous)}),_.splice(_.indexOf(x),1)}},k(x.transaction)}))},R=yield e.get({cache_mode:"allow",cache_cursor:t==null?void 0:t.cursor});if(R.context().acebase_origin!=="cache"&&u.emit("cursor",(r=e.cursor)!=null?r:null),s=!0,i=R.val(),i===null&&typeof(t==null?void 0:t.defaultValue)!="undefined"){i=t.defaultValue;const m={acebase_proxy:{id:c,source:"default"}};yield e.context(m).set(i)}a=mb({root:{ref:e,get cache(){return i}},target:[],id:c,flag:T});const C=()=>{if(a===null)throw new Error("Proxy was destroyed")},E=()=>W(this,null,function*(){C(),y.splice(0);const m=yield e.get({allow_cache:!1}),v=i,g=m.val();i=g;const k=db(v,g);if(k.length===0)return;const x=m.context();x.acebase_proxy={id:c,source:"reload"},k.forEach(w=>{const A=eh(e,w.target),O=new st(A,w.val,w.val===null,w.prev,x);u.emit("mutation",{snapshot:O,isRemote:!0})});const b=new Oa(e,k,x);L.emit("mutations",{origin:"local",snap:b})});return{destroy(){return W(this,null,function*(){yield d;const m=[f.stop(),...l.map(v=>v.stop())];yield Promise.all(m),["cursor","mutation","error"].forEach(v=>u.off(v)),i=null,a=null})},stop(){this.destroy()},get value(){return C(),a},get hasValue(){return C(),i!==null},set value(m){C(),m!==null&&typeof m=="object"&&m[_i]&&(m=m.valueOf()),H([]),i=m},get ref(){return e},get cursor(){return o},reload:E,onMutation(m){C(),u.off("mutation"),u.on("mutation",({snapshot:v,isRemote:g})=>{try{m(v,g)}catch(k){u.emit("error",{source:"mutation_callback",message:"Error in dataproxy onMutation callback",details:k})}})},onError(m){C(),u.off("error"),u.on("error",v=>{try{m(v)}catch(g){console.error(`Error in dataproxy onError callback: ${g.message}`)}})},on(m,v){u.on(m,v)},off(m,v){u.off(m,v)}}})}}function On(n,e){let t=n;for(const r of e)t=typeof t=="object"&&t!==null&&r in t?t[r]:null;return t}function ql(n,e,t){if(e.length===0)throw new Error("Cannot update root target, caller must do that itself!");const r=e.slice(0,-1).reduce((s,o)=>s[o],n),i=e.slice(-1)[0];t===null||typeof t=="undefined"?r instanceof Array?r.splice(i,1):delete r[i]:r[i]=t}function eh(n,e){const t=Y.get(n.path).childPath(e);return new Gn(n.db,t)}function mb(n){const e=eh(n.root.ref,n.target),t=[],r={get(s,o,a){if(s=On(n.root.cache,n.target),typeof o=="symbol")if(o.toString()===Symbol.iterator.toString())o="values";else return o.toString()===_i.toString()?!0:Reflect.get(s,o,a);if(o==="valueOf")return function(){return s};if(s===null||typeof s!="object")throw new Error(`Cannot read property "${o}" of ${s}. Value of path "/${e.path}" is not an object (anymore)`);s instanceof Array&&typeof o=="string"&&/^[0-9]+$/.test(o)&&(o=parseInt(o));const c=s[o];if(c===null){delete s[o];return}const l=t.find(f=>f.prop===o);if(l){if(l.typeof===typeof c)return l.value;t.splice(t.indexOf(l),1)}const u=f=>{const d=s[f],y=t.find(S=>S.prop===f);if(y){if(y.typeof===typeof d)return y.value;t.splice(t.indexOf(y),1)}if(typeof d!="object")return d;const _=mb({root:n.root,target:n.target.concat(f),id:n.id,flag:n.flag});return t.push({typeof:typeof d,prop:f,value:_}),_},h=f=>f!==null&&typeof f=="object"&&f[_i]?f.getTarget():f;if(["string","number","boolean"].includes(typeof c)||c instanceof Date||c instanceof ot||c instanceof ArrayBuffer||typeof c=="object"&&"buffer"in c)return c;const p=s instanceof Array;if(o==="toString")return function(){return`[LiveDataProxy for "${e.path}"]`};if(typeof c=="undefined")return o==="push"?function(f){const d=e.push();return n.flag("write",n.target.concat(d.key)),s[d.key]=f,d.key}:o==="getTarget"?function(f=!0){return f&&console.warn("Use getTarget with caution - any changes will not be synchronized!"),s}:o==="getRef"?function(){return eh(n.root.ref,n.target)}:o==="forEach"?function(f){const d=Object.keys(s);let y=!1;for(let _=0;!y&&_<d.length;_++){const S=d[_],I=u(S);y=f(I,S,_)===!1}}:["values","entries","keys"].includes(o)?function*(){const f=Object.keys(s);for(const d of f)if(o==="keys")yield d;else{const y=u(d);o==="entries"?yield[d,y]:yield y}}:o==="toArray"?function(f){const d=Object.keys(s).map(y=>u(y));return f&&d.sort(f),d}:o==="onChanged"?function(f){return n.flag("onChange",n.target,{callback:f})}:o==="subscribe"?function(){return n.flag("subscribe",n.target)}:o==="getObservable"?function(){return n.flag("observe",n.target)}:o==="getOrderedCollection"?function(f,d){return new vP(this,f,d)}:o==="startTransaction"?function(){return n.flag("transaction",n.target)}:o==="remove"&&!p?function(){if(n.target.length===0)throw new Error("Can't remove proxy root value");const f=On(n.root.cache,n.target.slice(0,-1)),d=n.target.slice(-1)[0];n.flag("write",n.target),delete f[d]}:void 0;if(typeof c=="function"){if(p){const f=y=>(n.flag("write",n.target),y()),d=y=>y.map(_=>(_=h(_),th(_),_));if(o==="push")return function(...y){return y=d(y),f(()=>s.push(...y))};if(o==="pop")return function(){return f(()=>s.pop())};if(o==="splice")return function(y,_,...S){return S=d(S),f(()=>s.splice(y,_,...S))};if(o==="shift")return function(){return f(()=>s.shift())};if(o==="unshift")return function(...y){return y=d(y),f(()=>s.unshift(...y))};if(o==="sort")return function(y){return f(()=>s.sort(y))};if(o==="reverse")return function(){return f(()=>s.reverse())};if(["indexOf","lastIndexOf"].includes(o))return function(y,_){return y!==null&&typeof y=="object"&&y[_i]&&(y=y.getTarget(!1)),s[o](y,_)};if(["forEach","every","some","filter","map"].includes(o))return function(y){return s[o]((_,S)=>y(u(S),S,i))};if(["reduce","reduceRight"].includes(o))return function(y,_){return s[o]((S,I,B)=>y(S,u(B),B,i),_)};if(["find","findIndex"].includes(o))return function(y){let _=s[o]((S,I)=>y(u(I),I,i));if(o==="find"&&_){const S=s.indexOf(_);_=u(S)}return _};if(["values","entries","keys"].includes(o))return function*(){for(let y=0;y<s.length;y++)if(o==="keys")yield y;else{const _=u(y);o==="entries"?yield[y,_]:yield _}}}return c}return u(o)},set(s,o,a,c){if(s=On(n.root.cache,n.target),typeof o=="symbol")return Reflect.set(s,o,a,c);if(s===null||typeof s!="object")throw new Error(`Cannot set property "${o}" of ${s}. Value of path "/${e.path}" is not an object`);if(s instanceof Array&&typeof o=="string"){if(!/^[0-9]+$/.test(o))throw new Error(`Cannot set property "${o}" on array value of path "/${e.path}"`);o=parseInt(o)}return a!==null&&(typeof a=="object"&&(a[_i]&&(a=a.valueOf()),a=zn(a)),ec(a,s[o]))||(n.target.some(l=>typeof l=="number")?n.flag("write",n.target.slice(0,n.target.findIndex(l=>typeof l=="number"))):s instanceof Array?n.flag("write",n.target):n.flag("write",n.target.concat(o)),a===null?delete s[o]:(th(a),s[o]=a)),!0},deleteProperty(s,o){if(s=On(n.root.cache,n.target),s===null)throw new Error(`Cannot delete property ${o.toString()} of null`);return typeof o=="symbol"?Reflect.deleteProperty(s,o):(o in s&&(n.flag("write",n.target.concat(o)),delete s[o]),!0)},ownKeys(s){return s=On(n.root.cache,n.target),Reflect.ownKeys(s)},has(s,o){return s=On(n.root.cache,n.target),Reflect.has(s,o)},getOwnPropertyDescriptor(s,o){s=On(n.root.cache,n.target);const a=Reflect.getOwnPropertyDescriptor(s,o);return a&&(a.configurable=!0),a},getPrototypeOf(s){return s=On(n.root.cache,n.target),Reflect.getPrototypeOf(s)}},i=new Proxy({},r);return i}function th(n){typeof n=="object"&&Object.keys(n).forEach(e=>{const t=n[e];t===null||typeof t=="undefined"?delete n[e]:typeof t=="object"&&th(t)})}function Sa(n){if(typeof n!="object"||!n[_i])throw new Error("Given value is not proxied. Make sure you are referencing the value through the live data proxy.");return n}class vP{constructor(e,t="order",r=10){if(this.collection=e,this.orderProperty=t,this.orderIncrement=r,typeof e!="object"||!e[_i])throw new Error("Collection is not proxied");if(e.valueOf()instanceof Array)throw new Error("Collection is an array, not an object collection");if(!Object.keys(e).every(i=>typeof e[i]=="object"))throw new Error("Collection has non-object children");if(!Object.keys(e).every(i=>typeof e[i][t]=="number")){const i=Object.keys(e);for(let s=0;s<i.length;s++){const o=e[i[s]];o[t]=s*r}}}getObservable(){return Sa(this.collection).getObservable()}getArrayObservable(){const e=Rf();return new e(t=>{const r=this.getObservable().subscribe(()=>{const i=this.getArray();t.next(i)});return function(){r.unsubscribe()}})}getArray(){return Sa(this.collection).toArray((e,t)=>e[this.orderProperty]-t[this.orderProperty])}add(e,t,r){const i=this.getArray();let s=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;for(let c=0;c<i.length;c++){const l=i[c][this.orderProperty];s=Math.min(l,s),o=Math.max(l,o)}let a;if(typeof r=="number"){if(a=Object.keys(this.collection).find(c=>this.collection[c]===e),!a)throw new Error("item not found in collection");if(r===t)return{key:a,index:t};if(Math.abs(r-t)===1){const c=i[t],l=c[this.orderProperty];return c[this.orderProperty]=e[this.orderProperty],e[this.orderProperty]=l,{key:a,index:t}}else i.splice(r,1)}if(typeof t!="number"||t>=i.length)t=i.length,e[this.orderProperty]=i.length==0?0:o+this.orderIncrement;else if(t===0)e[this.orderProperty]=i.length==0?0:s-this.orderIncrement;else{const c=i.map(u=>u[this.orderProperty]),l=c[t]-c[t-1];if(l>1)e[this.orderProperty]=c[t]-Math.floor(l/2);else{i.splice(t,0,e);for(let u=0;u<i.length;u++)i[u][this.orderProperty]=u*this.orderIncrement}}return{key:typeof a=="string"?a:Sa(this.collection).push(e),index:t}}delete(e){const t=this.getArray()[e];if(!t)throw new Error(`Item at index ${e} not found`);const r=Object.keys(this.collection).find(i=>this.collection[i]===t);if(!r)throw new Error("Cannot find target object to delete");return this.collection[r]=null,{key:r,index:e}}move(e,t){const r=this.getArray();return this.add(r[e],t,e)}sort(e){const t=this.getArray();t.sort(e);for(let r=0;r<t.length;r++)t[r][this.orderProperty]=r*this.orderIncrement}}class vb{constructor(e){if(e||(e={}),typeof e.include!="undefined"&&!(e.include instanceof Array))throw new TypeError("options.include must be an array");if(typeof e.exclude!="undefined"&&!(e.exclude instanceof Array))throw new TypeError("options.exclude must be an array");if(typeof e.child_objects!="undefined"&&typeof e.child_objects!="boolean")throw new TypeError("options.child_objects must be a boolean");if(typeof e.cache_mode=="string"&&!["allow","bypass","force"].includes(e.cache_mode))throw new TypeError("invalid value for options.cache_mode");this.include=e.include||void 0,this.exclude=e.exclude||void 0,this.child_objects=typeof e.child_objects=="boolean"?e.child_objects:void 0,this.cache_mode=typeof e.cache_mode=="string"?e.cache_mode:typeof e.allow_cache=="boolean"?e.allow_cache?"allow":"bypass":"allow",this.cache_cursor=typeof e.cache_cursor=="string"?e.cache_cursor:void 0}}class bP extends vb{constructor(e){if(super(e),!["undefined","boolean"].includes(typeof e.snapshots))throw new TypeError("options.snapshots must be a boolean");this.snapshots=typeof e.snapshots=="boolean"?e.snapshots:!0}}const Te=Symbol("private");class Gn{constructor(e,t,r){this.db=e,t||(t=""),t=t.replace(/^\/|\/$/g,"");const i=Y.get(t).key,s=[];this[Te]={get path(){return t},get key(){return i},get callbacks(){return s},vars:r||{},context:{},pushed:!1,cursor:null}}context(e,t=!1){const r=this[Te].context;if(typeof e=="object"){const i=e?t?r||{}:e:{};return e&&Object.keys(e).forEach(s=>{i[s]=e[s]}),this[Te].context=i,this}else{if(typeof e=="undefined")return console.warn("Use snap.context() instead of snap.ref.context() to get updating context in event callbacks"),r;throw new Error("Invalid context argument")}}get cursor(){return this[Te].cursor}set cursor(e){var t;this[Te].cursor=e,(t=this.onCursor)==null||t.call(this,e)}get path(){return this[Te].path}get key(){const e=this[Te].key;return typeof e=="number"?`[${e}]`:e}get index(){const e=this[Te].key;if(typeof e!="number")throw new Error(`"${e}" is not a number`);return e}get parent(){const e=Y.fillVariables2(this.path,this.vars),t=Y.get(e);return t.parentPath===null?null:new Gn(this.db,t.parentPath).context(this[Te].context)}get vars(){return this[Te].vars}child(e){e=typeof e=="number"?e:e.replace(/^\/|\/$/g,"");const t=Y.fillVariables2(this.path,this.vars),r=Y.getChildPath(t,e);return new Gn(this.db,r).context(this[Te].context)}set(e,t){return W(this,null,function*(){try{if(this.isWildcardPath)throw new Error(`Cannot set the value of wildcard path "/${this.path}"`);if(this.parent===null)throw new Error("Cannot set the root object. Use update, or set individual child properties");if(typeof e=="undefined")throw new TypeError(`Cannot store undefined value in "/${this.path}"`);this.db.isReady||(yield this.db.ready()),e=this.db.types.serialize(this.path,e);const{cursor:r}=yield this.db.api.set(this.path,e,{context:this[Te].context});if(this.cursor=r,typeof t=="function")try{t(null,this)}catch(i){console.error("Error in onComplete callback:",i)}}catch(r){if(typeof t=="function")try{t(r,this)}catch(i){console.error("Error in onComplete callback:",i)}else throw r}return this})}update(e,t){return W(this,null,function*(){try{if(this.isWildcardPath)throw new Error(`Cannot update the value of wildcard path "/${this.path}"`);if(this.db.isReady||(yield this.db.ready()),typeof e!="object"||e instanceof Array||e instanceof ArrayBuffer||e instanceof Date)yield this.set(e);else if(Object.keys(e).length===0)console.warn(`update called on path "/${this.path}", but there is nothing to update`);else{e=this.db.types.serialize(this.path,e);const{cursor:r}=yield this.db.api.update(this.path,e,{context:this[Te].context});this.cursor=r}if(typeof t=="function")try{t(null,this)}catch(r){console.error("Error in onComplete callback:",r)}}catch(r){if(typeof t=="function")try{t(r,this)}catch(i){console.error("Error in onComplete callback:",i)}else throw r}return this})}transaction(e){return W(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot start a transaction on wildcard path "/${this.path}"`);this.db.isReady||(yield this.db.ready());let t;const r=s=>{s=this.db.types.deserialize(this.path,s);const o=new st(this,s);let a;try{a=e(o)}catch(c){t=c;return}return a instanceof Promise?a.then(c=>this.db.types.serialize(this.path,c)).catch(c=>{t=c}):this.db.types.serialize(this.path,a)},{cursor:i}=yield this.db.api.transaction(this.path,r,{context:this[Te].context});if(this.cursor=i,t)throw t;return this})}on(e,t,r){this.path===""&&["value","child_changed"].includes(e)&&console.warn("WARNING: Listening for value and child_changed events on the root node is a bad practice. These events require loading of all data (value event), or potentially lots of data (child_changed event) each time they are fired");let i=null;const s=new QT(c=>{i=c}),o={event:e,stream:s,userCallback:typeof t=="function"&&t,ourCallback:(c,l,u,h,p)=>{if(c){this.db.debug.error(`Error getting data for event ${e} on path "${l}"`,c);return}const f=this.db.ref(l);f[Te].vars=Y.extractVariables(this.path,l);let d;if(e.startsWith("notify_"))d=f.context(p||{});else{const y={previous:this.db.types.deserialize(l,h),current:this.db.types.deserialize(l,u)};if(e==="child_removed")d=new st(f,y.previous,!0,y.previous,p);else if(e==="mutations")d=new Oa(f,y.current,p);else{const _=e==="mutated"&&y.current===null;d=new st(f,y.current,_,y.previous,p)}}i.publish(d),p!=null&&p.acebase_cursor&&(this.cursor=p.acebase_cursor)}};this[Te].callbacks.push(o);const a=()=>{typeof t=="function"&&s.subscribe(t,(p,f)=>{p||r&&r(f)});const c=typeof t=="object"?t:{newOnly:!t};typeof c.newOnly!="boolean"&&(c.newOnly=!1),this.isWildcardPath&&(c.newOnly=!0);const l=p=>{const f=this[Te].callbacks;f.splice(f.indexOf(o),1),this.db.api.unsubscribe(this.path,e,o.ourCallback),this.db.debug.error(`Subscription "${e}" on path "/${this.path}" canceled because of an error: ${p.message}`),i.cancel(p.message)},u=this.db.api.subscribe(this.path,e,o.ourCallback,{newOnly:c.newOnly,cancelCallback:l,syncFallback:c.syncFallback}),h=()=>{const p=this[Te].callbacks;return p.splice(p.indexOf(o),1),this.db.api.unsubscribe(this.path,e,o.ourCallback)};if(u instanceof Promise?u.then(()=>{i.start(h)}).catch(l):i.start(h),!c.newOnly){if(e==="value")this.get(p=>{i.publish(p)});else if(e==="child_added")this.get(p=>{const f=p.val();f===null||typeof f!="object"||Object.keys(f).forEach(d=>{const y=new st(this.child(d),f[d]);i.publish(y)})});else if(e==="notify_child_added"){let p=0;const f=()=>W(this,null,function*(){const d=yield this.db.api.reflect(this.path,"children",{limit:100,skip:p});d.list.forEach(y=>{const _=this.child(y.key);i.publish(_)}),d.more&&(p+=100,f())});f()}}};return this.db.isReady?a():this.db.ready(a),s}off(e,t){const r=this[Te].callbacks.filter(i=>(!e||i.event===e)&&(!t||i.userCallback===t));return r.length===0&&this.db.debug.warn(`Can't find event subscriptions to stop (path: "${this.path}", event: ${e||"(any)"}, callback: ${t})`),r.forEach(i=>{i.stream.stop()}),this}get(e,t){if(!this.db.isReady){const s=this.db.ready().then(()=>this.get(e,t));return typeof e!="function"&&typeof t!="function"?s:void 0}if(t=typeof e=="function"?e:typeof t=="function"?t:void 0,this.isWildcardPath){const s=new Error(`Cannot get value of wildcard path "/${this.path}". Use .query() instead`);if(typeof t=="function")throw s;return Promise.reject(s)}const r=new vb(typeof e=="object"?e:{cache_mode:"allow"}),i=this.db.api.get(this.path,r).then(s=>{var o;"context"in s&&"value"in s||(console.warn("AceBase api.get method returned an old response value. Update your acebase or acebase-client package"),s={value:s,context:{}});const a=this.db.types.deserialize(this.path,s.value),c=new st(this,a,void 0,void 0,s.context);return(o=s.context)!=null&&o.acebase_cursor&&(this.cursor=s.context.acebase_cursor),c});if(t){i.then(t).catch(s=>{console.error("Uncaught error:",s)});return}else return i}once(e,t){return e==="value"&&!this.isWildcardPath?this.get(t):new Promise(r=>{const i=s=>{this.off(e,i),r(s)};this.on(e,i)})}push(e,t){if(this.isWildcardPath){const s=new Error(`Cannot push to wildcard path "/${this.path}"`);if(typeof e=="undefined"||typeof t=="function")throw s;return Promise.reject(s)}const r=Kt.generate(),i=this.child(r);return i[Te].pushed=!0,typeof e!="undefined"?i.set(e,t).then(()=>i):i}remove(){return W(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot remove wildcard path "/${this.path}". Use query().remove instead`);if(this.parent===null)throw new Error("Cannot remove the root node");return this.set(null)})}exists(){return W(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot check wildcard path "/${this.path}" existence`);return this.db.isReady||(yield this.db.ready()),this.db.api.exists(this.path)})}get isWildcardPath(){return this.path.indexOf("*")>=0||this.path.indexOf("$")>=0}query(){return new bb(this)}count(){return W(this,null,function*(){return(yield this.reflect("info",{child_count:!0})).children.count})}reflect(e,t){return W(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot reflect on wildcard path "/${this.path}"`);return this.db.isReady||(yield this.db.ready()),this.db.api.reflect(this.path,e,t)})}export(e){return W(this,arguments,function*(t,r={format:"json",type_safe:!0}){if(this.isWildcardPath)throw new Error(`Cannot export wildcard path "/${this.path}"`);this.db.isReady||(yield this.db.ready());const i=typeof t=="function"?t:t.write.bind(t);return this.db.api.export(this.path,i,r)})}import(e){return W(this,arguments,function*(t,r={format:"json",suppress_events:!1}){if(this.isWildcardPath)throw new Error(`Cannot import to wildcard path "/${this.path}"`);return this.db.isReady||(yield this.db.ready()),this.db.api.import(this.path,t,r)})}proxy(e){const t=typeof e=="object"&&(typeof e.cursor!="undefined"||typeof e.defaultValue!="undefined");return typeof e!="undefined"&&!t&&(this.db.debug.warn("Warning: live data proxy is being initialized with a deprecated method signature. Use ref.proxy(options) instead of ref.proxy(defaultValue)"),e={defaultValue:e}),mP.create(this,e)}observe(e){if(e)throw new Error("observe does not support data retrieval options yet");if(this.isWildcardPath)throw new Error(`Cannot observe wildcard path "/${this.path}"`);const t=Rf();return new t(r=>{let i,s=!1,o=this.get(e).then(c=>{s=!0,i=c.val(),r.next(i)});const a=c=>{if(!s){o=o.then(()=>a(c));return}const l=c.ref.path;if(l===this.path)return i=c.val(),r.next(i);const u=Y.getPathKeys(l).slice(Y.getPathKeys(this.path).length);let h=i;for(;u.length>1;){const d=u.shift();d in h||(h[d]=typeof u[0]=="number"?[]:{}),h=h[d]}const p=u.shift(),f=c.val();f===null?h instanceof Array&&typeof p=="number"?h.splice(p,1):delete h[p]:h[p]=f,r.next(i)};return this.on("mutated",a),()=>{this.off("mutated",a)}})}forEach(e,t){return W(this,null,function*(){let r;if(typeof e=="function"?t=e:r=e,typeof t!="function")throw new TypeError("No callback function given");const i=yield this.reflect("children",{limit:0,skip:0}),s={canceled:!1,total:i.list.length,processed:0};for(let o=0;o<i.list.length;o++){const a=i.list[o].key,c=yield this.child(a).get(r);if(s.processed++,!!c.exists()&&(yield t(c))===!1){s.canceled=!0;break}}return s})}getMutations(e){return W(this,null,function*(){const t=typeof e=="string"?e:void 0,r=e===null||typeof e=="undefined"?0:e instanceof Date?e.getTime():void 0;return this.db.api.getMutations({path:this.path,cursor:t,timestamp:r})})}getChanges(e){return W(this,null,function*(){const t=typeof e=="string"?e:void 0,r=e===null||typeof e=="undefined"?0:e instanceof Date?e.getTime():void 0;return this.db.api.getChanges({path:this.path,cursor:t,timestamp:r})})}}class bb{constructor(e){this.ref=e,this[Te]={filters:[],skip:0,take:0,order:[],events:{}}}filter(e,t,r){if((t==="in"||t==="!in")&&(!(r instanceof Array)||r.length===0))throw new Error(`${t} filter for ${e} must supply an Array compare argument containing at least 1 value`);if((t==="between"||t==="!between")&&(!(r instanceof Array)||r.length!==2))throw new Error(`${t} filter for ${e} must supply an Array compare argument containing 2 values`);if((t==="matches"||t==="!matches")&&!(r instanceof RegExp))throw new Error(`${t} filter for ${e} must supply a RegExp compare argument`);return this[Te].filters.push({key:e,op:t,compare:r}),this}where(e,t,r){return this.filter(e,t,r)}take(e){return this[Te].take=e,this}skip(e){return this[Te].skip=e,this}sort(e,t=!0){if(!["string","number"].includes(typeof e))throw"key must be a string or number";return this[Te].order.push({key:e,ascending:t}),this}order(e,t=!0){return this.sort(e,t)}get(e,t){if(!this.ref.db.isReady){const s=this.ref.db.ready().then(()=>this.get(e,t));return typeof e!="function"&&typeof t!="function"?s:void 0}t=typeof e=="function"?e:typeof t=="function"?t:void 0;const r=new bP(typeof e=="object"?e:{snapshots:!0,cache_mode:"allow"});r.allow_cache=r.cache_mode!=="bypass",r.eventHandler=s=>{if(!this[Te].events[s.name])return!1;const o=this[Te].events[s.name];if(typeof o!="object"||o.length===0)return!1;if(["add","change","remove"].includes(s.name)){const a={name:s.name,ref:new Gn(this.ref.db,s.path)};if(r.snapshots&&s.name!=="remove"){const c=i.types.deserialize(s.path,s.value);a.snapshot=new st(a.ref,c,!1)}s=a}o.forEach(a=>{var c,l;try{a(s)}catch(u){this.ref.db.debug.error(`Error executing "${s.name}" event handler of realtime query on path "${this.ref.path}": ${(l=(c=u==null?void 0:u.stack)!=null?c:u==null?void 0:u.message)!=null?l:u}`)}})},r.monitor={add:!1,change:!1,remove:!1},this[Te].events&&(this[Te].events.add&&this[Te].events.add.length>0&&(r.monitor.add=!0),this[Te].events.change&&this[Te].events.change.length>0&&(r.monitor.change=!0),this[Te].events.remove&&this[Te].events.remove.length>0&&(r.monitor.remove=!0)),this.stop();const i=this.ref.db;return i.api.query(this.ref.path,this[Te],r).catch(s=>{throw new Error(s)}).then(s=>{const{stop:o}=s;let{results:a,context:c}=s;if(this.stop=()=>W(this,null,function*(){yield o()}),"results"in s&&"context"in s||(console.warn("Query results missing context. Update your acebase and/or acebase-client packages"),a=s,c={}),r.snapshots){const l=a.map(u=>{const h=i.types.deserialize(u.path,u.val);return new st(i.ref(u.path),h,!1,void 0,c)});return Dc.from(l)}else{const l=a.map(u=>i.ref(u));return Nf.from(l)}}).then(s=>(t&&t(s),s))}stop(){return W(this,null,function*(){})}getRefs(e){return this.get({snapshots:!1},e)}find(){return this.get({snapshots:!1})}count(){return W(this,null,function*(){return(yield this.find()).length})}exists(){return W(this,null,function*(){const e=this[Te].take,t=this.take(1).find();return this.take(e),(yield t).length!==0})}remove(e){return W(this,null,function*(){const t=yield this.find(),r=t.reduce((a,c)=>{const l=a[c.parent.path];return l?l.push(c):a[c.parent.path]=[c],a},{}),i=this.ref.db,s=Object.keys(r).map(a=>W(this,null,function*(){const c=t.reduce((u,h)=>(u[h.key]=null,u),{}),l=i.ref(a);try{return yield l.update(c),{ref:l,success:!0}}catch(u){return{ref:l,success:!1,error:u}}})),o=yield Promise.all(s);return e&&e(o),o})}on(e,t){return this[Te].events[e]||(this[Te].events[e]=[]),this[Te].events[e].push(t),this}off(e,t){if(typeof e=="undefined")return this[Te].events={},this;if(!this[Te].events[e])return this;if(typeof t=="undefined")return delete this[Te].events[e],this;const r=this[Te].events[e].indexOf(t);return~r?(this[Te].events[e].splice(r,1),this):this}forEach(e,t){return W(this,null,function*(){let r;if(typeof e=="function"?t=e:r=e,typeof t!="function")throw new TypeError("No callback function given");const i=yield this.find(),s={canceled:!1,total:i.length,processed:0};for(let o=0;o<i.length;o++){const a=yield i[o].get(r);if(s.processed++,!!a.exists()&&(yield t(a))===!1){s.canceled=!0;break}}return s})}}class Dc extends Array{static from(e){const t=new Dc(e.length);return e.forEach((r,i)=>t[i]=r),t}getValues(){return this.map(e=>e.val())}}class Nf extends Array{static from(e){const t=new Nf(e.length);return e.forEach((r,i)=>t[i]=r),t}getPaths(){return this.map(e=>e.path)}}function wP(n,e){e=e.replace(/^\/|\/$/g,"");const t=Y.getPathKeys(e),r=Object.keys(n).find(i=>{const s=Y.getPathKeys(i);return s.length!==t.length?!1:s.every((o,a)=>o==="*"||typeof o=="string"&&o[0]==="$"?!0:o===t[a])});return n[r]}function kP(n,e){const t=Y.get(e).parentPath;if(t!==null)return wP(n,t)}function xP(n,e){e=e.replace(/^\/|\/$/g,"");const t=Y.get(e).parentPath,r=t?Y.getPathKeys(t):[];return Object.keys(n).reduce((i,s)=>{const o=Y.getPathKeys(s);if(o.length<r.length)return i;let a=!0;if(r.length===0&&t!==null?a=o.length===1&&(o[0]==="*"||typeof o[0]=="string"&&o[0][0]==="$"):o.every((c,l)=>l>=r.length?!1:c==="*"||typeof c=="string"&&c[0]==="$"||c===r[l]?!0:(a=!1,!1)),a){const c=n[s];i.push({path:s,type:c})}return i},[])}function ay(n,e,t,r,i){if(r===null||typeof r!="object")return r;const s=Y.getPathKeys(t),o=xP(e,t),a=[];return o.sort((c,l)=>Y.getPathKeys(c.path).length>Y.getPathKeys(l.path).length?-1:1),o.forEach(c=>{const l=Y.getPathKeys(c.path);l.push("*");const u=l.slice(s.length);if(u.length===0){const p=Y.extractVariables(c.path,t),f=new Gn(n,t,p);if(i==="serialize")r=c.type.serialize(r,f);else if(i==="deserialize"){const d=new st(f,r);r=c.type.deserialize(d)}return}const h=(p,f,d)=>{if(r===null||typeof r!="object")return r;const y=d[0];let _=[];if(y==="*"||typeof y=="string"&&y[0]==="$")f instanceof Array?_=f.map((S,I)=>({key:I,val:S})):_=Object.keys(f).map(S=>({key:S,val:f[S]}));else{const S=f[y];typeof S=="object"&&_.push({key:y,val:S})}_.forEach(S=>{const I=Y.getChildPath(p,S.key),B=Y.extractVariables(c.path,I),j=new Gn(n,I,B);if(d.length===1){if(i==="serialize")a.push({parent:f,key:S.key,original:f[S.key]}),f[S.key]=c.type.serialize(S.val,j);else if(i==="deserialize"){const U=new st(j,S.val);f[S.key]=c.type.deserialize(U)}}else h(I,S.val,d.slice(1))})};h(t,r,u)}),i==="serialize"&&(r=zn(r),a.length>0&&a.forEach(c=>{c.parent[c.key]=c.original})),r}const Gi=Symbol("mappings");class wb{constructor(e){this.db=e,this[Gi]={}}get mappings(){return this[Gi]}map(e){return kP(this[Gi],e)}bind(e,t,r={}){if(typeof e!="string")throw new TypeError("path must be a string");if(typeof t!="function")throw new TypeError("constructor must be a function");if(typeof r.serializer!="undefined"){if(typeof r.serializer=="string")if(typeof t.prototype[r.serializer]=="function")r.serializer=t.prototype[r.serializer];else throw new TypeError(`${t.name}.prototype.${r.serializer} is not a function, cannot use it as serializer`);else if(typeof r.serializer!="function")throw new TypeError(`serializer for class ${t.name} must be a function, or the name of a prototype method`)}if(typeof r.creator=="undefined")typeof t.create=="function"&&(r.creator=t.create);else if(typeof r.creator=="string")if(typeof t[r.creator]=="function")r.creator=t[r.creator];else throw new TypeError(`${t.name}.${r.creator} is not a function, cannot use it as creator`);else if(typeof r.creator!="function")throw new TypeError(`creator for class ${t.name} must be a function, or the name of a static method`);e=e.replace(/^\/|\/$/g,""),this[Gi][e]={db:this.db,type:t,creator:r.creator,serializer:r.serializer,deserialize(i){let s;return this.creator?s=this.creator.call(this.type,i):s=new this.type(i),s},serialize(i,s){return this.serializer?i=this.serializer.call(i,s,i):i&&typeof i.serialize=="function"&&(i=i.serialize(s,i)),i}}}serialize(e,t){return ay(this.db,this[Gi],e,t,"serialize")}deserialize(e,t){return ay(this.db,this[Gi],e,t,"deserialize")}}const Yo=()=>{};class kb{constructor(e="log",t=""){this.level=e,this.prefix=t,this.setLevel(e)}setLevel(e){const t=this.prefix?this.prefix+" %s":"";this.verbose=["verbose"].includes(e)?t?console.log.bind(console,t):console.log.bind(console):Yo,this.log=["verbose","log"].includes(e)?t?console.log.bind(console,t):console.log.bind(console):Yo,this.warn=["verbose","log","warn"].includes(e)?t?console.warn.bind(console,t):console.warn.bind(console):Yo,this.error=["verbose","log","warn","error"].includes(e)?t?console.error.bind(console,t):console.error.bind(console):Yo,this.write=r=>{const i=typeof In!="undefined"&&In.env&&typeof{}.RUNKIT_ENDPOINT_PATH=="string";r&&i?r.split(`
`).forEach(s=>console.log(s)):console.log(r)}}}const cy={bold:1,dim:2,italic:3,underline:4,inverse:7,hidden:8,strikethrough:94},ly={black:30,red:31,green:32,yellow:33,blue:34,magenta:35,cyan:36,white:37,grey:90,brightRed:91},uy={bgBlack:40,bgRed:41,bgGreen:42,bgYellow:43,bgBlue:44,bgMagenta:45,bgCyan:46,bgWhite:47,bgGrey:100,bgBrightRed:101},Go={all:0,color:39,background:49,bold:22,dim:22,italic:23,underline:24,inverse:27,hidden:28,strikethrough:29};var $t;(function(n){n.reset="reset",n.bold="bold",n.dim="dim",n.italic="italic",n.underline="underline",n.inverse="inverse",n.hidden="hidden",n.strikethrough="strikethrough",n.black="black",n.red="red",n.green="green",n.yellow="yellow",n.blue="blue",n.magenta="magenta",n.cyan="cyan",n.grey="grey",n.bgBlack="bgBlack",n.bgRed="bgRed",n.bgGreen="bgGreen",n.bgYellow="bgYellow",n.bgBlue="bgBlue",n.bgMagenta="bgMagenta",n.bgCyan="bgCyan",n.bgWhite="bgWhite",n.bgGrey="bgGrey"})($t||($t={}));function xb(){if(typeof In=="undefined"||!In.stdout||!In.env||!In.platform||In.platform==="browser")return!1;if(In.platform==="win32")return!0;const n=In.env;return n.COLORTERM?!0:n.TERM==="dumb"?!1:n.CI||n.TEAMCITY_VERSION?!!n.TRAVIS:!!(["iTerm.app","HyperTerm","Hyper","MacTerm","Apple_Terminal","vscode"].includes(n.TERM_PROGRAM)||/^xterm-256|^screen|^xterm|^vt100|color|ansi|cygwin|linux/i.test(n.TERM))}let Eb=xb();function EP(n){Eb=xb()&&n}function _P(n,e){if(!Eb)return n;const t=[],r=[],i=a=>{a===$t.reset?t.push(Go.all):a in cy?(t.push(cy[a]),r.push(Go[a])):a in ly?(t.push(ly[a]),r.push(Go.color)):a in uy&&(t.push(uy[a]),r.push(Go.background))};e instanceof Array?e.forEach(i):i(e);const s=t.map(a=>"\x1B["+a+"m").join(""),o=r.map(a=>"\x1B["+a+"m").join("");return n.split(`
`).map(a=>s+a+o).join(`
`)}String.prototype.colorize=function(n){return _P(this,n)};class _b{constructor(e){this.logLevel="log",this.logColors=!0,this.info="realtime database",this.sponsor=!1,typeof e!="object"&&(e={}),typeof e.logLevel=="string"&&(this.logLevel=e.logLevel),typeof e.logColors=="boolean"&&(this.logColors=e.logColors),typeof e.info=="string"&&(this.info=e.info),typeof e.sponsor=="boolean"&&(this.sponsor=e.sponsor)}}class AP extends ds{constructor(e,t={}){super(),this._ready=!1,t=new _b(t),this.name=e,this.debug=new kb(t.logLevel,`[${e}]`),EP(t.logColors);const r=[$t.magenta,$t.bold],i=`     ___          ______                
    / _ \\         | ___ \\               
   / /_\\ \\ ___ ___| |_/ / __ _ ___  ___ 
   |  _  |/ __/ _ \\ ___ \\/ _\` / __|/ _ \\
   | | | | (_|  __/ |_/ / (_| \\__ \\  __/
   \\_| |_/\\___\\___\\____/ \\__,_|___/\\___|`,s=t.info?"".padStart(40-t.info.length," ")+t.info+`
`:"";t.sponsor||(this.debug.write(i.colorize(r)),s&&this.debug.write(s.colorize($t.magenta))),this.types=new wb(this),this.once("ready",()=>{this._ready=!0})}ready(e){return W(this,null,function*(){this._ready||(yield new Promise(t=>this.on("ready",t))),e==null||e()})}get isReady(){return this._ready}setObservable(e){gP(e)}ref(e){return new Gn(this,e)}get root(){return this.ref("")}query(e){const t=new Gn(this,e);return new bb(t)}get indexes(){return{get:()=>this.api.getIndexes(),create:(e,t,r)=>this.api.createIndex(e,t,r),delete:e=>W(this,null,function*(){return this.api.deleteIndex(e)})}}get schema(){return{get:e=>this.api.getSchema(e),set:(e,t,r=!1)=>this.api.setSchema(e,t,r),all:()=>this.api.getSchemas(),check:(e,t,r)=>this.api.validateSchema(e,t,r)}}}class ut extends Error{constructor(e){super(`${e} is not implemented`)}}class OP extends ds{constructor(){super()}stats(e){throw new ut("stats")}subscribe(e,t,r,i){throw new ut("subscribe")}unsubscribe(e,t,r){throw new ut("unsubscribe")}update(e,t,r){throw new ut("update")}set(e,t,r){throw new ut("set")}get(e,t){throw new ut("get")}transaction(e,t,r){throw new ut("transaction")}exists(e){throw new ut("exists")}query(e,t,r){throw new ut("query")}reflect(e,t,r){throw new ut("reflect")}export(e,t,r){throw new ut("export")}import(e,t,r){throw new ut("import")}createIndex(e,t,r){throw new ut("createIndex")}getIndexes(){throw new ut("getIndexes")}deleteIndex(e){throw new ut("deleteIndex")}setSchema(e,t,r){throw new ut("setSchema")}getSchema(e){throw new ut("getSchema")}getSchemas(){throw new ut("getSchemas")}validateSchema(e,t,r){throw new ut("validateSchema")}getMutations(e){throw new ut("getMutations")}getChanges(e){throw new ut("getChanges")}}function hy(n,e,t){const r=[0,0,0,0,0];for(let i=0;i<e;i+=4){let s=((n[i]*256+n[i+1])*256+n[i+2])*256+n[i+3];if(!s)t.push("z");else{for(let o=0;o<5;r[o++]=s%85+33,s=Math.floor(s/85));t.push(String.fromCharCode(r[4],r[3],r[2],r[1],r[0]))}}}function SP(n){const e=n,t=[],r=e.length%4,i=e.length-r;if(hy(e,i,t),r){const o=new Uint8Array(4);o.set(e.slice(i),0),hy(o,4,t);let a=t.pop();a=="z"&&(a="!!!!!"),t.push(a.substr(0,r+1))}let s=t.join("");return s="<~"+s+"~>",s}const xr={encode:function(n){return n instanceof ArrayBuffer&&(n=new Uint8Array(n,0,n.byteLength)),SP(n)},decode:function(n){if(!n.startsWith("<~")||!n.endsWith("~>"))throw new Error("Invalid input string");n=n.substr(2,n.length-4);const e=n.length,t=[],r=[0,0,0,0,0];let i,s,o,a;for(let l=0;l<e;++l){if(n.charAt(l)=="z"){t.push(0,0,0,0);continue}for(let u=0;u<5;++u)r[u]=n.charCodeAt(l+u)-33;if(a=e-l,a<5){for(let u=a;u<4;r[++u]=0);r[a]=85}i=(((r[0]*85+r[1])*85+r[2])*85+r[3])*85+r[4],s=i&255,i>>>=8,o=i&255,i>>>=8,t.push(i>>>8,i&255,o,s);for(let u=a;u<5;++u,t.pop());l+=4}const c=new Uint8Array(t);return c.buffer.slice(c.byteOffset,c.byteOffset+c.byteLength)}},$P=n=>{if(n.map===null||typeof n.map=="undefined"){if(typeof n.val=="undefined")throw new Error("serialized value must have a val property");return n.val}const e=(t,r)=>t==="date"?new Date(r):t==="binary"?xr.decode(r):t==="reference"?new ot(r):t==="regexp"?new RegExp(r.pattern,r.flags):t==="array"?new Za(r):t==="bigint"?BigInt(r):r;return typeof n.map=="string"?e(n.map,n.val):(Object.keys(n.map).forEach(t=>{const r=n.map[t],i=Y.getPathKeys(t);let s=n,o="val",a=n.val;i.forEach(c=>{o=c,s=a,a=a[o]}),s[o]=e(r,a)}),n.val)},Ab=n=>{var e;if(n===null||typeof n!="object"||n instanceof Date||n instanceof ArrayBuffer||n instanceof ot||n instanceof RegExp){const s=Ab({value:n});return{map:(e=s.map)==null?void 0:e.value,val:s.val.value}}n=zn(n);const t=(s,o,a)=>{s instanceof Za&&(o[a]="array"),Object.keys(s).forEach(c=>{const l=s[c],u=a.length===0?c:`${a}/${c}`;typeof l=="bigint"?(s[c]=l.toString(),o[u]="bigint"):l instanceof Date?(s[c]=l.toISOString(),o[u]="date"):l instanceof ArrayBuffer?(s[c]=xr.encode(l),o[u]="binary"):l instanceof ot?(s[c]=l.path,o[u]="reference"):l instanceof RegExp?(s[c]={pattern:l.source,flags:l.flags},o[u]="regexp"):typeof l=="object"&&l!==null&&t(l,o,u)})},r={};t(n,r,"");const i={val:n};return Object.keys(r).length>0&&(i.map=r),i},fy=n=>n>0?Date.now()+n*1e3:1/0;class TP{get size(){return this.cache.size}constructor(e){var t;if(this.enabled=!0,typeof e=="number"&&(e={expirySeconds:e}),e.cloneValues=e.cloneValues!==!1,typeof e.expirySeconds!="number"&&typeof e.maxEntries!="number")throw new Error("Either expirySeconds or maxEntries must be specified");this.options=e,this.cache=new Map;const r=setInterval(()=>{this.cleanUp()},60*1e3);(t=r.unref)==null||t.call(r)}has(e){return this.enabled?this.cache.has(e):!1}get(e){if(!this.enabled)return null;const t=this.cache.get(e);return t?(t.expires=fy(this.options.expirySeconds),t.accessed=Date.now(),this.options.cloneValues?zn(t.value):t.value):null}set(e,t){if(this.options.maxEntries>0&&this.cache.size>=this.options.maxEntries&&!this.cache.has(e)){let r=null;const i=Date.now();for(const[s,o]of this.cache.entries()){if(o.expires<=i){this.cache.delete(s),r=null;break}(!r||o.accessed<r.accessed)&&(r={key:s,accessed:o.accessed})}r!==null&&this.cache.delete(r.key)}this.cache.set(e,{value:this.options.cloneValues?zn(t):t,added:Date.now(),accessed:Date.now(),expires:fy(this.options.expirySeconds)})}remove(e){this.cache.delete(e)}cleanUp(){const e=Date.now();this.cache.forEach((t,r)=>{t.expires<=e&&this.cache.delete(r)})}}function PP(n){let e=0;function t(){let a;for(;a=n[e],[" ","\r",`
`,"	"].includes(a);)e++}function r(a){if(n[e]!==a)throw new Error(`Unexpected character at position ${e}. Expected: '${a}', found '${n[e]}'`);e++}function i(){t();const a={name:"",optional:!1,wildcard:!1};let c;for(;c=n[e],c==="_"||c==="$"||c>="a"&&c<="z"||c>="A"&&c<="Z"||a.name.length>0&&c>="0"&&c<="9"||a.name.length===0&&c==="*";)a.name+=c,e++;if(a.name.length===0)throw new Error(`Property name expected at position ${e}, found: ${n.slice(e,e+10)}..`);return n[e]==="?"&&(a.optional=!0,e++),(a.name==="*"||a.name[0]==="$")&&(a.optional=!0,a.wildcard=!0),t(),r(":"),a}function s(){t();let a={typeOf:"any"},c,l="";for(;c=n[e],c>="a"&&c<="z"||c>="A"&&c<="Z";)l+=c,e++;if(l.length===0)if(n[e]==="*")r("*"),a.typeOf="any";else if(["'",'"',"`"].includes(n[e])){a.typeOf="string",a.value="";const u=n[e];for(r(u);c=n[e],c&&c!==u;)a.value+=c,e++;r(u)}else if(n[e]>="0"&&n[e]<="9"){a.typeOf="number";let u="";for(;c=n[e],c==="."||c==="n"||c>="0"&&c<="9";)u+=c,e++;u.endsWith("n")?a.value=BigInt(u):u.includes(".")?a.value=parseFloat(u):a.value=parseInt(u)}else if(n[e]==="{"){for(r("{"),a.typeOf="object",a.instanceOf=Object,a.children=[];;){const u=i(),h=o();if(a.children.push({name:u.name,optional:u.optional,wildcard:u.wildcard,types:h}),t(),(n[e]===";"||n[e]===",")&&(r(n[e]),t()),n[e]==="}")break}r("}")}else if(n[e]==="/"){r("/");let u="",h="";for(;c=n[e],c!=="/"||u.endsWith("\\");)u+=c,e++;for(r("/");c=n[e],["g","i","m","s","u","y","d"].includes(c);)h+=c,e++;a.typeOf="string",a.matches=new RegExp(u,h)}else throw new Error(`Expected a type definition at position ${e}, found character '${n[e]}'`);else if(["string","number","boolean","bigint","undefined","String","Number","Boolean","BigInt"].includes(l))a.typeOf=l.toLowerCase();else if(l==="Object"||l==="object")a.typeOf="object",a.instanceOf=Object;else if(l==="Date")a.typeOf="object",a.instanceOf=Date;else if(l==="Binary"||l==="binary")a.typeOf="object",a.instanceOf=ArrayBuffer;else if(l==="any")a.typeOf="any";else if(l==="null")a.typeOf="object",a.value=null;else if(l==="Array")r("<"),a.typeOf="object",a.instanceOf=Array,a.genericTypes=o(),r(">");else if(["true","false"].includes(l))a.typeOf="boolean",a.value=l==="true";else throw new Error(`Unknown type at position ${e}: "${a}"`);for(t();n[e]==="[";)r("["),r("]"),a={typeOf:"object",instanceOf:Array,genericTypes:[a]};return a}function o(){t();const a=[s()];for(;n[e]==="|";)r("|"),a.push(s()),t();return a}return s()}function IP(n,e,t,r){const i=e.find(h=>h.name==="*"||h.name[0]==="$")?[]:Object.keys(t).filter(h=>![null,void 0].includes(t[h])&&!e.find(p=>p.name===h));if(i.length>0)return{ok:!1,reason:`Object at path "${n}" cannot have propert${i.length===1?"y":"ies"} ${i.map(h=>`"${h}"`).join(", ")}`};function s(h){const p=![null,void 0].includes(t[h.name]);return!h.optional&&(r?t[h.name]===null:!p)?{ok:!1,reason:`Property at path "${n}/${h.name}" is not optional`}:p&&h.types.length===1?to(`${n}/${h.name}`,h.types[0],t[h.name],!1):p&&!h.types.some(f=>to(`${n}/${h.name}`,f,t[h.name],!1).ok)?{ok:!1,reason:`Property at path "${n}/${h.name}" does not match any of ${h.types.length} allowed types`}:{ok:!0}}const o=e.filter(h=>!h.wildcard),a=o.find(h=>!s(h).ok);if(a)return{ok:!1,reason:s(a).reason};const c=e.find(h=>h.wildcard);if(!c)return{ok:!0};const l=Object.keys(t).filter(h=>!o.find(p=>p.name===h));let u={ok:!0};for(let h=0;h<l.length&&u.ok;h++){const p=l[h];u=s({name:p,types:c.types,optional:!0,wildcard:!0})}return u}function to(n,e,t,r,i){const s={ok:!0};if(e.typeOf==="any")return s;if(i instanceof Array&&i.length>0){if(e.typeOf!=="object")return{ok:!1,reason:`path "${n}" must be typeof ${e.typeOf}`};if(!e.children)return s;const o=i[0];let a=e.children.find(l=>l.name===o);if(a||(a=e.children.find(l=>l.name==="*"||l.name[0]==="$")),!a)return{ok:!1,reason:`Object at path "${n}" cannot have property "${o}"`};if(a.optional&&t===null&&i.length===1)return s;let c;return a.types.some(l=>{const u=typeof o=="number"?`${n}[${o}]`:`${n}/${o}`;return c=to(u,l,t,r,i.slice(1)),c.ok}),c}return t===null?s:e.instanceOf===Object&&(typeof t!="object"||t instanceof Array||t instanceof Date)?{ok:!1,reason:`path "${n}" must be an object collection`}:e.instanceOf&&(typeof t!="object"||t.constructor!==e.instanceOf)?{ok:!1,reason:`path "${n}" must be an instance of ${e.instanceOf.name}`}:"value"in e&&t!==e.value?{ok:!1,reason:`path "${n}" must be value: ${e.value}`}:typeof t!==e.typeOf?{ok:!1,reason:`path "${n}" must be typeof ${e.typeOf}`}:e.instanceOf===Array&&e.genericTypes&&!t.every(o=>e.genericTypes.some(a=>to(n,a,o,!1).ok))?{ok:!1,reason:`every array value of path "${n}" must match one of the specified types`}:e.typeOf==="object"&&e.children?IP(n,e.children,t,r):e.matches&&!e.matches.test(t)?{ok:!1,reason:`path "${n}" must match regular expression /${e.matches.source}/${e.matches.flags}`}:s}function RP(n){switch(n){case String:return"string";case Number:return"number";case Boolean:return"boolean";case Date:return"Date";case BigInt:return"bigint";case Array:throw new Error("Schema error: Array cannot be used without a type. Use string[] or Array<string> instead");default:throw new Error(`Schema error: unknown type used: ${n.name}`)}}class CP{constructor(e,t={warnOnly:!1}){if(this.handling=t,this.source=e,typeof e=="object"){const r=i=>"{"+Object.keys(i).map(s=>{let o=i[s];if(o===void 0)o="undefined";else if(o instanceof RegExp)o=`/${o.source}/${o.flags}`;else if(typeof o=="object")o=r(o);else if(typeof o=="function")o=RP(o);else if(!["string","number","boolean","bigint"].includes(typeof o))throw new Error(`Type definition for key "${s}" must be a string, number, boolean, bigint, object, regular expression, or one of these classes: String, Number, Boolean, Date, BigInt`);return`${s}:${o}`}).join(",")+"}";this.text=r(e)}else if(typeof e=="string")this.text=e;else throw new Error("Type definiton must be a string or an object");this.type=PP(this.text)}check(e,t,r,i){const s=to(e,this.type,t,r,i);return!s.ok&&this.handling.warnOnly&&(s.warning=`${r?"Partial schema":"Schema"} check on path "${e}"${i?` for child "${i.join("/")}"`:""} failed: ${s.reason}`,s.ok=!0,this.handling.warnCallback(s.warning)),s}}class on{constructor(e="browser"){throw new Error(`This feature is not supported in ${e} context`)}}class Vl extends on{}class nh extends on{}class dy extends on{}class NP extends on{}class py extends on{}class jP extends on{}const BP={OBJECT:1,ARRAY:2,NUMBER:3,BOOLEAN:4,STRING:5,BIGINT:7,DATETIME:6,BINARY:8,REFERENCE:9},ae=BP;function LP(n){switch(n){case ae.ARRAY:return"array";case ae.BINARY:return"binary";case ae.BOOLEAN:return"boolean";case ae.DATETIME:return"date";case ae.NUMBER:return"number";case ae.OBJECT:return"object";case ae.REFERENCE:return"reference";case ae.STRING:return"string";case ae.BIGINT:return"bigint"}}class Ob{constructor(e){if(this.path=e.path,this.type=e.type,this.index=e.index,this.key=e.key,this.exists=e.exists,this.address=e.address,this.value=e.value,this.childCount=e.childCount,typeof this.path=="string"&&typeof this.key=="undefined"&&typeof this.index=="undefined"){const t=Y.get(this.path);typeof t.key=="number"?this.index=t.key:this.key=t.key}typeof this.exists=="undefined"&&(this.exists=!0)}get valueType(){return this.type}get valueTypeName(){return LP(this.valueType)}toString(){return this.exists?this.address?`"${this.path}" is ${this.valueTypeName} stored at ${this.address.toString()}`:`"${this.path}" is ${this.valueTypeName} with value ${this.value}`:`"${this.path}" doesn't exist`}}function en(n,e){if(!n)throw new Error(`Assertion failed: ${e!=null?e:"check your code"}`)}const DP=120,tn={PENDING:"pending",LOCKED:"locked",EXPIRED:"expired",DONE:"done"};class Sb{constructor(e,t=DP){this._locks=[],this._lastTid=0,this.debug=e,this.timeout=t*1e3}setTimeout(e){this.timeout=e*1e3}createTid(){return Kt.generate()}_allowLock(e,t,r){const i=this._locks.find(s=>s.tid!==t&&s.state===tn.LOCKED&&(r||s.forWriting));return{allow:!i,conflict:i}}quit(){return new Promise(e=>{if(this._locks.length===0)return e();this._quit=e})}_rejectLock(e,t){this._locks.splice(this._locks.indexOf(e),1),clearTimeout(e.timeout);try{e.reject(t)}catch(r){console.error("Unhandled promise rejection:",r)}}_processLockQueue(){if(this._quit){const e=new Error("Quitting");this._locks.filter(t=>t.state===tn.PENDING).forEach(t=>this._rejectLock(t,e)),this._locks.length===0&&this._quit()}this._locks.filter(e=>e.state===tn.PENDING).sort((e,t)=>e.priority&&!t.priority?-1:!e.priority&&t.priority?1:e.requested-t.requested).forEach(e=>{const t=this._allowLock(e.path,e.tid,e.forWriting);e.waitingFor=t.conflict||null,t.allow&&this.lock(e).then(e.resolve).catch(r=>this._rejectLock(e,r))})}lock(e,t){return W(this,arguments,function*(r,i,s=!0,o="",a={withPriority:!1,noTimeout:!1}){let c,l;if(r instanceof Kl)c=r,l=!0;else{if(this._locks.findIndex(u=>u.tid===i&&u.state===tn.EXPIRED)>=0)throw new Error(`lock on tid ${i} has expired, not allowed to continue`);if(this._quit&&!a.withPriority)throw new Error("Quitting");{c=new Kl(this,r,i,s,a.withPriority===!0),c.comment=o,this._locks.push(c);const u=this._allowLock(r,i,s);c.waitingFor=u.conflict||null,l=u.allow}}if(l){if(c.state=tn.LOCKED,typeof c.granted!="number"&&(c.granted=Date.now(),a.noTimeout!==!0)){c.expires=Date.now()+this.timeout;let u=0;const h=()=>{if(c.state===tn.LOCKED){if(u++,u<=3){this.debug.warn(`${c.forWriting?"write":"read"} lock on path "/${c.path}" by tid ${c.tid} (${c.comment}) is taking a long time to complete [${u}]`),c.timeout=setTimeout(h,this.timeout/4);return}this.debug.error(`lock :: ${c.forWriting?"write":"read"} lock on path "/${c.path}" by tid ${c.tid} (${c.comment}) took too long`),c.state=tn.EXPIRED,this._processLockQueue()}};c.timeout=setTimeout(h,this.timeout/4)}return c}else return en(c.state===tn.PENDING),new Promise((u,h)=>{c.resolve=u,c.reject=h})})}unlock(e,t,r=!0){let i,s;if(e instanceof Kl)i=e,s=this._locks.indexOf(i);else{const o=e;s=this._locks.findIndex(a=>a.id===o),i=this._locks[s]}if(s<0){const o=`lock on "/${i.path}" for tid ${i.tid} wasn't found; ${t}`;throw new Error(o)}return i.state=tn.DONE,clearTimeout(i.timeout),this._locks.splice(s,1),r&&this._processLockQueue(),i}list(){return this._locks||[]}isAllowed(e,t,r){return this._allowLock(e,t,r).allow}}let UP=0;class Kl{static get LOCK_STATE(){return tn}constructor(e,t,r,i,s=!1){this.locker=e,this.path=t,this.tid=r,this.forWriting=i,this.priority=s,this.state=tn.PENDING,this.requested=Date.now(),this.comment="",this.waitingFor=null,this.id=++UP,this.history=[]}release(e){return W(this,null,function*(){return this.history.push({action:"release",path:this.path,forWriting:this.forWriting,comment:e}),this.locker.unlock(this,e||this.comment)})}moveToParent(){return W(this,null,function*(){const e=Y.get(this.path).parentPath;if(this.locker.isAllowed(e,this.tid,this.forWriting))return this.history.push({path:this.path,forWriting:this.forWriting,action:"moving to parent"}),this.waitingFor=null,this.path=e,this;{this.locker.unlock(this,`moveLockToParent: ${this.comment}`,!1);const t=yield this.locker.lock(e,this.tid,this.forWriting,this.comment,{withPriority:!0});return t.history=this.history,t.history.push({path:this.path,forWriting:this.forWriting,action:"moving to parent through queue (priority)"}),t}})}}class jf extends Error{}class rh extends Error{}class FP extends Error{constructor(e){super(`Exiting: ${e}`)}}class MP extends ds{get isMaster(){return this.masterPeerId===this.id}constructor(e,t,r=e.name){super(),this.storage=e,this.id=t,this.dbname=r,this.ipcType="ipc",this.ourSubscriptions=[],this.remoteSubscriptions=[],this.peers=[],this._exiting=!1,this._locks=[],this._requests=new Map,this._eventsEnabled=!0,this._nodeLocker=new Sb(e.debug,e.settings.lockTimeout),e.on("subscribe",i=>{if(e.debug.verbose(`database subscription being added on peer ${this.id}`),this.remoteSubscriptions.find(a=>a.callback===i.callback))return;const s=this.ourSubscriptions.some(a=>a.event===i.event&&a.path===i.path);if(this.ourSubscriptions.push(i),s)return;const o={type:"subscribe",from:this.id,data:{path:i.path,event:i.event}};this.sendMessage(o)}),e.on("unsubscribe",i=>{const s=this.remoteSubscriptions.find(o=>o.callback===i.callback);if(s){this.remoteSubscriptions.splice(this.remoteSubscriptions.indexOf(s),1);return}this.ourSubscriptions.filter(o=>o.path===i.path&&(!i.event||o.event===i.event)&&(!i.callback||o.callback===i.callback)).forEach(o=>{this.ourSubscriptions.splice(this.ourSubscriptions.indexOf(o),1);const a={type:"unsubscribe",from:this.id,data:{path:o.path,event:o.event}};this.sendMessage(a)})})}exit(e=0){return W(this,null,function*(){if(this._exiting)return this.once("exit");this._exiting=!0,this.storage.debug.warn(`Received ${this.isMaster?"master":"worker "+this.id} process exit request`),this._locks.length>0&&(this.storage.debug.warn(`Waiting for ${this.isMaster?"master":"worker"} ${this.id} locks to clear`),yield this.once("locks-cleared")),this.sayGoodbye(this.id),this.storage.debug.warn(`${this.isMaster?"Master":"Worker "+this.id} will now exit`),this.emitOnce("exit",e)})}sayGoodbye(e){const t={type:"bye",from:e,data:void 0};this.sendMessage(t)}addPeer(e,t=!0){if(!this._exiting&&(this.peers.find(r=>r.id===e)||this.peers.push({id:e,lastSeen:Date.now()}),t)){const r={type:"hello",from:this.id,to:e,data:void 0};this.sendMessage(r),this.ourSubscriptions.forEach(i=>{const s={type:"subscribe",from:this.id,to:e,data:{path:i.path,event:i.event}};this.sendMessage(s)})}}removePeer(e,t=!1){if(this._exiting)return;const r=this.peers.find(i=>i.id===e);if(!r){if(!t)throw new Error("We are supposed to know this peer!");return}this.peers.splice(this.peers.indexOf(r),1),this.remoteSubscriptions.filter(i=>i.for===e).forEach(i=>{this.remoteSubscriptions.splice(this.remoteSubscriptions.indexOf(i),1),this.storage.subscriptions.remove(i.path,i.event,i.callback)})}addRemoteSubscription(e,t){if(this._exiting||this.remoteSubscriptions.some(i=>i.for===e&&i.event===t.event&&i.path===t.path))return;const r=(i,s,o,a,c)=>{const l={type:"event",from:this.id,to:e,path:t.path,event:t.event,data:{path:s,val:o,previous:a,context:c}};this.sendMessage(l)};this.remoteSubscriptions.push({for:e,event:t.event,path:t.path,callback:r}),this.storage.subscriptions.add(t.path,t.event,r)}cancelRemoteSubscription(e,t){const r=this.remoteSubscriptions.find(i=>i.for===e&&i.event===t.event&&i.path===t.event);!r||this.storage.subscriptions.remove(t.path,t.event,r.callback)}handleMessage(e){return W(this,null,function*(){switch(e.type){case"hello":return this.addPeer(e.from,e.to!==this.id);case"bye":return this.removePeer(e.from,!0);case"subscribe":return this.addRemoteSubscription(e.from,e.data);case"unsubscribe":return this.cancelRemoteSubscription(e.from,e.data);case"event":{if(!this._eventsEnabled)break;const t=e,r=t.data.context||{};r.acebase_ipc={type:this.ipcType,origin:t.from},this.ourSubscriptions.filter(i=>i.event===t.event&&i.path===t.path).forEach(i=>{i.callback(null,t.data.path,t.data.val,t.data.previous,r)});break}case"lock-request":{if(!this.isMaster)throw new Error("Workers are not supposed to receive lock requests!");const t=e,r={type:"lock-result",id:t.id,from:this.id,to:t.from,ok:!0,data:void 0};try{const i=yield this.lock(t.data);r.data={id:i.id,path:i.path,tid:i.tid,write:i.forWriting,expires:i.expires,comment:i.comment}}catch(i){r.ok=!1,r.reason=i.stack||i.message||i}return this.sendMessage(r)}case"lock-result":{if(this.isMaster)throw new Error("Masters are not supposed to receive results for lock requests!");const t=e,r=this._requests.get(t.id);if(typeof r!="object")throw new Error("The request must be known to us!");t.ok?r.resolve(t.data):r.reject(new Error(t.reason));return}case"unlock-request":{if(!this.isMaster)throw new Error("Workers are not supposed to receive unlock requests!");const t=e,r={type:"unlock-result",id:t.id,from:this.id,to:t.from,ok:!0,data:{id:t.data.id}};try{yield this._locks.find(i=>{var s;return((s=i.lock)==null?void 0:s.id)===t.data.id}).lock.release()}catch(i){r.ok=!1,r.reason=i.stack||i.message||i}return this.sendMessage(r)}case"unlock-result":{if(this.isMaster)throw new Error("Masters are not supposed to receive results for unlock requests!");const t=e,r=this._requests.get(t.id);if(typeof r!="object")throw new Error("The request must be known to us!");t.ok?r.resolve(t.data):r.reject(new Error(t.reason));return}case"move-lock-request":{if(!this.isMaster)throw new Error("Workers are not supposed to receive move lock requests!");const t=e,r={type:"lock-result",id:t.id,from:this.id,to:t.from,ok:!0,data:void 0};try{let i;const s=this._locks.find(o=>{var a;return((a=o.lock)==null?void 0:a.id)===t.data.id});if(t.data.move_to==="parent")i=yield s.lock.moveToParent();else throw new Error(`Unknown lock move_to "${t.data.move_to}"`);s.lock=i,r.data={id:i.id,path:i.path,tid:i.tid,write:i.forWriting,expires:i.expires,comment:i.comment}}catch(i){r.ok=!1,r.reason=i.stack||i.message||i}return this.sendMessage(r)}case"notification":return this.emit("notification",e);case"request":return this.emit("request",e);case"result":{const t=e,r=this._requests.get(t.id);if(typeof r!="object")throw new Error("Result of unknown request received");t.ok?r.resolve(t.data):r.reject(new Error(t.reason))}}})}lock(e){return W(this,null,function*(){if(this._exiting&&!this._locks.find(r=>r.tid===e.tid&&r.granted))throw new FP("new transaction lock denied because the IPC peer is exiting");const t=r=>{this._locks.splice(this._locks.indexOf(r),1),this._locks.length===0&&this.emit("locks-cleared")};if(this.isMaster){const r={tid:e.tid,granted:!1,request:e,lock:null};this._locks.push(r);const i=yield this._nodeLocker.lock(e.path,e.tid,e.write,e.comment);r.tid=i.tid,r.granted=!0;const s=o=>({get id(){return o.id},get tid(){return o.tid},get path(){return o.path},get forWriting(){return o.forWriting},get expires(){return o.expires},get comment(){return o.comment},get state(){return o.state},release:()=>W(this,null,function*(){yield o.release(),t(r)}),moveToParent:()=>W(this,null,function*(){const a=yield o.moveToParent();return r.lock=s(a),r.lock})});return r.lock=s(i),r.lock}else{const r={tid:e.tid,granted:!1,request:e,lock:null};this._locks.push(r);const i=c=>(r.granted=!0,r.tid=c.tid,r.lock={id:c.id,tid:c.tid,path:c.path,forWriting:c.write,state:tn.LOCKED,expires:c.expires,comment:c.comment,release:()=>W(this,null,function*(){const l={type:"unlock-request",id:Kt.generate(),from:this.id,to:this.masterPeerId,data:{id:r.lock.id}};yield this.request(l),r.lock.state=tn.DONE,this.storage.debug.verbose(`Worker ${this.id} released lock ${r.lock.id} (tid ${r.lock.tid}, ${r.lock.comment}, "/${r.lock.path}", ${r.lock.forWriting?"write":"read"})`),t(r)}),moveToParent:()=>W(this,null,function*(){const l={type:"move-lock-request",id:Kt.generate(),from:this.id,to:this.masterPeerId,data:{id:r.lock.id,move_to:"parent"}};let u;try{u=yield this.request(l)}catch(h){throw r.lock.state=tn.DONE,t(r),h}return r.lock=i(u),r.lock})},r.lock),s={type:"lock-request",id:Kt.generate(),from:this.id,to:this.masterPeerId,data:e};let o,a;try{o=yield this.request(s)}catch(c){a=c,o=null}if(a)throw t(r),a;return i(o)}})}request(e){return W(this,null,function*(){let t,r;const i=new Promise((s,o)=>{t=a=>{this._requests.delete(e.id),s(a)},r=a=>{this._requests.delete(e.id),o(a)}});return this._requests.set(e.id,{resolve:t,reject:r,request:e}),this.sendMessage(e),i})}sendRequest(e){const t={type:"request",from:this.id,to:this.masterPeerId,id:Kt.generate(),data:e};return this.request(t).catch(r=>{throw this.storage.debug.error(r),r})}replyRequest(e,t){const r={type:"result",id:e.id,ok:!0,from:this.id,to:e.from,data:t};this.sendMessage(r)}sendNotification(e){const t={type:"notification",from:this.id,data:e};this.sendMessage(t)}get eventsEnabled(){return this._eventsEnabled}set eventsEnabled(e){this.storage.debug.log(`ipc events ${e?"enabled":"disabled"}`),this._eventsEnabled=e}}class qP extends MP{constructor(e){if(super(e,Kt.generate()),this.masterPeerId=this.id,this.ipcType="browser.bcc",window.addEventListener("beforeunload",()=>{this.exit()}),typeof window.BroadcastChannel!="undefined")this.channel=new BroadcastChannel(`acebase:${e.name}`);else{const r=[null],i=()=>{throw new Error("Not implemented")};this.channel={name:`acebase:${e.name}`,postMessage:s=>{const o=Kt.generate(),a=`acebase:${e.name}:${this.id}:${o}`,c=JSON.stringify(Ab(s));localStorage.setItem(a,c),setTimeout(()=>localStorage.removeItem(a),10)},set onmessage(s){r[0]=s},set onmessageerror(s){i()},close(){i()},addEventListener(s,o){s!=="message"&&i(),r.push(o)},removeEventListener(s,o){const a=r.indexOf(o);a>=1&&r.splice(a,1)},dispatchEvent(s){return r.forEach(o=>{try{o&&o(s)}catch(a){console.error(a)}}),!0}},window.addEventListener("storage",s=>{const[o,a,c,l]=s.key.split(":");if(o!=="acebase"||a!==e.name||c===this.id||s.newValue===null)return;const u=$P(JSON.parse(s.newValue));this.channel.dispatchEvent({data:u})})}this.channel.addEventListener("message",r=>W(this,null,function*(){const i=r.data;if(!(i.to&&i.to!==this.id)){if(e.debug.verbose("[BroadcastChannel] received: ",i),i.type==="hello"&&i.from<this.masterPeerId)this.masterPeerId=i.from,e.debug.log(`[BroadcastChannel] Tab ${this.masterPeerId} is the master.`);else if(i.type==="bye"&&i.from===this.masterPeerId){e.debug.log(`[BroadcastChannel] Master tab ${this.masterPeerId} is leaving`);const s=this.peers.map(a=>a.id).concat(this.id).filter(a=>a!==this.masterPeerId);this.masterPeerId=s.sort()[0],e.debug.log(`[BroadcastChannel] ${this.masterPeerId===this.id?"We are":`tab ${this.masterPeerId} is`} the new master. Requesting ${this._locks.length} locks (${this._locks.filter(a=>!a.granted).length} pending)`);const o=this._locks.splice(0);yield Promise.all(o.filter(a=>a.granted).map(a=>W(this,null,function*(){let c,l;a.lock.release=()=>new Promise(h=>c=h),a.lock.moveToParent=()=>new Promise(h=>l=h);const u=yield this.lock({path:a.lock.path,write:a.lock.forWriting,tid:a.lock.tid,comment:a.lock.comment});if(l){const h=yield u.moveToParent();l(h)}c&&(yield u.release(),c())}))),yield Promise.all(o.filter(a=>!a.granted).map(a=>W(this,null,function*(){yield this.lock(a.request)})))}return this.handleMessage(i)}}));const t={type:"hello",from:this.id,data:void 0};this.sendMessage(t)}sendMessage(e){this.storage.debug.verbose("[BroadcastChannel] sending: ",e),this.channel.postMessage(e)}}class qs{static get hasFileSystem(){return!1}static get fs(){return null}}class Bf extends on{}class $b extends on{}class VP extends on{}class KP extends on{}function WP(n,e,t,r){return W(this,null,function*(){if(!n.storage.indexes.supported)throw new Error("Indexes are not supported in current environment because it requires Node.js fs");const{ipc:i,debug:s,indexes:o,storage:a}=n,c=r&&r.rebuild===!0,l=r&&r.type||"normal";let u=r&&r.include||[];typeof u=="string"&&(u=[u]);const h=o.find(f=>f.path===e&&f.key===t&&f.type===l&&f.includeKeys.length===u.length&&f.includeKeys.every((d,y)=>u[y]===d));if(h&&r.config&&(h.config=r.config),h&&c!==!0)return s.log(`Index on "/${e}/*/${t}" already exists`.colorize($t.inverse)),h;if(!i.isMaster){const f=yield i.sendRequest({type:"index.create",path:e,key:t,options:r});if(f.ok)return a.indexes.add(f.fileName);throw new Error(f.reason)}yield qs.mkdir(`${a.settings.path}/${a.name}.acebase`).catch(f=>{if(f.code!=="EEXIST")throw f});const p=h||(()=>{const{include:f,caseSensitive:d,textLocale:y,textLocaleKey:_}=r,S={include:f,caseSensitive:d,textLocale:y,textLocaleKey:_};switch(l){case"array":return new KP(a,e,t,se({},S));case"fulltext":return new $b(a,e,t,nt(se({},S),{config:r.config}));case"geo":return new VP(a,e,t,se({},S));default:return new Bf(a,e,t,se({},S))}})();h||o.push(p);try{yield p.build()}catch(f){throw n.debug.error(`Index build on "/${e}/*/${t}" failed: ${f.message} (code: ${f.code})`.colorize($t.red)),h||o.splice(o.indexOf(p),1),f}return i.sendNotification({type:"index.created",fileName:p.fileName,path:e,key:t,options:r}),p})}const{compareValues:Qo,getChildValues:vi,encodeString:yy,defer:zP}=yb,ih=["value","child_added","child_changed","child_removed","mutated","mutations"];ih.push(...ih.map(n=>`notify_${n}`));const HP=()=>{};class JP extends Error{constructor(e){super(`Schema validation failed: ${e}`),this.reason=e}}class Lf{constructor(e={}){this.maxInlineValueSize=50,this.removeVoidProperties=!1,this.path=".",this.lockTimeout=120,this.type="data",this.readOnly=!1,typeof e.maxInlineValueSize=="number"&&(this.maxInlineValueSize=e.maxInlineValueSize),typeof e.removeVoidProperties=="boolean"&&(this.removeVoidProperties=e.removeVoidProperties),typeof e.path=="string"&&(this.path=e.path),this.path.endsWith("/")&&(this.path=this.path.slice(0,-1)),typeof e.lockTimeout=="number"&&(this.lockTimeout=e.lockTimeout),typeof e.type=="string"&&(this.type=e.type),typeof e.readOnly=="boolean"&&(this.readOnly=e.readOnly),["object","string"].includes(typeof e.ipc)&&(this.ipc=e.ipc)}}class YP extends ds{createTid(){return Kt.generate()}constructor(e,t,r){super(),this.name=e,this.settings=t,this._schemas=[],this._indexes=[],this._annoucedIndexes=new Map,this.indexes={get supported(){return qs==null?void 0:qs.hasFileSystem},create:(s,o,a={rebuild:!1})=>{const c={storage:this,debug:this.debug,indexes:this._indexes,ipc:this.ipc};return WP(c,s,o,a)},get:(s,o=null)=>{if(s.includes("$")){const a=Y.getPathKeys(s).map(c=>typeof c=="string"&&c.startsWith("$")?"*":c);s=new Y(a).path}return this._indexes.filter(a=>a.path===s&&(o===null||o===a.key))},getAll:(s,o={parentPaths:!0,childPaths:!0})=>{const a=Y.getPathKeys(s);return this._indexes.filter(c=>{const l=Y.getPathKeys(c.path+"/*");return o.parentPaths&&l.every((u,h)=>u==="*"||a[h]===u)&&[c.key].concat(...c.includeKeys).includes(a[l.length])?!0:l.length<a.length||!o.childPaths&&l.length!==a.length?!1:a.every((u,h)=>[u,"*"].includes(l[h]))})},list:()=>this._indexes.slice(),load:()=>W(this,null,function*(){if(this._indexes.splice(0),!qs.hasFileSystem)return;let s=[];try{s=yield qs.readdir(`${this.settings.path}/${this.name}.acebase`)}catch(a){a.code!=="ENOENT"&&this.debug.error(a)}const o=[];s.forEach(a=>{if(!a.endsWith(".idx"))return;const c=this.settings.type!=="data",l=/^\[[a-z]+\]-/.test(a);if(!c&&!l||c&&a.startsWith(`[${this.settings.type}]-`)){const u=this.indexes.add(a);o.push(u)}}),yield Promise.all(o)}),add:s=>W(this,null,function*(){const o=this._indexes.find(a=>a.fileName===s);if(o)return o;if(this._annoucedIndexes.has(s))return yield this._annoucedIndexes.get(s);try{const a=Bf.readFromFile(this,s);this._annoucedIndexes.set(s,a);const c=yield a;return this._indexes.push(c),this._annoucedIndexes.delete(s),c}catch(a){return this.debug.error(a),null}}),delete:s=>W(this,null,function*(){const o=yield this.indexes.remove(s);yield o.delete(),this.ipc.sendNotification({type:"index.deleted",fileName:o.fileName,path:o.path,keys:o.key})}),remove:s=>W(this,null,function*(){const o=this._indexes.find(a=>a.fileName===s);if(!o)throw new Error(`Index ${s} not found`);return this._indexes.splice(this._indexes.indexOf(o),1),o}),close:()=>W(this,null,function*(){const s=this.indexes.list().map(o=>o.close().catch(a=>this.debug.error(a)));yield Promise.all(s)})},this._eventSubscriptions={},this.subscriptions={add:(s,o,a)=>{if(ih.indexOf(o)<0)throw new TypeError(`Invalid event type "${o}"`);let c=this._eventSubscriptions[s];c||(c=this._eventSubscriptions[s]=[]),c.push({created:Date.now(),type:o,callback:a}),this.emit("subscribe",{path:s,event:o,callback:a})},remove:(s,o,a)=>{const c=this._eventSubscriptions[s];if(!c)return;const l=()=>c.findIndex(h=>(o?h.type===o:!0)&&(a?h.callback===a:!0));let u;for(;(u=l())>=0;)c.splice(u,1);this.emit("unsubscribe",{path:s,event:o,callback:a})},hasValueSubscribersForPath(s){return!!this.getValueSubscribersForPath(s)},getValueSubscribersForPath:s=>{const o=new Y(s),a=[];return Object.keys(this._eventSubscriptions).forEach(c=>{if(o.equals(c)||o.isDescendantOf(c)){const l=this._eventSubscriptions[c],u=Y.fillVariables(c,s);l.filter(h=>!h.type.startsWith("notify_")).forEach(h=>{let p=null;if(h.type==="value")p=u;else if(["mutated","mutations"].includes(h.type)&&o.isDescendantOf(u))p=s;else if(h.type==="child_changed"&&s!==u){const f=Y.getPathKeys(s.slice(u.length).replace(/^\//,""))[0];p=Y.getChildPath(u,f)}else if(["child_added","child_removed"].includes(h.type)&&o.isChildOf(u)){const f=Y.getPathKeys(s.slice(u.length).replace(/^\//,""))[0];p=Y.getChildPath(u,f)}p!==null&&!a.some(f=>f.type===h.type&&f.eventPath===u)&&a.push({type:h.type,eventPath:u,dataPath:p,subscriptionPath:c})})}}),a},getAllSubscribersForPath:s=>{const o=Y.get(s),a=[];return Object.keys(this._eventSubscriptions).forEach(c=>{if(o.isOnTrailOf(c)){const l=this._eventSubscriptions[c],u=Y.fillVariables(c,s);l.forEach(h=>{let p=null;if(h.type==="value"||h.type==="notify_value")p=u;else if(["child_changed","notify_child_changed"].includes(h.type)){const f=s===u||o.isAncestorOf(u)?"*":Y.getPathKeys(s.slice(u.length).replace(/^\//,""))[0];p=Y.getChildPath(u,f)}else if(["mutated","mutations","notify_mutated","notify_mutations"].includes(h.type))p=s;else if(["child_added","child_removed","notify_child_added","notify_child_removed"].includes(h.type)&&(o.isChildOf(u)||s===u||o.isAncestorOf(u))){const f=s===u||o.isAncestorOf(u)?"*":Y.getPathKeys(s.slice(u.length).replace(/^\//,""))[0];p=Y.getChildPath(u,f)}p!==null&&!a.some(f=>f.type===h.type&&f.eventPath===u&&f.subscriptionPath===c)&&a.push({type:h.type,eventPath:u,dataPath:p,subscriptionPath:c})})}}),a},trigger:(s,o,a,c,l,u)=>{(this._eventSubscriptions[o]||[]).filter(h=>h.type===s).forEach(h=>{h.callback(null,a,l,c,u)})}},this.debug=new kb(r.logLevel,`[${e}${typeof t.type=="string"&&t.type!=="data"?`:${t.type}`:""}]`);const i=e+(typeof t.type=="string"?`_${t.type}`:"");if(t.ipc==="socket"||t.ipc instanceof on){const s={ipcName:i,server:t.ipc instanceof on?t.ipc:null};this.ipc=new on(this,s)}else if(t.ipc){if(typeof t.ipc.port!="number")throw new Error("IPC port number must be a number");if(!["master","worker"].includes(t.ipc.role))throw new Error(`IPC client role must be either "master" or "worker", not "${t.ipc.role}"`);const s=Object.assign({dbname:i},t.ipc);this.ipc=new on(this,s)}else this.ipc=new qP(this,i);this.ipc.once("exit",s=>{this.indexes.supported&&this.indexes.close()}),this.nodeLocker={lock:(s,o,a,c)=>this.ipc.lock({path:s,tid:o,write:a,comment:c})},this._lastTid=0}close(){return W(this,null,function*(){yield this.ipc.exit()})}get path(){return`${this.settings.path}/${this.name}.acebase`}valueFitsInline(e){if(typeof e=="number"||typeof e=="boolean"||e instanceof Date)return!0;if(typeof e=="string")return e.length>this.settings.maxInlineValueSize?!1:yy(e).length<this.settings.maxInlineValueSize;if(e instanceof ot)return e.path.length>this.settings.maxInlineValueSize?!1:yy(e.path).length<this.settings.maxInlineValueSize;if(e instanceof ArrayBuffer)return e.byteLength<this.settings.maxInlineValueSize;if(e instanceof Array)return e.length===0;if(typeof e=="object")return Object.keys(e).length===0;throw new TypeError("What else is there?")}_writeNode(e,t,r){throw new Error("This method must be implemented by subclass")}getUpdateImpact(e,t){let r=e,i=!1;const s=t?[]:this.subscriptions.getAllSubscribersForPath(e),o=t?[]:this.subscriptions.getValueSubscribersForPath(e);o.length>0&&(i=!0,r=o.map(l=>({path:l.dataPath,keys:Y.getPathKeys(l.dataPath)})).sort((l,u)=>l.keys.length<u.keys.length?-1:l.keys.length>u.keys.length?1:0)[0].path,o.filter(l=>l.dataPath===r).every(l=>l.type==="mutated"||l.type.startsWith("notify_"))&&(i=!1),r=Y.fillVariables(r,e));const a=this.indexes.getAll(e,{childPaths:!0,parentPaths:!0}).map(l=>({index:l,keys:Y.getPathKeys(l.path)})).sort((l,u)=>l.keys.length<u.keys.length?-1:l.keys.length>u.keys.length?1:0).map(l=>l.index),c=[];if(a.length>0){a.sort((h,p)=>(typeof h._pathKeys=="undefined"&&(h._pathKeys=Y.getPathKeys(h.path)),typeof p._pathKeys=="undefined"&&(p._pathKeys=Y.getPathKeys(p.path)),h._pathKeys.length<p._pathKeys.length?-1:h._pathKeys.length>p._pathKeys.length?1:0));const l=a[0],u=l.path===e?e:Y.fillVariables(`${l.path}/*`,e);u.length<r.length&&(r=u,a.filter(h=>h.path===l.path).forEach(h=>{[h.key].concat(h.includeKeys).forEach(p=>!c.includes(p)&&c.push(p))}))}return{topEventPath:r,eventSubscriptions:s,valueSubscribers:o,hasValueSubscribers:i,indexes:a,keysFilter:c}}_writeNodeWithTracking(e,t){return W(this,arguments,function*(r,i,s={merge:!1,waitForIndexUpdates:!0,suppress_events:!1,context:null,impact:null}){if(s=s||{},!s.tid&&!s.transaction)throw new Error("_writeNodeWithTracking MUST be executed with a tid OR transaction!");s.merge=s.merge===!0;const o=this.validateSchema(r,i,{updates:s.merge});if(!o.ok)throw new JP(o.reason);const a=s.tid,c=s.transaction;let l=null;const u=s.impact?s.impact:this.getUpdateImpact(r,s.suppress_events),{topEventPath:h,eventSubscriptions:p,hasValueSubscribers:f,indexes:d}=u;let{keysFilter:y}=u;const _=()=>{if(typeof s._customWriteFunction=="function")return s._customWriteFunction();if(l){const E=Y.getPathKeys(r),m=Y.getPathKeys(h),v=E.slice(m.length);let g=l;for(;v.length>0&&g!==null;){const k=v.shift();g=typeof g=="object"&&k in g?g[k]:null}s.currentValue=g}return this._writeNode(r,i,s)},S=this.settings.transactions&&this.settings.transactions.log===!0;if(p.length===0&&d.length===0&&!S)return _();if(!f&&s.merge===!0&&y.length===0&&(y=Object.keys(i),h!==r)){const E=r.slice(h.length);y=y.map(m=>`${E}/${m}`)}const I=yield this.getNodeInfo(h,{transaction:c,tid:a});let B=null;if(I.exists){const E={transaction:c,tid:a};y.length>0&&(E.include=y),h===""&&typeof E.include=="undefined"&&this.debug.warn('WARNING: One or more value event listeners on the root node are causing the entire database value to be read to facilitate change tracking. Using "value", "notify_value", "child_changed" and "notify_child_changed" events on the root node are a bad practice because of the significant performance impact. Use "mutated" or "mutations" events instead'),B=(yield this.getNode(h,E)).value}l=B;const j=(yield _())||{};let U,M;if(r===h)s.merge?l===null?U=i instanceof Array?[]:{}:(U=l instanceof Array?[]:{},Object.keys(l).forEach(E=>{U[E]=l[E]})):U=i,M=U;else{const E=r.slice(h.length).replace(/^\//,""),m=Y.getPathKeys(E);for(l===null?U=typeof m[0]=="number"?[]:{}:(U=l instanceof Array?[]:{},Object.keys(l).forEach(v=>{U[v]=l[v]})),M=U;m.length>0;){const v=m.shift();if(!s.merge&&m.length===0)M[v]=i;else{const g=M[v],k=typeof v=="number"?[...g]:se({},g);M[v]=k}M=M[v]}}s.merge&&Object.keys(i).forEach(E=>{M[E]=i[E]});const H=Qo(l,U);if(H==="identical")return j.mutations=[],j;function L(E){if(E===null||typeof E!="object")return E;Object.keys(E).forEach(m=>{const v=E[m];v===null&&(delete E[m],E instanceof Array&&E.length--),typeof v=="object"&&L(v)})}L(U);const F=[];d.map(E=>({index:E,keys:Y.getPathKeys(E.path)})).sort((E,m)=>E.keys.length<m.keys.length?1:E.keys.length>m.keys.length?-1:0).forEach(({index:E})=>{const m=Y.getPathKeys(h),v=Y.getPathKeys(E.path+"/*"),g=v.slice(m.length),k=l,x=U;if(g.length===0){en(m.length===v.length,"check logic");const w=this.ipc.isMaster?E.handleRecordUpdate(h,k,x):this.ipc.sendRequest({type:"index.update",fileName:E.fileName,path:h,oldValue:k,newValue:x});F.push(w);return}const b=(w,A,O)=>{if(A===null&&O===null)return[];const $=Y.getPathKeys(w),P=Y.getPathKeys(E.path+"/*"),N=P.slice($.length);if(N.length===0)return en($.length===P.length,"check logic"),[{path:w,oldValue:A,newValue:O}];let D=[],z="";for(;N.length>0;){const q=N.shift();if(typeof q=="string"&&(q==="*"||q.startsWith("$"))){const ne=A===null?[]:Object.keys(A);O!==null&&Object.keys(O).forEach(te=>{ne.indexOf(te)<0&&ne.push(te)}),ne.forEach(te=>{const ue=Y.getChildPath(z,te),le=vi(te,A,O),ie=Y.getChildPath(w,ue),pe=b(ie,le.oldValue,le.newValue);D=D.concat(pe)});break}else{const ne=vi(q,A,O);if(A=ne.oldValue,O=ne.newValue,A===null&&O===null)break;z=Y.getChildPath(z,q)}}return D};b(h,k,x).forEach(w=>{const A=this.ipc.isMaster?E.handleRecordUpdate(w.path,w.oldValue,w.newValue):this.ipc.sendRequest({type:"index.update",fileName:E.fileName,path:w.path,oldValue:w.oldValue,newValue:w.newValue});F.push(A)})});const T=(E,m,v,g=[])=>{let k=!0,x=E.type;if(x.startsWith("notify_")&&(x=x.slice(7)),x==="mutated"||(x==="child_changed"&&(m===null||v===null)?k=!1:x==="value"||x==="child_changed"?k=Qo(m,v)!=="identical":x==="child_added"?k=m===null&&v!==null:x==="child_removed"&&(k=m!==null&&v===null),!k))return;const b=Y.getPathKeys(E.dataPath);g.forEach(A=>{const O=b.indexOf(A.name);en(O>=0,`Variable "${A.name}" not found in subscription dataPath "${E.dataPath}"`),b[O]=A.value});const w=b.reduce((A,O)=>Y.getChildPath(A,O),"");this.subscriptions.trigger(E.type,E.subscriptionPath,w,m,v,s.context)},R=(E,m,v,g)=>{const k=[],x=g||Qo(m,v);return x==="identical"||(typeof x=="string"?k.push({path:E,oldValue:m,newValue:v}):(x.changed.forEach(b=>{const w=Y.getChildPath(E,b.key),A=vi(b.key,m,v),O=R(w,A.oldValue,A.newValue,b.change);k.push(...O)}),x.added.forEach(b=>{const w=Y.getChildPath(E,b);k.push({path:w,oldValue:null,newValue:v[b]})}),m instanceof Array&&v instanceof Array&&x.removed.sort((b,w)=>b<w?1:-1),x.removed.forEach(b=>{const w=Y.getChildPath(E,b);k.push({path:w,oldValue:m[b],newValue:null})}))),k};S&&this.settings.type!=="transaction"&&(j.mutations=(()=>{const E=r.slice(h.length).replace(/^\//,""),m=Y.getPathKeys(E);let v=l,g=U;for(;m.length>0;){const x=m.shift();({oldValue:v,newValue:g}=vi(x,v,g))}const k=Qo(v,g);return R(r,v,g,k).map(x=>({target:Y.getPathKeys(x.path.slice(r.length)),prev:x.oldValue,val:x.newValue}))})());const C=()=>{p.filter(E=>!["mutated","mutations","notify_mutated","notify_mutations"].includes(E.type)).map(E=>{const m=Y.getPathKeys(E.dataPath);return{sub:E,keys:m}}).sort((E,m)=>E.keys.length<m.keys.length?1:E.keys.length>m.keys.length?-1:0).forEach(({sub:E})=>{const m=(v,g,k,x=[])=>{const b=E.dataPath.slice(v.length).replace(/^\//,""),w=Y.getPathKeys(b);for(;w.length>0;){const A=w.shift();if(typeof A=="string"&&(A==="*"||A[0]==="$")){const O=g===null?[]:Object.keys(g).map($=>g instanceof Array?parseInt($):$);k!==null&&Object.keys(k).forEach($=>{const P=k instanceof Array?parseInt($):$;!O.includes(P)&&O.push($)}),O.forEach($=>{const P=vi($,g,k),N=x.concat({name:A,value:$});w.length===0?T(E,P.oldValue,P.newValue,N):m(Y.getChildPath(v,A),P.oldValue,P.newValue,N)});return}else{v=Y.getChildPath(v,A);const O=vi(A,g,k);g=O.oldValue,k=O.newValue}}T(E,g,k,x)};if(E.type.startsWith("notify_")&&Y.get(E.eventPath).isAncestorOf(h)){const v=Y.get(E.eventPath).isParentOf(h);(E.type==="notify_value"||E.type==="notify_child_changed"&&(!v||!["added","removed"].includes(H))||E.type==="notify_child_removed"&&H==="removed"&&v||E.type==="notify_child_added"&&H==="added"&&v)&&this.subscriptions.trigger(E.type,E.subscriptionPath,E.dataPath,null,null,s.context)}else m(h,l,U)}),p.filter(E=>["mutated","mutations","notify_mutated","notify_mutations"].includes(E.type)).forEach(E=>{let m=h;const v=E.eventPath.slice(m.length).replace(/^\//,""),g=Y.getPathKeys(v);let k=l,x=U;for(;g.length>0;){const A=g.shift();m=Y.getChildPath(m,A);const O=vi(A,k,x);k=O.oldValue,x=O.newValue}const b=R(m,k,x);if(b.length===0)return;const w=E.type.startsWith("notify_");if(["mutated","notify_mutated"].includes(E.type))b.forEach((A,O)=>{const $=s.context,P=w?null:A.oldValue,N=w?null:A.newValue;this.subscriptions.trigger(E.type,E.subscriptionPath,A.path,P,N,$)});else if(["mutations","notify_mutations"].includes(E.type)){const A=w?null:b.map(O=>({target:Y.getPathKeys(O.path.slice(E.subscriptionPath.length)),prev:O.oldValue,val:O.newValue}));this.subscriptions.trigger(E.type,E.subscriptionPath,E.subscriptionPath,null,A,s.context)}})};return s.waitForIndexUpdates===!1&&F.splice(0),yield Promise.all(F),zP(C),j})}getChildren(e,t){throw new Error("This method must be implemented by subclass")}getNodeValue(e){return W(this,arguments,function*(t,r={}){return(yield this.getNode(t,r)).value})}getNode(e,t){throw new Error("This method must be implemented by subclass")}getNodeInfo(e,t){throw new Error("This method must be implemented by subclass")}setNode(e,t,r){throw new Error("This method must be implemented by subclass")}updateNode(e,t,r){throw new Error("This method must be implemented by subclass")}transactNode(e,t){return W(this,arguments,function*(r,i,s={no_lock:!1,suppress_events:!1,context:null}){const o=s&&s.no_lock===!0,a=this.createTid(),c=o?{tid:a,release:HP}:yield this.nodeLocker.lock(r,a,!0,"transactNode");try{let l=!1;const u=()=>{l=!0};o&&this.subscriptions.add(r,"notify_value",u);const h=yield this.getNode(r,{tid:a}),p=h.revision;let f;try{f=i(h.value),f instanceof Promise&&(f=yield f.catch(d=>{this.debug.error(`Error in transaction callback: ${d.message}`)}))}catch(d){this.debug.error(`Error in transaction callback: ${d.message}`)}if(typeof f=="undefined")return;if(o&&this.subscriptions.remove(r,"notify_value",u),l)throw new rh("Node changed");return yield this.setNode(r,f,{assert_revision:p,tid:c.tid,suppress_events:s.suppress_events,context:s.context})}catch(l){if(l instanceof rh)return console.warn(`node value changed, running again. Error: ${l.message}`),this.transactNode(r,i,s);throw l}finally{c.release()}})}matchNode(e,t,r){return W(this,null,function*(){var i;const s=(i=r==null?void 0:r.tid)!=null?i:Kt.generate(),o=(c,l)=>W(this,null,function*(){if(l.length===0)return Promise.resolve(!0);const u=l.reduce((d,y)=>{let _=y.key;return typeof _=="string"&&_.includes("/")&&(_=_.slice(0,_.indexOf("/"))),d.indexOf(_)<0&&d.push(_),d},[]),h=u.slice();let p=!0;const f=[];try{return yield this.getChildren(c,{tid:s,keyFilter:u}).next(d=>{var y;const _=(y=d.key)!=null?y:d.index;h.includes(_)&&h.splice(h.indexOf(d.key),1);const S=l.filter(B=>B.key===_).map(B=>({op:B.op,compare:B.compare})),I=S.length>0?a(d,S):{isMatch:!0,promises:[]};if(p=I.isMatch,p){f.push(...I.promises);const B=l.filter(j=>typeof j.key=="string"&&j.key.startsWith(`${typeof _=="number"?`[${_}]`:_}/`)).map(j=>({key:j.key.slice(j.key.indexOf("/")+1),op:j.op,compare:j.compare}));if(B.length>0){const j=Y.getChildPath(c,d.key),U=o(j,B).then(M=>({isMatch:M}));f.push(U)}}if(!p||h.length===0)return!1}),p&&(p=(yield Promise.all(f)).every(d=>d.isMatch)),p?(p=h.every(d=>{const y=new Ob(nt(se(se({},typeof d=="number"&&{index:d}),typeof d=="string"&&{key:d}),{exists:!1})),_=l.filter(I=>typeof I.key=="string"&&I.key.startsWith(`${typeof d=="number"?`[${d}]`:d}/`)).map(I=>({op:I.op,compare:I.compare}));if(_.length>0&&!a(y,_).isMatch)return!1;const S=l.filter(I=>I.key===d).map(I=>({op:I.op,compare:I.compare}));return S.length===0?!0:a(y,S).isMatch}),p):!1}catch(d){throw this.debug.error(`Error matching on "${c}": `,d),d}}),a=(c,l)=>{const u=[];return{isMatch:l.every(h=>{let p=!0;if(h.op==="!exists"||h.op==="=="&&(typeof h.compare=="undefined"||h.compare===null))p=!c.exists;else if(h.op==="exists"||h.op==="!="&&(typeof h.compare=="undefined"||h.compare===null))p=c.exists;else if((h.op==="contains"||h.op==="!contains")&&h.compare instanceof Array&&h.compare.length===0)p=!0;else if(!c.exists)p=!1;else if(c.address)if(c.valueType===ae.OBJECT&&["has","!has"].indexOf(h.op)>=0){const f=h.op==="has"?"exists":"!exists",d=o(c.path,[{key:h.compare,op:f}]).then(y=>({key:c.key,isMatch:y}));u.push(d),p=!0}else if(c.valueType===ae.ARRAY&&["contains","!contains"].indexOf(h.op)>=0){const f=this.getNode(c.path,{tid:s}).then(({value:d})=>{const y=h.op==="contains"?h.compare instanceof Array?h.compare.every(_=>d.includes(_)):d.includes(h.compare):h.compare instanceof Array?!h.compare.some(_=>d.includes(_)):!d.includes(h.compare);return{key:c.key,isMatch:y}});u.push(f),p=!0}else if(c.valueType===ae.STRING){const f=this.getNode(c.path,{tid:s}).then(d=>({key:c.key,isMatch:this.test(d.value,h.op,h.compare)}));u.push(f),p=!0}else p=!1;else if(c.type===ae.OBJECT&&["has","!has"].indexOf(h.op)>=0){const f=h.compare in c.value;p=f&&h.op==="has"||!f&&h.op==="!has"}else if(c.type===ae.ARRAY&&["contains","!contains"].indexOf(h.op)>=0){const f=c.value.indexOf(h.compare)>=0;p=f&&h.op==="contains"||!f&&h.op==="!contains"}else{let f=this.test(c.value,h.op,h.compare);f instanceof Promise&&(u.push(f),f=!0),p=f}return p}),promises:u}};return o(e,t)})}test(e,t,r){if(t==="<")return e<r;if(t==="<=")return e<=r;if(t==="==")return e===r;if(t==="!=")return e!==r;if(t===">")return e>r;if(t===">=")return e>=r;if(t==="in")return r.indexOf(e)>=0;if(t==="!in")return r.indexOf(e)<0;if(t==="like"||t==="!like"){const i="^"+r.replace(/[-[\]{}()+.,\\^$|#\s]/g,"\\$&").replace(/\?/g,".").replace(/\*/g,".*?")+"$",s=new RegExp(i,"i").test(e.toString());return t==="like"?s:!s}if(t==="matches")return r.test(e.toString());if(t==="!matches")return!r.test(e.toString());if(t==="between")return e>=r[0]&&e<=r[1];if(t==="!between")return e<r[0]||e>r[1];if(t==="has"||t==="!has"){const i=typeof e=="object"&&r in e;return t==="has"?i:!i}if(t==="contains"||t==="!contains"){const i=typeof e=="object"&&e instanceof Array&&e.includes(r);return t==="contains"?i:!i}return!1}exportNode(e,t){return W(this,arguments,function*(r,i,s={format:"json",type_safe:!0}){if((s==null?void 0:s.format)!=="json")throw new Error("Only json output is currently supported");const o=typeof i!="function"?i.write.bind(i):i,a=(d,y)=>{const _=S=>S.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/[\u0000-\u001f]/g,I=>`\\u${I.charCodeAt(0).toString(16).padStart(4,"0")}`);return d===ae.DATETIME?(y=`"${y.toISOString()}"`,s.type_safe&&(y=`{".type":"date",".val":${y}}`)):d===ae.STRING?y=`"${_(y)}"`:d===ae.ARRAY?y="[]":d===ae.OBJECT?y="{}":d===ae.BINARY?(y=`"${_(xr.encode(y))}"`,s.type_safe&&(y=`{".type":"binary",".val":${y}}`)):d===ae.REFERENCE?(y=`"${y.path}"`,s.type_safe&&(y=`{".type":"reference",".val":${y}}`)):d===ae.BIGINT&&(y=`"${y}"`,s.type_safe&&(y=`{".type":"bigint",".val":${y}}`)),y};let c="",l="";const u=yield this.getNodeInfo(r);if(u.exists)if(u.type===ae.OBJECT)c="{",l="}";else if(u.type===ae.ARRAY)c="[",l="]";else{const d=yield this.getNode(r),y=a(u.type,d.value);return o(y)}else return o("null");if(c){const d=o(c);d instanceof Promise&&(yield d)}let h="",p=0;const f=[];if(yield this.getChildren(r).next(d=>{d.address?f.push(d):(p++>0&&(h+=","),typeof d.key=="string"&&(h+=`"${d.key}":`),h+=a(d.type,d.value))}),h){const d=o(h);d instanceof Promise&&(yield d)}for(;f.length>0;){const d=f.shift();let y=p++>0?",":"";const _=typeof d.index=="number"?d.index:d.key;if(typeof _=="string"&&(y+=`"${_}":`),y){const S=o(y);S instanceof Promise&&(yield S)}yield this.exportNode(Y.getChildPath(r,_),o,s)}if(l){const d=o(l);d instanceof Promise&&(yield d)}})}importNode(e,t){return W(this,arguments,function*(r,i,s={format:"json",method:"set"}){const o={data:"",index:0,offset:0,queue:[],queueStartByte:0,timesFlushed:0,get processedBytes(){return this.offset+this.index}},a=(L=!1)=>W(this,null,function*(){let F=yield i(262144);if(F===null)throw o.data?new Error(`Unexpected EOF at index ${o.offset+o.data.length}`):new Error("Unable to read data from stream");typeof F=="object"&&(F=hb(F)),L?o.data+=F:(o.offset+=o.data.length,o.data=F,o.index=0)}),c=L=>W(this,null,function*(){let F="";return o.index+L>=o.data.length&&(F=o.data.slice(o.index),L-=F.length,yield a()),F+=o.data.slice(o.index,o.index+L),o.index+=L,F}),l=L=>W(this,null,function*(){if(o.index+L>o.data.length&&(yield a(!0)),o.index+L>o.data.length)throw new Error("Not enough data available from stream")}),u=L=>W(this,null,function*(){const F=yield c(L.length);if(F!==L)throw new Error(`Unexpected character "${F[0]}" at index ${o.offset+o.index}, expected "${L}"`)}),h=()=>W(this,null,function*(){const L=[" ","	","\r",`
`];for(;o.index>=o.data.length&&(yield a()),L.includes(o.data[o.index]);)o.index++}),p=L=>W(this,null,function*(){yield l(L);const F=o.index;return o.data.slice(F,F+L)}),f=()=>W(this,null,function*(){yield h();const L=yield p(1);switch(L){case'"':return"string";case"{":return"object";case"[":return"array";case"n":return"null";case"u":return"undefined";case"t":case"f":return"boolean";default:{if(L==="-"||L>="0"&&L<="9")return"number";throw new Error(`Unknown value at index ${o.offset+o.index}`)}}}),d=()=>W(this,null,function*(){yield u('"');let L="",F=o.index;for(;o.data[F]!=='"'||o.data[F-1]==="\\";)F++,F>=o.data.length&&(L+=o.data.slice(o.index),yield a(),F=0);return L+=o.data.slice(o.index,F),o.index=F+1,I(L)}),y=()=>W(this,null,function*(){throw o.data[o.index]==="t"?yield u("true"):o.data[o.index]==="f"&&(yield u("false")),new Error(`Expected true or false at index ${o.offset+o.index}`)}),_=()=>W(this,null,function*(){let L="",F=o.index;const T=["-","0","1","2","3","4","5","6","7","8","9",".","e","b","f","x","o","n"];for(;T.includes(o.data[F]);)F++,F>=o.data.length&&(L+=o.data.slice(o.index),yield a(),F=0);return L+=o.data.slice(o.index,F),o.index=F,L.endsWith("n")?BigInt(L.slice(0,-1)):L.includes(".")?parseFloat(L):parseInt(L)}),S=()=>W(this,null,function*(){yield h();const L=yield f(),F=yield(()=>{switch(L){case"string":return d();case"object":return{};case"array":return[];case"number":return _();case"null":return null;case"undefined":return;case"boolean":return y()}})();return{type:L,value:F}}),I=L=>L.replace(/\\n/g,`
`).replace(/\\"/g,'"'),B=(L,F)=>{const T=F[".type"];let R=F[".val"];switch(T){case"Date":case"date":{R=new Date(R);break}case"Buffer":case"binary":{if(R=I(R),R.startsWith("<~"))R=xr.decode(R);else throw new Error(`Import error: Unexpected encoding for value for value at path "/${L}"`);break}case"PathReference":case"reference":{R=new ot(R);break}case"bigint":{R=BigInt(R);break}default:throw new Error(`Import error: Unsupported type "${T}" for value at path "/${L}"`)}return R},j={acebase_import_id:Kt.generate()},U={suppress_events:s.suppress_events,context:j},M=L=>W(this,null,function*(){if(yield u("{"),yield h(),(yield p(1))==="}")return o.index++,this.setNode(L.path,{},U);let F=0,T={},R=!1;const C=()=>W(this,null,function*(){let m;R?Object.keys(T).length>0&&(m=this.updateNode(L.path,T,U)):(R=!0,m=this.setNode(L.path,T,U)),T={},m&&(yield m)}),E=[];for(;;){yield h();const m=yield d();yield h(),yield u(":"),yield h();const{value:v,type:g}=yield S();if(T[m]=v,F++,["object","array"].includes(g)&&(E.push(C()),g==="object"?yield M(L.child(m)):yield H(L.child(m))),yield h(),(yield p(1))==="}"){o.index++;break}yield u(",")}if(F===2&&".type"in T&&".val"in T){const m=B(L.path,T);return this.setNode(L.path,m,U)}E.push(C()),yield Promise.all(E)}),H=L=>W(this,null,function*(){if(yield u("["),yield h(),(yield p(1))==="]")return o.index++,this.setNode(L.path,[],U);let F=!1,T=[],R={};const C=()=>W(this,null,function*(){let g;F?Object.keys(R).length>0&&(g=this.updateNode(L.path,R,U),R={}):(F=!0,g=this.setNode(L.path,T,U),T=null),g&&(yield g)}),E=(g,k)=>{F?R[k]=g:T.push(g)},m=[];let v=0;for(;;){yield h();const{value:g,type:k}=yield S();if(E(g,v),["object","array"].includes(k)&&(m.push(C()),k==="object"?yield M(L.child(v)):yield H(L.child(v))),yield h(),(yield p(1))==="]"){o.index++;break}yield u(","),v++}m.push(C()),yield Promise.all(m)});return(()=>W(this,null,function*(){const{value:L,type:F}=yield S();if(["object","array"].includes(F)){const T=Y.get(r);F==="object"?yield M(T):yield H(T)}else yield this.setNode(r,L,U)}))()})}setSchema(e,t,r=!1){if(typeof t=="undefined")throw new TypeError("schema argument must be given");if(t===null){const o=this._schemas.findIndex(a=>a.path===e);o>=0&&this._schemas.splice(o,1);return}const i=new CP(t,{warnOnly:r,warnCallback:o=>this.debug.warn(o)}),s=this._schemas.find(o=>o.path===e);s?s.schema=i:(this._schemas.push({path:e,schema:i}),this._schemas.sort((o,a)=>{const c=Y.getPathKeys(o.path),l=Y.getPathKeys(a.path);return c.length===l.length?0:c.length<l.length?-1:1}))}getSchema(e){const t=this._schemas.find(r=>r.path===e);return t?{path:e,schema:t.schema.source,text:t.schema.text}:null}getSchemas(){return this._schemas.map(e=>({path:e.path,schema:e.schema.source,text:e.schema.text}))}validateSchema(e,t,r={updates:!1}){let i={ok:!0};const s=Y.get(e);return this._schemas.filter(o=>s.isOnTrailOf(o.path)).every(o=>{if(s.isDescendantOf(o.path)){const u=Y.fillVariables(o.path,e),h=s.keys.slice(Y.getPathKeys(o.path).length);return i=o.schema.check(u,t,r.updates,h),i.ok}const a=Y.getPathKeys(o.path).slice(s.keys.length);if(r.updates===!0&&a.length>0&&!(a[0]in t))return i.ok;const c=r.updates===!0&&a.length===0,l=(u,h,p)=>{if(p.length===0)return o.schema.check(u,h,c);if(h===null)return{ok:!0};const f=p[0];if(typeof f=="string"&&(f==="*"||f[0]==="$")){if(h===null||typeof h!="object")return{ok:!0};let d;return Object.keys(h).every(y=>{const _=Y.getChildPath(u,y),S=h[y];return d=l(_,S,p.slice(1)),d.ok}),d}else{const d=Y.getChildPath(u,f),y=h[f];return l(d,y,p.slice(1))}};return i=l(e,t,a),i.ok}),i}}class no{static ChildPathsSql(e,t="path"){return e===""?`${t} <> '' AND ${t} NOT LIKE '%/%'`:`(${t} LIKE '${e}/%' OR ${t} LIKE '${e}[%') AND ${t} NOT LIKE '${e}/%/%' AND ${t} NOT LIKE '${e}[%]/%' AND ${t} NOT LIKE '${e}[%][%'`}static ChildPathsRegex(e){return new RegExp(`^${e}(?:/[^/[]+|\\[[0-9]+\\])$`)}static DescendantPathsSql(e,t="path"){return e===""?`${t} <> ''`:`${t} LIKE '${e}/%' OR ${t} LIKE '${e}[%'`}static DescendantPathsRegex(e){return new RegExp(`^${e}(?:/[^/[]+|\\[[0-9]+\\])`)}static get PathInfo(){return Y}}class gy{constructor(e){this.path=e}toString(){return`"/${this.path}"`}equals(e){return this.path===e.path}}const{compareValues:GP}=yb;class Df{constructor(e){this.production=!1,this.target={get originalPath(){return e.path},path:e.path,get write(){return e.write}},this.id=Kt.generate()}getChildCount(e){return W(this,null,function*(){let t=0;return yield this.childrenOf(e,{metadata:!1,value:!1},()=>(t++,!1)),t})}getMultiple(e){return W(this,null,function*(){const t=new Map;return yield Promise.all(e.map(r=>this.get(r).then(i=>t.set(r,i)))),t})}setMultiple(e){return W(this,null,function*(){yield Promise.all(e.map(({path:t,node:r})=>this.set(t,r)))})}removeMultiple(e){return W(this,null,function*(){yield Promise.all(e.map(t=>this.remove(t)))})}commit(){return W(this,null,function*(){throw new Error("CustomStorageTransaction.rollback must be overridden by subclass")})}moveToParentPath(e){return W(this,null,function*(){const t=this._lock&&this._lock.path||this.target.path;if(t===e)return e;if(no.PathInfo.get(e).isParentOf(t))this._lock&&(this._lock=yield this._lock.moveToParent());else throw new Error(`Locking issue. Locked path "${this._lock.path}" is not a child/descendant of "${e}"`);return this.target.path=e,e})}}class ro extends Lf{constructor(e){if(super(e),this.locking=!0,typeof e!="object")throw new Error("settings missing");if(typeof e.ready!="function")throw new Error("ready must be a function");if(typeof e.getTransaction!="function")throw new Error("getTransaction must be a function");this.name=e.name,this.locking=e.locking!==!1,this.locking&&(this.lockTimeout=typeof e.lockTimeout=="number"?e.lockTimeout:120),this.ready=e.ready;const t=this.locking,r=t?new Sb(console,this.lockTimeout):null;this.getTransaction=i=>W(this,[i],function*({path:s,write:o}){const a=yield e.getTransaction({path:s,write:o});en(typeof a.id=="string","transaction id not set");const c=a.rollback,l=a.commit;return a.commit=()=>W(this,null,function*(){const u=yield l.call(a);return t&&(yield a._lock.release("commit")),u}),a.rollback=u=>W(this,null,function*(){const h=yield c.call(a,u);return t&&(yield a._lock.release("rollback")),h}),t&&(a._lock=yield r.lock(s,a.id,o,`${this.name}::getTransaction`)),a})}}class Wl extends Ob{constructor(e){super(e),this.revision=e.revision,this.revision_nr=e.revision_nr,this.created=e.created,this.modified=e.modified}}class QP extends YP{constructor(e,t,r){super(e,t,r),this._customImplementation=t,this._init()}_init(){return W(this,null,function*(){this.debug.log(`Database "${this.name}" details:`.colorize($t.dim)),this.debug.log("- Type: CustomStorage".colorize($t.dim)),this.debug.log(`- Path: ${this.settings.path}`.colorize($t.dim)),this.debug.log(`- Max inline value size: ${this.settings.maxInlineValueSize}`.colorize($t.dim)),this.debug.log(`- Autoremove undefined props: ${this.settings.removeVoidProperties}`.colorize($t.dim)),yield this._customImplementation.ready();const e=yield this._customImplementation.getTransaction({path:"",write:!0});(yield this.getNodeInfo("",{transaction:e})).exists||(yield this._writeNode("",{},{transaction:e})),yield e.commit(),this.indexes.supported&&(yield this.indexes.load()),this.emit("ready")})}throwImplementationError(e){throw new Error(`CustomStorage "${this._customImplementation.name}" ${e}`)}_storeNode(e,t,r){const i=o=>{if(o===null)throw new Error("Not allowed to store null values. remove the property");if(["string","number","boolean"].includes(typeof o))return o;if(o instanceof Date)return{type:ae.DATETIME,value:o.getTime()};if(o instanceof ot)return{type:ae.REFERENCE,value:o.path};if(o instanceof ArrayBuffer)return{type:ae.BINARY,value:xr.encode(o)};if(typeof o=="object")return en(Object.keys(o).length===0,"child object stored in parent can only be empty"),o},s="Caller should have pre-processed the value by converting it to a string";if(t.type===ae.ARRAY&&t.value instanceof Array){console.warn(`Unprocessed array. ${s}`);const o={};for(let a=0;a<t.value.length;a++)o[a]=t.value[a];t.value=o}if(t.type===ae.BINARY&&typeof t.value!="string"&&(console.warn(`Unprocessed binary value. ${s}`),t.value=xr.encode(t.value)),t.type===ae.REFERENCE&&t.value instanceof ot&&(console.warn(`Unprocessed path reference. ${s}`),t.value=t.value.path),[ae.OBJECT,ae.ARRAY].includes(t.type)){const o=t.value;t.value={},Object.keys(o).forEach(a=>{t.value[a]=i(o[a])})}return r.transaction.set(e,t)}_processReadNodeValue(e){const t=r=>{if(r.type===ae.BINARY)return xr.decode(r.value);if(r.type===ae.DATETIME)return new Date(r.value);if(r.type===ae.REFERENCE)return new ot(r.value);throw new Error(`Unhandled child value type ${r.type}`)};switch(e.type){case ae.ARRAY:case ae.OBJECT:{const r=e.value;Object.keys(r).forEach(i=>{const s=r[i];typeof s=="object"&&"type"in s&&(r[i]=t(s))}),e.value=r;break}case ae.BINARY:{e.value=xr.decode(e.value);break}case ae.REFERENCE:{e.value=new ot(e.value);break}case ae.STRING:break;default:throw new Error("Invalid standalone record value type")}}_readNode(e,t){return W(this,null,function*(){const r=yield t.transaction.get(e);return r===null?null:(typeof r!="object"&&this.throwImplementationError("transaction.get must return an ICustomStorageNode object. Use JSON.parse if your set function stored it as a string"),this._processReadNodeValue(r),r)})}_getTypeFromStoredValue(e){let t;if(typeof e=="string")t=ae.STRING;else if(typeof e=="number")t=ae.NUMBER;else if(typeof e=="boolean")t=ae.BOOLEAN;else if(e instanceof Array)t=ae.ARRAY;else if(typeof e=="object")if("type"in e){const r=e;t=r.type,e=r.value,t===ae.DATETIME?e=new Date(e):t===ae.REFERENCE&&(e=new ot(e))}else t=ae.OBJECT;else throw new Error("Unknown value type");return{type:t,value:e}}_writeNode(e,t,r){return W(this,null,function*(){if(!r.merge&&this.valueFitsInline(t)&&e!=="")throw new Error("invalid value to store in its own node");if(e===""&&(typeof t!="object"||t instanceof Array))throw new Error("Invalid root node value. Must be an object");if(typeof r.diff=="undefined"&&typeof r.currentValue!="undefined"){const d=GP(r.currentValue,t);r.merge&&typeof d=="object"&&(d.removed=d.removed.filter(y=>t[y]===null)),r.diff=d}if(r.diff==="identical")return;const i=r.transaction,s=r.currentValue===null?null:yield this._readNode(e,{transaction:i});if(r.merge&&s){if(s.type===ae.ARRAY&&!(t instanceof Array)&&typeof t=="object"&&Object.keys(t).some(d=>isNaN(parseInt(d))))throw new Error(`Cannot merge existing array of path "${e}" with an object`);if(t instanceof Array&&s.type!==ae.ARRAY)throw new Error(`Cannot merge existing object of path "${e}" with an array`)}const o=r.revision||Kt.generate(),a={type:s&&s.type===ae.ARRAY?ae.ARRAY:ae.OBJECT,value:{}},c={};if(t instanceof Array){a.type=ae.ARRAY;const d={};for(let y=0;y<t.length;y++)d[y]=t[y];t=d}else t instanceof ot?(a.type=ae.REFERENCE,a.value=t.path):t instanceof ArrayBuffer?(a.type=ae.BINARY,a.value=xr.encode(t)):typeof t=="string"&&(a.type=ae.STRING,a.value=t);const l=s?[ae.OBJECT,ae.ARRAY].includes(s.type):!1,u=[ae.OBJECT,ae.ARRAY].includes(a.type),h={current:[],new:[]};let p=null;l&&(p=s.value,h.current=Object.keys(p),u&&(a.value=p)),u&&(r.merge||Object.keys(a.value).forEach(d=>{d in t||(t[d]=null)}),Object.keys(t).forEach(d=>{const y=t[d];if(delete a.value[d],y!==null){if(typeof y=="undefined")if(this.settings.removeVoidProperties===!0){delete t[d];return}else throw new Error(`Property "${d}" has invalid value. Cannot store undefined values. Set removeVoidProperties option to true to automatically remove undefined properties`);this.valueFitsInline(y)?a.value[d]=y:c[d]=y}}));const f=a.type===ae.ARRAY;if(s){if(this.debug.log(`Node "/${e}" is being ${r.merge?"updated":"overwritten"}`.colorize($t.cyan)),l||u){const y=Y.get(e),_=[];let S=!1;const I=F=>(S=!0,!i.production&&!y.isParentOf(F)&&this.throwImplementationError(`"${F}" is not a child of "${e}" - childrenOf must only check and return paths that are children`),!0),B=F=>{S||this.throwImplementationError("childrenOf did not call checkCallback before addCallback");const T=Y.get(F).key;return _.push(T.toString()),!0};yield i.childrenOf(e,{metadata:!1,value:!1},I,B),h.current=h.current.concat(_),u&&(r&&r.merge&&(h.new=h.current.slice()),Object.keys(t).forEach(F=>{h.new.includes(F)||h.new.push(F)}));const j={insert:h.new.filter(F=>!h.current.includes(F)),update:[],delete:r&&r.merge?Object.keys(t).filter(F=>t[F]===null):h.current.filter(F=>!h.new.includes(F))};if(j.update=h.new.filter(F=>h.current.includes(F)&&!j.delete.includes(F)),f&&r.merge&&(j.insert.length>0||j.delete.length>0)&&!j.update.concat(j.insert).every((F,T,R)=>R.includes(T.toString())))throw new Error(`Elements cannot be inserted beyond, or removed before the end of an array. Rewrite the whole array at path "${e}" or change your schema to use an object collection instead`);const U=Object.keys(c).map(F=>{const T=f?parseInt(F):F,R=typeof r.diff=="object"?r.diff.forChild(T):void 0;if(R==="identical")return;const C=y.childPath(T),E=c[T],m=typeof r.currentValue=="undefined"?void 0:r.currentValue!==null&&typeof r.currentValue=="object"&&T in r.currentValue?r.currentValue[T]:null;return this._writeNode(C,E,{transaction:i,revision:o,merge:!1,currentValue:m,diff:R})}),M=u?_.filter(F=>F in a.value):[],H=j.delete.concat(M).map(F=>{const T=f?parseInt(F):F,R=y.childPath(T);return this._deleteNode(R,{transaction:i})}),L=U.concat(H);yield Promise.all(L)}const d=this._storeNode(e,{type:a.type,value:a.value,revision:s.revision,revision_nr:s.revision_nr+1,created:s.created,modified:Date.now()},{transaction:i});if(d instanceof Promise)return yield d}else{if(this.debug.log(`Node "/${e}" is being created`.colorize($t.cyan)),f&&!Object.keys(a.value).concat(Object.keys(c)).every((_,S,I)=>I.includes(S.toString())))throw new Error("Cannot store arrays with missing entries");const d=Object.keys(c).map(_=>{const S=f?parseInt(_):_,I=Y.getChildPath(e,S),B=c[S];return this._writeNode(I,B,{transaction:i,revision:o,merge:!1,currentValue:null})}),y=this._storeNode(e,{type:a.type,value:a.value,revision:o,revision_nr:1,created:Date.now(),modified:Date.now()},{transaction:i});y instanceof Promise&&d.push(y),yield Promise.all(d)}})}_deleteNode(e,t){return W(this,null,function*(){const r=Y.get(e);this.debug.log(`Node "/${e}" is being deleted`.colorize($t.cyan));const i=[e];let s=!1;const o=l=>(s=!0,!c.production&&!r.isAncestorOf(l)&&this.throwImplementationError(`"${l}" is not a descendant of "${e}" - descendantsOf must only check and return paths that are descendants`),!0),a=l=>(s||this.throwImplementationError("descendantsOf did not call checkCallback before addCallback"),i.push(l),!0),c=t.transaction;return yield c.descendantsOf(e,{metadata:!1,value:!1},o,a),this.debug.log(`Nodes ${i.map(l=>`"/${l}"`).join(",")} are being deleted`.colorize($t.cyan)),c.removeMultiple(i)})}getChildren(e,t={}){let r;const i={next(o){return r=o,s()}},s=()=>W(this,null,function*(){const o=t.transaction||(yield this._customImplementation.getTransaction({path:e,write:!1}));try{let a=!1;return yield(()=>W(this,null,function*(){const c=yield this._readNode(e,{transaction:o});if(!c)throw new jf(`Node "/${e}" does not exist`);if(![ae.OBJECT,ae.ARRAY].includes(c.type))return;const l=c.type===ae.ARRAY,u=c.value;let h=Object.keys(u).map(_=>l?parseInt(_):_);t.keyFilter&&(h=h.filter(_=>t.keyFilter.includes(_)));const p=Y.get(e);if(h.length>0&&h.every(_=>{const S=this._getTypeFromStoredValue(u[_]),I=new Wl({path:p.childPath(_),key:l?null:_,index:l?_:null,type:S.type,address:null,exists:!0,value:S.value,revision:c.revision,revision_nr:c.revision_nr,created:new Date(c.created),modified:new Date(c.modified)});return a=r(I)===!1,!a}),a)return;let f=!1;const d=_=>{if(f=!0,!o.production&&!p.isParentOf(_)&&this.throwImplementationError(`"${_}" is not a child of "${e}" - childrenOf must only check and return paths that are children`),t.keyFilter){const S=Y.get(_).key;return t.keyFilter.includes(S)}return!0},y=(_,S)=>{f||this.throwImplementationError("childrenOf did not call checkCallback before addCallback");const I=Y.get(_).key,B=new Wl({path:_,type:S.type,key:l?null:I,index:l?I:null,address:new gy(_),exists:!0,value:null,revision:S.revision,revision_nr:S.revision_nr,created:new Date(S.created),modified:new Date(S.modified)});return a=r(B)===!1,!a};yield o.childrenOf(e,{metadata:!0,value:!1},d,y)}))(),t.transaction||(yield o.commit()),a}catch(a){throw t.transaction||(yield o.rollback(a)),a}});return i}getNode(e,t){return W(this,null,function*(){t=t||{};const r=t.transaction||(yield this._customImplementation.getTransaction({path:e,write:!1}));try{const i=yield(()=>W(this,null,function*(){const s=t.include&&t.include.length>0||t.exclude&&t.exclude.length>0||t.child_objects===!1,o=Y.get(e),a=yield this._readNode(e,{transaction:r});if(!a){if(e==="")return{value:null};const B=yield r.moveToParentPath(o.parentPath);en(B===o.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${e}"`);const j=yield this._readNode(o.parentPath,{transaction:r});if(j&&[ae.OBJECT,ae.ARRAY].includes(j.type)&&o.key in j.value){const U=this._getTypeFromStoredValue(j.value[o.key]);return{revision:j.revision,revision_nr:j.revision_nr,created:j.created,modified:j.modified,type:U.type,value:U.value}}return{value:null}}const c=a.type===ae.ARRAY,l=B=>{const j=U=>/^[0-9]+$/.test(U);return B.map(U=>Y.get(c&&j(U)?`[${U}]`:U))},u=t.include?l(t.include):[],h=t.exclude?l(t.exclude):[],p=(B,j)=>{if([ae.OBJECT,ae.ARRAY].includes(j.type)&&u.length>0){const U=Y.getPathKeys(B).slice(o.keys.length),M=new Y(U),H=[],L=u.filter(T=>T.isDescendantOf(M));if(L.length>0){const T=j.type===ae.ARRAY;H.push(...Object.keys(j.value).map(R=>T?+R:R));for(const R of L){const C=R.keys[U.length];if(typeof C=="string"&&(C==="*"||C.startsWith("$"))){H.splice(0);break}const E=H.indexOf(C);E>=0&&H.splice(E,1)}}const F=u.some(T=>T.isChildOf(M));if(h.some(T=>T.isChildOf(M))&&!F){const T=h.filter(R=>R.isChildOf(M));for(let R=0;R<H.length;R++)T.find(C=>C.equals(H[R]))||(H.splice(R,1),R--)}for(const T of H)delete j.value[T]}};p(e,a);let f=!1;const d=(B,j)=>{if(f=!0,!r.production&&!o.isAncestorOf(B)&&this.throwImplementationError(`"${B}" is not a descendant of "${e}" - descendantsOf must only check and return paths that are descendants`),!s)return!0;const U=Y.getPathKeys(B).slice(o.keys.length),M=new Y(U);let H=(u.length>0?u.some(L=>M.isOnTrailOf(L)):!0)&&(h.length>0?!h.some(L=>L.equals(M)||L.isAncestorOf(M)):!0);return H&&t.child_objects===!1&&(o.isParentOf(B)&&[ae.OBJECT,ae.ARRAY].includes(j?j.type:-1)||Y.getPathKeys(B).length>o.pathKeys.length+1)&&(H=!1),H},y=[],_=(B,j)=>{if(f||this.throwImplementationError("descendantsOf did not call checkCallback before addCallback"),t.child_objects===!1&&[ae.OBJECT,ae.ARRAY].includes(j.type))return!0;p(B,j),this._processReadNodeValue(j);const U=j;return U.path=B,y.push(U),!0};yield r.descendantsOf(e,{metadata:!0,value:!0},d,_),this.debug.log(`Read node "/${e}" and ${s?"(filtered) ":""}descendants from ${y.length+1} records`.colorize($t.magenta));const S=a,I=B=>{const j=[];return Object.keys(B).forEach(U=>{const M=parseInt(U);j[M]=B[M]}),j};if(a.type===ae.ARRAY&&(S.value=I(S.value)),a.type===ae.OBJECT||a.type===ae.ARRAY){const B=Y.getPathKeys(e),j=a.value;for(let U=0;U<y.length;U++){const M=y[U],H=Y.getPathKeys(M.path).slice(B.length);let L=j;for(let F=0;F<H.length;F++){en(typeof L=="object","parent must be an object/array to have children!!");const T=H[F],R=F===H.length-1,C=R?M.type:typeof H[F+1]=="number"?ae.ARRAY:ae.OBJECT;let E;R?(E=M.value,C===ae.ARRAY&&(E=I(E))):E=C===ae.OBJECT?{}:[],T in L?typeof L[T]==typeof E&&[ae.OBJECT,ae.ARRAY].includes(C)?Object.keys(E).forEach(m=>{m in L[T]&&this.throwImplementationError(`Custom storage merge error: child key "${m}" is in parent value already! Make sure the get/childrenOf/descendantsOf methods of the custom storage class return values that can be modified by AceBase without affecting the stored source`),L[T][m]=E[m]}):this.debug.error(`The value stored in node "${M.path}" cannot be merged with the parent node, value will be ignored. This error should disappear once the target node value is updated. See issue #20 for more information`,{path:e,parent:L,key:T,nodeType:C,nodeValue:E}):L[T]=E,L=L[T]}}}else y.length>0&&this.throwImplementationError("multiple records found for non-object value!");if(t.child_objects===!1&&Object.keys(S.value).forEach(B=>{typeof S.value[B]=="object"&&S.value[B].constructor===Object&&(en(Object.keys(S.value[B]).length===0),delete S.value[B])}),t.include,t.exclude){const B=(j,U)=>{if(typeof j!="object")return;const M=U[0];M==="*"?Object.keys(j).forEach(H=>{B(j[H],U.slice(1))}):U.length>1?M in j&&B(j[M],U.slice(1)):delete j[M]};t.exclude.forEach(j=>{const U=Y.getPathKeys(j);B(S.value,U)})}return S}))();return t.transaction||(yield r.commit()),i}catch(i){throw t.transaction||(yield r.rollback(i)),i}})}getNodeInfo(e){return W(this,arguments,function*(t,r={}){r=r||{};const i=Y.get(t),s=r.transaction||(yield this._customImplementation.getTransaction({path:t,write:!1}));try{const o=yield this._readNode(t,{transaction:s}),a=new Wl({path:t,key:typeof i.key=="string"?i.key:null,index:typeof i.key=="number"?i.key:null,type:o?o.type:0,exists:o!==null,address:o?new gy(t):null,created:o?new Date(o.created):null,modified:o?new Date(o.modified):null,revision:o?o.revision:null,revision_nr:o?o.revision_nr:null});if(!o&&t!==""){const c=yield s.moveToParentPath(i.parentPath);en(c===i.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${t}"`);const l=yield this._readNode(i.parentPath,{transaction:s});l&&[ae.OBJECT,ae.ARRAY].includes(l.type)&&i.key in l.value?(a.exists=!0,a.value=l.value[i.key],a.address=null,a.type=l.type,a.created=new Date(l.created),a.modified=new Date(l.modified),a.revision=l.revision,a.revision_nr=l.revision_nr):a.address=null}return r.include_child_count&&(a.childCount=0,[ae.OBJECT,ae.ARRAY].includes(a.valueType)&&a.address&&(a.childCount=o.value?Object.keys(o.value).length:0,a.childCount+=yield s.getChildCount(t))),r.transaction||(yield s.commit()),a}catch(o){throw r.transaction||(yield s.rollback(o)),o}})}setNode(e,t){return W(this,arguments,function*(r,i,s={suppress_events:!1,context:null}){if(this.settings.readOnly)throw new Error("Database is opened in read-only mode");const o=Y.get(r),a=s.transaction||(yield this._customImplementation.getTransaction({path:r,write:!0}));try{if(r===""){if(i===null||typeof i!="object"||i instanceof Array||i instanceof ArrayBuffer||"buffer"in i&&i.buffer instanceof ArrayBuffer)throw new Error(`Invalid value for root node: ${i}`);yield this._writeNodeWithTracking("",i,{merge:!1,transaction:a,suppress_events:s.suppress_events,context:s.context})}else if(typeof s.assert_revision!="undefined"){const c=yield this.getNodeInfo(r,{transaction:a});if(c.revision!==s.assert_revision)throw new rh(`revision '${c.revision}' does not match requested revision '${s.assert_revision}'`);if(c.address&&c.address.path===r&&i!==null&&!this.valueFitsInline(i))yield this._writeNodeWithTracking(r,i,{merge:!1,transaction:a,suppress_events:s.suppress_events,context:s.context});else{const l=yield a.moveToParentPath(o.parentPath);en(l===o.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${r}"`),yield this._writeNodeWithTracking(o.parentPath,{[o.key]:i},{merge:!0,transaction:a,suppress_events:s.suppress_events,context:s.context})}}else{const c=yield a.moveToParentPath(o.parentPath);en(c===o.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${r}"`),yield this.updateNode(o.parentPath,{[o.key]:i},{transaction:a,suppress_events:s.suppress_events,context:s.context})}s.transaction||(yield a.commit())}catch(c){throw s.transaction||(yield a.rollback(c)),c}})}updateNode(e,t){return W(this,arguments,function*(r,i,s={suppress_events:!1,context:null}){if(this.settings.readOnly)throw new Error("Database is opened in read-only mode");if(typeof i!="object")throw new Error("invalid updates argument");if(Object.keys(i).length===0)return;const o=s.transaction||(yield this._customImplementation.getTransaction({path:r,write:!0}));try{const a=yield this.getNodeInfo(r,{transaction:o}),c=Y.get(r);if(a.exists&&a.address&&a.address.path===r)yield this._writeNodeWithTracking(r,i,{transaction:o,merge:!0,suppress_events:s.suppress_events,context:s.context});else if(a.exists){const l=Y.get(r),u=yield o.moveToParentPath(l.parentPath);en(u===l.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${r}"`),yield this._writeNodeWithTracking(l.parentPath,{[l.key]:i},{transaction:o,merge:!0,suppress_events:s.suppress_events,context:s.context})}else{const l=yield o.moveToParentPath(c.parentPath);en(l===c.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${r}"`),yield this.updateNode(c.parentPath,{[c.key]:i},{transaction:o,suppress_events:s.suppress_events,context:s.context})}s.transaction||(yield o.commit())}catch(a){throw s.transaction||(yield o.rollback(a)),a}})}}class XP{constructor(e=1e3,t){this.limit=e,this.options=t,this.added=0,this.scheduled=[],this.running=0,this.results=[],this.done=!1}execute(e,t){return W(this,null,function*(){var r,i;try{this.running++;const s=yield e();if(this.results[t]=s,this.running--,this.running===0&&this.scheduled.length===0)this.done=!0,(r=this.doneCallback)==null||r.call(this,this.results);else if(this.scheduled.length>0){const o=this.scheduled.shift();this.execute(o.task,o.index)}}catch(s){this.done=!0,(i=this.errorCallback)==null||i.call(this,s)}})}add(e){var t;if(this.done)throw new Error("Cannot add to a batch that has already finished. Use wait option and start batch processing manually if you are adding tasks in an async loop");const r=this.added++;((t=this.options)==null?void 0:t.wait)!==!0&&this.running<this.limit?this.execute(e,r):this.scheduled.push({task:e,index:r})}start(){for(;this.running<this.limit;){const e=this.scheduled.shift();this.execute(e.task,e.index)}}finish(){return W(this,null,function*(){return this.running===0&&this.scheduled.length===0?this.results:(yield new Promise((e,t)=>{this.doneCallback=e,this.errorCallback=t}),this.results)})}}const ZP=()=>{};function Tb(n,e,t){return W(this,arguments,function*(r,i,s,o={snapshots:!1,include:void 0,exclude:void 0,child_objects:void 0,eventHandler:ZP}){var a,c,l,u,h,p;typeof o!="object"&&(o={}),typeof o.snapshots=="undefined"&&(o.snapshots=!1);const f={};(a=r.storage.settings.transactions)!=null&&a.log&&(f.acebase_cursor=Kt.generate());const d=s.filters.map(E=>se({},E)),y=s.order.map(E=>se({},E)),_=E=>{E.sort((m,v)=>{const g=k=>{const x=y[k],b=Y.getPathKeys(typeof x.key=="number"?`[${x.key}]`:x.key),w=b.reduce((O,$)=>O!==null&&typeof O=="object"&&$ in O?O[$]:null,m.val),A=b.reduce((O,$)=>O!==null&&typeof O=="object"&&$ in O?O[$]:null,v.val);return w===null?A===null?0:x.ascending?-1:1:A===null?x.ascending?1:-1:w==A?k<y.length-1?g(k+1):m.path<v.path?-1:1:w<A?x.ascending?-1:1:x.ascending?1:-1};return g(0)})},S=(E,m)=>W(this,null,function*(){if(E.length===0)return[];const v=50,g=new XP(v),k=[];return E.forEach(({path:x},b)=>g.add(()=>W(this,null,function*(){const w=(yield r.storage.getNode(x,m)).value;if(w===null){r.storage.debug.warn(`Indexed result "/${x}" does not have a record!`);return}const A={path:x,val:w};C.sorted?k[b]=A:(k.push(A),!C.skipped&&k.length>s.skip+Math.abs(s.take)&&(_(k),k.pop()))}))),yield g.finish(),k}),I=Y.get(i),B=I.keys.some(E=>E==="*"||E.toString().startsWith("$")),j=r.storage.indexes.get(i),U=[];let M=()=>W(this,null,function*(){});if(B){const E=I.keys.filter(g=>typeof g=="string"&&g.startsWith("$")),m=E.length>0&&E.every(g=>s.filters.some(k=>k.key===g&&["==","in"].includes(k.op))),v=typeof o.monitor=="object"&&[(c=o.monitor)==null?void 0:c.add,(l=o.monitor)==null?void 0:l.change,(u=o.monitor)==null?void 0:u.remove].some(g=>g===!0);if(m&&!v){const g=[];for(const O of E){const $=s.filters.filter(N=>N.key===O).reduce((N,D)=>{if(D.op==="=="&&N.push(D.compare),D.op==="in"){if(!(D.compare instanceof Array))throw new Error("compare argument for 'in' operator must be an Array");N.push(...D.compare)}return N},[]),P=g.splice(0);$.forEach(N=>{P.length===0?g.push({[O]:N}):g.push(...P.map(D=>nt(se({},D),{[O]:N})))})}const k=s.filters.filter(O=>!E.includes(O.key)),x=g.map(O=>Y.get(Y.getPathKeys(i).map($=>{var P;return(P=O[$])!=null?P:$})).path),b=s.order.length>0,w=x.map(O=>{var $;return Tb(r,O,{filters:k,take:0,skip:0,order:[]},{snapshots:b,cache_mode:o.cache_mode,include:[...($=o.include)!=null?$:[],...s.order.map(P=>P.key)],exclude:o.exclude})});let A=(yield Promise.all(w)).reduce((O,$)=>(O.push(...$.results),O),[]);if(b&&_(A),s.skip>0&&A.splice(0,s.skip),s.take>0&&A.splice(s.take),o.snapshots&&(!b||((h=o.include)==null?void 0:h.length)>0||((p=o.exclude)==null?void 0:p.length)>0||!o.child_objects)){const{include:O,exclude:$,child_objects:P}=o;A=yield S(A,{include:O,exclude:$,child_objects:P})}return{results:A,context:null,stop:M}}else if(j.length===0){const g=new Error(`Query on wildcard path "/${i}" requires an index`);return Promise.reject(g)}if(d.length===0){const g=j.filter(k=>k.type==="normal")[0];d.push({key:g.key,op:"!=",compare:null})}}d.forEach(E=>{if(E.index)return;const m=j.filter(v=>v.key===E.key).filter(v=>v.validOperators.includes(E.op));if(m.length>=1){const v=d.filter(b=>b!==E).map(b=>b.key),g=y.map(b=>b.key).filter(b=>b!==E.key),k=m.map(b=>{const w=b.includeKeys.concat(b.key),A=w.filter(N=>v.includes(N)),O=w.filter(N=>g.includes(N)),$=A.concat(O.filter(N=>!A.includes(N))),P={filters:A.length,sorting:O.length*(s.take!==0?O.length:1),both:$.length*$.length,get total(){return this.filters+this.sorting+this.both}};return{index:b,points:P.total,filterKeys:A,sortKeys:O}});k.sort((b,w)=>b.points>w.points?-1:1);const x=k[0];E.index=x.index,x.filterKeys.forEach(b=>{d.filter(w=>w!==E&&w.key===b).forEach(w=>{!Bf.validOperators.includes(w.op)||(w.indexUsage="filter",w.index=x.index)})}),x.sortKeys.forEach(b=>{y.filter(w=>w.key===b).forEach(w=>{w.index=x.index})})}E.index&&U.push({index:E.index,description:E.index.description})}),y.length>0&&s.take!==0&&d.length===0&&y.forEach(E=>{E.index||(E.index=j.filter(m=>m.key===E.key).find(m=>m.type==="normal"))});const H=U.map(E=>E.description).join(", ");U.length>0&&r.storage.debug.log(`Using indexes for query: ${H}`);const L=d.filter(E=>!E.index),F=/^[a-z]+:/i;if(L.some(E=>F.test(E.op))){const E=L.find(v=>F.test(v.op)),m=new Error(`query contains operator "${E.op}" which requires a special index that was not found on path "${i}", key "${E.key}"`);return Promise.reject(m)}const T=["<","<=","==","!=",">=",">","like","!like","in","!in","matches","!matches","between","!between","has","!has","contains","!contains","exists","!exists"];for(let E=0;E<L.length;E++){const m=L[E];if(!T.includes(m.op))return Promise.reject(new Error(`query contains unknown filter operator "${m.op}" on path "${i}", key "${m.key}"`))}if(B&&L.length>0){const E=L.reduce((v,g)=>(v.indexOf(g.key)<0&&v.push(g.key),v),[]).map(v=>`"${v}"`),m=new Error(`This wildcard path query on "/${i}" requires index(es) on key(s): ${E.join(", ")}. Create the index(es) and retry`);return Promise.reject(m)}const R=[];d.forEach(E=>{if(E.index&&E.indexUsage!=="filter"){let m=E.index.query(E.op,E.compare).then(g=>(o.eventHandler&&o.eventHandler({name:"stats",type:"index_query",source:E.index.description,stats:g.stats}),g.hints.length>0&&o.eventHandler&&o.eventHandler({name:"hints",type:"index_query",source:E.index.description,hints:g.hints}),g));const v=d.filter(g=>g.index===E.index&&g.indexUsage==="filter");v.length>0&&(m=m.then(g=>(v.forEach(k=>{const{key:x,op:b,index:w}=k;let{compare:A}=k;typeof A=="string"&&!w.caseSensitive&&(A=A.toLocaleLowerCase(w.textLocale)),g=g.filterMetadata(x,b,A)}),g))),R.push(m)}});const C={filtered:d.length===0,skipped:s.skip===0,taken:s.take===0,sorted:y.length===0,preDataLoaded:!1,dataLoaded:!1};if(d.length===0&&s.take===0&&(r.storage.debug.warn(`Filterless queries must use .take to limit the results. Defaulting to 100 for query on path "${i}"`),s.take=100),y.length>0&&y[0].index){const E=y[0].index,m=s.take<0?!y[0].ascending:y[0].ascending;if(d.length===0&&y.slice(1).every(v=>E.allMetadataKeys.includes(v.key))){r.storage.debug.log(`Using index for sorting: ${E.description}`);const v=y.slice(1).map(k=>(k.index=E,{key:k.key,ascending:k.ascending})),g=E.take(s.skip,Math.abs(s.take),{ascending:m,metadataSort:v}).then(k=>(o.eventHandler&&o.eventHandler({name:"stats",type:"sort_index_take",source:E.description,stats:k.stats}),k.hints.length>0&&o.eventHandler&&o.eventHandler({name:"hints",type:"sort_index_take",source:E.description,hints:k.hints}),k));R.push(g),C.skipped=!0,C.taken=!0,C.sorted=!0}}return Promise.all(R).then(E=>W(this,null,function*(){let m=[];if(E.length===1){const A=E[0];m=A.map(O=>{const $={key:O.key,path:O.path,val:{[A.filterKey]:O.value}};return O.metadata&&Object.assign($.val,O.metadata),$}),C.filtered=!0}else if(E.length>1){E.sort(($,P)=>$.length<P.length?-1:1);const A=E[0],O=E.slice(1);m=A.reduce(($,P)=>{const N={key:P.key,path:P.path,val:{[A.filterKey]:P.value}};return O.every(D=>D.findIndex(z=>z.path===P.path)>=0)&&(P.metadata&&Object.assign(N.val,P.metadata),O.forEach(D=>{const z=D.find(q=>q.path===N.path);N.val[D.filterKey]=z.value,z.metadata&&Object.assign(N.val,z.metadata)}),$.push(N)),$},[]),C.filtered=!0}if(B||R.length>0&&L.length===0){if(y.length===0||y.every(A=>A.index)){if(C.preDataLoaded=!0,!C.sorted&&y.length>0&&_(m),C.sorted=!0,!C.skipped&&s.skip>0&&(m=s.take<0?m.slice(0,-s.skip):m.slice(s.skip)),!C.taken&&s.take!==0&&(m=s.take<0?m.slice(s.take):m.slice(0,s.take)),C.skipped=!0,C.taken=!0,!o.snapshots)return m;const A={include:o.include,exclude:o.exclude,child_objects:o.child_objects};return S(m,A).then(O=>(C.dataLoaded=!0,O))}if(o.snapshots||!C.sorted){const A=y.length>0,O=A?{include:y.map($=>$.key)}:{include:o.include,exclude:o.exclude,child_objects:o.child_objects};return S(m,O).then($=>(y.length>0&&_($),C.sorted=!0,s.skip>0&&($=s.take<0?$.slice(0,-s.skip):$.slice(s.skip)),s.take!==0&&($=s.take<0?$.slice(s.take):$.slice(0,s.take)),C.skipped=!0,C.taken=!0,o.snapshots&&A?S($,{include:o.include,exclude:o.exclude,child_objects:o.child_objects}):$))}else return m}let v;m.length>0&&(v=m.map(A=>A.key));let g=[],k=!1;const x=y.length>0,b=x?{include:y.map(A=>A.key)}:{include:o.include,exclude:o.exclude,child_objects:o.child_objects},w={promises:[],add(A){if(this.promises.push(A),this.promises.length>=1e3)return Promise.all(this.promises.splice(0)).then(O=>{})}};try{yield r.storage.getChildren(i,{keyFilter:v,async:!0}).next(A=>{if(A.type!==ae.OBJECT||!A.address)return;if(k)return!1;const O=()=>W(this,null,function*(){if(!(yield r.storage.matchNode(A.address.path,L)))return;const P=A.address.path;let N;if(o.snapshots||y.length>0){const D=yield r.storage.getNode(P,b);N={path:P,val:D.value}}else N={path:P};g.push(N),s.take!==0&&g.length>Math.abs(s.take)+s.skip&&(y.length>0?_(g):s.take>0&&(k=!0),g.pop())}),$=w.add(O());if($ instanceof Promise)return $})}catch(A){return A instanceof jf||r.storage.debug.warn(`Error getting child stream: ${A}`),[]}return yield Promise.all(w.promises),C.preDataLoaded=x,C.dataLoaded=!x,y.length>0&&_(g),C.sorted=!0,s.skip>0&&(g=s.take<0?g.slice(0,-s.skip):g.slice(s.skip)),C.skipped=!0,s.take!==0&&(g=s.take<0?g.slice(s.take):g.slice(0,s.take)),C.taken=!0,C.dataLoaded||(g=yield S(g,{include:o.include,exclude:o.exclude,child_objects:o.child_objects}),C.dataLoaded=!0),g})).then(E=>{if(!C.sorted&&y.length>0&&_(E),o.snapshots||(E=E.map(m=>m.path)),!C.skipped&&s.skip>0&&(E=s.take<0?E.slice(0,-s.skip):E.slice(s.skip)),!C.taken&&s.take!==0&&(E=s.take<0?E.slice(s.take):E.slice(0,s.take)),o.monitor===!0&&(o.monitor={add:!0,change:!0,remove:!0}),typeof o.monitor=="object"&&(o.monitor.add||o.monitor.change||o.monitor.remove)){const m=o.monitor,v=o.snapshots?E.map($=>$.path):E.slice(),g=r.db.ref(i),k=$=>{const P=v.indexOf($);P<0||v.splice(P,1)},x=$=>{v.includes($)||v.push($)},b=()=>{r.unsubscribe(g.path,"child_changed",w),r.unsubscribe(g.path,"child_added",A),r.unsubscribe(g.path,"notify_child_removed",O)};M=()=>W(this,null,function*(){b()});const w=($,P,N,D)=>W(this,null,function*(){const z=v.includes(P);let q=!0;const ne=[];d.forEach(ie=>!ne.includes(ie.key)&&ne.push(ie.key));const te=[];typeof D=="object"&&Object.keys(D).forEach(ie=>!te.includes(ie)&&te.push(ie)),typeof N=="object"&&Object.keys(N).forEach(ie=>!te.includes(ie)&&te.push(ie));const ue=[];let le=te.every(ie=>ne.includes(ie)?d.filter(pe=>pe.key===ie).every(pe=>{var ke;return((ke=pe.index)==null?void 0:ke.textLocaleKey)&&!te.includes(pe.index.textLocaleKey)?(ue.push(pe.index.textLocaleKey),!0):T.includes(pe.op)?r.storage.test(N[ie],pe.op,pe.compare):pe.index.test(N,pe.op,pe.compare)}):!0);if(le&&(ue.push(...ne.filter(ie=>!te.includes(ie))),!z&&ue.length>0)){const ie=d.filter(ve=>ue.includes(ve.key)),pe=ie.filter(ve=>T.includes(ve.op)),ke=ie.filter(ve=>!T.includes(ve.op));if(pe.length>0&&(le=yield r.storage.matchNode(P,pe)),le&&ke.length>0){const ve=ke.reduce((je,He)=>(je.includes(He.key)||je.push(He.key),He.index instanceof $b&&He.index.config.localeKey&&!je.includes(He.index.config.localeKey)&&je.push(He.index.config.localeKey),je),[]),ze=yield r.storage.getNode(P,{include:ve});if(ze.value===null)return!1;le=ke.every(je=>je.index.test(ze.value,je.op,je.compare))}}if(le){if(z||x(P),o.snapshots){const ie={include:o.include,exclude:o.exclude,child_objects:o.child_objects};N=(yield r.storage.getNode(P,ie)).value}z&&m.change?q=o.eventHandler({name:"change",path:P,value:N})!==!1:!z&&m.add&&(q=o.eventHandler({name:"add",path:P,value:N})!==!1)}else z&&(k(P),m.remove&&(q=o.eventHandler({name:"remove",path:P,value:D})!==!1));q===!1&&b()}),A=($,P,N)=>{const D=d.every(q=>T.includes(q.op)?r.storage.test(N[q.key],q.op,q.compare):q.index.test(N,q.op,q.compare));let z=!0;D&&(x(P),m.add&&(z=o.eventHandler({name:"add",path:P,value:o.snapshots?N:null})!==!1)),z===!1&&b()},O=($,P,N,D)=>{let z=!0;k(P),m.remove&&(z=o.eventHandler({name:"remove",path:P,value:o.snapshots?D:null})!==!1),z===!1&&b()};(o.monitor.add||o.monitor.change||o.monitor.remove)&&r.subscribe(g.path,"child_changed",w),o.monitor.remove&&r.subscribe(g.path,"notify_child_removed",O),o.monitor.add&&r.subscribe(g.path,"child_added",A)}return{results:E,context:f,stop:M}})})}class eI extends OP{constructor(e="default",t,r){super(),this.db=t.db;const i={logLevel:t.settings.logLevel};if(typeof t.settings.storage=="object")if(dy&&t.settings.storage instanceof dy)this.storage=new NP(e,t.settings.storage,i);else if(py&&t.settings.storage instanceof py)this.storage=new jP(e,t.settings.storage,i);else if(ro&&t.settings.storage instanceof ro)this.storage=new QP(e,t.settings.storage,i);else{const s=t.settings.storage instanceof Vl?t.settings.storage:new Vl(t.settings.storage);this.storage=new nh(e,s,i)}else this.storage=new nh(e,new Vl,i);this.storage.on("ready",r)}stats(e){return W(this,null,function*(){return this.storage.stats})}subscribe(e,t,r){this.storage.subscriptions.add(e,t,r)}unsubscribe(e,t,r){this.storage.subscriptions.remove(e,t,r)}set(e,t){return W(this,arguments,function*(r,i,s={suppress_events:!1,context:null}){const o=yield this.storage.setNode(r,i,{suppress_events:s.suppress_events,context:s.context});return se({},o&&{cursor:o})})}update(e,t){return W(this,arguments,function*(r,i,s={suppress_events:!1,context:null}){const o=yield this.storage.updateNode(r,i,{suppress_events:s.suppress_events,context:s.context});return se({},o&&{cursor:o})})}get transactionLoggingEnabled(){return this.storage.settings.transactions&&this.storage.settings.transactions.log===!0}get(e,t){return W(this,null,function*(){if(t||(t={}),typeof t.include!="undefined"&&!(t.include instanceof Array))throw new TypeError("options.include must be an array of key names");if(typeof t.exclude!="undefined"&&!(t.exclude instanceof Array))throw new TypeError("options.exclude must be an array of key names");if(["undefined","boolean"].indexOf(typeof t.child_objects)<0)throw new TypeError("options.child_objects must be a boolean");const r=yield this.storage.getNode(e,t);return{value:r.value,context:{acebase_cursor:r.cursor},cursor:r.cursor}})}transaction(e,t){return W(this,arguments,function*(r,i,s={suppress_events:!1,context:null}){const o=yield this.storage.transactNode(r,i,{suppress_events:s.suppress_events,context:s.context});return se({},o&&{cursor:o})})}exists(e){return W(this,null,function*(){return(yield this.storage.getNodeInfo(e)).exists})}query(e,t){return W(this,arguments,function*(r,i,s={snapshots:!1}){return yield Tb(this,r,i,s)})}createIndex(e,t,r){return this.storage.indexes.create(e,t,r)}getIndexes(){return W(this,null,function*(){return this.storage.indexes.list()})}deleteIndex(e){return W(this,null,function*(){return this.storage.indexes.delete(e)})}reflect(e,t,r){return W(this,null,function*(){r=r||{};const i=(s,o=50,a=0,c=null)=>W(this,null,function*(){typeof o=="string"&&(o=parseInt(o)),typeof a=="string"&&(a=parseInt(a)),["null","undefined"].includes(c)&&(c=null);const l=[];let u=0,h=!1,p=!1;return yield this.storage.getChildren(s).next(f=>{if(h)return p=!0,!1;u++,(c!==null?f.key>c:a===0||u>a)&&l.push(se({key:typeof f.key=="string"?f.key:f.index,type:f.valueTypeName,value:f.value},typeof f.address=="object"&&"pageNr"in f.address&&{address:{pageNr:f.address.pageNr,recordNr:f.address.recordNr}})),h=o>0&&l.length===o}).catch(f=>{if(!(f instanceof jf))throw f}),{more:p,list:l}});switch(t){case"children":return yield i(e,r.limit,r.skip,r.from);case"info":{const s={key:"",exists:!1,type:"unknown",value:void 0,address:void 0,children:{count:0,more:!1,list:[]}},o=yield this.storage.getNodeInfo(e,{include_child_count:r.child_count===!0});s.key=typeof o.key!="undefined"?o.key:o.index,s.exists=o.exists,s.type=o.exists?o.valueTypeName:void 0,s.value=o.value,s.address=typeof o.address=="object"&&"pageNr"in o.address?{pageNr:o.address.pageNr,recordNr:o.address.recordNr}:void 0;const a=o.exists&&o.address&&[ae.OBJECT,ae.ARRAY].includes(o.type);return r.child_count===!0?s.children={count:a?o.childCount:0}:typeof r.child_limit=="number"&&r.child_limit>0&&a&&(s.children=yield i(e,r.child_limit,r.child_skip,r.child_from)),s}}})}export(e,t,r={format:"json",type_safe:!0}){return this.storage.exportNode(e,t,r)}import(e,t,r={format:"json",suppress_events:!1,method:"set"}){return this.storage.importNode(e,t,r)}setSchema(e,t,r=!1){return W(this,null,function*(){return this.storage.setSchema(e,t,r)})}getSchema(e){return W(this,null,function*(){return this.storage.getSchema(e)})}getSchemas(){return W(this,null,function*(){return this.storage.getSchemas()})}validateSchema(e,t,r){return W(this,null,function*(){return this.storage.validateSchema(e,t,{updates:r})})}getMutations(e){return W(this,null,function*(){if(typeof this.storage.getMutations!="function")throw new Error("Used storage type does not support getMutations");if(typeof e!="object")throw new Error("No filter specified");if(typeof e.cursor!="string"&&typeof e.timestamp!="number")throw new Error("No cursor or timestamp given");return this.storage.getMutations(e)})}getChanges(e){return W(this,null,function*(){if(typeof this.storage.getChanges!="function")throw new Error("Used storage type does not support getChanges");if(typeof e!="object")throw new Error("No filter specified");if(typeof e.cursor!="string"&&typeof e.timestamp!="number")throw new Error("No cursor or timestamp given");return this.storage.getChanges(e)})}}class tI extends Lf{constructor(e){super(e),this.temp=!1,this.multipleTabs=!1,typeof e.temp=="boolean"&&(this.temp=e.temp),typeof e.provider=="object"&&(this.provider=e.provider),typeof e.multipleTabs=="boolean"&&(this.multipleTabs=e.multipleTabs),typeof e.logLevel=="string"&&(this.logLevel=e.logLevel),typeof e.sponsor=="boolean"&&(this.sponsor=e.sponsor),["type","ipc","path"].forEach(t=>{t in e&&console.warn(`${t} setting is not supported for AceBase LocalStorage`)})}}class nI extends Df{constructor(e,t){super(t),this.context=e,this._storageKeysPrefix=`${this.context.dbname}.acebase::`}commit(){return W(this,null,function*(){})}rollback(e){return W(this,null,function*(){})}get(e){return W(this,null,function*(){const t=this.context.localStorage.getItem(this.getStorageKeyForPath(e));return JSON.parse(t)})}set(e,t){return W(this,null,function*(){const r=JSON.stringify(t);this.context.localStorage.setItem(this.getStorageKeyForPath(e),r)})}remove(e){return W(this,null,function*(){this.context.localStorage.removeItem(this.getStorageKeyForPath(e))})}childrenOf(e,t,r,i){return W(this,null,function*(){const s=no.PathInfo.get(e);for(let o=0;o<this.context.localStorage.length;o++){const a=this.context.localStorage.key(o);if(!a.startsWith(this._storageKeysPrefix))continue;const c=this.getPathFromStorageKey(a);if(s.isParentOf(c)&&r(c)){let l;if(t.metadata||t.value){const u=this.context.localStorage.getItem(a);l=JSON.parse(u)}if(!i(c,l))break}}})}descendantsOf(e,t,r,i){return W(this,null,function*(){const s=no.PathInfo.get(e);for(let o=0;o<this.context.localStorage.length;o++){const a=this.context.localStorage.key(o);if(!a.startsWith(this._storageKeysPrefix))continue;const c=this.getPathFromStorageKey(a);if(s.isAncestorOf(c)&&r(c)){let l;if(t.metadata||t.value){const u=this.context.localStorage.getItem(a);l=JSON.parse(u)}if(!i(c,l))break}}})}getPathFromStorageKey(e){return e.slice(this._storageKeysPrefix.length)}getStorageKeyForPath(e){return`${this._storageKeysPrefix}${e}`}}function rI(n,e={}){const t=new tI(e),r=t.provider?t.provider:t.temp?window.localStorage:window.sessionStorage,i=new ro({name:"LocalStorage",locking:!0,removeVoidProperties:t.removeVoidProperties,maxInlineValueSize:t.maxInlineValueSize,ready(){return W(this,null,function*(){})},getTransaction(o){return W(this,null,function*(){const a={debug:!0,dbname:n,localStorage:r};return new nI(a,o)})}}),s=new Oo(n,{logLevel:t.logLevel,storage:i,sponsor:t.sponsor});return s.settings.ipcEvents=t.multipleTabs===!0,s}class iI extends Lf{constructor(e){super(e),this.multipleTabs=!1,this.cacheSeconds=60,this.sponsor=!1,typeof e.logLevel=="string"&&(this.logLevel=e.logLevel),typeof e.multipleTabs=="boolean"&&(this.multipleTabs=e.multipleTabs),typeof e.cacheSeconds=="number"&&(this.cacheSeconds=e.cacheSeconds),typeof e.sponsor=="boolean"&&(this.sponsor=e.sponsor),["type","ipc","path"].forEach(t=>{t in e&&console.warn(`${t} setting is not supported for AceBase IndexedDBStorage`)})}}class Pb extends _b{constructor(e={}){super(e),e.storage&&(this.storage=e.storage,e.ipc&&(this.storage.ipc=e.ipc),e.transactions&&(this.storage.transactions=e.transactions))}}class sI extends AP{constructor(e,t={}){const r=new Pb(t);super(e,r),this.recovery={repairNode:(s,o)=>W(this,null,function*(){if(yield this.ready(),this.api.storage instanceof nh)yield this.api.storage.repairNode(s,o);else if(!this.api.storage.repairNode)throw new Error("repairNode is not supported with chosen storage engine")}),repairNodeTree:s=>W(this,null,function*(){yield this.ready(),yield this.api.storage.repairNodeTree(s)})};const i={db:this,settings:r};this.api=new eI(e,i,()=>{this.emit("ready")})}close(){return W(this,null,function*(){yield this.api.storage.close()})}get settings(){const e=this.api.storage.ipc,t=this.debug;return{get logLevel(){return t.level},set logLevel(r){t.setLevel(r)},get ipcEvents(){return e.eventsEnabled},set ipcEvents(r){e.eventsEnabled=r}}}static WithLocalStorage(e,t={}){return rI(e,t)}static WithIndexedDB(e,t={}){throw new Error("IndexedDB storage can only be used in browser contexts")}}function my(n){return new Promise((e,t)=>{n.onsuccess=r=>e(n.result||null),n.onerror=t})}class oI extends Df{constructor(e,t){super(t),this.context=e,this.production=!0,this._pending=[]}_createTransaction(e=!1){return this.context.db.transaction(["nodes","content"],e?"readwrite":"readonly")}_splitMetadata(e){const t=e.value,r=se({},e);return delete r.value,{metadata:r,value:t}}commit(){return W(this,null,function*(){if(this._pending.length===0)return;const e=this._pending.splice(0);this.context.ipc.sendNotification({action:"cache.invalidate",paths:e.map(r=>r.path)});const t=this._createTransaction(!0);try{yield new Promise((r,i)=>{let s=!1,o=0;const a=l=>{s=!0,i(l)},c=()=>{++o===e.length&&r()};e.forEach((l,u)=>{if(s)return;let h,p;const f=l.path;if(l.action==="set"){const{metadata:y,value:_}=this._splitMetadata(l.node),S={path:f,metadata:y};h=t.objectStore("nodes").put(S),p=t.objectStore("content").put(_,f),this.context.cache.set(f,l.node)}else l.action==="remove"?(h=t.objectStore("content").delete(f),p=t.objectStore("nodes").delete(f),this.context.cache.set(f,null)):a(new Error(`Unknown pending operation "${l.action}" on path "${f}" `));let d=0;h.onsuccess=p.onsuccess=()=>{++d===2&&c()},h.onerror=p.onerror=a})}),t.commit&&t.commit()}catch(r){throw console.error(r),t.abort&&t.abort(),r}})}rollback(e){return W(this,null,function*(){this._pending=[]})}get(e){return W(this,null,function*(){if(this.context.cache.has(e))return this.context.cache.get(e);const t=this._createTransaction(!1),r=my(t.objectStore("nodes").get(e)),i=my(t.objectStore("content").get(e));try{const s=yield Promise.all([r,i]);t.commit&&t.commit();const o=s[0];if(!o)return this.context.cache.set(e,null),null;const a=o.metadata;return a.value=s[1],this.context.cache.set(e,a),a}catch(s){throw console.error("IndexedDB get error",s),t.abort&&t.abort(),s}})}set(e,t){this._pending.push({action:"set",path:e,node:t})}remove(e){this._pending.push({action:"remove",path:e})}removeMultiple(e){return W(this,null,function*(){e.forEach(t=>{this._pending.push({action:"remove",path:t})})})}childrenOf(e,t,r,i){return this._getChildrenOf(e,nt(se({},t),{descendants:!1}),r,i)}descendantsOf(e,t,r,i){return this._getChildrenOf(e,nt(se({},t),{descendants:!0}),r,i)}_getChildrenOf(e,t,r,i){return new Promise((s,o)=>{const a=no.PathInfo.get(e),c=this._createTransaction(!1),l=c.objectStore("nodes"),u=IDBKeyRange.lowerBound(e,!0),h=t.metadata?l.openCursor(u):l.openKeyCursor(u);h.onerror=p=>{var f;(f=c.abort)==null||f.call(c),o(p)},h.onsuccess=p=>W(this,null,function*(){var f,d,y;const _=(d=(f=h.result)==null?void 0:f.key)!=null?d:null;let S=!0;if(_===null)S=!1;else if(!a.isAncestorOf(_))S=!1;else if(t.descendants||a.isParentOf(_)){let I;if(t.metadata&&(I=h.result.value.metadata),r(_,I)){if(t.value)if(this.context.cache.has(_)){const B=this.context.cache.get(_);I.value=B.value}else{const B=c.objectStore("content").get(_);I.value=yield new Promise((j,U)=>{B.onerror=M=>{j(null)},B.onsuccess=M=>{j(B.result)}}),this.context.cache.set(_,I.value===null?null:I)}S=i(_,I)}}if(S)try{h.result.continue()}catch(I){S=!1}S||((y=c.commit)==null||y.call(c),s())})})}}function aI(n,e={}){const t=new iI(e),r=(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB).open(`${n}.acebase`,1);r.onupgradeneeded=u=>{const h=r.result;h.createObjectStore("nodes",{keyPath:"path"}),h.createObjectStore("content")};let i;const s=new Promise((u,h)=>{r.onsuccess=p=>{i=r.result,u()},r.onerror=p=>{h(p)}}),o=new TP(typeof t.cacheSeconds=="number"?t.cacheSeconds:60),a=new ro({name:"IndexedDB",locking:!0,removeVoidProperties:t.removeVoidProperties,maxInlineValueSize:t.maxInlineValueSize,lockTimeout:t.lockTimeout,ready(){return s},getTransaction(u){return W(this,null,function*(){yield s;const h={debug:!1,db:i,cache:o,ipc:l};return new oI(h,u)})}}),c=new Oo(n,{logLevel:t.logLevel,storage:a,sponsor:t.sponsor}),l=c.api.storage.ipc;return c.settings.ipcEvents=t.multipleTabs===!0,l.on("notification",u=>W(this,null,function*(){const h=u.data;if(typeof h=="object"&&h.action==="cache.invalidate")for(const p of h.paths)o.remove(p)})),c}const cI=`Using AceBase constructor in the browser to use localStorage is deprecated!
Switch to:
IndexedDB implementation (FASTER, MORE RELIABLE):
    let db = AceBase.WithIndexedDB(name, settings)
Or, new LocalStorage implementation:
    let db = AceBase.WithLocalStorage(name, settings)
Or, write your own CustomStorage adapter:
    let myCustomStorage = new CustomStorageSettings({ ... });
    let db = new AceBase(name, { storage: myCustomStorage })`;class Oo extends sI{constructor(e,t){if(typeof t!="object"||typeof t.storage!="object")throw new Error(cI);super(e,t),this.settings.ipcEvents=t.multipleTabs===!0}static WithIndexedDB(e,t={}){return aI(e,t)}}const lI={AceBase:Oo,AceBaseLocalSettings:Pb,DataReference:Gn,DataSnapshot:st,EventSubscription:lb,PathReference:ot,TypeMappings:wb,CustomStorageSettings:ro,CustomStorageTransaction:Df,CustomStorageHelpers:no,ID:Kt,proxyAccess:Sa,DataSnapshotsArray:Dc};window.acebase=lI;window.AceBase=Oo;let uI=()=>Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),zl=(()=>"/ps"+uI()+"/pe")();const Bt={req:"/custom",create:{one:"/create-one",many:"/create-many"},send:{one:"/send-one",many:"/send-many"},find:{one:"/find-one",many:"/find-many"},get:{one:"/get-one",many:"/get-many"},query:{many:"/get-many"},update:{one:"/update-one",many:"/update-many"},delete:{one:"/delete-one",many:"/delete-many"}},xn={create:"/create",find:"/find",get:"/get",query:"/get",update:"/update",delete:"/delete",req:"/custom",upload:"/upload",send:"/send",user:{base:"/user",example:"/user/device-connected",join:"",status:"/user/status",device:{connected:"/user/device-connected",removed:"/user/device-removed",disconnected:"/user/device-disconnected"}}},Hl={base:"/auth",login:"/login/get-one",verify_token_code:"/verify-token-code/get-one",verify_pass_code:"/verify-pass-code/get-one",verify_email_code:"/verify-email-code/get-one",req:"/custom",user:"/user/"+zl+"/get-one",register:"/register/get-one",forgotPassword:"/forgot-password/get-one"+zl+"/get-one",deleteAccount:"/delete-account/get-one",refreshToken:"/refresh-token"+zl+"/get-one",users:{base:"/users"}},vy={base:"/data"};var Vs,ki,es,Ks,rr,Ib,sh,oh,$a,ir,zt,ts,Ht;class hI{constructor(e={}){wn(this,Vs,"/on"),wn(this,ki,!0),wn(this,es,void 0),wn(this,Ks,void 0),wn(this,rr,void 0),wn(this,Ib,void 0),wn(this,sh,void 0),wn(this,oh,void 0),wn(this,$a,new JT),wn(this,ir,void 0),wn(this,zt,void 0),wn(this,ts,void 0),wn(this,Ht,void 0),BS(this,"init",s=>{var o,a,c,l,u;let{ENV:h,HOST_SERVER:p,API_VERSION:f}=we(this,ts),d=()=>W(this,null,function*(){var m,v,g,k,x,b,w,A,O,$,P,N;let D="/transaction",z="/database",q=yield(g=(v=(m=we(this,Ht))==null?void 0:m.ref(D))==null?void 0:v.get())==null?void 0:g.catch(te=>{}),ne=yield(b=(x=(k=we(this,Ht))==null?void 0:k.ref(z))==null?void 0:x.get())==null?void 0:b.catch(te=>{});if(q.exists()){q=q.val();let te=Object.keys(q);if((te==null?void 0:te.length)>0){for(let ue in te){let le=q[ue];(le==null?void 0:le.path)&&(le==null?void 0:le.method)&&(le==null?void 0:le.value)&&(yield this.init(s).database().ref(le==null?void 0:le.path).req(le==null?void 0:le.method,le==null?void 0:le.path,le==null?void 0:le.value).val())}ne.exists()&&(yield(O=(A=(w=we(this,Ht))==null?void 0:w.ref(z))==null?void 0:A.remove())==null?void 0:O.catch(ue=>{})),yield(N=(P=($=we(this,Ht))==null?void 0:$.ref(D))==null?void 0:P.remove())==null?void 0:N.catch(ue=>{})}}});(a=(o=s==null?void 0:s.socket)==null?void 0:o.database)==null||a.on("connect",()=>{er(this,zt,!0),d()}),(l=(c=s==null?void 0:s.socket)==null?void 0:c.database)==null||l.on("disconnect",()=>{er(this,zt,!1)});const y=(m={})=>{var v,g,k;let x={};if(m&&Object.keys(m).length>0&&(x.data=m),we(this,rr)&&(x.storage=we(this,rr),x.config=we(this,sh)),we(this,oh)){let b=new FormData;Array.isArray(m)?(m.map((w,A)=>{typeof w=="object"&&(w.attachmentName="attachment"+A,w==null||w.attachments.forEach(O=>{O!=null&&O.data?b.append("attachments"+A,O==null?void 0:O.data,O==null?void 0:O.name):b.append("attachments"+A,O)}))}),b.append("field",JSON.stringify(x))):Array.isArray(m==null?void 0:m.attachments)&&(m==null||m.attachments.forEach(w=>{w!=null&&w.data?b.append("attachments",w==null?void 0:w.data,w==null?void 0:w.name):b.append("attachments",w)}),delete x.data.attachments,b.append("field",JSON.stringify(x))),x=b}else if(we(this,rr)&&(m==null?void 0:m.file)){let b=new FormData;m!=null&&m.file?((v=m.file)!=null&&v.data?b.append("file",(g=m.file)==null?void 0:g.data,(k=m.file)==null?void 0:k.name):b.append("file",m.file),delete x.data.file,b.append("field",JSON.stringify(x))):Array.isArray(m==null?void 0:m.directory)&&(m==null||m.directory.forEach(w=>{w!=null&&w.data?b.append("file",w==null?void 0:w.data,w==null?void 0:w.name):b.append("file",w)}),delete x.data.directory,b.append("field",JSON.stringify(x)),x=b),x=b}return x};let _=(m,v)=>W(this,null,function*(){var g,k,x,b,w,A,O,$;if(((g=m==null?void 0:m.error)==null?void 0:g.token)&&we(this,ki)){if(er(this,ki,!1),localStorage.getItem("refreshToken")){h==="dev"&&console.log("Token expired or not found: ",(k=m.error)==null?void 0:k.token," Trying to request a new refresh token");let P=yield(b=(x=this==null?void 0:this.init(s))==null?void 0:x.auth())==null?void 0:b.req(Hl.refreshToken,{token:localStorage.getItem("refreshToken")}).val();if(P!=null&&P.error)return h==="dev"&&console.log("Refresh token expired or not found: ",P),we(this,es)&&(window.top.location.href=we(this,es)),P;if(P!=null&&P.data&&(h==="dev"&&console.log("We got a new refresh token ,",P==null?void 0:P.data),(w=P==null?void 0:P.data)!=null&&w.token&&localStorage.setItem("accessToken",(A=P==null?void 0:P.data)==null?void 0:A.token),(O=P==null?void 0:P.data)!=null&&O.refreshToken&&localStorage.setItem("refreshToken",($=P==null?void 0:P.data)==null?void 0:$.refreshToken),h==="dev"&&console.log("Trying to restart your request..."),typeof v=="function"))return yield v()}}else return m});const S=(m,v,g,k=()=>{})=>{const x=we(this,Vs);let b=v.version+x+v.base+g;b=b.replace(/\/\//g,"/"),h==="dev"&&console.log("socket listen local path: ",b),m==null||m.on(b,k)},I=(m,v=()=>{})=>{var g;const k=we(this,Vs);let x=(f==null?void 0:f.DATABASE)+k+m;x=x.replace(/\/\//g,"/"),h==="dev"&&console.log("emitter listen local path: ",x),(g=we(this,$a))==null||g.on(x,v)};let B=(m,v,g,k)=>(we(this,Ks)&&(k=k+we(this,Ks)),{req:x=>(S(m,v,k+xn.req,b=>{var w,A,O;(!((A=(w=b==null?void 0:b.error)==null?void 0:w.error)!=null&&A.token)&&!((O=b==null?void 0:b.error)!=null&&O.token)||(b==null?void 0:b.data))&&typeof x=="function"&&x(nt(se({},g),{value:b}))}),g),create:x=>(S(m,v,k+xn.create,b=>{var w,A,O;(!((A=(w=b==null?void 0:b.error)==null?void 0:w.error)!=null&&A.token)&&!((O=b==null?void 0:b.error)!=null&&O.token)||(b==null?void 0:b.data))&&typeof x=="function"&&x(nt(se({},g),{value:b}))}),g),find:x=>(S(m,v,k+xn.find,b=>{var w,A,O;(!((A=(w=b==null?void 0:b.error)==null?void 0:w.error)!=null&&A.token)&&!((O=b==null?void 0:b.error)!=null&&O.token)||(b==null?void 0:b.data))&&typeof x=="function"&&x(nt(se({},g),{value:b}))}),g),get:x=>(S(m,v,k+xn.get,b=>{var w,A,O;(!((A=(w=b==null?void 0:b.error)==null?void 0:w.error)!=null&&A.token)&&!((O=b==null?void 0:b.error)!=null&&O.token)||(b==null?void 0:b.data))&&typeof x=="function"&&x(nt(se({},g),{value:b}))}),g),query:x=>(S(m,v,k+xn.query,b=>{var w,A,O;(!((A=(w=b==null?void 0:b.error)==null?void 0:w.error)!=null&&A.token)&&!((O=b==null?void 0:b.error)!=null&&O.token)||(b==null?void 0:b.data))&&typeof x=="function"&&x(nt(se({},g),{value:b}))}),g),update:x=>(S(m,v,k+xn.update,b=>{var w,A,O;(!((A=(w=b==null?void 0:b.error)==null?void 0:w.error)!=null&&A.token)&&!((O=b==null?void 0:b.error)!=null&&O.token)||(b==null?void 0:b.data))&&typeof x=="function"&&x(nt(se({},g),{value:b}))}),g),delete:x=>(S(m,v,k+xn.delete,b=>{var w,A,O;(!((A=(w=b==null?void 0:b.error)==null?void 0:w.error)!=null&&A.token)&&!((O=b==null?void 0:b.error)!=null&&O.token)||(b==null?void 0:b.data))&&typeof x=="function"&&x(nt(se({},g),{value:b}))}),g)}),j=(m,v)=>({create:g=>(I(m+xn.create,k=>{(!(k!=null&&k.error)||(k==null?void 0:k.data))&&typeof g=="function"&&g(nt(se({},v),{value:k}))}),v),find:g=>(I(m+xn.find,k=>{(!(k!=null&&k.error)||(k==null?void 0:k.data))&&typeof g=="function"&&g(nt(se({},v),{value:k}))}),v),get:g=>(I(m+xn.get,k=>{(!(k!=null&&k.error)||(k==null?void 0:k.data))&&typeof g=="function"&&g(nt(se({},v),{value:k}))}),v),query:g=>(I(m+xn.query,k=>{(!(k!=null&&k.error)||(k==null?void 0:k.data))&&typeof g=="function"&&g(nt(se({},v),{value:k}))}),v),update:g=>(I(m+xn.update,k=>{(!(k!=null&&k.error)||(k==null?void 0:k.data))&&typeof g=="function"&&g(nt(se({},v),{value:k}))}),v),delete:g=>(I(m+xn.delete,k=>{(!(k!=null&&k.error)||(k==null?void 0:k.data))&&typeof g=="function"&&g(nt(se({},v),{value:k}))}),v)}),U=ey.init(we(this,ts)),M=(m="",v={},g={},k={},x)=>{m=m.trim(),m.charAt(m.length-1)==="/"&&(m=m.slice(0,-1));let b=(()=>W(this,null,function*(){let w=()=>W(this,null,function*(){return yield U("post",p.AUTH+f.AUTH+Hl.base+m,y(v))}),A=yield w();return we(this,ki)&&(A=yield _(A,()=>W(this,null,function*(){return yield w()}))),typeof x=="function"&&x(nt(se({},k),{value:A})),A}))();return nt(se({},k),{val:()=>b})},H=(m,v,g,k={},x={},b)=>{let w=(()=>W(this,null,function*(){let A=()=>W(this,null,function*(){return yield U(m,v,y(g),k)}),O=yield A();return we(this,ki)&&(O=yield _(O,()=>W(this,null,function*(){return yield A()}))),typeof b=="function"&&b(nt(se({},x),{value:O})),O}))();return nt(se({},x),{val:()=>w})},L=m=>{let v={},g,[k={},,,]=m;if(m.length===1&&typeof k=="function"&&(g=m[0],k={}),m.length===2&&(typeof m[1]=="object"?v=m[1]:typeof m[1]=="function"&&(g=m[1])),m.length>=3){let[,x,b]=m;typeof x=="object"&&(v=x),g=b}return{data:k,onRequest:v,callback:g}},F=()=>Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),T=(m,v,g={},k,x)=>{v=v.replace(/\/\//g,"/");let b=(()=>W(this,null,function*(){var w,A,O,$,P,N,D,z,q,ne,te,ue,le,ie,pe,ke,ve,ze,je,He,Br,Lr,Dr;let Ur="/transaction",Ee,Fr,_e={error:{message:"We could not execute the "+m+" method for path: "+v}};switch(m){case"create":yield(O=(A=(w=we(this,Ht))==null?void 0:w.ref(v))==null?void 0:A.set(g))==null?void 0:O.catch(tt=>_e);break;case"update":yield(N=(P=($=we(this,Ht))==null?void 0:$.ref(v))==null?void 0:P.update(g))==null?void 0:N.catch(tt=>_e);break;case"query":let Ne=(D=we(this,Ht))==null?void 0:D.query(v);Array.isArray(g==null?void 0:g.where)&&(yield Promise.all(g==null?void 0:g.where.map(tt=>W(this,null,function*(){return yield new Promise(mn=>{Ne==null||Ne.filter(...tt),mn()})})))),g!=null&&g.take&&(Ne==null||Ne.take(g==null?void 0:g.take)),g!=null&&g.skip&&(Ne==null||Ne.take(g==null?void 0:g.skip)),g!=null&&g.order&&Array.isArray(g==null?void 0:g.order)&&(yield Promise.all(g==null?void 0:g.order.map(tt=>W(this,null,function*(){return yield new Promise(mn=>{Ne==null||Ne.sort(...tt),mn()})})))),Fr=yield Ne==null?void 0:Ne.count(),Ee=yield(z=Ne==null?void 0:Ne.get(se({},g==null?void 0:g.$option)))==null?void 0:z.catch(tt=>_e);break;case"delete":Ee=yield(te=(ne=(q=we(this,Ht))==null?void 0:q.ref(v))==null?void 0:ne.get())==null?void 0:te.catch(tt=>_e),yield(ie=(le=(ue=we(this,Ht))==null?void 0:ue.ref(v))==null?void 0:le.remove())==null?void 0:ie.catch(tt=>_e);break}if(m!=="delete"&&m!=="query"&&(Ee=yield(ve=(ke=(pe=we(this,Ht))==null?void 0:pe.ref(v))==null?void 0:ke.get(se({},g==null?void 0:g.$option)))==null?void 0:ve.catch(Ne=>_e)),m==="query"?Ee.exists()?(Ee=Ee==null?void 0:Ee.getValues(),Ee={data:Ee,max:Fr,take:g==null?void 0:g.take,skip:g==null?void 0:g.skip}):Ee=se({},_e):Ee.exists()?(Ee=Ee==null?void 0:Ee.val(),Ee={data:Ee}):Ee=se({},_e),we(this,ir)&&k.auth().$currentUserId&&!we(this,zt)&&["create","delete","update"].includes(m)&&Ee!=null&&Ee.data){let Ne=yield(He=(je=(ze=we(this,Ht))==null?void 0:ze.ref(Ur))==null?void 0:je.get())==null?void 0:He.catch(yl=>_e);Ne.exists()?Ne=Ne.val():Ne={};let tt,mn=Object.keys(Ne);switch(mn.length>0?tt=mn.length+1:tt=0,m){case"create":m="post";break;case"update":m="put";break;case"delete":m="delete";break}m!=="get"&&(yield(Dr=(Lr=(Br=we(this,Ht))==null?void 0:Br.ref(Ur+"/"+tt))==null?void 0:Lr.set({path:v,method:m,uid:tt,value:Ee.data}))==null?void 0:Dr.catch(yl=>_e))}const Ct=we(this,Vs);let Yt=(f==null?void 0:f.DATABASE)+Ct+v+"/"+m;return Yt=Yt.replace(/\/\//g,"/"),we(this,$a).emit(Yt,Ee),typeof x=="function"&&x(nt(se({},k),{value:Ee})),Ee}))();return nt(se({},k),{val:()=>b})},R=(m,v)=>{typeof m=="function"&&(v==null||v.on("connect",m))},C=(m,v)=>{let g="%"+m,k=this.init(s);return delete k.auth().login,delete k.auth().register,{private:(x=F())=>k.event(m+x),child:x=>k.event(m+x),emit:(x,b)=>(v==null||v.emit(g,x),typeof b=="function"&&k.event(m).do(b),se(se({},k.event(m)),k)),do:x=>(v==null||v.on(g,b=>{typeof x=="function"&&x(nt(se(se({},k.event(m)),k),{value:b}))}),se(se({},k.event(m)),k)),onAny:x=>{v==null||v.onAny((b,w)=>{typeof x=="function"&&x(b,se(se({value:w},k.event(b)),k))})}}},E=(m,v,g)=>nt(se({},m),{$io:g,connected:()=>g==null?void 0:g.connected,event:k=>C(k,g),ready:k=>R(k,g),ref:(k="")=>m.ref(k,v,g)});return{$connected:we(this,zt),activity:()=>{let m=this.init(s);return{onStart:v=>(typeof v=="function"&&document.addEventListener("DOMContentLoaded",v),se(se({},m),m.activity())),onCreate:v=>(typeof v=="function"&&(window.onload=v),se(se({},m),m.activity())),onPause:v=>(window.addEventListener("beforeunload",function(g){typeof v=="function"&&v(),g.returnValue="onbeforeunload"}),se(se({},m),m.activity())),onResume:()=>se(se({},m),m.activity()),onLeave:v=>(typeof v=="function"&&(window.onunload=v),se(se({},m),m.activity()))}},socket:{database:(u=s==null?void 0:s.socket)==null?void 0:u.database},$randomUID:()=>Dl(),$randomId:()=>F(),$axios:ey,local:(m={})=>{const v=this.init(s);return delete v.local,delete v.auth().register,delete v.auth().login,{database:(g="/database")=>({ref:(k="/database")=>{let x=this.init(s);return delete x.auth().login,delete x.auth().register,k=k.trim(),k=k.replace(/\/\//g,"/"),g=g+"/"+k,g=g.replace(/\/\//g,"/"),k.charAt(k.length-1)==="/"&&(k=k.slice(0,-1)),{child:(b="")=>{var w,A;return b=b.trim(),b=b.replace(/\/\//g,"/"),b.charAt(b.length-1)==="/"&&(b=b.slice(0,-1)),b.charAt(0)!=="/"&&(b="/"+b),(A=(w=x.local())==null?void 0:w.database())==null?void 0:A.ref(k+b)},push:(...b)=>{var w,A;let O=Dl();return!b.length>0?{getKey:()=>O}:(A=(w=x.local())==null?void 0:w.database())==null?void 0:A.ref(k+"/"+O).create(b)},create:(...b)=>{var w,A;let O=se(se({},(A=(w=x.local(m))==null?void 0:w.database())==null?void 0:A.ref(k)),x),{data:$,callback:P}=L(b);return T(m,"create",g,$,O)},get:(...b)=>{var w,A;let O=se(se({},(A=(w=x.local())==null?void 0:w.database())==null?void 0:A.ref(k)),x),{data:$,callback:P}=L(b);return T("get",g,$,O,P)},find:(...b)=>{var w,A;let O=se(se({},(A=(w=x.local())==null?void 0:w.database())==null?void 0:A.ref(k)),x),{data:$,callback:P}=L(b);return T("get",g,$,O,P)},query:()=>{},update:(...b)=>{var w,A;let O=se(se({},(A=(w=x.local())==null?void 0:w.database())==null?void 0:A.ref(k)),x),{data:$,callback:P}=L(b);return T("update",g,$,O,P)},delete:(...b)=>{var w,A;let O=se(se({},(A=(w=x.local())==null?void 0:w.database())==null?void 0:A.ref(k)),x),{data:$,callback:P}=L(b);return T("delete",g,$,O,P)},on:()=>{var b,w;let A=se(se({},(w=(b=x.local())==null?void 0:b.database())==null?void 0:w.ref(k)),x);return j(k,A)},onValue:b=>{var w,A,O,$,P,N,D;let z=se(se({},(A=(w=x.local())==null?void 0:w.database())==null?void 0:A.ref(k)),x),q=($=(O=x.local())==null?void 0:O.database())==null?void 0:$.ref(k);return(P=q==null?void 0:q.on())==null||P.create(b),(N=q==null?void 0:q.on())==null||N.update(b),(D=q==null?void 0:q.on())==null||D.delete(b),z}}}}),cache:(g="/cache")=>{var k;let x=this.init(s);return delete x.auth().login,delete x.auth().register,(k=x.local())==null?void 0:k.database(g)},storage:()=>({})}},database:()=>{var m,v,g;const k=this.init(s);return delete k.database,delete k.auth().register,delete k.auth().login,(m=s==null?void 0:s.socket)==null||m.database.on("connect",()=>{er(this,zt,!0),d()}),(v=s==null?void 0:s.socket)==null||v.database.on("disconnect",()=>{er(this,zt,!1)}),E(k,{host:p.DATABASE,version:f.DATABASE,base:vy.base},(g=s==null?void 0:s.socket)==null?void 0:g.database)},cron:m=>{},task:m=>{},$online:navigator==null?void 0:navigator.onLine,auth:()=>({req:(m,v,g)=>{let k=this.init(s);delete k.auth().login,delete k.auth().register;let x=se(se({},k),k.auth());return M(m+Hl.req,v,null,x,g)}}),syncDatabase:(m=!0)=>{const v=this.init(s);return er(this,ir,typeof m=="boolean"?m:!0),v.database()},ref:(m="",v={host:p.DATABASE,version:f.DATABASE,base:vy.base},g=(x=>(x=s==null?void 0:s.socket)==null?void 0:x.database)(),k=!0)=>{m=m.trim(),m=m.replace(/\/\//g,"/"),m.charAt(0)==="/"&&m.length<=1&&(m="/root"),m.charAt(m.length-1)==="/"&&(m=m.slice(0,-1));const x=v.host+v.version+v.base+m;let b=this.init(s);return delete b.auth().login,delete b.auth().register,er(this,ki,k),{push:(...w)=>{let A=Dl();return!w.length>0?{getKey:()=>A}:b.ref(m+"/"+A,v,g).create(w)},private:(w=F())=>b.ref(m+"/ps"+w+"/pe",v,g),setAuthAccess:(w=!0,A=we(this,es))=>(er(this,es,A),b.ref(m,v,g,w)),req:(...w)=>{let A=se(se({},b.ref(m,v,g)),b);if(w.length>=2){let[O="post",$={},P={},N]=w;if(typeof O=="string"&&["post","put","delete","get"].includes(O)){let D=Bt.req;return H(O,x+D,$,P,A,N)}return A}else{let O=w.filter($=>typeof $=="function");if(O.length>0)O=O[0],typeof O=="function"&&O(A);else return A}},child:(w="")=>(w=w.trim(),w=w.replace(/\/\//g,"/"),w.charAt(w.length-1)==="/"&&(w=w.slice(0,-1)),w.charAt(0)!=="/"&&(w="/"+w),b.ref(m+w,v,g)),set:(...w)=>{var A;return(A=b.ref(m,v,g))==null?void 0:A.create(...w)},create:(...w)=>{var A,O,$,P;let N=se(se({},b.ref(m,v,g)),b);if(b.auth().$currentUserId&&(v==null?void 0:v.host)===(p==null?void 0:p.DATABASE)&&we(this,ir)&&!we(this,zt))return($=(O=(A=b.local())==null?void 0:A.database())==null?void 0:O.ref(m))==null?void 0:$.create(...w);{let{data:D,onRequest:z,callback:q}=L(w),ne=Bt.create.one;if(we(this,rr)){if((D==null?void 0:D.file)||(D==null?void 0:D.directory))return(P=b.ref(m))==null?void 0:P.upload(D,null,q);Array.isArray(D.folders)&&(ne=Bt.create.many)}else Array!=null&&Array.isArray(D)&&(ne=Bt.create.many);return H("post",x+ne,D,z,N,q)}},find:(...w)=>{var A,O,$,P;if(console.log("Database connected: ",we(this,zt)),b.auth().$currentUserId&&(v==null?void 0:v.host)===(p==null?void 0:p.DATABASE)&&we(this,ir)&&!we(this,zt))return h==="dev"&&console.log("Find: We are offline"),($=(O=(A=b.local())==null?void 0:A.database())==null?void 0:O.ref(m))==null?void 0:$.find(...w);{h==="dev"&&console.log("Find: We are online");let N=se(se({},b.ref(m,v,g)),b),{data:D,onRequest:z,callback:q}=L(w),ne=Bt.find.one;return we(this,rr)?(Array.isArray(D==null?void 0:D.files)||Array.isArray(D==null?void 0:D.folders))&&(Array.isArray(D==null?void 0:D.files)&&(D.isFolder=!1),Array.isArray(D==null?void 0:D.folders)&&(D.isFolder=!0),ne=Bt.find.many):(((P=Object.keys(D))==null?void 0:P.length)<=0||D.order||D.where||D.$option||D.skip||D.take)&&(ne=Bt.find.many),H("post",x+ne,D,z,N,q)}},get:(...w)=>{var A,O,$,P;if(b.auth().$currentUserId&&(v==null?void 0:v.host)===(p==null?void 0:p.DATABASE)&&we(this,ir)&&!we(this,zt))return($=(O=(A=b.local())==null?void 0:A.database())==null?void 0:O.ref(m))==null?void 0:$.get(...w);{let N=se(se({},b.ref(m,v,g)),b),{data:D,onRequest:z,callback:q}=L(w),ne=Bt.get.one;return we(this,rr)?(Array.isArray(D==null?void 0:D.files)||Array.isArray(D==null?void 0:D.folders))&&(Array.isArray(D==null?void 0:D.files)&&(D.isFolder=!1),Array.isArray(D==null?void 0:D.folders)&&(D.isFolder=!0),ne=Bt.get.many):(((P=Object.keys(D))==null?void 0:P.length)<=0||D.order||D.where||D.$option||D.skip||D.take)&&(ne=Bt.get.many),H("get",x+ne+"?query="+JSON.stringify(y(D)),null,z,N,q)}},query:(...w)=>{var A,O,$;if(b.auth().$currentUserId&&(v==null?void 0:v.host)===(p==null?void 0:p.DATABASE)&&we(this,ir)&&!we(this,zt))return($=(O=(A=b.local())==null?void 0:A.database())==null?void 0:O.ref(m))==null?void 0:$.query(...w);{let P=se(se({},b.ref(m,v,g)),b),{data:N,onRequest:D,callback:z}=L(w);return(!N||N==="")&&(N={take:15},!we(this,Ks)&&!N.order&&(N.order={uid:"ASC"})),H("get",x+Bt.get.many+"?query="+JSON.stringify(y(N)),null,D,P,z)}},update:(...w)=>{var A,O,$;if(b.auth().$currentUserId&&(v==null?void 0:v.host)===(p==null?void 0:p.DATABASE)&&we(this,ir)&&!we(this,zt))return($=(O=(A=b.local())==null?void 0:A.database())==null?void 0:O.ref(m))==null?void 0:$.update(...w);{let P=se(se({},b.ref(m,v,g)),b),{data:N,onRequest:D,callback:z}=L(w),q=Bt.update.one;return we(this,rr)?(Array.isArray(N==null?void 0:N.files)||Array.isArray(N==null?void 0:N.folders))&&(Array.isArray(N==null?void 0:N.files)&&(N.isFolder=!1),Array.isArray(N==null?void 0:N.folders)&&(N.isFolder=!0),q=Bt.update.many):Array.isArray(N)&&(q=Bt.find.many),H("put",x+q,N,D,P,z)}},delete:(...w)=>{var A,O,$;if(b.auth().$currentUserId&&(v==null?void 0:v.host)===(p==null?void 0:p.DATABASE)&&we(this,ir)&&!we(this,zt))return($=(O=(A=b.local())==null?void 0:A.database())==null?void 0:O.ref(m))==null?void 0:$.delete(...w);{let P=se(se({},b.ref(m,v,g)),b),{data:N,onRequest:D,callback:z}=L(w),q=Bt.delete.one;return we(this,rr)?(Array.isArray(N==null?void 0:N.files)||Array.isArray(N==null?void 0:N.folders))&&(Array.isArray(N==null?void 0:N.files)&&(N.isFolder=!1),Array.isArray(N==null?void 0:N.folders)&&(N.isFolder=!0),Object.keys(N).length<=0&&(N.isFolder=!0),q=Bt.delete.many):(Array.isArray(N)||N.where)&&(q=Bt.delete.many),H("delete",x+q,N,D,P,z)}},on:()=>{let w=se(se({},b.ref(m,v,g)),b);return B(g,v,w,m)},onValue:w=>{let A=se(se({},b.ref(m,v,g)),b),O=b.ref(m,v,g);return O==null||O.on().create(w),O==null||O.on().update(w),O==null||O.on().delete(w),O==null||O.on().upload(w),A}}}}}),er(this,ts,e);let{ENV:t,OFFLINE_DB_NAME:r}=we(this,ts);er(this,Ht,Oo.WithIndexedDB((r==null?void 0:r.DATABASE)||"swyger_database"));let i=()=>W(this,null,function*(){try{let s,o=localStorage.getItem("accessToken");if((()=>{var a;try{s=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");let c=O$(o);return(Date==null?void 0:Date.parse((a=new Date((c==null?void 0:c.exp)*1e3))==null?void 0:a.toString()))<Date.now()}catch(c){return!1}})()&&s.uid)try{t==="dev"&&console.log("Token expired on inactivity, Trying to request a new refresh token")}catch(a){}}catch(s){}});"requestIdleCallback"in window&&requestIdleCallback(i)}}Vs=new WeakMap,ki=new WeakMap,es=new WeakMap,Ks=new WeakMap,rr=new WeakMap,Ib=new WeakMap,sh=new WeakMap,oh=new WeakMap,$a=new WeakMap,ir=new WeakMap,zt=new WeakMap,ts=new WeakMap,Ht=new WeakMap;const fI={init:n=>{try{return(e={})=>new hI(n).init(e)}catch(e){return{}}}};let dI={init:n=>{var e,t,r,i,s;return{OFFLINE_DB_NAME:{DATABASE:((e=n==null?void 0:n.OFFLINE_DB_NAME)==null?void 0:e.DATABASE)||"swyger_database"},ENV:(n==null?void 0:n.ENV)||"prod",HOST_SERVER:{AUTH:((t=n==null?void 0:n.HOST_SERVER)==null?void 0:t.AUTH)||"http://localhost:4100",DATABASE:((r=n==null?void 0:n.HOST_SERVER)==null?void 0:r.DATABASE)||"http://localhost:4400"},API_VERSION:{AUTH:((i=n==null?void 0:n.API_VERSION)==null?void 0:i.AUTH)||"/api/v1",DATABASE:((s=n==null?void 0:n.API_VERSION)==null?void 0:s.DATABASE)||"/api/v1"},AUTO_REFRESH_TOKEN_TIMEOUT:(n==null?void 0:n.AUTO_REFRESH_TOKEN_TIMEOUT)||15e5,API_KEY:(n==null?void 0:n.API_KEY)||"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJzd3lnZXIuY29tIiwiaWF0IjoxNjUzNDQwOTkxLCJleHAiOjE2ODQ5NzY5OTEsImF1ZCI6ImRheW52ZXIuY29tIiwic3ViIjoidGVhbUBzd3lnZXIuY29tIiwiR2l2ZW5OYW1lIjoiSXZhbiBKb2VsIiwiU3VybmFtZSI6IlNvYmd1aSIsIkVtYWlsIjoidGVhbUBhZ2dsb215LmNvbSIsIlJvbGUiOlsiQWRtaW4iLCJQcm9qZWN0IEFkbWluaXN0cmF0b3IiXX0.UvlcjBahR9G8dKxIeENJ7k4I87t3_oNJQ16eyPsRcSE"}}};const pI={init:n=>{let e=dI.init(n);const t=_$.init(e),r={socket:{database:t==null?void 0:t.database}};return fI.init(e)(r)}};var ah=function(n,e){return ah=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])},ah(n,e)};function bt(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");ah(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function yI(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{l(r.next(u))}catch(h){o(h)}}function c(u){try{l(r.throw(u))}catch(h){o(h)}}function l(u){u.done?s(u.value):i(u.value).then(a,c)}l((r=r.apply(n,e||[])).next())})}function Uf(n,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(t=0)),t;)try{if(r=1,i&&(s=l[0]&2?i.return:l[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,l[1])).done)return s;switch(i=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){t.label=l[1];break}if(l[0]===6&&t.label<s[1]){t.label=s[1],s=l;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(l);break}s[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(n,t)}catch(u){l=[6,u],i=0}finally{r=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function un(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Qe(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return s}function Xe(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return n.concat(s||Array.prototype.slice.call(e))}function is(n){return this instanceof is?(this.v=n,this):new is(n)}function gI(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(p){r[p]&&(i[p]=function(f){return new Promise(function(d,y){s.push([p,f,d,y])>1||a(p,f)})})}function a(p,f){try{c(r[p](f))}catch(d){h(s[0][3],d)}}function c(p){p.value instanceof is?Promise.resolve(p.value.v).then(l,u):h(s[0][2],p)}function l(p){a("next",p)}function u(p){a("throw",p)}function h(p,f){p(f),s.shift(),s.length&&a(s[0][0],s[0][1])}}function mI(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof un=="function"?un(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(s){t[s]=n[s]&&function(o){return new Promise(function(a,c){o=n[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}function Re(n){return typeof n=="function"}function Ui(n){var e=function(r){Error.call(r),r.stack=new Error().stack},t=n(e);return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var Ta=Ui(function(n){return function(e){n(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(t,r){return r+1+") "+t.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function $r(n,e){if(n){var t=n.indexOf(e);0<=t&&n.splice(t,1)}}var yn=function(){function n(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return n.prototype.unsubscribe=function(){var e,t,r,i,s;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var a=un(o),c=a.next();!c.done;c=a.next()){var l=c.value;l.remove(this)}}catch(y){e={error:y}}finally{try{c&&!c.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}else o.remove(this);var u=this.initialTeardown;if(Re(u))try{u()}catch(y){s=y instanceof Ta?y.errors:[y]}var h=this._finalizers;if(h){this._finalizers=null;try{for(var p=un(h),f=p.next();!f.done;f=p.next()){var d=f.value;try{by(d)}catch(y){s=s!=null?s:[],y instanceof Ta?s=Xe(Xe([],Qe(s)),Qe(y.errors)):s.push(y)}}}catch(y){r={error:y}}finally{try{f&&!f.done&&(i=p.return)&&i.call(p)}finally{if(r)throw r.error}}}if(s)throw new Ta(s)}},n.prototype.add=function(e){var t;if(e&&e!==this)if(this.closed)by(e);else{if(e instanceof n){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}},n.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},n.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},n.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&$r(t,e)},n.prototype.remove=function(e){var t=this._finalizers;t&&$r(t,e),e instanceof n&&e._removeParent(this)},n.EMPTY=function(){var e=new n;return e.closed=!0,e}(),n}(),Rb=yn.EMPTY;function Cb(n){return n instanceof yn||n&&"closed"in n&&Re(n.remove)&&Re(n.add)&&Re(n.unsubscribe)}function by(n){Re(n)?n():n.unsubscribe()}var yi={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Ff={setTimeout:function(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];var i=Ff.delegate;return i!=null&&i.setTimeout?i.setTimeout.apply(i,Xe([n,e],Qe(t))):setTimeout.apply(void 0,Xe([n,e],Qe(t)))},clearTimeout:function(n){return clearTimeout(n)},delegate:void 0};function Nb(n){Ff.setTimeout(function(){var e=yi.onUnhandledError;if(e)e(n);else throw n})}function gt(){}var vI=function(){return Mf("C",void 0,void 0)}();function bI(n){return Mf("E",void 0,n)}function wI(n){return Mf("N",n,void 0)}function Mf(n,e,t){return{kind:n,value:e,error:t}}var Ai=null;function Pa(n){if(yi.useDeprecatedSynchronousErrorHandling){var e=!Ai;if(e&&(Ai={errorThrown:!1,error:null}),n(),e){var t=Ai,r=t.errorThrown,i=t.error;if(Ai=null,r)throw i}}else n()}function kI(n){yi.useDeprecatedSynchronousErrorHandling&&Ai&&(Ai.errorThrown=!0,Ai.error=n)}var Uc=function(n){bt(e,n);function e(t){var r=n.call(this)||this;return r.isStopped=!1,t?(r.destination=t,Cb(t)&&t.add(r)):r.destination=AI,r}return e.create=function(t,r,i){return new ps(t,r,i)},e.prototype.next=function(t){this.isStopped?Yl(wI(t),this):this._next(t)},e.prototype.error=function(t){this.isStopped?Yl(bI(t),this):(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped?Yl(vI,this):(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,n.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(yn),xI=Function.prototype.bind;function Jl(n,e){return xI.call(n,e)}var EI=function(){function n(e){this.partialObserver=e}return n.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(r){Xo(r)}},n.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(r){Xo(r)}else Xo(e)},n.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(t){Xo(t)}},n}(),ps=function(n){bt(e,n);function e(t,r,i){var s=n.call(this)||this,o;if(Re(t)||!t)o={next:t!=null?t:void 0,error:r!=null?r:void 0,complete:i!=null?i:void 0};else{var a;s&&yi.useDeprecatedNextContext?(a=Object.create(t),a.unsubscribe=function(){return s.unsubscribe()},o={next:t.next&&Jl(t.next,a),error:t.error&&Jl(t.error,a),complete:t.complete&&Jl(t.complete,a)}):o=t}return s.destination=new EI(o),s}return e}(Uc);function Xo(n){yi.useDeprecatedSynchronousErrorHandling?kI(n):Nb(n)}function _I(n){throw n}function Yl(n,e){var t=yi.onStoppedNotification;t&&Ff.setTimeout(function(){return t(n,e)})}var AI={closed:!0,next:gt,error:_I,complete:gt},Fc=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function It(n){return n}function qf(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return jb(n)}function jb(n){return n.length===0?It:n.length===1?n[0]:function(e){return n.reduce(function(t,r){return r(t)},e)}}var Me=function(){function n(e){e&&(this._subscribe=e)}return n.prototype.lift=function(e){var t=new n;return t.source=this,t.operator=e,t},n.prototype.subscribe=function(e,t,r){var i=this,s=SI(e)?e:new ps(e,t,r);return Pa(function(){var o=i,a=o.operator,c=o.source;s.add(a?a.call(s,c):c?i._subscribe(s):i._trySubscribe(s))}),s},n.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},n.prototype.forEach=function(e,t){var r=this;return t=wy(t),new t(function(i,s){var o=new ps({next:function(a){try{e(a)}catch(c){s(c),o.unsubscribe()}},error:s,complete:i});r.subscribe(o)})},n.prototype._subscribe=function(e){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(e)},n.prototype[Fc]=function(){return this},n.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return jb(e)(this)},n.prototype.toPromise=function(e){var t=this;return e=wy(e),new e(function(r,i){var s;t.subscribe(function(o){return s=o},function(o){return i(o)},function(){return r(s)})})},n.create=function(e){return new n(e)},n}();function wy(n){var e;return(e=n!=null?n:yi.Promise)!==null&&e!==void 0?e:Promise}function OI(n){return n&&Re(n.next)&&Re(n.error)&&Re(n.complete)}function SI(n){return n&&n instanceof Uc||OI(n)&&Cb(n)}function Bb(n){return Re(n==null?void 0:n.lift)}function ge(n){return function(e){if(Bb(e))return e.lift(function(t){try{return n(t,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function fe(n,e,t,r,i){return new Vf(n,e,t,r,i)}var Vf=function(n){bt(e,n);function e(t,r,i,s,o,a){var c=n.call(this,t)||this;return c.onFinalize=o,c.shouldUnsubscribe=a,c._next=r?function(l){try{r(l)}catch(u){t.error(u)}}:n.prototype._next,c._error=s?function(l){try{s(l)}catch(u){t.error(u)}finally{this.unsubscribe()}}:n.prototype._error,c._complete=i?function(){try{i()}catch(l){t.error(l)}finally{this.unsubscribe()}}:n.prototype._complete,c}return e.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;n.prototype.unsubscribe.call(this),!r&&((t=this.onFinalize)===null||t===void 0||t.call(this))}},e}(Uc);function Lb(){return ge(function(n,e){var t=null;n._refCount++;var r=fe(e,void 0,void 0,void 0,function(){if(!n||n._refCount<=0||0<--n._refCount){t=null;return}var i=n._connection,s=t;t=null,i&&(!s||i===s)&&i.unsubscribe(),e.unsubscribe()});n.subscribe(r),r.closed||(t=n.connect())})}var Mc=function(n){bt(e,n);function e(t,r){var i=n.call(this)||this;return i.source=t,i.subjectFactory=r,i._subject=null,i._refCount=0,i._connection=null,Bb(t)&&(i.lift=t.lift),i}return e.prototype._subscribe=function(t){return this.getSubject().subscribe(t)},e.prototype.getSubject=function(){var t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject},e.prototype._teardown=function(){this._refCount=0;var t=this._connection;this._subject=this._connection=null,t==null||t.unsubscribe()},e.prototype.connect=function(){var t=this,r=this._connection;if(!r){r=this._connection=new yn;var i=this.getSubject();r.add(this.source.subscribe(fe(i,void 0,function(){t._teardown(),i.complete()},function(s){t._teardown(),i.error(s)},function(){return t._teardown()}))),r.closed&&(this._connection=null,r=yn.EMPTY)}return r},e.prototype.refCount=function(){return Lb()(this)},e}(Me),Db={now:function(){return(Db.delegate||performance).now()},delegate:void 0},io={schedule:function(n){var e=requestAnimationFrame,t=cancelAnimationFrame,r=e(function(i){t=void 0,n(i)});return new yn(function(){return t==null?void 0:t(r)})},requestAnimationFrame:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=io.delegate;return((t==null?void 0:t.requestAnimationFrame)||requestAnimationFrame).apply(void 0,Xe([],Qe(n)))},cancelAnimationFrame:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return cancelAnimationFrame.apply(void 0,Xe([],Qe(n)))},delegate:void 0};function $I(n){return n?Ub(n):TI}function Ub(n){return new Me(function(e){var t=n||Db,r=t.now(),i=0,s=function(){e.closed||(i=io.requestAnimationFrame(function(o){i=0;var a=t.now();e.next({timestamp:n?a:o,elapsed:a-r}),s()}))};return s(),function(){i&&io.cancelAnimationFrame(i)}})}var TI=Ub(),Fb=Ui(function(n){return function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),_t=function(n){bt(e,n);function e(){var t=n.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return e.prototype.lift=function(t){var r=new ky(this,this);return r.operator=t,r},e.prototype._throwIfClosed=function(){if(this.closed)throw new Fb},e.prototype.next=function(t){var r=this;Pa(function(){var i,s;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var o=un(r.currentObservers),a=o.next();!a.done;a=o.next()){var c=a.value;c.next(t)}}catch(l){i={error:l}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}}})},e.prototype.error=function(t){var r=this;Pa(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=t;for(var i=r.observers;i.length;)i.shift().error(t)}})},e.prototype.complete=function(){var t=this;Pa(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var r=t.observers;r.length;)r.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(t){return this._throwIfClosed(),n.prototype._trySubscribe.call(this,t)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var r=this,i=this,s=i.hasError,o=i.isStopped,a=i.observers;return s||o?Rb:(this.currentObservers=null,a.push(t),new yn(function(){r.currentObservers=null,$r(a,t)}))},e.prototype._checkFinalizedStatuses=function(t){var r=this,i=r.hasError,s=r.thrownError,o=r.isStopped;i?t.error(s):o&&t.complete()},e.prototype.asObservable=function(){var t=new Me;return t.source=this,t},e.create=function(t,r){return new ky(t,r)},e}(Me),ky=function(n){bt(e,n);function e(t,r){var i=n.call(this)||this;return i.destination=t,i.source=r,i}return e.prototype.next=function(t){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.next)===null||i===void 0||i.call(r,t)},e.prototype.error=function(t){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.error)===null||i===void 0||i.call(r,t)},e.prototype.complete=function(){var t,r;(r=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||r===void 0||r.call(t)},e.prototype._subscribe=function(t){var r,i;return(i=(r=this.source)===null||r===void 0?void 0:r.subscribe(t))!==null&&i!==void 0?i:Rb},e}(_t),Mb=function(n){bt(e,n);function e(t){var r=n.call(this)||this;return r._value=t,r}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(t){var r=n.prototype._subscribe.call(this,t);return!r.closed&&t.next(this._value),r},e.prototype.getValue=function(){var t=this,r=t.hasError,i=t.thrownError,s=t._value;if(r)throw i;return this._throwIfClosed(),s},e.prototype.next=function(t){n.prototype.next.call(this,this._value=t)},e}(_t),qc={now:function(){return(qc.delegate||Date).now()},delegate:void 0},Kf=function(n){bt(e,n);function e(t,r,i){t===void 0&&(t=1/0),r===void 0&&(r=1/0),i===void 0&&(i=qc);var s=n.call(this)||this;return s._bufferSize=t,s._windowTime=r,s._timestampProvider=i,s._buffer=[],s._infiniteTimeWindow=!0,s._infiniteTimeWindow=r===1/0,s._bufferSize=Math.max(1,t),s._windowTime=Math.max(1,r),s}return e.prototype.next=function(t){var r=this,i=r.isStopped,s=r._buffer,o=r._infiniteTimeWindow,a=r._timestampProvider,c=r._windowTime;i||(s.push(t),!o&&s.push(a.now()+c)),this._trimBuffer(),n.prototype.next.call(this,t)},e.prototype._subscribe=function(t){this._throwIfClosed(),this._trimBuffer();for(var r=this._innerSubscribe(t),i=this,s=i._infiniteTimeWindow,o=i._buffer,a=o.slice(),c=0;c<a.length&&!t.closed;c+=s?1:2)t.next(a[c]);return this._checkFinalizedStatuses(t),r},e.prototype._trimBuffer=function(){var t=this,r=t._bufferSize,i=t._timestampProvider,s=t._buffer,o=t._infiniteTimeWindow,a=(o?1:2)*r;if(r<1/0&&a<s.length&&s.splice(0,s.length-a),!o){for(var c=i.now(),l=0,u=1;u<s.length&&s[u]<=c;u+=2)l=u;l&&s.splice(0,l+1)}},e}(_t),Wf=function(n){bt(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t._value=null,t._hasValue=!1,t._isComplete=!1,t}return e.prototype._checkFinalizedStatuses=function(t){var r=this,i=r.hasError,s=r._hasValue,o=r._value,a=r.thrownError,c=r.isStopped,l=r._isComplete;i?t.error(a):(c||l)&&(s&&t.next(o),t.complete())},e.prototype.next=function(t){this.isStopped||(this._value=t,this._hasValue=!0)},e.prototype.complete=function(){var t=this,r=t._hasValue,i=t._value,s=t._isComplete;s||(this._isComplete=!0,r&&n.prototype.next.call(this,i),n.prototype.complete.call(this))},e}(_t),PI=function(n){bt(e,n);function e(t,r){return n.call(this)||this}return e.prototype.schedule=function(t,r){return this},e}(yn),ch={setInterval:function(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];var i=ch.delegate;return i!=null&&i.setInterval?i.setInterval.apply(i,Xe([n,e],Qe(t))):setInterval.apply(void 0,Xe([n,e],Qe(t)))},clearInterval:function(n){return clearInterval(n)},delegate:void 0},So=function(n){bt(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.scheduler=t,i.work=r,i.pending=!1,i}return e.prototype.schedule=function(t,r){var i;if(r===void 0&&(r=0),this.closed)return this;this.state=t;var s=this.id,o=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(o,s,r)),this.pending=!0,this.delay=r,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(o,this.id,r),this},e.prototype.requestAsyncId=function(t,r,i){return i===void 0&&(i=0),ch.setInterval(t.flush.bind(t,this),i)},e.prototype.recycleAsyncId=function(t,r,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return r;r!=null&&ch.clearInterval(r)},e.prototype.execute=function(t,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(t,r);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,r){var i=!1,s;try{this.work(t)}catch(o){i=!0,s=o||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),s},e.prototype.unsubscribe=function(){if(!this.closed){var t=this,r=t.id,i=t.scheduler,s=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,$r(s,this),r!=null&&(this.id=this.recycleAsyncId(i,r,null)),this.delay=null,n.prototype.unsubscribe.call(this)}},e}(PI),II=1,Gl,lh={};function xy(n){return n in lh?(delete lh[n],!0):!1}var qb={setImmediate:function(n){var e=II++;return lh[e]=!0,Gl||(Gl=Promise.resolve()),Gl.then(function(){return xy(e)&&n()}),e},clearImmediate:function(n){xy(n)}},RI=qb.setImmediate,CI=qb.clearImmediate,uh={setImmediate:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=uh.delegate;return((t==null?void 0:t.setImmediate)||RI).apply(void 0,Xe([],Qe(n)))},clearImmediate:function(n){return CI(n)},delegate:void 0},NI=function(n){bt(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.scheduler=t,i.work=r,i}return e.prototype.requestAsyncId=function(t,r,i){return i===void 0&&(i=0),i!==null&&i>0?n.prototype.requestAsyncId.call(this,t,r,i):(t.actions.push(this),t._scheduled||(t._scheduled=uh.setImmediate(t.flush.bind(t,void 0))))},e.prototype.recycleAsyncId=function(t,r,i){var s;if(i===void 0&&(i=0),i!=null?i>0:this.delay>0)return n.prototype.recycleAsyncId.call(this,t,r,i);var o=t.actions;r!=null&&((s=o[o.length-1])===null||s===void 0?void 0:s.id)!==r&&(uh.clearImmediate(r),t._scheduled===r&&(t._scheduled=void 0))},e}(So),hh=function(){function n(e,t){t===void 0&&(t=n.now),this.schedulerActionCtor=e,this.now=t}return n.prototype.schedule=function(e,t,r){return t===void 0&&(t=0),new this.schedulerActionCtor(this,e).schedule(r,t)},n.now=qc.now,n}(),$o=function(n){bt(e,n);function e(t,r){r===void 0&&(r=hh.now);var i=n.call(this,t,r)||this;return i.actions=[],i._active=!1,i}return e.prototype.flush=function(t){var r=this.actions;if(this._active){r.push(t);return}var i;this._active=!0;do if(i=t.execute(t.state,t.delay))break;while(t=r.shift());if(this._active=!1,i){for(;t=r.shift();)t.unsubscribe();throw i}},e}(hh),jI=function(n){bt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.flush=function(t){this._active=!0;var r=this._scheduled;this._scheduled=void 0;var i=this.actions,s;t=t||i.shift();do if(s=t.execute(t.state,t.delay))break;while((t=i[0])&&t.id===r&&i.shift());if(this._active=!1,s){for(;(t=i[0])&&t.id===r&&i.shift();)t.unsubscribe();throw s}},e}($o),Vb=new jI(NI),BI=Vb,Fn=new $o(So),zf=Fn,LI=function(n){bt(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.scheduler=t,i.work=r,i}return e.prototype.schedule=function(t,r){return r===void 0&&(r=0),r>0?n.prototype.schedule.call(this,t,r):(this.delay=r,this.state=t,this.scheduler.flush(this),this)},e.prototype.execute=function(t,r){return r>0||this.closed?n.prototype.execute.call(this,t,r):this._execute(t,r)},e.prototype.requestAsyncId=function(t,r,i){return i===void 0&&(i=0),i!=null&&i>0||i==null&&this.delay>0?n.prototype.requestAsyncId.call(this,t,r,i):(t.flush(this),0)},e}(So),DI=function(n){bt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e}($o),Kb=new DI(LI),UI=Kb,FI=function(n){bt(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.scheduler=t,i.work=r,i}return e.prototype.requestAsyncId=function(t,r,i){return i===void 0&&(i=0),i!==null&&i>0?n.prototype.requestAsyncId.call(this,t,r,i):(t.actions.push(this),t._scheduled||(t._scheduled=io.requestAnimationFrame(function(){return t.flush(void 0)})))},e.prototype.recycleAsyncId=function(t,r,i){var s;if(i===void 0&&(i=0),i!=null?i>0:this.delay>0)return n.prototype.recycleAsyncId.call(this,t,r,i);var o=t.actions;r!=null&&((s=o[o.length-1])===null||s===void 0?void 0:s.id)!==r&&(io.cancelAnimationFrame(r),t._scheduled=void 0)},e}(So),MI=function(n){bt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.flush=function(t){this._active=!0;var r=this._scheduled;this._scheduled=void 0;var i=this.actions,s;t=t||i.shift();do if(s=t.execute(t.state,t.delay))break;while((t=i[0])&&t.id===r&&i.shift());if(this._active=!1,s){for(;(t=i[0])&&t.id===r&&i.shift();)t.unsubscribe();throw s}},e}($o),Wb=new MI(FI),qI=Wb,VI=function(n){bt(e,n);function e(t,r){t===void 0&&(t=zb),r===void 0&&(r=1/0);var i=n.call(this,t,function(){return i.frame})||this;return i.maxFrames=r,i.frame=0,i.index=-1,i}return e.prototype.flush=function(){for(var t=this,r=t.actions,i=t.maxFrames,s,o;(o=r[0])&&o.delay<=i&&(r.shift(),this.frame=o.delay,!(s=o.execute(o.state,o.delay))););if(s){for(;o=r.shift();)o.unsubscribe();throw s}},e.frameTimeFactor=10,e}($o),zb=function(n){bt(e,n);function e(t,r,i){i===void 0&&(i=t.index+=1);var s=n.call(this,t,r)||this;return s.scheduler=t,s.work=r,s.index=i,s.active=!0,s.index=t.index=i,s}return e.prototype.schedule=function(t,r){if(r===void 0&&(r=0),Number.isFinite(r)){if(!this.id)return n.prototype.schedule.call(this,t,r);this.active=!1;var i=new e(this.scheduler,this.work);return this.add(i),i.schedule(t,r)}else return yn.EMPTY},e.prototype.requestAsyncId=function(t,r,i){i===void 0&&(i=0),this.delay=t.frame+i;var s=t.actions;return s.push(this),s.sort(e.sortActions),1},e.prototype.recycleAsyncId=function(t,r,i){},e.prototype._execute=function(t,r){if(this.active===!0)return n.prototype._execute.call(this,t,r)},e.sortActions=function(t,r){return t.delay===r.delay?t.index===r.index?0:t.index>r.index?1:-1:t.delay>r.delay?1:-1},e}(So),mr=new Me(function(n){return n.complete()});function KI(n){return n?WI(n):mr}function WI(n){return new Me(function(e){return n.schedule(function(){return e.complete()})})}function Vc(n){return n&&Re(n.schedule)}function Hf(n){return n[n.length-1]}function To(n){return Re(Hf(n))?n.pop():void 0}function Rr(n){return Vc(Hf(n))?n.pop():void 0}function Hb(n,e){return typeof Hf(n)=="number"?n.pop():e}var Jf=function(n){return n&&typeof n.length=="number"&&typeof n!="function"};function Jb(n){return Re(n==null?void 0:n.then)}function Yb(n){return Re(n[Fc])}function Gb(n){return Symbol.asyncIterator&&Re(n==null?void 0:n[Symbol.asyncIterator])}function Qb(n){return new TypeError("You provided "+(n!==null&&typeof n=="object"?"an invalid object":"'"+n+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function zI(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Xb=zI();function Zb(n){return Re(n==null?void 0:n[Xb])}function e0(n){return gI(this,arguments,function(){var e,t,r,i;return Uf(this,function(s){switch(s.label){case 0:e=n.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,is(e.read())];case 3:return t=s.sent(),r=t.value,i=t.done,i?[4,is(void 0)]:[3,5];case 4:return[2,s.sent()];case 5:return[4,is(r)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function t0(n){return Re(n==null?void 0:n.getReader)}function Oe(n){if(n instanceof Me)return n;if(n!=null){if(Yb(n))return HI(n);if(Jf(n))return JI(n);if(Jb(n))return YI(n);if(Gb(n))return n0(n);if(Zb(n))return GI(n);if(t0(n))return QI(n)}throw Qb(n)}function HI(n){return new Me(function(e){var t=n[Fc]();if(Re(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function JI(n){return new Me(function(e){for(var t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}function YI(n){return new Me(function(e){n.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,Nb)})}function GI(n){return new Me(function(e){var t,r;try{for(var i=un(n),s=i.next();!s.done;s=i.next()){var o=s.value;if(e.next(o),e.closed)return}}catch(a){t={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}e.complete()})}function n0(n){return new Me(function(e){XI(n,e).catch(function(t){return e.error(t)})})}function QI(n){return n0(e0(n))}function XI(n,e){var t,r,i,s;return yI(this,void 0,void 0,function(){var o,a;return Uf(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),t=mI(n),c.label=1;case 1:return[4,t.next()];case 2:if(r=c.sent(),!!r.done)return[3,4];if(o=r.value,e.next(o),e.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),i={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),r&&!r.done&&(s=t.return)?[4,s.call(t)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function hn(n,e,t,r,i){r===void 0&&(r=0),i===void 0&&(i=!1);var s=e.schedule(function(){t(),i?n.add(this.schedule(null,r)):this.unsubscribe()},r);if(n.add(s),!i)return s}function Kc(n,e){return e===void 0&&(e=0),ge(function(t,r){t.subscribe(fe(r,function(i){return hn(r,n,function(){return r.next(i)},e)},function(){return hn(r,n,function(){return r.complete()},e)},function(i){return hn(r,n,function(){return r.error(i)},e)}))})}function Wc(n,e){return e===void 0&&(e=0),ge(function(t,r){r.add(n.schedule(function(){return t.subscribe(r)},e))})}function ZI(n,e){return Oe(n).pipe(Wc(e),Kc(e))}function eR(n,e){return Oe(n).pipe(Wc(e),Kc(e))}function tR(n,e){return new Me(function(t){var r=0;return e.schedule(function(){r===n.length?t.complete():(t.next(n[r++]),t.closed||this.schedule())})})}function r0(n,e){return new Me(function(t){var r;return hn(t,e,function(){r=n[Xb](),hn(t,e,function(){var i,s,o;try{i=r.next(),s=i.value,o=i.done}catch(a){t.error(a);return}o?t.complete():t.next(s)},0,!0)}),function(){return Re(r==null?void 0:r.return)&&r.return()}})}function i0(n,e){if(!n)throw new Error("Iterable cannot be null");return new Me(function(t){hn(t,e,function(){var r=n[Symbol.asyncIterator]();hn(t,e,function(){r.next().then(function(i){i.done?t.complete():t.next(i.value)})},0,!0)})})}function nR(n,e){return i0(e0(n),e)}function s0(n,e){if(n!=null){if(Yb(n))return ZI(n,e);if(Jf(n))return tR(n,e);if(Jb(n))return eR(n,e);if(Gb(n))return i0(n,e);if(Zb(n))return r0(n,e);if(t0(n))return nR(n,e)}throw Qb(n)}function Cr(n,e){return e?s0(n,e):Oe(n)}function Yf(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Rr(n);return Cr(n,t)}function o0(n,e){var t=Re(n)?n:function(){return n},r=function(i){return i.error(t())};return new Me(e?function(i){return e.schedule(r,0,i)}:r)}var fh;(function(n){n.NEXT="N",n.ERROR="E",n.COMPLETE="C"})(fh||(fh={}));var Ia=function(){function n(e,t,r){this.kind=e,this.value=t,this.error=r,this.hasValue=e==="N"}return n.prototype.observe=function(e){return a0(this,e)},n.prototype.do=function(e,t,r){var i=this,s=i.kind,o=i.value,a=i.error;return s==="N"?e==null?void 0:e(o):s==="E"?t==null?void 0:t(a):r==null?void 0:r()},n.prototype.accept=function(e,t,r){var i;return Re((i=e)===null||i===void 0?void 0:i.next)?this.observe(e):this.do(e,t,r)},n.prototype.toObservable=function(){var e=this,t=e.kind,r=e.value,i=e.error,s=t==="N"?Yf(r):t==="E"?o0(function(){return i}):t==="C"?mr:0;if(!s)throw new TypeError("Unexpected notification kind "+t);return s},n.createNext=function(e){return new n("N",e)},n.createError=function(e){return new n("E",void 0,e)},n.createComplete=function(){return n.completeNotification},n.completeNotification=new n("C"),n}();function a0(n,e){var t,r,i,s=n,o=s.kind,a=s.value,c=s.error;if(typeof o!="string")throw new TypeError('Invalid notification, missing "kind"');o==="N"?(t=e.next)===null||t===void 0||t.call(e,a):o==="E"?(r=e.error)===null||r===void 0||r.call(e,c):(i=e.complete)===null||i===void 0||i.call(e)}function rR(n){return!!n&&(n instanceof Me||Re(n.lift)&&Re(n.subscribe))}var Fi=Ui(function(n){return function(){n(this),this.name="EmptyError",this.message="no elements in sequence"}});function iR(n,e){var t=typeof e=="object";return new Promise(function(r,i){var s=!1,o;n.subscribe({next:function(a){o=a,s=!0},error:i,complete:function(){s?r(o):t?r(e.defaultValue):i(new Fi)}})})}function sR(n,e){var t=typeof e=="object";return new Promise(function(r,i){var s=new ps({next:function(o){r(o),s.unsubscribe()},error:i,complete:function(){t?r(e.defaultValue):i(new Fi)}});n.subscribe(s)})}var dh=Ui(function(n){return function(){n(this),this.name="ArgumentOutOfRangeError",this.message="argument out of range"}}),c0=Ui(function(n){return function(e){n(this),this.name="NotFoundError",this.message=e}}),l0=Ui(function(n){return function(e){n(this),this.name="SequenceError",this.message=e}});function Gf(n){return n instanceof Date&&!isNaN(n)}var u0=Ui(function(n){return function(e){e===void 0&&(e=null),n(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=e}});function h0(n,e){var t=Gf(n)?{first:n}:typeof n=="number"?{each:n}:n,r=t.first,i=t.each,s=t.with,o=s===void 0?oR:s,a=t.scheduler,c=a===void 0?e!=null?e:Fn:a,l=t.meta,u=l===void 0?null:l;if(r==null&&i==null)throw new TypeError("No timeout provided.");return ge(function(h,p){var f,d,y=null,_=0,S=function(I){d=hn(p,c,function(){try{f.unsubscribe(),Oe(o({meta:u,lastValue:y,seen:_})).subscribe(p)}catch(B){p.error(B)}},I)};f=h.subscribe(fe(p,function(I){d==null||d.unsubscribe(),_++,p.next(y=I),i>0&&S(i)},void 0,void 0,function(){d!=null&&d.closed||d==null||d.unsubscribe(),y=null})),!_&&S(r!=null?typeof r=="number"?r:+r-c.now():i)})}function oR(n){throw new u0(n)}function Mi(n,e){return ge(function(t,r){var i=0;t.subscribe(fe(r,function(s){r.next(n.call(e,s,i++))}))})}var aR=Array.isArray;function cR(n,e){return aR(e)?n.apply(void 0,Xe([],Qe(e))):n(e)}function qi(n){return Mi(function(e){return cR(n,e)})}function tc(n,e,t,r){if(t)if(Vc(t))r=t;else return function(){for(var i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];return tc(n,e,r).apply(this,i).pipe(qi(t))};return r?function(){for(var i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];return tc(n,e).apply(this,i).pipe(Wc(r),Kc(r))}:function(){for(var i=this,s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];var a=new Wf,c=!0;return new Me(function(l){var u=a.subscribe(l);if(c){c=!1;var h=!1,p=!1;e.apply(i,Xe(Xe([],Qe(s)),[function(){for(var f=[],d=0;d<arguments.length;d++)f[d]=arguments[d];if(n){var y=f.shift();if(y!=null){a.error(y);return}}a.next(1<f.length?f:f[0]),p=!0,h&&a.complete()}])),p&&a.complete(),h=!0}return u})}}function lR(n,e,t){return tc(!1,n,e,t)}function uR(n,e,t){return tc(!0,n,e,t)}var hR=Array.isArray,fR=Object.getPrototypeOf,dR=Object.prototype,pR=Object.keys;function f0(n){if(n.length===1){var e=n[0];if(hR(e))return{args:e,keys:null};if(yR(e)){var t=pR(e);return{args:t.map(function(r){return e[r]}),keys:t}}}return{args:n,keys:null}}function yR(n){return n&&typeof n=="object"&&fR(n)===dR}function d0(n,e){return n.reduce(function(t,r,i){return t[r]=e[i],t},{})}function p0(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Rr(n),r=To(n),i=f0(n),s=i.args,o=i.keys;if(s.length===0)return Cr([],t);var a=new Me(y0(s,t,o?function(c){return d0(o,c)}:It));return r?a.pipe(qi(r)):a}function y0(n,e,t){return t===void 0&&(t=It),function(r){Ey(e,function(){for(var i=n.length,s=new Array(i),o=i,a=i,c=function(u){Ey(e,function(){var h=Cr(n[u],e),p=!1;h.subscribe(fe(r,function(f){s[u]=f,p||(p=!0,a--),a||r.next(t(s.slice()))},function(){--o||r.complete()}))},r)},l=0;l<i;l++)c(l)},r)}}function Ey(n,e,t){n?hn(t,n,e):e()}function Qf(n,e,t,r,i,s,o,a){var c=[],l=0,u=0,h=!1,p=function(){h&&!c.length&&!l&&e.complete()},f=function(y){return l<r?d(y):c.push(y)},d=function(y){s&&e.next(y),l++;var _=!1;Oe(t(y,u++)).subscribe(fe(e,function(S){i==null||i(S),s?f(S):e.next(S)},function(){_=!0},void 0,function(){if(_)try{l--;for(var S=function(){var I=c.shift();o?hn(e,o,function(){return d(I)}):d(I)};c.length&&l<r;)S();p()}catch(I){e.error(I)}}))};return n.subscribe(fe(e,f,function(){h=!0,p()})),function(){a==null||a()}}function Qn(n,e,t){return t===void 0&&(t=1/0),Re(e)?Qn(function(r,i){return Mi(function(s,o){return e(r,s,i,o)})(Oe(n(r,i)))},t):(typeof e=="number"&&(t=e),ge(function(r,i){return Qf(r,i,n,t)}))}function zc(n){return n===void 0&&(n=1/0),Qn(It,n)}function Xf(){return zc(1)}function so(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return Xf()(Cr(n,Rr(n)))}function Hc(n){return new Me(function(e){Oe(n()).subscribe(e)})}var gR={connector:function(){return new _t},resetOnDisconnect:!0};function mR(n,e){e===void 0&&(e=gR);var t=null,r=e.connector,i=e.resetOnDisconnect,s=i===void 0?!0:i,o=r(),a=new Me(function(c){return o.subscribe(c)});return a.connect=function(){return(!t||t.closed)&&(t=Hc(function(){return n}).subscribe(o),s&&t.add(function(){return o=r()})),t},a}function vR(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=To(n),r=f0(n),i=r.args,s=r.keys,o=new Me(function(a){var c=i.length;if(!c){a.complete();return}for(var l=new Array(c),u=c,h=c,p=function(d){var y=!1;Oe(i[d]).subscribe(fe(a,function(_){y||(y=!0,h--),l[d]=_},function(){return u--},void 0,function(){(!u||!y)&&(h||a.next(s?d0(s,l):l),a.complete())}))},f=0;f<c;f++)p(f)});return t?o.pipe(qi(t)):o}var bR=["addListener","removeListener"],wR=["addEventListener","removeEventListener"],kR=["on","off"];function ph(n,e,t,r){if(Re(t)&&(r=t,t=void 0),r)return ph(n,e,t).pipe(qi(r));var i=Qe(_R(n)?wR.map(function(a){return function(c){return n[a](e,c,t)}}):xR(n)?bR.map(_y(n,e)):ER(n)?kR.map(_y(n,e)):[],2),s=i[0],o=i[1];if(!s&&Jf(n))return Qn(function(a){return ph(a,e,t)})(Oe(n));if(!s)throw new TypeError("Invalid event target");return new Me(function(a){var c=function(){for(var l=[],u=0;u<arguments.length;u++)l[u]=arguments[u];return a.next(1<l.length?l:l[0])};return s(c),function(){return o(c)}})}function _y(n,e){return function(t){return function(r){return n[t](e,r)}}}function xR(n){return Re(n.addListener)&&Re(n.removeListener)}function ER(n){return Re(n.on)&&Re(n.off)}function _R(n){return Re(n.addEventListener)&&Re(n.removeEventListener)}function g0(n,e,t){return t?g0(n,e).pipe(qi(t)):new Me(function(r){var i=function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];return r.next(o.length===1?o[0]:o)},s=n(i);return Re(e)?function(){return e(i,s)}:void 0})}function AR(n,e,t,r,i){var s,o,a,c;arguments.length===1?(s=n,c=s.initialState,e=s.condition,t=s.iterate,o=s.resultSelector,a=o===void 0?It:o,i=s.scheduler):(c=n,!r||Vc(r)?(a=It,i=r):a=r);function l(){var u;return Uf(this,function(h){switch(h.label){case 0:u=c,h.label=1;case 1:return!e||e(u)?[4,a(u)]:[3,4];case 2:h.sent(),h.label=3;case 3:return u=t(u),[3,1];case 4:return[2]}})}return Hc(i?function(){return r0(l(),i)}:l)}function OR(n,e,t){return Hc(function(){return n()?e:t})}function Vi(n,e,t){n===void 0&&(n=0),t===void 0&&(t=zf);var r=-1;return e!=null&&(Vc(e)?t=e:r=e),new Me(function(i){var s=Gf(n)?+n-t.now():n;s<0&&(s=0);var o=0;return t.schedule(function(){i.closed||(i.next(o++),0<=r?this.schedule(void 0,r):i.complete())},s)})}function m0(n,e){return n===void 0&&(n=0),e===void 0&&(e=Fn),n<0&&(n=0),Vi(n,n,e)}function SR(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Rr(n),r=Hb(n,1/0),i=n;return i.length?i.length===1?Oe(i[0]):zc(r)(Cr(i,t)):mr}var v0=new Me(gt);function $R(){return v0}var TR=Array.isArray;function Es(n){return n.length===1&&TR(n[0])?n[0]:n}function b0(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Es(n);return new Me(function(r){var i=0,s=function(){if(i<t.length){var o=void 0;try{o=Oe(t[i++])}catch(c){s();return}var a=new Vf(r,void 0,gt,gt);o.subscribe(a),a.add(s)}else r.complete()};s()})}function PR(n,e){return Cr(Object.entries(n),e)}function IR(n,e){return function(t,r){return!n.call(e,t,r)}}function Ri(n,e){return ge(function(t,r){var i=0;t.subscribe(fe(r,function(s){return n.call(e,s,i++)&&r.next(s)}))})}function RR(n,e,t){return[Ri(e,t)(Oe(n)),Ri(IR(e,t))(Oe(n))]}function CR(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return n=Es(n),n.length===1?Oe(n[0]):new Me(w0(n))}function w0(n){return function(e){for(var t=[],r=function(s){t.push(Oe(n[s]).subscribe(fe(e,function(o){if(t){for(var a=0;a<t.length;a++)a!==s&&t[a].unsubscribe();t=null}e.next(o)})))},i=0;t&&!e.closed&&i<n.length;i++)r(i)}}function NR(n,e,t){if(e==null&&(e=n,n=0),e<=0)return mr;var r=e+n;return new Me(t?function(i){var s=n;return t.schedule(function(){s<r?(i.next(s++),this.schedule()):i.complete()})}:function(i){for(var s=n;s<r&&!i.closed;)i.next(s++);i.complete()})}function jR(n,e){return new Me(function(t){var r=n(),i=e(r),s=i?Oe(i):mr;return s.subscribe(t),function(){r&&r.unsubscribe()}})}function Zf(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=To(n),r=Es(n);return r.length?new Me(function(i){var s=r.map(function(){return[]}),o=r.map(function(){return!1});i.add(function(){s=o=null});for(var a=function(l){Oe(r[l]).subscribe(fe(i,function(u){if(s[l].push(u),s.every(function(p){return p.length})){var h=s.map(function(p){return p.shift()});i.next(t?t.apply(void 0,Xe([],Qe(h))):h),s.some(function(p,f){return!p.length&&o[f]})&&i.complete()}},function(){o[l]=!0,!s[l].length&&i.complete()}))},c=0;!i.closed&&c<r.length;c++)a(c);return function(){s=o=null}}):mr}function k0(n){return ge(function(e,t){var r=!1,i=null,s=null,o=!1,a=function(){if(s==null||s.unsubscribe(),s=null,r){r=!1;var l=i;i=null,t.next(l)}o&&t.complete()},c=function(){s=null,o&&t.complete()};e.subscribe(fe(t,function(l){r=!0,i=l,s||Oe(n(l)).subscribe(s=fe(t,a,c))},function(){o=!0,(!r||!s||s.closed)&&t.complete()}))})}function BR(n,e){return e===void 0&&(e=Fn),k0(function(){return Vi(n,e)})}function LR(n){return ge(function(e,t){var r=[];return e.subscribe(fe(t,function(i){return r.push(i)},function(){t.next(r),t.complete()})),Oe(n).subscribe(fe(t,function(){var i=r;r=[],t.next(i)},gt)),function(){r=null}})}function DR(n,e){return e===void 0&&(e=null),e=e!=null?e:n,ge(function(t,r){var i=[],s=0;t.subscribe(fe(r,function(o){var a,c,l,u,h=null;s++%e===0&&i.push([]);try{for(var p=un(i),f=p.next();!f.done;f=p.next()){var d=f.value;d.push(o),n<=d.length&&(h=h!=null?h:[],h.push(d))}}catch(S){a={error:S}}finally{try{f&&!f.done&&(c=p.return)&&c.call(p)}finally{if(a)throw a.error}}if(h)try{for(var y=un(h),_=y.next();!_.done;_=y.next()){var d=_.value;$r(i,d),r.next(d)}}catch(S){l={error:S}}finally{try{_&&!_.done&&(u=y.return)&&u.call(y)}finally{if(l)throw l.error}}},function(){var o,a;try{for(var c=un(i),l=c.next();!l.done;l=c.next()){var u=l.value;r.next(u)}}catch(h){o={error:h}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(o)throw o.error}}r.complete()},void 0,function(){i=null}))})}function UR(n){for(var e,t,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];var s=(e=Rr(r))!==null&&e!==void 0?e:Fn,o=(t=r[0])!==null&&t!==void 0?t:null,a=r[1]||1/0;return ge(function(c,l){var u=[],h=!1,p=function(y){var _=y.buffer,S=y.subs;S.unsubscribe(),$r(u,y),l.next(_),h&&f()},f=function(){if(u){var y=new yn;l.add(y);var _=[],S={buffer:_,subs:y};u.push(S),hn(y,s,function(){return p(S)},n)}};o!==null&&o>=0?hn(l,s,f,o,!0):h=!0,f();var d=fe(l,function(y){var _,S,I=u.slice();try{for(var B=un(I),j=B.next();!j.done;j=B.next()){var U=j.value,M=U.buffer;M.push(y),a<=M.length&&p(U)}}catch(H){_={error:H}}finally{try{j&&!j.done&&(S=B.return)&&S.call(B)}finally{if(_)throw _.error}}},function(){for(;u!=null&&u.length;)l.next(u.shift().buffer);d==null||d.unsubscribe(),l.complete(),l.unsubscribe()},void 0,function(){return u=null});c.subscribe(d)})}function FR(n,e){return ge(function(t,r){var i=[];Oe(n).subscribe(fe(r,function(s){var o=[];i.push(o);var a=new yn,c=function(){$r(i,o),r.next(o),a.unsubscribe()};a.add(Oe(e(s)).subscribe(fe(r,c,gt)))},gt)),t.subscribe(fe(r,function(s){var o,a;try{for(var c=un(i),l=c.next();!l.done;l=c.next()){var u=l.value;u.push(s)}}catch(h){o={error:h}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(o)throw o.error}}},function(){for(;i.length>0;)r.next(i.shift());r.complete()}))})}function MR(n){return ge(function(e,t){var r=null,i=null,s=function(){i==null||i.unsubscribe();var o=r;r=[],o&&t.next(o),Oe(n()).subscribe(i=fe(t,s,gt))};s(),e.subscribe(fe(t,function(o){return r==null?void 0:r.push(o)},function(){r&&t.next(r),t.complete()},void 0,function(){return r=i=null}))})}function x0(n){return ge(function(e,t){var r=null,i=!1,s;r=e.subscribe(fe(t,void 0,void 0,function(o){s=Oe(n(o,x0(n)(e))),r?(r.unsubscribe(),r=null,s.subscribe(t)):i=!0})),i&&(r.unsubscribe(),r=null,s.subscribe(t))})}function E0(n,e,t,r,i){return function(s,o){var a=t,c=e,l=0;s.subscribe(fe(o,function(u){var h=l++;c=a?n(c,u,h):(a=!0,u),r&&o.next(c)},i&&function(){a&&o.next(c),o.complete()}))}}function Po(n,e){return ge(E0(n,e,arguments.length>=2,!1,!0))}var qR=function(n,e){return n.push(e),n};function _0(){return ge(function(n,e){Po(qR,[])(n).subscribe(e)})}function A0(n,e){return qf(_0(),Qn(function(t){return n(t)}),e?qi(e):It)}function O0(n){return A0(p0,n)}var VR=O0;function S0(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=To(n);return t?qf(S0.apply(void 0,Xe([],Qe(n))),qi(t)):ge(function(r,i){y0(Xe([r],Qe(Es(n))))(i)})}function KR(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return S0.apply(void 0,Xe([],Qe(n)))}function yh(n,e){return Re(e)?Qn(n,e,1):Qn(n,1)}function WR(n,e){return Re(e)?yh(function(){return n},e):yh(function(){return n})}function zR(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Rr(n);return ge(function(r,i){Xf()(Cr(Xe([r],Qe(n)),t)).subscribe(i)})}function HR(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return zR.apply(void 0,Xe([],Qe(n)))}function JR(n){return new Me(function(e){return n.subscribe(e)})}var YR={connector:function(){return new _t}};function ed(n,e){e===void 0&&(e=YR);var t=e.connector;return ge(function(r,i){var s=t();Oe(n(JR(s))).subscribe(i),i.add(r.subscribe(s))})}function GR(n){return Po(function(e,t,r){return!n||n(t,r)?e+1:e},0)}function QR(n){return ge(function(e,t){var r=!1,i=null,s=null,o=function(){if(s==null||s.unsubscribe(),s=null,r){r=!1;var a=i;i=null,t.next(a)}};e.subscribe(fe(t,function(a){s==null||s.unsubscribe(),r=!0,i=a,s=fe(t,o,gt),Oe(n(a)).subscribe(s)},function(){o(),t.complete()},void 0,function(){i=s=null}))})}function XR(n,e){return e===void 0&&(e=Fn),ge(function(t,r){var i=null,s=null,o=null,a=function(){if(i){i.unsubscribe(),i=null;var l=s;s=null,r.next(l)}};function c(){var l=o+n,u=e.now();if(u<l){i=this.schedule(void 0,l-u),r.add(i);return}a()}t.subscribe(fe(r,function(l){s=l,o=e.now(),i||(i=e.schedule(c,n),r.add(i))},function(){a(),r.complete()},void 0,function(){s=i=null}))})}function Jc(n){return ge(function(e,t){var r=!1;e.subscribe(fe(t,function(i){r=!0,t.next(i)},function(){r||t.next(n),t.complete()}))})}function oo(n){return n<=0?function(){return mr}:ge(function(e,t){var r=0;e.subscribe(fe(t,function(i){++r<=n&&(t.next(i),n<=r&&t.complete())}))})}function $0(){return ge(function(n,e){n.subscribe(fe(e,gt))})}function T0(n){return Mi(function(){return n})}function td(n,e){return e?function(t){return so(e.pipe(oo(1),$0()),t.pipe(td(n)))}:Qn(function(t,r){return Oe(n(t,r)).pipe(oo(1),T0(t))})}function ZR(n,e){e===void 0&&(e=Fn);var t=Vi(n,e);return td(function(){return t})}function eC(){return ge(function(n,e){n.subscribe(fe(e,function(t){return a0(t,e)}))})}function tC(n,e){return ge(function(t,r){var i=new Set;t.subscribe(fe(r,function(s){var o=n?n(s):s;i.has(o)||(i.add(o),r.next(s))})),e&&Oe(e).subscribe(fe(r,function(){return i.clear()},gt))})}function P0(n,e){return e===void 0&&(e=It),n=n!=null?n:nC,ge(function(t,r){var i,s=!0;t.subscribe(fe(r,function(o){var a=e(o);(s||!n(i,a))&&(s=!1,i=a,r.next(o))}))})}function nC(n,e){return n===e}function rC(n,e){return P0(function(t,r){return e?e(t[n],r[n]):t[n]===r[n]})}function Yc(n){return n===void 0&&(n=iC),ge(function(e,t){var r=!1;e.subscribe(fe(t,function(i){r=!0,t.next(i)},function(){return r?t.complete():t.error(n())}))})}function iC(){return new Fi}function sC(n,e){if(n<0)throw new dh;var t=arguments.length>=2;return function(r){return r.pipe(Ri(function(i,s){return s===n}),oo(1),t?Jc(e):Yc(function(){return new dh}))}}function oC(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return function(t){return so(t,Yf.apply(void 0,Xe([],Qe(n))))}}function aC(n,e){return ge(function(t,r){var i=0;t.subscribe(fe(r,function(s){n.call(e,s,i++,t)||(r.next(!1),r.complete())},function(){r.next(!0),r.complete()}))})}function nd(n,e){return e?function(t){return t.pipe(nd(function(r,i){return Oe(n(r,i)).pipe(Mi(function(s,o){return e(r,s,i,o)}))}))}:ge(function(t,r){var i=0,s=null,o=!1;t.subscribe(fe(r,function(a){s||(s=fe(r,void 0,function(){s=null,o&&r.complete()}),Oe(n(a,i++)).subscribe(s))},function(){o=!0,!s&&r.complete()}))})}function I0(){return nd(It)}var cC=I0;function lC(n,e,t){return e===void 0&&(e=1/0),e=(e||0)<1?1/0:e,ge(function(r,i){return Qf(r,i,n,e,void 0,!0,t)})}function uC(n){return ge(function(e,t){try{e.subscribe(t)}finally{t.add(n)}})}function hC(n,e){return ge(R0(n,e,"value"))}function R0(n,e,t){var r=t==="index";return function(i,s){var o=0;i.subscribe(fe(s,function(a){var c=o++;n.call(e,a,c,i)&&(s.next(r?c:a),s.complete())},function(){s.next(r?-1:void 0),s.complete()}))}}function fC(n,e){return ge(R0(n,e,"index"))}function dC(n,e){var t=arguments.length>=2;return function(r){return r.pipe(n?Ri(function(i,s){return n(i,s,r)}):It,oo(1),t?Jc(e):Yc(function(){return new Fi}))}}function pC(n,e,t,r){return ge(function(i,s){var o;!e||typeof e=="function"?o=e:(t=e.duration,o=e.element,r=e.connector);var a=new Map,c=function(d){a.forEach(d),d(s)},l=function(d){return c(function(y){return y.error(d)})},u=0,h=!1,p=new Vf(s,function(d){try{var y=n(d),_=a.get(y);if(!_){a.set(y,_=r?r():new _t);var S=f(y,_);if(s.next(S),t){var I=fe(_,function(){_.complete(),I==null||I.unsubscribe()},void 0,void 0,function(){return a.delete(y)});p.add(Oe(t(S)).subscribe(I))}}_.next(o?o(d):d)}catch(B){l(B)}},function(){return c(function(d){return d.complete()})},l,function(){return a.clear()},function(){return h=!0,u===0});i.subscribe(p);function f(d,y){var _=new Me(function(S){u++;var I=y.subscribe(S);return function(){I.unsubscribe(),--u===0&&h&&p.unsubscribe()}});return _.key=d,_}})}function yC(){return ge(function(n,e){n.subscribe(fe(e,function(){e.next(!1),e.complete()},function(){e.next(!0),e.complete()}))})}function C0(n){return n<=0?function(){return mr}:ge(function(e,t){var r=[];e.subscribe(fe(t,function(i){r.push(i),n<r.length&&r.shift()},function(){var i,s;try{for(var o=un(r),a=o.next();!a.done;a=o.next()){var c=a.value;t.next(c)}}catch(l){i={error:l}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}t.complete()},void 0,function(){r=null}))})}function gC(n,e){var t=arguments.length>=2;return function(r){return r.pipe(n?Ri(function(i,s){return n(i,s,r)}):It,C0(1),t?Jc(e):Yc(function(){return new Fi}))}}function mC(){return ge(function(n,e){n.subscribe(fe(e,function(t){e.next(Ia.createNext(t))},function(){e.next(Ia.createComplete()),e.complete()},function(t){e.next(Ia.createError(t)),e.complete()}))})}function vC(n){return Po(Re(n)?function(e,t){return n(e,t)>0?e:t}:function(e,t){return e>t?e:t})}var bC=Qn;function wC(n,e,t){return t===void 0&&(t=1/0),Re(e)?Qn(function(){return n},e,t):(typeof e=="number"&&(t=e),Qn(function(){return n},t))}function kC(n,e,t){return t===void 0&&(t=1/0),ge(function(r,i){var s=e;return Qf(r,i,function(o,a){return n(s,o,a)},t,function(o){s=o},!1,void 0,function(){return s=null})})}function xC(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Rr(n),r=Hb(n,1/0);return n=Es(n),ge(function(i,s){zc(r)(Cr(Xe([i],Qe(n)),t)).subscribe(s)})}function EC(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return xC.apply(void 0,Xe([],Qe(n)))}function _C(n){return Po(Re(n)?function(e,t){return n(e,t)<0?e:t}:function(e,t){return e<t?e:t})}function rd(n,e){var t=Re(n)?n:function(){return n};return Re(e)?ed(e,{connector:t}):function(r){return new Mc(r,t)}}function AC(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Es(n);return function(r){return b0.apply(void 0,Xe([r],Qe(t)))}}function OC(){return ge(function(n,e){var t,r=!1;n.subscribe(fe(e,function(i){var s=t;t=i,r&&e.next([s,i]),r=!0}))})}function SC(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=n.length;if(t===0)throw new Error("list of properties cannot be empty.");return Mi(function(r){for(var i=r,s=0;s<t;s++){var o=i==null?void 0:i[n[s]];if(typeof o!="undefined")i=o;else return}return i})}function $C(n){return n?function(e){return ed(n)(e)}:function(e){return rd(new _t)(e)}}function TC(n){return function(e){var t=new Mb(n);return new Mc(e,function(){return t})}}function PC(){return function(n){var e=new Wf;return new Mc(n,function(){return e})}}function IC(n,e,t,r){t&&!Re(t)&&(r=t);var i=Re(t)?t:void 0;return function(s){return rd(new Kf(n,e,r),i)(s)}}function RC(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return n.length?ge(function(t,r){w0(Xe([t],Qe(n)))(r)}):It}function CC(n){var e,t=1/0,r;return n!=null&&(typeof n=="object"?(e=n.count,t=e===void 0?1/0:e,r=n.delay):t=n),t<=0?function(){return mr}:ge(function(i,s){var o=0,a,c=function(){if(a==null||a.unsubscribe(),a=null,r!=null){var u=typeof r=="number"?Vi(r):Oe(r(o)),h=fe(s,function(){h.unsubscribe(),l()});u.subscribe(h)}else l()},l=function(){var u=!1;a=i.subscribe(fe(s,void 0,function(){++o<t?a?c():u=!0:s.complete()})),u&&c()};l()})}function NC(n){return ge(function(e,t){var r,i=!1,s,o=!1,a=!1,c=function(){return a&&o&&(t.complete(),!0)},l=function(){return s||(s=new _t,Oe(n(s)).subscribe(fe(t,function(){r?u():i=!0},function(){o=!0,c()}))),s},u=function(){a=!1,r=e.subscribe(fe(t,void 0,function(){a=!0,!c()&&l().next()})),i&&(r.unsubscribe(),r=null,i=!1,u())};u()})}function jC(n){n===void 0&&(n=1/0);var e;n&&typeof n=="object"?e=n:e={count:n};var t=e.count,r=t===void 0?1/0:t,i=e.delay,s=e.resetOnSuccess,o=s===void 0?!1:s;return r<=0?It:ge(function(a,c){var l=0,u,h=function(){var p=!1;u=a.subscribe(fe(c,function(f){o&&(l=0),c.next(f)},void 0,function(f){if(l++<r){var d=function(){u?(u.unsubscribe(),u=null,h()):p=!0};if(i!=null){var y=typeof i=="number"?Vi(i):Oe(i(f,l)),_=fe(c,function(){_.unsubscribe(),d()},function(){c.complete()});y.subscribe(_)}else d()}else c.error(f)})),p&&(u.unsubscribe(),u=null,h())};h()})}function BC(n){return ge(function(e,t){var r,i=!1,s,o=function(){r=e.subscribe(fe(t,void 0,void 0,function(a){s||(s=new _t,Oe(n(s)).subscribe(fe(t,function(){return r?o():i=!0}))),s&&s.next(a)})),i&&(r.unsubscribe(),r=null,i=!1,o())};o()})}function N0(n){return ge(function(e,t){var r=!1,i=null;e.subscribe(fe(t,function(s){r=!0,i=s})),Oe(n).subscribe(fe(t,function(){if(r){r=!1;var s=i;i=null,t.next(s)}},gt))})}function LC(n,e){return e===void 0&&(e=Fn),N0(m0(n,e))}function DC(n,e){return ge(E0(n,e,arguments.length>=2,!0))}function UC(n,e){return e===void 0&&(e=function(t,r){return t===r}),ge(function(t,r){var i=Ay(),s=Ay(),o=function(c){r.next(c),r.complete()},a=function(c,l){var u=fe(r,function(h){var p=l.buffer,f=l.complete;p.length===0?f?o(!1):c.buffer.push(h):!e(h,p.shift())&&o(!1)},function(){c.complete=!0;var h=l.complete,p=l.buffer;h&&o(p.length===0),u==null||u.unsubscribe()});return u};t.subscribe(a(i,s)),Oe(n).subscribe(a(s,i))})}function Ay(){return{buffer:[],complete:!1}}function j0(n){n===void 0&&(n={});var e=n.connector,t=e===void 0?function(){return new _t}:e,r=n.resetOnError,i=r===void 0?!0:r,s=n.resetOnComplete,o=s===void 0?!0:s,a=n.resetOnRefCountZero,c=a===void 0?!0:a;return function(l){var u,h,p,f=0,d=!1,y=!1,_=function(){h==null||h.unsubscribe(),h=void 0},S=function(){_(),u=p=void 0,d=y=!1},I=function(){var B=u;S(),B==null||B.unsubscribe()};return ge(function(B,j){f++,!y&&!d&&_();var U=p=p!=null?p:t();j.add(function(){f--,f===0&&!y&&!d&&(h=Ql(I,c))}),U.subscribe(j),!u&&f>0&&(u=new ps({next:function(M){return U.next(M)},error:function(M){y=!0,_(),h=Ql(S,i,M),U.error(M)},complete:function(){d=!0,_(),h=Ql(S,o),U.complete()}}),Oe(B).subscribe(u))})(l)}}function Ql(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];if(e===!0){n();return}if(e!==!1){var i=new ps({next:function(){i.unsubscribe(),n()}});return Oe(e.apply(void 0,Xe([],Qe(t)))).subscribe(i)}}function FC(n,e,t){var r,i,s,o,a=!1;return n&&typeof n=="object"?(r=n.bufferSize,o=r===void 0?1/0:r,i=n.windowTime,e=i===void 0?1/0:i,s=n.refCount,a=s===void 0?!1:s,t=n.scheduler):o=n!=null?n:1/0,j0({connector:function(){return new Kf(o,e,t)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:a})}function MC(n){return ge(function(e,t){var r=!1,i,s=!1,o=0;e.subscribe(fe(t,function(a){s=!0,(!n||n(a,o++,e))&&(r&&t.error(new l0("Too many matching values")),r=!0,i=a)},function(){r?(t.next(i),t.complete()):t.error(s?new c0("No matching values"):new Fi)}))})}function qC(n){return Ri(function(e,t){return n<=t})}function VC(n){return n<=0?It:ge(function(e,t){var r=new Array(n),i=0;return e.subscribe(fe(t,function(s){var o=i++;if(o<n)r[o]=s;else{var a=o%n,c=r[a];r[a]=s,t.next(c)}})),function(){r=null}})}function KC(n){return ge(function(e,t){var r=!1,i=fe(t,function(){i==null||i.unsubscribe(),r=!0},gt);Oe(n).subscribe(i),e.subscribe(fe(t,function(s){return r&&t.next(s)}))})}function WC(n){return ge(function(e,t){var r=!1,i=0;e.subscribe(fe(t,function(s){return(r||(r=!n(s,i++)))&&t.next(s)}))})}function zC(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Rr(n);return ge(function(r,i){(t?so(n,r,t):so(n,r)).subscribe(i)})}function ao(n,e){return ge(function(t,r){var i=null,s=0,o=!1,a=function(){return o&&!i&&r.complete()};t.subscribe(fe(r,function(c){i==null||i.unsubscribe();var l=0,u=s++;Oe(n(c,u)).subscribe(i=fe(r,function(h){return r.next(e?e(c,h,u,l++):h)},function(){i=null,a()}))},function(){o=!0,a()}))})}function HC(){return ao(It)}function JC(n,e){return Re(e)?ao(function(){return n},e):ao(function(){return n})}function YC(n,e){return ge(function(t,r){var i=e;return ao(function(s,o){return n(i,s,o)},function(s,o){return i=o,o})(t).subscribe(r),function(){i=null}})}function GC(n){return ge(function(e,t){Oe(n).subscribe(fe(t,function(){return t.complete()},gt)),!t.closed&&e.subscribe(t)})}function QC(n,e){return e===void 0&&(e=!1),ge(function(t,r){var i=0;t.subscribe(fe(r,function(s){var o=n(s,i++);(o||e)&&r.next(s),!o&&r.complete()}))})}function XC(n,e,t){var r=Re(n)||e||t?{next:n,error:e,complete:t}:n;return r?ge(function(i,s){var o;(o=r.subscribe)===null||o===void 0||o.call(r);var a=!0;i.subscribe(fe(s,function(c){var l;(l=r.next)===null||l===void 0||l.call(r,c),s.next(c)},function(){var c;a=!1,(c=r.complete)===null||c===void 0||c.call(r),s.complete()},function(c){var l;a=!1,(l=r.error)===null||l===void 0||l.call(r,c),s.error(c)},function(){var c,l;a&&((c=r.unsubscribe)===null||c===void 0||c.call(r)),(l=r.finalize)===null||l===void 0||l.call(r)}))}):It}function B0(n,e){return ge(function(t,r){var i=e!=null?e:{},s=i.leading,o=s===void 0?!0:s,a=i.trailing,c=a===void 0?!1:a,l=!1,u=null,h=null,p=!1,f=function(){h==null||h.unsubscribe(),h=null,c&&(_(),p&&r.complete())},d=function(){h=null,p&&r.complete()},y=function(S){return h=Oe(n(S)).subscribe(fe(r,f,d))},_=function(){if(l){l=!1;var S=u;u=null,r.next(S),!p&&y(S)}};t.subscribe(fe(r,function(S){l=!0,u=S,!(h&&!h.closed)&&(o?_():y(S))},function(){p=!0,!(c&&l&&h&&!h.closed)&&r.complete()}))})}function ZC(n,e,t){e===void 0&&(e=Fn);var r=Vi(n,e);return B0(function(){return r},t)}function eN(n){return n===void 0&&(n=Fn),ge(function(e,t){var r=n.now();e.subscribe(fe(t,function(i){var s=n.now(),o=s-r;r=s,t.next(new tN(i,o))}))})}var tN=function(){function n(e,t){this.value=e,this.interval=t}return n}();function nN(n,e,t){var r,i,s;if(t=t!=null?t:zf,Gf(n)?r=n:typeof n=="number"&&(i=n),e)s=function(){return e};else throw new TypeError("No observable provided to switch to");if(r==null&&i==null)throw new TypeError("No timeout provided.");return h0({first:r,each:i,scheduler:t,with:s})}function rN(n){return n===void 0&&(n=qc),Mi(function(e){return{value:e,timestamp:n.now()}})}function iN(n){return ge(function(e,t){var r=new _t;t.next(r.asObservable());var i=function(s){r.error(s),t.error(s)};return e.subscribe(fe(t,function(s){return r==null?void 0:r.next(s)},function(){r.complete(),t.complete()},i)),Oe(n).subscribe(fe(t,function(){r.complete(),t.next(r=new _t)},gt,i)),function(){r==null||r.unsubscribe(),r=null}})}function sN(n,e){e===void 0&&(e=0);var t=e>0?e:n;return ge(function(r,i){var s=[new _t],o=[],a=0;i.next(s[0].asObservable()),r.subscribe(fe(i,function(c){var l,u;try{for(var h=un(s),p=h.next();!p.done;p=h.next()){var f=p.value;f.next(c)}}catch(_){l={error:_}}finally{try{p&&!p.done&&(u=h.return)&&u.call(h)}finally{if(l)throw l.error}}var d=a-n+1;if(d>=0&&d%t===0&&s.shift().complete(),++a%t===0){var y=new _t;s.push(y),i.next(y.asObservable())}},function(){for(;s.length>0;)s.shift().complete();i.complete()},function(c){for(;s.length>0;)s.shift().error(c);i.error(c)},function(){o=null,s=null}))})}function oN(n){for(var e,t,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];var s=(e=Rr(r))!==null&&e!==void 0?e:Fn,o=(t=r[0])!==null&&t!==void 0?t:null,a=r[1]||1/0;return ge(function(c,l){var u=[],h=!1,p=function(_){var S=_.window,I=_.subs;S.complete(),I.unsubscribe(),$r(u,_),h&&f()},f=function(){if(u){var _=new yn;l.add(_);var S=new _t,I={window:S,subs:_,seen:0};u.push(I),l.next(S.asObservable()),hn(_,s,function(){return p(I)},n)}};o!==null&&o>=0?hn(l,s,f,o,!0):h=!0,f();var d=function(_){return u.slice().forEach(_)},y=function(_){d(function(S){var I=S.window;return _(I)}),_(l),l.unsubscribe()};return c.subscribe(fe(l,function(_){d(function(S){S.window.next(_),a<=++S.seen&&p(S)})},function(){return y(function(_){return _.complete()})},function(_){return y(function(S){return S.error(_)})})),function(){u=null}})}function aN(n,e){return ge(function(t,r){var i=[],s=function(o){for(;0<i.length;)i.shift().error(o);r.error(o)};Oe(n).subscribe(fe(r,function(o){var a=new _t;i.push(a);var c=new yn,l=function(){$r(i,a),a.complete(),c.unsubscribe()},u;try{u=Oe(e(o))}catch(h){s(h);return}r.next(a.asObservable()),c.add(u.subscribe(fe(r,l,gt,s)))},gt)),t.subscribe(fe(r,function(o){var a,c,l=i.slice();try{for(var u=un(l),h=u.next();!h.done;h=u.next()){var p=h.value;p.next(o)}}catch(f){a={error:f}}finally{try{h&&!h.done&&(c=u.return)&&c.call(u)}finally{if(a)throw a.error}}},function(){for(;0<i.length;)i.shift().complete();r.complete()},s,function(){for(;0<i.length;)i.shift().unsubscribe()}))})}function cN(n){return ge(function(e,t){var r,i,s=function(a){r.error(a),t.error(a)},o=function(){i==null||i.unsubscribe(),r==null||r.complete(),r=new _t,t.next(r.asObservable());var a;try{a=Oe(n())}catch(c){s(c);return}a.subscribe(i=fe(t,o,o,s))};o(),e.subscribe(fe(t,function(a){return r.next(a)},function(){r.complete(),t.complete()},s,function(){i==null||i.unsubscribe(),r=null}))})}function lN(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=To(n);return ge(function(r,i){for(var s=n.length,o=new Array(s),a=n.map(function(){return!1}),c=!1,l=function(h){Oe(n[h]).subscribe(fe(i,function(p){o[h]=p,!c&&!a[h]&&(a[h]=!0,(c=a.every(It))&&(a=null))},gt))},u=0;u<s;u++)l(u);r.subscribe(fe(i,function(h){if(c){var p=Xe([h],Qe(o));i.next(t?t.apply(void 0,Xe([],Qe(p))):p)}}))})}function uN(n){return A0(Zf,n)}function hN(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return ge(function(t,r){Zf.apply(void 0,Xe([t],Qe(n))).subscribe(r)})}function fN(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return hN.apply(void 0,Xe([],Qe(n)))}const dN=Object.freeze(Object.defineProperty({__proto__:null,Observable:Me,ConnectableObservable:Mc,observable:Fc,animationFrames:$I,Subject:_t,BehaviorSubject:Mb,ReplaySubject:Kf,AsyncSubject:Wf,asap:BI,asapScheduler:Vb,async:zf,asyncScheduler:Fn,queue:UI,queueScheduler:Kb,animationFrame:qI,animationFrameScheduler:Wb,VirtualTimeScheduler:VI,VirtualAction:zb,Scheduler:hh,Subscription:yn,Subscriber:Uc,Notification:Ia,get NotificationKind(){return fh},pipe:qf,noop:gt,identity:It,isObservable:rR,lastValueFrom:iR,firstValueFrom:sR,ArgumentOutOfRangeError:dh,EmptyError:Fi,NotFoundError:c0,ObjectUnsubscribedError:Fb,SequenceError:l0,TimeoutError:u0,UnsubscriptionError:Ta,bindCallback:lR,bindNodeCallback:uR,combineLatest:p0,concat:so,connectable:mR,defer:Hc,empty:KI,forkJoin:vR,from:Cr,fromEvent:ph,fromEventPattern:g0,generate:AR,iif:OR,interval:m0,merge:SR,never:$R,of:Yf,onErrorResumeNext:b0,pairs:PR,partition:RR,race:CR,range:NR,throwError:o0,timer:Vi,using:jR,zip:Zf,scheduled:s0,EMPTY:mr,NEVER:v0,config:yi,audit:k0,auditTime:BR,buffer:LR,bufferCount:DR,bufferTime:UR,bufferToggle:FR,bufferWhen:MR,catchError:x0,combineAll:VR,combineLatestAll:O0,combineLatestWith:KR,concatAll:Xf,concatMap:yh,concatMapTo:WR,concatWith:HR,connect:ed,count:GR,debounce:QR,debounceTime:XR,defaultIfEmpty:Jc,delay:ZR,delayWhen:td,dematerialize:eC,distinct:tC,distinctUntilChanged:P0,distinctUntilKeyChanged:rC,elementAt:sC,endWith:oC,every:aC,exhaust:cC,exhaustAll:I0,exhaustMap:nd,expand:lC,filter:Ri,finalize:uC,find:hC,findIndex:fC,first:dC,groupBy:pC,ignoreElements:$0,isEmpty:yC,last:gC,map:Mi,mapTo:T0,materialize:mC,max:vC,mergeAll:zc,flatMap:bC,mergeMap:Qn,mergeMapTo:wC,mergeScan:kC,mergeWith:EC,min:_C,multicast:rd,observeOn:Kc,onErrorResumeNextWith:AC,pairwise:OC,pluck:SC,publish:$C,publishBehavior:TC,publishLast:PC,publishReplay:IC,raceWith:RC,reduce:Po,repeat:CC,repeatWhen:NC,retry:jC,retryWhen:BC,refCount:Lb,sample:N0,sampleTime:LC,scan:DC,sequenceEqual:UC,share:j0,shareReplay:FC,single:MC,skip:qC,skipLast:VC,skipUntil:KC,skipWhile:WC,startWith:zC,subscribeOn:Wc,switchAll:HC,switchMap:ao,switchMapTo:JC,switchScan:YC,take:oo,takeLast:C0,takeUntil:GC,takeWhile:QC,tap:XC,throttle:B0,throttleTime:ZC,throwIfEmpty:Yc,timeInterval:eN,timeout:h0,timeoutWith:nN,timestamp:rN,toArray:_0,window:iN,windowCount:sN,windowTime:oN,windowToggle:aN,windowWhen:cN,withLatestFrom:lN,zipAll:uN,zipWith:fN},Symbol.toStringTag,{value:"Module"})),dr=Object.create(null);dr.open="0";dr.close="1";dr.ping="2";dr.pong="3";dr.message="4";dr.upgrade="5";dr.noop="6";const Ra=Object.create(null);Object.keys(dr).forEach(n=>{Ra[dr[n]]=n});const pN={type:"error",data:"parser error"},yN=typeof Blob=="function"||typeof Blob!="undefined"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",gN=typeof ArrayBuffer=="function",mN=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n&&n.buffer instanceof ArrayBuffer,L0=({type:n,data:e},t,r)=>yN&&e instanceof Blob?t?r(e):Oy(e,r):gN&&(e instanceof ArrayBuffer||mN(e))?t?r(e):Oy(new Blob([e]),r):r(dr[n]+(e||"")),Oy=(n,e)=>{const t=new FileReader;return t.onload=function(){const r=t.result.split(",")[1];e("b"+(r||""))},t.readAsDataURL(n)},Sy="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ws=typeof Uint8Array=="undefined"?[]:new Uint8Array(256);for(let n=0;n<Sy.length;n++)Ws[Sy.charCodeAt(n)]=n;const vN=n=>{let e=n.length*.75,t=n.length,r,i=0,s,o,a,c;n[n.length-1]==="="&&(e--,n[n.length-2]==="="&&e--);const l=new ArrayBuffer(e),u=new Uint8Array(l);for(r=0;r<t;r+=4)s=Ws[n.charCodeAt(r)],o=Ws[n.charCodeAt(r+1)],a=Ws[n.charCodeAt(r+2)],c=Ws[n.charCodeAt(r+3)],u[i++]=s<<2|o>>4,u[i++]=(o&15)<<4|a>>2,u[i++]=(a&3)<<6|c&63;return l},bN=typeof ArrayBuffer=="function",D0=(n,e)=>{if(typeof n!="string")return{type:"message",data:U0(n,e)};const t=n.charAt(0);return t==="b"?{type:"message",data:wN(n.substring(1),e)}:Ra[t]?n.length>1?{type:Ra[t],data:n.substring(1)}:{type:Ra[t]}:pN},wN=(n,e)=>{if(bN){const t=vN(n);return U0(t,e)}else return{base64:!0,data:n}},U0=(n,e)=>{switch(e){case"blob":return n instanceof ArrayBuffer?new Blob([n]):n;case"arraybuffer":default:return n}},F0=String.fromCharCode(30),kN=(n,e)=>{const t=n.length,r=new Array(t);let i=0;n.forEach((s,o)=>{L0(s,!1,a=>{r[o]=a,++i===t&&e(r.join(F0))})})},xN=(n,e)=>{const t=n.split(F0),r=[];for(let i=0;i<t.length;i++){const s=D0(t[i],e);if(r.push(s),s.type==="error")break}return r},M0=4;function pt(n){if(n)return EN(n)}function EN(n){for(var e in pt.prototype)n[e]=pt.prototype[e];return n}pt.prototype.on=pt.prototype.addEventListener=function(n,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+n]=this._callbacks["$"+n]||[]).push(e),this};pt.prototype.once=function(n,e){function t(){this.off(n,t),e.apply(this,arguments)}return t.fn=e,this.on(n,t),this};pt.prototype.off=pt.prototype.removeListener=pt.prototype.removeAllListeners=pt.prototype.removeEventListener=function(n,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+n];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+n],this;for(var r,i=0;i<t.length;i++)if(r=t[i],r===e||r.fn===e){t.splice(i,1);break}return t.length===0&&delete this._callbacks["$"+n],this};pt.prototype.emit=function(n){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+n],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(t){t=t.slice(0);for(var r=0,i=t.length;r<i;++r)t[r].apply(this,e)}return this};pt.prototype.emitReserved=pt.prototype.emit;pt.prototype.listeners=function(n){return this._callbacks=this._callbacks||{},this._callbacks["$"+n]||[]};pt.prototype.hasListeners=function(n){return!!this.listeners(n).length};const jn=(()=>typeof self!="undefined"?self:typeof window!="undefined"?window:Function("return this")())();function q0(n,...e){return e.reduce((t,r)=>(n.hasOwnProperty(r)&&(t[r]=n[r]),t),{})}const _N=jn.setTimeout,AN=jn.clearTimeout;function Gc(n,e){e.useNativeTimers?(n.setTimeoutFn=_N.bind(jn),n.clearTimeoutFn=AN.bind(jn)):(n.setTimeoutFn=jn.setTimeout.bind(jn),n.clearTimeoutFn=jn.clearTimeout.bind(jn))}const ON=1.33;function SN(n){return typeof n=="string"?$N(n):Math.ceil((n.byteLength||n.size)*ON)}function $N(n){let e=0,t=0;for(let r=0,i=n.length;r<i;r++)e=n.charCodeAt(r),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(r++,t+=4);return t}class TN extends Error{constructor(e,t,r){super(e),this.description=t,this.context=r,this.type="TransportError"}}class V0 extends pt{constructor(e){super(),this.writable=!1,Gc(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,r){return super.emitReserved("error",new TN(e,t,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=D0(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}}const K0="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),gh=64,PN={};let $y=0,Zo=0,Ty;function Py(n){let e="";do e=K0[n%gh]+e,n=Math.floor(n/gh);while(n>0);return e}function W0(){const n=Py(+new Date);return n!==Ty?($y=0,Ty=n):n+"."+Py($y++)}for(;Zo<gh;Zo++)PN[K0[Zo]]=Zo;function z0(n){let e="";for(let t in n)n.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(n[t]));return e}function IN(n){let e={},t=n.split("&");for(let r=0,i=t.length;r<i;r++){let s=t[r].split("=");e[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return e}let H0=!1;try{H0=typeof XMLHttpRequest!="undefined"&&"withCredentials"in new XMLHttpRequest}catch(n){}const RN=H0;function J0(n){const e=n.xdomain;try{if(typeof XMLHttpRequest!="undefined"&&(!e||RN))return new XMLHttpRequest}catch(t){}if(!e)try{return new jn[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch(t){}}function CN(){}const NN=function(){return new J0({xdomain:!1}).responseType!=null}();class jN extends V0{constructor(e){if(super(e),this.polling=!1,typeof location!="undefined"){const r=location.protocol==="https:";let i=location.port;i||(i=r?"443":"80"),this.xd=typeof location!="undefined"&&e.hostname!==location.hostname||i!==e.port,this.xs=e.secure!==r}const t=e&&e.forceBase64;this.supportsBinary=NN&&!t}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let r=0;this.polling&&(r++,this.once("pollComplete",function(){--r||t()})),this.writable||(r++,this.once("drain",function(){--r||t()}))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const t=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)};xN(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,kN(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let e=this.query||{};const t=this.opts.secure?"https":"http";let r="";this.opts.timestampRequests!==!1&&(e[this.opts.timestampParam]=W0()),!this.supportsBinary&&!e.sid&&(e.b64=1),this.opts.port&&(t==="https"&&Number(this.opts.port)!==443||t==="http"&&Number(this.opts.port)!==80)&&(r=":"+this.opts.port);const i=z0(e),s=this.opts.hostname.indexOf(":")!==-1;return t+"://"+(s?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(i.length?"?"+i:"")}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new ur(this.uri(),e)}doWrite(e,t){const r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",(i,s)=>{this.onError("xhr post error",i,s)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,r)=>{this.onError("xhr poll error",t,r)}),this.pollXhr=e}}class ur extends pt{constructor(e,t){super(),Gc(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.async=t.async!==!1,this.data=t.data!==void 0?t.data:null,this.create()}create(){const e=q0(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;const t=this.xhr=new J0(e);try{t.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(let r in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(r)&&t.setRequestHeader(r,this.opts.extraHeaders[r])}}catch(r){}if(this.method==="POST")try{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(r){}try{t.setRequestHeader("Accept","*/*")}catch(r){}"withCredentials"in t&&(t.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(t.timeout=this.opts.requestTimeout),t.onreadystatechange=()=>{t.readyState===4&&(t.status===200||t.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof t.status=="number"?t.status:0)},0))},t.send(this.data)}catch(r){this.setTimeoutFn(()=>{this.onError(r)},0);return}typeof document!="undefined"&&(this.index=ur.requestsCount++,ur.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr=="undefined"||this.xhr===null)){if(this.xhr.onreadystatechange=CN,e)try{this.xhr.abort()}catch(t){}typeof document!="undefined"&&delete ur.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}ur.requestsCount=0;ur.requests={};if(typeof document!="undefined"){if(typeof attachEvent=="function")attachEvent("onunload",Iy);else if(typeof addEventListener=="function"){const n="onpagehide"in jn?"pagehide":"unload";addEventListener(n,Iy,!1)}}function Iy(){for(let n in ur.requests)ur.requests.hasOwnProperty(n)&&ur.requests[n].abort()}const Y0=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,t)=>t(e,0))(),ea=jn.WebSocket||jn.MozWebSocket,Ry=!0,BN="arraybuffer",Cy=typeof navigator!="undefined"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class LN extends V0{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,r=Cy?{}:q0(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=Ry&&!Cy?t?new ea(e,t):new ea(e):new ea(e,t,r)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType||BN,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],i=t===e.length-1;L0(r,this.supportsBinary,s=>{const o={};try{Ry&&this.ws.send(s)}catch(a){}i&&Y0(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws!="undefined"&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{};const t=this.opts.secure?"wss":"ws";let r="";this.opts.port&&(t==="wss"&&Number(this.opts.port)!==443||t==="ws"&&Number(this.opts.port)!==80)&&(r=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=W0()),this.supportsBinary||(e.b64=1);const i=z0(e),s=this.opts.hostname.indexOf(":")!==-1;return t+"://"+(s?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(i.length?"?"+i:"")}check(){return!!ea}}const DN={websocket:LN,polling:jN},UN=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,FN=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function mh(n){const e=n,t=n.indexOf("["),r=n.indexOf("]");t!=-1&&r!=-1&&(n=n.substring(0,t)+n.substring(t,r).replace(/:/g,";")+n.substring(r,n.length));let i=UN.exec(n||""),s={},o=14;for(;o--;)s[FN[o]]=i[o]||"";return t!=-1&&r!=-1&&(s.source=e,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=MN(s,s.path),s.queryKey=qN(s,s.query),s}function MN(n,e){const t=/\/{2,9}/g,r=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&r.splice(0,1),e.slice(-1)=="/"&&r.splice(r.length-1,1),r}function qN(n,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,i,s){i&&(t[i]=s)}),t}class ii extends pt{constructor(e,t={}){super(),this.writeBuffer=[],e&&typeof e=="object"&&(t=e,e=null),e?(e=mh(e),t.hostname=e.host,t.secure=e.protocol==="https"||e.protocol==="wss",t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=mh(t.host).host),Gc(this,t),this.secure=t.secure!=null?t.secure:typeof location!="undefined"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location!="undefined"?location.hostname:"localhost"),this.port=t.port||(typeof location!="undefined"&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=IN(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=M0,t.transport=e,this.id&&(t.sid=this.id);const r=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new DN[e](r)}open(){let e;if(this.opts.rememberUpgrade&&ii.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch(t){this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",t=>this.onClose("transport close",t))}probe(e){let t=this.createTransport(e),r=!1;ii.priorWebsocketSuccess=!1;const i=()=>{r||(t.send([{type:"ping",data:"probe"}]),t.once("packet",h=>{if(!r)if(h.type==="pong"&&h.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;ii.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{r||this.readyState!=="closed"&&(u(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const p=new Error("probe error");p.transport=t.name,this.emitReserved("upgradeError",p)}}))};function s(){r||(r=!0,u(),t.close(),t=null)}const o=h=>{const p=new Error("probe error: "+h);p.transport=t.name,s(),this.emitReserved("upgradeError",p)};function a(){o("transport closed")}function c(){o("socket closed")}function l(h){t&&h.name!==t.name&&s()}const u=()=>{t.removeListener("open",i),t.removeListener("error",o),t.removeListener("close",a),this.off("close",c),this.off("upgrading",l)};t.once("open",i),t.once("error",o),t.once("close",a),this.once("close",c),this.once("upgrading",l),t.open()}onOpen(){if(this.readyState="open",ii.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let r=0;r<this.writeBuffer.length;r++){const i=this.writeBuffer[r].data;if(i&&(t+=SN(i)),r>0&&t>this.maxPayload)return this.writeBuffer.slice(0,r);t+=2}return this.writeBuffer}write(e,t,r){return this.sendPacket("message",e,t,r),this}send(e,t,r){return this.sendPacket("message",e,t,r),this}sendPacket(e,t,r,i){if(typeof t=="function"&&(i=t,t=void 0),typeof r=="function"&&(i=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;const s={type:e,data:t,options:r};this.emitReserved("packetCreate",s),this.writeBuffer.push(s),i&&this.once("flush",i),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},r=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():e()}):this.upgrading?r():e()),this}onError(e){ii.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let r=0;const i=e.length;for(;r<i;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}}ii.protocol=M0;function VN(n,e="",t){let r=n;t=t||typeof location!="undefined"&&location,n==null&&(n=t.protocol+"//"+t.host),typeof n=="string"&&(n.charAt(0)==="/"&&(n.charAt(1)==="/"?n=t.protocol+n:n=t.host+n),/^(https?|wss?):\/\//.test(n)||(typeof t!="undefined"?n=t.protocol+"//"+n:n="https://"+n),r=mh(n)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const s=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+s+":"+r.port+e,r.href=r.protocol+"://"+s+(t&&t.port===r.port?"":":"+r.port),r}const KN=typeof ArrayBuffer=="function",WN=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n.buffer instanceof ArrayBuffer,G0=Object.prototype.toString,zN=typeof Blob=="function"||typeof Blob!="undefined"&&G0.call(Blob)==="[object BlobConstructor]",HN=typeof File=="function"||typeof File!="undefined"&&G0.call(File)==="[object FileConstructor]";function id(n){return KN&&(n instanceof ArrayBuffer||WN(n))||zN&&n instanceof Blob||HN&&n instanceof File}function Ca(n,e){if(!n||typeof n!="object")return!1;if(Array.isArray(n)){for(let t=0,r=n.length;t<r;t++)if(Ca(n[t]))return!0;return!1}if(id(n))return!0;if(n.toJSON&&typeof n.toJSON=="function"&&arguments.length===1)return Ca(n.toJSON(),!0);for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)&&Ca(n[t]))return!0;return!1}function JN(n){const e=[],t=n.data,r=n;return r.data=vh(t,e),r.attachments=e.length,{packet:r,buffers:e}}function vh(n,e){if(!n)return n;if(id(n)){const t={_placeholder:!0,num:e.length};return e.push(n),t}else if(Array.isArray(n)){const t=new Array(n.length);for(let r=0;r<n.length;r++)t[r]=vh(n[r],e);return t}else if(typeof n=="object"&&!(n instanceof Date)){const t={};for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=vh(n[r],e));return t}return n}function YN(n,e){return n.data=bh(n.data,e),delete n.attachments,n}function bh(n,e){if(!n)return n;if(n&&n._placeholder===!0){if(typeof n.num=="number"&&n.num>=0&&n.num<e.length)return e[n.num];throw new Error("illegal attachments")}else if(Array.isArray(n))for(let t=0;t<n.length;t++)n[t]=bh(n[t],e);else if(typeof n=="object")for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&(n[t]=bh(n[t],e));return n}const GN=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],QN=5;var De;(function(n){n[n.CONNECT=0]="CONNECT",n[n.DISCONNECT=1]="DISCONNECT",n[n.EVENT=2]="EVENT",n[n.ACK=3]="ACK",n[n.CONNECT_ERROR=4]="CONNECT_ERROR",n[n.BINARY_EVENT=5]="BINARY_EVENT",n[n.BINARY_ACK=6]="BINARY_ACK"})(De||(De={}));class XN{constructor(e){this.replacer=e}encode(e){return(e.type===De.EVENT||e.type===De.ACK)&&Ca(e)?this.encodeAsBinary({type:e.type===De.EVENT?De.BINARY_EVENT:De.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===De.BINARY_EVENT||e.type===De.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=JN(e),r=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(r),i}}function Ny(n){return Object.prototype.toString.call(n)==="[object Object]"}class sd extends pt{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const r=t.type===De.BINARY_EVENT;r||t.type===De.BINARY_ACK?(t.type=r?De.EVENT:De.ACK,this.reconstructor=new ZN(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(id(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const r={type:Number(e.charAt(0))};if(De[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===De.BINARY_EVENT||r.type===De.BINARY_ACK){const s=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const o=e.substring(s,t);if(o!=Number(o)||e.charAt(t)!=="-")throw new Error("Illegal attachments");r.attachments=Number(o)}if(e.charAt(t+1)==="/"){const s=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););r.nsp=e.substring(s,t)}else r.nsp="/";const i=e.charAt(t+1);if(i!==""&&Number(i)==i){const s=t+1;for(;++t;){const o=e.charAt(t);if(o==null||Number(o)!=o){--t;break}if(t===e.length)break}r.id=Number(e.substring(s,t+1))}if(e.charAt(++t)){const s=this.tryParse(e.substr(t));if(sd.isPayloadValid(r.type,s))r.data=s;else throw new Error("invalid payload")}return r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(t){return!1}}static isPayloadValid(e,t){switch(e){case De.CONNECT:return Ny(t);case De.DISCONNECT:return t===void 0;case De.CONNECT_ERROR:return typeof t=="string"||Ny(t);case De.EVENT:case De.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&GN.indexOf(t[0])===-1);case De.ACK:case De.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class ZN{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=YN(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const ej=Object.freeze(Object.defineProperty({__proto__:null,protocol:QN,get PacketType(){return De},Encoder:XN,Decoder:sd},Symbol.toStringTag,{value:"Module"}));function Kn(n,e,t){return n.on(e,t),function(){n.off(e,t)}}const tj=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Q0 extends pt{constructor(e,t,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Kn(e,"open",this.onopen.bind(this)),Kn(e,"packet",this.onpacket.bind(this)),Kn(e,"error",this.onerror.bind(this)),Kn(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(tj.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const r={type:De.EVENT,data:t};if(r.options={},r.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const o=this.ids++,a=t.pop();this._registerAckCallback(o,a),r.id=o}const i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!i||!this.connected)||(this.connected?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(e,t){var r;const i=(r=this.flags.timeout)!==null&&r!==void 0?r:this._opts.ackTimeout;if(i===void 0){this.acks[e]=t;return}const s=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let o=0;o<this.sendBuffer.length;o++)this.sendBuffer[o].id===e&&this.sendBuffer.splice(o,1);t.call(this,new Error("operation has timed out"))},i);this.acks[e]=(...o)=>{this.io.clearTimeoutFn(s),t.apply(this,[null,...o])}}emitWithAck(e,...t){const r=this.flags.timeout!==void 0||this._opts.ackTimeout!==void 0;return new Promise((i,s)=>{t.push((o,a)=>r?o?s(o):i(a):i(o)),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((i,...s)=>r!==this._queue[0]?void 0:(i!==null?r.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(i)):(this._queue.shift(),t&&t(null,...s)),r.pending=!1,this._drainQueue())),this._queue.push(r),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:De.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case De.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case De.EVENT:case De.BINARY_EVENT:this.onevent(e);break;case De.ACK:case De.BINARY_ACK:this.onack(e);break;case De.DISCONNECT:this.ondisconnect();break;case De.CONNECT_ERROR:this.destroy();const r=new Error(e.data.message);r.data=e.data.data,this.emitReserved("connect_error",r);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const r of t)r.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let r=!1;return function(...i){r||(r=!0,t.packet({type:De.ACK,id:e,data:i}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:De.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const r of t)r.apply(this,e.data)}}}function _s(n){n=n||{},this.ms=n.min||100,this.max=n.max||1e4,this.factor=n.factor||2,this.jitter=n.jitter>0&&n.jitter<=1?n.jitter:0,this.attempts=0}_s.prototype.duration=function(){var n=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*n);n=(Math.floor(e*10)&1)==0?n-t:n+t}return Math.min(n,this.max)|0};_s.prototype.reset=function(){this.attempts=0};_s.prototype.setMin=function(n){this.ms=n};_s.prototype.setMax=function(n){this.max=n};_s.prototype.setJitter=function(n){this.jitter=n};class wh extends pt{constructor(e,t){var r;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,Gc(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((r=t.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new _s({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const i=t.parser||ej;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new ii(this.uri,this.opts);const t=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const i=Kn(t,"open",function(){r.onopen(),e&&e()}),s=Kn(t,"error",o=>{r.cleanup(),r._readyState="closed",this.emitReserved("error",o),e?e(o):r.maybeReconnectOnOpen()});if(this._timeout!==!1){const o=this._timeout;o===0&&i();const a=this.setTimeoutFn(()=>{i(),t.close(),t.emit("error",new Error("timeout"))},o);this.opts.autoUnref&&a.unref(),this.subs.push(function(){clearTimeout(a)})}return this.subs.push(i),this.subs.push(s),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Kn(e,"ping",this.onping.bind(this)),Kn(e,"data",this.ondata.bind(this)),Kn(e,"error",this.onerror.bind(this)),Kn(e,"close",this.onclose.bind(this)),Kn(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){Y0(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new Q0(this,e,t),this.nsps[e]=r),r}_destroy(e){const t=Object.keys(this.nsps);for(const r of t)if(this.nsps[r].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let r=0;r<t.length;r++)this.engine.write(t[r],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(i=>{i?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",i)):e.onreconnect()}))},t);this.opts.autoUnref&&r.unref(),this.subs.push(function(){clearTimeout(r)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const Cs={};function Na(n,e){typeof n=="object"&&(e=n,n=void 0),e=e||{};const t=VN(n,e.path||"/socket.io"),r=t.source,i=t.id,s=t.path,o=Cs[i]&&s in Cs[i].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||o;let c;return a?c=new wh(r,e):(Cs[i]||(Cs[i]=new wh(r,e)),c=Cs[i]),t.query&&!e.query&&(e.query=t.queryKey),c.socket(t.path,e)}Object.assign(Na,{Manager:wh,Socket:Q0,io:Na,connect:Na});const nj={init:({API_KEY:n,HOST_SERVER:e,CURRENT:t,ENV:r,API_VERSION:i})=>{var a,c;let s={};const o=localStorage.getItem("accessToken");try{const l={Accept:"application/json","Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Key":n,"Access-Control-Allow-Methods":"POST, GET, OPTIONS, PUT, DELETE, HEAD,PATCH","Access-Control-Allow-Headers":"X-PINGOTHER, Origin, X-Requested-With, Content-Type, Accept","Access-Control-Max-Age":"1728000"};return o&&(l.Authorization="Bearer "+o),s.storage=Na(e.STORAGE,{extraHeaders:l}),(a=s==null?void 0:s.storage)==null||a.on("connect",()=>{r==="dev"&&console.log("Swyger Storage Client JS is connected with Swyger Server!!!")}),(c=s==null?void 0:s.storage)==null||c.on("disconnect",u=>{r==="dev"&&console.log("The device is disconnected from Storage server!")}),s}catch(l){}}};function kh(n){this.message=n}kh.prototype=new Error,kh.prototype.name="InvalidCharacterError";var jy=typeof window!="undefined"&&window.atob&&window.atob.bind(window)||function(n){var e=String(n).replace(/=+$/,"");if(e.length%4==1)throw new kh("'atob' failed: The string to be decoded is not correctly encoded.");for(var t,r,i=0,s=0,o="";r=e.charAt(s++);~r&&(t=i%4?64*t+r:r,i++%4)?o+=String.fromCharCode(255&t>>(-2*i&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return o};function rj(n){var e=n.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw"Illegal base64url string!"}try{return function(t){return decodeURIComponent(jy(t).replace(/(.)/g,function(r,i){var s=i.charCodeAt(0).toString(16).toUpperCase();return s.length<2&&(s="0"+s),"%"+s}))}(e)}catch(t){return jy(e)}}function nc(n){this.message=n}function ij(n,e){if(typeof n!="string")throw new nc("Invalid token specified");var t=(e=e||{}).header===!0?0:1;try{return JSON.parse(rj(n.split(".")[t]))}catch(r){throw new nc("Invalid token specified: "+r.message)}}nc.prototype=new Error,nc.prototype.name="InvalidTokenError";function X0(n,e){return function(){return n.apply(e,arguments)}}const{toString:sj}=Object.prototype,{getPrototypeOf:od}=Object,Qc=(n=>e=>{const t=sj.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),vr=n=>(n=n.toLowerCase(),e=>Qc(e)===n),Xc=n=>e=>typeof e===n,{isArray:As}=Array,co=Xc("undefined");function oj(n){return n!==null&&!co(n)&&n.constructor!==null&&!co(n.constructor)&&Dn(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const Z0=vr("ArrayBuffer");function aj(n){let e;return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&Z0(n.buffer),e}const cj=Xc("string"),Dn=Xc("function"),ew=Xc("number"),Zc=n=>n!==null&&typeof n=="object",lj=n=>n===!0||n===!1,ja=n=>{if(Qc(n)!=="object")return!1;const e=od(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},uj=vr("Date"),hj=vr("File"),fj=vr("Blob"),dj=vr("FileList"),pj=n=>Zc(n)&&Dn(n.pipe),yj=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||Dn(n.append)&&((e=Qc(n))==="formdata"||e==="object"&&Dn(n.toString)&&n.toString()==="[object FormData]"))},gj=vr("URLSearchParams"),mj=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Io(n,e,{allOwnKeys:t=!1}={}){if(n===null||typeof n=="undefined")return;let r,i;if(typeof n!="object"&&(n=[n]),As(n))for(r=0,i=n.length;r<i;r++)e.call(null,n[r],r,n);else{const s=t?Object.getOwnPropertyNames(n):Object.keys(n),o=s.length;let a;for(r=0;r<o;r++)a=s[r],e.call(null,n[a],a,n)}}function tw(n,e){e=e.toLowerCase();const t=Object.keys(n);let r=t.length,i;for(;r-- >0;)if(i=t[r],e===i.toLowerCase())return i;return null}const nw=(()=>typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:global)(),rw=n=>!co(n)&&n!==nw;function xh(){const{caseless:n}=rw(this)&&this||{},e={},t=(r,i)=>{const s=n&&tw(e,i)||i;ja(e[s])&&ja(r)?e[s]=xh(e[s],r):ja(r)?e[s]=xh({},r):As(r)?e[s]=r.slice():e[s]=r};for(let r=0,i=arguments.length;r<i;r++)arguments[r]&&Io(arguments[r],t);return e}const vj=(n,e,t,{allOwnKeys:r}={})=>(Io(e,(i,s)=>{t&&Dn(i)?n[s]=X0(i,t):n[s]=i},{allOwnKeys:r}),n),bj=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),wj=(n,e,t,r)=>{n.prototype=Object.create(e.prototype,r),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),t&&Object.assign(n.prototype,t)},kj=(n,e,t,r)=>{let i,s,o;const a={};if(e=e||{},n==null)return e;do{for(i=Object.getOwnPropertyNames(n),s=i.length;s-- >0;)o=i[s],(!r||r(o,n,e))&&!a[o]&&(e[o]=n[o],a[o]=!0);n=t!==!1&&od(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e},xj=(n,e,t)=>{n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;const r=n.indexOf(e,t);return r!==-1&&r===t},Ej=n=>{if(!n)return null;if(As(n))return n;let e=n.length;if(!ew(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=n[e];return t},_j=(n=>e=>n&&e instanceof n)(typeof Uint8Array!="undefined"&&od(Uint8Array)),Aj=(n,e)=>{const r=(n&&n[Symbol.iterator]).call(n);let i;for(;(i=r.next())&&!i.done;){const s=i.value;e.call(n,s[0],s[1])}},Oj=(n,e)=>{let t;const r=[];for(;(t=n.exec(e))!==null;)r.push(t);return r},Sj=vr("HTMLFormElement"),$j=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,r,i){return r.toUpperCase()+i}),By=(({hasOwnProperty:n})=>(e,t)=>n.call(e,t))(Object.prototype),Tj=vr("RegExp"),iw=(n,e)=>{const t=Object.getOwnPropertyDescriptors(n),r={};Io(t,(i,s)=>{e(i,s,n)!==!1&&(r[s]=i)}),Object.defineProperties(n,r)},Pj=n=>{iw(n,(e,t)=>{if(Dn(n)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const r=n[t];if(!!Dn(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},Ij=(n,e)=>{const t={},r=i=>{i.forEach(s=>{t[s]=!0})};return As(n)?r(n):r(String(n).split(e)),t},Rj=()=>{},Cj=(n,e)=>(n=+n,Number.isFinite(n)?n:e),Xl="abcdefghijklmnopqrstuvwxyz",Ly="0123456789",sw={DIGIT:Ly,ALPHA:Xl,ALPHA_DIGIT:Xl+Xl.toUpperCase()+Ly},Nj=(n=16,e=sw.ALPHA_DIGIT)=>{let t="";const{length:r}=e;for(;n--;)t+=e[Math.random()*r|0];return t};function jj(n){return!!(n&&Dn(n.append)&&n[Symbol.toStringTag]==="FormData"&&n[Symbol.iterator])}const Bj=n=>{const e=new Array(10),t=(r,i)=>{if(Zc(r)){if(e.indexOf(r)>=0)return;if(!("toJSON"in r)){e[i]=r;const s=As(r)?[]:{};return Io(r,(o,a)=>{const c=t(o,i+1);!co(c)&&(s[a]=c)}),e[i]=void 0,s}}return r};return t(n,0)},Lj=vr("AsyncFunction"),Dj=n=>n&&(Zc(n)||Dn(n))&&Dn(n.then)&&Dn(n.catch),ee={isArray:As,isArrayBuffer:Z0,isBuffer:oj,isFormData:yj,isArrayBufferView:aj,isString:cj,isNumber:ew,isBoolean:lj,isObject:Zc,isPlainObject:ja,isUndefined:co,isDate:uj,isFile:hj,isBlob:fj,isRegExp:Tj,isFunction:Dn,isStream:pj,isURLSearchParams:gj,isTypedArray:_j,isFileList:dj,forEach:Io,merge:xh,extend:vj,trim:mj,stripBOM:bj,inherits:wj,toFlatObject:kj,kindOf:Qc,kindOfTest:vr,endsWith:xj,toArray:Ej,forEachEntry:Aj,matchAll:Oj,isHTMLForm:Sj,hasOwnProperty:By,hasOwnProp:By,reduceDescriptors:iw,freezeMethods:Pj,toObjectSet:Ij,toCamelCase:$j,noop:Rj,toFiniteNumber:Cj,findKey:tw,global:nw,isContextDefined:rw,ALPHABET:sw,generateString:Nj,isSpecCompliantForm:jj,toJSONObject:Bj,isAsyncFn:Lj,isThenable:Dj};function We(n,e,t,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),r&&(this.request=r),i&&(this.response=i)}ee.inherits(We,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ee.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const ow=We.prototype,aw={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{aw[n]={value:n}});Object.defineProperties(We,aw);Object.defineProperty(ow,"isAxiosError",{value:!0});We.from=(n,e,t,r,i,s)=>{const o=Object.create(ow);return ee.toFlatObject(n,o,function(c){return c!==Error.prototype},a=>a!=="isAxiosError"),We.call(o,n.message,e,t,r,i),o.cause=n,o.name=n.name,s&&Object.assign(o,s),o};const Uj=null;function Eh(n){return ee.isPlainObject(n)||ee.isArray(n)}function cw(n){return ee.endsWith(n,"[]")?n.slice(0,-2):n}function Dy(n,e,t){return n?n.concat(e).map(function(i,s){return i=cw(i),!t&&s?"["+i+"]":i}).join(t?".":""):e}function Fj(n){return ee.isArray(n)&&!n.some(Eh)}const Mj=ee.toFlatObject(ee,{},null,function(e){return/^is[A-Z]/.test(e)});function el(n,e,t){if(!ee.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,t=ee.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(y,_){return!ee.isUndefined(_[y])});const r=t.metaTokens,i=t.visitor||u,s=t.dots,o=t.indexes,c=(t.Blob||typeof Blob!="undefined"&&Blob)&&ee.isSpecCompliantForm(e);if(!ee.isFunction(i))throw new TypeError("visitor must be a function");function l(d){if(d===null)return"";if(ee.isDate(d))return d.toISOString();if(!c&&ee.isBlob(d))throw new We("Blob is not supported. Use a Buffer instead.");return ee.isArrayBuffer(d)||ee.isTypedArray(d)?c&&typeof Blob=="function"?new Blob([d]):Buffer.from(d):d}function u(d,y,_){let S=d;if(d&&!_&&typeof d=="object"){if(ee.endsWith(y,"{}"))y=r?y:y.slice(0,-2),d=JSON.stringify(d);else if(ee.isArray(d)&&Fj(d)||(ee.isFileList(d)||ee.endsWith(y,"[]"))&&(S=ee.toArray(d)))return y=cw(y),S.forEach(function(B,j){!(ee.isUndefined(B)||B===null)&&e.append(o===!0?Dy([y],j,s):o===null?y:y+"[]",l(B))}),!1}return Eh(d)?!0:(e.append(Dy(_,y,s),l(d)),!1)}const h=[],p=Object.assign(Mj,{defaultVisitor:u,convertValue:l,isVisitable:Eh});function f(d,y){if(!ee.isUndefined(d)){if(h.indexOf(d)!==-1)throw Error("Circular reference detected in "+y.join("."));h.push(d),ee.forEach(d,function(S,I){(!(ee.isUndefined(S)||S===null)&&i.call(e,S,ee.isString(I)?I.trim():I,y,p))===!0&&f(S,y?y.concat(I):[I])}),h.pop()}}if(!ee.isObject(n))throw new TypeError("data must be an object");return f(n),e}function Uy(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function ad(n,e){this._pairs=[],n&&el(n,this,e)}const lw=ad.prototype;lw.append=function(e,t){this._pairs.push([e,t])};lw.toString=function(e){const t=e?function(r){return e.call(this,r,Uy)}:Uy;return this._pairs.map(function(i){return t(i[0])+"="+t(i[1])},"").join("&")};function qj(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function uw(n,e,t){if(!e)return n;const r=t&&t.encode||qj,i=t&&t.serialize;let s;if(i?s=i(e,t):s=ee.isURLSearchParams(e)?e.toString():new ad(e,t).toString(r),s){const o=n.indexOf("#");o!==-1&&(n=n.slice(0,o)),n+=(n.indexOf("?")===-1?"?":"&")+s}return n}class Vj{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){ee.forEach(this.handlers,function(r){r!==null&&e(r)})}}const Fy=Vj,hw={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Kj=typeof URLSearchParams!="undefined"?URLSearchParams:ad,Wj=typeof FormData!="undefined"?FormData:null,zj=typeof Blob!="undefined"?Blob:null,Hj=(()=>{let n;return typeof navigator!="undefined"&&((n=navigator.product)==="ReactNative"||n==="NativeScript"||n==="NS")?!1:typeof window!="undefined"&&typeof document!="undefined"})(),Jj=(()=>typeof WorkerGlobalScope!="undefined"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),ar={isBrowser:!0,classes:{URLSearchParams:Kj,FormData:Wj,Blob:zj},isStandardBrowserEnv:Hj,isStandardBrowserWebWorkerEnv:Jj,protocols:["http","https","file","blob","url","data"]};function Yj(n,e){return el(n,new ar.classes.URLSearchParams,Object.assign({visitor:function(t,r,i,s){return ar.isNode&&ee.isBuffer(t)?(this.append(r,t.toString("base64")),!1):s.defaultVisitor.apply(this,arguments)}},e))}function Gj(n){return ee.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Qj(n){const e={},t=Object.keys(n);let r;const i=t.length;let s;for(r=0;r<i;r++)s=t[r],e[s]=n[s];return e}function fw(n){function e(t,r,i,s){let o=t[s++];const a=Number.isFinite(+o),c=s>=t.length;return o=!o&&ee.isArray(i)?i.length:o,c?(ee.hasOwnProp(i,o)?i[o]=[i[o],r]:i[o]=r,!a):((!i[o]||!ee.isObject(i[o]))&&(i[o]=[]),e(t,r,i[o],s)&&ee.isArray(i[o])&&(i[o]=Qj(i[o])),!a)}if(ee.isFormData(n)&&ee.isFunction(n.entries)){const t={};return ee.forEachEntry(n,(r,i)=>{e(Gj(r),i,t,0)}),t}return null}const Xj={"Content-Type":void 0};function Zj(n,e,t){if(ee.isString(n))try{return(e||JSON.parse)(n),ee.trim(n)}catch(r){if(r.name!=="SyntaxError")throw r}return(t||JSON.stringify)(n)}const tl={transitional:hw,adapter:["xhr","http"],transformRequest:[function(e,t){const r=t.getContentType()||"",i=r.indexOf("application/json")>-1,s=ee.isObject(e);if(s&&ee.isHTMLForm(e)&&(e=new FormData(e)),ee.isFormData(e))return i&&i?JSON.stringify(fw(e)):e;if(ee.isArrayBuffer(e)||ee.isBuffer(e)||ee.isStream(e)||ee.isFile(e)||ee.isBlob(e))return e;if(ee.isArrayBufferView(e))return e.buffer;if(ee.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(s){if(r.indexOf("application/x-www-form-urlencoded")>-1)return Yj(e,this.formSerializer).toString();if((a=ee.isFileList(e))||r.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return el(a?{"files[]":e}:e,c&&new c,this.formSerializer)}}return s||i?(t.setContentType("application/json",!1),Zj(e)):e}],transformResponse:[function(e){const t=this.transitional||tl.transitional,r=t&&t.forcedJSONParsing,i=this.responseType==="json";if(e&&ee.isString(e)&&(r&&!this.responseType||i)){const o=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e)}catch(a){if(o)throw a.name==="SyntaxError"?We.from(a,We.ERR_BAD_RESPONSE,this,null,this.response):a}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ar.classes.FormData,Blob:ar.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};ee.forEach(["delete","get","head"],function(e){tl.headers[e]={}});ee.forEach(["post","put","patch"],function(e){tl.headers[e]=ee.merge(Xj)});const cd=tl,eB=ee.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),tB=n=>{const e={};let t,r,i;return n&&n.split(`
`).forEach(function(o){i=o.indexOf(":"),t=o.substring(0,i).trim().toLowerCase(),r=o.substring(i+1).trim(),!(!t||e[t]&&eB[t])&&(t==="set-cookie"?e[t]?e[t].push(r):e[t]=[r]:e[t]=e[t]?e[t]+", "+r:r)}),e},My=Symbol("internals");function Ns(n){return n&&String(n).trim().toLowerCase()}function Ba(n){return n===!1||n==null?n:ee.isArray(n)?n.map(Ba):String(n)}function nB(n){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=t.exec(n);)e[r[1]]=r[2];return e}const rB=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function Zl(n,e,t,r,i){if(ee.isFunction(r))return r.call(this,e,t);if(i&&(e=t),!!ee.isString(e)){if(ee.isString(r))return e.indexOf(r)!==-1;if(ee.isRegExp(r))return r.test(e)}}function iB(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,r)=>t.toUpperCase()+r)}function sB(n,e){const t=ee.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(n,r+t,{value:function(i,s,o){return this[r].call(this,e,i,s,o)},configurable:!0})})}class nl{constructor(e){e&&this.set(e)}set(e,t,r){const i=this;function s(a,c,l){const u=Ns(c);if(!u)throw new Error("header name must be a non-empty string");const h=ee.findKey(i,u);(!h||i[h]===void 0||l===!0||l===void 0&&i[h]!==!1)&&(i[h||c]=Ba(a))}const o=(a,c)=>ee.forEach(a,(l,u)=>s(l,u,c));return ee.isPlainObject(e)||e instanceof this.constructor?o(e,t):ee.isString(e)&&(e=e.trim())&&!rB(e)?o(tB(e),t):e!=null&&s(t,e,r),this}get(e,t){if(e=Ns(e),e){const r=ee.findKey(this,e);if(r){const i=this[r];if(!t)return i;if(t===!0)return nB(i);if(ee.isFunction(t))return t.call(this,i,r);if(ee.isRegExp(t))return t.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Ns(e),e){const r=ee.findKey(this,e);return!!(r&&this[r]!==void 0&&(!t||Zl(this,this[r],r,t)))}return!1}delete(e,t){const r=this;let i=!1;function s(o){if(o=Ns(o),o){const a=ee.findKey(r,o);a&&(!t||Zl(r,r[a],a,t))&&(delete r[a],i=!0)}}return ee.isArray(e)?e.forEach(s):s(e),i}clear(e){const t=Object.keys(this);let r=t.length,i=!1;for(;r--;){const s=t[r];(!e||Zl(this,this[s],s,e,!0))&&(delete this[s],i=!0)}return i}normalize(e){const t=this,r={};return ee.forEach(this,(i,s)=>{const o=ee.findKey(r,s);if(o){t[o]=Ba(i),delete t[s];return}const a=e?iB(s):String(s).trim();a!==s&&delete t[s],t[a]=Ba(i),r[a]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return ee.forEach(this,(r,i)=>{r!=null&&r!==!1&&(t[i]=e&&ee.isArray(r)?r.join(", "):r)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const r=new this(e);return t.forEach(i=>r.set(i)),r}static accessor(e){const r=(this[My]=this[My]={accessors:{}}).accessors,i=this.prototype;function s(o){const a=Ns(o);r[a]||(sB(i,o),r[a]=!0)}return ee.isArray(e)?e.forEach(s):s(e),this}}nl.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);ee.freezeMethods(nl.prototype);ee.freezeMethods(nl);const Or=nl;function eu(n,e){const t=this||cd,r=e||t,i=Or.from(r.headers);let s=r.data;return ee.forEach(n,function(a){s=a.call(t,s,i.normalize(),e?e.status:void 0)}),i.normalize(),s}function dw(n){return!!(n&&n.__CANCEL__)}function Ro(n,e,t){We.call(this,n==null?"canceled":n,We.ERR_CANCELED,e,t),this.name="CanceledError"}ee.inherits(Ro,We,{__CANCEL__:!0});function oB(n,e,t){const r=t.config.validateStatus;!t.status||!r||r(t.status)?n(t):e(new We("Request failed with status code "+t.status,[We.ERR_BAD_REQUEST,We.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}const aB=ar.isStandardBrowserEnv?function(){return{write:function(t,r,i,s,o,a){const c=[];c.push(t+"="+encodeURIComponent(r)),ee.isNumber(i)&&c.push("expires="+new Date(i).toGMTString()),ee.isString(s)&&c.push("path="+s),ee.isString(o)&&c.push("domain="+o),a===!0&&c.push("secure"),document.cookie=c.join("; ")},read:function(t){const r=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}();function cB(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function lB(n,e){return e?n.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):n}function pw(n,e){return n&&!cB(e)?lB(n,e):e}const uB=ar.isStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a");let r;function i(s){let o=s;return e&&(t.setAttribute("href",o),o=t.href),t.setAttribute("href",o),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:t.pathname.charAt(0)==="/"?t.pathname:"/"+t.pathname}}return r=i(window.location.href),function(o){const a=ee.isString(o)?i(o):o;return a.protocol===r.protocol&&a.host===r.host}}():function(){return function(){return!0}}();function hB(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function fB(n,e){n=n||10;const t=new Array(n),r=new Array(n);let i=0,s=0,o;return e=e!==void 0?e:1e3,function(c){const l=Date.now(),u=r[s];o||(o=l),t[i]=c,r[i]=l;let h=s,p=0;for(;h!==i;)p+=t[h++],h=h%n;if(i=(i+1)%n,i===s&&(s=(s+1)%n),l-o<e)return;const f=u&&l-u;return f?Math.round(p*1e3/f):void 0}}function qy(n,e){let t=0;const r=fB(50,250);return i=>{const s=i.loaded,o=i.lengthComputable?i.total:void 0,a=s-t,c=r(a),l=s<=o;t=s;const u={loaded:s,total:o,progress:o?s/o:void 0,bytes:a,rate:c||void 0,estimated:c&&o&&l?(o-s)/c:void 0,event:i};u[e?"download":"upload"]=!0,n(u)}}const dB=typeof XMLHttpRequest!="undefined",pB=dB&&function(n){return new Promise(function(t,r){let i=n.data;const s=Or.from(n.headers).normalize(),o=n.responseType;let a;function c(){n.cancelToken&&n.cancelToken.unsubscribe(a),n.signal&&n.signal.removeEventListener("abort",a)}ee.isFormData(i)&&(ar.isStandardBrowserEnv||ar.isStandardBrowserWebWorkerEnv?s.setContentType(!1):s.setContentType("multipart/form-data;",!1));let l=new XMLHttpRequest;if(n.auth){const f=n.auth.username||"",d=n.auth.password?unescape(encodeURIComponent(n.auth.password)):"";s.set("Authorization","Basic "+btoa(f+":"+d))}const u=pw(n.baseURL,n.url);l.open(n.method.toUpperCase(),uw(u,n.params,n.paramsSerializer),!0),l.timeout=n.timeout;function h(){if(!l)return;const f=Or.from("getAllResponseHeaders"in l&&l.getAllResponseHeaders()),y={data:!o||o==="text"||o==="json"?l.responseText:l.response,status:l.status,statusText:l.statusText,headers:f,config:n,request:l};oB(function(S){t(S),c()},function(S){r(S),c()},y),l=null}if("onloadend"in l?l.onloadend=h:l.onreadystatechange=function(){!l||l.readyState!==4||l.status===0&&!(l.responseURL&&l.responseURL.indexOf("file:")===0)||setTimeout(h)},l.onabort=function(){!l||(r(new We("Request aborted",We.ECONNABORTED,n,l)),l=null)},l.onerror=function(){r(new We("Network Error",We.ERR_NETWORK,n,l)),l=null},l.ontimeout=function(){let d=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const y=n.transitional||hw;n.timeoutErrorMessage&&(d=n.timeoutErrorMessage),r(new We(d,y.clarifyTimeoutError?We.ETIMEDOUT:We.ECONNABORTED,n,l)),l=null},ar.isStandardBrowserEnv){const f=(n.withCredentials||uB(u))&&n.xsrfCookieName&&aB.read(n.xsrfCookieName);f&&s.set(n.xsrfHeaderName,f)}i===void 0&&s.setContentType(null),"setRequestHeader"in l&&ee.forEach(s.toJSON(),function(d,y){l.setRequestHeader(y,d)}),ee.isUndefined(n.withCredentials)||(l.withCredentials=!!n.withCredentials),o&&o!=="json"&&(l.responseType=n.responseType),typeof n.onDownloadProgress=="function"&&l.addEventListener("progress",qy(n.onDownloadProgress,!0)),typeof n.onUploadProgress=="function"&&l.upload&&l.upload.addEventListener("progress",qy(n.onUploadProgress)),(n.cancelToken||n.signal)&&(a=f=>{!l||(r(!f||f.type?new Ro(null,n,l):f),l.abort(),l=null)},n.cancelToken&&n.cancelToken.subscribe(a),n.signal&&(n.signal.aborted?a():n.signal.addEventListener("abort",a)));const p=hB(u);if(p&&ar.protocols.indexOf(p)===-1){r(new We("Unsupported protocol "+p+":",We.ERR_BAD_REQUEST,n));return}l.send(i||null)})},La={http:Uj,xhr:pB};ee.forEach(La,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch(t){}Object.defineProperty(n,"adapterName",{value:e})}});const yB={getAdapter:n=>{n=ee.isArray(n)?n:[n];const{length:e}=n;let t,r;for(let i=0;i<e&&(t=n[i],!(r=ee.isString(t)?La[t.toLowerCase()]:t));i++);if(!r)throw r===!1?new We(`Adapter ${t} is not supported by the environment`,"ERR_NOT_SUPPORT"):new Error(ee.hasOwnProp(La,t)?`Adapter '${t}' is not available in the build`:`Unknown adapter '${t}'`);if(!ee.isFunction(r))throw new TypeError("adapter is not a function");return r},adapters:La};function tu(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new Ro(null,n)}function Vy(n){return tu(n),n.headers=Or.from(n.headers),n.data=eu.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),yB.getAdapter(n.adapter||cd.adapter)(n).then(function(r){return tu(n),r.data=eu.call(n,n.transformResponse,r),r.headers=Or.from(r.headers),r},function(r){return dw(r)||(tu(n),r&&r.response&&(r.response.data=eu.call(n,n.transformResponse,r.response),r.response.headers=Or.from(r.response.headers))),Promise.reject(r)})}const Ky=n=>n instanceof Or?n.toJSON():n;function ys(n,e){e=e||{};const t={};function r(l,u,h){return ee.isPlainObject(l)&&ee.isPlainObject(u)?ee.merge.call({caseless:h},l,u):ee.isPlainObject(u)?ee.merge({},u):ee.isArray(u)?u.slice():u}function i(l,u,h){if(ee.isUndefined(u)){if(!ee.isUndefined(l))return r(void 0,l,h)}else return r(l,u,h)}function s(l,u){if(!ee.isUndefined(u))return r(void 0,u)}function o(l,u){if(ee.isUndefined(u)){if(!ee.isUndefined(l))return r(void 0,l)}else return r(void 0,u)}function a(l,u,h){if(h in e)return r(l,u);if(h in n)return r(void 0,l)}const c={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(l,u)=>i(Ky(l),Ky(u),!0)};return ee.forEach(Object.keys(Object.assign({},n,e)),function(u){const h=c[u]||i,p=h(n[u],e[u],u);ee.isUndefined(p)&&h!==a||(t[u]=p)}),t}const yw="1.4.0",ld={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{ld[n]=function(r){return typeof r===n||"a"+(e<1?"n ":" ")+n}});const Wy={};ld.transitional=function(e,t,r){function i(s,o){return"[Axios v"+yw+"] Transitional option '"+s+"'"+o+(r?". "+r:"")}return(s,o,a)=>{if(e===!1)throw new We(i(o," has been removed"+(t?" in "+t:"")),We.ERR_DEPRECATED);return t&&!Wy[o]&&(Wy[o]=!0,console.warn(i(o," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(s,o,a):!0}};function gB(n,e,t){if(typeof n!="object")throw new We("options must be an object",We.ERR_BAD_OPTION_VALUE);const r=Object.keys(n);let i=r.length;for(;i-- >0;){const s=r[i],o=e[s];if(o){const a=n[s],c=a===void 0||o(a,s,n);if(c!==!0)throw new We("option "+s+" must be "+c,We.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new We("Unknown option "+s,We.ERR_BAD_OPTION)}}const _h={assertOptions:gB,validators:ld},Gr=_h.validators;class rc{constructor(e){this.defaults=e,this.interceptors={request:new Fy,response:new Fy}}request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=ys(this.defaults,t);const{transitional:r,paramsSerializer:i,headers:s}=t;r!==void 0&&_h.assertOptions(r,{silentJSONParsing:Gr.transitional(Gr.boolean),forcedJSONParsing:Gr.transitional(Gr.boolean),clarifyTimeoutError:Gr.transitional(Gr.boolean)},!1),i!=null&&(ee.isFunction(i)?t.paramsSerializer={serialize:i}:_h.assertOptions(i,{encode:Gr.function,serialize:Gr.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o;o=s&&ee.merge(s.common,s[t.method]),o&&ee.forEach(["delete","get","head","post","put","patch","common"],d=>{delete s[d]}),t.headers=Or.concat(o,s);const a=[];let c=!0;this.interceptors.request.forEach(function(y){typeof y.runWhen=="function"&&y.runWhen(t)===!1||(c=c&&y.synchronous,a.unshift(y.fulfilled,y.rejected))});const l=[];this.interceptors.response.forEach(function(y){l.push(y.fulfilled,y.rejected)});let u,h=0,p;if(!c){const d=[Vy.bind(this),void 0];for(d.unshift.apply(d,a),d.push.apply(d,l),p=d.length,u=Promise.resolve(t);h<p;)u=u.then(d[h++],d[h++]);return u}p=a.length;let f=t;for(h=0;h<p;){const d=a[h++],y=a[h++];try{f=d(f)}catch(_){y.call(this,_);break}}try{u=Vy.call(this,f)}catch(d){return Promise.reject(d)}for(h=0,p=l.length;h<p;)u=u.then(l[h++],l[h++]);return u}getUri(e){e=ys(this.defaults,e);const t=pw(e.baseURL,e.url);return uw(t,e.params,e.paramsSerializer)}}ee.forEach(["delete","get","head","options"],function(e){rc.prototype[e]=function(t,r){return this.request(ys(r||{},{method:e,url:t,data:(r||{}).data}))}});ee.forEach(["post","put","patch"],function(e){function t(r){return function(s,o,a){return this.request(ys(a||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:s,data:o}))}}rc.prototype[e]=t(),rc.prototype[e+"Form"]=t(!0)});const Da=rc;class ud{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(s){t=s});const r=this;this.promise.then(i=>{if(!r._listeners)return;let s=r._listeners.length;for(;s-- >0;)r._listeners[s](i);r._listeners=null}),this.promise.then=i=>{let s;const o=new Promise(a=>{r.subscribe(a),s=a}).then(i);return o.cancel=function(){r.unsubscribe(s)},o},e(function(s,o,a){r.reason||(r.reason=new Ro(s,o,a),t(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}static source(){let e;return{token:new ud(function(i){e=i}),cancel:e}}}const mB=ud;function vB(n){return function(t){return n.apply(null,t)}}function bB(n){return ee.isObject(n)&&n.isAxiosError===!0}const Ah={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Ah).forEach(([n,e])=>{Ah[e]=n});const wB=Ah;function gw(n){const e=new Da(n),t=X0(Da.prototype.request,e);return ee.extend(t,Da.prototype,e,{allOwnKeys:!0}),ee.extend(t,e,null,{allOwnKeys:!0}),t.create=function(i){return gw(ys(n,i))},t}const At=gw(cd);At.Axios=Da;At.CanceledError=Ro;At.CancelToken=mB;At.isCancel=dw;At.VERSION=yw;At.toFormData=el;At.AxiosError=We;At.Cancel=At.CanceledError;At.all=function(e){return Promise.all(e)};At.spread=vB;At.isAxiosError=bB;At.mergeConfig=ys;At.AxiosHeaders=Or;At.formToJSON=n=>fw(ee.isHTMLForm(n)?new FormData(n):n);At.HttpStatusCode=wB;At.default=At;const kB=At,zy={init:({API_KEY:n})=>(...s)=>V(void 0,[...s],function*(e="post",t="/",r={},i={}){var h,p,f,d;const o=localStorage.getItem("accessToken");let a={Accept:"application/json","Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Key":n,"Access-Control-Allow-Methods":"POST, GET, OPTIONS, PUT, DELETE, HEAD,PATCH","Access-Control-Allow-Headers":"X-PINGOTHER, Origin, X-Requested-With, Content-Type, Accept","Access-Control-Max-Age":"1728000"};o&&(a.Authorization="Bearer "+o);const c=t;typeof(r==null?void 0:r.get)=="function"&&(r==null?void 0:r.get("file"))&&(a["Content-Type"]="multipart/form-data"),i!=null&&i.headers&&(a=Object.assign(...a,...i.headers),delete i.headers);const l=Object.assign({mode:"cors",method:e,url:c,data:r,headers:a},i);let u={};try{const y=yield kB(l);u.data=((h=y==null?void 0:y.data)==null?void 0:h.data)||(y==null?void 0:y.data),u.data||(u.data={})}catch(y){u.error=((f=(p=y.response)==null?void 0:p.data)==null?void 0:f.error)||((d=y.response)==null?void 0:d.error),u.error||(u.error={})}return u})};let ta;const xB=new Uint8Array(16);function EB(){if(!ta&&(ta=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!ta))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ta(xB)}const Mt=[];for(let n=0;n<256;++n)Mt.push((n+256).toString(16).slice(1));function _B(n,e=0){return(Mt[n[e+0]]+Mt[n[e+1]]+Mt[n[e+2]]+Mt[n[e+3]]+"-"+Mt[n[e+4]]+Mt[n[e+5]]+"-"+Mt[n[e+6]]+Mt[n[e+7]]+"-"+Mt[n[e+8]]+Mt[n[e+9]]+"-"+Mt[n[e+10]]+Mt[n[e+11]]+Mt[n[e+12]]+Mt[n[e+13]]+Mt[n[e+14]]+Mt[n[e+15]]).toLowerCase()}const AB=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Hy={randomUUID:AB};function nu(n,e,t){if(Hy.randomUUID&&!e&&!n)return Hy.randomUUID();n=n||{};const r=n.random||(n.rng||EB)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let i=0;i<16;++i)e[t+i]=r[i];return e}return _B(r)}var mw={exports:{}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function i(c,l,u){this.fn=c,this.context=l,this.once=u||!1}function s(c,l,u,h,p){if(typeof u!="function")throw new TypeError("The listener must be a function");var f=new i(u,h||c,p),d=t?t+l:l;return c._events[d]?c._events[d].fn?c._events[d]=[c._events[d],f]:c._events[d].push(f):(c._events[d]=f,c._eventsCount++),c}function o(c,l){--c._eventsCount===0?c._events=new r:delete c._events[l]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var l=[],u,h;if(this._eventsCount===0)return l;for(h in u=this._events)e.call(u,h)&&l.push(t?h.slice(1):h);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(u)):l},a.prototype.listeners=function(l){var u=t?t+l:l,h=this._events[u];if(!h)return[];if(h.fn)return[h.fn];for(var p=0,f=h.length,d=new Array(f);p<f;p++)d[p]=h[p].fn;return d},a.prototype.listenerCount=function(l){var u=t?t+l:l,h=this._events[u];return h?h.fn?1:h.length:0},a.prototype.emit=function(l,u,h,p,f,d){var y=t?t+l:l;if(!this._events[y])return!1;var _=this._events[y],S=arguments.length,I,B;if(_.fn){switch(_.once&&this.removeListener(l,_.fn,void 0,!0),S){case 1:return _.fn.call(_.context),!0;case 2:return _.fn.call(_.context,u),!0;case 3:return _.fn.call(_.context,u,h),!0;case 4:return _.fn.call(_.context,u,h,p),!0;case 5:return _.fn.call(_.context,u,h,p,f),!0;case 6:return _.fn.call(_.context,u,h,p,f,d),!0}for(B=1,I=new Array(S-1);B<S;B++)I[B-1]=arguments[B];_.fn.apply(_.context,I)}else{var j=_.length,U;for(B=0;B<j;B++)switch(_[B].once&&this.removeListener(l,_[B].fn,void 0,!0),S){case 1:_[B].fn.call(_[B].context);break;case 2:_[B].fn.call(_[B].context,u);break;case 3:_[B].fn.call(_[B].context,u,h);break;case 4:_[B].fn.call(_[B].context,u,h,p);break;default:if(!I)for(U=1,I=new Array(S-1);U<S;U++)I[U-1]=arguments[U];_[B].fn.apply(_[B].context,I)}}return!0},a.prototype.on=function(l,u,h){return s(this,l,u,h,!1)},a.prototype.once=function(l,u,h){return s(this,l,u,h,!0)},a.prototype.removeListener=function(l,u,h,p){var f=t?t+l:l;if(!this._events[f])return this;if(!u)return o(this,f),this;var d=this._events[f];if(d.fn)d.fn===u&&(!p||d.once)&&(!h||d.context===h)&&o(this,f);else{for(var y=0,_=[],S=d.length;y<S;y++)(d[y].fn!==u||p&&!d[y].once||h&&d[y].context!==h)&&_.push(d[y]);_.length?this._events[f]=_.length===1?_[0]:_:o(this,f)}return this},a.prototype.removeAllListeners=function(l){var u;return l?(u=t?t+l:l,this._events[u]&&o(this,u)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,n.exports=a})(mw);const OB=mw.exports;var SB={exports:{}};(function(n,e){(function(t){var r=this,i=Object.prototype.hasOwnProperty,s=function(c){for(var l=new Array(c.length),u=c.length,h=u-1;u--;)l[h-u]=c[u];return l},o=function(){var c=Array.prototype.slice.call(arguments);return c.length==2?o.find.apply(this,c):o.transform.apply(this,c)};o.find=function(c,l){return o.get(l,c)},o.memoizePath=!0;var a={};o.get=function(c,l,u){if(c===t||c===null||l===t||l===null)return u;var h;for(typeof l=="string"?o.memoizePath?a[l]?h=a[l].slice(0):(h=l.split(".").reverse(),a[l]=h.slice(0)):h=l.split(".").reverse():Array.isArray(l)&&(h=s(l));h.length&&(c=c[h.pop()])!==t&&c!==null;);return c===null&&h.length&&(c=t),c===t?u:c},o.exists=function(c,l){return o.get(c,l)!==t},o.set=function(c,l,u,h){var p=Array.isArray(l)?l:l.split("."),f=c,d,y=p.length;if(p[0]!=="__proto__"){if(typeof f!="object")throw new Error("Parent is not an object.");for(var _=0;_<y;_++)if(d=p[_],(!i.call(f,d)||f[d]===t||(typeof f[d]!="object"||f[d]===null)&&h&&h.force===!0)&&(f[d]={}),_==y-1)f[d]=u;else{if(typeof f[d]!="object"||f[d]===null)throw new Error('Target key "'+d+'" is not suitable for a nested value. (It is in use as non-object. Set `force` to `true` to override.)');f=f[d]}f[d]=u}},o.default=function(c,l,u){o.get(c,l)===t&&o.set(c,l,u)},o.transform=function(l,u){if(Array.isArray(l))return l.map(function(U){return o.transform(U,u)});u=u||{},u.delimiter=u.delimiter||".";var h,p,f,d,y={},_,S=Object.keys(l),I=S.length,B;for(B=0;B<I;B++)if(_=S[B],_.indexOf(u.delimiter)!==-1){if(h=_.split(u.delimiter),h[0]==="__proto__")break;p=h.length,d=y;for(var j=0;j<p&&(f=h[j],j!=p-1&&!d.hasOwnProperty(f)&&(d[f]={}),j==p-1&&(d[f]=l[_]),d=d[f],d!==null);j++);}else y[_]=l[_];return y},o.flatten=function(c,l){typeof l=="undefined"&&(l=".");var u={},h,p;for(var f in c)if(i.call(c,f))if(h=c[f],Object.prototype.toString.call(h)==="[object Object]"){p=o.flatten(h,l);for(var d in p)u[f+l+d]=p[d]}else u[f]=h;return u},o.paths=function(c,l){var u=[],h,p;if(l=l||[],typeof c=="object")for(p in c)h=c[p],typeof h=="object"&&h!==null?u=u.concat(o.paths(h,l.concat([p]))):u.push(l.concat(p).join("."));else throw new Error("Paths was called with non-object argument.");return u},n.exports?n.exports=o:(r.Dottie=o,r.Dot=o,typeof t=="function"&&t([],function(){return o}))})()})(SB);function ru(n,e){try{n(e)}catch(t){console.error("Error in subscription callback",t)}}const Qr=Symbol("subscriptions"),Xr=Symbol("oneTimeEvents");class gs{constructor(){this[Qr]=[],this[Xr]=new Map}on(e,t){return this[Xr].has(e)?ru(t,this[Xr].get(e)):(this[Qr].push({event:e,callback:t,once:!1}),this)}off(e,t){return this[Qr]=this[Qr].filter(r=>r.event!==e||t&&r.callback!==t),this}once(e,t){return new Promise(r=>{const i=s=>{r(s),t==null||t(s)};this[Xr].has(e)?ru(i,this[Xr].get(e)):this[Qr].push({event:e,callback:i,once:!0})})}emit(e,t){if(this[Xr].has(e))throw new Error(`Event "${e}" was supposed to be emitted only once`);for(let r=0;r<this[Qr].length;r++){const i=this[Qr][r];i.event===e&&(ru(i.callback,t),i.once&&(this[Qr].splice(r,1),r--))}return this}emitOnce(e,t){if(this[Xr].has(e))throw new Error(`Event "${e}" was supposed to be emitted only once`);return this.emit(e,t),this[Xr].set(e,t),this.off(e),this}pipe(e,t){this.on(e,r=>{t.emit(e,r)})}pipeOnce(e,t){this.once(e,r=>{t.emitOnce(e,r)})}}function Zr(n){return n=n.replace(/\[/g,"/[").replace(/^\/+/,"").replace(/\/+$/,""),n.length===0?[]:n.split("/").map(t=>t.startsWith("[")?parseInt(t.slice(1,-1)):t)}class G{static get(e){return new G(e)}static getChildPath(e,t){return G.get(e).child(t).path}static getPathKeys(e){return Zr(e)}constructor(e){typeof e=="string"?this.keys=Zr(e):e instanceof Array&&(this.keys=e),this.path=this.keys.reduce((t,r,i)=>i===0?`${r}`:typeof r=="string"?`${t}/${r}`:`${t}[${r}]`,"")}get key(){return this.keys.length===0?null:this.keys.slice(-1)[0]}get parent(){if(this.keys.length==0)return null;const e=this.keys.slice(0,-1);return new G(e)}get parentPath(){return this.keys.length===0?null:this.parent.path}child(e){if(typeof e=="string"){if(e.length===0)throw new Error(`child key for path "${this.path}" cannot be empty`);const t=Zr(e);t.forEach(r=>{if(typeof r=="string"){if(/[\x00-\x08\x0b\x0c\x0e-\x1f/[\]\\]/.test(r))throw new Error(`Invalid child key "${r}" for path "${this.path}". Keys cannot contain control characters or any of the following characters: \\ / [ ]`);if(r.length>128)throw new Error(`child key "${r}" for path "${this.path}" is too long. Max key length is 128`);if(r.length===0)throw new Error(`child key for path "${this.path}" cannot be empty`)}}),e=t}return new G(this.keys.concat(e))}childPath(e){return this.child(e).path}get pathKeys(){return this.keys}static extractVariables(e,t){if(!e.includes("*")&&!e.includes("$"))return[];const r=Zr(e),i=Zr(t);let s=0;const o={get length(){return s}};return r.forEach((a,c)=>{const l=i[c];if(a==="*")o[s++]=l;else if(typeof a=="string"&&a[0]==="$"){o[s++]=l,o[a]=l;const u=a.slice(1);typeof o[u]=="undefined"&&(o[u]=l)}}),o}static fillVariables(e,t){if(e.indexOf("*")<0&&e.indexOf("$")<0)return e;const r=Zr(e),i=Zr(t),s=r.map((a,c)=>{if(a===i[c]||c>=i.length)return a;if(typeof a=="string"&&(a==="*"||a[0]==="$"))return i[c];throw new Error(`Path "${t}" cannot be used to fill variables of path "${e}" because they do not match`)});let o="";return s.forEach(a=>{typeof a=="number"?o+=`[${a}]`:(o.length>0&&(o+="/"),o+=a)}),o}static fillVariables2(e,t){if(typeof t!="object"||Object.keys(t).length===0)return e;const r=Zr(e);let i=0;return r.reduce((o,a)=>typeof a=="string"&&(a==="*"||a.startsWith("$"))?G.getChildPath(o,t[i++]):G.getChildPath(o,a),"")}equals(e){const t=e instanceof G?e:new G(e);return this.path===t.path?!0:this.keys.length!==t.keys.length?!1:this.keys.every((r,i)=>{const s=t.keys[i];return s===r||typeof s=="string"&&(s==="*"||s[0]==="$")||typeof r=="string"&&(r==="*"||r[0]==="$")})}isAncestorOf(e){const t=e instanceof G?e:new G(e);return t.path===""||this.path===t.path?!1:this.path===""?!0:this.keys.length>=t.keys.length?!1:this.keys.every((r,i)=>{const s=t.keys[i];return s===r||typeof s=="string"&&(s==="*"||s[0]==="$")||typeof r=="string"&&(r==="*"||r[0]==="$")})}isDescendantOf(e){const t=e instanceof G?e:new G(e);return this.path===""||this.path===t.path?!1:e===""?!0:t.keys.length>=this.keys.length?!1:t.keys.every((r,i)=>{const s=this.keys[i];return s===r||typeof s=="string"&&(s==="*"||s[0]==="$")||typeof r=="string"&&(r==="*"||r[0]==="$")})}isOnTrailOf(e){const t=e instanceof G?e:new G(e);return this.path.length===0||t.path.length===0||this.path===t.path?!0:this.pathKeys.every((r,i)=>{if(i>=t.keys.length)return!0;const s=t.keys[i];return s===r||typeof s=="string"&&(s==="*"||s[0]==="$")||typeof r=="string"&&(r==="*"||r[0]==="$")})}isChildOf(e){const t=e instanceof G?e:new G(e);return this.path===""?!1:this.parent.equals(t)}isParentOf(e){const t=e instanceof G?e:new G(e);return t.path===""?!1:this.equals(t.parent)}}function iu(n,e,t=!1){if(!n.exists())return null;let r=t?n.previous():n.val();return typeof e=="number"?r[e]:(G.getPathKeys(e).every(i=>(r=r[i],typeof r!="undefined")),r||null)}function su(n){if(!n.exists())return[];const e=n.val();return e instanceof Array?new Array(e.length).map((t,r)=>r):typeof e=="object"?Object.keys(e):[]}class at{exists(){return!1}constructor(e,t,r=!1,i,s){this.ref=e,this.val=()=>t,this.previous=()=>i,this.exists=()=>r?!1:t!==null&&typeof t!="undefined",this.context=()=>s||{}}static for(e,t){return new at(e,t)}child(e){const t=iu(this,e,!1),r=iu(this,e,!0);return new at(this.ref.child(e),t,!1,r)}hasChild(e){return iu(this,e)!==null}hasChildren(){return su(this).length>0}numChildren(){return su(this).length}forEach(e){const t=this.val(),r=this.previous();return su(this).every(i=>{const s=new at(this.ref.child(i),t[i],!1,r[i]);return e(s)})}get key(){return this.ref.key}}class Ua extends at{constructor(e,t,r){super(e,t,!1,void 0,r),this.previous=()=>{throw new Error("Iterate values to get previous values for each mutation")},this.val=(i=!0)=>(i&&console.warn("Unless you know what you are doing, it is best not to use the value of a mutations snapshot directly. Use child methods and forEach to iterate the mutations instead"),t)}forEach(e){return this.val(!1).every(r=>{const i=r.target.reduce((o,a)=>o.child(a),this.ref),s=new at(i,r.val,!1,r.prev);return e(s)})}child(e){if(typeof e!="number")throw new Error("child index must be a number");const t=this.val(!1)[e],r=t.target.reduce((i,s)=>i.child(s),this.ref);return new at(r,t.val,!1,t.prev)}}class vw{constructor(e){this.stop=e,this._internal={state:"init",activatePromises:[]}}activated(e){return e&&(this._internal.activatePromises.push({callback:e}),this._internal.state==="active"?e(!0):this._internal.state==="canceled"&&e(!1,this._internal.cancelReason)),new Promise((t,r)=>{if(this._internal.state==="active")return t();if(this._internal.state==="canceled"&&!e)return r(new Error(this._internal.cancelReason));const i=()=>{};this._internal.activatePromises.push({resolve:t,reject:e?i:r})})}_setActivationState(e,t){for(this._internal.cancelReason=t,this._internal.state=e?"active":"canceled";this._internal.activatePromises.length>0;){const r=this._internal.activatePromises.shift();e?(r.callback&&r.callback(!0),r.resolve&&r.resolve()):(r.callback&&r.callback(!1,t),r.reject&&r.reject(t))}}}class $B{constructor(e,t,r){this.publish=e,this.start=t,this.cancel=r}}class TB{constructor(e){const t=[];let r,i;const s="stopped (no more subscribers)";this.subscribe=(h,p)=>{if(typeof h!="function")throw new TypeError("callback must be a function");if(i===s)throw new Error("stream can't be used anymore because all subscribers were stopped");const f={callback:h,activationCallback:function(d,y){p==null||p(d,y),this.subscription._setActivationState(d,y)},subscription:new vw(function(){return t.splice(t.indexOf(this),1),o()})};return t.push(f),typeof i!="undefined"&&(i===!0?(p==null||p(!0),f.subscription._setActivationState(!0)):typeof i=="string"&&(p==null||p(!1,i),f.subscription._setActivationState(!1,i))),f.subscription};const o=()=>{let h;return t.length===0&&(h=r==null?void 0:r(),i=s),Promise.resolve(h)};this.unsubscribe=h=>{(h?t.filter(f=>f.callback===h):t).forEach(f=>{const d=t.indexOf(f);t.splice(d,1)}),o()},this.stop=()=>{t.splice(0),o()};const a=h=>(t.forEach(p=>{try{p.callback(h)}catch(f){console.error(`Error running subscriber callback: ${f.message}`)}}),t.length===0&&o(),t.length>0),c=h=>{i=!0,r=h,t.forEach(p=>{var f;(f=p.activationCallback)==null||f.call(p,!0)})},l=h=>{i=h,t.forEach(p=>{var f;(f=p.activationCallback)==null||f.call(p,!1,h||new Error("unknown reason"))}),t.splice(0)},u=new $B(a,c,l);e(u)}}function hd(n,e){const t="000000000"+n;return t.substr(t.length-e)}const PB=typeof window=="object"?window:self,IB=Object.keys(PB).length;var yg,gg;const RB=(gg=(yg=navigator.mimeTypes)==null?void 0:yg.length)!=null?gg:0,CB=hd((RB+navigator.userAgent.length).toString(36)+IB.toString(36),4);function NB(){return CB}let js=0;const fd=4,ic=36,bw=Math.pow(ic,fd);function Jy(){return hd((Math.random()*bw<<0).toString(ic),fd)}function jB(){return js=js<bw?js:0,js++,js-1}function BB(n=0){const e="c",t=(new Date().getTime()+n).toString(ic),r=hd(jB().toString(ic),fd),i=NB(),s=Jy()+Jy();return e+t+r+i+s}let Yy=0;class Wt{static set timeBias(e){typeof e=="number"&&(Yy=e)}static generate(){return BB(Yy).slice(1)}}class ct{constructor(e){this.path=e}}const Rn={nextTick(n){setTimeout(n,0)}};class sc{constructor(e){if(e instanceof Array)for(let t=0;t<e.length;t++)typeof e[t]!="undefined"&&(this[t]=e[t]);else e&&Object.assign(this,e)}}function LB(n){const e=new Uint8Array(8);return new DataView(e.buffer).setFloat64(0,n),new Array(...e)}function DB(n){if((Array.isArray(n)?n.length:n.byteLength)!==8)throw new TypeError("must be 8 bytes");const t=new Uint8Array(n);return new DataView(t.buffer).getFloat64(0)}const si={zero:BigInt(0),one:BigInt(1),two:BigInt(2),eight:BigInt(8),ff:BigInt(255)};function UB(n){if(typeof n!="bigint")throw new Error("number must be a bigint");const e=[],t=n<si.zero;do{const r=Number(n&si.ff);e.push(r),n=n>>si.eight}while(n!==(t?-si.one:si.zero));return e.reverse(),(t?e[0]<128:e[0]>=128)&&e.unshift(t?255:0),e}function FB(n){const e=n[0]>=128;let t=si.zero;for(let r of n)e&&(r=~r&255),t=(t<<si.eight)+BigInt(r);return e&&(t=-(t+si.one)),t}function MB(n){if(typeof TextEncoder!="undefined")return new TextEncoder().encode(n);if(typeof Buffer=="function"){const e=Buffer.from(n,"utf-8");return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}else{const e=[];for(let t=0;t<n.length;t++){let r=n.charCodeAt(t);if(r>128){if((r&55296)===55296){const i=n.charCodeAt(t+1);if((i&56320)!==56320)throw new Error("follow-up utf-16 character does not start with 0xDC00");t++;const s=r&1023,o=i&1023;r=65536|s<<10|o}if(r<2048){const i=192|r>>6&31,s=128|r&63;e.push(i,s)}else if(r<65536){const i=224|r>>12&15,s=128|r>>6&63,o=128|r&63;e.push(i,s,o)}else if(r<2097152){const i=240|r>>18&7,s=128|r>>12&63,o=128|r>>6&63,a=128|r&63;e.push(i,s,o,a)}else throw new Error(`Cannot convert character ${n.charAt(t)} (code ${r}) to utf-8`)}else e.push(r<128?r:63)}return new Uint8Array(e)}}function ww(n){if(typeof TextDecoder!="undefined"){const e=new TextDecoder;if(n instanceof Uint8Array)return e.decode(n);const t=Uint8Array.from(n);return e.decode(t)}else if(typeof Buffer=="function"){if(n instanceof Array&&(n=Uint8Array.from(n)),!(n instanceof Buffer)&&"buffer"in n&&n.buffer instanceof ArrayBuffer){const e=n;n=Buffer.from(e.buffer,e.byteOffset,e.byteLength)}if(!(n instanceof Buffer))throw new Error("Unsupported buffer argument");return n.toString("utf-8")}else{if(!(n instanceof Uint8Array)&&"buffer"in n&&n.buffer instanceof ArrayBuffer){const e=n;n=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}if(n instanceof Buffer||n instanceof Array||n instanceof Uint8Array){let e="";for(let t=0;t<n.length;t++){let r=n[t];if(r>128)if((r&240)===240){const i=r,s=n[t+1],o=n[t+2],a=n[t+3];r=(i&7)<<18|(s&63)<<12|(o&63)<<6|a&63,t+=3}else if((r&224)===224){const i=r,s=n[t+1],o=n[t+2];r=(i&15)<<12|(s&63)<<6|o&63,t+=2}else if((r&192)===192){const i=r,s=n[t+1];r=(i&31)<<6|s&63,t++}else throw new Error("invalid utf-8 data");if(r>=65536){r^=65536;const i=55296|r>>10,s=56320|r&1023;e+=String.fromCharCode(i),e+=String.fromCharCode(s)}else e+=String.fromCharCode(r)}return e}else throw new Error("Unsupported buffer argument")}}function qB(n,e){const t=new n.constructor(n.length+e.length);return t.set(n),t.set(e,n.length),t}function Hn(n,e){var s;if(((s=n==null?void 0:n.constructor)==null?void 0:s.name)==="DataSnapshot")throw new TypeError(`Object to clone is a DataSnapshot (path "${n.ref.path}")`);const t=o=>(o!==null&&typeof o=="object"&&typeof o.constructor=="function"&&typeof o.constructor.name=="string"&&["Buffer","Uint8Array","Int8Array","Uint16Array","Int16Array","Uint32Array","Int32Array","BigUint64Array","BigInt64Array"].includes(o.constructor.name)&&(o=o.buffer.slice(o.byteOffset,o.byteOffset+o.byteLength)),o);if(n=t(n),typeof n!="object"||n===null||n instanceof Date||n instanceof ArrayBuffer||n instanceof ct||n instanceof RegExp)return n;const r=o=>{if(e.indexOf(o)>=0)throw new ReferenceError("object contains a circular reference");return o=t(o),o===null||o instanceof Date||o instanceof ArrayBuffer||o instanceof ct||o instanceof RegExp||typeof o=="object"&&(e.push(o),o=Hn(o,e),e.pop()),o};typeof e=="undefined"&&(e=[n]);const i=n instanceof Array?[]:n instanceof sc?new sc:{};return Object.keys(n).forEach(o=>{const a=n[o];typeof a!="function"&&(i[o]=r(a))}),i}const ui=n=>typeof n=="object"&&["ArrayBuffer","Buffer","Uint8Array","Uint16Array","Uint32Array","Int8Array","Int16Array","Int32Array"].includes(n.constructor.name);function oc(n,e){if(n===e)return!0;if(typeof n!=typeof e)return!1;if(typeof n=="object"||typeof e=="object"){if(n===null||e===null)return!1;if(n instanceof ct||e instanceof ct)return n instanceof ct&&e instanceof ct&&n.path===e.path;if(n instanceof Date||e instanceof Date)return n instanceof Date&&e instanceof Date&&n.getTime()===e.getTime();if(n instanceof Array||e instanceof Array)return n instanceof Array&&e instanceof Array&&n.length===e.length&&n.every((i,s)=>oc(n[s],e[s]));if(ui(n)||ui(e)){if(!ui(n)||!ui(e)||n.byteLength===e.byteLength)return!1;const i=n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength),s=e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength);return i.every((o,a)=>s[a]===o)}const t=Object.keys(n),r=Object.keys(e);return t.length===r.length&&t.every(i=>r.includes(i))&&t.every(i=>oc(n[i],e[i]))}return!1}class kw{constructor(e,t,r){this.added=e,this.removed=t,this.changed=r}forChild(e){if(this.added.includes(e))return"added";if(this.removed.includes(e))return"removed";const t=this.changed.find(r=>r.key===e);return t?t.change:"identical"}}function dd(n,e,t=!1){const r=[void 0,null];if(n===e)return"identical";if(r.indexOf(n)>=0&&r.indexOf(e)<0)return"added";if(r.indexOf(n)<0&&r.indexOf(e)>=0)return"removed";if(typeof n!=typeof e)return"changed";if(ui(n)||ui(e)){if(!ui(n)||!ui(e))return"changed";const i=n instanceof Uint8Array?n:n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength),s=e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength);return i.byteLength===s.byteLength&&i.every((o,a)=>s[a]===o)?"identical":"changed"}else{if(n instanceof Date||e instanceof Date)return n instanceof Date&&e instanceof Date&&n.getTime()===e.getTime()?"identical":"changed";if(n instanceof ct||e instanceof ct)return n instanceof ct&&e instanceof ct&&n.path===e.path?"identical":"changed";if(typeof n=="object"){const i=n instanceof Array,s=h=>{let p=Object.keys(h).filter(f=>!r.includes(h[f]));return i&&(p=p.map(f=>parseInt(f))),p},o=s(n),a=s(e),c=o.filter(h=>!a.includes(h)),l=a.filter(h=>!o.includes(h)),u=a.reduce((h,p)=>{if(o.includes(p)){const f=n[p],d=e[p],y=dd(f,d);y!=="identical"&&h.push({key:p,change:y})}return h},[]);return l.length===0&&c.length===0&&u.length===0?"identical":new kw(l,c,t?u.sort((h,p)=>h.key<p.key?-1:1):u)}}return"changed"}function xw(n,e,t=!1){const r=(s,o,a,c)=>{switch(o){case"identical":return[];case"changed":return[{target:s,prev:a,val:c}];case"added":return[{target:s,prev:null,val:c}];case"removed":return[{target:s,prev:a,val:null}];default:{let l=[];return o.added.forEach(u=>l.push({target:s.concat(u),prev:null,val:c[u]})),o.removed.forEach(u=>l.push({target:s.concat(u),prev:a[u],val:null})),o.changed.forEach(u=>{const h=r(s.concat(u.key),u.change,a[u.key],c[u.key]);l=l.concat(h)}),l}}},i=dd(n,e,t);return r([],i,n,e)}function VB(n,e,t){return e=e===null?null:e[n],typeof e=="undefined"&&(e=null),t=t===null?null:t[n],typeof t=="undefined"&&(t=null),{oldValue:e,newValue:t}}function KB(n){Rn.nextTick(n)}function Ew(){var n;return typeof globalThis!="undefined"?globalThis:typeof global!="undefined"?global:typeof window!="undefined"?window:typeof self!="undefined"?self:(n=function(){return this}())!=null?n:Function("return this")()}const _w=Object.freeze(Object.defineProperty({__proto__:null,numberToBytes:LB,bytesToNumber:DB,bigintToBytes:UB,bytesToBigint:FB,encodeString:MB,decodeString:ww,concatTypedArrays:qB,cloneObject:Hn,valuesAreEqual:oc,ObjectDifferences:kw,compareValues:dd,getMutations:xw,getChildValues:VB,defer:KB,getGlobalObject:Ew},Symbol.toStringTag,{value:"Module"})),WB="modulepreload",zB=function(n){return"/"+n},Gy={},HB=function(e,t,r){if(!t||t.length===0)return e();const i=document.getElementsByTagName("link");return Promise.all(t.map(s=>{if(s=zB(s),s in Gy)return;Gy[s]=!0;const o=s.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let u=i.length-1;u>=0;u--){const h=i[u];if(h.href===s&&(!o||h.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${a}`))return;const l=document.createElement("link");if(l.rel=o?"stylesheet":WB,o||(l.as="script",l.crossOrigin=""),l.href=s,document.head.appendChild(l),o)return new Promise((u,h)=>{l.addEventListener("load",u),l.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e())};let Aw=!1,di;V(void 0,null,function*(){const n=Ew();if(typeof n.Observable!="undefined"){di=n.Observable;return}try{const{Observable:e}=yield HB(()=>Promise.resolve().then(()=>WF),void 0);di=e}catch(e){di=yd}});function pd(){if(di===yd&&!Aw&&console.warn(`Using AceBase's simple Observable implementation because rxjs is not available. Add it to your project with "npm install rxjs", add it to AceBase using db.setObservable(Observable), or call db.setObservable("shim") to suppress this warning`),di)return di;throw new Error("RxJS Observable could not be loaded. ")}function JB(n){n==="shim"?(di=yd,Aw=!0):di=n}class yd{constructor(e){this._active=!1,this._subscribers=[],this._create=e}subscribe(e){if(!this._active){const s={next:o=>{this._subscribers.forEach(a=>{try{a(o)}catch(c){console.error("Error in subscriber callback:",c)}})}};this._cleanup=this._create(s),this._active=!0}return this._subscribers.push(e),{unsubscribe:()=>{this._subscribers.splice(this._subscribers.indexOf(e),1),this._subscribers.length===0&&(this._active=!1,this._cleanup())}}}}class En extends Array{static areEqual(e,t){return e.length===t.length&&e.every((r,i)=>t[i]===r)}static isAncestor(e,t){return e.length<t.length&&e.every((r,i)=>t[i]===r)}static isDescendant(e,t){return e.length>t.length&&t.every((r,i)=>e[i]===r)}}const Oi=Symbol("isProxy");class YB{static create(e,t){return V(this,null,function*(){var E;e=new Xn(e.db,e.path);let r,i=!1,s=t==null?void 0:t.cursor,o;const a=Wt.generate(),c=[],l=new gs;l.on("cursor",v=>s=v),l.on("error",v=>{console.error(v.message,v.details)});const u=(v,g)=>{if(v.length===0)return r=g,!0;let k=r;const x=v.slice();for(;x.length>1;){const w=x.shift();if(!(w in k))return!1;k=k[w]}const b=x.shift();return g===null?k instanceof Array?k.splice(b,1):delete k[b]:k[b]=g,!0},h=()=>V(this,null,function*(){!i||(yield C())}),p=e.on("mutations",{syncFallback:h}).subscribe(v=>V(this,null,function*(){var w;if(!i)return;const g=v.context(),k=((w=g.acebase_proxy)==null?void 0:w.id)!==a;if(!k)return;v.val(!1).every(A=>{if(!u(A.target,A.val))return!1;const O=A.target.reduce((P,N)=>P.child(N),e),$=new at(O,A.val,!1,A.prev,v.context());return l.emit("mutation",{snapshot:$,isRemote:k}),!0})?(l.emit("cursor",g.acebase_cursor),H.emit("mutations",{origin:"remote",snap:v})):(console.warn(`Cached value of live data proxy on "${e.path}" appears outdated, will be reloaded`),yield C())}));let f=Promise.resolve();const d=[],y=[],_=()=>V(this,null,function*(){const v=[];for(let g=0,k=d[0];g<d.length;g++,k=d[g])y.find(x=>En.areEqual(x.target,k.target)||En.isAncestor(x.target,k.target))||(d.splice(g,1),g--,v.push(k));v.length!==0&&(v.forEach(g=>{g.value=Hn(Sn(r,g.target))}),Rn.nextTick(()=>{const g={acebase_proxy:{id:a,source:"update"}};v.forEach(x=>{const b=x.target.reduce((A,O)=>A.child(O),e),w=new at(b,x.value,!1,x.previous,g);l.emit("mutation",{snapshot:w,isRemote:!1})});const k=new Ua(e,v.map(x=>({target:x.target,val:x.value,prev:x.previous})),g);H.emit("mutations",{origin:"local",snap:k})}),f=v.reduce((g,k,x,b)=>(b.some(w=>En.isAncestor(w.target,k.target))||g.push(k),g),[]).reduce((g,k)=>{const x=k.target;if(x.length===0)g.push({ref:e,target:x,value:r,type:"set",previous:k.previous});else{const b=x.slice(0,-1),w=x.slice(-1)[0],A=b.reduce((N,D)=>N.child(D),e),O=g.find(N=>N.ref.path===A.path),$=Sn(r,x),P=k.previous;O?(O.value[w]=$,O.previous[w]=P):g.push({ref:A,target:b,value:{[w]:$},type:"update",previous:{[w]:P}})}return g},[]).reduce((g,k)=>V(this,null,function*(){const x={acebase_proxy:{id:a,source:k.type}};yield g,yield k.ref.context(x)[k.type](k.value).catch(b=>{l.emit("error",{source:"update",message:`Error processing update of "/${e.path}"`,details:b});const w={acebase_proxy:{id:a,source:"update-rollback"}},A=[];if(k.type==="set"){ou(r,k.target,k.previous);const $=new at(k.ref,k.previous,!1,k.value,w);l.emit("mutation",{snapshot:$,isRemote:!1}),A.push({target:k.target,val:k.previous,prev:k.value})}else Object.keys(k.previous).forEach($=>{ou(r,k.target.concat($),k.previous[$]);const P=new at(k.ref.child($),k.previous[$],!1,k.value[$],w);l.emit("mutation",{snapshot:P,isRemote:!1}),A.push({target:k.target.concat($),val:k.previous[$],prev:k.value[$]})});A.forEach($=>{const P=$.target.reduce((D,z)=>D.child(z),e),N=new at(P,$.val,!1,$.prev,w);l.emit("mutation",{snapshot:N,isRemote:!1})});const O=new Ua(k.ref,A,w);H.emit("mutations",{origin:"local",snap:O})}),k.ref.cursor&&l.emit("cursor",k.ref.cursor)}),f),yield f)});let S=!1;const I=[],B=()=>{let v;const g=new Promise(k=>v=k);return I.push({resolve:v}),g};let j=null;const U=()=>{j||(j=setTimeout(()=>V(this,null,function*(){S=!0,j=null,yield _(),S=!1,I.splice(0).forEach(v=>v.resolve())}),0))},M=v=>{d.find(g=>En.areEqual(g.target,v))||d.push({target:v,previous:Hn(Sn(r,v))}),U()},H=new gs,L=(v,g)=>{const k=w=>w!==null&&typeof w=="object",x=w=>V(this,null,function*(){var ne;const{snap:A,origin:O}=w,$=A.context(),P=((ne=$.acebase_proxy)==null?void 0:ne.id)===a;if(w.origin==="remote"&&P){console.error("DEV ISSUE: mutationsHandler was called from remote event originating from our own proxy");return}const N=A.val(!1).filter(te=>te.target.slice(0,v.length).every((ue,le)=>v[le]===ue));if(N.length===0)return;let D,z;const q=N.find(te=>te.target.length<=v.length);if(q){const te=v.slice(q.target.length);D=te.reduce((ue,le)=>!k(ue)||!(le in ue)?null:ue[le],q.val),z=te.reduce((ue,le)=>!k(ue)||!(le in ue)?null:ue[le],q.prev)}else{const te=Sn(r,v);D=Hn(te),z=Hn(D),N.forEach(ue=>{const le=ue.target.slice(v.length);for(let ie=0,pe=D,ke=z;ie<le.length;ie++){const ve=ie+1===le.length,ze=le[ie];ve?(pe[ze]=ue.val,pe[ze]===null&&delete pe[ze],ke[ze]=ue.prev,ke[ze]===null&&delete ke[ze]):(pe=pe[ze]=ze in pe?pe[ze]:{},ke=ke[ze]=ze in ke?ke[ze]:{})}})}Rn.nextTick(()=>{let te=!0;try{te=g(Object.freeze(D),Object.freeze(z),!P,$)!==!1}catch(ue){l.emit("error",{source:O==="remote"?"remote_update":"local_update",message:"Error running subscription callback",details:ue})}te===!1&&b()})});H.on("mutations",x);const b=()=>{H.off("mutations",x),c.splice(c.findIndex(w=>w.stop===b),1)};return c.push({target:v,stop:b}),{stop:b}},F=(v,g,k)=>{if(v==="write")return M(g);if(v==="onChange")return L(g,k.callback);if(v==="subscribe"||v==="observe"){const x=w=>{const A=Sn(r,g);w.next(A);const O=L(g,$=>{w.next($)});return function(){O.stop()}};if(v==="subscribe")return x;const b=pd();return new b(x)}else if(v==="transaction")return y.some(b=>En.areEqual(g,b.target)||En.isAncestor(g,b.target)||En.isDescendant(g,b.target))?Promise.reject(new Error("Cannot start transaction because it conflicts with another transaction")):new Promise(b=>V(this,null,function*(){d.some($=>En.areEqual(g,$.target)||En.isAncestor(g,$.target))&&(S||U(),yield B());const A={target:g,status:"started",transaction:null};y.push(A),A.transaction={get status(){return A.status},get completed(){return A.status!=="started"},get mutations(){return d.filter($=>En.areEqual(A.target,$.target)||En.isAncestor(A.target,$.target))},get hasMutations(){return this.mutations.length>0},commit(){return V(this,null,function*(){if(this.completed)throw new Error(`Transaction has completed already (status '${A.status}')`);A.status="finished",y.splice(y.indexOf(A),1),S&&(yield B()),U(),yield B()})},rollback(){if(this.completed)throw new Error(`Transaction has completed already (status '${A.status}')`);A.status="canceled";const $=[];for(let P=0;P<d.length;P++){const N=d[P];(En.areEqual(A.target,N.target)||En.isAncestor(A.target,N.target))&&(d.splice(P,1),P--,$.push(N))}$.reverse().forEach(P=>{P.target.length===0?r=P.previous:ou(r,P.target,P.previous)}),y.splice(y.indexOf(A),1)}},b(A.transaction)}))},T=yield e.get({cache_mode:"allow",cache_cursor:t==null?void 0:t.cursor});if(T.context().acebase_origin!=="cache"&&l.emit("cursor",(E=e.cursor)!=null?E:null),i=!0,r=T.val(),r===null&&typeof(t==null?void 0:t.defaultValue)!="undefined"){r=t.defaultValue;const v={acebase_proxy:{id:a,source:"default"}};yield e.context(v).set(r)}o=Ow({root:{ref:e,get cache(){return r}},target:[],id:a,flag:F});const R=()=>{if(o===null)throw new Error("Proxy was destroyed")},C=()=>V(this,null,function*(){R(),d.splice(0);const v=yield e.get({allow_cache:!1}),g=r,k=v.val();r=k;const x=xw(g,k);if(x.length===0)return;const b=v.context();b.acebase_proxy={id:a,source:"reload"},x.forEach(A=>{const O=Oh(e,A.target),$=new at(O,A.val,A.val===null,A.prev,b);l.emit("mutation",{snapshot:$,isRemote:!0})});const w=new Ua(e,x,b);H.emit("mutations",{origin:"local",snap:w})});return{destroy(){return V(this,null,function*(){yield f;const v=[p.stop(),...c.map(g=>g.stop())];yield Promise.all(v),["cursor","mutation","error"].forEach(g=>l.off(g)),r=null,o=null})},stop(){this.destroy()},get value(){return R(),o},get hasValue(){return R(),r!==null},set value(v){R(),v!==null&&typeof v=="object"&&v[Oi]&&(v=v.valueOf()),M([]),r=v},get ref(){return e},get cursor(){return s},reload:C,onMutation(v){R(),l.off("mutation"),l.on("mutation",({snapshot:g,isRemote:k})=>{try{v(g,k)}catch(x){l.emit("error",{source:"mutation_callback",message:"Error in dataproxy onMutation callback",details:x})}})},onError(v){R(),l.off("error"),l.on("error",g=>{try{v(g)}catch(k){console.error(`Error in dataproxy onError callback: ${k.message}`)}})},on(v,g){l.on(v,g)},off(v,g){l.off(v,g)}}})}}function Sn(n,e){let t=n;for(const r of e)t=typeof t=="object"&&t!==null&&r in t?t[r]:null;return t}function ou(n,e,t){if(e.length===0)throw new Error("Cannot update root target, caller must do that itself!");const r=e.slice(0,-1).reduce((s,o)=>s[o],n),i=e.slice(-1)[0];t===null||typeof t=="undefined"?r instanceof Array?r.splice(i,1):delete r[i]:r[i]=t}function Oh(n,e){const t=G.get(n.path).childPath(e);return new Xn(n.db,t)}function Ow(n){const e=Oh(n.root.ref,n.target),t=[],r={get(s,o,a){if(s=Sn(n.root.cache,n.target),typeof o=="symbol")if(o.toString()===Symbol.iterator.toString())o="values";else return o.toString()===Oi.toString()?!0:Reflect.get(s,o,a);if(o==="valueOf")return function(){return s};if(s===null||typeof s!="object")throw new Error(`Cannot read property "${o}" of ${s}. Value of path "/${e.path}" is not an object (anymore)`);s instanceof Array&&typeof o=="string"&&/^[0-9]+$/.test(o)&&(o=parseInt(o));const c=s[o];if(c===null){delete s[o];return}const l=t.find(f=>f.prop===o);if(l){if(l.typeof===typeof c)return l.value;t.splice(t.indexOf(l),1)}const u=f=>{const d=s[f],y=t.find(S=>S.prop===f);if(y){if(y.typeof===typeof d)return y.value;t.splice(t.indexOf(y),1)}if(typeof d!="object")return d;const _=Ow({root:n.root,target:n.target.concat(f),id:n.id,flag:n.flag});return t.push({typeof:typeof d,prop:f,value:_}),_},h=f=>f!==null&&typeof f=="object"&&f[Oi]?f.getTarget():f;if(["string","number","boolean"].includes(typeof c)||c instanceof Date||c instanceof ct||c instanceof ArrayBuffer||typeof c=="object"&&"buffer"in c)return c;const p=s instanceof Array;if(o==="toString")return function(){return`[LiveDataProxy for "${e.path}"]`};if(typeof c=="undefined")return o==="push"?function(d){const y=e.push();return n.flag("write",n.target.concat(y.key)),s[y.key]=d,y.key}:o==="getTarget"?function(f=!0){return f&&console.warn("Use getTarget with caution - any changes will not be synchronized!"),s}:o==="getRef"?function(){return Oh(n.root.ref,n.target)}:o==="forEach"?function(d){const y=Object.keys(s);let _=!1;for(let S=0;!_&&S<y.length;S++){const I=y[S],B=u(I);_=d(B,I,S)===!1}}:["values","entries","keys"].includes(o)?function*(){const d=Object.keys(s);for(const y of d)if(o==="keys")yield y;else{const _=u(y);o==="entries"?yield[y,_]:yield _}}:o==="toArray"?function(d){const y=Object.keys(s).map(_=>u(_));return d&&y.sort(d),y}:o==="onChanged"?function(d){return n.flag("onChange",n.target,{callback:d})}:o==="subscribe"?function(){return n.flag("subscribe",n.target)}:o==="getObservable"?function(){return n.flag("observe",n.target)}:o==="getOrderedCollection"?function(d,y){return new GB(this,d,y)}:o==="startTransaction"?function(){return n.flag("transaction",n.target)}:o==="remove"&&!p?function(){if(n.target.length===0)throw new Error("Can't remove proxy root value");const d=Sn(n.root.cache,n.target.slice(0,-1)),y=n.target.slice(-1)[0];n.flag("write",n.target),delete d[y]}:void 0;if(typeof c=="function"){if(p){const f=y=>(n.flag("write",n.target),y()),d=y=>y.map(_=>(_=h(_),Sh(_),_));if(o==="push")return function(..._){return _=d(_),f(()=>s.push(..._))};if(o==="pop")return function(){return f(()=>s.pop())};if(o==="splice")return function(_,S,...I){return I=d(I),f(()=>s.splice(_,S,...I))};if(o==="shift")return function(){return f(()=>s.shift())};if(o==="unshift")return function(..._){return _=d(_),f(()=>s.unshift(..._))};if(o==="sort")return function(_){return f(()=>s.sort(_))};if(o==="reverse")return function(){return f(()=>s.reverse())};if(["indexOf","lastIndexOf"].includes(o))return function(_,S){return _!==null&&typeof _=="object"&&_[Oi]&&(_=_.getTarget(!1)),s[o](_,S)};if(["forEach","every","some","filter","map"].includes(o))return function(_){return s[o]((S,I)=>_(u(I),I,i))};if(["reduce","reduceRight"].includes(o))return function(_,S){return s[o]((I,B,j)=>_(I,u(j),j,i),S)};if(["find","findIndex"].includes(o))return function(_){let S=s[o]((I,B)=>_(u(B),B,i));if(o==="find"&&S){const I=s.indexOf(S);S=u(I)}return S};if(["values","entries","keys"].includes(o))return function*(){for(let _=0;_<s.length;_++)if(o==="keys")yield _;else{const S=u(_);o==="entries"?yield[_,S]:yield S}}}return c}return u(o)},set(s,o,a,c){if(s=Sn(n.root.cache,n.target),typeof o=="symbol")return Reflect.set(s,o,a,c);if(s===null||typeof s!="object")throw new Error(`Cannot set property "${o}" of ${s}. Value of path "/${e.path}" is not an object`);if(s instanceof Array&&typeof o=="string"){if(!/^[0-9]+$/.test(o))throw new Error(`Cannot set property "${o}" on array value of path "/${e.path}"`);o=parseInt(o)}return a!==null&&(typeof a=="object"&&(a[Oi]&&(a=a.valueOf()),a=Hn(a)),oc(a,s[o]))||(n.target.some(l=>typeof l=="number")?n.flag("write",n.target.slice(0,n.target.findIndex(l=>typeof l=="number"))):s instanceof Array?n.flag("write",n.target):n.flag("write",n.target.concat(o)),a===null?delete s[o]:(Sh(a),s[o]=a)),!0},deleteProperty(s,o){if(s=Sn(n.root.cache,n.target),s===null)throw new Error(`Cannot delete property ${o.toString()} of null`);return typeof o=="symbol"?Reflect.deleteProperty(s,o):(o in s&&(n.flag("write",n.target.concat(o)),delete s[o]),!0)},ownKeys(s){return s=Sn(n.root.cache,n.target),Reflect.ownKeys(s)},has(s,o){return s=Sn(n.root.cache,n.target),Reflect.has(s,o)},getOwnPropertyDescriptor(s,o){s=Sn(n.root.cache,n.target);const a=Reflect.getOwnPropertyDescriptor(s,o);return a&&(a.configurable=!0),a},getPrototypeOf(s){return s=Sn(n.root.cache,n.target),Reflect.getPrototypeOf(s)}},i=new Proxy({},r);return i}function Sh(n){typeof n=="object"&&Object.keys(n).forEach(e=>{const t=n[e];t===null||typeof t=="undefined"?delete n[e]:typeof t=="object"&&Sh(t)})}function Fa(n){if(typeof n!="object"||!n[Oi])throw new Error("Given value is not proxied. Make sure you are referencing the value through the live data proxy.");return n}class GB{constructor(e,t="order",r=10){if(this.collection=e,this.orderProperty=t,this.orderIncrement=r,typeof e!="object"||!e[Oi])throw new Error("Collection is not proxied");if(e.valueOf()instanceof Array)throw new Error("Collection is an array, not an object collection");if(!Object.keys(e).every(s=>typeof e[s]=="object"))throw new Error("Collection has non-object children");if(!Object.keys(e).every(s=>typeof e[s][t]=="number")){const s=Object.keys(e);for(let o=0;o<s.length;o++){const a=e[s[o]];a[t]=o*r}}}getObservable(){return Fa(this.collection).getObservable()}getArrayObservable(){const e=pd();return new e(t=>{const r=this.getObservable().subscribe(()=>{const i=this.getArray();t.next(i)});return function(){r.unsubscribe()}})}getArray(){return Fa(this.collection).toArray((t,r)=>t[this.orderProperty]-r[this.orderProperty])}add(e,t,r){const i=this.getArray();let s=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;for(let l=0;l<i.length;l++){const u=i[l][this.orderProperty];s=Math.min(u,s),o=Math.max(u,o)}let a;if(typeof r=="number"){if(a=Object.keys(this.collection).find(l=>this.collection[l]===e),!a)throw new Error("item not found in collection");if(r===t)return{key:a,index:t};if(Math.abs(r-t)===1){const l=i[t],u=l[this.orderProperty];return l[this.orderProperty]=e[this.orderProperty],e[this.orderProperty]=u,{key:a,index:t}}else i.splice(r,1)}if(typeof t!="number"||t>=i.length)t=i.length,e[this.orderProperty]=i.length==0?0:o+this.orderIncrement;else if(t===0)e[this.orderProperty]=i.length==0?0:s-this.orderIncrement;else{const l=i.map(h=>h[this.orderProperty]),u=l[t]-l[t-1];if(u>1)e[this.orderProperty]=l[t]-Math.floor(u/2);else{i.splice(t,0,e);for(let h=0;h<i.length;h++)i[h][this.orderProperty]=h*this.orderIncrement}}return{key:typeof a=="string"?a:Fa(this.collection).push(e),index:t}}delete(e){const r=this.getArray()[e];if(!r)throw new Error(`Item at index ${e} not found`);const i=Object.keys(this.collection).find(s=>this.collection[s]===r);if(!i)throw new Error("Cannot find target object to delete");return this.collection[i]=null,{key:i,index:e}}move(e,t){const r=this.getArray();return this.add(r[e],t,e)}sort(e){const t=this.getArray();t.sort(e);for(let r=0;r<t.length;r++)t[r][this.orderProperty]=r*this.orderIncrement}}class Sw{constructor(e){if(e||(e={}),typeof e.include!="undefined"&&!(e.include instanceof Array))throw new TypeError("options.include must be an array");if(typeof e.exclude!="undefined"&&!(e.exclude instanceof Array))throw new TypeError("options.exclude must be an array");if(typeof e.child_objects!="undefined"&&typeof e.child_objects!="boolean")throw new TypeError("options.child_objects must be a boolean");if(typeof e.cache_mode=="string"&&!["allow","bypass","force"].includes(e.cache_mode))throw new TypeError("invalid value for options.cache_mode");this.include=e.include||void 0,this.exclude=e.exclude||void 0,this.child_objects=typeof e.child_objects=="boolean"?e.child_objects:void 0,this.cache_mode=typeof e.cache_mode=="string"?e.cache_mode:typeof e.allow_cache=="boolean"?e.allow_cache?"allow":"bypass":"allow",this.cache_cursor=typeof e.cache_cursor=="string"?e.cache_cursor:void 0}}class QB extends Sw{constructor(e){if(super(e),!["undefined","boolean"].includes(typeof e.snapshots))throw new TypeError("options.snapshots must be a boolean");this.snapshots=typeof e.snapshots=="boolean"?e.snapshots:!0}}const Pe=Symbol("private");class Xn{constructor(e,t,r){this.db=e,t||(t=""),t=t.replace(/^\/|\/$/g,"");const s=G.get(t).key,o=[];this[Pe]={get path(){return t},get key(){return s},get callbacks(){return o},vars:r||{},context:{},pushed:!1,cursor:null}}context(e,t=!1){const r=this[Pe].context;if(typeof e=="object"){const i=e?t?r||{}:e:{};return e&&Object.keys(e).forEach(s=>{i[s]=e[s]}),this[Pe].context=i,this}else{if(typeof e=="undefined")return console.warn("Use snap.context() instead of snap.ref.context() to get updating context in event callbacks"),r;throw new Error("Invalid context argument")}}get cursor(){return this[Pe].cursor}set cursor(e){var t;this[Pe].cursor=e,(t=this.onCursor)==null||t.call(this,e)}get path(){return this[Pe].path}get key(){const e=this[Pe].key;return typeof e=="number"?`[${e}]`:e}get index(){const e=this[Pe].key;if(typeof e!="number")throw new Error(`"${e}" is not a number`);return e}get parent(){const e=G.fillVariables2(this.path,this.vars),t=G.get(e);return t.parentPath===null?null:new Xn(this.db,t.parentPath).context(this[Pe].context)}get vars(){return this[Pe].vars}child(e){e=typeof e=="number"?e:e.replace(/^\/|\/$/g,"");const t=G.fillVariables2(this.path,this.vars),r=G.getChildPath(t,e);return new Xn(this.db,r).context(this[Pe].context)}set(e,t){return V(this,null,function*(){try{if(this.isWildcardPath)throw new Error(`Cannot set the value of wildcard path "/${this.path}"`);if(this.parent===null)throw new Error("Cannot set the root object. Use update, or set individual child properties");if(typeof e=="undefined")throw new TypeError(`Cannot store undefined value in "/${this.path}"`);this.db.isReady||(yield this.db.ready()),e=this.db.types.serialize(this.path,e);const{cursor:r}=yield this.db.api.set(this.path,e,{context:this[Pe].context});if(this.cursor=r,typeof t=="function")try{t(null,this)}catch(i){console.error("Error in onComplete callback:",i)}}catch(r){if(typeof t=="function")try{t(r,this)}catch(i){console.error("Error in onComplete callback:",i)}else throw r}return this})}update(e,t){return V(this,null,function*(){try{if(this.isWildcardPath)throw new Error(`Cannot update the value of wildcard path "/${this.path}"`);if(this.db.isReady||(yield this.db.ready()),typeof e!="object"||e instanceof Array||e instanceof ArrayBuffer||e instanceof Date)yield this.set(e);else if(Object.keys(e).length===0)console.warn(`update called on path "/${this.path}", but there is nothing to update`);else{e=this.db.types.serialize(this.path,e);const{cursor:r}=yield this.db.api.update(this.path,e,{context:this[Pe].context});this.cursor=r}if(typeof t=="function")try{t(null,this)}catch(r){console.error("Error in onComplete callback:",r)}}catch(r){if(typeof t=="function")try{t(r,this)}catch(i){console.error("Error in onComplete callback:",i)}else throw r}return this})}transaction(e){return V(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot start a transaction on wildcard path "/${this.path}"`);this.db.isReady||(yield this.db.ready());let t;const r=s=>{s=this.db.types.deserialize(this.path,s);const o=new at(this,s);let a;try{a=e(o)}catch(c){t=c;return}return a instanceof Promise?a.then(c=>this.db.types.serialize(this.path,c)).catch(c=>{t=c}):this.db.types.serialize(this.path,a)},{cursor:i}=yield this.db.api.transaction(this.path,r,{context:this[Pe].context});if(this.cursor=i,t)throw t;return this})}on(e,t,r){this.path===""&&["value","child_changed"].includes(e)&&console.warn("WARNING: Listening for value and child_changed events on the root node is a bad practice. These events require loading of all data (value event), or potentially lots of data (child_changed event) each time they are fired");let i=null;const s=new TB(c=>{i=c}),o={event:e,stream:s,userCallback:typeof t=="function"&&t,ourCallback:(c,l,u,h,p)=>{if(c){this.db.debug.error(`Error getting data for event ${e} on path "${l}"`,c);return}const f=this.db.ref(l);f[Pe].vars=G.extractVariables(this.path,l);let d;if(e.startsWith("notify_"))d=f.context(p||{});else{const y={previous:this.db.types.deserialize(l,h),current:this.db.types.deserialize(l,u)};if(e==="child_removed")d=new at(f,y.previous,!0,y.previous,p);else if(e==="mutations")d=new Ua(f,y.current,p);else{const _=e==="mutated"&&y.current===null;d=new at(f,y.current,_,y.previous,p)}}i.publish(d),p!=null&&p.acebase_cursor&&(this.cursor=p.acebase_cursor)}};this[Pe].callbacks.push(o);const a=()=>{typeof t=="function"&&s.subscribe(t,(p,f)=>{p||r&&r(f)});const c=typeof t=="object"?t:{newOnly:!t};typeof c.newOnly!="boolean"&&(c.newOnly=!1),this.isWildcardPath&&(c.newOnly=!0);const l=p=>{const f=this[Pe].callbacks;f.splice(f.indexOf(o),1),this.db.api.unsubscribe(this.path,e,o.ourCallback),this.db.debug.error(`Subscription "${e}" on path "/${this.path}" canceled because of an error: ${p.message}`),i.cancel(p.message)},u=this.db.api.subscribe(this.path,e,o.ourCallback,{newOnly:c.newOnly,cancelCallback:l,syncFallback:c.syncFallback}),h=()=>{const p=this[Pe].callbacks;return p.splice(p.indexOf(o),1),this.db.api.unsubscribe(this.path,e,o.ourCallback)};if(u instanceof Promise?u.then(()=>{i.start(h)}).catch(l):i.start(h),!c.newOnly){if(e==="value")this.get(p=>{i.publish(p)});else if(e==="child_added")this.get(p=>{const f=p.val();f===null||typeof f!="object"||Object.keys(f).forEach(d=>{const y=new at(this.child(d),f[d]);i.publish(y)})});else if(e==="notify_child_added"){let d=0;const y=()=>V(this,null,function*(){const _=yield this.db.api.reflect(this.path,"children",{limit:100,skip:d});_.list.forEach(S=>{const I=this.child(S.key);i.publish(I)}),_.more&&(d+=100,y())});y()}}};return this.db.isReady?a():this.db.ready(a),s}off(e,t){const i=this[Pe].callbacks.filter(s=>(!e||s.event===e)&&(!t||s.userCallback===t));return i.length===0&&this.db.debug.warn(`Can't find event subscriptions to stop (path: "${this.path}", event: ${e||"(any)"}, callback: ${t})`),i.forEach(s=>{s.stream.stop()}),this}get(e,t){if(!this.db.isReady){const s=this.db.ready().then(()=>this.get(e,t));return typeof e!="function"&&typeof t!="function"?s:void 0}if(t=typeof e=="function"?e:typeof t=="function"?t:void 0,this.isWildcardPath){const s=new Error(`Cannot get value of wildcard path "/${this.path}". Use .query() instead`);if(typeof t=="function")throw s;return Promise.reject(s)}const r=new Sw(typeof e=="object"?e:{cache_mode:"allow"}),i=this.db.api.get(this.path,r).then(s=>{var l;"context"in s&&"value"in s||(console.warn("AceBase api.get method returned an old response value. Update your acebase or acebase-client package"),s={value:s,context:{}});const a=this.db.types.deserialize(this.path,s.value),c=new at(this,a,void 0,void 0,s.context);return(l=s.context)!=null&&l.acebase_cursor&&(this.cursor=s.context.acebase_cursor),c});if(t){i.then(t).catch(s=>{console.error("Uncaught error:",s)});return}else return i}once(e,t){return e==="value"&&!this.isWildcardPath?this.get(t):new Promise(r=>{const i=s=>{this.off(e,i),r(s)};this.on(e,i)})}push(e,t){if(this.isWildcardPath){const s=new Error(`Cannot push to wildcard path "/${this.path}"`);if(typeof e=="undefined"||typeof t=="function")throw s;return Promise.reject(s)}const r=Wt.generate(),i=this.child(r);return i[Pe].pushed=!0,typeof e!="undefined"?i.set(e,t).then(()=>i):i}remove(){return V(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot remove wildcard path "/${this.path}". Use query().remove instead`);if(this.parent===null)throw new Error("Cannot remove the root node");return this.set(null)})}exists(){return V(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot check wildcard path "/${this.path}" existence`);return this.db.isReady||(yield this.db.ready()),this.db.api.exists(this.path)})}get isWildcardPath(){return this.path.indexOf("*")>=0||this.path.indexOf("$")>=0}query(){return new $w(this)}count(){return V(this,null,function*(){return(yield this.reflect("info",{child_count:!0})).children.count})}reflect(e,t){return V(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot reflect on wildcard path "/${this.path}"`);return this.db.isReady||(yield this.db.ready()),this.db.api.reflect(this.path,e,t)})}export(r){return V(this,arguments,function*(e,t={format:"json",type_safe:!0}){if(this.isWildcardPath)throw new Error(`Cannot export wildcard path "/${this.path}"`);this.db.isReady||(yield this.db.ready());const i=typeof e=="function"?e:e.write.bind(e);return this.db.api.export(this.path,i,t)})}import(r){return V(this,arguments,function*(e,t={format:"json",suppress_events:!1}){if(this.isWildcardPath)throw new Error(`Cannot import to wildcard path "/${this.path}"`);return this.db.isReady||(yield this.db.ready()),this.db.api.import(this.path,e,t)})}proxy(e){const t=typeof e=="object"&&(typeof e.cursor!="undefined"||typeof e.defaultValue!="undefined");return typeof e!="undefined"&&!t&&(this.db.debug.warn("Warning: live data proxy is being initialized with a deprecated method signature. Use ref.proxy(options) instead of ref.proxy(defaultValue)"),e={defaultValue:e}),YB.create(this,e)}observe(e){if(e)throw new Error("observe does not support data retrieval options yet");if(this.isWildcardPath)throw new Error(`Cannot observe wildcard path "/${this.path}"`);const t=pd();return new t(r=>{let i,s=!1,o=this.get(e).then(c=>{s=!0,i=c.val(),r.next(i)});const a=c=>{if(!s){o=o.then(()=>a(c));return}const l=c.ref.path;if(l===this.path)return i=c.val(),r.next(i);const u=G.getPathKeys(l).slice(G.getPathKeys(this.path).length);let h=i;for(;u.length>1;){const d=u.shift();d in h||(h[d]=typeof u[0]=="number"?[]:{}),h=h[d]}const p=u.shift(),f=c.val();f===null?h instanceof Array&&typeof p=="number"?h.splice(p,1):delete h[p]:h[p]=f,r.next(i)};return this.on("mutated",a),()=>{this.off("mutated",a)}})}forEach(e,t){return V(this,null,function*(){let r;if(typeof e=="function"?t=e:r=e,typeof t!="function")throw new TypeError("No callback function given");const i=yield this.reflect("children",{limit:0,skip:0}),s={canceled:!1,total:i.list.length,processed:0};for(let o=0;o<i.list.length;o++){const a=i.list[o].key,c=yield this.child(a).get(r);if(s.processed++,!c.exists())continue;if((yield t(c))===!1){s.canceled=!0;break}}return s})}getMutations(e){return V(this,null,function*(){const t=typeof e=="string"?e:void 0,r=e===null||typeof e=="undefined"?0:e instanceof Date?e.getTime():void 0;return this.db.api.getMutations({path:this.path,cursor:t,timestamp:r})})}getChanges(e){return V(this,null,function*(){const t=typeof e=="string"?e:void 0,r=e===null||typeof e=="undefined"?0:e instanceof Date?e.getTime():void 0;return this.db.api.getChanges({path:this.path,cursor:t,timestamp:r})})}}class $w{constructor(e){this.ref=e,this[Pe]={filters:[],skip:0,take:0,order:[],events:{}}}filter(e,t,r){if((t==="in"||t==="!in")&&(!(r instanceof Array)||r.length===0))throw new Error(`${t} filter for ${e} must supply an Array compare argument containing at least 1 value`);if((t==="between"||t==="!between")&&(!(r instanceof Array)||r.length!==2))throw new Error(`${t} filter for ${e} must supply an Array compare argument containing 2 values`);if((t==="matches"||t==="!matches")&&!(r instanceof RegExp))throw new Error(`${t} filter for ${e} must supply a RegExp compare argument`);return this[Pe].filters.push({key:e,op:t,compare:r}),this}where(e,t,r){return this.filter(e,t,r)}take(e){return this[Pe].take=e,this}skip(e){return this[Pe].skip=e,this}sort(e,t=!0){if(!["string","number"].includes(typeof e))throw"key must be a string or number";return this[Pe].order.push({key:e,ascending:t}),this}order(e,t=!0){return this.sort(e,t)}get(e,t){if(!this.ref.db.isReady){const s=this.ref.db.ready().then(()=>this.get(e,t));return typeof e!="function"&&typeof t!="function"?s:void 0}t=typeof e=="function"?e:typeof t=="function"?t:void 0;const r=new QB(typeof e=="object"?e:{snapshots:!0,cache_mode:"allow"});r.allow_cache=r.cache_mode!=="bypass",r.eventHandler=s=>{if(!this[Pe].events[s.name])return!1;const o=this[Pe].events[s.name];if(typeof o!="object"||o.length===0)return!1;if(["add","change","remove"].includes(s.name)){const a={name:s.name,ref:new Xn(this.ref.db,s.path)};if(r.snapshots&&s.name!=="remove"){const c=i.types.deserialize(s.path,s.value);a.snapshot=new at(a.ref,c,!1)}s=a}o.forEach(a=>{var c,l;try{a(s)}catch(u){this.ref.db.debug.error(`Error executing "${s.name}" event handler of realtime query on path "${this.ref.path}": ${(l=(c=u==null?void 0:u.stack)!=null?c:u==null?void 0:u.message)!=null?l:u}`)}})},r.monitor={add:!1,change:!1,remove:!1},this[Pe].events&&(this[Pe].events.add&&this[Pe].events.add.length>0&&(r.monitor.add=!0),this[Pe].events.change&&this[Pe].events.change.length>0&&(r.monitor.change=!0),this[Pe].events.remove&&this[Pe].events.remove.length>0&&(r.monitor.remove=!0)),this.stop();const i=this.ref.db;return i.api.query(this.ref.path,this[Pe],r).catch(s=>{throw new Error(s)}).then(s=>{const{stop:o}=s;let{results:a,context:c}=s;if(this.stop=()=>V(this,null,function*(){yield o()}),"results"in s&&"context"in s||(console.warn("Query results missing context. Update your acebase and/or acebase-client packages"),a=s,c={}),r.snapshots){const l=a.map(u=>{const h=i.types.deserialize(u.path,u.val);return new at(i.ref(u.path),h,!1,void 0,c)});return rl.from(l)}else{const l=a.map(u=>i.ref(u));return gd.from(l)}}).then(s=>(t&&t(s),s))}stop(){return V(this,null,function*(){})}getRefs(e){return this.get({snapshots:!1},e)}find(){return this.get({snapshots:!1})}count(){return V(this,null,function*(){return(yield this.find()).length})}exists(){return V(this,null,function*(){const e=this[Pe].take,t=this.take(1).find();return this.take(e),(yield t).length!==0})}remove(e){return V(this,null,function*(){const t=yield this.find(),r=t.reduce((a,c)=>{const l=a[c.parent.path];return l?l.push(c):a[c.parent.path]=[c],a},{}),i=this.ref.db,s=Object.keys(r).map(a=>V(this,null,function*(){const c=t.reduce((u,h)=>(u[h.key]=null,u),{}),l=i.ref(a);try{return yield l.update(c),{ref:l,success:!0}}catch(u){return{ref:l,success:!1,error:u}}})),o=yield Promise.all(s);return e&&e(o),o})}on(e,t){return this[Pe].events[e]||(this[Pe].events[e]=[]),this[Pe].events[e].push(t),this}off(e,t){if(typeof e=="undefined")return this[Pe].events={},this;if(!this[Pe].events[e])return this;if(typeof t=="undefined")return delete this[Pe].events[e],this;const r=this[Pe].events[e].indexOf(t);return~r?(this[Pe].events[e].splice(r,1),this):this}forEach(e,t){return V(this,null,function*(){let r;if(typeof e=="function"?t=e:r=e,typeof t!="function")throw new TypeError("No callback function given");const i=yield this.find(),s={canceled:!1,total:i.length,processed:0};for(let o=0;o<i.length;o++){const c=yield i[o].get(r);if(s.processed++,!c.exists())continue;if((yield t(c))===!1){s.canceled=!0;break}}return s})}}class rl extends Array{static from(e){const t=new rl(e.length);return e.forEach((r,i)=>t[i]=r),t}getValues(){return this.map(e=>e.val())}}class gd extends Array{static from(e){const t=new gd(e.length);return e.forEach((r,i)=>t[i]=r),t}getPaths(){return this.map(e=>e.path)}}function XB(n,e){e=e.replace(/^\/|\/$/g,"");const t=G.getPathKeys(e),r=Object.keys(n).find(s=>{const o=G.getPathKeys(s);return o.length!==t.length?!1:o.every((a,c)=>a==="*"||typeof a=="string"&&a[0]==="$"?!0:a===t[c])});return n[r]}function ZB(n,e){const t=G.get(e).parentPath;if(t!==null)return XB(n,t)}function eL(n,e){e=e.replace(/^\/|\/$/g,"");const r=G.get(e).parentPath,i=r?G.getPathKeys(r):[];return Object.keys(n).reduce((o,a)=>{const c=G.getPathKeys(a);if(c.length<i.length)return o;let l=!0;if(i.length===0&&r!==null?l=c.length===1&&(c[0]==="*"||typeof c[0]=="string"&&c[0][0]==="$"):c.every((u,h)=>h>=i.length?!1:u==="*"||typeof u=="string"&&u[0]==="$"||u===i[h]?!0:(l=!1,!1)),l){const u=n[a];o.push({path:a,type:u})}return o},[])}function Qy(n,e,t,r,i){if(r===null||typeof r!="object")return r;const s=G.getPathKeys(t),o=eL(e,t),a=[];return o.sort((c,l)=>G.getPathKeys(c.path).length>G.getPathKeys(l.path).length?-1:1),o.forEach(c=>{const l=G.getPathKeys(c.path);l.push("*");const u=l.slice(s.length);if(u.length===0){const p=G.extractVariables(c.path,t),f=new Xn(n,t,p);if(i==="serialize")r=c.type.serialize(r,f);else if(i==="deserialize"){const d=new at(f,r);r=c.type.deserialize(d)}return}const h=(p,f,d)=>{if(r===null||typeof r!="object")return r;const y=d[0];let _=[];if(y==="*"||typeof y=="string"&&y[0]==="$")f instanceof Array?_=f.map((S,I)=>({key:I,val:S})):_=Object.keys(f).map(S=>({key:S,val:f[S]}));else{const S=f[y];typeof S=="object"&&_.push({key:y,val:S})}_.forEach(S=>{const I=G.getChildPath(p,S.key),B=G.extractVariables(c.path,I),j=new Xn(n,I,B);if(d.length===1){if(i==="serialize")a.push({parent:f,key:S.key,original:f[S.key]}),f[S.key]=c.type.serialize(S.val,j);else if(i==="deserialize"){const U=new at(j,S.val);f[S.key]=c.type.deserialize(U)}}else h(I,S.val,d.slice(1))})};h(t,r,u)}),i==="serialize"&&(r=Hn(r),a.length>0&&a.forEach(c=>{c.parent[c.key]=c.original})),r}const Qi=Symbol("mappings");class Tw{constructor(e){this.db=e,this[Qi]={}}get mappings(){return this[Qi]}map(e){return ZB(this[Qi],e)}bind(e,t,r={}){if(typeof e!="string")throw new TypeError("path must be a string");if(typeof t!="function")throw new TypeError("constructor must be a function");if(typeof r.serializer!="undefined"){if(typeof r.serializer=="string")if(typeof t.prototype[r.serializer]=="function")r.serializer=t.prototype[r.serializer];else throw new TypeError(`${t.name}.prototype.${r.serializer} is not a function, cannot use it as serializer`);else if(typeof r.serializer!="function")throw new TypeError(`serializer for class ${t.name} must be a function, or the name of a prototype method`)}if(typeof r.creator=="undefined")typeof t.create=="function"&&(r.creator=t.create);else if(typeof r.creator=="string")if(typeof t[r.creator]=="function")r.creator=t[r.creator];else throw new TypeError(`${t.name}.${r.creator} is not a function, cannot use it as creator`);else if(typeof r.creator!="function")throw new TypeError(`creator for class ${t.name} must be a function, or the name of a static method`);e=e.replace(/^\/|\/$/g,""),this[Qi][e]={db:this.db,type:t,creator:r.creator,serializer:r.serializer,deserialize(i){let s;return this.creator?s=this.creator.call(this.type,i):s=new this.type(i),s},serialize(i,s){return this.serializer?i=this.serializer.call(i,s,i):i&&typeof i.serialize=="function"&&(i=i.serialize(s,i)),i}}}serialize(e,t){return Qy(this.db,this[Qi],e,t,"serialize")}deserialize(e,t){return Qy(this.db,this[Qi],e,t,"deserialize")}}const na=()=>{};class Pw{constructor(e="log",t=""){this.level=e,this.prefix=t,this.setLevel(e)}setLevel(e){const t=this.prefix?this.prefix+" %s":"";this.verbose=["verbose"].includes(e)?t?console.log.bind(console,t):console.log.bind(console):na,this.log=["verbose","log"].includes(e)?t?console.log.bind(console,t):console.log.bind(console):na,this.warn=["verbose","log","warn"].includes(e)?t?console.warn.bind(console,t):console.warn.bind(console):na,this.error=["verbose","log","warn","error"].includes(e)?t?console.error.bind(console,t):console.error.bind(console):na,this.write=r=>{const i=typeof Rn!="undefined"&&Rn.env&&typeof{}.RUNKIT_ENDPOINT_PATH=="string";r&&i?r.split(`
`).forEach(s=>console.log(s)):console.log(r)}}}const Xy={bold:1,dim:2,italic:3,underline:4,inverse:7,hidden:8,strikethrough:94},Zy={black:30,red:31,green:32,yellow:33,blue:34,magenta:35,cyan:36,white:37,grey:90,brightRed:91},eg={bgBlack:40,bgRed:41,bgGreen:42,bgYellow:43,bgBlue:44,bgMagenta:45,bgCyan:46,bgWhite:47,bgGrey:100,bgBrightRed:101},ra={all:0,color:39,background:49,bold:22,dim:22,italic:23,underline:24,inverse:27,hidden:28,strikethrough:29};var Tt;(function(n){n.reset="reset",n.bold="bold",n.dim="dim",n.italic="italic",n.underline="underline",n.inverse="inverse",n.hidden="hidden",n.strikethrough="strikethrough",n.black="black",n.red="red",n.green="green",n.yellow="yellow",n.blue="blue",n.magenta="magenta",n.cyan="cyan",n.grey="grey",n.bgBlack="bgBlack",n.bgRed="bgRed",n.bgGreen="bgGreen",n.bgYellow="bgYellow",n.bgBlue="bgBlue",n.bgMagenta="bgMagenta",n.bgCyan="bgCyan",n.bgWhite="bgWhite",n.bgGrey="bgGrey"})(Tt||(Tt={}));function Iw(){if(typeof Rn=="undefined"||!Rn.stdout||!Rn.env||!Rn.platform||Rn.platform==="browser")return!1;if(Rn.platform==="win32")return!0;const n=Rn.env;return n.COLORTERM?!0:n.TERM==="dumb"?!1:n.CI||n.TEAMCITY_VERSION?!!n.TRAVIS:!!(["iTerm.app","HyperTerm","Hyper","MacTerm","Apple_Terminal","vscode"].includes(n.TERM_PROGRAM)||/^xterm-256|^screen|^xterm|^vt100|color|ansi|cygwin|linux/i.test(n.TERM))}let Rw=Iw();function tL(n){Rw=Iw()&&n}function nL(n,e){if(!Rw)return n;const t=[],r=[],i=a=>{a===Tt.reset?t.push(ra.all):a in Xy?(t.push(Xy[a]),r.push(ra[a])):a in Zy?(t.push(Zy[a]),r.push(ra.color)):a in eg&&(t.push(eg[a]),r.push(ra.background))};e instanceof Array?e.forEach(i):i(e);const s=t.map(a=>"\x1B["+a+"m").join(""),o=r.map(a=>"\x1B["+a+"m").join("");return n.split(`
`).map(a=>s+a+o).join(`
`)}String.prototype.colorize=function(n){return nL(this,n)};class Cw{constructor(e){this.logLevel="log",this.logColors=!0,this.info="realtime database",this.sponsor=!1,typeof e!="object"&&(e={}),typeof e.logLevel=="string"&&(this.logLevel=e.logLevel),typeof e.logColors=="boolean"&&(this.logColors=e.logColors),typeof e.info=="string"&&(this.info=e.info),typeof e.sponsor=="boolean"&&(this.sponsor=e.sponsor)}}class rL extends gs{constructor(e,t={}){super(),this._ready=!1,t=new Cw(t),this.name=e,this.debug=new Pw(t.logLevel,`[${e}]`),tL(t.logColors);const r=[Tt.magenta,Tt.bold],i=`     ___          ______                
    / _ \\         | ___ \\               
   / /_\\ \\ ___ ___| |_/ / __ _ ___  ___ 
   |  _  |/ __/ _ \\ ___ \\/ _\` / __|/ _ \\
   | | | | (_|  __/ |_/ / (_| \\__ \\  __/
   \\_| |_/\\___\\___\\____/ \\__,_|___/\\___|`,s=t.info?"".padStart(40-t.info.length," ")+t.info+`
`:"";t.sponsor||(this.debug.write(i.colorize(r)),s&&this.debug.write(s.colorize(Tt.magenta))),this.types=new Tw(this),this.once("ready",()=>{this._ready=!0})}ready(e){return V(this,null,function*(){this._ready||(yield new Promise(t=>this.on("ready",t))),e==null||e()})}get isReady(){return this._ready}setObservable(e){JB(e)}ref(e){return new Xn(this,e)}get root(){return this.ref("")}query(e){const t=new Xn(this,e);return new $w(t)}get indexes(){return{get:()=>this.api.getIndexes(),create:(e,t,r)=>this.api.createIndex(e,t,r),delete:e=>V(this,null,function*(){return this.api.deleteIndex(e)})}}get schema(){return{get:e=>this.api.getSchema(e),set:(e,t,r=!1)=>this.api.setSchema(e,t,r),all:()=>this.api.getSchemas(),check:(e,t,r)=>this.api.validateSchema(e,t,r)}}}class ht extends Error{constructor(e){super(`${e} is not implemented`)}}class iL extends gs{constructor(){super()}stats(e){throw new ht("stats")}subscribe(e,t,r,i){throw new ht("subscribe")}unsubscribe(e,t,r){throw new ht("unsubscribe")}update(e,t,r){throw new ht("update")}set(e,t,r){throw new ht("set")}get(e,t){throw new ht("get")}transaction(e,t,r){throw new ht("transaction")}exists(e){throw new ht("exists")}query(e,t,r){throw new ht("query")}reflect(e,t,r){throw new ht("reflect")}export(e,t,r){throw new ht("export")}import(e,t,r){throw new ht("import")}createIndex(e,t,r){throw new ht("createIndex")}getIndexes(){throw new ht("getIndexes")}deleteIndex(e){throw new ht("deleteIndex")}setSchema(e,t,r){throw new ht("setSchema")}getSchema(e){throw new ht("getSchema")}getSchemas(){throw new ht("getSchemas")}validateSchema(e,t,r){throw new ht("validateSchema")}getMutations(e){throw new ht("getMutations")}getChanges(e){throw new ht("getChanges")}}function tg(n,e,t){const r=[0,0,0,0,0];for(let i=0;i<e;i+=4){let s=((n[i]*256+n[i+1])*256+n[i+2])*256+n[i+3];if(!s)t.push("z");else{for(let o=0;o<5;r[o++]=s%85+33,s=Math.floor(s/85));t.push(String.fromCharCode(r[4],r[3],r[2],r[1],r[0]))}}}function sL(n){const e=n,t=[],r=e.length%4,i=e.length-r;if(tg(e,i,t),r){const o=new Uint8Array(4);o.set(e.slice(i),0),tg(o,4,t);let a=t.pop();a=="z"&&(a="!!!!!"),t.push(a.substr(0,r+1))}let s=t.join("");return s="<~"+s+"~>",s}const Er={encode:function(n){return n instanceof ArrayBuffer&&(n=new Uint8Array(n,0,n.byteLength)),sL(n)},decode:function(n){if(!n.startsWith("<~")||!n.endsWith("~>"))throw new Error("Invalid input string");n=n.substr(2,n.length-4);const e=n.length,t=[],r=[0,0,0,0,0];let i,s,o,a;for(let l=0;l<e;++l){if(n.charAt(l)=="z"){t.push(0,0,0,0);continue}for(let u=0;u<5;++u)r[u]=n.charCodeAt(l+u)-33;if(a=e-l,a<5){for(let u=a;u<4;r[++u]=0);r[a]=85}i=(((r[0]*85+r[1])*85+r[2])*85+r[3])*85+r[4],s=i&255,i>>>=8,o=i&255,i>>>=8,t.push(i>>>8,i&255,o,s);for(let u=a;u<5;++u,t.pop());l+=4}const c=new Uint8Array(t);return c.buffer.slice(c.byteOffset,c.byteOffset+c.byteLength)}},oL=n=>{if(n.map===null||typeof n.map=="undefined"){if(typeof n.val=="undefined")throw new Error("serialized value must have a val property");return n.val}const e=(t,r)=>t==="date"?new Date(r):t==="binary"?Er.decode(r):t==="reference"?new ct(r):t==="regexp"?new RegExp(r.pattern,r.flags):t==="array"?new sc(r):t==="bigint"?BigInt(r):r;return typeof n.map=="string"?e(n.map,n.val):(Object.keys(n.map).forEach(t=>{const r=n.map[t],i=G.getPathKeys(t);let s=n,o="val",a=n.val;i.forEach(c=>{o=c,s=a,a=a[o]}),s[o]=e(r,a)}),n.val)},Nw=n=>{var i;if(n===null||typeof n!="object"||n instanceof Date||n instanceof ArrayBuffer||n instanceof ct||n instanceof RegExp){const s=Nw({value:n});return{map:(i=s.map)==null?void 0:i.value,val:s.val.value}}n=Hn(n);const e=(s,o,a)=>{s instanceof sc&&(o[a]="array"),Object.keys(s).forEach(c=>{const l=s[c],u=a.length===0?c:`${a}/${c}`;typeof l=="bigint"?(s[c]=l.toString(),o[u]="bigint"):l instanceof Date?(s[c]=l.toISOString(),o[u]="date"):l instanceof ArrayBuffer?(s[c]=Er.encode(l),o[u]="binary"):l instanceof ct?(s[c]=l.path,o[u]="reference"):l instanceof RegExp?(s[c]={pattern:l.source,flags:l.flags},o[u]="regexp"):typeof l=="object"&&l!==null&&e(l,o,u)})},t={};e(n,t,"");const r={val:n};return Object.keys(t).length>0&&(r.map=t),r},ng=n=>n>0?Date.now()+n*1e3:1/0;class aL{get size(){return this.cache.size}constructor(e){var r;if(this.enabled=!0,typeof e=="number"&&(e={expirySeconds:e}),e.cloneValues=e.cloneValues!==!1,typeof e.expirySeconds!="number"&&typeof e.maxEntries!="number")throw new Error("Either expirySeconds or maxEntries must be specified");this.options=e,this.cache=new Map;const t=setInterval(()=>{this.cleanUp()},60*1e3);(r=t.unref)==null||r.call(t)}has(e){return this.enabled?this.cache.has(e):!1}get(e){if(!this.enabled)return null;const t=this.cache.get(e);return t?(t.expires=ng(this.options.expirySeconds),t.accessed=Date.now(),this.options.cloneValues?Hn(t.value):t.value):null}set(e,t){if(this.options.maxEntries>0&&this.cache.size>=this.options.maxEntries&&!this.cache.has(e)){let r=null;const i=Date.now();for(const[s,o]of this.cache.entries()){if(o.expires<=i){this.cache.delete(s),r=null;break}(!r||o.accessed<r.accessed)&&(r={key:s,accessed:o.accessed})}r!==null&&this.cache.delete(r.key)}this.cache.set(e,{value:this.options.cloneValues?Hn(t):t,added:Date.now(),accessed:Date.now(),expires:ng(this.options.expirySeconds)})}remove(e){this.cache.delete(e)}cleanUp(){const e=Date.now();this.cache.forEach((t,r)=>{t.expires<=e&&this.cache.delete(r)})}}function cL(n){let e=0;function t(){let a;for(;a=n[e],[" ","\r",`
`,"	"].includes(a);)e++}function r(a){if(n[e]!==a)throw new Error(`Unexpected character at position ${e}. Expected: '${a}', found '${n[e]}'`);e++}function i(){t();const a={name:"",optional:!1,wildcard:!1};let c;for(;c=n[e],c==="_"||c==="$"||c>="a"&&c<="z"||c>="A"&&c<="Z"||a.name.length>0&&c>="0"&&c<="9"||a.name.length===0&&c==="*";)a.name+=c,e++;if(a.name.length===0)throw new Error(`Property name expected at position ${e}, found: ${n.slice(e,e+10)}..`);return n[e]==="?"&&(a.optional=!0,e++),(a.name==="*"||a.name[0]==="$")&&(a.optional=!0,a.wildcard=!0),t(),r(":"),a}function s(){t();let a={typeOf:"any"},c,l="";for(;c=n[e],c>="a"&&c<="z"||c>="A"&&c<="Z";)l+=c,e++;if(l.length===0)if(n[e]==="*")r("*"),a.typeOf="any";else if(["'",'"',"`"].includes(n[e])){a.typeOf="string",a.value="";const u=n[e];for(r(u);c=n[e],c&&c!==u;)a.value+=c,e++;r(u)}else if(n[e]>="0"&&n[e]<="9"){a.typeOf="number";let u="";for(;c=n[e],c==="."||c==="n"||c>="0"&&c<="9";)u+=c,e++;u.endsWith("n")?a.value=BigInt(u):u.includes(".")?a.value=parseFloat(u):a.value=parseInt(u)}else if(n[e]==="{"){for(r("{"),a.typeOf="object",a.instanceOf=Object,a.children=[];;){const u=i(),h=o();if(a.children.push({name:u.name,optional:u.optional,wildcard:u.wildcard,types:h}),t(),(n[e]===";"||n[e]===",")&&(r(n[e]),t()),n[e]==="}")break}r("}")}else if(n[e]==="/"){r("/");let u="",h="";for(;c=n[e],c!=="/"||u.endsWith("\\");)u+=c,e++;for(r("/");c=n[e],["g","i","m","s","u","y","d"].includes(c);)h+=c,e++;a.typeOf="string",a.matches=new RegExp(u,h)}else throw new Error(`Expected a type definition at position ${e}, found character '${n[e]}'`);else if(["string","number","boolean","bigint","undefined","String","Number","Boolean","BigInt"].includes(l))a.typeOf=l.toLowerCase();else if(l==="Object"||l==="object")a.typeOf="object",a.instanceOf=Object;else if(l==="Date")a.typeOf="object",a.instanceOf=Date;else if(l==="Binary"||l==="binary")a.typeOf="object",a.instanceOf=ArrayBuffer;else if(l==="any")a.typeOf="any";else if(l==="null")a.typeOf="object",a.value=null;else if(l==="Array")r("<"),a.typeOf="object",a.instanceOf=Array,a.genericTypes=o(),r(">");else if(["true","false"].includes(l))a.typeOf="boolean",a.value=l==="true";else throw new Error(`Unknown type at position ${e}: "${a}"`);for(t();n[e]==="[";)r("["),r("]"),a={typeOf:"object",instanceOf:Array,genericTypes:[a]};return a}function o(){t();const a=[s()];for(;n[e]==="|";)r("|"),a.push(s()),t();return a}return s()}function lL(n,e,t,r){const i=e.find(h=>h.name==="*"||h.name[0]==="$")?[]:Object.keys(t).filter(h=>![null,void 0].includes(t[h])&&!e.find(p=>p.name===h));if(i.length>0)return{ok:!1,reason:`Object at path "${n}" cannot have propert${i.length===1?"y":"ies"} ${i.map(h=>`"${h}"`).join(", ")}`};function s(h){const p=![null,void 0].includes(t[h.name]);return!h.optional&&(r?t[h.name]===null:!p)?{ok:!1,reason:`Property at path "${n}/${h.name}" is not optional`}:p&&h.types.length===1?lo(`${n}/${h.name}`,h.types[0],t[h.name],!1):p&&!h.types.some(f=>lo(`${n}/${h.name}`,f,t[h.name],!1).ok)?{ok:!1,reason:`Property at path "${n}/${h.name}" does not match any of ${h.types.length} allowed types`}:{ok:!0}}const o=e.filter(h=>!h.wildcard),a=o.find(h=>!s(h).ok);if(a)return{ok:!1,reason:s(a).reason};const c=e.find(h=>h.wildcard);if(!c)return{ok:!0};const l=Object.keys(t).filter(h=>!o.find(p=>p.name===h));let u={ok:!0};for(let h=0;h<l.length&&u.ok;h++){const p=l[h];u=s({name:p,types:c.types,optional:!0,wildcard:!0})}return u}function lo(n,e,t,r,i){const s={ok:!0};if(e.typeOf==="any")return s;if(i instanceof Array&&i.length>0){if(e.typeOf!=="object")return{ok:!1,reason:`path "${n}" must be typeof ${e.typeOf}`};if(!e.children)return s;const o=i[0];let a=e.children.find(l=>l.name===o);if(a||(a=e.children.find(l=>l.name==="*"||l.name[0]==="$")),!a)return{ok:!1,reason:`Object at path "${n}" cannot have property "${o}"`};if(a.optional&&t===null&&i.length===1)return s;let c;return a.types.some(l=>{const u=typeof o=="number"?`${n}[${o}]`:`${n}/${o}`;return c=lo(u,l,t,r,i.slice(1)),c.ok}),c}return t===null?s:e.instanceOf===Object&&(typeof t!="object"||t instanceof Array||t instanceof Date)?{ok:!1,reason:`path "${n}" must be an object collection`}:e.instanceOf&&(typeof t!="object"||t.constructor!==e.instanceOf)?{ok:!1,reason:`path "${n}" must be an instance of ${e.instanceOf.name}`}:"value"in e&&t!==e.value?{ok:!1,reason:`path "${n}" must be value: ${e.value}`}:typeof t!==e.typeOf?{ok:!1,reason:`path "${n}" must be typeof ${e.typeOf}`}:e.instanceOf===Array&&e.genericTypes&&!t.every(o=>e.genericTypes.some(a=>lo(n,a,o,!1).ok))?{ok:!1,reason:`every array value of path "${n}" must match one of the specified types`}:e.typeOf==="object"&&e.children?lL(n,e.children,t,r):e.matches&&!e.matches.test(t)?{ok:!1,reason:`path "${n}" must match regular expression /${e.matches.source}/${e.matches.flags}`}:s}function uL(n){switch(n){case String:return"string";case Number:return"number";case Boolean:return"boolean";case Date:return"Date";case BigInt:return"bigint";case Array:throw new Error("Schema error: Array cannot be used without a type. Use string[] or Array<string> instead");default:throw new Error(`Schema error: unknown type used: ${n.name}`)}}class hL{constructor(e,t={warnOnly:!1}){if(this.handling=t,this.source=e,typeof e=="object"){const r=i=>"{"+Object.keys(i).map(s=>{let o=i[s];if(o===void 0)o="undefined";else if(o instanceof RegExp)o=`/${o.source}/${o.flags}`;else if(typeof o=="object")o=r(o);else if(typeof o=="function")o=uL(o);else if(!["string","number","boolean","bigint"].includes(typeof o))throw new Error(`Type definition for key "${s}" must be a string, number, boolean, bigint, object, regular expression, or one of these classes: String, Number, Boolean, Date, BigInt`);return`${s}:${o}`}).join(",")+"}";this.text=r(e)}else if(typeof e=="string")this.text=e;else throw new Error("Type definiton must be a string or an object");this.type=cL(this.text)}check(e,t,r,i){const s=lo(e,this.type,t,r,i);return!s.ok&&this.handling.warnOnly&&(s.warning=`${r?"Partial schema":"Schema"} check on path "${e}"${i?` for child "${i.join("/")}"`:""} failed: ${s.reason}`,s.ok=!0,this.handling.warnCallback(s.warning)),s}}class an{constructor(e="browser"){throw new Error(`This feature is not supported in ${e} context`)}}class au extends an{}class $h extends an{}class rg extends an{}class fL extends an{}class ig extends an{}class dL extends an{}const pL={OBJECT:1,ARRAY:2,NUMBER:3,BOOLEAN:4,STRING:5,BIGINT:7,DATETIME:6,BINARY:8,REFERENCE:9},ce=pL;function yL(n){switch(n){case ce.ARRAY:return"array";case ce.BINARY:return"binary";case ce.BOOLEAN:return"boolean";case ce.DATETIME:return"date";case ce.NUMBER:return"number";case ce.OBJECT:return"object";case ce.REFERENCE:return"reference";case ce.STRING:return"string";case ce.BIGINT:return"bigint"}}class jw{constructor(e){if(this.path=e.path,this.type=e.type,this.index=e.index,this.key=e.key,this.exists=e.exists,this.address=e.address,this.value=e.value,this.childCount=e.childCount,typeof this.path=="string"&&typeof this.key=="undefined"&&typeof this.index=="undefined"){const t=G.get(this.path);typeof t.key=="number"?this.index=t.key:this.key=t.key}typeof this.exists=="undefined"&&(this.exists=!0)}get valueType(){return this.type}get valueTypeName(){return yL(this.valueType)}toString(){return this.exists?this.address?`"${this.path}" is ${this.valueTypeName} stored at ${this.address.toString()}`:`"${this.path}" is ${this.valueTypeName} with value ${this.value}`:`"${this.path}" doesn't exist`}}function nn(n,e){if(!n)throw new Error(`Assertion failed: ${e!=null?e:"check your code"}`)}const gL=120,rn={PENDING:"pending",LOCKED:"locked",EXPIRED:"expired",DONE:"done"};class Bw{constructor(e,t=gL){this._locks=[],this._lastTid=0,this.debug=e,this.timeout=t*1e3}setTimeout(e){this.timeout=e*1e3}createTid(){return Wt.generate()}_allowLock(e,t,r){const i=this._locks.find(s=>s.tid!==t&&s.state===rn.LOCKED&&(r||s.forWriting));return{allow:!i,conflict:i}}quit(){return new Promise(e=>{if(this._locks.length===0)return e();this._quit=e})}_rejectLock(e,t){this._locks.splice(this._locks.indexOf(e),1),clearTimeout(e.timeout);try{e.reject(t)}catch(r){console.error("Unhandled promise rejection:",r)}}_processLockQueue(){if(this._quit){const t=new Error("Quitting");this._locks.filter(r=>r.state===rn.PENDING).forEach(r=>this._rejectLock(r,t)),this._locks.length===0&&this._quit()}this._locks.filter(t=>t.state===rn.PENDING).sort((t,r)=>t.priority&&!r.priority?-1:!t.priority&&r.priority?1:t.requested-r.requested).forEach(t=>{const r=this._allowLock(t.path,t.tid,t.forWriting);t.waitingFor=r.conflict||null,r.allow&&this.lock(t).then(t.resolve).catch(i=>this._rejectLock(t,i))})}lock(o,a){return V(this,arguments,function*(e,t,r=!0,i="",s={withPriority:!1,noTimeout:!1}){let c,l;if(e instanceof cu)c=e,l=!0;else{if(this._locks.findIndex(u=>u.tid===t&&u.state===rn.EXPIRED)>=0)throw new Error(`lock on tid ${t} has expired, not allowed to continue`);if(this._quit&&!s.withPriority)throw new Error("Quitting");{c=new cu(this,e,t,r,s.withPriority===!0),c.comment=i,this._locks.push(c);const u=this._allowLock(e,t,r);c.waitingFor=u.conflict||null,l=u.allow}}if(l){if(c.state=rn.LOCKED,typeof c.granted!="number"){if(c.granted=Date.now(),s.noTimeout!==!0){c.expires=Date.now()+this.timeout;let u=0;const h=()=>{if(c.state===rn.LOCKED){if(u++,u<=3){this.debug.warn(`${c.forWriting?"write":"read"} lock on path "/${c.path}" by tid ${c.tid} (${c.comment}) is taking a long time to complete [${u}]`),c.timeout=setTimeout(h,this.timeout/4);return}this.debug.error(`lock :: ${c.forWriting?"write":"read"} lock on path "/${c.path}" by tid ${c.tid} (${c.comment}) took too long`),c.state=rn.EXPIRED,this._processLockQueue()}};c.timeout=setTimeout(h,this.timeout/4)}}return c}else return nn(c.state===rn.PENDING),new Promise((u,h)=>{c.resolve=u,c.reject=h})})}unlock(e,t,r=!0){let i,s;if(e instanceof cu)i=e,s=this._locks.indexOf(i);else{const o=e;s=this._locks.findIndex(a=>a.id===o),i=this._locks[s]}if(s<0){const o=`lock on "/${i.path}" for tid ${i.tid} wasn't found; ${t}`;throw new Error(o)}return i.state=rn.DONE,clearTimeout(i.timeout),this._locks.splice(s,1),r&&this._processLockQueue(),i}list(){return this._locks||[]}isAllowed(e,t,r){return this._allowLock(e,t,r).allow}}let mL=0;class cu{static get LOCK_STATE(){return rn}constructor(e,t,r,i,s=!1){this.locker=e,this.path=t,this.tid=r,this.forWriting=i,this.priority=s,this.state=rn.PENDING,this.requested=Date.now(),this.comment="",this.waitingFor=null,this.id=++mL,this.history=[]}release(e){return V(this,null,function*(){return this.history.push({action:"release",path:this.path,forWriting:this.forWriting,comment:e}),this.locker.unlock(this,e||this.comment)})}moveToParent(){return V(this,null,function*(){const e=G.get(this.path).parentPath;if(this.locker.isAllowed(e,this.tid,this.forWriting))return this.history.push({path:this.path,forWriting:this.forWriting,action:"moving to parent"}),this.waitingFor=null,this.path=e,this;{this.locker.unlock(this,`moveLockToParent: ${this.comment}`,!1);const r=yield this.locker.lock(e,this.tid,this.forWriting,this.comment,{withPriority:!0});return r.history=this.history,r.history.push({path:this.path,forWriting:this.forWriting,action:"moving to parent through queue (priority)"}),r}})}}class md extends Error{}class Th extends Error{}class vL extends Error{constructor(e){super(`Exiting: ${e}`)}}class bL extends gs{get isMaster(){return this.masterPeerId===this.id}constructor(e,t,r=e.name){super(),this.storage=e,this.id=t,this.dbname=r,this.ipcType="ipc",this.ourSubscriptions=[],this.remoteSubscriptions=[],this.peers=[],this._exiting=!1,this._locks=[],this._requests=new Map,this._eventsEnabled=!0,this._nodeLocker=new Bw(e.debug,e.settings.lockTimeout),e.on("subscribe",i=>{if(e.debug.verbose(`database subscription being added on peer ${this.id}`),this.remoteSubscriptions.find(c=>c.callback===i.callback))return;const o=this.ourSubscriptions.some(c=>c.event===i.event&&c.path===i.path);if(this.ourSubscriptions.push(i),o)return;const a={type:"subscribe",from:this.id,data:{path:i.path,event:i.event}};this.sendMessage(a)}),e.on("unsubscribe",i=>{const s=this.remoteSubscriptions.find(o=>o.callback===i.callback);if(s){this.remoteSubscriptions.splice(this.remoteSubscriptions.indexOf(s),1);return}this.ourSubscriptions.filter(o=>o.path===i.path&&(!i.event||o.event===i.event)&&(!i.callback||o.callback===i.callback)).forEach(o=>{this.ourSubscriptions.splice(this.ourSubscriptions.indexOf(o),1);const a={type:"unsubscribe",from:this.id,data:{path:o.path,event:o.event}};this.sendMessage(a)})})}exit(e=0){return V(this,null,function*(){if(this._exiting)return this.once("exit");this._exiting=!0,this.storage.debug.warn(`Received ${this.isMaster?"master":"worker "+this.id} process exit request`),this._locks.length>0&&(this.storage.debug.warn(`Waiting for ${this.isMaster?"master":"worker"} ${this.id} locks to clear`),yield this.once("locks-cleared")),this.sayGoodbye(this.id),this.storage.debug.warn(`${this.isMaster?"Master":"Worker "+this.id} will now exit`),this.emitOnce("exit",e)})}sayGoodbye(e){const t={type:"bye",from:e,data:void 0};this.sendMessage(t)}addPeer(e,t=!0){if(this._exiting)return;if(this.peers.find(i=>i.id===e)||this.peers.push({id:e,lastSeen:Date.now()}),t){const i={type:"hello",from:this.id,to:e,data:void 0};this.sendMessage(i),this.ourSubscriptions.forEach(s=>{const o={type:"subscribe",from:this.id,to:e,data:{path:s.path,event:s.event}};this.sendMessage(o)})}}removePeer(e,t=!1){if(this._exiting)return;const r=this.peers.find(s=>s.id===e);if(!r){if(!t)throw new Error("We are supposed to know this peer!");return}this.peers.splice(this.peers.indexOf(r),1),this.remoteSubscriptions.filter(s=>s.for===e).forEach(s=>{this.remoteSubscriptions.splice(this.remoteSubscriptions.indexOf(s),1),this.storage.subscriptions.remove(s.path,s.event,s.callback)})}addRemoteSubscription(e,t){if(this._exiting||this.remoteSubscriptions.some(i=>i.for===e&&i.event===t.event&&i.path===t.path))return;const r=(i,s,o,a,c)=>{const l={type:"event",from:this.id,to:e,path:t.path,event:t.event,data:{path:s,val:o,previous:a,context:c}};this.sendMessage(l)};this.remoteSubscriptions.push({for:e,event:t.event,path:t.path,callback:r}),this.storage.subscriptions.add(t.path,t.event,r)}cancelRemoteSubscription(e,t){const r=this.remoteSubscriptions.find(i=>i.for===e&&i.event===t.event&&i.path===t.event);!r||this.storage.subscriptions.remove(t.path,t.event,r.callback)}handleMessage(e){return V(this,null,function*(){switch(e.type){case"hello":return this.addPeer(e.from,e.to!==this.id);case"bye":return this.removePeer(e.from,!0);case"subscribe":return this.addRemoteSubscription(e.from,e.data);case"unsubscribe":return this.cancelRemoteSubscription(e.from,e.data);case"event":{if(!this._eventsEnabled)break;const t=e,r=t.data.context||{};r.acebase_ipc={type:this.ipcType,origin:t.from},this.ourSubscriptions.filter(s=>s.event===t.event&&s.path===t.path).forEach(s=>{s.callback(null,t.data.path,t.data.val,t.data.previous,r)});break}case"lock-request":{if(!this.isMaster)throw new Error("Workers are not supposed to receive lock requests!");const t=e,r={type:"lock-result",id:t.id,from:this.id,to:t.from,ok:!0,data:void 0};try{const i=yield this.lock(t.data);r.data={id:i.id,path:i.path,tid:i.tid,write:i.forWriting,expires:i.expires,comment:i.comment}}catch(i){r.ok=!1,r.reason=i.stack||i.message||i}return this.sendMessage(r)}case"lock-result":{if(this.isMaster)throw new Error("Masters are not supposed to receive results for lock requests!");const t=e,r=this._requests.get(t.id);if(typeof r!="object")throw new Error("The request must be known to us!");t.ok?r.resolve(t.data):r.reject(new Error(t.reason));return}case"unlock-request":{if(!this.isMaster)throw new Error("Workers are not supposed to receive unlock requests!");const t=e,r={type:"unlock-result",id:t.id,from:this.id,to:t.from,ok:!0,data:{id:t.data.id}};try{yield this._locks.find(s=>{var o;return((o=s.lock)==null?void 0:o.id)===t.data.id}).lock.release()}catch(i){r.ok=!1,r.reason=i.stack||i.message||i}return this.sendMessage(r)}case"unlock-result":{if(this.isMaster)throw new Error("Masters are not supposed to receive results for unlock requests!");const t=e,r=this._requests.get(t.id);if(typeof r!="object")throw new Error("The request must be known to us!");t.ok?r.resolve(t.data):r.reject(new Error(t.reason));return}case"move-lock-request":{if(!this.isMaster)throw new Error("Workers are not supposed to receive move lock requests!");const t=e,r={type:"lock-result",id:t.id,from:this.id,to:t.from,ok:!0,data:void 0};try{let i;const s=this._locks.find(o=>{var a;return((a=o.lock)==null?void 0:a.id)===t.data.id});if(t.data.move_to==="parent")i=yield s.lock.moveToParent();else throw new Error(`Unknown lock move_to "${t.data.move_to}"`);s.lock=i,r.data={id:i.id,path:i.path,tid:i.tid,write:i.forWriting,expires:i.expires,comment:i.comment}}catch(i){r.ok=!1,r.reason=i.stack||i.message||i}return this.sendMessage(r)}case"notification":return this.emit("notification",e);case"request":return this.emit("request",e);case"result":{const t=e,r=this._requests.get(t.id);if(typeof r!="object")throw new Error("Result of unknown request received");t.ok?r.resolve(t.data):r.reject(new Error(t.reason))}}})}lock(e){return V(this,null,function*(){if(this._exiting&&!this._locks.find(i=>i.tid===e.tid&&i.granted))throw new vL("new transaction lock denied because the IPC peer is exiting");const t=r=>{this._locks.splice(this._locks.indexOf(r),1),this._locks.length===0&&this.emit("locks-cleared")};if(this.isMaster){const r={tid:e.tid,granted:!1,request:e,lock:null};this._locks.push(r);const i=yield this._nodeLocker.lock(e.path,e.tid,e.write,e.comment);r.tid=i.tid,r.granted=!0;const s=o=>({get id(){return o.id},get tid(){return o.tid},get path(){return o.path},get forWriting(){return o.forWriting},get expires(){return o.expires},get comment(){return o.comment},get state(){return o.state},release:()=>V(this,null,function*(){yield o.release(),t(r)}),moveToParent:()=>V(this,null,function*(){const a=yield o.moveToParent();return r.lock=s(a),r.lock})});return r.lock=s(i),r.lock}else{const r={tid:e.tid,granted:!1,request:e,lock:null};this._locks.push(r);const i=c=>(r.granted=!0,r.tid=c.tid,r.lock={id:c.id,tid:c.tid,path:c.path,forWriting:c.write,state:rn.LOCKED,expires:c.expires,comment:c.comment,release:()=>V(this,null,function*(){const l={type:"unlock-request",id:Wt.generate(),from:this.id,to:this.masterPeerId,data:{id:r.lock.id}};yield this.request(l),r.lock.state=rn.DONE,this.storage.debug.verbose(`Worker ${this.id} released lock ${r.lock.id} (tid ${r.lock.tid}, ${r.lock.comment}, "/${r.lock.path}", ${r.lock.forWriting?"write":"read"})`),t(r)}),moveToParent:()=>V(this,null,function*(){const l={type:"move-lock-request",id:Wt.generate(),from:this.id,to:this.masterPeerId,data:{id:r.lock.id,move_to:"parent"}};let u;try{u=yield this.request(l)}catch(h){throw r.lock.state=rn.DONE,t(r),h}return r.lock=i(u),r.lock})},r.lock),s={type:"lock-request",id:Wt.generate(),from:this.id,to:this.masterPeerId,data:e};let o,a;try{o=yield this.request(s)}catch(c){a=c,o=null}if(a)throw t(r),a;return i(o)}})}request(e){return V(this,null,function*(){let t,r;const i=new Promise((s,o)=>{t=a=>{this._requests.delete(e.id),s(a)},r=a=>{this._requests.delete(e.id),o(a)}});return this._requests.set(e.id,{resolve:t,reject:r,request:e}),this.sendMessage(e),i})}sendRequest(e){const t={type:"request",from:this.id,to:this.masterPeerId,id:Wt.generate(),data:e};return this.request(t).catch(r=>{throw this.storage.debug.error(r),r})}replyRequest(e,t){const r={type:"result",id:e.id,ok:!0,from:this.id,to:e.from,data:t};this.sendMessage(r)}sendNotification(e){const t={type:"notification",from:this.id,data:e};this.sendMessage(t)}get eventsEnabled(){return this._eventsEnabled}set eventsEnabled(e){this.storage.debug.log(`ipc events ${e?"enabled":"disabled"}`),this._eventsEnabled=e}}class wL extends bL{constructor(e){if(super(e,Wt.generate()),this.masterPeerId=this.id,this.ipcType="browser.bcc",window.addEventListener("beforeunload",()=>{this.exit()}),typeof window.BroadcastChannel!="undefined")this.channel=new BroadcastChannel(`acebase:${e.name}`);else{const r=[null],i=()=>{throw new Error("Not implemented")};this.channel={name:`acebase:${e.name}`,postMessage:s=>{const o=Wt.generate(),a=`acebase:${e.name}:${this.id}:${o}`,c=JSON.stringify(Nw(s));localStorage.setItem(a,c),setTimeout(()=>localStorage.removeItem(a),10)},set onmessage(s){r[0]=s},set onmessageerror(s){i()},close(){i()},addEventListener(s,o){s!=="message"&&i(),r.push(o)},removeEventListener(s,o){const a=r.indexOf(o);a>=1&&r.splice(a,1)},dispatchEvent(s){return r.forEach(o=>{try{o&&o(s)}catch(a){console.error(a)}}),!0}},window.addEventListener("storage",s=>{const[o,a,c,l]=s.key.split(":");if(o!=="acebase"||a!==e.name||c===this.id||s.newValue===null)return;const u=oL(JSON.parse(s.newValue));this.channel.dispatchEvent({data:u})})}this.channel.addEventListener("message",r=>V(this,null,function*(){const i=r.data;if(!(i.to&&i.to!==this.id)){if(e.debug.verbose("[BroadcastChannel] received: ",i),i.type==="hello"&&i.from<this.masterPeerId)this.masterPeerId=i.from,e.debug.log(`[BroadcastChannel] Tab ${this.masterPeerId} is the master.`);else if(i.type==="bye"&&i.from===this.masterPeerId){e.debug.log(`[BroadcastChannel] Master tab ${this.masterPeerId} is leaving`);const s=this.peers.map(a=>a.id).concat(this.id).filter(a=>a!==this.masterPeerId);this.masterPeerId=s.sort()[0],e.debug.log(`[BroadcastChannel] ${this.masterPeerId===this.id?"We are":`tab ${this.masterPeerId} is`} the new master. Requesting ${this._locks.length} locks (${this._locks.filter(a=>!a.granted).length} pending)`);const o=this._locks.splice(0);yield Promise.all(o.filter(a=>a.granted).map(a=>V(this,null,function*(){let c,l;a.lock.release=()=>new Promise(h=>c=h),a.lock.moveToParent=()=>new Promise(h=>l=h);const u=yield this.lock({path:a.lock.path,write:a.lock.forWriting,tid:a.lock.tid,comment:a.lock.comment});if(l){const h=yield u.moveToParent();l(h)}c&&(yield u.release(),c())}))),yield Promise.all(o.filter(a=>!a.granted).map(a=>V(this,null,function*(){yield this.lock(a.request)})))}return this.handleMessage(i)}}));const t={type:"hello",from:this.id,data:void 0};this.sendMessage(t)}sendMessage(e){this.storage.debug.verbose("[BroadcastChannel] sending: ",e),this.channel.postMessage(e)}}class ns{static get hasFileSystem(){return!1}static get fs(){return null}}class vd extends an{}class Lw extends an{}class kL extends an{}class xL extends an{}function EL(n,e,t,r){return V(this,null,function*(){if(!n.storage.indexes.supported)throw new Error("Indexes are not supported in current environment because it requires Node.js fs");const{ipc:i,debug:s,indexes:o,storage:a}=n,c=r&&r.rebuild===!0,l=r&&r.type||"normal";let u=r&&r.include||[];typeof u=="string"&&(u=[u]);const h=o.find(f=>f.path===e&&f.key===t&&f.type===l&&f.includeKeys.length===u.length&&f.includeKeys.every((d,y)=>u[y]===d));if(h&&r.config&&(h.config=r.config),h&&c!==!0)return s.log(`Index on "/${e}/*/${t}" already exists`.colorize(Tt.inverse)),h;if(!i.isMaster){const f=yield i.sendRequest({type:"index.create",path:e,key:t,options:r});if(f.ok)return a.indexes.add(f.fileName);throw new Error(f.reason)}yield ns.mkdir(`${a.settings.path}/${a.name}.acebase`).catch(f=>{if(f.code!=="EEXIST")throw f});const p=h||(()=>{const{include:f,caseSensitive:d,textLocale:y,textLocaleKey:_}=r,S={include:f,caseSensitive:d,textLocale:y,textLocaleKey:_};switch(l){case"array":return new xL(a,e,t,re({},S));case"fulltext":return new Lw(a,e,t,Je(re({},S),{config:r.config}));case"geo":return new kL(a,e,t,re({},S));default:return new vd(a,e,t,re({},S))}})();h||o.push(p);try{yield p.build()}catch(f){throw n.debug.error(`Index build on "/${e}/*/${t}" failed: ${f.message} (code: ${f.code})`.colorize(Tt.red)),h||o.splice(o.indexOf(p),1),f}return i.sendNotification({type:"index.created",fileName:p.fileName,path:e,key:t,options:r}),p})}const{compareValues:ia,getChildValues:bi,encodeString:sg,defer:_L}=_w,Ph=["value","child_added","child_changed","child_removed","mutated","mutations"];Ph.push(...Ph.map(n=>`notify_${n}`));const AL=()=>{};class OL extends Error{constructor(e){super(`Schema validation failed: ${e}`),this.reason=e}}class bd{constructor(e={}){this.maxInlineValueSize=50,this.removeVoidProperties=!1,this.path=".",this.lockTimeout=120,this.type="data",this.readOnly=!1,typeof e.maxInlineValueSize=="number"&&(this.maxInlineValueSize=e.maxInlineValueSize),typeof e.removeVoidProperties=="boolean"&&(this.removeVoidProperties=e.removeVoidProperties),typeof e.path=="string"&&(this.path=e.path),this.path.endsWith("/")&&(this.path=this.path.slice(0,-1)),typeof e.lockTimeout=="number"&&(this.lockTimeout=e.lockTimeout),typeof e.type=="string"&&(this.type=e.type),typeof e.readOnly=="boolean"&&(this.readOnly=e.readOnly),["object","string"].includes(typeof e.ipc)&&(this.ipc=e.ipc)}}class SL extends gs{createTid(){return Wt.generate()}constructor(e,t,r){super(),this.name=e,this.settings=t,this._schemas=[],this._indexes=[],this._annoucedIndexes=new Map,this.indexes={get supported(){return ns==null?void 0:ns.hasFileSystem},create:(s,o,a={rebuild:!1})=>{const c={storage:this,debug:this.debug,indexes:this._indexes,ipc:this.ipc};return EL(c,s,o,a)},get:(s,o=null)=>{if(s.includes("$")){const a=G.getPathKeys(s).map(c=>typeof c=="string"&&c.startsWith("$")?"*":c);s=new G(a).path}return this._indexes.filter(a=>a.path===s&&(o===null||o===a.key))},getAll:(s,o={parentPaths:!0,childPaths:!0})=>{const a=G.getPathKeys(s);return this._indexes.filter(c=>{const l=G.getPathKeys(c.path+"/*");return o.parentPaths&&l.every((u,h)=>u==="*"||a[h]===u)&&[c.key].concat(...c.includeKeys).includes(a[l.length])?!0:l.length<a.length||!o.childPaths&&l.length!==a.length?!1:a.every((u,h)=>[u,"*"].includes(l[h]))})},list:()=>this._indexes.slice(),load:()=>V(this,null,function*(){if(this._indexes.splice(0),!ns.hasFileSystem)return;let s=[];try{s=yield ns.readdir(`${this.settings.path}/${this.name}.acebase`)}catch(a){a.code!=="ENOENT"&&this.debug.error(a)}const o=[];s.forEach(a=>{if(!a.endsWith(".idx"))return;const c=this.settings.type!=="data",l=/^\[[a-z]+\]-/.test(a);if(!c&&!l||c&&a.startsWith(`[${this.settings.type}]-`)){const u=this.indexes.add(a);o.push(u)}}),yield Promise.all(o)}),add:s=>V(this,null,function*(){const o=this._indexes.find(a=>a.fileName===s);if(o)return o;if(this._annoucedIndexes.has(s))return yield this._annoucedIndexes.get(s);try{const a=vd.readFromFile(this,s);this._annoucedIndexes.set(s,a);const c=yield a;return this._indexes.push(c),this._annoucedIndexes.delete(s),c}catch(a){return this.debug.error(a),null}}),delete:s=>V(this,null,function*(){const o=yield this.indexes.remove(s);yield o.delete(),this.ipc.sendNotification({type:"index.deleted",fileName:o.fileName,path:o.path,keys:o.key})}),remove:s=>V(this,null,function*(){const o=this._indexes.find(a=>a.fileName===s);if(!o)throw new Error(`Index ${s} not found`);return this._indexes.splice(this._indexes.indexOf(o),1),o}),close:()=>V(this,null,function*(){const s=this.indexes.list().map(o=>o.close().catch(a=>this.debug.error(a)));yield Promise.all(s)})},this._eventSubscriptions={},this.subscriptions={add:(s,o,a)=>{if(Ph.indexOf(o)<0)throw new TypeError(`Invalid event type "${o}"`);let c=this._eventSubscriptions[s];c||(c=this._eventSubscriptions[s]=[]),c.push({created:Date.now(),type:o,callback:a}),this.emit("subscribe",{path:s,event:o,callback:a})},remove:(s,o,a)=>{const c=this._eventSubscriptions[s];if(!c)return;const l=()=>c.findIndex(h=>(o?h.type===o:!0)&&(a?h.callback===a:!0));let u;for(;(u=l())>=0;)c.splice(u,1);this.emit("unsubscribe",{path:s,event:o,callback:a})},hasValueSubscribersForPath(s){return!!this.getValueSubscribersForPath(s)},getValueSubscribersForPath:s=>{const o=new G(s),a=[];return Object.keys(this._eventSubscriptions).forEach(c=>{if(o.equals(c)||o.isDescendantOf(c)){const l=this._eventSubscriptions[c],u=G.fillVariables(c,s);l.filter(h=>!h.type.startsWith("notify_")).forEach(h=>{let p=null;if(h.type==="value")p=u;else if(["mutated","mutations"].includes(h.type)&&o.isDescendantOf(u))p=s;else if(h.type==="child_changed"&&s!==u){const f=G.getPathKeys(s.slice(u.length).replace(/^\//,""))[0];p=G.getChildPath(u,f)}else if(["child_added","child_removed"].includes(h.type)&&o.isChildOf(u)){const f=G.getPathKeys(s.slice(u.length).replace(/^\//,""))[0];p=G.getChildPath(u,f)}p!==null&&!a.some(f=>f.type===h.type&&f.eventPath===u)&&a.push({type:h.type,eventPath:u,dataPath:p,subscriptionPath:c})})}}),a},getAllSubscribersForPath:s=>{const o=G.get(s),a=[];return Object.keys(this._eventSubscriptions).forEach(c=>{if(o.isOnTrailOf(c)){const l=this._eventSubscriptions[c],u=G.fillVariables(c,s);l.forEach(h=>{let p=null;if(h.type==="value"||h.type==="notify_value")p=u;else if(["child_changed","notify_child_changed"].includes(h.type)){const f=s===u||o.isAncestorOf(u)?"*":G.getPathKeys(s.slice(u.length).replace(/^\//,""))[0];p=G.getChildPath(u,f)}else if(["mutated","mutations","notify_mutated","notify_mutations"].includes(h.type))p=s;else if(["child_added","child_removed","notify_child_added","notify_child_removed"].includes(h.type)&&(o.isChildOf(u)||s===u||o.isAncestorOf(u))){const f=s===u||o.isAncestorOf(u)?"*":G.getPathKeys(s.slice(u.length).replace(/^\//,""))[0];p=G.getChildPath(u,f)}p!==null&&!a.some(f=>f.type===h.type&&f.eventPath===u&&f.subscriptionPath===c)&&a.push({type:h.type,eventPath:u,dataPath:p,subscriptionPath:c})})}}),a},trigger:(s,o,a,c,l,u)=>{(this._eventSubscriptions[o]||[]).filter(p=>p.type===s).forEach(p=>{p.callback(null,a,l,c,u)})}},this.debug=new Pw(r.logLevel,`[${e}${typeof t.type=="string"&&t.type!=="data"?`:${t.type}`:""}]`);const i=e+(typeof t.type=="string"?`_${t.type}`:"");if(t.ipc==="socket"||t.ipc instanceof an){const s={ipcName:i,server:t.ipc instanceof an?t.ipc:null};this.ipc=new an(this,s)}else if(t.ipc){if(typeof t.ipc.port!="number")throw new Error("IPC port number must be a number");if(!["master","worker"].includes(t.ipc.role))throw new Error(`IPC client role must be either "master" or "worker", not "${t.ipc.role}"`);const s=Object.assign({dbname:i},t.ipc);this.ipc=new an(this,s)}else this.ipc=new wL(this,i);this.ipc.once("exit",s=>{this.indexes.supported&&this.indexes.close()}),this.nodeLocker={lock:(s,o,a,c)=>this.ipc.lock({path:s,tid:o,write:a,comment:c})},this._lastTid=0}close(){return V(this,null,function*(){yield this.ipc.exit()})}get path(){return`${this.settings.path}/${this.name}.acebase`}valueFitsInline(e){if(typeof e=="number"||typeof e=="boolean"||e instanceof Date)return!0;if(typeof e=="string")return e.length>this.settings.maxInlineValueSize?!1:sg(e).length<this.settings.maxInlineValueSize;if(e instanceof ct)return e.path.length>this.settings.maxInlineValueSize?!1:sg(e.path).length<this.settings.maxInlineValueSize;if(e instanceof ArrayBuffer)return e.byteLength<this.settings.maxInlineValueSize;if(e instanceof Array)return e.length===0;if(typeof e=="object")return Object.keys(e).length===0;throw new TypeError("What else is there?")}_writeNode(e,t,r){throw new Error("This method must be implemented by subclass")}getUpdateImpact(e,t){let r=e,i=!1;const s=t?[]:this.subscriptions.getAllSubscribersForPath(e),o=t?[]:this.subscriptions.getValueSubscribersForPath(e);o.length>0&&(i=!0,r=o.map(h=>({path:h.dataPath,keys:G.getPathKeys(h.dataPath)})).sort((h,p)=>h.keys.length<p.keys.length?-1:h.keys.length>p.keys.length?1:0)[0].path,o.filter(h=>h.dataPath===r).every(h=>h.type==="mutated"||h.type.startsWith("notify_"))&&(i=!1),r=G.fillVariables(r,e));const a=this.indexes.getAll(e,{childPaths:!0,parentPaths:!0}).map(l=>({index:l,keys:G.getPathKeys(l.path)})).sort((l,u)=>l.keys.length<u.keys.length?-1:l.keys.length>u.keys.length?1:0).map(l=>l.index),c=[];if(a.length>0){a.sort((h,p)=>(typeof h._pathKeys=="undefined"&&(h._pathKeys=G.getPathKeys(h.path)),typeof p._pathKeys=="undefined"&&(p._pathKeys=G.getPathKeys(p.path)),h._pathKeys.length<p._pathKeys.length?-1:h._pathKeys.length>p._pathKeys.length?1:0));const l=a[0],u=l.path===e?e:G.fillVariables(`${l.path}/*`,e);u.length<r.length&&(r=u,a.filter(h=>h.path===l.path).forEach(h=>{[h.key].concat(h.includeKeys).forEach(f=>!c.includes(f)&&c.push(f))}))}return{topEventPath:r,eventSubscriptions:s,valueSubscribers:o,hasValueSubscribers:i,indexes:a,keysFilter:c}}_writeNodeWithTracking(i,s){return V(this,arguments,function*(e,t,r={merge:!1,waitForIndexUpdates:!0,suppress_events:!1,context:null,impact:null}){if(r=r||{},!r.tid&&!r.transaction)throw new Error("_writeNodeWithTracking MUST be executed with a tid OR transaction!");r.merge=r.merge===!0;const o=this.validateSchema(e,t,{updates:r.merge});if(!o.ok)throw new OL(o.reason);const a=r.tid,c=r.transaction;let l=null;const u=r.impact?r.impact:this.getUpdateImpact(e,r.suppress_events),{topEventPath:h,eventSubscriptions:p,hasValueSubscribers:f,indexes:d}=u;let{keysFilter:y}=u;const _=()=>{if(typeof r._customWriteFunction=="function")return r._customWriteFunction();if(l){const E=G.getPathKeys(e),m=G.getPathKeys(h),v=E.slice(m.length);let g=l;for(;v.length>0&&g!==null;){const k=v.shift();g=typeof g=="object"&&k in g?g[k]:null}r.currentValue=g}return this._writeNode(e,t,r)},S=this.settings.transactions&&this.settings.transactions.log===!0;if(p.length===0&&d.length===0&&!S)return _();if(!f&&r.merge===!0&&y.length===0&&(y=Object.keys(t),h!==e)){const E=e.slice(h.length);y=y.map(m=>`${E}/${m}`)}const I=yield this.getNodeInfo(h,{transaction:c,tid:a});let B=null;if(I.exists){const E={transaction:c,tid:a};y.length>0&&(E.include=y),h===""&&typeof E.include=="undefined"&&this.debug.warn('WARNING: One or more value event listeners on the root node are causing the entire database value to be read to facilitate change tracking. Using "value", "notify_value", "child_changed" and "notify_child_changed" events on the root node are a bad practice because of the significant performance impact. Use "mutated" or "mutations" events instead'),B=(yield this.getNode(h,E)).value}l=B;const j=(yield _())||{};let U,M;if(e===h)r.merge?l===null?U=t instanceof Array?[]:{}:(U=l instanceof Array?[]:{},Object.keys(l).forEach(E=>{U[E]=l[E]})):U=t,M=U;else{const E=e.slice(h.length).replace(/^\//,""),m=G.getPathKeys(E);for(l===null?U=typeof m[0]=="number"?[]:{}:(U=l instanceof Array?[]:{},Object.keys(l).forEach(v=>{U[v]=l[v]})),M=U;m.length>0;){const v=m.shift();if(!r.merge&&m.length===0)M[v]=t;else{const g=M[v],k=typeof v=="number"?[...g]:re({},g);M[v]=k}M=M[v]}}r.merge&&Object.keys(t).forEach(E=>{M[E]=t[E]});const H=ia(l,U);if(H==="identical")return j.mutations=[],j;function L(E){if(E===null||typeof E!="object")return E;Object.keys(E).forEach(m=>{const v=E[m];v===null&&(delete E[m],E instanceof Array&&E.length--),typeof v=="object"&&L(v)})}L(U);const F=[];d.map(E=>({index:E,keys:G.getPathKeys(E.path)})).sort((E,m)=>E.keys.length<m.keys.length?1:E.keys.length>m.keys.length?-1:0).forEach(({index:E})=>{const m=G.getPathKeys(h),v=G.getPathKeys(E.path+"/*"),g=v.slice(m.length),k=l,x=U;if(g.length===0){nn(m.length===v.length,"check logic");const A=this.ipc.isMaster?E.handleRecordUpdate(h,k,x):this.ipc.sendRequest({type:"index.update",fileName:E.fileName,path:h,oldValue:k,newValue:x});F.push(A);return}const b=(A,O,$)=>{if(O===null&&$===null)return[];const P=G.getPathKeys(A),N=G.getPathKeys(E.path+"/*"),D=N.slice(P.length);if(D.length===0)return nn(P.length===N.length,"check logic"),[{path:A,oldValue:O,newValue:$}];let z=[],q="";for(;D.length>0;){const ne=D.shift();if(typeof ne=="string"&&(ne==="*"||ne.startsWith("$"))){const te=O===null?[]:Object.keys(O);$!==null&&Object.keys($).forEach(ue=>{te.indexOf(ue)<0&&te.push(ue)}),te.forEach(ue=>{const le=G.getChildPath(q,ue),ie=bi(ue,O,$),pe=G.getChildPath(A,le),ke=b(pe,ie.oldValue,ie.newValue);z=z.concat(ke)});break}else{const te=bi(ne,O,$);if(O=te.oldValue,$=te.newValue,O===null&&$===null)break;q=G.getChildPath(q,ne)}}return z};b(h,k,x).forEach(A=>{const O=this.ipc.isMaster?E.handleRecordUpdate(A.path,A.oldValue,A.newValue):this.ipc.sendRequest({type:"index.update",fileName:E.fileName,path:A.path,oldValue:A.oldValue,newValue:A.newValue});F.push(O)})});const T=(E,m,v,g=[])=>{let k=!0,x=E.type;if(x.startsWith("notify_")&&(x=x.slice(7)),x==="mutated"||(x==="child_changed"&&(m===null||v===null)?k=!1:x==="value"||x==="child_changed"?k=ia(m,v)!=="identical":x==="child_added"?k=m===null&&v!==null:x==="child_removed"&&(k=m!==null&&v===null),!k))return;const b=G.getPathKeys(E.dataPath);g.forEach(A=>{const O=b.indexOf(A.name);nn(O>=0,`Variable "${A.name}" not found in subscription dataPath "${E.dataPath}"`),b[O]=A.value});const w=b.reduce((A,O)=>G.getChildPath(A,O),"");this.subscriptions.trigger(E.type,E.subscriptionPath,w,m,v,r.context)},R=(E,m,v,g)=>{const k=[],x=g||ia(m,v);return x==="identical"||(typeof x=="string"?k.push({path:E,oldValue:m,newValue:v}):(x.changed.forEach(b=>{const w=G.getChildPath(E,b.key),A=bi(b.key,m,v),O=R(w,A.oldValue,A.newValue,b.change);k.push(...O)}),x.added.forEach(b=>{const w=G.getChildPath(E,b);k.push({path:w,oldValue:null,newValue:v[b]})}),m instanceof Array&&v instanceof Array&&x.removed.sort((b,w)=>b<w?1:-1),x.removed.forEach(b=>{const w=G.getChildPath(E,b);k.push({path:w,oldValue:m[b],newValue:null})}))),k};S&&this.settings.type!=="transaction"&&(j.mutations=(()=>{const E=e.slice(h.length).replace(/^\//,""),m=G.getPathKeys(E);let v=l,g=U;for(;m.length>0;){const w=m.shift();({oldValue:v,newValue:g}=bi(w,v,g))}const k=ia(v,g);return R(e,v,g,k).map(w=>({target:G.getPathKeys(w.path.slice(e.length)),prev:w.oldValue,val:w.newValue}))})());const C=()=>{p.filter(m=>!["mutated","mutations","notify_mutated","notify_mutations"].includes(m.type)).map(m=>{const v=G.getPathKeys(m.dataPath);return{sub:m,keys:v}}).sort((m,v)=>m.keys.length<v.keys.length?1:m.keys.length>v.keys.length?-1:0).forEach(({sub:m})=>{const v=(g,k,x,b=[])=>{const w=m.dataPath.slice(g.length).replace(/^\//,""),A=G.getPathKeys(w);for(;A.length>0;){const O=A.shift();if(typeof O=="string"&&(O==="*"||O[0]==="$")){const $=k===null?[]:Object.keys(k).map(P=>k instanceof Array?parseInt(P):P);x!==null&&Object.keys(x).forEach(P=>{const N=x instanceof Array?parseInt(P):P;!$.includes(N)&&$.push(P)}),$.forEach(P=>{const N=bi(P,k,x),D=b.concat({name:O,value:P});A.length===0?T(m,N.oldValue,N.newValue,D):v(G.getChildPath(g,O),N.oldValue,N.newValue,D)});return}else{g=G.getChildPath(g,O);const $=bi(O,k,x);k=$.oldValue,x=$.newValue}}T(m,k,x,b)};if(m.type.startsWith("notify_")&&G.get(m.eventPath).isAncestorOf(h)){const g=G.get(m.eventPath).isParentOf(h);(m.type==="notify_value"||m.type==="notify_child_changed"&&(!g||!["added","removed"].includes(H))||m.type==="notify_child_removed"&&H==="removed"&&g||m.type==="notify_child_added"&&H==="added"&&g)&&this.subscriptions.trigger(m.type,m.subscriptionPath,m.dataPath,null,null,r.context)}else v(h,l,U)}),p.filter(m=>["mutated","mutations","notify_mutated","notify_mutations"].includes(m.type)).forEach(m=>{let v=h;const g=m.eventPath.slice(v.length).replace(/^\//,""),k=G.getPathKeys(g);let x=l,b=U;for(;k.length>0;){const O=k.shift();v=G.getChildPath(v,O);const $=bi(O,x,b);x=$.oldValue,b=$.newValue}const w=R(v,x,b);if(w.length===0)return;const A=m.type.startsWith("notify_");if(["mutated","notify_mutated"].includes(m.type))w.forEach((O,$)=>{const P=r.context,N=A?null:O.oldValue,D=A?null:O.newValue;this.subscriptions.trigger(m.type,m.subscriptionPath,O.path,N,D,P)});else if(["mutations","notify_mutations"].includes(m.type)){const O=A?null:w.map($=>({target:G.getPathKeys($.path.slice(m.subscriptionPath.length)),prev:$.oldValue,val:$.newValue}));this.subscriptions.trigger(m.type,m.subscriptionPath,m.subscriptionPath,null,O,r.context)}})};return r.waitForIndexUpdates===!1&&F.splice(0),yield Promise.all(F),_L(C),j})}getChildren(e,t){throw new Error("This method must be implemented by subclass")}getNodeValue(r){return V(this,arguments,function*(e,t={}){return(yield this.getNode(e,t)).value})}getNode(e,t){throw new Error("This method must be implemented by subclass")}getNodeInfo(e,t){throw new Error("This method must be implemented by subclass")}setNode(e,t,r){throw new Error("This method must be implemented by subclass")}updateNode(e,t,r){throw new Error("This method must be implemented by subclass")}transactNode(i,s){return V(this,arguments,function*(e,t,r={no_lock:!1,suppress_events:!1,context:null}){const o=r&&r.no_lock===!0,a=this.createTid(),c=o?{tid:a,release:AL}:yield this.nodeLocker.lock(e,a,!0,"transactNode");try{let l=!1;const u=()=>{l=!0};o&&this.subscriptions.add(e,"notify_value",u);const h=yield this.getNode(e,{tid:a}),p=h.revision;let f;try{f=t(h.value),f instanceof Promise&&(f=yield f.catch(y=>{this.debug.error(`Error in transaction callback: ${y.message}`)}))}catch(y){this.debug.error(`Error in transaction callback: ${y.message}`)}if(typeof f=="undefined")return;if(o&&this.subscriptions.remove(e,"notify_value",u),l)throw new Th("Node changed");return yield this.setNode(e,f,{assert_revision:p,tid:c.tid,suppress_events:r.suppress_events,context:r.context})}catch(l){if(l instanceof Th)return console.warn(`node value changed, running again. Error: ${l.message}`),this.transactNode(e,t,r);throw l}finally{c.release()}})}matchNode(e,t,r){return V(this,null,function*(){var a;const i=(a=r==null?void 0:r.tid)!=null?a:Wt.generate(),s=(c,l)=>V(this,null,function*(){if(l.length===0)return Promise.resolve(!0);const u=l.reduce((d,y)=>{let _=y.key;return typeof _=="string"&&_.includes("/")&&(_=_.slice(0,_.indexOf("/"))),d.indexOf(_)<0&&d.push(_),d},[]),h=u.slice();let p=!0;const f=[];try{return yield this.getChildren(c,{tid:i,keyFilter:u}).next(d=>{var I;const y=(I=d.key)!=null?I:d.index;h.includes(y)&&h.splice(h.indexOf(d.key),1);const _=l.filter(B=>B.key===y).map(B=>({op:B.op,compare:B.compare})),S=_.length>0?o(d,_):{isMatch:!0,promises:[]};if(p=S.isMatch,p){f.push(...S.promises);const B=l.filter(j=>typeof j.key=="string"&&j.key.startsWith(`${typeof y=="number"?`[${y}]`:y}/`)).map(j=>({key:j.key.slice(j.key.indexOf("/")+1),op:j.op,compare:j.compare}));if(B.length>0){const j=G.getChildPath(c,d.key),U=s(j,B).then(M=>({isMatch:M}));f.push(U)}}if(!p||h.length===0)return!1}),p&&(p=(yield Promise.all(f)).every(y=>y.isMatch)),p?(p=h.every(d=>{const y=new jw(Je(re(re({},typeof d=="number"&&{index:d}),typeof d=="string"&&{key:d}),{exists:!1})),_=l.filter(B=>typeof B.key=="string"&&B.key.startsWith(`${typeof d=="number"?`[${d}]`:d}/`)).map(B=>({op:B.op,compare:B.compare}));if(_.length>0&&!o(y,_).isMatch)return!1;const S=l.filter(B=>B.key===d).map(B=>({op:B.op,compare:B.compare}));return S.length===0?!0:o(y,S).isMatch}),p):!1}catch(d){throw this.debug.error(`Error matching on "${c}": `,d),d}}),o=(c,l)=>{const u=[];return{isMatch:l.every(p=>{let f=!0;if(p.op==="!exists"||p.op==="=="&&(typeof p.compare=="undefined"||p.compare===null))f=!c.exists;else if(p.op==="exists"||p.op==="!="&&(typeof p.compare=="undefined"||p.compare===null))f=c.exists;else if((p.op==="contains"||p.op==="!contains")&&p.compare instanceof Array&&p.compare.length===0)f=!0;else if(!c.exists)f=!1;else if(c.address)if(c.valueType===ce.OBJECT&&["has","!has"].indexOf(p.op)>=0){const d=p.op==="has"?"exists":"!exists",y=s(c.path,[{key:p.compare,op:d}]).then(_=>({key:c.key,isMatch:_}));u.push(y),f=!0}else if(c.valueType===ce.ARRAY&&["contains","!contains"].indexOf(p.op)>=0){const d=this.getNode(c.path,{tid:i}).then(({value:y})=>{const _=p.op==="contains"?p.compare instanceof Array?p.compare.every(S=>y.includes(S)):y.includes(p.compare):p.compare instanceof Array?!p.compare.some(S=>y.includes(S)):!y.includes(p.compare);return{key:c.key,isMatch:_}});u.push(d),f=!0}else if(c.valueType===ce.STRING){const d=this.getNode(c.path,{tid:i}).then(y=>({key:c.key,isMatch:this.test(y.value,p.op,p.compare)}));u.push(d),f=!0}else f=!1;else if(c.type===ce.OBJECT&&["has","!has"].indexOf(p.op)>=0){const d=p.compare in c.value;f=d&&p.op==="has"||!d&&p.op==="!has"}else if(c.type===ce.ARRAY&&["contains","!contains"].indexOf(p.op)>=0){const d=c.value.indexOf(p.compare)>=0;f=d&&p.op==="contains"||!d&&p.op==="!contains"}else{let d=this.test(c.value,p.op,p.compare);d instanceof Promise&&(u.push(d),d=!0),f=d}return f}),promises:u}};return s(e,t)})}test(e,t,r){if(t==="<")return e<r;if(t==="<=")return e<=r;if(t==="==")return e===r;if(t==="!=")return e!==r;if(t===">")return e>r;if(t===">=")return e>=r;if(t==="in")return r.indexOf(e)>=0;if(t==="!in")return r.indexOf(e)<0;if(t==="like"||t==="!like"){const i="^"+r.replace(/[-[\]{}()+.,\\^$|#\s]/g,"\\$&").replace(/\?/g,".").replace(/\*/g,".*?")+"$",o=new RegExp(i,"i").test(e.toString());return t==="like"?o:!o}if(t==="matches")return r.test(e.toString());if(t==="!matches")return!r.test(e.toString());if(t==="between")return e>=r[0]&&e<=r[1];if(t==="!between")return e<r[0]||e>r[1];if(t==="has"||t==="!has"){const i=typeof e=="object"&&r in e;return t==="has"?i:!i}if(t==="contains"||t==="!contains"){const i=typeof e=="object"&&e instanceof Array&&e.includes(r);return t==="contains"?i:!i}return!1}exportNode(i,s){return V(this,arguments,function*(e,t,r={format:"json",type_safe:!0}){if((r==null?void 0:r.format)!=="json")throw new Error("Only json output is currently supported");const o=typeof t!="function"?t.write.bind(t):t,a=(d,y)=>{const _=S=>S.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/[\u0000-\u001f]/g,I=>`\\u${I.charCodeAt(0).toString(16).padStart(4,"0")}`);return d===ce.DATETIME?(y=`"${y.toISOString()}"`,r.type_safe&&(y=`{".type":"date",".val":${y}}`)):d===ce.STRING?y=`"${_(y)}"`:d===ce.ARRAY?y="[]":d===ce.OBJECT?y="{}":d===ce.BINARY?(y=`"${_(Er.encode(y))}"`,r.type_safe&&(y=`{".type":"binary",".val":${y}}`)):d===ce.REFERENCE?(y=`"${y.path}"`,r.type_safe&&(y=`{".type":"reference",".val":${y}}`)):d===ce.BIGINT&&(y=`"${y}"`,r.type_safe&&(y=`{".type":"bigint",".val":${y}}`)),y};let c="",l="";const u=yield this.getNodeInfo(e);if(u.exists)if(u.type===ce.OBJECT)c="{",l="}";else if(u.type===ce.ARRAY)c="[",l="]";else{const d=yield this.getNode(e),y=a(u.type,d.value);return o(y)}else return o("null");if(c){const d=o(c);d instanceof Promise&&(yield d)}let h="",p=0;const f=[];if(yield this.getChildren(e).next(d=>{d.address?f.push(d):(p++>0&&(h+=","),typeof d.key=="string"&&(h+=`"${d.key}":`),h+=a(d.type,d.value))}),h){const d=o(h);d instanceof Promise&&(yield d)}for(;f.length>0;){const d=f.shift();let y=p++>0?",":"";const _=typeof d.index=="number"?d.index:d.key;if(typeof _=="string"&&(y+=`"${_}":`),y){const S=o(y);S instanceof Promise&&(yield S)}yield this.exportNode(G.getChildPath(e,_),o,r)}if(l){const d=o(l);d instanceof Promise&&(yield d)}})}importNode(i,s){return V(this,arguments,function*(e,t,r={format:"json",method:"set"}){const a={data:"",index:0,offset:0,queue:[],queueStartByte:0,timesFlushed:0,get processedBytes(){return this.offset+this.index}},c=(T=!1)=>V(this,null,function*(){let R=yield t(262144);if(R===null)throw a.data?new Error(`Unexpected EOF at index ${a.offset+a.data.length}`):new Error("Unable to read data from stream");typeof R=="object"&&(R=ww(R)),T?a.data+=R:(a.offset+=a.data.length,a.data=R,a.index=0)}),l=T=>V(this,null,function*(){let R="";return a.index+T>=a.data.length&&(R=a.data.slice(a.index),T-=R.length,yield c()),R+=a.data.slice(a.index,a.index+T),a.index+=T,R}),u=T=>V(this,null,function*(){if(a.index+T>a.data.length&&(yield c(!0)),a.index+T>a.data.length)throw new Error("Not enough data available from stream")}),h=T=>V(this,null,function*(){const R=yield l(T.length);if(R!==T)throw new Error(`Unexpected character "${R[0]}" at index ${a.offset+a.index}, expected "${T}"`)}),p=()=>V(this,null,function*(){const T=[" ","	","\r",`
`];for(;a.index>=a.data.length&&(yield c()),T.includes(a.data[a.index]);)a.index++}),f=T=>V(this,null,function*(){yield u(T);const R=a.index;return a.data.slice(R,R+T)}),d=()=>V(this,null,function*(){yield p();const T=yield f(1);switch(T){case'"':return"string";case"{":return"object";case"[":return"array";case"n":return"null";case"u":return"undefined";case"t":case"f":return"boolean";default:{if(T==="-"||T>="0"&&T<="9")return"number";throw new Error(`Unknown value at index ${a.offset+a.index}`)}}}),y=()=>V(this,null,function*(){yield h('"');let T="",R=a.index;for(;a.data[R]!=='"'||a.data[R-1]==="\\";)R++,R>=a.data.length&&(T+=a.data.slice(a.index),yield c(),R=0);return T+=a.data.slice(a.index,R),a.index=R+1,B(T)}),_=()=>V(this,null,function*(){throw a.data[a.index]==="t"?yield h("true"):a.data[a.index]==="f"&&(yield h("false")),new Error(`Expected true or false at index ${a.offset+a.index}`)}),S=()=>V(this,null,function*(){let T="",R=a.index;const C=["-","0","1","2","3","4","5","6","7","8","9",".","e","b","f","x","o","n"];for(;C.includes(a.data[R]);)R++,R>=a.data.length&&(T+=a.data.slice(a.index),yield c(),R=0);return T+=a.data.slice(a.index,R),a.index=R,T.endsWith("n")?BigInt(T.slice(0,-1)):T.includes(".")?parseFloat(T):parseInt(T)}),I=()=>V(this,null,function*(){yield p();const T=yield d(),R=yield(()=>{switch(T){case"string":return y();case"object":return{};case"array":return[];case"number":return S();case"null":return null;case"undefined":return;case"boolean":return _()}})();return{type:T,value:R}}),B=T=>T.replace(/\\n/g,`
`).replace(/\\"/g,'"'),j=(T,R)=>{const C=R[".type"];let E=R[".val"];switch(C){case"Date":case"date":{E=new Date(E);break}case"Buffer":case"binary":{if(E=B(E),E.startsWith("<~"))E=Er.decode(E);else throw new Error(`Import error: Unexpected encoding for value for value at path "/${T}"`);break}case"PathReference":case"reference":{E=new ct(E);break}case"bigint":{E=BigInt(E);break}default:throw new Error(`Import error: Unsupported type "${C}" for value at path "/${T}"`)}return E},U={acebase_import_id:Wt.generate()},M={suppress_events:r.suppress_events,context:U},H=T=>V(this,null,function*(){if(yield h("{"),yield p(),(yield f(1))==="}")return a.index++,this.setNode(T.path,{},M);let C=0,E={},m=!1;const v=()=>V(this,null,function*(){let x;m?Object.keys(E).length>0&&(x=this.updateNode(T.path,E,M)):(m=!0,x=this.setNode(T.path,E,M)),E={},x&&(yield x)}),g=[];for(;;){yield p();const x=yield y();yield p(),yield h(":"),yield p();const{value:b,type:w}=yield I();if(E[x]=b,C++,["object","array"].includes(w)&&(g.push(v()),w==="object"?yield H(T.child(x)):yield L(T.child(x))),yield p(),(yield f(1))==="}"){a.index++;break}yield h(",")}if(C===2&&".type"in E&&".val"in E){const x=j(T.path,E);return this.setNode(T.path,x,M)}g.push(v()),yield Promise.all(g)}),L=T=>V(this,null,function*(){if(yield h("["),yield p(),(yield f(1))==="]")return a.index++,this.setNode(T.path,[],M);let C=!1,E=[],m={};const v=()=>V(this,null,function*(){let b;C?Object.keys(m).length>0&&(b=this.updateNode(T.path,m,M),m={}):(C=!0,b=this.setNode(T.path,E,M),E=null),b&&(yield b)}),g=(b,w)=>{C?m[w]=b:E.push(b)},k=[];let x=0;for(;;){yield p();const{value:b,type:w}=yield I();if(g(b,x),["object","array"].includes(w)&&(k.push(v()),w==="object"?yield H(T.child(x)):yield L(T.child(x))),yield p(),(yield f(1))==="]"){a.index++;break}yield h(","),x++}k.push(v()),yield Promise.all(k)});return(()=>V(this,null,function*(){const{value:T,type:R}=yield I();if(["object","array"].includes(R)){const C=G.get(e);R==="object"?yield H(C):yield L(C)}else yield this.setNode(e,T,M)}))()})}setSchema(e,t,r=!1){if(typeof t=="undefined")throw new TypeError("schema argument must be given");if(t===null){const o=this._schemas.findIndex(a=>a.path===e);o>=0&&this._schemas.splice(o,1);return}const i=new hL(t,{warnOnly:r,warnCallback:o=>this.debug.warn(o)}),s=this._schemas.find(o=>o.path===e);s?s.schema=i:(this._schemas.push({path:e,schema:i}),this._schemas.sort((o,a)=>{const c=G.getPathKeys(o.path),l=G.getPathKeys(a.path);return c.length===l.length?0:c.length<l.length?-1:1}))}getSchema(e){const t=this._schemas.find(r=>r.path===e);return t?{path:e,schema:t.schema.source,text:t.schema.text}:null}getSchemas(){return this._schemas.map(e=>({path:e.path,schema:e.schema.source,text:e.schema.text}))}validateSchema(e,t,r={updates:!1}){let i={ok:!0};const s=G.get(e);return this._schemas.filter(o=>s.isOnTrailOf(o.path)).every(o=>{if(s.isDescendantOf(o.path)){const u=G.fillVariables(o.path,e),h=s.keys.slice(G.getPathKeys(o.path).length);return i=o.schema.check(u,t,r.updates,h),i.ok}const a=G.getPathKeys(o.path).slice(s.keys.length);if(r.updates===!0&&a.length>0&&!(a[0]in t))return i.ok;const c=r.updates===!0&&a.length===0,l=(u,h,p)=>{if(p.length===0)return o.schema.check(u,h,c);if(h===null)return{ok:!0};const f=p[0];if(typeof f=="string"&&(f==="*"||f[0]==="$")){if(h===null||typeof h!="object")return{ok:!0};let d;return Object.keys(h).every(y=>{const _=G.getChildPath(u,y),S=h[y];return d=l(_,S,p.slice(1)),d.ok}),d}else{const d=G.getChildPath(u,f),y=h[f];return l(d,y,p.slice(1))}};return i=l(e,t,a),i.ok}),i}}class uo{static ChildPathsSql(e,t="path"){return e===""?`${t} <> '' AND ${t} NOT LIKE '%/%'`:`(${t} LIKE '${e}/%' OR ${t} LIKE '${e}[%') AND ${t} NOT LIKE '${e}/%/%' AND ${t} NOT LIKE '${e}[%]/%' AND ${t} NOT LIKE '${e}[%][%'`}static ChildPathsRegex(e){return new RegExp(`^${e}(?:/[^/[]+|\\[[0-9]+\\])$`)}static DescendantPathsSql(e,t="path"){return e===""?`${t} <> ''`:`${t} LIKE '${e}/%' OR ${t} LIKE '${e}[%'`}static DescendantPathsRegex(e){return new RegExp(`^${e}(?:/[^/[]+|\\[[0-9]+\\])`)}static get PathInfo(){return G}}class og{constructor(e){this.path=e}toString(){return`"/${this.path}"`}equals(e){return this.path===e.path}}const{compareValues:$L}=_w;class wd{constructor(e){this.production=!1,this.target={get originalPath(){return e.path},path:e.path,get write(){return e.write}},this.id=Wt.generate()}getChildCount(e){return V(this,null,function*(){let t=0;return yield this.childrenOf(e,{metadata:!1,value:!1},()=>(t++,!1)),t})}getMultiple(e){return V(this,null,function*(){const t=new Map;return yield Promise.all(e.map(r=>this.get(r).then(i=>t.set(r,i)))),t})}setMultiple(e){return V(this,null,function*(){yield Promise.all(e.map(({path:t,node:r})=>this.set(t,r)))})}removeMultiple(e){return V(this,null,function*(){yield Promise.all(e.map(t=>this.remove(t)))})}commit(){return V(this,null,function*(){throw new Error("CustomStorageTransaction.rollback must be overridden by subclass")})}moveToParentPath(e){return V(this,null,function*(){const t=this._lock&&this._lock.path||this.target.path;if(t===e)return e;if(uo.PathInfo.get(e).isParentOf(t))this._lock&&(this._lock=yield this._lock.moveToParent());else throw new Error(`Locking issue. Locked path "${this._lock.path}" is not a child/descendant of "${e}"`);return this.target.path=e,e})}}class ho extends bd{constructor(e){if(super(e),this.locking=!0,typeof e!="object")throw new Error("settings missing");if(typeof e.ready!="function")throw new Error("ready must be a function");if(typeof e.getTransaction!="function")throw new Error("getTransaction must be a function");this.name=e.name,this.locking=e.locking!==!1,this.locking&&(this.lockTimeout=typeof e.lockTimeout=="number"?e.lockTimeout:120),this.ready=e.ready;const t=this.locking,r=t?new Bw(console,this.lockTimeout):null;this.getTransaction=o=>V(this,[o],function*({path:i,write:s}){const a=yield e.getTransaction({path:i,write:s});nn(typeof a.id=="string","transaction id not set");const c=a.rollback,l=a.commit;return a.commit=()=>V(this,null,function*(){const u=yield l.call(a);return t&&(yield a._lock.release("commit")),u}),a.rollback=u=>V(this,null,function*(){const h=yield c.call(a,u);return t&&(yield a._lock.release("rollback")),h}),t&&(a._lock=yield r.lock(i,a.id,s,`${this.name}::getTransaction`)),a})}}class lu extends jw{constructor(e){super(e),this.revision=e.revision,this.revision_nr=e.revision_nr,this.created=e.created,this.modified=e.modified}}class TL extends SL{constructor(e,t,r){super(e,t,r),this._customImplementation=t,this._init()}_init(){return V(this,null,function*(){this.debug.log(`Database "${this.name}" details:`.colorize(Tt.dim)),this.debug.log("- Type: CustomStorage".colorize(Tt.dim)),this.debug.log(`- Path: ${this.settings.path}`.colorize(Tt.dim)),this.debug.log(`- Max inline value size: ${this.settings.maxInlineValueSize}`.colorize(Tt.dim)),this.debug.log(`- Autoremove undefined props: ${this.settings.removeVoidProperties}`.colorize(Tt.dim)),yield this._customImplementation.ready();const e=yield this._customImplementation.getTransaction({path:"",write:!0});(yield this.getNodeInfo("",{transaction:e})).exists||(yield this._writeNode("",{},{transaction:e})),yield e.commit(),this.indexes.supported&&(yield this.indexes.load()),this.emit("ready")})}throwImplementationError(e){throw new Error(`CustomStorage "${this._customImplementation.name}" ${e}`)}_storeNode(e,t,r){const i=o=>{if(o===null)throw new Error("Not allowed to store null values. remove the property");if(["string","number","boolean"].includes(typeof o))return o;if(o instanceof Date)return{type:ce.DATETIME,value:o.getTime()};if(o instanceof ct)return{type:ce.REFERENCE,value:o.path};if(o instanceof ArrayBuffer)return{type:ce.BINARY,value:Er.encode(o)};if(typeof o=="object")return nn(Object.keys(o).length===0,"child object stored in parent can only be empty"),o},s="Caller should have pre-processed the value by converting it to a string";if(t.type===ce.ARRAY&&t.value instanceof Array){console.warn(`Unprocessed array. ${s}`);const o={};for(let a=0;a<t.value.length;a++)o[a]=t.value[a];t.value=o}if(t.type===ce.BINARY&&typeof t.value!="string"&&(console.warn(`Unprocessed binary value. ${s}`),t.value=Er.encode(t.value)),t.type===ce.REFERENCE&&t.value instanceof ct&&(console.warn(`Unprocessed path reference. ${s}`),t.value=t.value.path),[ce.OBJECT,ce.ARRAY].includes(t.type)){const o=t.value;t.value={},Object.keys(o).forEach(a=>{t.value[a]=i(o[a])})}return r.transaction.set(e,t)}_processReadNodeValue(e){const t=r=>{if(r.type===ce.BINARY)return Er.decode(r.value);if(r.type===ce.DATETIME)return new Date(r.value);if(r.type===ce.REFERENCE)return new ct(r.value);throw new Error(`Unhandled child value type ${r.type}`)};switch(e.type){case ce.ARRAY:case ce.OBJECT:{const r=e.value;Object.keys(r).forEach(i=>{const s=r[i];typeof s=="object"&&"type"in s&&(r[i]=t(s))}),e.value=r;break}case ce.BINARY:{e.value=Er.decode(e.value);break}case ce.REFERENCE:{e.value=new ct(e.value);break}case ce.STRING:break;default:throw new Error("Invalid standalone record value type")}}_readNode(e,t){return V(this,null,function*(){const r=yield t.transaction.get(e);return r===null?null:(typeof r!="object"&&this.throwImplementationError("transaction.get must return an ICustomStorageNode object. Use JSON.parse if your set function stored it as a string"),this._processReadNodeValue(r),r)})}_getTypeFromStoredValue(e){let t;if(typeof e=="string")t=ce.STRING;else if(typeof e=="number")t=ce.NUMBER;else if(typeof e=="boolean")t=ce.BOOLEAN;else if(e instanceof Array)t=ce.ARRAY;else if(typeof e=="object")if("type"in e){const r=e;t=r.type,e=r.value,t===ce.DATETIME?e=new Date(e):t===ce.REFERENCE&&(e=new ct(e))}else t=ce.OBJECT;else throw new Error("Unknown value type");return{type:t,value:e}}_writeNode(e,t,r){return V(this,null,function*(){if(!r.merge&&this.valueFitsInline(t)&&e!=="")throw new Error("invalid value to store in its own node");if(e===""&&(typeof t!="object"||t instanceof Array))throw new Error("Invalid root node value. Must be an object");if(typeof r.diff=="undefined"&&typeof r.currentValue!="undefined"){const d=$L(r.currentValue,t);r.merge&&typeof d=="object"&&(d.removed=d.removed.filter(y=>t[y]===null)),r.diff=d}if(r.diff==="identical")return;const i=r.transaction,s=r.currentValue===null?null:yield this._readNode(e,{transaction:i});if(r.merge&&s){if(s.type===ce.ARRAY&&!(t instanceof Array)&&typeof t=="object"&&Object.keys(t).some(d=>isNaN(parseInt(d))))throw new Error(`Cannot merge existing array of path "${e}" with an object`);if(t instanceof Array&&s.type!==ce.ARRAY)throw new Error(`Cannot merge existing object of path "${e}" with an array`)}const o=r.revision||Wt.generate(),a={type:s&&s.type===ce.ARRAY?ce.ARRAY:ce.OBJECT,value:{}},c={};if(t instanceof Array){a.type=ce.ARRAY;const d={};for(let y=0;y<t.length;y++)d[y]=t[y];t=d}else t instanceof ct?(a.type=ce.REFERENCE,a.value=t.path):t instanceof ArrayBuffer?(a.type=ce.BINARY,a.value=Er.encode(t)):typeof t=="string"&&(a.type=ce.STRING,a.value=t);const l=s?[ce.OBJECT,ce.ARRAY].includes(s.type):!1,u=[ce.OBJECT,ce.ARRAY].includes(a.type),h={current:[],new:[]};let p=null;l&&(p=s.value,h.current=Object.keys(p),u&&(a.value=p)),u&&(r.merge||Object.keys(a.value).forEach(d=>{d in t||(t[d]=null)}),Object.keys(t).forEach(d=>{const y=t[d];if(delete a.value[d],y!==null){if(typeof y=="undefined")if(this.settings.removeVoidProperties===!0){delete t[d];return}else throw new Error(`Property "${d}" has invalid value. Cannot store undefined values. Set removeVoidProperties option to true to automatically remove undefined properties`);this.valueFitsInline(y)?a.value[d]=y:c[d]=y}}));const f=a.type===ce.ARRAY;if(s){if(this.debug.log(`Node "/${e}" is being ${r.merge?"updated":"overwritten"}`.colorize(Tt.cyan)),l||u){const y=G.get(e),_=[];let S=!1;const I=T=>(S=!0,!i.production&&!y.isParentOf(T)&&this.throwImplementationError(`"${T}" is not a child of "${e}" - childrenOf must only check and return paths that are children`),!0),B=T=>{S||this.throwImplementationError("childrenOf did not call checkCallback before addCallback");const R=G.get(T).key;return _.push(R.toString()),!0};yield i.childrenOf(e,{metadata:!1,value:!1},I,B),h.current=h.current.concat(_),u&&(r&&r.merge&&(h.new=h.current.slice()),Object.keys(t).forEach(T=>{h.new.includes(T)||h.new.push(T)}));const j={insert:h.new.filter(T=>!h.current.includes(T)),update:[],delete:r&&r.merge?Object.keys(t).filter(T=>t[T]===null):h.current.filter(T=>!h.new.includes(T))};if(j.update=h.new.filter(T=>h.current.includes(T)&&!j.delete.includes(T)),f&&r.merge&&(j.insert.length>0||j.delete.length>0)&&!j.update.concat(j.insert).every((C,E,m)=>m.includes(E.toString())))throw new Error(`Elements cannot be inserted beyond, or removed before the end of an array. Rewrite the whole array at path "${e}" or change your schema to use an object collection instead`);const U=Object.keys(c).map(T=>{const R=f?parseInt(T):T,C=typeof r.diff=="object"?r.diff.forChild(R):void 0;if(C==="identical")return;const E=y.childPath(R),m=c[R],v=typeof r.currentValue=="undefined"?void 0:r.currentValue!==null&&typeof r.currentValue=="object"&&R in r.currentValue?r.currentValue[R]:null;return this._writeNode(E,m,{transaction:i,revision:o,merge:!1,currentValue:v,diff:C})}),M=u?_.filter(T=>T in a.value):[],L=j.delete.concat(M).map(T=>{const R=f?parseInt(T):T,C=y.childPath(R);return this._deleteNode(C,{transaction:i})}),F=U.concat(L);yield Promise.all(F)}const d=this._storeNode(e,{type:a.type,value:a.value,revision:s.revision,revision_nr:s.revision_nr+1,created:s.created,modified:Date.now()},{transaction:i});if(d instanceof Promise)return yield d}else{if(this.debug.log(`Node "/${e}" is being created`.colorize(Tt.cyan)),f&&!Object.keys(a.value).concat(Object.keys(c)).every((I,B,j)=>j.includes(B.toString())))throw new Error("Cannot store arrays with missing entries");const d=Object.keys(c).map(_=>{const S=f?parseInt(_):_,I=G.getChildPath(e,S),B=c[S];return this._writeNode(I,B,{transaction:i,revision:o,merge:!1,currentValue:null})}),y=this._storeNode(e,{type:a.type,value:a.value,revision:o,revision_nr:1,created:Date.now(),modified:Date.now()},{transaction:i});y instanceof Promise&&d.push(y),yield Promise.all(d)}})}_deleteNode(e,t){return V(this,null,function*(){const r=G.get(e);this.debug.log(`Node "/${e}" is being deleted`.colorize(Tt.cyan));const i=[e];let s=!1;const o=l=>(s=!0,!c.production&&!r.isAncestorOf(l)&&this.throwImplementationError(`"${l}" is not a descendant of "${e}" - descendantsOf must only check and return paths that are descendants`),!0),a=l=>(s||this.throwImplementationError("descendantsOf did not call checkCallback before addCallback"),i.push(l),!0),c=t.transaction;return yield c.descendantsOf(e,{metadata:!1,value:!1},o,a),this.debug.log(`Nodes ${i.map(l=>`"/${l}"`).join(",")} are being deleted`.colorize(Tt.cyan)),c.removeMultiple(i)})}getChildren(e,t={}){let r;const i={next(o){return r=o,s()}},s=()=>V(this,null,function*(){const o=t.transaction||(yield this._customImplementation.getTransaction({path:e,write:!1}));try{let a=!1;return yield(()=>V(this,null,function*(){const c=yield this._readNode(e,{transaction:o});if(!c)throw new md(`Node "/${e}" does not exist`);if(![ce.OBJECT,ce.ARRAY].includes(c.type))return;const l=c.type===ce.ARRAY,u=c.value;let h=Object.keys(u).map(_=>l?parseInt(_):_);t.keyFilter&&(h=h.filter(_=>t.keyFilter.includes(_)));const p=G.get(e);if(h.length>0&&h.every(_=>{const S=this._getTypeFromStoredValue(u[_]),I=new lu({path:p.childPath(_),key:l?null:_,index:l?_:null,type:S.type,address:null,exists:!0,value:S.value,revision:c.revision,revision_nr:c.revision_nr,created:new Date(c.created),modified:new Date(c.modified)});return a=r(I)===!1,!a}),a)return;let f=!1;const d=_=>{if(f=!0,!o.production&&!p.isParentOf(_)&&this.throwImplementationError(`"${_}" is not a child of "${e}" - childrenOf must only check and return paths that are children`),t.keyFilter){const S=G.get(_).key;return t.keyFilter.includes(S)}return!0},y=(_,S)=>{f||this.throwImplementationError("childrenOf did not call checkCallback before addCallback");const I=G.get(_).key,B=new lu({path:_,type:S.type,key:l?null:I,index:l?I:null,address:new og(_),exists:!0,value:null,revision:S.revision,revision_nr:S.revision_nr,created:new Date(S.created),modified:new Date(S.modified)});return a=r(B)===!1,!a};yield o.childrenOf(e,{metadata:!0,value:!1},d,y)}))(),t.transaction||(yield o.commit()),a}catch(a){throw t.transaction||(yield o.rollback(a)),a}});return i}getNode(e,t){return V(this,null,function*(){t=t||{};const r=t.transaction||(yield this._customImplementation.getTransaction({path:e,write:!1}));try{const i=yield(()=>V(this,null,function*(){const s=t.include&&t.include.length>0||t.exclude&&t.exclude.length>0||t.child_objects===!1,o=G.get(e),a=yield this._readNode(e,{transaction:r});if(!a){if(e==="")return{value:null};const B=yield r.moveToParentPath(o.parentPath);nn(B===o.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${e}"`);const j=yield this._readNode(o.parentPath,{transaction:r});if(j&&[ce.OBJECT,ce.ARRAY].includes(j.type)&&o.key in j.value){const U=this._getTypeFromStoredValue(j.value[o.key]);return{revision:j.revision,revision_nr:j.revision_nr,created:j.created,modified:j.modified,type:U.type,value:U.value}}return{value:null}}const c=a.type===ce.ARRAY,l=B=>{const j=U=>/^[0-9]+$/.test(U);return B.map(U=>G.get(c&&j(U)?`[${U}]`:U))},u=t.include?l(t.include):[],h=t.exclude?l(t.exclude):[],p=(B,j)=>{if([ce.OBJECT,ce.ARRAY].includes(j.type)&&u.length>0){const U=G.getPathKeys(B).slice(o.keys.length),M=new G(U),H=[],L=u.filter(R=>R.isDescendantOf(M));if(L.length>0){const R=j.type===ce.ARRAY;H.push(...Object.keys(j.value).map(C=>R?+C:C));for(const C of L){const E=C.keys[U.length];if(typeof E=="string"&&(E==="*"||E.startsWith("$"))){H.splice(0);break}const m=H.indexOf(E);m>=0&&H.splice(m,1)}}const F=u.some(R=>R.isChildOf(M));if(h.some(R=>R.isChildOf(M))&&!F){const R=h.filter(C=>C.isChildOf(M));for(let C=0;C<H.length;C++)R.find(E=>E.equals(H[C]))||(H.splice(C,1),C--)}for(const R of H)delete j.value[R]}};p(e,a);let f=!1;const d=(B,j)=>{if(f=!0,!r.production&&!o.isAncestorOf(B)&&this.throwImplementationError(`"${B}" is not a descendant of "${e}" - descendantsOf must only check and return paths that are descendants`),!s)return!0;const M=G.getPathKeys(B).slice(o.keys.length),H=new G(M);let L=(u.length>0?u.some(F=>H.isOnTrailOf(F)):!0)&&(h.length>0?!h.some(F=>F.equals(H)||F.isAncestorOf(H)):!0);return L&&t.child_objects===!1&&(o.isParentOf(B)&&[ce.OBJECT,ce.ARRAY].includes(j?j.type:-1)||G.getPathKeys(B).length>o.pathKeys.length+1)&&(L=!1),L},y=[],_=(B,j)=>{if(f||this.throwImplementationError("descendantsOf did not call checkCallback before addCallback"),t.child_objects===!1&&[ce.OBJECT,ce.ARRAY].includes(j.type))return!0;p(B,j),this._processReadNodeValue(j);const U=j;return U.path=B,y.push(U),!0};yield r.descendantsOf(e,{metadata:!0,value:!0},d,_),this.debug.log(`Read node "/${e}" and ${s?"(filtered) ":""}descendants from ${y.length+1} records`.colorize(Tt.magenta));const S=a,I=B=>{const j=[];return Object.keys(B).forEach(U=>{const M=parseInt(U);j[M]=B[M]}),j};if(a.type===ce.ARRAY&&(S.value=I(S.value)),a.type===ce.OBJECT||a.type===ce.ARRAY){const B=G.getPathKeys(e),j=a.value;for(let U=0;U<y.length;U++){const M=y[U],L=G.getPathKeys(M.path).slice(B.length);let F=j;for(let T=0;T<L.length;T++){nn(typeof F=="object","parent must be an object/array to have children!!");const R=L[T],C=T===L.length-1,E=C?M.type:typeof L[T+1]=="number"?ce.ARRAY:ce.OBJECT;let m;C?(m=M.value,E===ce.ARRAY&&(m=I(m))):m=E===ce.OBJECT?{}:[],R in F?typeof F[R]==typeof m&&[ce.OBJECT,ce.ARRAY].includes(E)?Object.keys(m).forEach(g=>{g in F[R]&&this.throwImplementationError(`Custom storage merge error: child key "${g}" is in parent value already! Make sure the get/childrenOf/descendantsOf methods of the custom storage class return values that can be modified by AceBase without affecting the stored source`),F[R][g]=m[g]}):this.debug.error(`The value stored in node "${M.path}" cannot be merged with the parent node, value will be ignored. This error should disappear once the target node value is updated. See issue #20 for more information`,{path:e,parent:F,key:R,nodeType:E,nodeValue:m}):F[R]=m,F=F[R]}}}else y.length>0&&this.throwImplementationError("multiple records found for non-object value!");if(t.child_objects===!1&&Object.keys(S.value).forEach(B=>{typeof S.value[B]=="object"&&S.value[B].constructor===Object&&(nn(Object.keys(S.value[B]).length===0),delete S.value[B])}),t.include,t.exclude){const B=(j,U)=>{if(typeof j!="object")return;const M=U[0];M==="*"?Object.keys(j).forEach(H=>{B(j[H],U.slice(1))}):U.length>1?M in j&&B(j[M],U.slice(1)):delete j[M]};t.exclude.forEach(j=>{const U=G.getPathKeys(j);B(S.value,U)})}return S}))();return t.transaction||(yield r.commit()),i}catch(i){throw t.transaction||(yield r.rollback(i)),i}})}getNodeInfo(r){return V(this,arguments,function*(e,t={}){t=t||{};const i=G.get(e),s=t.transaction||(yield this._customImplementation.getTransaction({path:e,write:!1}));try{const o=yield this._readNode(e,{transaction:s}),a=new lu({path:e,key:typeof i.key=="string"?i.key:null,index:typeof i.key=="number"?i.key:null,type:o?o.type:0,exists:o!==null,address:o?new og(e):null,created:o?new Date(o.created):null,modified:o?new Date(o.modified):null,revision:o?o.revision:null,revision_nr:o?o.revision_nr:null});if(!o&&e!==""){const c=yield s.moveToParentPath(i.parentPath);nn(c===i.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${e}"`);const l=yield this._readNode(i.parentPath,{transaction:s});l&&[ce.OBJECT,ce.ARRAY].includes(l.type)&&i.key in l.value?(a.exists=!0,a.value=l.value[i.key],a.address=null,a.type=l.type,a.created=new Date(l.created),a.modified=new Date(l.modified),a.revision=l.revision,a.revision_nr=l.revision_nr):a.address=null}return t.include_child_count&&(a.childCount=0,[ce.OBJECT,ce.ARRAY].includes(a.valueType)&&a.address&&(a.childCount=o.value?Object.keys(o.value).length:0,a.childCount+=yield s.getChildCount(e))),t.transaction||(yield s.commit()),a}catch(o){throw t.transaction||(yield s.rollback(o)),o}})}setNode(i,s){return V(this,arguments,function*(e,t,r={suppress_events:!1,context:null}){if(this.settings.readOnly)throw new Error("Database is opened in read-only mode");const o=G.get(e),a=r.transaction||(yield this._customImplementation.getTransaction({path:e,write:!0}));try{if(e===""){if(t===null||typeof t!="object"||t instanceof Array||t instanceof ArrayBuffer||"buffer"in t&&t.buffer instanceof ArrayBuffer)throw new Error(`Invalid value for root node: ${t}`);yield this._writeNodeWithTracking("",t,{merge:!1,transaction:a,suppress_events:r.suppress_events,context:r.context})}else if(typeof r.assert_revision!="undefined"){const c=yield this.getNodeInfo(e,{transaction:a});if(c.revision!==r.assert_revision)throw new Th(`revision '${c.revision}' does not match requested revision '${r.assert_revision}'`);if(c.address&&c.address.path===e&&t!==null&&!this.valueFitsInline(t))yield this._writeNodeWithTracking(e,t,{merge:!1,transaction:a,suppress_events:r.suppress_events,context:r.context});else{const l=yield a.moveToParentPath(o.parentPath);nn(l===o.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${e}"`),yield this._writeNodeWithTracking(o.parentPath,{[o.key]:t},{merge:!0,transaction:a,suppress_events:r.suppress_events,context:r.context})}}else{const c=yield a.moveToParentPath(o.parentPath);nn(c===o.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${e}"`),yield this.updateNode(o.parentPath,{[o.key]:t},{transaction:a,suppress_events:r.suppress_events,context:r.context})}r.transaction||(yield a.commit())}catch(c){throw r.transaction||(yield a.rollback(c)),c}})}updateNode(i,s){return V(this,arguments,function*(e,t,r={suppress_events:!1,context:null}){if(this.settings.readOnly)throw new Error("Database is opened in read-only mode");if(typeof t!="object")throw new Error("invalid updates argument");if(Object.keys(t).length===0)return;const o=r.transaction||(yield this._customImplementation.getTransaction({path:e,write:!0}));try{const a=yield this.getNodeInfo(e,{transaction:o}),c=G.get(e);if(a.exists&&a.address&&a.address.path===e)yield this._writeNodeWithTracking(e,t,{transaction:o,merge:!0,suppress_events:r.suppress_events,context:r.context});else if(a.exists){const l=G.get(e),u=yield o.moveToParentPath(l.parentPath);nn(u===l.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${e}"`),yield this._writeNodeWithTracking(l.parentPath,{[l.key]:t},{transaction:o,merge:!0,suppress_events:r.suppress_events,context:r.context})}else{const l=yield o.moveToParentPath(c.parentPath);nn(l===c.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${e}"`),yield this.updateNode(c.parentPath,{[c.key]:t},{transaction:o,suppress_events:r.suppress_events,context:r.context})}r.transaction||(yield o.commit())}catch(a){throw r.transaction||(yield o.rollback(a)),a}})}}class PL{constructor(e=1e3,t){this.limit=e,this.options=t,this.added=0,this.scheduled=[],this.running=0,this.results=[],this.done=!1}execute(e,t){return V(this,null,function*(){var r,i;try{this.running++;const s=yield e();if(this.results[t]=s,this.running--,this.running===0&&this.scheduled.length===0)this.done=!0,(r=this.doneCallback)==null||r.call(this,this.results);else if(this.scheduled.length>0){const o=this.scheduled.shift();this.execute(o.task,o.index)}}catch(s){this.done=!0,(i=this.errorCallback)==null||i.call(this,s)}})}add(e){var r;if(this.done)throw new Error("Cannot add to a batch that has already finished. Use wait option and start batch processing manually if you are adding tasks in an async loop");const t=this.added++;((r=this.options)==null?void 0:r.wait)!==!0&&this.running<this.limit?this.execute(e,t):this.scheduled.push({task:e,index:t})}start(){for(;this.running<this.limit;){const e=this.scheduled.shift();this.execute(e.task,e.index)}}finish(){return V(this,null,function*(){return this.running===0&&this.scheduled.length===0?this.results:(yield new Promise((e,t)=>{this.doneCallback=e,this.errorCallback=t}),this.results)})}}const IL=()=>{};function Dw(i,s,o){return V(this,arguments,function*(n,e,t,r={snapshots:!1,include:void 0,exclude:void 0,child_objects:void 0,eventHandler:IL}){var H,L,F,T,R,C;typeof r!="object"&&(r={}),typeof r.snapshots=="undefined"&&(r.snapshots=!1);const a={};(H=n.storage.settings.transactions)!=null&&H.log&&(a.acebase_cursor=Wt.generate());const c=t.filters.map(E=>re({},E)),l=t.order.map(E=>re({},E)),u=E=>{E.sort((m,v)=>{const g=k=>{const x=l[k],b=G.getPathKeys(typeof x.key=="number"?`[${x.key}]`:x.key),w=b.reduce((O,$)=>O!==null&&typeof O=="object"&&$ in O?O[$]:null,m.val),A=b.reduce((O,$)=>O!==null&&typeof O=="object"&&$ in O?O[$]:null,v.val);return w===null?A===null?0:x.ascending?-1:1:A===null?x.ascending?1:-1:w==A?k<l.length-1?g(k+1):m.path<v.path?-1:1:w<A?x.ascending?-1:1:x.ascending?1:-1};return g(0)})},h=(E,m)=>V(this,null,function*(){if(E.length===0)return[];const v=50,g=new PL(v),k=[];return E.forEach(({path:x},b)=>g.add(()=>V(this,null,function*(){const A=(yield n.storage.getNode(x,m)).value;if(A===null){n.storage.debug.warn(`Indexed result "/${x}" does not have a record!`);return}const O={path:x,val:A};M.sorted?k[b]=O:(k.push(O),!M.skipped&&k.length>t.skip+Math.abs(t.take)&&(u(k),k.pop()))}))),yield g.finish(),k}),p=G.get(e),f=p.keys.some(E=>E==="*"||E.toString().startsWith("$")),d=n.storage.indexes.get(e),y=[];let _=()=>V(this,null,function*(){});if(f){const E=p.keys.filter(g=>typeof g=="string"&&g.startsWith("$")),m=E.length>0&&E.every(g=>t.filters.some(k=>k.key===g&&["==","in"].includes(k.op))),v=typeof r.monitor=="object"&&[(L=r.monitor)==null?void 0:L.add,(F=r.monitor)==null?void 0:F.change,(T=r.monitor)==null?void 0:T.remove].some(g=>g===!0);if(m&&!v){const g=[];for(const $ of E){const N=t.filters.filter(z=>z.key===$).reduce((z,q)=>{if(q.op==="=="&&z.push(q.compare),q.op==="in"){if(!(q.compare instanceof Array))throw new Error("compare argument for 'in' operator must be an Array");z.push(...q.compare)}return z},[]),D=g.splice(0);N.forEach(z=>{D.length===0?g.push({[$]:z}):g.push(...D.map(q=>Je(re({},q),{[$]:z})))})}const k=t.filters.filter($=>!E.includes($.key)),x=g.map($=>G.get(G.getPathKeys(e).map(P=>{var N;return(N=$[P])!=null?N:P})).path),b=t.order.length>0,w=x.map($=>{var P;return Dw(n,$,{filters:k,take:0,skip:0,order:[]},{snapshots:b,cache_mode:r.cache_mode,include:[...(P=r.include)!=null?P:[],...t.order.map(N=>N.key)],exclude:r.exclude})});let O=(yield Promise.all(w)).reduce(($,P)=>($.push(...P.results),$),[]);if(b&&u(O),t.skip>0&&O.splice(0,t.skip),t.take>0&&O.splice(t.take),r.snapshots&&(!b||((R=r.include)==null?void 0:R.length)>0||((C=r.exclude)==null?void 0:C.length)>0||!r.child_objects)){const{include:$,exclude:P,child_objects:N}=r;O=yield h(O,{include:$,exclude:P,child_objects:N})}return{results:O,context:null,stop:_}}else if(d.length===0){const g=new Error(`Query on wildcard path "/${e}" requires an index`);return Promise.reject(g)}if(c.length===0){const g=d.filter(k=>k.type==="normal")[0];c.push({key:g.key,op:"!=",compare:null})}}c.forEach(E=>{if(E.index)return;const m=d.filter(v=>v.key===E.key).filter(v=>v.validOperators.includes(E.op));if(m.length>=1){const v=c.filter(b=>b!==E).map(b=>b.key),g=l.map(b=>b.key).filter(b=>b!==E.key),k=m.map(b=>{const w=b.includeKeys.concat(b.key),A=w.filter(N=>v.includes(N)),O=w.filter(N=>g.includes(N)),$=A.concat(O.filter(N=>!A.includes(N))),P={filters:A.length,sorting:O.length*(t.take!==0?O.length:1),both:$.length*$.length,get total(){return this.filters+this.sorting+this.both}};return{index:b,points:P.total,filterKeys:A,sortKeys:O}});k.sort((b,w)=>b.points>w.points?-1:1);const x=k[0];E.index=x.index,x.filterKeys.forEach(b=>{c.filter(w=>w!==E&&w.key===b).forEach(w=>{!vd.validOperators.includes(w.op)||(w.indexUsage="filter",w.index=x.index)})}),x.sortKeys.forEach(b=>{l.filter(w=>w.key===b).forEach(w=>{w.index=x.index})})}E.index&&y.push({index:E.index,description:E.index.description})}),l.length>0&&t.take!==0&&c.length===0&&l.forEach(E=>{E.index||(E.index=d.filter(m=>m.key===E.key).find(m=>m.type==="normal"))});const S=y.map(E=>E.description).join(", ");y.length>0&&n.storage.debug.log(`Using indexes for query: ${S}`);const I=c.filter(E=>!E.index),B=/^[a-z]+:/i;if(I.some(E=>B.test(E.op))){const E=I.find(v=>B.test(v.op)),m=new Error(`query contains operator "${E.op}" which requires a special index that was not found on path "${e}", key "${E.key}"`);return Promise.reject(m)}const j=["<","<=","==","!=",">=",">","like","!like","in","!in","matches","!matches","between","!between","has","!has","contains","!contains","exists","!exists"];for(let E=0;E<I.length;E++){const m=I[E];if(!j.includes(m.op))return Promise.reject(new Error(`query contains unknown filter operator "${m.op}" on path "${e}", key "${m.key}"`))}if(f&&I.length>0){const E=I.reduce((v,g)=>(v.indexOf(g.key)<0&&v.push(g.key),v),[]).map(v=>`"${v}"`),m=new Error(`This wildcard path query on "/${e}" requires index(es) on key(s): ${E.join(", ")}. Create the index(es) and retry`);return Promise.reject(m)}const U=[];c.forEach(E=>{if(E.index&&E.indexUsage!=="filter"){let m=E.index.query(E.op,E.compare).then(g=>(r.eventHandler&&r.eventHandler({name:"stats",type:"index_query",source:E.index.description,stats:g.stats}),g.hints.length>0&&r.eventHandler&&r.eventHandler({name:"hints",type:"index_query",source:E.index.description,hints:g.hints}),g));const v=c.filter(g=>g.index===E.index&&g.indexUsage==="filter");v.length>0&&(m=m.then(g=>(v.forEach(k=>{const{key:x,op:b,index:w}=k;let{compare:A}=k;typeof A=="string"&&!w.caseSensitive&&(A=A.toLocaleLowerCase(w.textLocale)),g=g.filterMetadata(x,b,A)}),g))),U.push(m)}});const M={filtered:c.length===0,skipped:t.skip===0,taken:t.take===0,sorted:l.length===0,preDataLoaded:!1,dataLoaded:!1};if(c.length===0&&t.take===0&&(n.storage.debug.warn(`Filterless queries must use .take to limit the results. Defaulting to 100 for query on path "${e}"`),t.take=100),l.length>0&&l[0].index){const E=l[0].index,m=t.take<0?!l[0].ascending:l[0].ascending;if(c.length===0&&l.slice(1).every(v=>E.allMetadataKeys.includes(v.key))){n.storage.debug.log(`Using index for sorting: ${E.description}`);const v=l.slice(1).map(k=>(k.index=E,{key:k.key,ascending:k.ascending})),g=E.take(t.skip,Math.abs(t.take),{ascending:m,metadataSort:v}).then(k=>(r.eventHandler&&r.eventHandler({name:"stats",type:"sort_index_take",source:E.description,stats:k.stats}),k.hints.length>0&&r.eventHandler&&r.eventHandler({name:"hints",type:"sort_index_take",source:E.description,hints:k.hints}),k));U.push(g),M.skipped=!0,M.taken=!0,M.sorted=!0}}return Promise.all(U).then(E=>V(this,null,function*(){let m=[];if(E.length===1){const A=E[0];m=A.map(O=>{const $={key:O.key,path:O.path,val:{[A.filterKey]:O.value}};return O.metadata&&Object.assign($.val,O.metadata),$}),M.filtered=!0}else if(E.length>1){E.sort(($,P)=>$.length<P.length?-1:1);const A=E[0],O=E.slice(1);m=A.reduce(($,P)=>{const N={key:P.key,path:P.path,val:{[A.filterKey]:P.value}};return O.every(z=>z.findIndex(q=>q.path===P.path)>=0)&&(P.metadata&&Object.assign(N.val,P.metadata),O.forEach(z=>{const q=z.find(ne=>ne.path===N.path);N.val[z.filterKey]=q.value,q.metadata&&Object.assign(N.val,q.metadata)}),$.push(N)),$},[]),M.filtered=!0}if(f||U.length>0&&I.length===0){if(l.length===0||l.every(A=>A.index)){if(M.preDataLoaded=!0,!M.sorted&&l.length>0&&u(m),M.sorted=!0,!M.skipped&&t.skip>0&&(m=t.take<0?m.slice(0,-t.skip):m.slice(t.skip)),!M.taken&&t.take!==0&&(m=t.take<0?m.slice(t.take):m.slice(0,t.take)),M.skipped=!0,M.taken=!0,!r.snapshots)return m;const A={include:r.include,exclude:r.exclude,child_objects:r.child_objects};return h(m,A).then(O=>(M.dataLoaded=!0,O))}if(r.snapshots||!M.sorted){const A=l.length>0,O=A?{include:l.map($=>$.key)}:{include:r.include,exclude:r.exclude,child_objects:r.child_objects};return h(m,O).then($=>(l.length>0&&u($),M.sorted=!0,t.skip>0&&($=t.take<0?$.slice(0,-t.skip):$.slice(t.skip)),t.take!==0&&($=t.take<0?$.slice(t.take):$.slice(0,t.take)),M.skipped=!0,M.taken=!0,r.snapshots&&A?h($,{include:r.include,exclude:r.exclude,child_objects:r.child_objects}):$))}else return m}let v;m.length>0&&(v=m.map(A=>A.key));let g=[],k=!1;const x=l.length>0,b=x?{include:l.map(A=>A.key)}:{include:r.include,exclude:r.exclude,child_objects:r.child_objects},w={promises:[],add(A){if(this.promises.push(A),this.promises.length>=1e3)return Promise.all(this.promises.splice(0)).then(O=>{})}};try{yield n.storage.getChildren(e,{keyFilter:v,async:!0}).next(A=>{if(A.type!==ce.OBJECT||!A.address)return;if(k)return!1;const O=()=>V(this,null,function*(){if(!(yield n.storage.matchNode(A.address.path,I)))return;const N=A.address.path;let D;if(r.snapshots||l.length>0){const z=yield n.storage.getNode(N,b);D={path:N,val:z.value}}else D={path:N};g.push(D),t.take!==0&&g.length>Math.abs(t.take)+t.skip&&(l.length>0?u(g):t.take>0&&(k=!0),g.pop())}),$=w.add(O());if($ instanceof Promise)return $})}catch(A){return A instanceof md||n.storage.debug.warn(`Error getting child stream: ${A}`),[]}return yield Promise.all(w.promises),M.preDataLoaded=x,M.dataLoaded=!x,l.length>0&&u(g),M.sorted=!0,t.skip>0&&(g=t.take<0?g.slice(0,-t.skip):g.slice(t.skip)),M.skipped=!0,t.take!==0&&(g=t.take<0?g.slice(t.take):g.slice(0,t.take)),M.taken=!0,M.dataLoaded||(g=yield h(g,{include:r.include,exclude:r.exclude,child_objects:r.child_objects}),M.dataLoaded=!0),g})).then(E=>{if(!M.sorted&&l.length>0&&u(E),r.snapshots||(E=E.map(m=>m.path)),!M.skipped&&t.skip>0&&(E=t.take<0?E.slice(0,-t.skip):E.slice(t.skip)),!M.taken&&t.take!==0&&(E=t.take<0?E.slice(t.take):E.slice(0,t.take)),r.monitor===!0&&(r.monitor={add:!0,change:!0,remove:!0}),typeof r.monitor=="object"&&(r.monitor.add||r.monitor.change||r.monitor.remove)){const m=r.monitor,v=r.snapshots?E.map($=>$.path):E.slice(),g=n.db.ref(e),k=$=>{const P=v.indexOf($);P<0||v.splice(P,1)},x=$=>{v.includes($)||v.push($)},b=()=>{n.unsubscribe(g.path,"child_changed",w),n.unsubscribe(g.path,"child_added",A),n.unsubscribe(g.path,"notify_child_removed",O)};_=()=>V(this,null,function*(){b()});const w=($,P,N,D)=>V(this,null,function*(){const z=v.includes(P);let q=!0;const ne=[];c.forEach(ie=>!ne.includes(ie.key)&&ne.push(ie.key));const te=[];typeof D=="object"&&Object.keys(D).forEach(ie=>!te.includes(ie)&&te.push(ie)),typeof N=="object"&&Object.keys(N).forEach(ie=>!te.includes(ie)&&te.push(ie));const ue=[];let le=te.every(ie=>ne.includes(ie)?c.filter(ke=>ke.key===ie).every(ke=>{var ve;return((ve=ke.index)==null?void 0:ve.textLocaleKey)&&!te.includes(ke.index.textLocaleKey)?(ue.push(ke.index.textLocaleKey),!0):j.includes(ke.op)?n.storage.test(N[ie],ke.op,ke.compare):ke.index.test(N,ke.op,ke.compare)}):!0);if(le&&(ue.push(...ne.filter(ie=>!te.includes(ie))),!z&&ue.length>0)){const ie=c.filter(ve=>ue.includes(ve.key)),pe=ie.filter(ve=>j.includes(ve.op)),ke=ie.filter(ve=>!j.includes(ve.op));if(pe.length>0&&(le=yield n.storage.matchNode(P,pe)),le&&ke.length>0){const ve=ke.reduce((je,He)=>(je.includes(He.key)||je.push(He.key),He.index instanceof Lw&&He.index.config.localeKey&&!je.includes(He.index.config.localeKey)&&je.push(He.index.config.localeKey),je),[]),ze=yield n.storage.getNode(P,{include:ve});if(ze.value===null)return!1;le=ke.every(je=>je.index.test(ze.value,je.op,je.compare))}}if(le){if(z||x(P),r.snapshots){const ie={include:r.include,exclude:r.exclude,child_objects:r.child_objects};N=(yield n.storage.getNode(P,ie)).value}z&&m.change?q=r.eventHandler({name:"change",path:P,value:N})!==!1:!z&&m.add&&(q=r.eventHandler({name:"add",path:P,value:N})!==!1)}else z&&(k(P),m.remove&&(q=r.eventHandler({name:"remove",path:P,value:D})!==!1));q===!1&&b()}),A=($,P,N)=>{const D=c.every(q=>j.includes(q.op)?n.storage.test(N[q.key],q.op,q.compare):q.index.test(N,q.op,q.compare));let z=!0;D&&(x(P),m.add&&(z=r.eventHandler({name:"add",path:P,value:r.snapshots?N:null})!==!1)),z===!1&&b()},O=($,P,N,D)=>{let z=!0;k(P),m.remove&&(z=r.eventHandler({name:"remove",path:P,value:r.snapshots?D:null})!==!1),z===!1&&b()};(r.monitor.add||r.monitor.change||r.monitor.remove)&&n.subscribe(g.path,"child_changed",w),r.monitor.remove&&n.subscribe(g.path,"notify_child_removed",O),r.monitor.add&&n.subscribe(g.path,"child_added",A)}return{results:E,context:a,stop:_}})})}class RL extends iL{constructor(e="default",t,r){super(),this.db=t.db;const i={logLevel:t.settings.logLevel};if(typeof t.settings.storage=="object")if(rg&&t.settings.storage instanceof rg)this.storage=new fL(e,t.settings.storage,i);else if(ig&&t.settings.storage instanceof ig)this.storage=new dL(e,t.settings.storage,i);else if(ho&&t.settings.storage instanceof ho)this.storage=new TL(e,t.settings.storage,i);else{const s=t.settings.storage instanceof au?t.settings.storage:new au(t.settings.storage);this.storage=new $h(e,s,i)}else this.storage=new $h(e,new au,i);this.storage.on("ready",r)}stats(e){return V(this,null,function*(){return this.storage.stats})}subscribe(e,t,r){this.storage.subscriptions.add(e,t,r)}unsubscribe(e,t,r){this.storage.subscriptions.remove(e,t,r)}set(i,s){return V(this,arguments,function*(e,t,r={suppress_events:!1,context:null}){const o=yield this.storage.setNode(e,t,{suppress_events:r.suppress_events,context:r.context});return re({},o&&{cursor:o})})}update(i,s){return V(this,arguments,function*(e,t,r={suppress_events:!1,context:null}){const o=yield this.storage.updateNode(e,t,{suppress_events:r.suppress_events,context:r.context});return re({},o&&{cursor:o})})}get transactionLoggingEnabled(){return this.storage.settings.transactions&&this.storage.settings.transactions.log===!0}get(e,t){return V(this,null,function*(){if(t||(t={}),typeof t.include!="undefined"&&!(t.include instanceof Array))throw new TypeError("options.include must be an array of key names");if(typeof t.exclude!="undefined"&&!(t.exclude instanceof Array))throw new TypeError("options.exclude must be an array of key names");if(["undefined","boolean"].indexOf(typeof t.child_objects)<0)throw new TypeError("options.child_objects must be a boolean");const r=yield this.storage.getNode(e,t);return{value:r.value,context:{acebase_cursor:r.cursor},cursor:r.cursor}})}transaction(i,s){return V(this,arguments,function*(e,t,r={suppress_events:!1,context:null}){const o=yield this.storage.transactNode(e,t,{suppress_events:r.suppress_events,context:r.context});return re({},o&&{cursor:o})})}exists(e){return V(this,null,function*(){return(yield this.storage.getNodeInfo(e)).exists})}query(i,s){return V(this,arguments,function*(e,t,r={snapshots:!1}){return yield Dw(this,e,t,r)})}createIndex(e,t,r){return this.storage.indexes.create(e,t,r)}getIndexes(){return V(this,null,function*(){return this.storage.indexes.list()})}deleteIndex(e){return V(this,null,function*(){return this.storage.indexes.delete(e)})}reflect(e,t,r){return V(this,null,function*(){r=r||{};const i=(s,o=50,a=0,c=null)=>V(this,null,function*(){typeof o=="string"&&(o=parseInt(o)),typeof a=="string"&&(a=parseInt(a)),["null","undefined"].includes(c)&&(c=null);const l=[];let u=0,h=!1,p=!1;return yield this.storage.getChildren(s).next(f=>{if(h)return p=!0,!1;u++,(c!==null?f.key>c:a===0||u>a)&&l.push(re({key:typeof f.key=="string"?f.key:f.index,type:f.valueTypeName,value:f.value},typeof f.address=="object"&&"pageNr"in f.address&&{address:{pageNr:f.address.pageNr,recordNr:f.address.recordNr}})),h=o>0&&l.length===o}).catch(f=>{if(!(f instanceof md))throw f}),{more:p,list:l}});switch(t){case"children":return yield i(e,r.limit,r.skip,r.from);case"info":{const s={key:"",exists:!1,type:"unknown",value:void 0,address:void 0,children:{count:0,more:!1,list:[]}},o=yield this.storage.getNodeInfo(e,{include_child_count:r.child_count===!0});s.key=typeof o.key!="undefined"?o.key:o.index,s.exists=o.exists,s.type=o.exists?o.valueTypeName:void 0,s.value=o.value,s.address=typeof o.address=="object"&&"pageNr"in o.address?{pageNr:o.address.pageNr,recordNr:o.address.recordNr}:void 0;const a=o.exists&&o.address&&[ce.OBJECT,ce.ARRAY].includes(o.type);return r.child_count===!0?s.children={count:a?o.childCount:0}:typeof r.child_limit=="number"&&r.child_limit>0&&a&&(s.children=yield i(e,r.child_limit,r.child_skip,r.child_from)),s}}})}export(e,t,r={format:"json",type_safe:!0}){return this.storage.exportNode(e,t,r)}import(e,t,r={format:"json",suppress_events:!1,method:"set"}){return this.storage.importNode(e,t,r)}setSchema(e,t,r=!1){return V(this,null,function*(){return this.storage.setSchema(e,t,r)})}getSchema(e){return V(this,null,function*(){return this.storage.getSchema(e)})}getSchemas(){return V(this,null,function*(){return this.storage.getSchemas()})}validateSchema(e,t,r){return V(this,null,function*(){return this.storage.validateSchema(e,t,{updates:r})})}getMutations(e){return V(this,null,function*(){if(typeof this.storage.getMutations!="function")throw new Error("Used storage type does not support getMutations");if(typeof e!="object")throw new Error("No filter specified");if(typeof e.cursor!="string"&&typeof e.timestamp!="number")throw new Error("No cursor or timestamp given");return this.storage.getMutations(e)})}getChanges(e){return V(this,null,function*(){if(typeof this.storage.getChanges!="function")throw new Error("Used storage type does not support getChanges");if(typeof e!="object")throw new Error("No filter specified");if(typeof e.cursor!="string"&&typeof e.timestamp!="number")throw new Error("No cursor or timestamp given");return this.storage.getChanges(e)})}}class CL extends bd{constructor(e){super(e),this.temp=!1,this.multipleTabs=!1,typeof e.temp=="boolean"&&(this.temp=e.temp),typeof e.provider=="object"&&(this.provider=e.provider),typeof e.multipleTabs=="boolean"&&(this.multipleTabs=e.multipleTabs),typeof e.logLevel=="string"&&(this.logLevel=e.logLevel),typeof e.sponsor=="boolean"&&(this.sponsor=e.sponsor),["type","ipc","path"].forEach(t=>{t in e&&console.warn(`${t} setting is not supported for AceBase LocalStorage`)})}}class NL extends wd{constructor(e,t){super(t),this.context=e,this._storageKeysPrefix=`${this.context.dbname}.acebase::`}commit(){return V(this,null,function*(){})}rollback(e){return V(this,null,function*(){})}get(e){return V(this,null,function*(){const t=this.context.localStorage.getItem(this.getStorageKeyForPath(e));return JSON.parse(t)})}set(e,t){return V(this,null,function*(){const r=JSON.stringify(t);this.context.localStorage.setItem(this.getStorageKeyForPath(e),r)})}remove(e){return V(this,null,function*(){this.context.localStorage.removeItem(this.getStorageKeyForPath(e))})}childrenOf(e,t,r,i){return V(this,null,function*(){const s=uo.PathInfo.get(e);for(let o=0;o<this.context.localStorage.length;o++){const a=this.context.localStorage.key(o);if(!a.startsWith(this._storageKeysPrefix))continue;const c=this.getPathFromStorageKey(a);if(s.isParentOf(c)&&r(c)){let l;if(t.metadata||t.value){const h=this.context.localStorage.getItem(a);l=JSON.parse(h)}if(!i(c,l))break}}})}descendantsOf(e,t,r,i){return V(this,null,function*(){const s=uo.PathInfo.get(e);for(let o=0;o<this.context.localStorage.length;o++){const a=this.context.localStorage.key(o);if(!a.startsWith(this._storageKeysPrefix))continue;const c=this.getPathFromStorageKey(a);if(s.isAncestorOf(c)&&r(c)){let l;if(t.metadata||t.value){const h=this.context.localStorage.getItem(a);l=JSON.parse(h)}if(!i(c,l))break}}})}getPathFromStorageKey(e){return e.slice(this._storageKeysPrefix.length)}getStorageKeyForPath(e){return`${this._storageKeysPrefix}${e}`}}function jL(n,e={}){const t=new CL(e),r=t.provider?t.provider:t.temp?window.localStorage:window.sessionStorage,i=new ho({name:"LocalStorage",locking:!0,removeVoidProperties:t.removeVoidProperties,maxInlineValueSize:t.maxInlineValueSize,ready(){return V(this,null,function*(){})},getTransaction(a){return V(this,null,function*(){const c={debug:!0,dbname:n,localStorage:r};return new NL(c,a)})}}),s=new Co(n,{logLevel:t.logLevel,storage:i,sponsor:t.sponsor});return s.settings.ipcEvents=t.multipleTabs===!0,s}class BL extends bd{constructor(e){super(e),this.multipleTabs=!1,this.cacheSeconds=60,this.sponsor=!1,typeof e.logLevel=="string"&&(this.logLevel=e.logLevel),typeof e.multipleTabs=="boolean"&&(this.multipleTabs=e.multipleTabs),typeof e.cacheSeconds=="number"&&(this.cacheSeconds=e.cacheSeconds),typeof e.sponsor=="boolean"&&(this.sponsor=e.sponsor),["type","ipc","path"].forEach(t=>{t in e&&console.warn(`${t} setting is not supported for AceBase IndexedDBStorage`)})}}class Uw extends Cw{constructor(e={}){super(e),e.storage&&(this.storage=e.storage,e.ipc&&(this.storage.ipc=e.ipc),e.transactions&&(this.storage.transactions=e.transactions))}}class LL extends rL{constructor(e,t={}){const r=new Uw(t);super(e,r),this.recovery={repairNode:(s,o)=>V(this,null,function*(){if(yield this.ready(),this.api.storage instanceof $h)yield this.api.storage.repairNode(s,o);else if(!this.api.storage.repairNode)throw new Error("repairNode is not supported with chosen storage engine")}),repairNodeTree:s=>V(this,null,function*(){yield this.ready(),yield this.api.storage.repairNodeTree(s)})};const i={db:this,settings:r};this.api=new RL(e,i,()=>{this.emit("ready")})}close(){return V(this,null,function*(){yield this.api.storage.close()})}get settings(){const e=this.api.storage.ipc,t=this.debug;return{get logLevel(){return t.level},set logLevel(r){t.setLevel(r)},get ipcEvents(){return e.eventsEnabled},set ipcEvents(r){e.eventsEnabled=r}}}static WithLocalStorage(e,t={}){return jL(e,t)}static WithIndexedDB(e,t={}){throw new Error("IndexedDB storage can only be used in browser contexts")}}function ag(n){return new Promise((e,t)=>{n.onsuccess=r=>e(n.result||null),n.onerror=t})}class DL extends wd{constructor(e,t){super(t),this.context=e,this.production=!0,this._pending=[]}_createTransaction(e=!1){return this.context.db.transaction(["nodes","content"],e?"readwrite":"readonly")}_splitMetadata(e){const t=e.value,r=re({},e);return delete r.value,{metadata:r,value:t}}commit(){return V(this,null,function*(){if(this._pending.length===0)return;const e=this._pending.splice(0);this.context.ipc.sendNotification({action:"cache.invalidate",paths:e.map(r=>r.path)});const t=this._createTransaction(!0);try{yield new Promise((r,i)=>{let s=!1,o=0;const a=l=>{s=!0,i(l)},c=()=>{++o===e.length&&r()};e.forEach((l,u)=>{if(s)return;let h,p;const f=l.path;if(l.action==="set"){const{metadata:y,value:_}=this._splitMetadata(l.node),S={path:f,metadata:y};h=t.objectStore("nodes").put(S),p=t.objectStore("content").put(_,f),this.context.cache.set(f,l.node)}else l.action==="remove"?(h=t.objectStore("content").delete(f),p=t.objectStore("nodes").delete(f),this.context.cache.set(f,null)):a(new Error(`Unknown pending operation "${l.action}" on path "${f}" `));let d=0;h.onsuccess=p.onsuccess=()=>{++d===2&&c()},h.onerror=p.onerror=a})}),t.commit&&t.commit()}catch(r){throw console.error(r),t.abort&&t.abort(),r}})}rollback(e){return V(this,null,function*(){this._pending=[]})}get(e){return V(this,null,function*(){if(this.context.cache.has(e))return this.context.cache.get(e);const t=this._createTransaction(!1),r=ag(t.objectStore("nodes").get(e)),i=ag(t.objectStore("content").get(e));try{const s=yield Promise.all([r,i]);t.commit&&t.commit();const o=s[0];if(!o)return this.context.cache.set(e,null),null;const a=o.metadata;return a.value=s[1],this.context.cache.set(e,a),a}catch(s){throw console.error("IndexedDB get error",s),t.abort&&t.abort(),s}})}set(e,t){this._pending.push({action:"set",path:e,node:t})}remove(e){this._pending.push({action:"remove",path:e})}removeMultiple(e){return V(this,null,function*(){e.forEach(t=>{this._pending.push({action:"remove",path:t})})})}childrenOf(e,t,r,i){return this._getChildrenOf(e,Je(re({},t),{descendants:!1}),r,i)}descendantsOf(e,t,r,i){return this._getChildrenOf(e,Je(re({},t),{descendants:!0}),r,i)}_getChildrenOf(e,t,r,i){return new Promise((s,o)=>{const a=uo.PathInfo.get(e),c=this._createTransaction(!1),l=c.objectStore("nodes"),u=IDBKeyRange.lowerBound(e,!0),h=t.metadata?l.openCursor(u):l.openKeyCursor(u);h.onerror=p=>{var f;(f=c.abort)==null||f.call(c),o(p)},h.onsuccess=p=>V(this,null,function*(){var y,_,S;const f=(_=(y=h.result)==null?void 0:y.key)!=null?_:null;let d=!0;if(f===null)d=!1;else if(!a.isAncestorOf(f))d=!1;else if(t.descendants||a.isParentOf(f)){let I;if(t.metadata&&(I=h.result.value.metadata),r(f,I)){if(t.value)if(this.context.cache.has(f)){const j=this.context.cache.get(f);I.value=j.value}else{const j=c.objectStore("content").get(f);I.value=yield new Promise((U,M)=>{j.onerror=H=>{U(null)},j.onsuccess=H=>{U(j.result)}}),this.context.cache.set(f,I.value===null?null:I)}d=i(f,I)}}if(d)try{h.result.continue()}catch(I){d=!1}d||((S=c.commit)==null||S.call(c),s())})})}}function UL(n,e={}){const t=new BL(e),i=(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB).open(`${n}.acebase`,1);i.onupgradeneeded=p=>{const f=i.result;f.createObjectStore("nodes",{keyPath:"path"}),f.createObjectStore("content")};let s;const o=new Promise((p,f)=>{i.onsuccess=d=>{s=i.result,p()},i.onerror=d=>{f(d)}}),a=new aL(typeof t.cacheSeconds=="number"?t.cacheSeconds:60),c=new ho({name:"IndexedDB",locking:!0,removeVoidProperties:t.removeVoidProperties,maxInlineValueSize:t.maxInlineValueSize,lockTimeout:t.lockTimeout,ready(){return o},getTransaction(p){return V(this,null,function*(){yield o;const f={debug:!1,db:s,cache:a,ipc:u};return new DL(f,p)})}}),l=new Co(n,{logLevel:t.logLevel,storage:c,sponsor:t.sponsor}),u=l.api.storage.ipc;return l.settings.ipcEvents=t.multipleTabs===!0,u.on("notification",p=>V(this,null,function*(){const f=p.data;if(typeof f=="object"&&f.action==="cache.invalidate")for(const d of f.paths)a.remove(d)})),l}const FL=`Using AceBase constructor in the browser to use localStorage is deprecated!
Switch to:
IndexedDB implementation (FASTER, MORE RELIABLE):
    let db = AceBase.WithIndexedDB(name, settings)
Or, new LocalStorage implementation:
    let db = AceBase.WithLocalStorage(name, settings)
Or, write your own CustomStorage adapter:
    let myCustomStorage = new CustomStorageSettings({ ... });
    let db = new AceBase(name, { storage: myCustomStorage })`;class Co extends LL{constructor(e,t){if(typeof t!="object"||typeof t.storage!="object")throw new Error(FL);super(e,t),this.settings.ipcEvents=t.multipleTabs===!0}static WithIndexedDB(e,t={}){return UL(e,t)}}const ML={AceBase:Co,AceBaseLocalSettings:Uw,DataReference:Xn,DataSnapshot:at,EventSubscription:vw,PathReference:ct,TypeMappings:Tw,CustomStorageSettings:ho,CustomStorageTransaction:wd,CustomStorageHelpers:uo,ID:Wt,proxyAccess:Fa,DataSnapshotsArray:rl};window.acebase=ML;window.AceBase=Co;let qL=()=>Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),uu=(()=>"/ps"+qL()+"/pe")();const Lt={req:"/custom",create:{one:"/create-one",many:"/create-many"},send:{one:"/send-one",many:"/send-many"},find:{one:"/find-one",many:"/find-many"},get:{one:"/get-one",many:"/get-many"},query:{many:"/get-many"},update:{one:"/update-one",many:"/update-many"},delete:{one:"/delete-one",many:"/delete-many"}},Qt={create:"/create",find:"/find",get:"/get",query:"/get",update:"/update",delete:"/delete",req:"/custom",upload:"/upload",send:"/send",user:{base:"/user",example:"/user/device-connected",join:"",status:"/user/status",device:{connected:"/user/device-connected",removed:"/user/device-removed",disconnected:"/user/device-disconnected"}}},hu={base:"/auth",login:"/login/get-one",verify_token_code:"/verify-token-code/get-one",verify_pass_code:"/verify-pass-code/get-one",verify_email_code:"/verify-email-code/get-one",req:"/custom",user:"/user/"+uu+"/get-one",register:"/register/get-one",forgotPassword:"/forgot-password/get-one"+uu+"/get-one",deleteAccount:"/delete-account/get-one",refreshToken:"/refresh-token"+uu+"/get-one",users:{base:"/users"}},Bs={base:"/storage",upload:"/upload",download:{one:"download-one",many:"download-many"}};var os,oi,$i,as,Jt,Dh,cs,hc,go,ai,wr,Ti,qt;class VL{constructor(e={}){Gt(this,os,"/on");Gt(this,oi,!0);Gt(this,$i,void 0);Gt(this,as,void 0);Gt(this,Jt,void 0);Gt(this,Dh,void 0);Gt(this,cs,void 0);Gt(this,hc,void 0);Gt(this,go,new OB);Gt(this,ai,void 0);Gt(this,wr,void 0);Gt(this,Ti,void 0);Gt(this,qt,void 0);Fd(this,"init",e=>{var U,M,H,L,F;let{ENV:t,HOST_SERVER:r,API_VERSION:i}=xe(this,Ti),s=()=>V(this,null,function*(){var m,v,g,k,x,b,w,A,O,$,P,N;let T="/transaction",R="/database",C=yield(g=(v=(m=xe(this,qt))==null?void 0:m.ref(T))==null?void 0:v.get())==null?void 0:g.catch(D=>{}),E=yield(b=(x=(k=xe(this,qt))==null?void 0:k.ref(R))==null?void 0:x.get())==null?void 0:b.catch(D=>{});if(C.exists()){C=C.val();let D=Object.keys(C);if((D==null?void 0:D.length)>0){for(let z in D){let q=C[z];(q==null?void 0:q.path)&&(q==null?void 0:q.method)&&(q==null?void 0:q.value)&&(yield this.init(e).database().ref(q==null?void 0:q.path).req(q==null?void 0:q.method,q==null?void 0:q.path,q==null?void 0:q.value).val())}E.exists()&&(yield(O=(A=(w=xe(this,qt))==null?void 0:w.ref(R))==null?void 0:A.remove())==null?void 0:O.catch(z=>{})),yield(N=(P=($=xe(this,qt))==null?void 0:$.ref(T))==null?void 0:P.remove())==null?void 0:N.catch(z=>{})}}});(M=(U=e==null?void 0:e.socket)==null?void 0:U.storage)==null||M.on("connect",()=>{$n(this,wr,!0),s()}),(L=(H=e==null?void 0:e.socket)==null?void 0:H.storage)==null||L.on("disconnect",()=>{$n(this,wr,!1)});const o=(T={})=>{var C,E,m;let R={};if(T&&Object.keys(T).length>0&&(R.data=T),xe(this,Jt)&&(R.storage=xe(this,Jt),R.config=xe(this,cs)),xe(this,hc)){let v=new FormData;Array.isArray(T)?(T.map((g,k)=>{typeof g=="object"&&(g.attachmentName="attachment"+k,g==null||g.attachments.forEach(x=>{x!=null&&x.data?v.append("attachments"+k,x==null?void 0:x.data,x==null?void 0:x.name):v.append("attachments"+k,x)}))}),v.append("field",JSON.stringify(R))):Array.isArray(T==null?void 0:T.attachments)&&(T==null||T.attachments.forEach(g=>{g!=null&&g.data?v.append("attachments",g==null?void 0:g.data,g==null?void 0:g.name):v.append("attachments",g)}),delete R.data.attachments,v.append("field",JSON.stringify(R))),R=v}else if(xe(this,Jt)&&(T==null?void 0:T.file)){let v=new FormData;T!=null&&T.file?((C=T.file)!=null&&C.data?v.append("file",(E=T.file)==null?void 0:E.data,(m=T.file)==null?void 0:m.name):v.append("file",T.file),delete R.data.file,v.append("field",JSON.stringify(R))):Array.isArray(T==null?void 0:T.directory)&&(T==null||T.directory.forEach(g=>{g!=null&&g.data?v.append("file",g==null?void 0:g.data,g==null?void 0:g.name):v.append("file",g)}),delete R.data.directory,v.append("field",JSON.stringify(R)),R=v),R=v}return R};let a=(T,R)=>V(this,null,function*(){var C,E,m,v,g,k,x,b;if(((C=T==null?void 0:T.error)==null?void 0:C.token)&&xe(this,oi)){if($n(this,oi,!1),localStorage.getItem("refreshToken")){t==="dev"&&console.log("Token expired or not found: ",(E=T.error)==null?void 0:E.token," Trying to request a new refresh token");let w=yield(v=(m=this==null?void 0:this.init(e))==null?void 0:m.auth())==null?void 0:v.req(hu.refreshToken,{token:localStorage.getItem("refreshToken")}).val();if(w!=null&&w.error)return t==="dev"&&console.log("Refresh token expired or not found: ",w),xe(this,$i)&&(window.top.location.href=xe(this,$i)),w;if(w!=null&&w.data&&(t==="dev"&&console.log("We got a new refresh token ,",w==null?void 0:w.data),(g=w==null?void 0:w.data)!=null&&g.token&&localStorage.setItem("accessToken",(k=w==null?void 0:w.data)==null?void 0:k.token),(x=w==null?void 0:w.data)!=null&&x.refreshToken&&localStorage.setItem("refreshToken",(b=w==null?void 0:w.data)==null?void 0:b.refreshToken),t==="dev"&&console.log("Trying to restart your request..."),typeof R=="function"))return yield R()}}else return T});const c=(T,R,C,E=()=>{})=>{const m=xe(this,os);let v=R.version+m+R.base+C;v=v.replace(/\/\//g,"/"),t==="dev"&&console.log("socket listen local path: ",v),T==null||T.on(v,E)},l=(T,R=()=>{})=>{var m;const C=xe(this,os);let E=(i==null?void 0:i.STORAGE)+C+T;E=E.replace(/\/\//g,"/"),t==="dev"&&console.log("emitter listen local path: ",E),(m=xe(this,go))==null||m.on(E,R)};let u=(T,R,C,E)=>{xe(this,as)&&(E=E+xe(this,as));let m={req:v=>(c(T,R,E+Qt.req,g=>{var k,x,b;(!((x=(k=g==null?void 0:g.error)==null?void 0:k.error)!=null&&x.token)&&!((b=g==null?void 0:g.error)!=null&&b.token)||(g==null?void 0:g.data))&&typeof v=="function"&&v(Je(re({},C),{value:g}))}),C),create:v=>(c(T,R,E+Qt.create,g=>{var k,x,b;(!((x=(k=g==null?void 0:g.error)==null?void 0:k.error)!=null&&x.token)&&!((b=g==null?void 0:g.error)!=null&&b.token)||(g==null?void 0:g.data))&&typeof v=="function"&&v(Je(re({},C),{value:g}))}),C),find:v=>(c(T,R,E+Qt.find,g=>{var k,x,b;(!((x=(k=g==null?void 0:g.error)==null?void 0:k.error)!=null&&x.token)&&!((b=g==null?void 0:g.error)!=null&&b.token)||(g==null?void 0:g.data))&&typeof v=="function"&&v(Je(re({},C),{value:g}))}),C),get:v=>(c(T,R,E+Qt.get,g=>{var k,x,b;(!((x=(k=g==null?void 0:g.error)==null?void 0:k.error)!=null&&x.token)&&!((b=g==null?void 0:g.error)!=null&&b.token)||(g==null?void 0:g.data))&&typeof v=="function"&&v(Je(re({},C),{value:g}))}),C),query:v=>(c(T,R,E+Qt.query,g=>{var k,x,b;(!((x=(k=g==null?void 0:g.error)==null?void 0:k.error)!=null&&x.token)&&!((b=g==null?void 0:g.error)!=null&&b.token)||(g==null?void 0:g.data))&&typeof v=="function"&&v(Je(re({},C),{value:g}))}),C),update:v=>(c(T,R,E+Qt.update,g=>{var k,x,b;(!((x=(k=g==null?void 0:g.error)==null?void 0:k.error)!=null&&x.token)&&!((b=g==null?void 0:g.error)!=null&&b.token)||(g==null?void 0:g.data))&&typeof v=="function"&&v(Je(re({},C),{value:g}))}),C),delete:v=>(c(T,R,E+Qt.delete,g=>{var k,x,b;(!((x=(k=g==null?void 0:g.error)==null?void 0:k.error)!=null&&x.token)&&!((b=g==null?void 0:g.error)!=null&&b.token)||(g==null?void 0:g.data))&&typeof v=="function"&&v(Je(re({},C),{value:g}))}),C)};return xe(this,Jt)&&(m.upload=v=>(c(T,R,E+Qt.upload,g=>{var k,x,b;(!((x=(k=g==null?void 0:g.error)==null?void 0:k.error)!=null&&x.token)&&!((b=g==null?void 0:g.error)!=null&&b.token)||(g==null?void 0:g.data))&&typeof v=="function"&&v(Je(re({},C),{value:g}))}),C)),m},h=(T,R)=>({create:C=>(l(T+Qt.create,E=>{(!(E!=null&&E.error)||(E==null?void 0:E.data))&&typeof C=="function"&&C(Je(re({},R),{value:E}))}),R),find:C=>(l(T+Qt.find,E=>{(!(E!=null&&E.error)||(E==null?void 0:E.data))&&typeof C=="function"&&C(Je(re({},R),{value:E}))}),R),get:C=>(l(T+Qt.get,E=>{(!(E!=null&&E.error)||(E==null?void 0:E.data))&&typeof C=="function"&&C(Je(re({},R),{value:E}))}),R),query:C=>(l(T+Qt.query,E=>{(!(E!=null&&E.error)||(E==null?void 0:E.data))&&typeof C=="function"&&C(Je(re({},R),{value:E}))}),R),update:C=>(l(T+Qt.update,E=>{(!(E!=null&&E.error)||(E==null?void 0:E.data))&&typeof C=="function"&&C(Je(re({},R),{value:E}))}),R),delete:C=>(l(T+Qt.delete,E=>{(!(E!=null&&E.error)||(E==null?void 0:E.data))&&typeof C=="function"&&C(Je(re({},R),{value:E}))}),R)}),p=zy.init(xe(this,Ti)),f=(T="",R={},C={},E={},m)=>{T=T.trim(),T.charAt(T.length-1)==="/"&&(T=T.slice(0,-1));let g=(()=>V(this,null,function*(){let k=()=>V(this,null,function*(){return yield p("post",r.AUTH+i.AUTH+hu.base+T,o(R))}),x=yield k();return xe(this,oi)&&(x=yield a(x,()=>V(this,null,function*(){return yield k()}))),typeof m=="function"&&m(Je(re({},E),{value:x})),x}))();return Je(re({},E),{val:()=>g})},d=(T,R,C,E={},m={},v)=>{let k=(()=>V(this,null,function*(){let x=()=>V(this,null,function*(){return yield p(T,R,o(C),E)}),b=yield x();return xe(this,oi)&&(b=yield a(b,()=>V(this,null,function*(){return yield x()}))),typeof v=="function"&&v(Je(re({},m),{value:b})),b}))();return Je(re({},m),{val:()=>k})},y=T=>{let R={},C,[E={},,,]=T;if(T.length===1&&typeof E=="function"&&(C=T[0],E={}),T.length===2&&(typeof T[1]=="object"?R=T[1]:typeof T[1]=="function"&&(C=T[1])),T.length>=3){let[,m,v]=T;typeof m=="object"&&(R=m),C=v}return{data:E,onRequest:R,callback:C}},_=()=>Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),S=(T,R,C={},E,m)=>{R=R.replace(/\/\//g,"/");let g=(()=>V(this,null,function*(){var $,P,N,D,z,q,ne,te,ue,le,ie,pe,ke,ve,ze,je,He,Br,Lr,Dr,Ur,Ee,Fr;let k="/transaction",x,b,w={error:{message:"We could not execute the "+T+" method for path: "+R}};switch(T){case"create":yield(N=(P=($=xe(this,qt))==null?void 0:$.ref(R))==null?void 0:P.set(C))==null?void 0:N.catch(Ct=>w);break;case"update":yield(q=(z=(D=xe(this,qt))==null?void 0:D.ref(R))==null?void 0:z.update(C))==null?void 0:q.catch(Ct=>w);break;case"query":let _e=(ne=xe(this,qt))==null?void 0:ne.query(R);Array.isArray(C==null?void 0:C.where)&&(yield Promise.all(C==null?void 0:C.where.map(Ct=>V(this,null,function*(){return yield new Promise(Yt=>{_e==null||_e.filter(...Ct),Yt()})})))),C!=null&&C.take&&(_e==null||_e.take(C==null?void 0:C.take)),C!=null&&C.skip&&(_e==null||_e.take(C==null?void 0:C.skip)),C!=null&&C.order&&Array.isArray(C==null?void 0:C.order)&&(yield Promise.all(C==null?void 0:C.order.map(Ct=>V(this,null,function*(){return yield new Promise(Yt=>{_e==null||_e.sort(...Ct),Yt()})})))),b=yield _e==null?void 0:_e.count(),x=yield(te=_e==null?void 0:_e.get(re({},C==null?void 0:C.$option)))==null?void 0:te.catch(Ct=>w);break;case"delete":x=yield(ie=(le=(ue=xe(this,qt))==null?void 0:ue.ref(R))==null?void 0:le.get())==null?void 0:ie.catch(Ct=>w),yield(ve=(ke=(pe=xe(this,qt))==null?void 0:pe.ref(R))==null?void 0:ke.remove())==null?void 0:ve.catch(Ct=>w);break}if(T!=="delete"&&T!=="query"&&(x=yield(He=(je=(ze=xe(this,qt))==null?void 0:ze.ref(R))==null?void 0:je.get(re({},C==null?void 0:C.$option)))==null?void 0:He.catch(_e=>w)),T==="query"?x.exists()?(x=x==null?void 0:x.getValues(),x={data:x,max:b,take:C==null?void 0:C.take,skip:C==null?void 0:C.skip}):x=re({},w):x.exists()?(x=x==null?void 0:x.val(),x={data:x}):x=re({},w),xe(this,ai)&&E.auth().$currentUserId&&!xe(this,wr)&&["create","delete","update"].includes(T)&&x!=null&&x.data){let _e=yield(Dr=(Lr=(Br=xe(this,qt))==null?void 0:Br.ref(k))==null?void 0:Lr.get())==null?void 0:Dr.catch(Ne=>w);_e.exists()?_e=_e.val():_e={};let Ct,Yt=Object.keys(_e);switch(Yt.length>0?Ct=Yt.length+1:Ct=0,T){case"create":T="post";break;case"update":T="put";break;case"delete":T="delete";break}T!=="get"&&(yield(Fr=(Ee=(Ur=xe(this,qt))==null?void 0:Ur.ref(k+"/"+Ct))==null?void 0:Ee.set({path:R,method:T,uid:Ct,value:x.data}))==null?void 0:Fr.catch(Ne=>w))}const A=xe(this,os);let O=(i==null?void 0:i.STORAGE)+A+R+"/"+T;return O=O.replace(/\/\//g,"/"),xe(this,go).emit(O,x),typeof m=="function"&&m(Je(re({},E),{value:x})),x}))();return Je(re({},E),{val:()=>g})},I=(T,R)=>{typeof T=="function"&&(R==null||R.on("connect",T))},B=(T,R)=>{let C="%"+T,E=this.init(e);return delete E.auth().login,delete E.auth().register,{private:(m=_())=>E.event(T+m),child:m=>E.event(T+m),emit:(m,v)=>(R==null||R.emit(C,m),typeof v=="function"&&E.event(T).do(v),re(re({},E.event(T)),E)),do:m=>(R==null||R.on(C,v=>{typeof m=="function"&&m(Je(re(re({},E.event(T)),E),{value:v}))}),re(re({},E.event(T)),E)),onAny:m=>{R==null||R.onAny((v,g)=>{typeof m=="function"&&m(v,re(re({value:g},E.event(v)),E))})}}},j=(T,R,C)=>Je(re({},T),{$io:C,connected:()=>C==null?void 0:C.connected,event:E=>B(E,C),ready:E=>I(E,C),ref:(E="")=>T.ref(E,R,C)});return{$connected:xe(this,wr),activity:()=>{let T=this.init(e);return{onStart:R=>(typeof R=="function"&&document.addEventListener("DOMContentLoaded",R),re(re({},T),T.activity())),onCreate:R=>(typeof R=="function"&&(window.onload=R),re(re({},T),T.activity())),onPause:R=>(window.addEventListener("beforeunload",function(C){typeof R=="function"&&R(),C.returnValue="onbeforeunload"}),re(re({},T),T.activity())),onResume:()=>re(re({},T),T.activity()),onLeave:R=>(typeof R=="function"&&(window.onunload=R),re(re({},T),T.activity()))}},socket:{storage:(F=e==null?void 0:e.socket)==null?void 0:F.storage},$randomUID:()=>nu(),$randomId:()=>_(),$axios:zy,local:(T={})=>{const R=this.init(e);return delete R.local,delete R.auth().register,delete R.auth().login,{database:(C="/database")=>({ref:(E="/database")=>{let m=this.init(e);return delete m.auth().login,delete m.auth().register,E=E.trim(),E=E.replace(/\/\//g,"/"),C=C+"/"+E,C=C.replace(/\/\//g,"/"),E.charAt(E.length-1)==="/"&&(E=E.slice(0,-1)),{child:(v="")=>{var g,k;return v=v.trim(),v=v.replace(/\/\//g,"/"),v.charAt(v.length-1)==="/"&&(v=v.slice(0,-1)),v.charAt(0)!=="/"&&(v="/"+v),(k=(g=m.local())==null?void 0:g.database())==null?void 0:k.ref(E+v)},push:(...v)=>{var k,x;let g=nu();return!v.length>0?{getKey:()=>g}:(x=(k=m.local())==null?void 0:k.database())==null?void 0:x.ref(E+"/"+g).create(v)},create:(...v)=>{var b,w;let g=re(re({},(w=(b=m.local(T))==null?void 0:b.database())==null?void 0:w.ref(E)),m),{data:k,callback:x}=y(v);return S(T,"create",C,k,g)},get:(...v)=>{var b,w;let g=re(re({},(w=(b=m.local())==null?void 0:b.database())==null?void 0:w.ref(E)),m),{data:k,callback:x}=y(v);return S("get",C,k,g,x)},find:(...v)=>{var b,w;let g=re(re({},(w=(b=m.local())==null?void 0:b.database())==null?void 0:w.ref(E)),m),{data:k,callback:x}=y(v);return S("get",C,k,g,x)},query:()=>{},update:(...v)=>{var b,w;let g=re(re({},(w=(b=m.local())==null?void 0:b.database())==null?void 0:w.ref(E)),m),{data:k,callback:x}=y(v);return S("update",C,k,g,x)},delete:(...v)=>{var b,w;let g=re(re({},(w=(b=m.local())==null?void 0:b.database())==null?void 0:w.ref(E)),m),{data:k,callback:x}=y(v);return S("delete",C,k,g,x)},on:()=>{var g,k;let v=re(re({},(k=(g=m.local())==null?void 0:g.database())==null?void 0:k.ref(E)),m);return h(E,v)},onValue:v=>{var x,b,w,A,O,$,P;let g=re(re({},(b=(x=m.local())==null?void 0:x.database())==null?void 0:b.ref(E)),m),k=(A=(w=m.local())==null?void 0:w.database())==null?void 0:A.ref(E);return(O=k==null?void 0:k.on())==null||O.create(v),($=k==null?void 0:k.on())==null||$.update(v),(P=k==null?void 0:k.on())==null||P.delete(v),g}}}}),cache:(C="/cache")=>{var m;let E=this.init(e);return delete E.auth().login,delete E.auth().register,(m=E.local())==null?void 0:m.database(C)},storage:()=>({})}},cron:T=>{},task:T=>{},storage:(T="local",R)=>{var E;switch($n(this,ai,!1),$n(this,Jt,T),T){case"aws":break;case"discord":$n(this,cs,{token:R==null?void 0:R.token,channelId:R==null?void 0:R.channelId});break}const C=this.init(e);return delete C.storage,delete C.auth().register,delete C.auth().login,j(C,{host:r.STORAGE,version:i.STORAGE,base:Bs.base},(E=e==null?void 0:e.socket)==null?void 0:E.storage)},$online:navigator==null?void 0:navigator.onLine,auth:()=>({req:(T,R,C)=>{let E=this.init(e);delete E.auth().login,delete E.auth().register;let m=re(re({},E),E.auth());return f(T+hu.req,R,null,m,C)}}),syncDatabase:(T=!0)=>{const R=this.init(e);return $n(this,ai,typeof T=="boolean"?T:!0),R.database()},ref:(T="",R={host:r.STORAGE,version:i.STORAGE,base:Bs.base},C=(m=>(m=e==null?void 0:e.socket)==null?void 0:m.database)(),E=!0)=>{T=T.trim(),T=T.replace(/\/\//g,"/"),T.charAt(0)==="/"&&T.length<=1&&(T="/root"),T.charAt(T.length-1)==="/"&&(T=T.slice(0,-1));const v=R.host+R.version+R.base+T;let g=this.init(e);delete g.auth().login,delete g.auth().register,$n(this,oi,E);let k={push:(...x)=>{let b=nu();return!x.length>0?{getKey:()=>b}:g.ref(T+"/"+b,R,C).create(x)},private:(x=_())=>g.ref(T+"/ps"+x+"/pe",R,C),setAuthAccess:(x=!0,b=xe(this,$i))=>($n(this,$i,b),g.ref(T,R,C,x)),req:(...x)=>{let b=re(re({},g.ref(T,R,C)),g);if(x.length>=2){let[w="post",A={},O={},$]=x;if(typeof w=="string"&&["post","put","delete","get"].includes(w)){let P=Lt.req;return d(w,v+P,A,O,b,$)}return b}else{let w=x.filter(A=>typeof A=="function");if(w.length>0)w=w[0],typeof w=="function"&&w(b);else return b}},child:(x="")=>(x=x.trim(),x=x.replace(/\/\//g,"/"),x.charAt(x.length-1)==="/"&&(x=x.slice(0,-1)),x.charAt(0)!=="/"&&(x="/"+x),g.ref(T+x,R,C)),set:(...x)=>{var b;return(b=g.ref(T,R,C))==null?void 0:b.create(...x)},create:(...x)=>{var $;let{data:b,onRequest:w,callback:A}=y(x),O=Lt.create.one;if(xe(this,Jt)){if((b==null?void 0:b.file)||(b==null?void 0:b.directory))return($=g.ref(T))==null?void 0:$.upload(b,null,A);Array.isArray(b.folders)&&(O=Lt.create.many)}else Array!=null&&Array.isArray(b)&&(O=Lt.create.many);return d("post",v+O,b,w,node,A)},find:(...x)=>{var P;t==="dev"&&console.log("Find: We are online");let b=re(re({},g.ref(T,R,C)),g),{data:w,onRequest:A,callback:O}=y(x),$=Lt.find.one;return xe(this,Jt)?(Array.isArray(w==null?void 0:w.files)||Array.isArray(w==null?void 0:w.folders))&&(Array.isArray(w==null?void 0:w.files)&&(w.isFolder=!1),Array.isArray(w==null?void 0:w.folders)&&(w.isFolder=!0),$=Lt.find.many):(((P=Object.keys(w))==null?void 0:P.length)<=0||w.order||w.where||w.$option||w.skip||w.take)&&($=Lt.find.many),d("post",v+$,w,A,b,O)},get:(...x)=>{var P;let b=re(re({},g.ref(T,R,C)),g),{data:w,onRequest:A,callback:O}=y(x),$=Lt.get.one;return xe(this,Jt)?(Array.isArray(w==null?void 0:w.files)||Array.isArray(w==null?void 0:w.folders))&&(Array.isArray(w==null?void 0:w.files)&&(w.isFolder=!1),Array.isArray(w==null?void 0:w.folders)&&(w.isFolder=!0),$=Lt.get.many):(((P=Object.keys(w))==null?void 0:P.length)<=0||w.order||w.where||w.$option||w.skip||w.take)&&($=Lt.get.many),d("get",v+$+"?query="+JSON.stringify(o(w)),null,A,b,O)},query:(...x)=>{var b,w,A;if(g.auth().$currentUserId&&(R==null?void 0:R.host)===(r==null?void 0:r.DATABASE)&&xe(this,ai)&&!xe(this,wr))return(A=(w=(b=g.local())==null?void 0:b.database())==null?void 0:w.ref(T))==null?void 0:A.query(...x);{let O=re(re({},g.ref(T,R,C)),g),{data:$,onRequest:P,callback:N}=y(x);return(!$||$==="")&&($={take:15},!xe(this,as)&&!$.order&&($.order={uid:"ASC"})),d("get",v+Lt.get.many+"?query="+JSON.stringify(o($)),null,P,O,N)}},update:(...x)=>{let b=re(re({},g.ref(T,R,C)),g),{data:w,onRequest:A,callback:O}=y(x),$=Lt.update.one;return xe(this,Jt)?(Array.isArray(w==null?void 0:w.files)||Array.isArray(w==null?void 0:w.folders))&&(Array.isArray(w==null?void 0:w.files)&&(w.isFolder=!1),Array.isArray(w==null?void 0:w.folders)&&(w.isFolder=!0),$=Lt.update.many):Array.isArray(w)&&($=Lt.find.many),d("put",v+$,w,A,b,O)},delete:(...x)=>{var b,w,A;if(g.auth().$currentUserId&&(R==null?void 0:R.host)===(r==null?void 0:r.STORAGE)&&xe(this,ai)&&!xe(this,wr))return(A=(w=(b=g.local())==null?void 0:b.database())==null?void 0:w.ref(T))==null?void 0:A.delete(...x);{let O=re(re({},g.ref(T,R,C)),g),{data:$,onRequest:P,callback:N}=y(x),D=Lt.delete.one;return xe(this,Jt)?(Array.isArray($==null?void 0:$.files)||Array.isArray($==null?void 0:$.folders))&&(Array.isArray($==null?void 0:$.files)&&($.isFolder=!1),Array.isArray($==null?void 0:$.folders)&&($.isFolder=!0),Object.keys($).length<=0&&($.isFolder=!0),D=Lt.delete.many):(Array.isArray($)||$.where)&&(D=Lt.delete.many),d("delete",v+D,$,P,O,N)}},on:()=>{let x=re(re({},g.ref(T,R,C)),g);return u(C,R,x,T)},onValue:x=>{let b=re(re({},g.ref(T,R,C)),g),w=g.ref(T,R,C);return w==null||w.on().create(x),w==null||w.on().update(x),w==null||w.on().delete(x),w==null||w.on().upload(x),b}};return xe(this,Jt)&&(k.download=(...x)=>{let b=re(re({},g.ref(T,R,C)),g),{data:w,onRequest:A,callback:O}=y(x),$=Bs.download.one;return(Array.isArray(w==null?void 0:w.files)||Array.isArray(w==null?void 0:w.folders))&&($=Bs.download.many),d("get",v+$+"?query="+JSON.stringify(o(w)),null,A,b,O)},k.upload=(...x)=>{let b=re(re({},g.ref(T,R,C)),g),{data:w,onRequest:A,callback:O}=y(x),$=Bs.upload+"?query="+JSON.stringify({storage:xe(this,Jt),config:xe(this,cs)});return d("post",v+$,w,A,b,O)}),k}}});$n(this,Ti,e);let{ENV:t,OFFLINE_DB_NAME:r}=xe(this,Ti);$n(this,qt,Co.WithIndexedDB((r==null?void 0:r.STORAGE)||"swyger_storage"));let i=()=>V(this,null,function*(){try{let s,o=localStorage.getItem("accessToken");if((()=>{var c;try{s=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");let l=ij(o);return(Date==null?void 0:Date.parse((c=new Date((l==null?void 0:l.exp)*1e3))==null?void 0:c.toString()))<Date.now()}catch(l){return!1}})()&&s.uid)try{t==="dev"&&console.log("Token expired on inactivity, Trying to request a new refresh token")}catch(c){}}catch(s){}});"requestIdleCallback"in window&&requestIdleCallback(i)}}os=new WeakMap,oi=new WeakMap,$i=new WeakMap,as=new WeakMap,Jt=new WeakMap,Dh=new WeakMap,cs=new WeakMap,hc=new WeakMap,go=new WeakMap,ai=new WeakMap,wr=new WeakMap,Ti=new WeakMap,qt=new WeakMap;const KL={init:n=>{try{return(e={})=>new VL(n).init(e)}catch(e){return{}}}};let WL={init:n=>{var e,t,r,i,s;return{OFFLINE_DB_NAME:{STORAGE:((e=n==null?void 0:n.OFFLINE_DB_NAME)==null?void 0:e.STORAGE)||"swyger_storage"},ENV:(n==null?void 0:n.ENV)||"prod",HOST_SERVER:{AUTH:((t=n==null?void 0:n.HOST_SERVER)==null?void 0:t.AUTH)||"http://localhost:4100",STORAGE:((r=n==null?void 0:n.HOST_SERVER)==null?void 0:r.STORAGE)||"http://localhost:4500"},API_VERSION:{AUTH:((i=n==null?void 0:n.API_VERSION)==null?void 0:i.AUTH)||"/api/v1",STORAGE:((s=n==null?void 0:n.API_VERSION)==null?void 0:s.STORAGE)||"/api/v1"},AUTO_REFRESH_TOKEN_TIMEOUT:(n==null?void 0:n.AUTO_REFRESH_TOKEN_TIMEOUT)||15e5,API_KEY:(n==null?void 0:n.API_KEY)||"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJzd3lnZXIuY29tIiwiaWF0IjoxNjUzNDQwOTkxLCJleHAiOjE2ODQ5NzY5OTEsImF1ZCI6ImRheW52ZXIuY29tIiwic3ViIjoidGVhbUBzd3lnZXIuY29tIiwiR2l2ZW5OYW1lIjoiSXZhbiBKb2VsIiwiU3VybmFtZSI6IlNvYmd1aSIsIkVtYWlsIjoidGVhbUBhZ2dsb215LmNvbSIsIlJvbGUiOlsiQWRtaW4iLCJQcm9qZWN0IEFkbWluaXN0cmF0b3IiXX0.UvlcjBahR9G8dKxIeENJ7k4I87t3_oNJQ16eyPsRcSE"}}};const zL={init:n=>{let e=WL.init(n);const t=nj.init(e),r={socket:{storage:t==null?void 0:t.storage}};return KL.init(e)(r)}},HF={init:n=>{const e=I_.init(n),t=pI.init(n),r=zL.init(n);return{auth:e,database:t,storage:r}}};var Ih=function(n,e){return Ih=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])},Ih(n,e)};function wt(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Ih(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function HL(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{l(r.next(u))}catch(h){o(h)}}function c(u){try{l(r.throw(u))}catch(h){o(h)}}function l(u){u.done?s(u.value):i(u.value).then(a,c)}l((r=r.apply(n,e||[])).next())})}function kd(n,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(t=0)),t;)try{if(r=1,i&&(s=l[0]&2?i.return:l[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,l[1])).done)return s;switch(i=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){t.label=l[1];break}if(l[0]===6&&t.label<s[1]){t.label=s[1],s=l;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(l);break}s[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(n,t)}catch(u){l=[6,u],i=0}finally{r=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function fn(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ze(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return s}function et(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return n.concat(s||Array.prototype.slice.call(e))}function ss(n){return this instanceof ss?(this.v=n,this):new ss(n)}function JL(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(p){r[p]&&(i[p]=function(f){return new Promise(function(d,y){s.push([p,f,d,y])>1||a(p,f)})})}function a(p,f){try{c(r[p](f))}catch(d){h(s[0][3],d)}}function c(p){p.value instanceof ss?Promise.resolve(p.value.v).then(l,u):h(s[0][2],p)}function l(p){a("next",p)}function u(p){a("throw",p)}function h(p,f){p(f),s.shift(),s.length&&a(s[0][0],s[0][1])}}function YL(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof fn=="function"?fn(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(s){t[s]=n[s]&&function(o){return new Promise(function(a,c){o=n[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}function Ce(n){return typeof n=="function"}function Ki(n){var e=function(r){Error.call(r),r.stack=new Error().stack},t=n(e);return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var Ma=Ki(function(n){return function(t){n(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(r,i){return i+1+") "+r.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t}});function Tr(n,e){if(n){var t=n.indexOf(e);0<=t&&n.splice(t,1)}}var gn=function(){function n(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return n.prototype.unsubscribe=function(){var e,t,r,i,s;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var a=fn(o),c=a.next();!c.done;c=a.next()){var l=c.value;l.remove(this)}}catch(y){e={error:y}}finally{try{c&&!c.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}else o.remove(this);var u=this.initialTeardown;if(Ce(u))try{u()}catch(y){s=y instanceof Ma?y.errors:[y]}var h=this._finalizers;if(h){this._finalizers=null;try{for(var p=fn(h),f=p.next();!f.done;f=p.next()){var d=f.value;try{cg(d)}catch(y){s=s!=null?s:[],y instanceof Ma?s=et(et([],Ze(s)),Ze(y.errors)):s.push(y)}}}catch(y){r={error:y}}finally{try{f&&!f.done&&(i=p.return)&&i.call(p)}finally{if(r)throw r.error}}}if(s)throw new Ma(s)}},n.prototype.add=function(e){var t;if(e&&e!==this)if(this.closed)cg(e);else{if(e instanceof n){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}},n.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},n.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},n.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&Tr(t,e)},n.prototype.remove=function(e){var t=this._finalizers;t&&Tr(t,e),e instanceof n&&e._removeParent(this)},n.EMPTY=function(){var e=new n;return e.closed=!0,e}(),n}(),Fw=gn.EMPTY;function Mw(n){return n instanceof gn||n&&"closed"in n&&Ce(n.remove)&&Ce(n.add)&&Ce(n.unsubscribe)}function cg(n){Ce(n)?n():n.unsubscribe()}var gi={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},ac={setTimeout:function(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];var i=ac.delegate;return i!=null&&i.setTimeout?i.setTimeout.apply(i,et([n,e],Ze(t))):setTimeout.apply(void 0,et([n,e],Ze(t)))},clearTimeout:function(n){var e=ac.delegate;return((e==null?void 0:e.clearTimeout)||clearTimeout)(n)},delegate:void 0};function qw(n){ac.setTimeout(function(){var e=gi.onUnhandledError;if(e)e(n);else throw n})}function mt(){}var GL=function(){return xd("C",void 0,void 0)}();function QL(n){return xd("E",void 0,n)}function XL(n){return xd("N",n,void 0)}function xd(n,e,t){return{kind:n,value:e,error:t}}var Si=null;function qa(n){if(gi.useDeprecatedSynchronousErrorHandling){var e=!Si;if(e&&(Si={errorThrown:!1,error:null}),n(),e){var t=Si,r=t.errorThrown,i=t.error;if(Si=null,r)throw i}}else n()}function ZL(n){gi.useDeprecatedSynchronousErrorHandling&&Si&&(Si.errorThrown=!0,Si.error=n)}var il=function(n){wt(e,n);function e(t){var r=n.call(this)||this;return r.isStopped=!1,t?(r.destination=t,Mw(t)&&t.add(r)):r.destination=rD,r}return e.create=function(t,r,i){return new ms(t,r,i)},e.prototype.next=function(t){this.isStopped?du(XL(t),this):this._next(t)},e.prototype.error=function(t){this.isStopped?du(QL(t),this):(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped?du(GL,this):(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,n.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(gn),eD=Function.prototype.bind;function fu(n,e){return eD.call(n,e)}var tD=function(){function n(e){this.partialObserver=e}return n.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(r){sa(r)}},n.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(r){sa(r)}else sa(e)},n.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(t){sa(t)}},n}(),ms=function(n){wt(e,n);function e(t,r,i){var s=n.call(this)||this,o;if(Ce(t)||!t)o={next:t!=null?t:void 0,error:r!=null?r:void 0,complete:i!=null?i:void 0};else{var a;s&&gi.useDeprecatedNextContext?(a=Object.create(t),a.unsubscribe=function(){return s.unsubscribe()},o={next:t.next&&fu(t.next,a),error:t.error&&fu(t.error,a),complete:t.complete&&fu(t.complete,a)}):o=t}return s.destination=new tD(o),s}return e}(il);function sa(n){gi.useDeprecatedSynchronousErrorHandling?ZL(n):qw(n)}function nD(n){throw n}function du(n,e){var t=gi.onStoppedNotification;t&&ac.setTimeout(function(){return t(n,e)})}var rD={closed:!0,next:mt,error:nD,complete:mt},sl=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Rt(n){return n}function Ed(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return Vw(n)}function Vw(n){return n.length===0?Rt:n.length===1?n[0]:function(t){return n.reduce(function(r,i){return i(r)},t)}}var qe=function(){function n(e){e&&(this._subscribe=e)}return n.prototype.lift=function(e){var t=new n;return t.source=this,t.operator=e,t},n.prototype.subscribe=function(e,t,r){var i=this,s=sD(e)?e:new ms(e,t,r);return qa(function(){var o=i,a=o.operator,c=o.source;s.add(a?a.call(s,c):c?i._subscribe(s):i._trySubscribe(s))}),s},n.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},n.prototype.forEach=function(e,t){var r=this;return t=lg(t),new t(function(i,s){var o=new ms({next:function(a){try{e(a)}catch(c){s(c),o.unsubscribe()}},error:s,complete:i});r.subscribe(o)})},n.prototype._subscribe=function(e){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(e)},n.prototype[sl]=function(){return this},n.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Vw(e)(this)},n.prototype.toPromise=function(e){var t=this;return e=lg(e),new e(function(r,i){var s;t.subscribe(function(o){return s=o},function(o){return i(o)},function(){return r(s)})})},n.create=function(e){return new n(e)},n}();function lg(n){var e;return(e=n!=null?n:gi.Promise)!==null&&e!==void 0?e:Promise}function iD(n){return n&&Ce(n.next)&&Ce(n.error)&&Ce(n.complete)}function sD(n){return n&&n instanceof il||iD(n)&&Mw(n)}function Kw(n){return Ce(n==null?void 0:n.lift)}function me(n){return function(e){if(Kw(e))return e.lift(function(t){try{return n(t,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function de(n,e,t,r,i){return new _d(n,e,t,r,i)}var _d=function(n){wt(e,n);function e(t,r,i,s,o,a){var c=n.call(this,t)||this;return c.onFinalize=o,c.shouldUnsubscribe=a,c._next=r?function(l){try{r(l)}catch(u){t.error(u)}}:n.prototype._next,c._error=s?function(l){try{s(l)}catch(u){t.error(u)}finally{this.unsubscribe()}}:n.prototype._error,c._complete=i?function(){try{i()}catch(l){t.error(l)}finally{this.unsubscribe()}}:n.prototype._complete,c}return e.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;n.prototype.unsubscribe.call(this),!r&&((t=this.onFinalize)===null||t===void 0||t.call(this))}},e}(il);function Ww(){return me(function(n,e){var t=null;n._refCount++;var r=de(e,void 0,void 0,void 0,function(){if(!n||n._refCount<=0||0<--n._refCount){t=null;return}var i=n._connection,s=t;t=null,i&&(!s||i===s)&&i.unsubscribe(),e.unsubscribe()});n.subscribe(r),r.closed||(t=n.connect())})}var ol=function(n){wt(e,n);function e(t,r){var i=n.call(this)||this;return i.source=t,i.subjectFactory=r,i._subject=null,i._refCount=0,i._connection=null,Kw(t)&&(i.lift=t.lift),i}return e.prototype._subscribe=function(t){return this.getSubject().subscribe(t)},e.prototype.getSubject=function(){var t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject},e.prototype._teardown=function(){this._refCount=0;var t=this._connection;this._subject=this._connection=null,t==null||t.unsubscribe()},e.prototype.connect=function(){var t=this,r=this._connection;if(!r){r=this._connection=new gn;var i=this.getSubject();r.add(this.source.subscribe(de(i,void 0,function(){t._teardown(),i.complete()},function(s){t._teardown(),i.error(s)},function(){return t._teardown()}))),r.closed&&(this._connection=null,r=gn.EMPTY)}return r},e.prototype.refCount=function(){return Ww()(this)},e}(qe),zw={now:function(){return(zw.delegate||performance).now()},delegate:void 0},Pi={schedule:function(n){var e=requestAnimationFrame,t=cancelAnimationFrame,r=Pi.delegate;r&&(e=r.requestAnimationFrame,t=r.cancelAnimationFrame);var i=e(function(s){t=void 0,n(s)});return new gn(function(){return t==null?void 0:t(i)})},requestAnimationFrame:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Pi.delegate;return((t==null?void 0:t.requestAnimationFrame)||requestAnimationFrame).apply(void 0,et([],Ze(n)))},cancelAnimationFrame:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Pi.delegate;return((t==null?void 0:t.cancelAnimationFrame)||cancelAnimationFrame).apply(void 0,et([],Ze(n)))},delegate:void 0};function oD(n){return n?Hw(n):aD}function Hw(n){return new qe(function(e){var t=n||zw,r=t.now(),i=0,s=function(){e.closed||(i=Pi.requestAnimationFrame(function(o){i=0;var a=t.now();e.next({timestamp:n?a:o,elapsed:a-r}),s()}))};return s(),function(){i&&Pi.cancelAnimationFrame(i)}})}var aD=Hw(),Jw=Ki(function(n){return function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),Ot=function(n){wt(e,n);function e(){var t=n.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return e.prototype.lift=function(t){var r=new ug(this,this);return r.operator=t,r},e.prototype._throwIfClosed=function(){if(this.closed)throw new Jw},e.prototype.next=function(t){var r=this;qa(function(){var i,s;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var o=fn(r.currentObservers),a=o.next();!a.done;a=o.next()){var c=a.value;c.next(t)}}catch(l){i={error:l}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}}})},e.prototype.error=function(t){var r=this;qa(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=t;for(var i=r.observers;i.length;)i.shift().error(t)}})},e.prototype.complete=function(){var t=this;qa(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var r=t.observers;r.length;)r.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(t){return this._throwIfClosed(),n.prototype._trySubscribe.call(this,t)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var r=this,i=this,s=i.hasError,o=i.isStopped,a=i.observers;return s||o?Fw:(this.currentObservers=null,a.push(t),new gn(function(){r.currentObservers=null,Tr(a,t)}))},e.prototype._checkFinalizedStatuses=function(t){var r=this,i=r.hasError,s=r.thrownError,o=r.isStopped;i?t.error(s):o&&t.complete()},e.prototype.asObservable=function(){var t=new qe;return t.source=this,t},e.create=function(t,r){return new ug(t,r)},e}(qe),ug=function(n){wt(e,n);function e(t,r){var i=n.call(this)||this;return i.destination=t,i.source=r,i}return e.prototype.next=function(t){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.next)===null||i===void 0||i.call(r,t)},e.prototype.error=function(t){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.error)===null||i===void 0||i.call(r,t)},e.prototype.complete=function(){var t,r;(r=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||r===void 0||r.call(t)},e.prototype._subscribe=function(t){var r,i;return(i=(r=this.source)===null||r===void 0?void 0:r.subscribe(t))!==null&&i!==void 0?i:Fw},e}(Ot),Yw=function(n){wt(e,n);function e(t){var r=n.call(this)||this;return r._value=t,r}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(t){var r=n.prototype._subscribe.call(this,t);return!r.closed&&t.next(this._value),r},e.prototype.getValue=function(){var t=this,r=t.hasError,i=t.thrownError,s=t._value;if(r)throw i;return this._throwIfClosed(),s},e.prototype.next=function(t){n.prototype.next.call(this,this._value=t)},e}(Ot),al={now:function(){return(al.delegate||Date).now()},delegate:void 0},Ad=function(n){wt(e,n);function e(t,r,i){t===void 0&&(t=1/0),r===void 0&&(r=1/0),i===void 0&&(i=al);var s=n.call(this)||this;return s._bufferSize=t,s._windowTime=r,s._timestampProvider=i,s._buffer=[],s._infiniteTimeWindow=!0,s._infiniteTimeWindow=r===1/0,s._bufferSize=Math.max(1,t),s._windowTime=Math.max(1,r),s}return e.prototype.next=function(t){var r=this,i=r.isStopped,s=r._buffer,o=r._infiniteTimeWindow,a=r._timestampProvider,c=r._windowTime;i||(s.push(t),!o&&s.push(a.now()+c)),this._trimBuffer(),n.prototype.next.call(this,t)},e.prototype._subscribe=function(t){this._throwIfClosed(),this._trimBuffer();for(var r=this._innerSubscribe(t),i=this,s=i._infiniteTimeWindow,o=i._buffer,a=o.slice(),c=0;c<a.length&&!t.closed;c+=s?1:2)t.next(a[c]);return this._checkFinalizedStatuses(t),r},e.prototype._trimBuffer=function(){var t=this,r=t._bufferSize,i=t._timestampProvider,s=t._buffer,o=t._infiniteTimeWindow,a=(o?1:2)*r;if(r<1/0&&a<s.length&&s.splice(0,s.length-a),!o){for(var c=i.now(),l=0,u=1;u<s.length&&s[u]<=c;u+=2)l=u;l&&s.splice(0,l+1)}},e}(Ot),Od=function(n){wt(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t._value=null,t._hasValue=!1,t._isComplete=!1,t}return e.prototype._checkFinalizedStatuses=function(t){var r=this,i=r.hasError,s=r._hasValue,o=r._value,a=r.thrownError,c=r.isStopped,l=r._isComplete;i?t.error(a):(c||l)&&(s&&t.next(o),t.complete())},e.prototype.next=function(t){this.isStopped||(this._value=t,this._hasValue=!0)},e.prototype.complete=function(){var t=this,r=t._hasValue,i=t._value,s=t._isComplete;s||(this._isComplete=!0,r&&n.prototype.next.call(this,i),n.prototype.complete.call(this))},e}(Ot),cD=function(n){wt(e,n);function e(t,r){return n.call(this)||this}return e.prototype.schedule=function(t,r){return this},e}(gn),cc={setInterval:function(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];var i=cc.delegate;return i!=null&&i.setInterval?i.setInterval.apply(i,et([n,e],Ze(t))):setInterval.apply(void 0,et([n,e],Ze(t)))},clearInterval:function(n){var e=cc.delegate;return((e==null?void 0:e.clearInterval)||clearInterval)(n)},delegate:void 0},No=function(n){wt(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.scheduler=t,i.work=r,i.pending=!1,i}return e.prototype.schedule=function(t,r){var i;if(r===void 0&&(r=0),this.closed)return this;this.state=t;var s=this.id,o=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(o,s,r)),this.pending=!0,this.delay=r,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(o,this.id,r),this},e.prototype.requestAsyncId=function(t,r,i){return i===void 0&&(i=0),cc.setInterval(t.flush.bind(t,this),i)},e.prototype.recycleAsyncId=function(t,r,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return r;r!=null&&cc.clearInterval(r)},e.prototype.execute=function(t,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(t,r);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,r){var i=!1,s;try{this.work(t)}catch(o){i=!0,s=o||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),s},e.prototype.unsubscribe=function(){if(!this.closed){var t=this,r=t.id,i=t.scheduler,s=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,Tr(s,this),r!=null&&(this.id=this.recycleAsyncId(i,r,null)),this.delay=null,n.prototype.unsubscribe.call(this)}},e}(cD),lD=1,pu,Rh={};function hg(n){return n in Rh?(delete Rh[n],!0):!1}var Gw={setImmediate:function(n){var e=lD++;return Rh[e]=!0,pu||(pu=Promise.resolve()),pu.then(function(){return hg(e)&&n()}),e},clearImmediate:function(n){hg(n)}},uD=Gw.setImmediate,hD=Gw.clearImmediate,lc={setImmediate:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=lc.delegate;return((t==null?void 0:t.setImmediate)||uD).apply(void 0,et([],Ze(n)))},clearImmediate:function(n){var e=lc.delegate;return((e==null?void 0:e.clearImmediate)||hD)(n)},delegate:void 0},fD=function(n){wt(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.scheduler=t,i.work=r,i}return e.prototype.requestAsyncId=function(t,r,i){return i===void 0&&(i=0),i!==null&&i>0?n.prototype.requestAsyncId.call(this,t,r,i):(t.actions.push(this),t._scheduled||(t._scheduled=lc.setImmediate(t.flush.bind(t,void 0))))},e.prototype.recycleAsyncId=function(t,r,i){var s;if(i===void 0&&(i=0),i!=null?i>0:this.delay>0)return n.prototype.recycleAsyncId.call(this,t,r,i);var o=t.actions;r!=null&&((s=o[o.length-1])===null||s===void 0?void 0:s.id)!==r&&(lc.clearImmediate(r),t._scheduled===r&&(t._scheduled=void 0))},e}(No),Ch=function(){function n(e,t){t===void 0&&(t=n.now),this.schedulerActionCtor=e,this.now=t}return n.prototype.schedule=function(e,t,r){return t===void 0&&(t=0),new this.schedulerActionCtor(this,e).schedule(r,t)},n.now=al.now,n}(),jo=function(n){wt(e,n);function e(t,r){r===void 0&&(r=Ch.now);var i=n.call(this,t,r)||this;return i.actions=[],i._active=!1,i}return e.prototype.flush=function(t){var r=this.actions;if(this._active){r.push(t);return}var i;this._active=!0;do if(i=t.execute(t.state,t.delay))break;while(t=r.shift());if(this._active=!1,i){for(;t=r.shift();)t.unsubscribe();throw i}},e}(Ch),dD=function(n){wt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.flush=function(t){this._active=!0;var r=this._scheduled;this._scheduled=void 0;var i=this.actions,s;t=t||i.shift();do if(s=t.execute(t.state,t.delay))break;while((t=i[0])&&t.id===r&&i.shift());if(this._active=!1,s){for(;(t=i[0])&&t.id===r&&i.shift();)t.unsubscribe();throw s}},e}(jo),Qw=new dD(fD),pD=Qw,Mn=new jo(No),Sd=Mn,yD=function(n){wt(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.scheduler=t,i.work=r,i}return e.prototype.schedule=function(t,r){return r===void 0&&(r=0),r>0?n.prototype.schedule.call(this,t,r):(this.delay=r,this.state=t,this.scheduler.flush(this),this)},e.prototype.execute=function(t,r){return r>0||this.closed?n.prototype.execute.call(this,t,r):this._execute(t,r)},e.prototype.requestAsyncId=function(t,r,i){return i===void 0&&(i=0),i!=null&&i>0||i==null&&this.delay>0?n.prototype.requestAsyncId.call(this,t,r,i):(t.flush(this),0)},e}(No),gD=function(n){wt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e}(jo),Xw=new gD(yD),mD=Xw,vD=function(n){wt(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.scheduler=t,i.work=r,i}return e.prototype.requestAsyncId=function(t,r,i){return i===void 0&&(i=0),i!==null&&i>0?n.prototype.requestAsyncId.call(this,t,r,i):(t.actions.push(this),t._scheduled||(t._scheduled=Pi.requestAnimationFrame(function(){return t.flush(void 0)})))},e.prototype.recycleAsyncId=function(t,r,i){var s;if(i===void 0&&(i=0),i!=null?i>0:this.delay>0)return n.prototype.recycleAsyncId.call(this,t,r,i);var o=t.actions;r!=null&&((s=o[o.length-1])===null||s===void 0?void 0:s.id)!==r&&(Pi.cancelAnimationFrame(r),t._scheduled=void 0)},e}(No),bD=function(n){wt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.flush=function(t){this._active=!0;var r=this._scheduled;this._scheduled=void 0;var i=this.actions,s;t=t||i.shift();do if(s=t.execute(t.state,t.delay))break;while((t=i[0])&&t.id===r&&i.shift());if(this._active=!1,s){for(;(t=i[0])&&t.id===r&&i.shift();)t.unsubscribe();throw s}},e}(jo),Zw=new bD(vD),wD=Zw,kD=function(n){wt(e,n);function e(t,r){t===void 0&&(t=ek),r===void 0&&(r=1/0);var i=n.call(this,t,function(){return i.frame})||this;return i.maxFrames=r,i.frame=0,i.index=-1,i}return e.prototype.flush=function(){for(var t=this,r=t.actions,i=t.maxFrames,s,o;(o=r[0])&&o.delay<=i&&(r.shift(),this.frame=o.delay,!(s=o.execute(o.state,o.delay))););if(s){for(;o=r.shift();)o.unsubscribe();throw s}},e.frameTimeFactor=10,e}(jo),ek=function(n){wt(e,n);function e(t,r,i){i===void 0&&(i=t.index+=1);var s=n.call(this,t,r)||this;return s.scheduler=t,s.work=r,s.index=i,s.active=!0,s.index=t.index=i,s}return e.prototype.schedule=function(t,r){if(r===void 0&&(r=0),Number.isFinite(r)){if(!this.id)return n.prototype.schedule.call(this,t,r);this.active=!1;var i=new e(this.scheduler,this.work);return this.add(i),i.schedule(t,r)}else return gn.EMPTY},e.prototype.requestAsyncId=function(t,r,i){i===void 0&&(i=0),this.delay=t.frame+i;var s=t.actions;return s.push(this),s.sort(e.sortActions),1},e.prototype.recycleAsyncId=function(t,r,i){},e.prototype._execute=function(t,r){if(this.active===!0)return n.prototype._execute.call(this,t,r)},e.sortActions=function(t,r){return t.delay===r.delay?t.index===r.index?0:t.index>r.index?1:-1:t.delay>r.delay?1:-1},e}(No),br=new qe(function(n){return n.complete()});function xD(n){return n?ED(n):br}function ED(n){return new qe(function(e){return n.schedule(function(){return e.complete()})})}function cl(n){return n&&Ce(n.schedule)}function $d(n){return n[n.length-1]}function Bo(n){return Ce($d(n))?n.pop():void 0}function Nr(n){return cl($d(n))?n.pop():void 0}function tk(n,e){return typeof $d(n)=="number"?n.pop():e}var Td=function(n){return n&&typeof n.length=="number"&&typeof n!="function"};function nk(n){return Ce(n==null?void 0:n.then)}function rk(n){return Ce(n[sl])}function ik(n){return Symbol.asyncIterator&&Ce(n==null?void 0:n[Symbol.asyncIterator])}function sk(n){return new TypeError("You provided "+(n!==null&&typeof n=="object"?"an invalid object":"'"+n+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function _D(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var ok=_D();function ak(n){return Ce(n==null?void 0:n[ok])}function ck(n){return JL(this,arguments,function(){var t,r,i,s;return kd(this,function(o){switch(o.label){case 0:t=n.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,ss(t.read())];case 3:return r=o.sent(),i=r.value,s=r.done,s?[4,ss(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,ss(i)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}function lk(n){return Ce(n==null?void 0:n.getReader)}function Se(n){if(n instanceof qe)return n;if(n!=null){if(rk(n))return AD(n);if(Td(n))return OD(n);if(nk(n))return SD(n);if(ik(n))return uk(n);if(ak(n))return $D(n);if(lk(n))return TD(n)}throw sk(n)}function AD(n){return new qe(function(e){var t=n[sl]();if(Ce(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function OD(n){return new qe(function(e){for(var t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}function SD(n){return new qe(function(e){n.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,qw)})}function $D(n){return new qe(function(e){var t,r;try{for(var i=fn(n),s=i.next();!s.done;s=i.next()){var o=s.value;if(e.next(o),e.closed)return}}catch(a){t={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}e.complete()})}function uk(n){return new qe(function(e){PD(n,e).catch(function(t){return e.error(t)})})}function TD(n){return uk(ck(n))}function PD(n,e){var t,r,i,s;return HL(this,void 0,void 0,function(){var o,a;return kd(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),t=YL(n),c.label=1;case 1:return[4,t.next()];case 2:if(r=c.sent(),!!r.done)return[3,4];if(o=r.value,e.next(o),e.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),i={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),r&&!r.done&&(s=t.return)?[4,s.call(t)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function dn(n,e,t,r,i){r===void 0&&(r=0),i===void 0&&(i=!1);var s=e.schedule(function(){t(),i?n.add(this.schedule(null,r)):this.unsubscribe()},r);if(n.add(s),!i)return s}function ll(n,e){return e===void 0&&(e=0),me(function(t,r){t.subscribe(de(r,function(i){return dn(r,n,function(){return r.next(i)},e)},function(){return dn(r,n,function(){return r.complete()},e)},function(i){return dn(r,n,function(){return r.error(i)},e)}))})}function ul(n,e){return e===void 0&&(e=0),me(function(t,r){r.add(n.schedule(function(){return t.subscribe(r)},e))})}function ID(n,e){return Se(n).pipe(ul(e),ll(e))}function RD(n,e){return Se(n).pipe(ul(e),ll(e))}function CD(n,e){return new qe(function(t){var r=0;return e.schedule(function(){r===n.length?t.complete():(t.next(n[r++]),t.closed||this.schedule())})})}function hk(n,e){return new qe(function(t){var r;return dn(t,e,function(){r=n[ok](),dn(t,e,function(){var i,s,o;try{i=r.next(),s=i.value,o=i.done}catch(a){t.error(a);return}o?t.complete():t.next(s)},0,!0)}),function(){return Ce(r==null?void 0:r.return)&&r.return()}})}function fk(n,e){if(!n)throw new Error("Iterable cannot be null");return new qe(function(t){dn(t,e,function(){var r=n[Symbol.asyncIterator]();dn(t,e,function(){r.next().then(function(i){i.done?t.complete():t.next(i.value)})},0,!0)})})}function ND(n,e){return fk(ck(n),e)}function dk(n,e){if(n!=null){if(rk(n))return ID(n,e);if(Td(n))return CD(n,e);if(nk(n))return RD(n,e);if(ik(n))return fk(n,e);if(ak(n))return hk(n,e);if(lk(n))return ND(n,e)}throw sk(n)}function jr(n,e){return e?dk(n,e):Se(n)}function Pd(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Nr(n);return jr(n,t)}function pk(n,e){var t=Ce(n)?n:function(){return n},r=function(i){return i.error(t())};return new qe(e?function(i){return e.schedule(r,0,i)}:r)}var Nh;(function(n){n.NEXT="N",n.ERROR="E",n.COMPLETE="C"})(Nh||(Nh={}));var Va=function(){function n(e,t,r){this.kind=e,this.value=t,this.error=r,this.hasValue=e==="N"}return n.prototype.observe=function(e){return yk(this,e)},n.prototype.do=function(e,t,r){var i=this,s=i.kind,o=i.value,a=i.error;return s==="N"?e==null?void 0:e(o):s==="E"?t==null?void 0:t(a):r==null?void 0:r()},n.prototype.accept=function(e,t,r){var i;return Ce((i=e)===null||i===void 0?void 0:i.next)?this.observe(e):this.do(e,t,r)},n.prototype.toObservable=function(){var e=this,t=e.kind,r=e.value,i=e.error,s=t==="N"?Pd(r):t==="E"?pk(function(){return i}):t==="C"?br:0;if(!s)throw new TypeError("Unexpected notification kind "+t);return s},n.createNext=function(e){return new n("N",e)},n.createError=function(e){return new n("E",void 0,e)},n.createComplete=function(){return n.completeNotification},n.completeNotification=new n("C"),n}();function yk(n,e){var t,r,i,s=n,o=s.kind,a=s.value,c=s.error;if(typeof o!="string")throw new TypeError('Invalid notification, missing "kind"');o==="N"?(t=e.next)===null||t===void 0||t.call(e,a):o==="E"?(r=e.error)===null||r===void 0||r.call(e,c):(i=e.complete)===null||i===void 0||i.call(e)}function jD(n){return!!n&&(n instanceof qe||Ce(n.lift)&&Ce(n.subscribe))}var Wi=Ki(function(n){return function(){n(this),this.name="EmptyError",this.message="no elements in sequence"}});function BD(n,e){var t=typeof e=="object";return new Promise(function(r,i){var s=!1,o;n.subscribe({next:function(a){o=a,s=!0},error:i,complete:function(){s?r(o):t?r(e.defaultValue):i(new Wi)}})})}function LD(n,e){var t=typeof e=="object";return new Promise(function(r,i){var s=new ms({next:function(o){r(o),s.unsubscribe()},error:i,complete:function(){t?r(e.defaultValue):i(new Wi)}});n.subscribe(s)})}var jh=Ki(function(n){return function(){n(this),this.name="ArgumentOutOfRangeError",this.message="argument out of range"}}),gk=Ki(function(n){return function(t){n(this),this.name="NotFoundError",this.message=t}}),mk=Ki(function(n){return function(t){n(this),this.name="SequenceError",this.message=t}});function Id(n){return n instanceof Date&&!isNaN(n)}var vk=Ki(function(n){return function(t){t===void 0&&(t=null),n(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=t}});function bk(n,e){var t=Id(n)?{first:n}:typeof n=="number"?{each:n}:n,r=t.first,i=t.each,s=t.with,o=s===void 0?DD:s,a=t.scheduler,c=a===void 0?e!=null?e:Mn:a,l=t.meta,u=l===void 0?null:l;if(r==null&&i==null)throw new TypeError("No timeout provided.");return me(function(h,p){var f,d,y=null,_=0,S=function(I){d=dn(p,c,function(){try{f.unsubscribe(),Se(o({meta:u,lastValue:y,seen:_})).subscribe(p)}catch(B){p.error(B)}},I)};f=h.subscribe(de(p,function(I){d==null||d.unsubscribe(),_++,p.next(y=I),i>0&&S(i)},void 0,void 0,function(){d!=null&&d.closed||d==null||d.unsubscribe(),y=null})),!_&&S(r!=null?typeof r=="number"?r:+r-c.now():i)})}function DD(n){throw new vk(n)}function zi(n,e){return me(function(t,r){var i=0;t.subscribe(de(r,function(s){r.next(n.call(e,s,i++))}))})}var UD=Array.isArray;function FD(n,e){return UD(e)?n.apply(void 0,et([],Ze(e))):n(e)}function Hi(n){return zi(function(e){return FD(n,e)})}function uc(n,e,t,r){if(t)if(cl(t))r=t;else return function(){for(var i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];return uc(n,e,r).apply(this,i).pipe(Hi(t))};return r?function(){for(var i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];return uc(n,e).apply(this,i).pipe(ul(r),ll(r))}:function(){for(var i=this,s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];var a=new Od,c=!0;return new qe(function(l){var u=a.subscribe(l);if(c){c=!1;var h=!1,p=!1;e.apply(i,et(et([],Ze(s)),[function(){for(var f=[],d=0;d<arguments.length;d++)f[d]=arguments[d];if(n){var y=f.shift();if(y!=null){a.error(y);return}}a.next(1<f.length?f:f[0]),p=!0,h&&a.complete()}])),p&&a.complete(),h=!0}return u})}}function MD(n,e,t){return uc(!1,n,e,t)}function qD(n,e,t){return uc(!0,n,e,t)}var VD=Array.isArray,KD=Object.getPrototypeOf,WD=Object.prototype,zD=Object.keys;function wk(n){if(n.length===1){var e=n[0];if(VD(e))return{args:e,keys:null};if(HD(e)){var t=zD(e);return{args:t.map(function(r){return e[r]}),keys:t}}}return{args:n,keys:null}}function HD(n){return n&&typeof n=="object"&&KD(n)===WD}function kk(n,e){return n.reduce(function(t,r,i){return t[r]=e[i],t},{})}function xk(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Nr(n),r=Bo(n),i=wk(n),s=i.args,o=i.keys;if(s.length===0)return jr([],t);var a=new qe(Ek(s,t,o?function(c){return kk(o,c)}:Rt));return r?a.pipe(Hi(r)):a}function Ek(n,e,t){return t===void 0&&(t=Rt),function(r){fg(e,function(){for(var i=n.length,s=new Array(i),o=i,a=i,c=function(u){fg(e,function(){var h=jr(n[u],e),p=!1;h.subscribe(de(r,function(f){s[u]=f,p||(p=!0,a--),a||r.next(t(s.slice()))},function(){--o||r.complete()}))},r)},l=0;l<i;l++)c(l)},r)}}function fg(n,e,t){n?dn(t,n,e):e()}function Rd(n,e,t,r,i,s,o,a){var c=[],l=0,u=0,h=!1,p=function(){h&&!c.length&&!l&&e.complete()},f=function(y){return l<r?d(y):c.push(y)},d=function(y){s&&e.next(y),l++;var _=!1;Se(t(y,u++)).subscribe(de(e,function(S){i==null||i(S),s?f(S):e.next(S)},function(){_=!0},void 0,function(){if(_)try{l--;for(var S=function(){var I=c.shift();o?dn(e,o,function(){return d(I)}):d(I)};c.length&&l<r;)S();p()}catch(I){e.error(I)}}))};return n.subscribe(de(e,f,function(){h=!0,p()})),function(){a==null||a()}}function Zn(n,e,t){return t===void 0&&(t=1/0),Ce(e)?Zn(function(r,i){return zi(function(s,o){return e(r,s,i,o)})(Se(n(r,i)))},t):(typeof e=="number"&&(t=e),me(function(r,i){return Rd(r,i,n,t)}))}function hl(n){return n===void 0&&(n=1/0),Zn(Rt,n)}function Cd(){return hl(1)}function fo(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return Cd()(jr(n,Nr(n)))}function fl(n){return new qe(function(e){Se(n()).subscribe(e)})}var JD={connector:function(){return new Ot},resetOnDisconnect:!0};function YD(n,e){e===void 0&&(e=JD);var t=null,r=e.connector,i=e.resetOnDisconnect,s=i===void 0?!0:i,o=r(),a=new qe(function(c){return o.subscribe(c)});return a.connect=function(){return(!t||t.closed)&&(t=fl(function(){return n}).subscribe(o),s&&t.add(function(){return o=r()})),t},a}function GD(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Bo(n),r=wk(n),i=r.args,s=r.keys,o=new qe(function(a){var c=i.length;if(!c){a.complete();return}for(var l=new Array(c),u=c,h=c,p=function(d){var y=!1;Se(i[d]).subscribe(de(a,function(_){y||(y=!0,h--),l[d]=_},function(){return u--},void 0,function(){(!u||!y)&&(h||a.next(s?kk(s,l):l),a.complete())}))},f=0;f<c;f++)p(f)});return t?o.pipe(Hi(t)):o}var QD=["addListener","removeListener"],XD=["addEventListener","removeEventListener"],ZD=["on","off"];function Bh(n,e,t,r){if(Ce(t)&&(r=t,t=void 0),r)return Bh(n,e,t).pipe(Hi(r));var i=Ze(nU(n)?XD.map(function(a){return function(c){return n[a](e,c,t)}}):eU(n)?QD.map(dg(n,e)):tU(n)?ZD.map(dg(n,e)):[],2),s=i[0],o=i[1];if(!s&&Td(n))return Zn(function(a){return Bh(a,e,t)})(Se(n));if(!s)throw new TypeError("Invalid event target");return new qe(function(a){var c=function(){for(var l=[],u=0;u<arguments.length;u++)l[u]=arguments[u];return a.next(1<l.length?l:l[0])};return s(c),function(){return o(c)}})}function dg(n,e){return function(t){return function(r){return n[t](e,r)}}}function eU(n){return Ce(n.addListener)&&Ce(n.removeListener)}function tU(n){return Ce(n.on)&&Ce(n.off)}function nU(n){return Ce(n.addEventListener)&&Ce(n.removeEventListener)}function _k(n,e,t){return t?_k(n,e).pipe(Hi(t)):new qe(function(r){var i=function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];return r.next(o.length===1?o[0]:o)},s=n(i);return Ce(e)?function(){return e(i,s)}:void 0})}function rU(n,e,t,r,i){var s,o,a,c;arguments.length===1?(s=n,c=s.initialState,e=s.condition,t=s.iterate,o=s.resultSelector,a=o===void 0?Rt:o,i=s.scheduler):(c=n,!r||cl(r)?(a=Rt,i=r):a=r);function l(){var u;return kd(this,function(h){switch(h.label){case 0:u=c,h.label=1;case 1:return!e||e(u)?[4,a(u)]:[3,4];case 2:h.sent(),h.label=3;case 3:return u=t(u),[3,1];case 4:return[2]}})}return fl(i?function(){return hk(l(),i)}:l)}function iU(n,e,t){return fl(function(){return n()?e:t})}function Ji(n,e,t){n===void 0&&(n=0),t===void 0&&(t=Sd);var r=-1;return e!=null&&(cl(e)?t=e:r=e),new qe(function(i){var s=Id(n)?+n-t.now():n;s<0&&(s=0);var o=0;return t.schedule(function(){i.closed||(i.next(o++),0<=r?this.schedule(void 0,r):i.complete())},s)})}function Ak(n,e){return n===void 0&&(n=0),e===void 0&&(e=Mn),n<0&&(n=0),Ji(n,n,e)}function sU(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Nr(n),r=tk(n,1/0),i=n;return i.length?i.length===1?Se(i[0]):hl(r)(jr(i,t)):br}var Ok=new qe(mt);function oU(){return Ok}var aU=Array.isArray;function Os(n){return n.length===1&&aU(n[0])?n[0]:n}function Sk(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Os(n);return new qe(function(r){var i=0,s=function(){if(i<t.length){var o=void 0;try{o=Se(t[i++])}catch(c){s();return}var a=new _d(r,void 0,mt,mt);o.subscribe(a),a.add(s)}else r.complete()};s()})}function cU(n,e){return jr(Object.entries(n),e)}function lU(n,e){return function(t,r){return!n.call(e,t,r)}}function Ci(n,e){return me(function(t,r){var i=0;t.subscribe(de(r,function(s){return n.call(e,s,i++)&&r.next(s)}))})}function uU(n,e,t){return[Ci(e,t)(Se(n)),Ci(lU(e,t))(Se(n))]}function hU(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return n=Os(n),n.length===1?Se(n[0]):new qe($k(n))}function $k(n){return function(e){for(var t=[],r=function(s){t.push(Se(n[s]).subscribe(de(e,function(o){if(t){for(var a=0;a<t.length;a++)a!==s&&t[a].unsubscribe();t=null}e.next(o)})))},i=0;t&&!e.closed&&i<n.length;i++)r(i)}}function fU(n,e,t){if(e==null&&(e=n,n=0),e<=0)return br;var r=e+n;return new qe(t?function(i){var s=n;return t.schedule(function(){s<r?(i.next(s++),this.schedule()):i.complete()})}:function(i){for(var s=n;s<r&&!i.closed;)i.next(s++);i.complete()})}function dU(n,e){return new qe(function(t){var r=n(),i=e(r),s=i?Se(i):br;return s.subscribe(t),function(){r&&r.unsubscribe()}})}function Nd(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Bo(n),r=Os(n);return r.length?new qe(function(i){var s=r.map(function(){return[]}),o=r.map(function(){return!1});i.add(function(){s=o=null});for(var a=function(l){Se(r[l]).subscribe(de(i,function(u){if(s[l].push(u),s.every(function(p){return p.length})){var h=s.map(function(p){return p.shift()});i.next(t?t.apply(void 0,et([],Ze(h))):h),s.some(function(p,f){return!p.length&&o[f]})&&i.complete()}},function(){o[l]=!0,!s[l].length&&i.complete()}))},c=0;!i.closed&&c<r.length;c++)a(c);return function(){s=o=null}}):br}function Tk(n){return me(function(e,t){var r=!1,i=null,s=null,o=!1,a=function(){if(s==null||s.unsubscribe(),s=null,r){r=!1;var l=i;i=null,t.next(l)}o&&t.complete()},c=function(){s=null,o&&t.complete()};e.subscribe(de(t,function(l){r=!0,i=l,s||Se(n(l)).subscribe(s=de(t,a,c))},function(){o=!0,(!r||!s||s.closed)&&t.complete()}))})}function pU(n,e){return e===void 0&&(e=Mn),Tk(function(){return Ji(n,e)})}function yU(n){return me(function(e,t){var r=[];return e.subscribe(de(t,function(i){return r.push(i)},function(){t.next(r),t.complete()})),Se(n).subscribe(de(t,function(){var i=r;r=[],t.next(i)},mt)),function(){r=null}})}function gU(n,e){return e===void 0&&(e=null),e=e!=null?e:n,me(function(t,r){var i=[],s=0;t.subscribe(de(r,function(o){var a,c,l,u,h=null;s++%e===0&&i.push([]);try{for(var p=fn(i),f=p.next();!f.done;f=p.next()){var d=f.value;d.push(o),n<=d.length&&(h=h!=null?h:[],h.push(d))}}catch(S){a={error:S}}finally{try{f&&!f.done&&(c=p.return)&&c.call(p)}finally{if(a)throw a.error}}if(h)try{for(var y=fn(h),_=y.next();!_.done;_=y.next()){var d=_.value;Tr(i,d),r.next(d)}}catch(S){l={error:S}}finally{try{_&&!_.done&&(u=y.return)&&u.call(y)}finally{if(l)throw l.error}}},function(){var o,a;try{for(var c=fn(i),l=c.next();!l.done;l=c.next()){var u=l.value;r.next(u)}}catch(h){o={error:h}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(o)throw o.error}}r.complete()},void 0,function(){i=null}))})}function mU(n){for(var e,t,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];var s=(e=Nr(r))!==null&&e!==void 0?e:Mn,o=(t=r[0])!==null&&t!==void 0?t:null,a=r[1]||1/0;return me(function(c,l){var u=[],h=!1,p=function(y){var _=y.buffer,S=y.subs;S.unsubscribe(),Tr(u,y),l.next(_),h&&f()},f=function(){if(u){var y=new gn;l.add(y);var _=[],S={buffer:_,subs:y};u.push(S),dn(y,s,function(){return p(S)},n)}};o!==null&&o>=0?dn(l,s,f,o,!0):h=!0,f();var d=de(l,function(y){var _,S,I=u.slice();try{for(var B=fn(I),j=B.next();!j.done;j=B.next()){var U=j.value,M=U.buffer;M.push(y),a<=M.length&&p(U)}}catch(H){_={error:H}}finally{try{j&&!j.done&&(S=B.return)&&S.call(B)}finally{if(_)throw _.error}}},function(){for(;u!=null&&u.length;)l.next(u.shift().buffer);d==null||d.unsubscribe(),l.complete(),l.unsubscribe()},void 0,function(){return u=null});c.subscribe(d)})}function vU(n,e){return me(function(t,r){var i=[];Se(n).subscribe(de(r,function(s){var o=[];i.push(o);var a=new gn,c=function(){Tr(i,o),r.next(o),a.unsubscribe()};a.add(Se(e(s)).subscribe(de(r,c,mt)))},mt)),t.subscribe(de(r,function(s){var o,a;try{for(var c=fn(i),l=c.next();!l.done;l=c.next()){var u=l.value;u.push(s)}}catch(h){o={error:h}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(o)throw o.error}}},function(){for(;i.length>0;)r.next(i.shift());r.complete()}))})}function bU(n){return me(function(e,t){var r=null,i=null,s=function(){i==null||i.unsubscribe();var o=r;r=[],o&&t.next(o),Se(n()).subscribe(i=de(t,s,mt))};s(),e.subscribe(de(t,function(o){return r==null?void 0:r.push(o)},function(){r&&t.next(r),t.complete()},void 0,function(){return r=i=null}))})}function Pk(n){return me(function(e,t){var r=null,i=!1,s;r=e.subscribe(de(t,void 0,void 0,function(o){s=Se(n(o,Pk(n)(e))),r?(r.unsubscribe(),r=null,s.subscribe(t)):i=!0})),i&&(r.unsubscribe(),r=null,s.subscribe(t))})}function Ik(n,e,t,r,i){return function(s,o){var a=t,c=e,l=0;s.subscribe(de(o,function(u){var h=l++;c=a?n(c,u,h):(a=!0,u),r&&o.next(c)},i&&function(){a&&o.next(c),o.complete()}))}}function Lo(n,e){return me(Ik(n,e,arguments.length>=2,!1,!0))}var wU=function(n,e){return n.push(e),n};function Rk(){return me(function(n,e){Lo(wU,[])(n).subscribe(e)})}function Ck(n,e){return Ed(Rk(),Zn(function(t){return n(t)}),e?Hi(e):Rt)}function Nk(n){return Ck(xk,n)}var kU=Nk;function jk(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Bo(n);return t?Ed(jk.apply(void 0,et([],Ze(n))),Hi(t)):me(function(r,i){Ek(et([r],Ze(Os(n))))(i)})}function xU(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return jk.apply(void 0,et([],Ze(n)))}function Lh(n,e){return Ce(e)?Zn(n,e,1):Zn(n,1)}function EU(n,e){return Ce(e)?Lh(function(){return n},e):Lh(function(){return n})}function _U(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Nr(n);return me(function(r,i){Cd()(jr(et([r],Ze(n)),t)).subscribe(i)})}function AU(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return _U.apply(void 0,et([],Ze(n)))}function OU(n){return new qe(function(e){return n.subscribe(e)})}var SU={connector:function(){return new Ot}};function jd(n,e){e===void 0&&(e=SU);var t=e.connector;return me(function(r,i){var s=t();Se(n(OU(s))).subscribe(i),i.add(r.subscribe(s))})}function $U(n){return Lo(function(e,t,r){return!n||n(t,r)?e+1:e},0)}function TU(n){return me(function(e,t){var r=!1,i=null,s=null,o=function(){if(s==null||s.unsubscribe(),s=null,r){r=!1;var a=i;i=null,t.next(a)}};e.subscribe(de(t,function(a){s==null||s.unsubscribe(),r=!0,i=a,s=de(t,o,mt),Se(n(a)).subscribe(s)},function(){o(),t.complete()},void 0,function(){i=s=null}))})}function PU(n,e){return e===void 0&&(e=Mn),me(function(t,r){var i=null,s=null,o=null,a=function(){if(i){i.unsubscribe(),i=null;var l=s;s=null,r.next(l)}};function c(){var l=o+n,u=e.now();if(u<l){i=this.schedule(void 0,l-u),r.add(i);return}a()}t.subscribe(de(r,function(l){s=l,o=e.now(),i||(i=e.schedule(c,n),r.add(i))},function(){a(),r.complete()},void 0,function(){s=i=null}))})}function dl(n){return me(function(e,t){var r=!1;e.subscribe(de(t,function(i){r=!0,t.next(i)},function(){r||t.next(n),t.complete()}))})}function po(n){return n<=0?function(){return br}:me(function(e,t){var r=0;e.subscribe(de(t,function(i){++r<=n&&(t.next(i),n<=r&&t.complete())}))})}function Bk(){return me(function(n,e){n.subscribe(de(e,mt))})}function Lk(n){return zi(function(){return n})}function Bd(n,e){return e?function(t){return fo(e.pipe(po(1),Bk()),t.pipe(Bd(n)))}:Zn(function(t,r){return Se(n(t,r)).pipe(po(1),Lk(t))})}function IU(n,e){e===void 0&&(e=Mn);var t=Ji(n,e);return Bd(function(){return t})}function RU(){return me(function(n,e){n.subscribe(de(e,function(t){return yk(t,e)}))})}function CU(n,e){return me(function(t,r){var i=new Set;t.subscribe(de(r,function(s){var o=n?n(s):s;i.has(o)||(i.add(o),r.next(s))})),e&&Se(e).subscribe(de(r,function(){return i.clear()},mt))})}function Dk(n,e){return e===void 0&&(e=Rt),n=n!=null?n:NU,me(function(t,r){var i,s=!0;t.subscribe(de(r,function(o){var a=e(o);(s||!n(i,a))&&(s=!1,i=a,r.next(o))}))})}function NU(n,e){return n===e}function jU(n,e){return Dk(function(t,r){return e?e(t[n],r[n]):t[n]===r[n]})}function pl(n){return n===void 0&&(n=BU),me(function(e,t){var r=!1;e.subscribe(de(t,function(i){r=!0,t.next(i)},function(){return r?t.complete():t.error(n())}))})}function BU(){return new Wi}function LU(n,e){if(n<0)throw new jh;var t=arguments.length>=2;return function(r){return r.pipe(Ci(function(i,s){return s===n}),po(1),t?dl(e):pl(function(){return new jh}))}}function DU(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return function(t){return fo(t,Pd.apply(void 0,et([],Ze(n))))}}function UU(n,e){return me(function(t,r){var i=0;t.subscribe(de(r,function(s){n.call(e,s,i++,t)||(r.next(!1),r.complete())},function(){r.next(!0),r.complete()}))})}function Ld(n,e){return e?function(t){return t.pipe(Ld(function(r,i){return Se(n(r,i)).pipe(zi(function(s,o){return e(r,s,i,o)}))}))}:me(function(t,r){var i=0,s=null,o=!1;t.subscribe(de(r,function(a){s||(s=de(r,void 0,function(){s=null,o&&r.complete()}),Se(n(a,i++)).subscribe(s))},function(){o=!0,!s&&r.complete()}))})}function Uk(){return Ld(Rt)}var FU=Uk;function MU(n,e,t){return e===void 0&&(e=1/0),e=(e||0)<1?1/0:e,me(function(r,i){return Rd(r,i,n,e,void 0,!0,t)})}function qU(n){return me(function(e,t){try{e.subscribe(t)}finally{t.add(n)}})}function VU(n,e){return me(Fk(n,e,"value"))}function Fk(n,e,t){var r=t==="index";return function(i,s){var o=0;i.subscribe(de(s,function(a){var c=o++;n.call(e,a,c,i)&&(s.next(r?c:a),s.complete())},function(){s.next(r?-1:void 0),s.complete()}))}}function KU(n,e){return me(Fk(n,e,"index"))}function WU(n,e){var t=arguments.length>=2;return function(r){return r.pipe(n?Ci(function(i,s){return n(i,s,r)}):Rt,po(1),t?dl(e):pl(function(){return new Wi}))}}function zU(n,e,t,r){return me(function(i,s){var o;!e||typeof e=="function"?o=e:(t=e.duration,o=e.element,r=e.connector);var a=new Map,c=function(d){a.forEach(d),d(s)},l=function(d){return c(function(y){return y.error(d)})},u=0,h=!1,p=new _d(s,function(d){try{var y=n(d),_=a.get(y);if(!_){a.set(y,_=r?r():new Ot);var S=f(y,_);if(s.next(S),t){var I=de(_,function(){_.complete(),I==null||I.unsubscribe()},void 0,void 0,function(){return a.delete(y)});p.add(Se(t(S)).subscribe(I))}}_.next(o?o(d):d)}catch(B){l(B)}},function(){return c(function(d){return d.complete()})},l,function(){return a.clear()},function(){return h=!0,u===0});i.subscribe(p);function f(d,y){var _=new qe(function(S){u++;var I=y.subscribe(S);return function(){I.unsubscribe(),--u===0&&h&&p.unsubscribe()}});return _.key=d,_}})}function HU(){return me(function(n,e){n.subscribe(de(e,function(){e.next(!1),e.complete()},function(){e.next(!0),e.complete()}))})}function Mk(n){return n<=0?function(){return br}:me(function(e,t){var r=[];e.subscribe(de(t,function(i){r.push(i),n<r.length&&r.shift()},function(){var i,s;try{for(var o=fn(r),a=o.next();!a.done;a=o.next()){var c=a.value;t.next(c)}}catch(l){i={error:l}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}t.complete()},void 0,function(){r=null}))})}function JU(n,e){var t=arguments.length>=2;return function(r){return r.pipe(n?Ci(function(i,s){return n(i,s,r)}):Rt,Mk(1),t?dl(e):pl(function(){return new Wi}))}}function YU(){return me(function(n,e){n.subscribe(de(e,function(t){e.next(Va.createNext(t))},function(){e.next(Va.createComplete()),e.complete()},function(t){e.next(Va.createError(t)),e.complete()}))})}function GU(n){return Lo(Ce(n)?function(e,t){return n(e,t)>0?e:t}:function(e,t){return e>t?e:t})}var QU=Zn;function XU(n,e,t){return t===void 0&&(t=1/0),Ce(e)?Zn(function(){return n},e,t):(typeof e=="number"&&(t=e),Zn(function(){return n},t))}function ZU(n,e,t){return t===void 0&&(t=1/0),me(function(r,i){var s=e;return Rd(r,i,function(o,a){return n(s,o,a)},t,function(o){s=o},!1,void 0,function(){return s=null})})}function eF(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Nr(n),r=tk(n,1/0);return n=Os(n),me(function(i,s){hl(r)(jr(et([i],Ze(n)),t)).subscribe(s)})}function tF(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return eF.apply(void 0,et([],Ze(n)))}function nF(n){return Lo(Ce(n)?function(e,t){return n(e,t)<0?e:t}:function(e,t){return e<t?e:t})}function Dd(n,e){var t=Ce(n)?n:function(){return n};return Ce(e)?jd(e,{connector:t}):function(r){return new ol(r,t)}}function rF(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Os(n);return function(r){return Sk.apply(void 0,et([r],Ze(t)))}}function iF(){return me(function(n,e){var t,r=!1;n.subscribe(de(e,function(i){var s=t;t=i,r&&e.next([s,i]),r=!0}))})}function sF(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=n.length;if(t===0)throw new Error("list of properties cannot be empty.");return zi(function(r){for(var i=r,s=0;s<t;s++){var o=i==null?void 0:i[n[s]];if(typeof o!="undefined")i=o;else return}return i})}function oF(n){return n?function(e){return jd(n)(e)}:function(e){return Dd(new Ot)(e)}}function aF(n){return function(e){var t=new Yw(n);return new ol(e,function(){return t})}}function cF(){return function(n){var e=new Od;return new ol(n,function(){return e})}}function lF(n,e,t,r){t&&!Ce(t)&&(r=t);var i=Ce(t)?t:void 0;return function(s){return Dd(new Ad(n,e,r),i)(s)}}function uF(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return n.length?me(function(t,r){$k(et([t],Ze(n)))(r)}):Rt}function hF(n){var e,t=1/0,r;return n!=null&&(typeof n=="object"?(e=n.count,t=e===void 0?1/0:e,r=n.delay):t=n),t<=0?function(){return br}:me(function(i,s){var o=0,a,c=function(){if(a==null||a.unsubscribe(),a=null,r!=null){var u=typeof r=="number"?Ji(r):Se(r(o)),h=de(s,function(){h.unsubscribe(),l()});u.subscribe(h)}else l()},l=function(){var u=!1;a=i.subscribe(de(s,void 0,function(){++o<t?a?c():u=!0:s.complete()})),u&&c()};l()})}function fF(n){return me(function(e,t){var r,i=!1,s,o=!1,a=!1,c=function(){return a&&o&&(t.complete(),!0)},l=function(){return s||(s=new Ot,Se(n(s)).subscribe(de(t,function(){r?u():i=!0},function(){o=!0,c()}))),s},u=function(){a=!1,r=e.subscribe(de(t,void 0,function(){a=!0,!c()&&l().next()})),i&&(r.unsubscribe(),r=null,i=!1,u())};u()})}function dF(n){n===void 0&&(n=1/0);var e;n&&typeof n=="object"?e=n:e={count:n};var t=e.count,r=t===void 0?1/0:t,i=e.delay,s=e.resetOnSuccess,o=s===void 0?!1:s;return r<=0?Rt:me(function(a,c){var l=0,u,h=function(){var p=!1;u=a.subscribe(de(c,function(f){o&&(l=0),c.next(f)},void 0,function(f){if(l++<r){var d=function(){u?(u.unsubscribe(),u=null,h()):p=!0};if(i!=null){var y=typeof i=="number"?Ji(i):Se(i(f,l)),_=de(c,function(){_.unsubscribe(),d()},function(){c.complete()});y.subscribe(_)}else d()}else c.error(f)})),p&&(u.unsubscribe(),u=null,h())};h()})}function pF(n){return me(function(e,t){var r,i=!1,s,o=function(){r=e.subscribe(de(t,void 0,void 0,function(a){s||(s=new Ot,Se(n(s)).subscribe(de(t,function(){return r?o():i=!0}))),s&&s.next(a)})),i&&(r.unsubscribe(),r=null,i=!1,o())};o()})}function qk(n){return me(function(e,t){var r=!1,i=null;e.subscribe(de(t,function(s){r=!0,i=s})),Se(n).subscribe(de(t,function(){if(r){r=!1;var s=i;i=null,t.next(s)}},mt))})}function yF(n,e){return e===void 0&&(e=Mn),qk(Ak(n,e))}function gF(n,e){return me(Ik(n,e,arguments.length>=2,!0))}function mF(n,e){return e===void 0&&(e=function(t,r){return t===r}),me(function(t,r){var i=pg(),s=pg(),o=function(c){r.next(c),r.complete()},a=function(c,l){var u=de(r,function(h){var p=l.buffer,f=l.complete;p.length===0?f?o(!1):c.buffer.push(h):!e(h,p.shift())&&o(!1)},function(){c.complete=!0;var h=l.complete,p=l.buffer;h&&o(p.length===0),u==null||u.unsubscribe()});return u};t.subscribe(a(i,s)),Se(n).subscribe(a(s,i))})}function pg(){return{buffer:[],complete:!1}}function Vk(n){n===void 0&&(n={});var e=n.connector,t=e===void 0?function(){return new Ot}:e,r=n.resetOnError,i=r===void 0?!0:r,s=n.resetOnComplete,o=s===void 0?!0:s,a=n.resetOnRefCountZero,c=a===void 0?!0:a;return function(l){var u,h,p,f=0,d=!1,y=!1,_=function(){h==null||h.unsubscribe(),h=void 0},S=function(){_(),u=p=void 0,d=y=!1},I=function(){var B=u;S(),B==null||B.unsubscribe()};return me(function(B,j){f++,!y&&!d&&_();var U=p=p!=null?p:t();j.add(function(){f--,f===0&&!y&&!d&&(h=yu(I,c))}),U.subscribe(j),!u&&f>0&&(u=new ms({next:function(M){return U.next(M)},error:function(M){y=!0,_(),h=yu(S,i,M),U.error(M)},complete:function(){d=!0,_(),h=yu(S,o),U.complete()}}),Se(B).subscribe(u))})(l)}}function yu(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];if(e===!0){n();return}if(e!==!1){var i=new ms({next:function(){i.unsubscribe(),n()}});return Se(e.apply(void 0,et([],Ze(t)))).subscribe(i)}}function vF(n,e,t){var r,i,s,o,a=!1;return n&&typeof n=="object"?(r=n.bufferSize,o=r===void 0?1/0:r,i=n.windowTime,e=i===void 0?1/0:i,s=n.refCount,a=s===void 0?!1:s,t=n.scheduler):o=n!=null?n:1/0,Vk({connector:function(){return new Ad(o,e,t)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:a})}function bF(n){return me(function(e,t){var r=!1,i,s=!1,o=0;e.subscribe(de(t,function(a){s=!0,(!n||n(a,o++,e))&&(r&&t.error(new mk("Too many matching values")),r=!0,i=a)},function(){r?(t.next(i),t.complete()):t.error(s?new gk("No matching values"):new Wi)}))})}function wF(n){return Ci(function(e,t){return n<=t})}function kF(n){return n<=0?Rt:me(function(e,t){var r=new Array(n),i=0;return e.subscribe(de(t,function(s){var o=i++;if(o<n)r[o]=s;else{var a=o%n,c=r[a];r[a]=s,t.next(c)}})),function(){r=null}})}function xF(n){return me(function(e,t){var r=!1,i=de(t,function(){i==null||i.unsubscribe(),r=!0},mt);Se(n).subscribe(i),e.subscribe(de(t,function(s){return r&&t.next(s)}))})}function EF(n){return me(function(e,t){var r=!1,i=0;e.subscribe(de(t,function(s){return(r||(r=!n(s,i++)))&&t.next(s)}))})}function _F(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Nr(n);return me(function(r,i){(t?fo(n,r,t):fo(n,r)).subscribe(i)})}function yo(n,e){return me(function(t,r){var i=null,s=0,o=!1,a=function(){return o&&!i&&r.complete()};t.subscribe(de(r,function(c){i==null||i.unsubscribe();var l=0,u=s++;Se(n(c,u)).subscribe(i=de(r,function(h){return r.next(e?e(c,h,u,l++):h)},function(){i=null,a()}))},function(){o=!0,a()}))})}function AF(){return yo(Rt)}function OF(n,e){return Ce(e)?yo(function(){return n},e):yo(function(){return n})}function SF(n,e){return me(function(t,r){var i=e;return yo(function(s,o){return n(i,s,o)},function(s,o){return i=o,o})(t).subscribe(r),function(){i=null}})}function $F(n){return me(function(e,t){Se(n).subscribe(de(t,function(){return t.complete()},mt)),!t.closed&&e.subscribe(t)})}function TF(n,e){return e===void 0&&(e=!1),me(function(t,r){var i=0;t.subscribe(de(r,function(s){var o=n(s,i++);(o||e)&&r.next(s),!o&&r.complete()}))})}function PF(n,e,t){var r=Ce(n)||e||t?{next:n,error:e,complete:t}:n;return r?me(function(i,s){var o;(o=r.subscribe)===null||o===void 0||o.call(r);var a=!0;i.subscribe(de(s,function(c){var l;(l=r.next)===null||l===void 0||l.call(r,c),s.next(c)},function(){var c;a=!1,(c=r.complete)===null||c===void 0||c.call(r),s.complete()},function(c){var l;a=!1,(l=r.error)===null||l===void 0||l.call(r,c),s.error(c)},function(){var c,l;a&&((c=r.unsubscribe)===null||c===void 0||c.call(r)),(l=r.finalize)===null||l===void 0||l.call(r)}))}):Rt}function Kk(n,e){return me(function(t,r){var i=e!=null?e:{},s=i.leading,o=s===void 0?!0:s,a=i.trailing,c=a===void 0?!1:a,l=!1,u=null,h=null,p=!1,f=function(){h==null||h.unsubscribe(),h=null,c&&(_(),p&&r.complete())},d=function(){h=null,p&&r.complete()},y=function(S){return h=Se(n(S)).subscribe(de(r,f,d))},_=function(){if(l){l=!1;var S=u;u=null,r.next(S),!p&&y(S)}};t.subscribe(de(r,function(S){l=!0,u=S,!(h&&!h.closed)&&(o?_():y(S))},function(){p=!0,!(c&&l&&h&&!h.closed)&&r.complete()}))})}function IF(n,e,t){e===void 0&&(e=Mn);var r=Ji(n,e);return Kk(function(){return r},t)}function RF(n){return n===void 0&&(n=Mn),me(function(e,t){var r=n.now();e.subscribe(de(t,function(i){var s=n.now(),o=s-r;r=s,t.next(new CF(i,o))}))})}var CF=function(){function n(e,t){this.value=e,this.interval=t}return n}();function NF(n,e,t){var r,i,s;if(t=t!=null?t:Sd,Id(n)?r=n:typeof n=="number"&&(i=n),e)s=function(){return e};else throw new TypeError("No observable provided to switch to");if(r==null&&i==null)throw new TypeError("No timeout provided.");return bk({first:r,each:i,scheduler:t,with:s})}function jF(n){return n===void 0&&(n=al),zi(function(e){return{value:e,timestamp:n.now()}})}function BF(n){return me(function(e,t){var r=new Ot;t.next(r.asObservable());var i=function(s){r.error(s),t.error(s)};return e.subscribe(de(t,function(s){return r==null?void 0:r.next(s)},function(){r.complete(),t.complete()},i)),Se(n).subscribe(de(t,function(){r.complete(),t.next(r=new Ot)},mt,i)),function(){r==null||r.unsubscribe(),r=null}})}function LF(n,e){e===void 0&&(e=0);var t=e>0?e:n;return me(function(r,i){var s=[new Ot],o=[],a=0;i.next(s[0].asObservable()),r.subscribe(de(i,function(c){var l,u;try{for(var h=fn(s),p=h.next();!p.done;p=h.next()){var f=p.value;f.next(c)}}catch(_){l={error:_}}finally{try{p&&!p.done&&(u=h.return)&&u.call(h)}finally{if(l)throw l.error}}var d=a-n+1;if(d>=0&&d%t===0&&s.shift().complete(),++a%t===0){var y=new Ot;s.push(y),i.next(y.asObservable())}},function(){for(;s.length>0;)s.shift().complete();i.complete()},function(c){for(;s.length>0;)s.shift().error(c);i.error(c)},function(){o=null,s=null}))})}function DF(n){for(var e,t,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];var s=(e=Nr(r))!==null&&e!==void 0?e:Mn,o=(t=r[0])!==null&&t!==void 0?t:null,a=r[1]||1/0;return me(function(c,l){var u=[],h=!1,p=function(_){var S=_.window,I=_.subs;S.complete(),I.unsubscribe(),Tr(u,_),h&&f()},f=function(){if(u){var _=new gn;l.add(_);var S=new Ot,I={window:S,subs:_,seen:0};u.push(I),l.next(S.asObservable()),dn(_,s,function(){return p(I)},n)}};o!==null&&o>=0?dn(l,s,f,o,!0):h=!0,f();var d=function(_){return u.slice().forEach(_)},y=function(_){d(function(S){var I=S.window;return _(I)}),_(l),l.unsubscribe()};return c.subscribe(de(l,function(_){d(function(S){S.window.next(_),a<=++S.seen&&p(S)})},function(){return y(function(_){return _.complete()})},function(_){return y(function(S){return S.error(_)})})),function(){u=null}})}function UF(n,e){return me(function(t,r){var i=[],s=function(o){for(;0<i.length;)i.shift().error(o);r.error(o)};Se(n).subscribe(de(r,function(o){var a=new Ot;i.push(a);var c=new gn,l=function(){Tr(i,a),a.complete(),c.unsubscribe()},u;try{u=Se(e(o))}catch(h){s(h);return}r.next(a.asObservable()),c.add(u.subscribe(de(r,l,mt,s)))},mt)),t.subscribe(de(r,function(o){var a,c,l=i.slice();try{for(var u=fn(l),h=u.next();!h.done;h=u.next()){var p=h.value;p.next(o)}}catch(f){a={error:f}}finally{try{h&&!h.done&&(c=u.return)&&c.call(u)}finally{if(a)throw a.error}}},function(){for(;0<i.length;)i.shift().complete();r.complete()},s,function(){for(;0<i.length;)i.shift().unsubscribe()}))})}function FF(n){return me(function(e,t){var r,i,s=function(a){r.error(a),t.error(a)},o=function(){i==null||i.unsubscribe(),r==null||r.complete(),r=new Ot,t.next(r.asObservable());var a;try{a=Se(n())}catch(c){s(c);return}a.subscribe(i=de(t,o,o,s))};o(),e.subscribe(de(t,function(a){return r.next(a)},function(){r.complete(),t.complete()},s,function(){i==null||i.unsubscribe(),r=null}))})}function MF(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Bo(n);return me(function(r,i){for(var s=n.length,o=new Array(s),a=n.map(function(){return!1}),c=!1,l=function(h){Se(n[h]).subscribe(de(i,function(p){o[h]=p,!c&&!a[h]&&(a[h]=!0,(c=a.every(Rt))&&(a=null))},mt))},u=0;u<s;u++)l(u);r.subscribe(de(i,function(h){if(c){var p=et([h],Ze(o));i.next(t?t.apply(void 0,et([],Ze(p))):p)}}))})}function qF(n){return Ck(Nd,n)}function VF(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return me(function(t,r){Nd.apply(void 0,et([t],Ze(n))).subscribe(r)})}function KF(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return VF.apply(void 0,et([],Ze(n)))}const WF=Object.freeze(Object.defineProperty({__proto__:null,Observable:qe,ConnectableObservable:ol,observable:sl,animationFrames:oD,Subject:Ot,BehaviorSubject:Yw,ReplaySubject:Ad,AsyncSubject:Od,asap:pD,asapScheduler:Qw,async:Sd,asyncScheduler:Mn,queue:mD,queueScheduler:Xw,animationFrame:wD,animationFrameScheduler:Zw,VirtualTimeScheduler:kD,VirtualAction:ek,Scheduler:Ch,Subscription:gn,Subscriber:il,Notification:Va,get NotificationKind(){return Nh},pipe:Ed,noop:mt,identity:Rt,isObservable:jD,lastValueFrom:BD,firstValueFrom:LD,ArgumentOutOfRangeError:jh,EmptyError:Wi,NotFoundError:gk,ObjectUnsubscribedError:Jw,SequenceError:mk,TimeoutError:vk,UnsubscriptionError:Ma,bindCallback:MD,bindNodeCallback:qD,combineLatest:xk,concat:fo,connectable:YD,defer:fl,empty:xD,forkJoin:GD,from:jr,fromEvent:Bh,fromEventPattern:_k,generate:rU,iif:iU,interval:Ak,merge:sU,never:oU,of:Pd,onErrorResumeNext:Sk,pairs:cU,partition:uU,race:hU,range:fU,throwError:pk,timer:Ji,using:dU,zip:Nd,scheduled:dk,EMPTY:br,NEVER:Ok,config:gi,audit:Tk,auditTime:pU,buffer:yU,bufferCount:gU,bufferTime:mU,bufferToggle:vU,bufferWhen:bU,catchError:Pk,combineAll:kU,combineLatestAll:Nk,combineLatestWith:xU,concatAll:Cd,concatMap:Lh,concatMapTo:EU,concatWith:AU,connect:jd,count:$U,debounce:TU,debounceTime:PU,defaultIfEmpty:dl,delay:IU,delayWhen:Bd,dematerialize:RU,distinct:CU,distinctUntilChanged:Dk,distinctUntilKeyChanged:jU,elementAt:LU,endWith:DU,every:UU,exhaust:FU,exhaustAll:Uk,exhaustMap:Ld,expand:MU,filter:Ci,finalize:qU,find:VU,findIndex:KU,first:WU,groupBy:zU,ignoreElements:Bk,isEmpty:HU,last:JU,map:zi,mapTo:Lk,materialize:YU,max:GU,mergeAll:hl,flatMap:QU,mergeMap:Zn,mergeMapTo:XU,mergeScan:ZU,mergeWith:tF,min:nF,multicast:Dd,observeOn:ll,onErrorResumeNextWith:rF,pairwise:iF,pluck:sF,publish:oF,publishBehavior:aF,publishLast:cF,publishReplay:lF,raceWith:uF,reduce:Lo,repeat:hF,repeatWhen:fF,retry:dF,retryWhen:pF,refCount:Ww,sample:qk,sampleTime:yF,scan:gF,sequenceEqual:mF,share:Vk,shareReplay:vF,single:bF,skip:wF,skipLast:kF,skipUntil:xF,skipWhile:EF,startWith:_F,subscribeOn:ul,switchAll:AF,switchMap:yo,switchMapTo:OF,switchScan:SF,take:po,takeLast:Mk,takeUntil:$F,takeWhile:TF,tap:PF,throttle:Kk,throttleTime:IF,throwIfEmpty:pl,timeInterval:RF,timeout:bk,timeoutWith:NF,timestamp:jF,toArray:Rk,window:BF,windowCount:LF,windowTime:DF,windowToggle:UF,windowWhen:FF,withLatestFrom:MF,zipAll:qF,zipWith:KF},Symbol.toStringTag,{value:"Module"}));export{HF as default};
//# sourceMappingURL=swyger-client.min.js.map
