var Ya=Object.defineProperty,Ga=Object.defineProperties;var Qa=Object.getOwnPropertyDescriptors;var Wi=Object.getOwnPropertySymbols;var qa=Object.prototype.hasOwnProperty,Xa=Object.prototype.propertyIsEnumerable;var fr=(r,e,t)=>e in r?Ya(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,N=(r,e)=>{for(var t in e||(e={}))qa.call(e,t)&&fr(r,t,e[t]);if(Wi)for(var t of Wi(e))Xa.call(e,t)&&fr(r,t,e[t]);return r},ne=(r,e)=>Ga(r,Qa(e));var zi=(r,e,t)=>(fr(r,typeof e!="symbol"?e+"":e,t),t),Vi=(r,e,t)=>{if(!e.has(r))throw TypeError("Cannot "+t)};var J=(r,e,t)=>(Vi(r,e,"read from private field"),t?t.call(r):e.get(r)),je=(r,e,t)=>{if(e.has(r))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(r):e.set(r,t)},_e=(r,e,t,n)=>(Vi(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t);var I=(r,e,t)=>new Promise((n,i)=>{var s=c=>{try{a(t.next(c))}catch(u){i(u)}},o=c=>{try{a(t.throw(c))}catch(u){i(u)}},a=c=>c.done?n(c.value):Promise.resolve(c.value).then(s,o);a((t=t.apply(r,e)).next())});const ot=Object.create(null);ot.open="0";ot.close="1";ot.ping="2";ot.pong="3";ot.message="4";ot.upgrade="5";ot.noop="6";const _n=Object.create(null);Object.keys(ot).forEach(r=>{_n[ot[r]]=r});const Za={type:"error",data:"parser error"},ec=typeof Blob=="function"||typeof Blob!="undefined"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",tc=typeof ArrayBuffer=="function",nc=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r&&r.buffer instanceof ArrayBuffer,Ds=({type:r,data:e},t,n)=>ec&&e instanceof Blob?t?n(e):Hi(e,n):tc&&(e instanceof ArrayBuffer||nc(e))?t?n(e):Hi(new Blob([e]),n):n(ot[r]+(e||"")),Hi=(r,e)=>{const t=new FileReader;return t.onload=function(){const n=t.result.split(",")[1];e("b"+(n||""))},t.readAsDataURL(r)},Ji="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",en=typeof Uint8Array=="undefined"?[]:new Uint8Array(256);for(let r=0;r<Ji.length;r++)en[Ji.charCodeAt(r)]=r;const rc=r=>{let e=r.length*.75,t=r.length,n,i=0,s,o,a,c;r[r.length-1]==="="&&(e--,r[r.length-2]==="="&&e--);const u=new ArrayBuffer(e),l=new Uint8Array(u);for(n=0;n<t;n+=4)s=en[r.charCodeAt(n)],o=en[r.charCodeAt(n+1)],a=en[r.charCodeAt(n+2)],c=en[r.charCodeAt(n+3)],l[i++]=s<<2|o>>4,l[i++]=(o&15)<<4|a>>2,l[i++]=(a&3)<<6|c&63;return u},ic=typeof ArrayBuffer=="function",Us=(r,e)=>{if(typeof r!="string")return{type:"message",data:Fs(r,e)};const t=r.charAt(0);return t==="b"?{type:"message",data:sc(r.substring(1),e)}:_n[t]?r.length>1?{type:_n[t],data:r.substring(1)}:{type:_n[t]}:Za},sc=(r,e)=>{if(ic){const t=rc(r);return Fs(t,e)}else return{base64:!0,data:r}},Fs=(r,e)=>{switch(e){case"blob":return r instanceof ArrayBuffer?new Blob([r]):r;case"arraybuffer":default:return r}},Ms=String.fromCharCode(30),oc=(r,e)=>{const t=r.length,n=new Array(t);let i=0;r.forEach((s,o)=>{Ds(s,!1,a=>{n[o]=a,++i===t&&e(n.join(Ms))})})},ac=(r,e)=>{const t=r.split(Ms),n=[];for(let i=0;i<t.length;i++){const s=Us(t[i],e);if(n.push(s),s.type==="error")break}return n},Ks=4;function ve(r){if(r)return cc(r)}function cc(r){for(var e in ve.prototype)r[e]=ve.prototype[e];return r}ve.prototype.on=ve.prototype.addEventListener=function(r,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+r]=this._callbacks["$"+r]||[]).push(e),this};ve.prototype.once=function(r,e){function t(){this.off(r,t),e.apply(this,arguments)}return t.fn=e,this.on(r,t),this};ve.prototype.off=ve.prototype.removeListener=ve.prototype.removeAllListeners=ve.prototype.removeEventListener=function(r,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+r];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+r],this;for(var n,i=0;i<t.length;i++)if(n=t[i],n===e||n.fn===e){t.splice(i,1);break}return t.length===0&&delete this._callbacks["$"+r],this};ve.prototype.emit=function(r){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+r],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(t){t=t.slice(0);for(var n=0,i=t.length;n<i;++n)t[n].apply(this,e)}return this};ve.prototype.emitReserved=ve.prototype.emit;ve.prototype.listeners=function(r){return this._callbacks=this._callbacks||{},this._callbacks["$"+r]||[]};ve.prototype.hasListeners=function(r){return!!this.listeners(r).length};const Ge=(()=>typeof self!="undefined"?self:typeof window!="undefined"?window:Function("return this")())();function Ws(r,...e){return e.reduce((t,n)=>(r.hasOwnProperty(n)&&(t[n]=r[n]),t),{})}const uc=Ge.setTimeout,lc=Ge.clearTimeout;function Hn(r,e){e.useNativeTimers?(r.setTimeoutFn=uc.bind(Ge),r.clearTimeoutFn=lc.bind(Ge)):(r.setTimeoutFn=Ge.setTimeout.bind(Ge),r.clearTimeoutFn=Ge.clearTimeout.bind(Ge))}const fc=1.33;function hc(r){return typeof r=="string"?dc(r):Math.ceil((r.byteLength||r.size)*fc)}function dc(r){let e=0,t=0;for(let n=0,i=r.length;n<i;n++)e=r.charCodeAt(n),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(n++,t+=4);return t}class pc extends Error{constructor(e,t,n){super(e),this.description=t,this.context=n,this.type="TransportError"}}class zs extends ve{constructor(e){super(),this.writable=!1,Hn(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,n){return super.emitReserved("error",new pc(e,t,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=Us(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}}const Vs="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Pr=64,yc={};let Yi=0,gn=0,Gi;function Qi(r){let e="";do e=Vs[r%Pr]+e,r=Math.floor(r/Pr);while(r>0);return e}function Hs(){const r=Qi(+new Date);return r!==Gi?(Yi=0,Gi=r):r+"."+Qi(Yi++)}for(;gn<Pr;gn++)yc[Vs[gn]]=gn;function Js(r){let e="";for(let t in r)r.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(r[t]));return e}function mc(r){let e={},t=r.split("&");for(let n=0,i=t.length;n<i;n++){let s=t[n].split("=");e[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return e}let Ys=!1;try{Ys=typeof XMLHttpRequest!="undefined"&&"withCredentials"in new XMLHttpRequest}catch(r){}const gc=Ys;function Gs(r){const e=r.xdomain;try{if(typeof XMLHttpRequest!="undefined"&&(!e||gc))return new XMLHttpRequest}catch(t){}if(!e)try{return new Ge[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch(t){}}function vc(){}const wc=function(){return new Gs({xdomain:!1}).responseType!=null}();class bc extends zs{constructor(e){if(super(e),this.polling=!1,typeof location!="undefined"){const n=location.protocol==="https:";let i=location.port;i||(i=n?"443":"80"),this.xd=typeof location!="undefined"&&e.hostname!==location.hostname||i!==e.port,this.xs=e.secure!==n}const t=e&&e.forceBase64;this.supportsBinary=wc&&!t}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let n=0;this.polling&&(n++,this.once("pollComplete",function(){--n||t()})),this.writable||(n++,this.once("drain",function(){--n||t()}))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const t=n=>{if(this.readyState==="opening"&&n.type==="open"&&this.onOpen(),n.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(n)};ac(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,oc(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let e=this.query||{};const t=this.opts.secure?"https":"http";let n="";this.opts.timestampRequests!==!1&&(e[this.opts.timestampParam]=Hs()),!this.supportsBinary&&!e.sid&&(e.b64=1),this.opts.port&&(t==="https"&&Number(this.opts.port)!==443||t==="http"&&Number(this.opts.port)!==80)&&(n=":"+this.opts.port);const i=Js(e),s=this.opts.hostname.indexOf(":")!==-1;return t+"://"+(s?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(i.length?"?"+i:"")}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new st(this.uri(),e)}doWrite(e,t){const n=this.request({method:"POST",data:e});n.on("success",t),n.on("error",(i,s)=>{this.onError("xhr post error",i,s)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,n)=>{this.onError("xhr poll error",t,n)}),this.pollXhr=e}}class st extends ve{constructor(e,t){super(),Hn(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.async=t.async!==!1,this.data=t.data!==void 0?t.data:null,this.create()}create(){const e=Ws(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;const t=this.xhr=new Gs(e);try{t.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(let n in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(n)&&t.setRequestHeader(n,this.opts.extraHeaders[n])}}catch(n){}if(this.method==="POST")try{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(n){}try{t.setRequestHeader("Accept","*/*")}catch(n){}"withCredentials"in t&&(t.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(t.timeout=this.opts.requestTimeout),t.onreadystatechange=()=>{t.readyState===4&&(t.status===200||t.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof t.status=="number"?t.status:0)},0))},t.send(this.data)}catch(n){this.setTimeoutFn(()=>{this.onError(n)},0);return}typeof document!="undefined"&&(this.index=st.requestsCount++,st.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr=="undefined"||this.xhr===null)){if(this.xhr.onreadystatechange=vc,e)try{this.xhr.abort()}catch(t){}typeof document!="undefined"&&delete st.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}st.requestsCount=0;st.requests={};if(typeof document!="undefined"){if(typeof attachEvent=="function")attachEvent("onunload",qi);else if(typeof addEventListener=="function"){const r="onpagehide"in Ge?"pagehide":"unload";addEventListener(r,qi,!1)}}function qi(){for(let r in st.requests)st.requests.hasOwnProperty(r)&&st.requests[r].abort()}const Qs=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,t)=>t(e,0))(),vn=Ge.WebSocket||Ge.MozWebSocket,Xi=!0,xc="arraybuffer",Zi=typeof navigator!="undefined"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class Ec extends zs{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,n=Zi?{}:Ws(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=Xi&&!Zi?t?new vn(e,t):new vn(e):new vn(e,t,n)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType||xc,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],i=t===e.length-1;Ds(n,this.supportsBinary,s=>{const o={};try{Xi&&this.ws.send(s)}catch(a){}i&&Qs(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws!="undefined"&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{};const t=this.opts.secure?"wss":"ws";let n="";this.opts.port&&(t==="wss"&&Number(this.opts.port)!==443||t==="ws"&&Number(this.opts.port)!==80)&&(n=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=Hs()),this.supportsBinary||(e.b64=1);const i=Js(e),s=this.opts.hostname.indexOf(":")!==-1;return t+"://"+(s?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(i.length?"?"+i:"")}check(){return!!vn}}const kc={websocket:Ec,polling:bc},Ac=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Sc=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Ir(r){const e=r,t=r.indexOf("["),n=r.indexOf("]");t!=-1&&n!=-1&&(r=r.substring(0,t)+r.substring(t,n).replace(/:/g,";")+r.substring(n,r.length));let i=Ac.exec(r||""),s={},o=14;for(;o--;)s[Sc[o]]=i[o]||"";return t!=-1&&n!=-1&&(s.source=e,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=_c(s,s.path),s.queryKey=Tc(s,s.query),s}function _c(r,e){const t=/\/{2,9}/g,n=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&n.splice(0,1),e.slice(-1)=="/"&&n.splice(n.length-1,1),n}function Tc(r,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(n,i,s){i&&(t[i]=s)}),t}class wt extends ve{constructor(e,t={}){super(),this.writeBuffer=[],e&&typeof e=="object"&&(t=e,e=null),e?(e=Ir(e),t.hostname=e.host,t.secure=e.protocol==="https"||e.protocol==="wss",t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=Ir(t.host).host),Hn(this,t),this.secure=t.secure!=null?t.secure:typeof location!="undefined"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location!="undefined"?location.hostname:"localhost"),this.port=t.port||(typeof location!="undefined"&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=mc(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=Ks,t.transport=e,this.id&&(t.sid=this.id);const n=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new kc[e](n)}open(){let e;if(this.opts.rememberUpgrade&&wt.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch(t){this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",t=>this.onClose("transport close",t))}probe(e){let t=this.createTransport(e),n=!1;wt.priorWebsocketSuccess=!1;const i=()=>{n||(t.send([{type:"ping",data:"probe"}]),t.once("packet",f=>{if(!n)if(f.type==="pong"&&f.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;wt.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{n||this.readyState!=="closed"&&(l(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const m=new Error("probe error");m.transport=t.name,this.emitReserved("upgradeError",m)}}))};function s(){n||(n=!0,l(),t.close(),t=null)}const o=f=>{const m=new Error("probe error: "+f);m.transport=t.name,s(),this.emitReserved("upgradeError",m)};function a(){o("transport closed")}function c(){o("socket closed")}function u(f){t&&f.name!==t.name&&s()}const l=()=>{t.removeListener("open",i),t.removeListener("error",o),t.removeListener("close",a),this.off("close",c),this.off("upgrading",u)};t.once("open",i),t.once("error",o),t.once("close",a),this.once("close",c),this.once("upgrading",u),t.open()}onOpen(){if(this.readyState="open",wt.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let n=0;n<this.writeBuffer.length;n++){const i=this.writeBuffer[n].data;if(i&&(t+=hc(i)),n>0&&t>this.maxPayload)return this.writeBuffer.slice(0,n);t+=2}return this.writeBuffer}write(e,t,n){return this.sendPacket("message",e,t,n),this}send(e,t,n){return this.sendPacket("message",e,t,n),this}sendPacket(e,t,n,i){if(typeof t=="function"&&(i=t,t=void 0),typeof n=="function"&&(i=n,n=null),this.readyState==="closing"||this.readyState==="closed")return;n=n||{},n.compress=n.compress!==!1;const s={type:e,data:t,options:n};this.emitReserved("packetCreate",s),this.writeBuffer.push(s),i&&this.once("flush",i),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},n=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?n():e()}):this.upgrading?n():e()),this}onError(e){wt.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let n=0;const i=e.length;for(;n<i;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}}wt.protocol=Ks;function Oc(r,e="",t){let n=r;t=t||typeof location!="undefined"&&location,r==null&&(r=t.protocol+"//"+t.host),typeof r=="string"&&(r.charAt(0)==="/"&&(r.charAt(1)==="/"?r=t.protocol+r:r=t.host+r),/^(https?|wss?):\/\//.test(r)||(typeof t!="undefined"?r=t.protocol+"//"+r:r="https://"+r),n=Ir(r)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const s=n.host.indexOf(":")!==-1?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+s+":"+n.port+e,n.href=n.protocol+"://"+s+(t&&t.port===n.port?"":":"+n.port),n}const Pc=typeof ArrayBuffer=="function",Ic=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r.buffer instanceof ArrayBuffer,qs=Object.prototype.toString,Rc=typeof Blob=="function"||typeof Blob!="undefined"&&qs.call(Blob)==="[object BlobConstructor]",Nc=typeof File=="function"||typeof File!="undefined"&&qs.call(File)==="[object FileConstructor]";function Xr(r){return Pc&&(r instanceof ArrayBuffer||Ic(r))||Rc&&r instanceof Blob||Nc&&r instanceof File}function Tn(r,e){if(!r||typeof r!="object")return!1;if(Array.isArray(r)){for(let t=0,n=r.length;t<n;t++)if(Tn(r[t]))return!0;return!1}if(Xr(r))return!0;if(r.toJSON&&typeof r.toJSON=="function"&&arguments.length===1)return Tn(r.toJSON(),!0);for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t)&&Tn(r[t]))return!0;return!1}function $c(r){const e=[],t=r.data,n=r;return n.data=Rr(t,e),n.attachments=e.length,{packet:n,buffers:e}}function Rr(r,e){if(!r)return r;if(Xr(r)){const t={_placeholder:!0,num:e.length};return e.push(r),t}else if(Array.isArray(r)){const t=new Array(r.length);for(let n=0;n<r.length;n++)t[n]=Rr(r[n],e);return t}else if(typeof r=="object"&&!(r instanceof Date)){const t={};for(const n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=Rr(r[n],e));return t}return r}function Cc(r,e){return r.data=Nr(r.data,e),delete r.attachments,r}function Nr(r,e){if(!r)return r;if(r&&r._placeholder===!0){if(typeof r.num=="number"&&r.num>=0&&r.num<e.length)return e[r.num];throw new Error("illegal attachments")}else if(Array.isArray(r))for(let t=0;t<r.length;t++)r[t]=Nr(r[t],e);else if(typeof r=="object")for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&(r[t]=Nr(r[t],e));return r}const Bc=5;var ie;(function(r){r[r.CONNECT=0]="CONNECT",r[r.DISCONNECT=1]="DISCONNECT",r[r.EVENT=2]="EVENT",r[r.ACK=3]="ACK",r[r.CONNECT_ERROR=4]="CONNECT_ERROR",r[r.BINARY_EVENT=5]="BINARY_EVENT",r[r.BINARY_ACK=6]="BINARY_ACK"})(ie||(ie={}));class jc{constructor(e){this.replacer=e}encode(e){return(e.type===ie.EVENT||e.type===ie.ACK)&&Tn(e)?this.encodeAsBinary({type:e.type===ie.EVENT?ie.BINARY_EVENT:ie.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===ie.BINARY_EVENT||e.type===ie.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=$c(e),n=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(n),i}}class Zr extends ve{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const n=t.type===ie.BINARY_EVENT;n||t.type===ie.BINARY_ACK?(t.type=n?ie.EVENT:ie.ACK,this.reconstructor=new Lc(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(Xr(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const n={type:Number(e.charAt(0))};if(ie[n.type]===void 0)throw new Error("unknown packet type "+n.type);if(n.type===ie.BINARY_EVENT||n.type===ie.BINARY_ACK){const s=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const o=e.substring(s,t);if(o!=Number(o)||e.charAt(t)!=="-")throw new Error("Illegal attachments");n.attachments=Number(o)}if(e.charAt(t+1)==="/"){const s=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););n.nsp=e.substring(s,t)}else n.nsp="/";const i=e.charAt(t+1);if(i!==""&&Number(i)==i){const s=t+1;for(;++t;){const o=e.charAt(t);if(o==null||Number(o)!=o){--t;break}if(t===e.length)break}n.id=Number(e.substring(s,t+1))}if(e.charAt(++t)){const s=this.tryParse(e.substr(t));if(Zr.isPayloadValid(n.type,s))n.data=s;else throw new Error("invalid payload")}return n}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(t){return!1}}static isPayloadValid(e,t){switch(e){case ie.CONNECT:return typeof t=="object";case ie.DISCONNECT:return t===void 0;case ie.CONNECT_ERROR:return typeof t=="string"||typeof t=="object";case ie.EVENT:case ie.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="string"||typeof t[0]=="number");case ie.ACK:case ie.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Lc{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=Cc(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const Dc=Object.freeze(Object.defineProperty({__proto__:null,protocol:Bc,get PacketType(){return ie},Encoder:jc,Decoder:Zr},Symbol.toStringTag,{value:"Module"}));function Ze(r,e,t){return r.on(e,t),function(){r.off(e,t)}}const Uc=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Xs extends ve{constructor(e,t,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Ze(e,"open",this.onopen.bind(this)),Ze(e,"packet",this.onpacket.bind(this)),Ze(e,"error",this.onerror.bind(this)),Ze(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(Uc.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const n={type:ie.EVENT,data:t};if(n.options={},n.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const o=this.ids++,a=t.pop();this._registerAckCallback(o,a),n.id=o}const i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!i||!this.connected)||(this.connected?(this.notifyOutgoingListeners(n),this.packet(n)):this.sendBuffer.push(n)),this.flags={},this}_registerAckCallback(e,t){var n;const i=(n=this.flags.timeout)!==null&&n!==void 0?n:this._opts.ackTimeout;if(i===void 0){this.acks[e]=t;return}const s=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let o=0;o<this.sendBuffer.length;o++)this.sendBuffer[o].id===e&&this.sendBuffer.splice(o,1);t.call(this,new Error("operation has timed out"))},i);this.acks[e]=(...o)=>{this.io.clearTimeoutFn(s),t.apply(this,[null,...o])}}emitWithAck(e,...t){const n=this.flags.timeout!==void 0||this._opts.ackTimeout!==void 0;return new Promise((i,s)=>{t.push((o,a)=>n?o?s(o):i(a):i(o)),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());const n={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((i,...s)=>n!==this._queue[0]?void 0:(i!==null?n.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(i)):(this._queue.shift(),t&&t(null,...s)),n.pending=!1,this._drainQueue())),this._queue.push(n),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:ie.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case ie.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case ie.EVENT:case ie.BINARY_EVENT:this.onevent(e);break;case ie.ACK:case ie.BINARY_ACK:this.onack(e);break;case ie.DISCONNECT:this.ondisconnect();break;case ie.CONNECT_ERROR:this.destroy();const n=new Error(e.data.message);n.data=e.data.data,this.emitReserved("connect_error",n);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const n of t)n.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let n=!1;return function(...i){n||(n=!0,t.packet({type:ie.ACK,id:e,data:i}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:ie.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const n of t)n.apply(this,e.data)}}}function Yt(r){r=r||{},this.ms=r.min||100,this.max=r.max||1e4,this.factor=r.factor||2,this.jitter=r.jitter>0&&r.jitter<=1?r.jitter:0,this.attempts=0}Yt.prototype.duration=function(){var r=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*r);r=(Math.floor(e*10)&1)==0?r-t:r+t}return Math.min(r,this.max)|0};Yt.prototype.reset=function(){this.attempts=0};Yt.prototype.setMin=function(r){this.ms=r};Yt.prototype.setMax=function(r){this.max=r};Yt.prototype.setJitter=function(r){this.jitter=r};class $r extends ve{constructor(e,t){var n;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,Hn(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((n=t.randomizationFactor)!==null&&n!==void 0?n:.5),this.backoff=new Yt({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const i=t.parser||Dc;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new wt(this.uri,this.opts);const t=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const i=Ze(t,"open",function(){n.onopen(),e&&e()}),s=Ze(t,"error",o=>{n.cleanup(),n._readyState="closed",this.emitReserved("error",o),e?e(o):n.maybeReconnectOnOpen()});if(this._timeout!==!1){const o=this._timeout;o===0&&i();const a=this.setTimeoutFn(()=>{i(),t.close(),t.emit("error",new Error("timeout"))},o);this.opts.autoUnref&&a.unref(),this.subs.push(function(){clearTimeout(a)})}return this.subs.push(i),this.subs.push(s),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Ze(e,"ping",this.onping.bind(this)),Ze(e,"data",this.ondata.bind(this)),Ze(e,"error",this.onerror.bind(this)),Ze(e,"close",this.onclose.bind(this)),Ze(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){Qs(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new Xs(this,e,t),this.nsps[e]=n),n}_destroy(e){const t=Object.keys(this.nsps);for(const n of t)if(this.nsps[n].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let n=0;n<t.length;n++)this.engine.write(t[n],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(i=>{i?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",i)):e.onreconnect()}))},t);this.opts.autoUnref&&n.unref(),this.subs.push(function(){clearTimeout(n)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const qt={};function Ft(r,e){typeof r=="object"&&(e=r,r=void 0),e=e||{};const t=Oc(r,e.path||"/socket.io"),n=t.source,i=t.id,s=t.path,o=qt[i]&&s in qt[i].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||o;let c;return a?c=new $r(n,e):(qt[i]||(qt[i]=new $r(n,e)),c=qt[i]),t.query&&!e.query&&(e.query=t.queryKey),c.socket(t.path,e)}Object.assign(Ft,{Manager:$r,Socket:Xs,io:Ft,connect:Ft});const Fc={init:({API_KEY:r,HOST_SERVER:e,CURRENT:t,ENV:n,API_VERSION:i})=>{var a,c,u,l;let s={};const o=localStorage.getItem("accessToken");try{const f={Accept:"application/json","Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Key":r,"Access-Control-Allow-Methods":"POST, GET, OPTIONS, PUT, DELETE, HEAD,PATCH","Access-Control-Allow-Headers":"X-PINGOTHER, Origin, X-Requested-With, Content-Type, Accept","Access-Control-Max-Age":"1728000"};return o&&(f.Authorization="Bearer "+o),s.auth=Ft(e.AUTH,{extraHeaders:f}),s.database=Ft(e.DATABASE,{extraHeaders:f}),s.storage=Ft(e.STORAGE,{extraHeaders:f}),(a=s==null?void 0:s.auth)==null||a.on("connect",()=>{var d,y,v,A,O;let m=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");m.uid&&(d=s.auth)!=null&&d.id&&(n==="dev"&&console.log("The socket device id is: ",(y=s.auth)==null?void 0:y.id),(A=s==null?void 0:s.auth)==null||A.emit((i==null?void 0:i.AUTH)+"/user/join",{socketId:(v=s.auth)==null?void 0:v.id,currentUserId:m.uid}),(O=s==null?void 0:s.auth)==null||O.on((i==null?void 0:i.AUTH)+"/user/status",C=>{if(m.status!=="online"){let R;C.from===m.uid&&(R=C==null?void 0:C.value),R!=null&&R.status&&(n==="dev"&&console.log("user is online: ",R),m.status=R.status,localStorage.setItem("userInfo",JSON.stringify(m)))}}))}),(c=s==null?void 0:s.auth)==null||c.on("disconnect",m=>{s.auth.disconnect(),n==="dev"&&console.log("The device is disconnected from Auth server");let d=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");d.uid&&d.status!=="offline"&&(d.status="offline",localStorage.setItem("userInfo",JSON.stringify(d)))}),(u=s==null?void 0:s.database)==null||u.on("disconnect",m=>{n==="dev"&&console.log("The device is disconnected from Database server")}),s.storage.connected||s.storage.disconnect(),(l=s==null?void 0:s.storage)==null||l.on("disconnect",m=>{var d;n==="dev"&&console.log("The device is disconnected from Storage server"),(d=s==null?void 0:s.storage)==null||d.disconnect()}),s}catch(f){}}};function Cr(r){this.message=r}Cr.prototype=new Error,Cr.prototype.name="InvalidCharacterError";var es=typeof window!="undefined"&&window.atob&&window.atob.bind(window)||function(r){var e=String(r).replace(/=+$/,"");if(e.length%4==1)throw new Cr("'atob' failed: The string to be decoded is not correctly encoded.");for(var t,n,i=0,s=0,o="";n=e.charAt(s++);~n&&(t=i%4?64*t+n:n,i++%4)?o+=String.fromCharCode(255&t>>(-2*i&6)):0)n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(n);return o};function Mc(r){var e=r.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw"Illegal base64url string!"}try{return function(t){return decodeURIComponent(es(t).replace(/(.)/g,function(n,i){var s=i.charCodeAt(0).toString(16).toUpperCase();return s.length<2&&(s="0"+s),"%"+s}))}(e)}catch(t){return es(e)}}function Ln(r){this.message=r}function ts(r,e){if(typeof r!="string")throw new Ln("Invalid token specified");var t=(e=e||{}).header===!0?0:1;try{return JSON.parse(Mc(r.split(".")[t]))}catch(n){throw new Ln("Invalid token specified: "+n.message)}}Ln.prototype=new Error,Ln.prototype.name="InvalidTokenError";function Zs(r,e){return function(){return r.apply(e,arguments)}}const{toString:Kc}=Object.prototype,{getPrototypeOf:ei}=Object,Jn=(r=>e=>{const t=Kc.call(e);return r[t]||(r[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),at=r=>(r=r.toLowerCase(),e=>Jn(e)===r),Yn=r=>e=>typeof e===r,{isArray:Gt}=Array,tn=Yn("undefined");function Wc(r){return r!==null&&!tn(r)&&r.constructor!==null&&!tn(r.constructor)&&Qe(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}const eo=at("ArrayBuffer");function zc(r){let e;return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?e=ArrayBuffer.isView(r):e=r&&r.buffer&&eo(r.buffer),e}const Vc=Yn("string"),Qe=Yn("function"),to=Yn("number"),Gn=r=>r!==null&&typeof r=="object",Hc=r=>r===!0||r===!1,On=r=>{if(Jn(r)!=="object")return!1;const e=ei(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},Jc=at("Date"),Yc=at("File"),Gc=at("Blob"),Qc=at("FileList"),qc=r=>Gn(r)&&Qe(r.pipe),Xc=r=>{let e;return r&&(typeof FormData=="function"&&r instanceof FormData||Qe(r.append)&&((e=Jn(r))==="formdata"||e==="object"&&Qe(r.toString)&&r.toString()==="[object FormData]"))},Zc=at("URLSearchParams"),eu=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function ln(r,e,{allOwnKeys:t=!1}={}){if(r===null||typeof r=="undefined")return;let n,i;if(typeof r!="object"&&(r=[r]),Gt(r))for(n=0,i=r.length;n<i;n++)e.call(null,r[n],n,r);else{const s=t?Object.getOwnPropertyNames(r):Object.keys(r),o=s.length;let a;for(n=0;n<o;n++)a=s[n],e.call(null,r[a],a,r)}}function no(r,e){e=e.toLowerCase();const t=Object.keys(r);let n=t.length,i;for(;n-- >0;)if(i=t[n],e===i.toLowerCase())return i;return null}const ro=(()=>typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:global)(),io=r=>!tn(r)&&r!==ro;function Br(){const{caseless:r}=io(this)&&this||{},e={},t=(n,i)=>{const s=r&&no(e,i)||i;On(e[s])&&On(n)?e[s]=Br(e[s],n):On(n)?e[s]=Br({},n):Gt(n)?e[s]=n.slice():e[s]=n};for(let n=0,i=arguments.length;n<i;n++)arguments[n]&&ln(arguments[n],t);return e}const tu=(r,e,t,{allOwnKeys:n}={})=>(ln(e,(i,s)=>{t&&Qe(i)?r[s]=Zs(i,t):r[s]=i},{allOwnKeys:n}),r),nu=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),ru=(r,e,t,n)=>{r.prototype=Object.create(e.prototype,n),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:e.prototype}),t&&Object.assign(r.prototype,t)},iu=(r,e,t,n)=>{let i,s,o;const a={};if(e=e||{},r==null)return e;do{for(i=Object.getOwnPropertyNames(r),s=i.length;s-- >0;)o=i[s],(!n||n(o,r,e))&&!a[o]&&(e[o]=r[o],a[o]=!0);r=t!==!1&&ei(r)}while(r&&(!t||t(r,e))&&r!==Object.prototype);return e},su=(r,e,t)=>{r=String(r),(t===void 0||t>r.length)&&(t=r.length),t-=e.length;const n=r.indexOf(e,t);return n!==-1&&n===t},ou=r=>{if(!r)return null;if(Gt(r))return r;let e=r.length;if(!to(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=r[e];return t},au=(r=>e=>r&&e instanceof r)(typeof Uint8Array!="undefined"&&ei(Uint8Array)),cu=(r,e)=>{const n=(r&&r[Symbol.iterator]).call(r);let i;for(;(i=n.next())&&!i.done;){const s=i.value;e.call(r,s[0],s[1])}},uu=(r,e)=>{let t;const n=[];for(;(t=r.exec(e))!==null;)n.push(t);return n},lu=at("HTMLFormElement"),fu=r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,n,i){return n.toUpperCase()+i}),ns=(({hasOwnProperty:r})=>(e,t)=>r.call(e,t))(Object.prototype),hu=at("RegExp"),so=(r,e)=>{const t=Object.getOwnPropertyDescriptors(r),n={};ln(t,(i,s)=>{e(i,s,r)!==!1&&(n[s]=i)}),Object.defineProperties(r,n)},du=r=>{so(r,(e,t)=>{if(Qe(r)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const n=r[t];if(!!Qe(n)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},pu=(r,e)=>{const t={},n=i=>{i.forEach(s=>{t[s]=!0})};return Gt(r)?n(r):n(String(r).split(e)),t},yu=()=>{},mu=(r,e)=>(r=+r,Number.isFinite(r)?r:e),hr="abcdefghijklmnopqrstuvwxyz",rs="0123456789",oo={DIGIT:rs,ALPHA:hr,ALPHA_DIGIT:hr+hr.toUpperCase()+rs},gu=(r=16,e=oo.ALPHA_DIGIT)=>{let t="";const{length:n}=e;for(;r--;)t+=e[Math.random()*n|0];return t};function vu(r){return!!(r&&Qe(r.append)&&r[Symbol.toStringTag]==="FormData"&&r[Symbol.iterator])}const wu=r=>{const e=new Array(10),t=(n,i)=>{if(Gn(n)){if(e.indexOf(n)>=0)return;if(!("toJSON"in n)){e[i]=n;const s=Gt(n)?[]:{};return ln(n,(o,a)=>{const c=t(o,i+1);!tn(c)&&(s[a]=c)}),e[i]=void 0,s}}return n};return t(r,0)},bu=at("AsyncFunction"),xu=r=>r&&(Gn(r)||Qe(r))&&Qe(r.then)&&Qe(r.catch),j={isArray:Gt,isArrayBuffer:eo,isBuffer:Wc,isFormData:Xc,isArrayBufferView:zc,isString:Vc,isNumber:to,isBoolean:Hc,isObject:Gn,isPlainObject:On,isUndefined:tn,isDate:Jc,isFile:Yc,isBlob:Gc,isRegExp:hu,isFunction:Qe,isStream:qc,isURLSearchParams:Zc,isTypedArray:au,isFileList:Qc,forEach:ln,merge:Br,extend:tu,trim:eu,stripBOM:nu,inherits:ru,toFlatObject:iu,kindOf:Jn,kindOfTest:at,endsWith:su,toArray:ou,forEachEntry:cu,matchAll:uu,isHTMLForm:lu,hasOwnProperty:ns,hasOwnProp:ns,reduceDescriptors:so,freezeMethods:du,toObjectSet:pu,toCamelCase:fu,noop:yu,toFiniteNumber:mu,findKey:no,global:ro,isContextDefined:io,ALPHABET:oo,generateString:gu,isSpecCompliantForm:vu,toJSONObject:wu,isAsyncFn:bu,isThenable:xu};function ae(r,e,t,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),n&&(this.request=n),i&&(this.response=i)}j.inherits(ae,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:j.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const ao=ae.prototype,co={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{co[r]={value:r}});Object.defineProperties(ae,co);Object.defineProperty(ao,"isAxiosError",{value:!0});ae.from=(r,e,t,n,i,s)=>{const o=Object.create(ao);return j.toFlatObject(r,o,function(c){return c!==Error.prototype},a=>a!=="isAxiosError"),ae.call(o,r.message,e,t,n,i),o.cause=r,o.name=r.name,s&&Object.assign(o,s),o};const Eu=null;function jr(r){return j.isPlainObject(r)||j.isArray(r)}function uo(r){return j.endsWith(r,"[]")?r.slice(0,-2):r}function is(r,e,t){return r?r.concat(e).map(function(i,s){return i=uo(i),!t&&s?"["+i+"]":i}).join(t?".":""):e}function ku(r){return j.isArray(r)&&!r.some(jr)}const Au=j.toFlatObject(j,{},null,function(e){return/^is[A-Z]/.test(e)});function Qn(r,e,t){if(!j.isObject(r))throw new TypeError("target must be an object");e=e||new FormData,t=j.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(v,A){return!j.isUndefined(A[v])});const n=t.metaTokens,i=t.visitor||l,s=t.dots,o=t.indexes,c=(t.Blob||typeof Blob!="undefined"&&Blob)&&j.isSpecCompliantForm(e);if(!j.isFunction(i))throw new TypeError("visitor must be a function");function u(y){if(y===null)return"";if(j.isDate(y))return y.toISOString();if(!c&&j.isBlob(y))throw new ae("Blob is not supported. Use a Buffer instead.");return j.isArrayBuffer(y)||j.isTypedArray(y)?c&&typeof Blob=="function"?new Blob([y]):Buffer.from(y):y}function l(y,v,A){let O=y;if(y&&!A&&typeof y=="object"){if(j.endsWith(v,"{}"))v=n?v:v.slice(0,-2),y=JSON.stringify(y);else if(j.isArray(y)&&ku(y)||(j.isFileList(y)||j.endsWith(v,"[]"))&&(O=j.toArray(y)))return v=uo(v),O.forEach(function(R,U){!(j.isUndefined(R)||R===null)&&e.append(o===!0?is([v],U,s):o===null?v:v+"[]",u(R))}),!1}return jr(y)?!0:(e.append(is(A,v,s),u(y)),!1)}const f=[],m=Object.assign(Au,{defaultVisitor:l,convertValue:u,isVisitable:jr});function d(y,v){if(!j.isUndefined(y)){if(f.indexOf(y)!==-1)throw Error("Circular reference detected in "+v.join("."));f.push(y),j.forEach(y,function(O,C){(!(j.isUndefined(O)||O===null)&&i.call(e,O,j.isString(C)?C.trim():C,v,m))===!0&&d(O,v?v.concat(C):[C])}),f.pop()}}if(!j.isObject(r))throw new TypeError("data must be an object");return d(r),e}function ss(r){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function ti(r,e){this._pairs=[],r&&Qn(r,this,e)}const lo=ti.prototype;lo.append=function(e,t){this._pairs.push([e,t])};lo.toString=function(e){const t=e?function(n){return e.call(this,n,ss)}:ss;return this._pairs.map(function(i){return t(i[0])+"="+t(i[1])},"").join("&")};function Su(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function fo(r,e,t){if(!e)return r;const n=t&&t.encode||Su,i=t&&t.serialize;let s;if(i?s=i(e,t):s=j.isURLSearchParams(e)?e.toString():new ti(e,t).toString(n),s){const o=r.indexOf("#");o!==-1&&(r=r.slice(0,o)),r+=(r.indexOf("?")===-1?"?":"&")+s}return r}class _u{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){j.forEach(this.handlers,function(n){n!==null&&e(n)})}}const os=_u,ho={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Tu=typeof URLSearchParams!="undefined"?URLSearchParams:ti,Ou=typeof FormData!="undefined"?FormData:null,Pu=typeof Blob!="undefined"?Blob:null,Iu=(()=>{let r;return typeof navigator!="undefined"&&((r=navigator.product)==="ReactNative"||r==="NativeScript"||r==="NS")?!1:typeof window!="undefined"&&typeof document!="undefined"})(),Ru=(()=>typeof WorkerGlobalScope!="undefined"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),it={isBrowser:!0,classes:{URLSearchParams:Tu,FormData:Ou,Blob:Pu},isStandardBrowserEnv:Iu,isStandardBrowserWebWorkerEnv:Ru,protocols:["http","https","file","blob","url","data"]};function Nu(r,e){return Qn(r,new it.classes.URLSearchParams,Object.assign({visitor:function(t,n,i,s){return it.isNode&&j.isBuffer(t)?(this.append(n,t.toString("base64")),!1):s.defaultVisitor.apply(this,arguments)}},e))}function $u(r){return j.matchAll(/\w+|\[(\w*)]/g,r).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Cu(r){const e={},t=Object.keys(r);let n;const i=t.length;let s;for(n=0;n<i;n++)s=t[n],e[s]=r[s];return e}function po(r){function e(t,n,i,s){let o=t[s++];const a=Number.isFinite(+o),c=s>=t.length;return o=!o&&j.isArray(i)?i.length:o,c?(j.hasOwnProp(i,o)?i[o]=[i[o],n]:i[o]=n,!a):((!i[o]||!j.isObject(i[o]))&&(i[o]=[]),e(t,n,i[o],s)&&j.isArray(i[o])&&(i[o]=Cu(i[o])),!a)}if(j.isFormData(r)&&j.isFunction(r.entries)){const t={};return j.forEachEntry(r,(n,i)=>{e($u(n),i,t,0)}),t}return null}const Bu={"Content-Type":void 0};function ju(r,e,t){if(j.isString(r))try{return(e||JSON.parse)(r),j.trim(r)}catch(n){if(n.name!=="SyntaxError")throw n}return(t||JSON.stringify)(r)}const qn={transitional:ho,adapter:["xhr","http"],transformRequest:[function(e,t){const n=t.getContentType()||"",i=n.indexOf("application/json")>-1,s=j.isObject(e);if(s&&j.isHTMLForm(e)&&(e=new FormData(e)),j.isFormData(e))return i&&i?JSON.stringify(po(e)):e;if(j.isArrayBuffer(e)||j.isBuffer(e)||j.isStream(e)||j.isFile(e)||j.isBlob(e))return e;if(j.isArrayBufferView(e))return e.buffer;if(j.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(s){if(n.indexOf("application/x-www-form-urlencoded")>-1)return Nu(e,this.formSerializer).toString();if((a=j.isFileList(e))||n.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return Qn(a?{"files[]":e}:e,c&&new c,this.formSerializer)}}return s||i?(t.setContentType("application/json",!1),ju(e)):e}],transformResponse:[function(e){const t=this.transitional||qn.transitional,n=t&&t.forcedJSONParsing,i=this.responseType==="json";if(e&&j.isString(e)&&(n&&!this.responseType||i)){const o=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e)}catch(a){if(o)throw a.name==="SyntaxError"?ae.from(a,ae.ERR_BAD_RESPONSE,this,null,this.response):a}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:it.classes.FormData,Blob:it.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};j.forEach(["delete","get","head"],function(e){qn.headers[e]={}});j.forEach(["post","put","patch"],function(e){qn.headers[e]=j.merge(Bu)});const ni=qn,Lu=j.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Du=r=>{const e={};let t,n,i;return r&&r.split(`
`).forEach(function(o){i=o.indexOf(":"),t=o.substring(0,i).trim().toLowerCase(),n=o.substring(i+1).trim(),!(!t||e[t]&&Lu[t])&&(t==="set-cookie"?e[t]?e[t].push(n):e[t]=[n]:e[t]=e[t]?e[t]+", "+n:n)}),e},as=Symbol("internals");function Xt(r){return r&&String(r).trim().toLowerCase()}function Pn(r){return r===!1||r==null?r:j.isArray(r)?r.map(Pn):String(r)}function Uu(r){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=t.exec(r);)e[n[1]]=n[2];return e}const Fu=r=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(r.trim());function dr(r,e,t,n,i){if(j.isFunction(n))return n.call(this,e,t);if(i&&(e=t),!!j.isString(e)){if(j.isString(n))return e.indexOf(n)!==-1;if(j.isRegExp(n))return n.test(e)}}function Mu(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,n)=>t.toUpperCase()+n)}function Ku(r,e){const t=j.toCamelCase(" "+e);["get","set","has"].forEach(n=>{Object.defineProperty(r,n+t,{value:function(i,s,o){return this[n].call(this,e,i,s,o)},configurable:!0})})}class Xn{constructor(e){e&&this.set(e)}set(e,t,n){const i=this;function s(a,c,u){const l=Xt(c);if(!l)throw new Error("header name must be a non-empty string");const f=j.findKey(i,l);(!f||i[f]===void 0||u===!0||u===void 0&&i[f]!==!1)&&(i[f||c]=Pn(a))}const o=(a,c)=>j.forEach(a,(u,l)=>s(u,l,c));return j.isPlainObject(e)||e instanceof this.constructor?o(e,t):j.isString(e)&&(e=e.trim())&&!Fu(e)?o(Du(e),t):e!=null&&s(t,e,n),this}get(e,t){if(e=Xt(e),e){const n=j.findKey(this,e);if(n){const i=this[n];if(!t)return i;if(t===!0)return Uu(i);if(j.isFunction(t))return t.call(this,i,n);if(j.isRegExp(t))return t.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Xt(e),e){const n=j.findKey(this,e);return!!(n&&this[n]!==void 0&&(!t||dr(this,this[n],n,t)))}return!1}delete(e,t){const n=this;let i=!1;function s(o){if(o=Xt(o),o){const a=j.findKey(n,o);a&&(!t||dr(n,n[a],a,t))&&(delete n[a],i=!0)}}return j.isArray(e)?e.forEach(s):s(e),i}clear(e){const t=Object.keys(this);let n=t.length,i=!1;for(;n--;){const s=t[n];(!e||dr(this,this[s],s,e,!0))&&(delete this[s],i=!0)}return i}normalize(e){const t=this,n={};return j.forEach(this,(i,s)=>{const o=j.findKey(n,s);if(o){t[o]=Pn(i),delete t[s];return}const a=e?Mu(s):String(s).trim();a!==s&&delete t[s],t[a]=Pn(i),n[a]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return j.forEach(this,(n,i)=>{n!=null&&n!==!1&&(t[i]=e&&j.isArray(n)?n.join(", "):n)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const n=new this(e);return t.forEach(i=>n.set(i)),n}static accessor(e){const n=(this[as]=this[as]={accessors:{}}).accessors,i=this.prototype;function s(o){const a=Xt(o);n[a]||(Ku(i,o),n[a]=!0)}return j.isArray(e)?e.forEach(s):s(e),this}}Xn.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);j.freezeMethods(Xn.prototype);j.freezeMethods(Xn);const ft=Xn;function pr(r,e){const t=this||ni,n=e||t,i=ft.from(n.headers);let s=n.data;return j.forEach(r,function(a){s=a.call(t,s,i.normalize(),e?e.status:void 0)}),i.normalize(),s}function yo(r){return!!(r&&r.__CANCEL__)}function fn(r,e,t){ae.call(this,r==null?"canceled":r,ae.ERR_CANCELED,e,t),this.name="CanceledError"}j.inherits(fn,ae,{__CANCEL__:!0});function Wu(r,e,t){const n=t.config.validateStatus;!t.status||!n||n(t.status)?r(t):e(new ae("Request failed with status code "+t.status,[ae.ERR_BAD_REQUEST,ae.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}const zu=it.isStandardBrowserEnv?function(){return{write:function(t,n,i,s,o,a){const c=[];c.push(t+"="+encodeURIComponent(n)),j.isNumber(i)&&c.push("expires="+new Date(i).toGMTString()),j.isString(s)&&c.push("path="+s),j.isString(o)&&c.push("domain="+o),a===!0&&c.push("secure"),document.cookie=c.join("; ")},read:function(t){const n=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return n?decodeURIComponent(n[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}();function Vu(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function Hu(r,e){return e?r.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):r}function mo(r,e){return r&&!Vu(e)?Hu(r,e):e}const Ju=it.isStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a");let n;function i(s){let o=s;return e&&(t.setAttribute("href",o),o=t.href),t.setAttribute("href",o),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:t.pathname.charAt(0)==="/"?t.pathname:"/"+t.pathname}}return n=i(window.location.href),function(o){const a=j.isString(o)?i(o):o;return a.protocol===n.protocol&&a.host===n.host}}():function(){return function(){return!0}}();function Yu(r){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return e&&e[1]||""}function Gu(r,e){r=r||10;const t=new Array(r),n=new Array(r);let i=0,s=0,o;return e=e!==void 0?e:1e3,function(c){const u=Date.now(),l=n[s];o||(o=u),t[i]=c,n[i]=u;let f=s,m=0;for(;f!==i;)m+=t[f++],f=f%r;if(i=(i+1)%r,i===s&&(s=(s+1)%r),u-o<e)return;const d=l&&u-l;return d?Math.round(m*1e3/d):void 0}}function cs(r,e){let t=0;const n=Gu(50,250);return i=>{const s=i.loaded,o=i.lengthComputable?i.total:void 0,a=s-t,c=n(a),u=s<=o;t=s;const l={loaded:s,total:o,progress:o?s/o:void 0,bytes:a,rate:c||void 0,estimated:c&&o&&u?(o-s)/c:void 0,event:i};l[e?"download":"upload"]=!0,r(l)}}const Qu=typeof XMLHttpRequest!="undefined",qu=Qu&&function(r){return new Promise(function(t,n){let i=r.data;const s=ft.from(r.headers).normalize(),o=r.responseType;let a;function c(){r.cancelToken&&r.cancelToken.unsubscribe(a),r.signal&&r.signal.removeEventListener("abort",a)}j.isFormData(i)&&(it.isStandardBrowserEnv||it.isStandardBrowserWebWorkerEnv?s.setContentType(!1):s.setContentType("multipart/form-data;",!1));let u=new XMLHttpRequest;if(r.auth){const d=r.auth.username||"",y=r.auth.password?unescape(encodeURIComponent(r.auth.password)):"";s.set("Authorization","Basic "+btoa(d+":"+y))}const l=mo(r.baseURL,r.url);u.open(r.method.toUpperCase(),fo(l,r.params,r.paramsSerializer),!0),u.timeout=r.timeout;function f(){if(!u)return;const d=ft.from("getAllResponseHeaders"in u&&u.getAllResponseHeaders()),v={data:!o||o==="text"||o==="json"?u.responseText:u.response,status:u.status,statusText:u.statusText,headers:d,config:r,request:u};Wu(function(O){t(O),c()},function(O){n(O),c()},v),u=null}if("onloadend"in u?u.onloadend=f:u.onreadystatechange=function(){!u||u.readyState!==4||u.status===0&&!(u.responseURL&&u.responseURL.indexOf("file:")===0)||setTimeout(f)},u.onabort=function(){!u||(n(new ae("Request aborted",ae.ECONNABORTED,r,u)),u=null)},u.onerror=function(){n(new ae("Network Error",ae.ERR_NETWORK,r,u)),u=null},u.ontimeout=function(){let y=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const v=r.transitional||ho;r.timeoutErrorMessage&&(y=r.timeoutErrorMessage),n(new ae(y,v.clarifyTimeoutError?ae.ETIMEDOUT:ae.ECONNABORTED,r,u)),u=null},it.isStandardBrowserEnv){const d=(r.withCredentials||Ju(l))&&r.xsrfCookieName&&zu.read(r.xsrfCookieName);d&&s.set(r.xsrfHeaderName,d)}i===void 0&&s.setContentType(null),"setRequestHeader"in u&&j.forEach(s.toJSON(),function(y,v){u.setRequestHeader(v,y)}),j.isUndefined(r.withCredentials)||(u.withCredentials=!!r.withCredentials),o&&o!=="json"&&(u.responseType=r.responseType),typeof r.onDownloadProgress=="function"&&u.addEventListener("progress",cs(r.onDownloadProgress,!0)),typeof r.onUploadProgress=="function"&&u.upload&&u.upload.addEventListener("progress",cs(r.onUploadProgress)),(r.cancelToken||r.signal)&&(a=d=>{!u||(n(!d||d.type?new fn(null,r,u):d),u.abort(),u=null)},r.cancelToken&&r.cancelToken.subscribe(a),r.signal&&(r.signal.aborted?a():r.signal.addEventListener("abort",a)));const m=Yu(l);if(m&&it.protocols.indexOf(m)===-1){n(new ae("Unsupported protocol "+m+":",ae.ERR_BAD_REQUEST,r));return}u.send(i||null)})},In={http:Eu,xhr:qu};j.forEach(In,(r,e)=>{if(r){try{Object.defineProperty(r,"name",{value:e})}catch(t){}Object.defineProperty(r,"adapterName",{value:e})}});const Xu={getAdapter:r=>{r=j.isArray(r)?r:[r];const{length:e}=r;let t,n;for(let i=0;i<e&&(t=r[i],!(n=j.isString(t)?In[t.toLowerCase()]:t));i++);if(!n)throw n===!1?new ae(`Adapter ${t} is not supported by the environment`,"ERR_NOT_SUPPORT"):new Error(j.hasOwnProp(In,t)?`Adapter '${t}' is not available in the build`:`Unknown adapter '${t}'`);if(!j.isFunction(n))throw new TypeError("adapter is not a function");return n},adapters:In};function yr(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new fn(null,r)}function us(r){return yr(r),r.headers=ft.from(r.headers),r.data=pr.call(r,r.transformRequest),["post","put","patch"].indexOf(r.method)!==-1&&r.headers.setContentType("application/x-www-form-urlencoded",!1),Xu.getAdapter(r.adapter||ni.adapter)(r).then(function(n){return yr(r),n.data=pr.call(r,r.transformResponse,n),n.headers=ft.from(n.headers),n},function(n){return yo(n)||(yr(r),n&&n.response&&(n.response.data=pr.call(r,r.transformResponse,n.response),n.response.headers=ft.from(n.response.headers))),Promise.reject(n)})}const ls=r=>r instanceof ft?r.toJSON():r;function Vt(r,e){e=e||{};const t={};function n(u,l,f){return j.isPlainObject(u)&&j.isPlainObject(l)?j.merge.call({caseless:f},u,l):j.isPlainObject(l)?j.merge({},l):j.isArray(l)?l.slice():l}function i(u,l,f){if(j.isUndefined(l)){if(!j.isUndefined(u))return n(void 0,u,f)}else return n(u,l,f)}function s(u,l){if(!j.isUndefined(l))return n(void 0,l)}function o(u,l){if(j.isUndefined(l)){if(!j.isUndefined(u))return n(void 0,u)}else return n(void 0,l)}function a(u,l,f){if(f in e)return n(u,l);if(f in r)return n(void 0,u)}const c={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(u,l)=>i(ls(u),ls(l),!0)};return j.forEach(Object.keys(Object.assign({},r,e)),function(l){const f=c[l]||i,m=f(r[l],e[l],l);j.isUndefined(m)&&f!==a||(t[l]=m)}),t}const go="1.4.0",ri={};["object","boolean","number","function","string","symbol"].forEach((r,e)=>{ri[r]=function(n){return typeof n===r||"a"+(e<1?"n ":" ")+r}});const fs={};ri.transitional=function(e,t,n){function i(s,o){return"[Axios v"+go+"] Transitional option '"+s+"'"+o+(n?". "+n:"")}return(s,o,a)=>{if(e===!1)throw new ae(i(o," has been removed"+(t?" in "+t:"")),ae.ERR_DEPRECATED);return t&&!fs[o]&&(fs[o]=!0,console.warn(i(o," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(s,o,a):!0}};function Zu(r,e,t){if(typeof r!="object")throw new ae("options must be an object",ae.ERR_BAD_OPTION_VALUE);const n=Object.keys(r);let i=n.length;for(;i-- >0;){const s=n[i],o=e[s];if(o){const a=r[s],c=a===void 0||o(a,s,r);if(c!==!0)throw new ae("option "+s+" must be "+c,ae.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new ae("Unknown option "+s,ae.ERR_BAD_OPTION)}}const Lr={assertOptions:Zu,validators:ri},yt=Lr.validators;class Dn{constructor(e){this.defaults=e,this.interceptors={request:new os,response:new os}}request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=Vt(this.defaults,t);const{transitional:n,paramsSerializer:i,headers:s}=t;n!==void 0&&Lr.assertOptions(n,{silentJSONParsing:yt.transitional(yt.boolean),forcedJSONParsing:yt.transitional(yt.boolean),clarifyTimeoutError:yt.transitional(yt.boolean)},!1),i!=null&&(j.isFunction(i)?t.paramsSerializer={serialize:i}:Lr.assertOptions(i,{encode:yt.function,serialize:yt.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o;o=s&&j.merge(s.common,s[t.method]),o&&j.forEach(["delete","get","head","post","put","patch","common"],y=>{delete s[y]}),t.headers=ft.concat(o,s);const a=[];let c=!0;this.interceptors.request.forEach(function(v){typeof v.runWhen=="function"&&v.runWhen(t)===!1||(c=c&&v.synchronous,a.unshift(v.fulfilled,v.rejected))});const u=[];this.interceptors.response.forEach(function(v){u.push(v.fulfilled,v.rejected)});let l,f=0,m;if(!c){const y=[us.bind(this),void 0];for(y.unshift.apply(y,a),y.push.apply(y,u),m=y.length,l=Promise.resolve(t);f<m;)l=l.then(y[f++],y[f++]);return l}m=a.length;let d=t;for(f=0;f<m;){const y=a[f++],v=a[f++];try{d=y(d)}catch(A){v.call(this,A);break}}try{l=us.call(this,d)}catch(y){return Promise.reject(y)}for(f=0,m=u.length;f<m;)l=l.then(u[f++],u[f++]);return l}getUri(e){e=Vt(this.defaults,e);const t=mo(e.baseURL,e.url);return fo(t,e.params,e.paramsSerializer)}}j.forEach(["delete","get","head","options"],function(e){Dn.prototype[e]=function(t,n){return this.request(Vt(n||{},{method:e,url:t,data:(n||{}).data}))}});j.forEach(["post","put","patch"],function(e){function t(n){return function(s,o,a){return this.request(Vt(a||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:s,data:o}))}}Dn.prototype[e]=t(),Dn.prototype[e+"Form"]=t(!0)});const Rn=Dn;class ii{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(s){t=s});const n=this;this.promise.then(i=>{if(!n._listeners)return;let s=n._listeners.length;for(;s-- >0;)n._listeners[s](i);n._listeners=null}),this.promise.then=i=>{let s;const o=new Promise(a=>{n.subscribe(a),s=a}).then(i);return o.cancel=function(){n.unsubscribe(s)},o},e(function(s,o,a){n.reason||(n.reason=new fn(s,o,a),t(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}static source(){let e;return{token:new ii(function(i){e=i}),cancel:e}}}const el=ii;function tl(r){return function(t){return r.apply(null,t)}}function nl(r){return j.isObject(r)&&r.isAxiosError===!0}const Dr={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Dr).forEach(([r,e])=>{Dr[e]=r});const rl=Dr;function vo(r){const e=new Rn(r),t=Zs(Rn.prototype.request,e);return j.extend(t,Rn.prototype,e,{allOwnKeys:!0}),j.extend(t,e,null,{allOwnKeys:!0}),t.create=function(i){return vo(Vt(r,i))},t}const ke=vo(ni);ke.Axios=Rn;ke.CanceledError=fn;ke.CancelToken=el;ke.isCancel=yo;ke.VERSION=go;ke.toFormData=Qn;ke.AxiosError=ae;ke.Cancel=ke.CanceledError;ke.all=function(e){return Promise.all(e)};ke.spread=tl;ke.isAxiosError=nl;ke.mergeConfig=Vt;ke.AxiosHeaders=ft;ke.formToJSON=r=>po(j.isHTMLForm(r)?new FormData(r):r);ke.HttpStatusCode=rl;ke.default=ke;const il=ke,hs={init:({API_KEY:r})=>(...s)=>I(void 0,[...s],function*(e="post",t="/",n={},i={}){var f,m,d,y;const o=localStorage.getItem("accessToken");let a={Accept:"application/json","Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Key":r,"Access-Control-Allow-Methods":"POST, GET, OPTIONS, PUT, DELETE, HEAD,PATCH","Access-Control-Allow-Headers":"X-PINGOTHER, Origin, X-Requested-With, Content-Type, Accept","Access-Control-Max-Age":"1728000"};o&&(a.Authorization="Bearer "+o);const c=t;typeof(n==null?void 0:n.get)=="function"&&(n==null?void 0:n.get("file"))&&(a["Content-Type"]="multipart/form-data"),i!=null&&i.headers&&(a=Object.assign(...a,...i.headers),delete i.headers);const u=Object.assign({mode:"cors",method:e,url:c,data:n,headers:a},i);let l={};try{const v=yield il(u);l.data=((f=v==null?void 0:v.data)==null?void 0:f.data)||(v==null?void 0:v.data),l.data||(l.data={})}catch(v){l.error=((d=(m=v.response)==null?void 0:m.data)==null?void 0:d.error)||((y=v.response)==null?void 0:y.error),l.error||(l.error={})}return l})};let wn;const sl=new Uint8Array(16);function ol(){if(!wn&&(wn=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!wn))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return wn(sl)}const Re=[];for(let r=0;r<256;++r)Re.push((r+256).toString(16).slice(1));function al(r,e=0){return(Re[r[e+0]]+Re[r[e+1]]+Re[r[e+2]]+Re[r[e+3]]+"-"+Re[r[e+4]]+Re[r[e+5]]+"-"+Re[r[e+6]]+Re[r[e+7]]+"-"+Re[r[e+8]]+Re[r[e+9]]+"-"+Re[r[e+10]]+Re[r[e+11]]+Re[r[e+12]]+Re[r[e+13]]+Re[r[e+14]]+Re[r[e+15]]).toLowerCase()}const cl=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ds={randomUUID:cl};function mr(r,e,t){if(ds.randomUUID&&!e&&!r)return ds.randomUUID();r=r||{};const n=r.random||(r.rng||ol)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){t=t||0;for(let i=0;i<16;++i)e[t+i]=n[i];return e}return al(n)}var wo={exports:{}};(function(r){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function i(c,u,l){this.fn=c,this.context=u,this.once=l||!1}function s(c,u,l,f,m){if(typeof l!="function")throw new TypeError("The listener must be a function");var d=new i(l,f||c,m),y=t?t+u:u;return c._events[y]?c._events[y].fn?c._events[y]=[c._events[y],d]:c._events[y].push(d):(c._events[y]=d,c._eventsCount++),c}function o(c,u){--c._eventsCount===0?c._events=new n:delete c._events[u]}function a(){this._events=new n,this._eventsCount=0}a.prototype.eventNames=function(){var u=[],l,f;if(this._eventsCount===0)return u;for(f in l=this._events)e.call(l,f)&&u.push(t?f.slice(1):f);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(l)):u},a.prototype.listeners=function(u){var l=t?t+u:u,f=this._events[l];if(!f)return[];if(f.fn)return[f.fn];for(var m=0,d=f.length,y=new Array(d);m<d;m++)y[m]=f[m].fn;return y},a.prototype.listenerCount=function(u){var l=t?t+u:u,f=this._events[l];return f?f.fn?1:f.length:0},a.prototype.emit=function(u,l,f,m,d,y){var v=t?t+u:u;if(!this._events[v])return!1;var A=this._events[v],O=arguments.length,C,R;if(A.fn){switch(A.once&&this.removeListener(u,A.fn,void 0,!0),O){case 1:return A.fn.call(A.context),!0;case 2:return A.fn.call(A.context,l),!0;case 3:return A.fn.call(A.context,l,f),!0;case 4:return A.fn.call(A.context,l,f,m),!0;case 5:return A.fn.call(A.context,l,f,m,d),!0;case 6:return A.fn.call(A.context,l,f,m,d,y),!0}for(R=1,C=new Array(O-1);R<O;R++)C[R-1]=arguments[R];A.fn.apply(A.context,C)}else{var U=A.length,z;for(R=0;R<U;R++)switch(A[R].once&&this.removeListener(u,A[R].fn,void 0,!0),O){case 1:A[R].fn.call(A[R].context);break;case 2:A[R].fn.call(A[R].context,l);break;case 3:A[R].fn.call(A[R].context,l,f);break;case 4:A[R].fn.call(A[R].context,l,f,m);break;default:if(!C)for(z=1,C=new Array(O-1);z<O;z++)C[z-1]=arguments[z];A[R].fn.apply(A[R].context,C)}}return!0},a.prototype.on=function(u,l,f){return s(this,u,l,f,!1)},a.prototype.once=function(u,l,f){return s(this,u,l,f,!0)},a.prototype.removeListener=function(u,l,f,m){var d=t?t+u:u;if(!this._events[d])return this;if(!l)return o(this,d),this;var y=this._events[d];if(y.fn)y.fn===l&&(!m||y.once)&&(!f||y.context===f)&&o(this,d);else{for(var v=0,A=[],O=y.length;v<O;v++)(y[v].fn!==l||m&&!y[v].once||f&&y[v].context!==f)&&A.push(y[v]);A.length?this._events[d]=A.length===1?A[0]:A:o(this,d)}return this},a.prototype.removeAllListeners=function(u){var l;return u?(l=t?t+u:u,this._events[l]&&o(this,l)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,r.exports=a})(wo);const ul=wo.exports;var ll={exports:{}};(function(r,e){(function(t){var n=this,i=Object.prototype.hasOwnProperty,s=function(c){for(var u=new Array(c.length),l=c.length,f=l-1;l--;)u[f-l]=c[l];return u},o=function(){var c=Array.prototype.slice.call(arguments);return c.length==2?o.find.apply(this,c):o.transform.apply(this,c)};o.find=function(c,u){return o.get(u,c)},o.memoizePath=!0;var a={};o.get=function(c,u,l){if(c===t||c===null||u===t||u===null)return l;var f;for(typeof u=="string"?o.memoizePath?a[u]?f=a[u].slice(0):(f=u.split(".").reverse(),a[u]=f.slice(0)):f=u.split(".").reverse():Array.isArray(u)&&(f=s(u));f.length&&(c=c[f.pop()])!==t&&c!==null;);return c===null&&f.length&&(c=t),c===t?l:c},o.exists=function(c,u){return o.get(c,u)!==t},o.set=function(c,u,l,f){var m=Array.isArray(u)?u:u.split("."),d=c,y,v=m.length;if(typeof d!="object")throw new Error("Parent is not an object.");for(var A=0;A<v;A++)if(y=m[A],(!i.call(d,y)||d[y]===t||(typeof d[y]!="object"||d[y]===null)&&f&&f.force===!0)&&(d[y]={}),A==v-1)d[y]=l;else{if(typeof d[y]!="object"||d[y]===null)throw new Error('Target key "'+y+'" is not suitable for a nested value. (It is in use as non-object. Set `force` to `true` to override.)');d=d[y]}d[y]=l},o.default=function(c,u,l){o.get(c,u)===t&&o.set(c,u,l)},o.transform=function(u,l){if(Array.isArray(u))return u.map(function(z){return o.transform(z,l)});l=l||{},l.delimiter=l.delimiter||".";var f,m,d,y,v={},A,O=Object.keys(u),C=O.length,R;for(R=0;R<C;R++)if(A=O[R],A.indexOf(l.delimiter)!==-1){f=A.split(l.delimiter),m=f.length,y=v;for(var U=0;U<m&&(d=f[U],U!=m-1&&!y.hasOwnProperty(d)&&(y[d]={}),U==m-1&&(y[d]=u[A]),y=y[d],y!==null);U++);}else v[A]=u[A];return v},o.flatten=function(c,u){typeof u=="undefined"&&(u=".");var l={},f,m;for(var d in c)if(i.call(c,d))if(f=c[d],Object.prototype.toString.call(f)==="[object Object]"){m=o.flatten(f,u);for(var y in m)l[d+u+y]=m[y]}else l[d]=f;return l},o.paths=function(c,u){var l=[],f,m;if(u=u||[],typeof c=="object")for(m in c)f=c[m],typeof f=="object"&&f!==null?l=l.concat(o.paths(f,u.concat([m]))):l.push(u.concat(m).join("."));else throw new Error("Paths was called with non-object argument.");return l},r.exports?r.exports=o:(n.Dottie=o,n.Dot=o,typeof t=="function"&&t([],function(){return o}))})()})(ll);function gr(r,e){try{r(e)}catch(t){console.error("Error in subscription callback",t)}}const mt=Symbol("subscriptions"),gt=Symbol("oneTimeEvents");class Ht{constructor(){this[mt]=[],this[gt]=new Map}on(e,t){return this[gt].has(e)?gr(t,this[gt].get(e)):(this[mt].push({event:e,callback:t,once:!1}),this)}off(e,t){return this[mt]=this[mt].filter(n=>n.event!==e||t&&n.callback!==t),this}once(e,t){return new Promise(n=>{const i=s=>{n(s),t==null||t(s)};this[gt].has(e)?gr(i,this[gt].get(e)):this[mt].push({event:e,callback:i,once:!0})})}emit(e,t){if(this[gt].has(e))throw new Error(`Event "${e}" was supposed to be emitted only once`);for(let n=0;n<this[mt].length;n++){const i=this[mt][n];i.event===e&&(gr(i.callback,t),i.once&&(this[mt].splice(n,1),n--))}return this}emitOnce(e,t){if(this[gt].has(e))throw new Error(`Event "${e}" was supposed to be emitted only once`);return this.emit(e,t),this[gt].set(e,t),this.off(e),this}pipe(e,t){this.on(e,n=>{t.emit(e,n)})}pipeOnce(e,t){this.once(e,n=>{t.emitOnce(e,n)})}}function vt(r){return r=r.replace(/\[/g,"/[").replace(/^\/+/,"").replace(/\/+$/,""),r.length===0?[]:r.split("/").map(t=>t.startsWith("[")?parseInt(t.slice(1,-1)):t)}class ${static get(e){return new $(e)}static getChildPath(e,t){return $.get(e).child(t).path}static getPathKeys(e){return vt(e)}constructor(e){typeof e=="string"?this.keys=vt(e):e instanceof Array&&(this.keys=e),this.path=this.keys.reduce((t,n,i)=>i===0?`${n}`:typeof n=="string"?`${t}/${n}`:`${t}[${n}]`,"")}get key(){return this.keys.length===0?null:this.keys.slice(-1)[0]}get parent(){if(this.keys.length==0)return null;const e=this.keys.slice(0,-1);return new $(e)}get parentPath(){return this.keys.length===0?null:this.parent.path}child(e){if(typeof e=="string"){if(e.length===0)throw new Error(`child key for path "${this.path}" cannot be empty`);const t=vt(e);t.forEach(n=>{if(typeof n=="string"){if(/[\x00-\x08\x0b\x0c\x0e-\x1f/[\]\\]/.test(n))throw new Error(`Invalid child key "${n}" for path "${this.path}". Keys cannot contain control characters or any of the following characters: \\ / [ ]`);if(n.length>128)throw new Error(`child key "${n}" for path "${this.path}" is too long. Max key length is 128`);if(n.length===0)throw new Error(`child key for path "${this.path}" cannot be empty`)}}),e=t}return new $(this.keys.concat(e))}childPath(e){return this.child(e).path}get pathKeys(){return this.keys}static extractVariables(e,t){if(!e.includes("*")&&!e.includes("$"))return[];const n=vt(e),i=vt(t);let s=0;const o={get length(){return s}};return n.forEach((a,c)=>{const u=i[c];if(a==="*")o[s++]=u;else if(typeof a=="string"&&a[0]==="$"){o[s++]=u,o[a]=u;const l=a.slice(1);typeof o[l]=="undefined"&&(o[l]=u)}}),o}static fillVariables(e,t){if(e.indexOf("*")<0&&e.indexOf("$")<0)return e;const n=vt(e),i=vt(t),s=n.map((a,c)=>{if(a===i[c]||c>=i.length)return a;if(typeof a=="string"&&(a==="*"||a[0]==="$"))return i[c];throw new Error(`Path "${t}" cannot be used to fill variables of path "${e}" because they do not match`)});let o="";return s.forEach(a=>{typeof a=="number"?o+=`[${a}]`:(o.length>0&&(o+="/"),o+=a)}),o}static fillVariables2(e,t){if(typeof t!="object"||Object.keys(t).length===0)return e;const n=vt(e);let i=0;return n.reduce((o,a)=>typeof a=="string"&&(a==="*"||a.startsWith("$"))?$.getChildPath(o,t[i++]):$.getChildPath(o,a),"")}equals(e){const t=e instanceof $?e:new $(e);return this.path===t.path?!0:this.keys.length!==t.keys.length?!1:this.keys.every((n,i)=>{const s=t.keys[i];return s===n||typeof s=="string"&&(s==="*"||s[0]==="$")||typeof n=="string"&&(n==="*"||n[0]==="$")})}isAncestorOf(e){const t=e instanceof $?e:new $(e);return t.path===""||this.path===t.path?!1:this.path===""?!0:this.keys.length>=t.keys.length?!1:this.keys.every((n,i)=>{const s=t.keys[i];return s===n||typeof s=="string"&&(s==="*"||s[0]==="$")||typeof n=="string"&&(n==="*"||n[0]==="$")})}isDescendantOf(e){const t=e instanceof $?e:new $(e);return this.path===""||this.path===t.path?!1:e===""?!0:t.keys.length>=this.keys.length?!1:t.keys.every((n,i)=>{const s=this.keys[i];return s===n||typeof s=="string"&&(s==="*"||s[0]==="$")||typeof n=="string"&&(n==="*"||n[0]==="$")})}isOnTrailOf(e){const t=e instanceof $?e:new $(e);return this.path.length===0||t.path.length===0||this.path===t.path?!0:this.pathKeys.every((n,i)=>{if(i>=t.keys.length)return!0;const s=t.keys[i];return s===n||typeof s=="string"&&(s==="*"||s[0]==="$")||typeof n=="string"&&(n==="*"||n[0]==="$")})}isChildOf(e){const t=e instanceof $?e:new $(e);return this.path===""?!1:this.parent.equals(t)}isParentOf(e){const t=e instanceof $?e:new $(e);return t.path===""?!1:this.equals(t.parent)}}function vr(r,e,t=!1){if(!r.exists())return null;let n=t?r.previous():r.val();return typeof e=="number"?n[e]:($.getPathKeys(e).every(i=>(n=n[i],typeof n!="undefined")),n||null)}function wr(r){if(!r.exists())return[];const e=r.val();return e instanceof Array?new Array(e.length).map((t,n)=>n):typeof e=="object"?Object.keys(e):[]}class ye{exists(){return!1}constructor(e,t,n=!1,i,s){this.ref=e,this.val=()=>t,this.previous=()=>i,this.exists=()=>n?!1:t!==null&&typeof t!="undefined",this.context=()=>s||{}}static for(e,t){return new ye(e,t)}child(e){const t=vr(this,e,!1),n=vr(this,e,!0);return new ye(this.ref.child(e),t,!1,n)}hasChild(e){return vr(this,e)!==null}hasChildren(){return wr(this).length>0}numChildren(){return wr(this).length}forEach(e){const t=this.val(),n=this.previous();return wr(this).every(i=>{const s=new ye(this.ref.child(i),t[i],!1,n[i]);return e(s)})}get key(){return this.ref.key}}class Nn extends ye{constructor(e,t,n){super(e,t,!1,void 0,n),this.previous=()=>{throw new Error("Iterate values to get previous values for each mutation")},this.val=(i=!0)=>(i&&console.warn("Unless you know what you are doing, it is best not to use the value of a mutations snapshot directly. Use child methods and forEach to iterate the mutations instead"),t)}forEach(e){return this.val(!1).every(n=>{const i=n.target.reduce((o,a)=>o.child(a),this.ref),s=new ye(i,n.val,!1,n.prev);return e(s)})}child(e){if(typeof e!="number")throw new Error("child index must be a number");const t=this.val(!1)[e],n=t.target.reduce((i,s)=>i.child(s),this.ref);return new ye(n,t.val,!1,t.prev)}}class bo{constructor(e){this.stop=e,this._internal={state:"init",activatePromises:[]}}activated(e){return e&&(this._internal.activatePromises.push({callback:e}),this._internal.state==="active"?e(!0):this._internal.state==="canceled"&&e(!1,this._internal.cancelReason)),new Promise((t,n)=>{if(this._internal.state==="active")return t();if(this._internal.state==="canceled"&&!e)return n(new Error(this._internal.cancelReason));const i=()=>{};this._internal.activatePromises.push({resolve:t,reject:e?i:n})})}_setActivationState(e,t){for(this._internal.cancelReason=t,this._internal.state=e?"active":"canceled";this._internal.activatePromises.length>0;){const n=this._internal.activatePromises.shift();e?(n.callback&&n.callback(!0),n.resolve&&n.resolve()):(n.callback&&n.callback(!1,t),n.reject&&n.reject(t))}}}class fl{constructor(e,t,n){this.publish=e,this.start=t,this.cancel=n}}class hl{constructor(e){const t=[];let n,i;const s="stopped (no more subscribers)";this.subscribe=(f,m)=>{if(typeof f!="function")throw new TypeError("callback must be a function");if(i===s)throw new Error("stream can't be used anymore because all subscribers were stopped");const d={callback:f,activationCallback:function(y,v){m==null||m(y,v),this.subscription._setActivationState(y,v)},subscription:new bo(function(){return t.splice(t.indexOf(this),1),o()})};return t.push(d),typeof i!="undefined"&&(i===!0?(m==null||m(!0),d.subscription._setActivationState(!0)):typeof i=="string"&&(m==null||m(!1,i),d.subscription._setActivationState(!1,i))),d.subscription};const o=()=>{let f;return t.length===0&&(f=n==null?void 0:n(),i=s),Promise.resolve(f)};this.unsubscribe=f=>{(f?t.filter(d=>d.callback===f):t).forEach(d=>{const y=t.indexOf(d);t.splice(y,1)}),o()},this.stop=()=>{t.splice(0),o()};const a=f=>(t.forEach(m=>{try{m.callback(f)}catch(d){console.error(`Error running subscriber callback: ${d.message}`)}}),t.length===0&&o(),t.length>0),c=f=>{i=!0,n=f,t.forEach(m=>{var d;(d=m.activationCallback)==null||d.call(m,!0)})},u=f=>{i=f,t.forEach(m=>{var d;(d=m.activationCallback)==null||d.call(m,!1,f||new Error("unknown reason"))}),t.splice(0)},l=new fl(a,c,u);e(l)}}function si(r,e){const t="000000000"+r;return t.substr(t.length-e)}const dl=typeof window=="object"?window:self,pl=Object.keys(dl).length;var js,Ls;const yl=(Ls=(js=navigator.mimeTypes)==null?void 0:js.length)!=null?Ls:0,ml=si((yl+navigator.userAgent.length).toString(36)+pl.toString(36),4);function gl(){return ml}let Zt=0;const oi=4,Un=36,xo=Math.pow(Un,oi);function ps(){return si((Math.random()*xo<<0).toString(Un),oi)}function vl(){return Zt=Zt<xo?Zt:0,Zt++,Zt-1}function wl(r=0){const e="c",t=(new Date().getTime()+r).toString(Un),n=si(vl().toString(Un),oi),i=gl(),s=ps()+ps();return e+t+n+i+s}let ys=0;class Ne{static set timeBias(e){typeof e=="number"&&(ys=e)}static generate(){return wl(ys).slice(1)}}class me{constructor(e){this.path=e}}const Ye={nextTick(r){setTimeout(r,0)}};class Fn{constructor(e){if(e instanceof Array)for(let t=0;t<e.length;t++)typeof e[t]!="undefined"&&(this[t]=e[t]);else e&&Object.assign(this,e)}}function bl(r){const e=new Uint8Array(8);return new DataView(e.buffer).setFloat64(0,r),new Array(...e)}function xl(r){if((Array.isArray(r)?r.length:r.byteLength)!==8)throw new TypeError("must be 8 bytes");const t=new Uint8Array(r);return new DataView(t.buffer).getFloat64(0)}const bt={zero:BigInt(0),one:BigInt(1),two:BigInt(2),eight:BigInt(8),ff:BigInt(255)};function El(r){if(typeof r!="bigint")throw new Error("number must be a bigint");const e=[],t=r<bt.zero;do{const n=Number(r&bt.ff);e.push(n),r=r>>bt.eight}while(r!==(t?-bt.one:bt.zero));return e.reverse(),(t?e[0]<128:e[0]>=128)&&e.unshift(t?255:0),e}function kl(r){const e=r[0]>=128;let t=bt.zero;for(let n of r)e&&(n=~n&255),t=(t<<bt.eight)+BigInt(n);return e&&(t=-(t+bt.one)),t}function Al(r){if(typeof TextEncoder!="undefined")return new TextEncoder().encode(r);if(typeof Buffer=="function"){const e=Buffer.from(r,"utf-8");return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}else{const e=[];for(let t=0;t<r.length;t++){let n=r.charCodeAt(t);if(n>128){if((n&55296)===55296){const i=r.charCodeAt(t+1);if((i&56320)!==56320)throw new Error("follow-up utf-16 character does not start with 0xDC00");t++;const s=n&1023,o=i&1023;n=65536|s<<10|o}if(n<2048){const i=192|n>>6&31,s=128|n&63;e.push(i,s)}else if(n<65536){const i=224|n>>12&15,s=128|n>>6&63,o=128|n&63;e.push(i,s,o)}else if(n<2097152){const i=240|n>>18&7,s=128|n>>12&63,o=128|n>>6&63,a=128|n&63;e.push(i,s,o,a)}else throw new Error(`Cannot convert character ${r.charAt(t)} (code ${n}) to utf-8`)}else e.push(n<128?n:63)}return new Uint8Array(e)}}function Eo(r){if(typeof TextDecoder!="undefined"){const e=new TextDecoder;if(r instanceof Uint8Array)return e.decode(r);const t=Uint8Array.from(r);return e.decode(t)}else if(typeof Buffer=="function"){if(r instanceof Array&&(r=Uint8Array.from(r)),!(r instanceof Buffer)&&"buffer"in r&&r.buffer instanceof ArrayBuffer){const e=r;r=Buffer.from(e.buffer,e.byteOffset,e.byteLength)}if(!(r instanceof Buffer))throw new Error("Unsupported buffer argument");return r.toString("utf-8")}else{if(!(r instanceof Uint8Array)&&"buffer"in r&&r.buffer instanceof ArrayBuffer){const e=r;r=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}if(r instanceof Buffer||r instanceof Array||r instanceof Uint8Array){let e="";for(let t=0;t<r.length;t++){let n=r[t];if(n>128)if((n&240)===240){const i=n,s=r[t+1],o=r[t+2],a=r[t+3];n=(i&7)<<18|(s&63)<<12|(o&63)<<6|a&63,t+=3}else if((n&224)===224){const i=n,s=r[t+1],o=r[t+2];n=(i&15)<<12|(s&63)<<6|o&63,t+=2}else if((n&192)===192){const i=n,s=r[t+1];n=(i&31)<<6|s&63,t++}else throw new Error("invalid utf-8 data");if(n>=65536){n^=65536;const i=55296|n>>10,s=56320|n&1023;e+=String.fromCharCode(i),e+=String.fromCharCode(s)}else e+=String.fromCharCode(n)}return e}else throw new Error("Unsupported buffer argument")}}function Sl(r,e){const t=new r.constructor(r.length+e.length);return t.set(r),t.set(e,r.length),t}function et(r,e){var s;if(((s=r==null?void 0:r.constructor)==null?void 0:s.name)==="DataSnapshot")throw new TypeError(`Object to clone is a DataSnapshot (path "${r.ref.path}")`);const t=o=>(o!==null&&typeof o=="object"&&typeof o.constructor=="function"&&typeof o.constructor.name=="string"&&["Buffer","Uint8Array","Int8Array","Uint16Array","Int16Array","Uint32Array","Int32Array","BigUint64Array","BigInt64Array"].includes(o.constructor.name)&&(o=o.buffer.slice(o.byteOffset,o.byteOffset+o.byteLength)),o);if(r=t(r),typeof r!="object"||r===null||r instanceof Date||r instanceof ArrayBuffer||r instanceof me||r instanceof RegExp)return r;const n=o=>{if(e.indexOf(o)>=0)throw new ReferenceError("object contains a circular reference");return o=t(o),o===null||o instanceof Date||o instanceof ArrayBuffer||o instanceof me||o instanceof RegExp||typeof o=="object"&&(e.push(o),o=et(o,e),e.pop()),o};typeof e=="undefined"&&(e=[r]);const i=r instanceof Array?[]:r instanceof Fn?new Fn:{};return Object.keys(r).forEach(o=>{const a=r[o];typeof a!="function"&&(i[o]=n(a))}),i}const Et=r=>typeof r=="object"&&["ArrayBuffer","Buffer","Uint8Array","Uint16Array","Uint32Array","Int8Array","Int16Array","Int32Array"].includes(r.constructor.name);function Mn(r,e){if(r===e)return!0;if(typeof r!=typeof e)return!1;if(typeof r=="object"||typeof e=="object"){if(r===null||e===null)return!1;if(r instanceof me||e instanceof me)return r instanceof me&&e instanceof me&&r.path===e.path;if(r instanceof Date||e instanceof Date)return r instanceof Date&&e instanceof Date&&r.getTime()===e.getTime();if(r instanceof Array||e instanceof Array)return r instanceof Array&&e instanceof Array&&r.length===e.length&&r.every((i,s)=>Mn(r[s],e[s]));if(Et(r)||Et(e)){if(!Et(r)||!Et(e)||r.byteLength===e.byteLength)return!1;const i=r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r.buffer,r.byteOffset,r.byteLength),s=e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength);return i.every((o,a)=>s[a]===o)}const t=Object.keys(r),n=Object.keys(e);return t.length===n.length&&t.every(i=>n.includes(i))&&t.every(i=>Mn(r[i],e[i]))}return!1}class ko{constructor(e,t,n){this.added=e,this.removed=t,this.changed=n}forChild(e){if(this.added.includes(e))return"added";if(this.removed.includes(e))return"removed";const t=this.changed.find(n=>n.key===e);return t?t.change:"identical"}}function ai(r,e,t=!1){const n=[void 0,null];if(r===e)return"identical";if(n.indexOf(r)>=0&&n.indexOf(e)<0)return"added";if(n.indexOf(r)<0&&n.indexOf(e)>=0)return"removed";if(typeof r!=typeof e)return"changed";if(Et(r)||Et(e)){if(!Et(r)||!Et(e))return"changed";const i=r instanceof Uint8Array?r:r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r.buffer,r.byteOffset,r.byteLength),s=e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength);return i.byteLength===s.byteLength&&i.every((o,a)=>s[a]===o)?"identical":"changed"}else{if(r instanceof Date||e instanceof Date)return r instanceof Date&&e instanceof Date&&r.getTime()===e.getTime()?"identical":"changed";if(r instanceof me||e instanceof me)return r instanceof me&&e instanceof me&&r.path===e.path?"identical":"changed";if(typeof r=="object"){const i=r instanceof Array,s=f=>{let m=Object.keys(f).filter(d=>!n.includes(f[d]));return i&&(m=m.map(d=>parseInt(d))),m},o=s(r),a=s(e),c=o.filter(f=>!a.includes(f)),u=a.filter(f=>!o.includes(f)),l=a.reduce((f,m)=>{if(o.includes(m)){const d=r[m],y=e[m],v=ai(d,y);v!=="identical"&&f.push({key:m,change:v})}return f},[]);return u.length===0&&c.length===0&&l.length===0?"identical":new ko(u,c,t?l.sort((f,m)=>f.key<m.key?-1:1):l)}}return"changed"}function Ao(r,e,t=!1){const n=(s,o,a,c)=>{switch(o){case"identical":return[];case"changed":return[{target:s,prev:a,val:c}];case"added":return[{target:s,prev:null,val:c}];case"removed":return[{target:s,prev:a,val:null}];default:{let u=[];return o.added.forEach(l=>u.push({target:s.concat(l),prev:null,val:c[l]})),o.removed.forEach(l=>u.push({target:s.concat(l),prev:a[l],val:null})),o.changed.forEach(l=>{const f=n(s.concat(l.key),l.change,a[l.key],c[l.key]);u=u.concat(f)}),u}}},i=ai(r,e,t);return n([],i,r,e)}function _l(r,e,t){return e=e===null?null:e[r],typeof e=="undefined"&&(e=null),t=t===null?null:t[r],typeof t=="undefined"&&(t=null),{oldValue:e,newValue:t}}function Tl(r){Ye.nextTick(r)}function So(){var r;return typeof globalThis!="undefined"?globalThis:typeof global!="undefined"?global:typeof window!="undefined"?window:typeof self!="undefined"?self:(r=function(){return this}())!=null?r:Function("return this")()}const _o=Object.freeze(Object.defineProperty({__proto__:null,numberToBytes:bl,bytesToNumber:xl,bigintToBytes:El,bytesToBigint:kl,encodeString:Al,decodeString:Eo,concatTypedArrays:Sl,cloneObject:et,valuesAreEqual:Mn,ObjectDifferences:ko,compareValues:ai,getMutations:Ao,getChildValues:_l,defer:Tl,getGlobalObject:So},Symbol.toStringTag,{value:"Module"})),Ol="modulepreload",Pl=function(r){return"/"+r},ms={},Il=function(e,t,n){if(!t||t.length===0)return e();const i=document.getElementsByTagName("link");return Promise.all(t.map(s=>{if(s=Pl(s),s in ms)return;ms[s]=!0;const o=s.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!n)for(let l=i.length-1;l>=0;l--){const f=i[l];if(f.href===s&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${a}`))return;const u=document.createElement("link");if(u.rel=o?"stylesheet":Ol,o||(u.as="script",u.crossOrigin=""),u.href=s,document.head.appendChild(u),o)return new Promise((l,f)=>{u.addEventListener("load",l),u.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e())};let To=!1,kt;I(void 0,null,function*(){const r=So();if(typeof r.Observable!="undefined"){kt=r.Observable;return}try{const{Observable:e}=yield Il(()=>Promise.resolve().then(()=>Pp),void 0);kt=e}catch(e){kt=ui}});function ci(){if(kt===ui&&!To&&console.warn(`Using AceBase's simple Observable implementation because rxjs is not available. Add it to your project with "npm install rxjs", add it to AceBase using db.setObservable(Observable), or call db.setObservable("shim") to suppress this warning`),kt)return kt;throw new Error("RxJS Observable could not be loaded. ")}function Rl(r){r==="shim"?(kt=ui,To=!0):kt=r}class ui{constructor(e){this._active=!1,this._subscribers=[],this._create=e}subscribe(e){if(!this._active){const s={next:o=>{this._subscribers.forEach(a=>{try{a(o)}catch(c){console.error("Error in subscriber callback:",c)}})}};this._cleanup=this._create(s),this._active=!0}return this._subscribers.push(e),{unsubscribe:()=>{this._subscribers.splice(this._subscribers.indexOf(e),1),this._subscribers.length===0&&(this._active=!1,this._cleanup())}}}}class ze extends Array{static areEqual(e,t){return e.length===t.length&&e.every((n,i)=>t[i]===n)}static isAncestor(e,t){return e.length<t.length&&e.every((n,i)=>t[i]===n)}static isDescendant(e,t){return e.length>t.length&&t.every((n,i)=>e[i]===n)}}const _t=Symbol("isProxy");class Nl{static create(e,t){return I(this,null,function*(){var P;e=new tt(e.db,e.path);let n,i=!1,s=t==null?void 0:t.cursor,o;const a=Ne.generate(),c=[],u=new Ht;u.on("cursor",h=>s=h),u.on("error",h=>{console.error(h.message,h.details)});const l=(h,p)=>{if(h.length===0)return n=p,!0;let w=n;const b=h.slice();for(;b.length>1;){const x=b.shift();if(!(x in w))return!1;w=w[x]}const E=b.shift();return p===null?w instanceof Array?w.splice(E,1):delete w[E]:w[E]=p,!0},f=()=>I(this,null,function*(){!i||(yield G())}),m=e.on("mutations",{syncFallback:f}).subscribe(h=>I(this,null,function*(){var x;if(!i)return;const p=h.context(),w=((x=p.acebase_proxy)==null?void 0:x.id)!==a;if(!w)return;h.val(!1).every(k=>{if(!l(k.target,k.val))return!1;const _=k.target.reduce((T,D)=>T.child(D),e),S=new ye(_,k.val,!1,k.prev,h.context());return u.emit("mutation",{snapshot:S,isRemote:w}),!0})?(u.emit("cursor",p.acebase_cursor),te.emit("mutations",{origin:"remote",snap:h})):(console.warn(`Cached value of live data proxy on "${e.path}" appears outdated, will be reloaded`),yield G())}));let d=Promise.resolve();const y=[],v=[],A=()=>I(this,null,function*(){const h=[];for(let p=0,w=y[0];p<y.length;p++,w=y[p])v.find(b=>ze.areEqual(b.target,w.target)||ze.isAncestor(b.target,w.target))||(y.splice(p,1),p--,h.push(w));h.length!==0&&(h.forEach(p=>{p.value=et(Ve(n,p.target))}),Ye.nextTick(()=>{const p={acebase_proxy:{id:a,source:"update"}};h.forEach(b=>{const E=b.target.reduce((k,_)=>k.child(_),e),x=new ye(E,b.value,!1,b.previous,p);u.emit("mutation",{snapshot:x,isRemote:!1})});const w=new Nn(e,h.map(b=>({target:b.target,val:b.value,prev:b.previous})),p);te.emit("mutations",{origin:"local",snap:w})}),d=h.reduce((p,w,b,E)=>(E.some(x=>ze.isAncestor(x.target,w.target))||p.push(w),p),[]).reduce((p,w)=>{const b=w.target;if(b.length===0)p.push({ref:e,target:b,value:n,type:"set",previous:w.previous});else{const E=b.slice(0,-1),x=b.slice(-1)[0],k=E.reduce((D,L)=>D.child(L),e),_=p.find(D=>D.ref.path===k.path),S=Ve(n,b),T=w.previous;_?(_.value[x]=S,_.previous[x]=T):p.push({ref:k,target:E,value:{[x]:S},type:"update",previous:{[x]:T}})}return p},[]).reduce((p,w)=>I(this,null,function*(){const b={acebase_proxy:{id:a,source:w.type}};yield p,yield w.ref.context(b)[w.type](w.value).catch(E=>{u.emit("error",{source:"update",message:`Error processing update of "/${e.path}"`,details:E});const x={acebase_proxy:{id:a,source:"update-rollback"}},k=[];if(w.type==="set"){br(n,w.target,w.previous);const S=new ye(w.ref,w.previous,!1,w.value,x);u.emit("mutation",{snapshot:S,isRemote:!1}),k.push({target:w.target,val:w.previous,prev:w.value})}else Object.keys(w.previous).forEach(S=>{br(n,w.target.concat(S),w.previous[S]);const T=new ye(w.ref.child(S),w.previous[S],!1,w.value[S],x);u.emit("mutation",{snapshot:T,isRemote:!1}),k.push({target:w.target.concat(S),val:w.previous[S],prev:w.value[S]})});k.forEach(S=>{const T=S.target.reduce((L,B)=>L.child(B),e),D=new ye(T,S.val,!1,S.prev,x);u.emit("mutation",{snapshot:D,isRemote:!1})});const _=new Nn(w.ref,k,x);te.emit("mutations",{origin:"local",snap:_})}),w.ref.cursor&&u.emit("cursor",w.ref.cursor)}),d),yield d)});let O=!1;const C=[],R=()=>{let h;const p=new Promise(w=>h=w);return C.push({resolve:h}),p};let U=null;const z=()=>{U||(U=setTimeout(()=>I(this,null,function*(){O=!0,U=null,yield A(),O=!1,C.splice(0).forEach(h=>h.resolve())}),0))},W=h=>{y.find(p=>ze.areEqual(p.target,h))||y.push({target:h,previous:et(Ve(n,h))}),z()},te=new Ht,le=(h,p)=>{const w=x=>x!==null&&typeof x=="object",b=x=>I(this,null,function*(){var re;const{snap:k,origin:_}=x,S=k.context(),T=((re=S.acebase_proxy)==null?void 0:re.id)===a;if(x.origin==="remote"&&T){console.error("DEV ISSUE: mutationsHandler was called from remote event originating from our own proxy");return}const D=k.val(!1).filter(Q=>Q.target.slice(0,h.length).every((oe,X)=>h[X]===oe));if(D.length===0)return;let L,B;const Y=D.find(Q=>Q.target.length<=h.length);if(Y){const Q=h.slice(Y.target.length);L=Q.reduce((oe,X)=>!w(oe)||!(X in oe)?null:oe[X],Y.val),B=Q.reduce((oe,X)=>!w(oe)||!(X in oe)?null:oe[X],Y.prev)}else{const Q=Ve(n,h);L=et(Q),B=et(L),D.forEach(oe=>{const X=oe.target.slice(h.length);for(let ue=0,Ie=L,fe=B;ue<X.length;ue++){const $e=ue+1===X.length,Se=X[ue];$e?(Ie[Se]=oe.val,Ie[Se]===null&&delete Ie[Se],fe[Se]=oe.prev,fe[Se]===null&&delete fe[Se]):(Ie=Ie[Se]=Se in Ie?Ie[Se]:{},fe=fe[Se]=Se in fe?fe[Se]:{})}})}Ye.nextTick(()=>{let Q=!0;try{Q=p(Object.freeze(L),Object.freeze(B),!T,S)!==!1}catch(oe){u.emit("error",{source:_==="remote"?"remote_update":"local_update",message:"Error running subscription callback",details:oe})}Q===!1&&E()})});te.on("mutations",b);const E=()=>{te.off("mutations",b),c.splice(c.findIndex(x=>x.stop===E),1)};return c.push({target:h,stop:E}),{stop:E}},ce=(h,p,w)=>{if(h==="write")return W(p);if(h==="onChange")return le(p,w.callback);if(h==="subscribe"||h==="observe"){const b=x=>{const k=Ve(n,p);x.next(k);const _=le(p,S=>{x.next(S)});return function(){_.stop()}};if(h==="subscribe")return b;const E=ci();return new E(b)}else if(h==="transaction")return v.some(E=>ze.areEqual(p,E.target)||ze.isAncestor(p,E.target)||ze.isDescendant(p,E.target))?Promise.reject(new Error("Cannot start transaction because it conflicts with another transaction")):new Promise(E=>I(this,null,function*(){y.some(S=>ze.areEqual(p,S.target)||ze.isAncestor(p,S.target))&&(O||z(),yield R());const k={target:p,status:"started",transaction:null};v.push(k),k.transaction={get status(){return k.status},get completed(){return k.status!=="started"},get mutations(){return y.filter(S=>ze.areEqual(k.target,S.target)||ze.isAncestor(k.target,S.target))},get hasMutations(){return this.mutations.length>0},commit(){return I(this,null,function*(){if(this.completed)throw new Error(`Transaction has completed already (status '${k.status}')`);k.status="finished",v.splice(v.indexOf(k),1),O&&(yield R()),z(),yield R()})},rollback(){if(this.completed)throw new Error(`Transaction has completed already (status '${k.status}')`);k.status="canceled";const S=[];for(let T=0;T<y.length;T++){const D=y[T];(ze.areEqual(k.target,D.target)||ze.isAncestor(k.target,D.target))&&(y.splice(T,1),T--,S.push(D))}S.reverse().forEach(T=>{T.target.length===0?n=T.previous:br(n,T.target,T.previous)}),v.splice(v.indexOf(k),1)}},E(k.transaction)}))},F=yield e.get({cache_mode:"allow",cache_cursor:t==null?void 0:t.cursor});if(F.context().acebase_origin!=="cache"&&u.emit("cursor",(P=e.cursor)!=null?P:null),i=!0,n=F.val(),n===null&&typeof(t==null?void 0:t.defaultValue)!="undefined"){n=t.defaultValue;const h={acebase_proxy:{id:a,source:"default"}};yield e.context(h).set(n)}o=Oo({root:{ref:e,get cache(){return n}},target:[],id:a,flag:ce});const M=()=>{if(o===null)throw new Error("Proxy was destroyed")},G=()=>I(this,null,function*(){M(),y.splice(0);const h=yield e.get({allow_cache:!1}),p=n,w=h.val();n=w;const b=Ao(p,w);if(b.length===0)return;const E=h.context();E.acebase_proxy={id:a,source:"reload"},b.forEach(k=>{const _=Ur(e,k.target),S=new ye(_,k.val,k.val===null,k.prev,E);u.emit("mutation",{snapshot:S,isRemote:!0})});const x=new Nn(e,b,E);te.emit("mutations",{origin:"local",snap:x})});return{destroy(){return I(this,null,function*(){yield d;const h=[m.stop(),...c.map(p=>p.stop())];yield Promise.all(h),["cursor","mutation","error"].forEach(p=>u.off(p)),n=null,o=null})},stop(){this.destroy()},get value(){return M(),o},get hasValue(){return M(),n!==null},set value(h){M(),h!==null&&typeof h=="object"&&h[_t]&&(h=h.valueOf()),W([]),n=h},get ref(){return e},get cursor(){return s},reload:G,onMutation(h){M(),u.off("mutation"),u.on("mutation",({snapshot:p,isRemote:w})=>{try{h(p,w)}catch(b){u.emit("error",{source:"mutation_callback",message:"Error in dataproxy onMutation callback",details:b})}})},onError(h){M(),u.off("error"),u.on("error",p=>{try{h(p)}catch(w){console.error(`Error in dataproxy onError callback: ${w.message}`)}})},on(h,p){u.on(h,p)},off(h,p){u.off(h,p)}}})}}function Ve(r,e){let t=r;for(const n of e)t=typeof t=="object"&&t!==null&&n in t?t[n]:null;return t}function br(r,e,t){if(e.length===0)throw new Error("Cannot update root target, caller must do that itself!");const n=e.slice(0,-1).reduce((s,o)=>s[o],r),i=e.slice(-1)[0];t===null||typeof t=="undefined"?n instanceof Array?n.splice(i,1):delete n[i]:n[i]=t}function Ur(r,e){const t=$.get(r.path).childPath(e);return new tt(r.db,t)}function Oo(r){const e=Ur(r.root.ref,r.target),t=[],n={get(s,o,a){if(s=Ve(r.root.cache,r.target),typeof o=="symbol")if(o.toString()===Symbol.iterator.toString())o="values";else return o.toString()===_t.toString()?!0:Reflect.get(s,o,a);if(o==="valueOf")return function(){return s};if(s===null||typeof s!="object")throw new Error(`Cannot read property "${o}" of ${s}. Value of path "/${e.path}" is not an object (anymore)`);s instanceof Array&&typeof o=="string"&&/^[0-9]+$/.test(o)&&(o=parseInt(o));const c=s[o];if(c===null){delete s[o];return}const u=t.find(d=>d.prop===o);if(u){if(u.typeof===typeof c)return u.value;t.splice(t.indexOf(u),1)}const l=d=>{const y=s[d],v=t.find(O=>O.prop===d);if(v){if(v.typeof===typeof y)return v.value;t.splice(t.indexOf(v),1)}if(typeof y!="object")return y;const A=Oo({root:r.root,target:r.target.concat(d),id:r.id,flag:r.flag});return t.push({typeof:typeof y,prop:d,value:A}),A},f=d=>d!==null&&typeof d=="object"&&d[_t]?d.getTarget():d;if(["string","number","boolean"].includes(typeof c)||c instanceof Date||c instanceof me||c instanceof ArrayBuffer||typeof c=="object"&&"buffer"in c)return c;const m=s instanceof Array;if(o==="toString")return function(){return`[LiveDataProxy for "${e.path}"]`};if(typeof c=="undefined")return o==="push"?function(y){const v=e.push();return r.flag("write",r.target.concat(v.key)),s[v.key]=y,v.key}:o==="getTarget"?function(d=!0){return d&&console.warn("Use getTarget with caution - any changes will not be synchronized!"),s}:o==="getRef"?function(){return Ur(r.root.ref,r.target)}:o==="forEach"?function(y){const v=Object.keys(s);let A=!1;for(let O=0;!A&&O<v.length;O++){const C=v[O],R=l(C);A=y(R,C,O)===!1}}:["values","entries","keys"].includes(o)?function*(){const y=Object.keys(s);for(const v of y)if(o==="keys")yield v;else{const A=l(v);o==="entries"?yield[v,A]:yield A}}:o==="toArray"?function(y){const v=Object.keys(s).map(A=>l(A));return y&&v.sort(y),v}:o==="onChanged"?function(y){return r.flag("onChange",r.target,{callback:y})}:o==="subscribe"?function(){return r.flag("subscribe",r.target)}:o==="getObservable"?function(){return r.flag("observe",r.target)}:o==="getOrderedCollection"?function(y,v){return new $l(this,y,v)}:o==="startTransaction"?function(){return r.flag("transaction",r.target)}:o==="remove"&&!m?function(){if(r.target.length===0)throw new Error("Can't remove proxy root value");const y=Ve(r.root.cache,r.target.slice(0,-1)),v=r.target.slice(-1)[0];r.flag("write",r.target),delete y[v]}:void 0;if(typeof c=="function"){if(m){const d=v=>(r.flag("write",r.target),v()),y=v=>v.map(A=>(A=f(A),Fr(A),A));if(o==="push")return function(...A){return A=y(A),d(()=>s.push(...A))};if(o==="pop")return function(){return d(()=>s.pop())};if(o==="splice")return function(A,O,...C){return C=y(C),d(()=>s.splice(A,O,...C))};if(o==="shift")return function(){return d(()=>s.shift())};if(o==="unshift")return function(...A){return A=y(A),d(()=>s.unshift(...A))};if(o==="sort")return function(A){return d(()=>s.sort(A))};if(o==="reverse")return function(){return d(()=>s.reverse())};if(["indexOf","lastIndexOf"].includes(o))return function(A,O){return A!==null&&typeof A=="object"&&A[_t]&&(A=A.getTarget(!1)),s[o](A,O)};if(["forEach","every","some","filter","map"].includes(o))return function(A){return s[o]((O,C)=>A(l(C),C,i))};if(["reduce","reduceRight"].includes(o))return function(A,O){return s[o]((C,R,U)=>A(C,l(U),U,i),O)};if(["find","findIndex"].includes(o))return function(A){let O=s[o]((C,R)=>A(l(R),R,i));if(o==="find"&&O){const C=s.indexOf(O);O=l(C)}return O};if(["values","entries","keys"].includes(o))return function*(){for(let A=0;A<s.length;A++)if(o==="keys")yield A;else{const O=l(A);o==="entries"?yield[A,O]:yield O}}}return c}return l(o)},set(s,o,a,c){if(s=Ve(r.root.cache,r.target),typeof o=="symbol")return Reflect.set(s,o,a,c);if(s===null||typeof s!="object")throw new Error(`Cannot set property "${o}" of ${s}. Value of path "/${e.path}" is not an object`);if(s instanceof Array&&typeof o=="string"){if(!/^[0-9]+$/.test(o))throw new Error(`Cannot set property "${o}" on array value of path "/${e.path}"`);o=parseInt(o)}return a!==null&&(typeof a=="object"&&(a[_t]&&(a=a.valueOf()),a=et(a)),Mn(a,s[o]))||(r.target.some(u=>typeof u=="number")?r.flag("write",r.target.slice(0,r.target.findIndex(u=>typeof u=="number"))):s instanceof Array?r.flag("write",r.target):r.flag("write",r.target.concat(o)),a===null?delete s[o]:(Fr(a),s[o]=a)),!0},deleteProperty(s,o){if(s=Ve(r.root.cache,r.target),s===null)throw new Error(`Cannot delete property ${o.toString()} of null`);return typeof o=="symbol"?Reflect.deleteProperty(s,o):(o in s&&(r.flag("write",r.target.concat(o)),delete s[o]),!0)},ownKeys(s){return s=Ve(r.root.cache,r.target),Reflect.ownKeys(s)},has(s,o){return s=Ve(r.root.cache,r.target),Reflect.has(s,o)},getOwnPropertyDescriptor(s,o){s=Ve(r.root.cache,r.target);const a=Reflect.getOwnPropertyDescriptor(s,o);return a&&(a.configurable=!0),a},getPrototypeOf(s){return s=Ve(r.root.cache,r.target),Reflect.getPrototypeOf(s)}},i=new Proxy({},n);return i}function Fr(r){typeof r=="object"&&Object.keys(r).forEach(e=>{const t=r[e];t===null||typeof t=="undefined"?delete r[e]:typeof t=="object"&&Fr(t)})}function $n(r){if(typeof r!="object"||!r[_t])throw new Error("Given value is not proxied. Make sure you are referencing the value through the live data proxy.");return r}class $l{constructor(e,t="order",n=10){if(this.collection=e,this.orderProperty=t,this.orderIncrement=n,typeof e!="object"||!e[_t])throw new Error("Collection is not proxied");if(e.valueOf()instanceof Array)throw new Error("Collection is an array, not an object collection");if(!Object.keys(e).every(s=>typeof e[s]=="object"))throw new Error("Collection has non-object children");if(!Object.keys(e).every(s=>typeof e[s][t]=="number")){const s=Object.keys(e);for(let o=0;o<s.length;o++){const a=e[s[o]];a[t]=o*n}}}getObservable(){return $n(this.collection).getObservable()}getArrayObservable(){const e=ci();return new e(t=>{const n=this.getObservable().subscribe(()=>{const i=this.getArray();t.next(i)});return function(){n.unsubscribe()}})}getArray(){return $n(this.collection).toArray((t,n)=>t[this.orderProperty]-n[this.orderProperty])}add(e,t,n){const i=this.getArray();let s=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;for(let u=0;u<i.length;u++){const l=i[u][this.orderProperty];s=Math.min(l,s),o=Math.max(l,o)}let a;if(typeof n=="number"){if(a=Object.keys(this.collection).find(u=>this.collection[u]===e),!a)throw new Error("item not found in collection");if(n===t)return{key:a,index:t};if(Math.abs(n-t)===1){const u=i[t],l=u[this.orderProperty];return u[this.orderProperty]=e[this.orderProperty],e[this.orderProperty]=l,{key:a,index:t}}else i.splice(n,1)}if(typeof t!="number"||t>=i.length)t=i.length,e[this.orderProperty]=i.length==0?0:o+this.orderIncrement;else if(t===0)e[this.orderProperty]=i.length==0?0:s-this.orderIncrement;else{const u=i.map(f=>f[this.orderProperty]),l=u[t]-u[t-1];if(l>1)e[this.orderProperty]=u[t]-Math.floor(l/2);else{i.splice(t,0,e);for(let f=0;f<i.length;f++)i[f][this.orderProperty]=f*this.orderIncrement}}return{key:typeof a=="string"?a:$n(this.collection).push(e),index:t}}delete(e){const n=this.getArray()[e];if(!n)throw new Error(`Item at index ${e} not found`);const i=Object.keys(this.collection).find(s=>this.collection[s]===n);if(!i)throw new Error("Cannot find target object to delete");return this.collection[i]=null,{key:i,index:e}}move(e,t){const n=this.getArray();return this.add(n[e],t,e)}sort(e){const t=this.getArray();t.sort(e);for(let n=0;n<t.length;n++)t[n][this.orderProperty]=n*this.orderIncrement}}class Po{constructor(e){if(e||(e={}),typeof e.include!="undefined"&&!(e.include instanceof Array))throw new TypeError("options.include must be an array");if(typeof e.exclude!="undefined"&&!(e.exclude instanceof Array))throw new TypeError("options.exclude must be an array");if(typeof e.child_objects!="undefined"&&typeof e.child_objects!="boolean")throw new TypeError("options.child_objects must be a boolean");if(typeof e.cache_mode=="string"&&!["allow","bypass","force"].includes(e.cache_mode))throw new TypeError("invalid value for options.cache_mode");this.include=e.include||void 0,this.exclude=e.exclude||void 0,this.child_objects=typeof e.child_objects=="boolean"?e.child_objects:void 0,this.cache_mode=typeof e.cache_mode=="string"?e.cache_mode:typeof e.allow_cache=="boolean"?e.allow_cache?"allow":"bypass":"allow",this.cache_cursor=typeof e.cache_cursor=="string"?e.cache_cursor:void 0}}class Cl extends Po{constructor(e){if(super(e),!["undefined","boolean"].includes(typeof e.snapshots))throw new TypeError("options.snapshots must be a boolean");this.snapshots=typeof e.snapshots=="boolean"?e.snapshots:!0}}const Z=Symbol("private");class tt{constructor(e,t,n){this.db=e,t||(t=""),t=t.replace(/^\/|\/$/g,"");const s=$.get(t).key,o=[];this[Z]={get path(){return t},get key(){return s},get callbacks(){return o},vars:n||{},context:{},pushed:!1,cursor:null}}context(e,t=!1){const n=this[Z].context;if(typeof e=="object"){const i=e?t?n||{}:e:{};return e&&Object.keys(e).forEach(s=>{i[s]=e[s]}),this[Z].context=i,this}else{if(typeof e=="undefined")return console.warn("Use snap.context() instead of snap.ref.context() to get updating context in event callbacks"),n;throw new Error("Invalid context argument")}}get cursor(){return this[Z].cursor}set cursor(e){var t;this[Z].cursor=e,(t=this.onCursor)==null||t.call(this,e)}get path(){return this[Z].path}get key(){const e=this[Z].key;return typeof e=="number"?`[${e}]`:e}get index(){const e=this[Z].key;if(typeof e!="number")throw new Error(`"${e}" is not a number`);return e}get parent(){const e=$.fillVariables2(this.path,this.vars),t=$.get(e);return t.parentPath===null?null:new tt(this.db,t.parentPath).context(this[Z].context)}get vars(){return this[Z].vars}child(e){e=typeof e=="number"?e:e.replace(/^\/|\/$/g,"");const t=$.fillVariables2(this.path,this.vars),n=$.getChildPath(t,e);return new tt(this.db,n).context(this[Z].context)}set(e,t){return I(this,null,function*(){try{if(this.isWildcardPath)throw new Error(`Cannot set the value of wildcard path "/${this.path}"`);if(this.parent===null)throw new Error("Cannot set the root object. Use update, or set individual child properties");if(typeof e=="undefined")throw new TypeError(`Cannot store undefined value in "/${this.path}"`);this.db.isReady||(yield this.db.ready()),e=this.db.types.serialize(this.path,e);const{cursor:n}=yield this.db.api.set(this.path,e,{context:this[Z].context});if(this.cursor=n,typeof t=="function")try{t(null,this)}catch(i){console.error("Error in onComplete callback:",i)}}catch(n){if(typeof t=="function")try{t(n,this)}catch(i){console.error("Error in onComplete callback:",i)}else throw n}return this})}update(e,t){return I(this,null,function*(){try{if(this.isWildcardPath)throw new Error(`Cannot update the value of wildcard path "/${this.path}"`);if(this.db.isReady||(yield this.db.ready()),typeof e!="object"||e instanceof Array||e instanceof ArrayBuffer||e instanceof Date)yield this.set(e);else if(Object.keys(e).length===0)console.warn(`update called on path "/${this.path}", but there is nothing to update`);else{e=this.db.types.serialize(this.path,e);const{cursor:n}=yield this.db.api.update(this.path,e,{context:this[Z].context});this.cursor=n}if(typeof t=="function")try{t(null,this)}catch(n){console.error("Error in onComplete callback:",n)}}catch(n){if(typeof t=="function")try{t(n,this)}catch(i){console.error("Error in onComplete callback:",i)}else throw n}return this})}transaction(e){return I(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot start a transaction on wildcard path "/${this.path}"`);this.db.isReady||(yield this.db.ready());let t;const n=s=>{s=this.db.types.deserialize(this.path,s);const o=new ye(this,s);let a;try{a=e(o)}catch(c){t=c;return}return a instanceof Promise?a.then(c=>this.db.types.serialize(this.path,c)).catch(c=>{t=c}):this.db.types.serialize(this.path,a)},{cursor:i}=yield this.db.api.transaction(this.path,n,{context:this[Z].context});if(this.cursor=i,t)throw t;return this})}on(e,t,n){this.path===""&&["value","child_changed"].includes(e)&&console.warn("WARNING: Listening for value and child_changed events on the root node is a bad practice. These events require loading of all data (value event), or potentially lots of data (child_changed event) each time they are fired");let i=null;const s=new hl(c=>{i=c}),o={event:e,stream:s,userCallback:typeof t=="function"&&t,ourCallback:(c,u,l,f,m)=>{if(c){this.db.debug.error(`Error getting data for event ${e} on path "${u}"`,c);return}const d=this.db.ref(u);d[Z].vars=$.extractVariables(this.path,u);let y;if(e.startsWith("notify_"))y=d.context(m||{});else{const v={previous:this.db.types.deserialize(u,f),current:this.db.types.deserialize(u,l)};if(e==="child_removed")y=new ye(d,v.previous,!0,v.previous,m);else if(e==="mutations")y=new Nn(d,v.current,m);else{const A=e==="mutated"&&v.current===null;y=new ye(d,v.current,A,v.previous,m)}}i.publish(y),m!=null&&m.acebase_cursor&&(this.cursor=m.acebase_cursor)}};this[Z].callbacks.push(o);const a=()=>{typeof t=="function"&&s.subscribe(t,(m,d)=>{m||n&&n(d)});const c=typeof t=="object"?t:{newOnly:!t};typeof c.newOnly!="boolean"&&(c.newOnly=!1),this.isWildcardPath&&(c.newOnly=!0);const u=m=>{const d=this[Z].callbacks;d.splice(d.indexOf(o),1),this.db.api.unsubscribe(this.path,e,o.ourCallback),this.db.debug.error(`Subscription "${e}" on path "/${this.path}" canceled because of an error: ${m.message}`),i.cancel(m.message)},l=this.db.api.subscribe(this.path,e,o.ourCallback,{newOnly:c.newOnly,cancelCallback:u,syncFallback:c.syncFallback}),f=()=>{const m=this[Z].callbacks;return m.splice(m.indexOf(o),1),this.db.api.unsubscribe(this.path,e,o.ourCallback)};if(l instanceof Promise?l.then(()=>{i.start(f)}).catch(u):i.start(f),!c.newOnly){if(e==="value")this.get(m=>{i.publish(m)});else if(e==="child_added")this.get(m=>{const d=m.val();d===null||typeof d!="object"||Object.keys(d).forEach(y=>{const v=new ye(this.child(y),d[y]);i.publish(v)})});else if(e==="notify_child_added"){let y=0;const v=()=>I(this,null,function*(){const A=yield this.db.api.reflect(this.path,"children",{limit:100,skip:y});A.list.forEach(O=>{const C=this.child(O.key);i.publish(C)}),A.more&&(y+=100,v())});v()}}};return this.db.isReady?a():this.db.ready(a),s}off(e,t){const i=this[Z].callbacks.filter(s=>(!e||s.event===e)&&(!t||s.userCallback===t));return i.length===0&&this.db.debug.warn(`Can't find event subscriptions to stop (path: "${this.path}", event: ${e||"(any)"}, callback: ${t})`),i.forEach(s=>{s.stream.stop()}),this}get(e,t){if(!this.db.isReady){const s=this.db.ready().then(()=>this.get(e,t));return typeof e!="function"&&typeof t!="function"?s:void 0}if(t=typeof e=="function"?e:typeof t=="function"?t:void 0,this.isWildcardPath){const s=new Error(`Cannot get value of wildcard path "/${this.path}". Use .query() instead`);if(typeof t=="function")throw s;return Promise.reject(s)}const n=new Po(typeof e=="object"?e:{cache_mode:"allow"}),i=this.db.api.get(this.path,n).then(s=>{var u;"context"in s&&"value"in s||(console.warn("AceBase api.get method returned an old response value. Update your acebase or acebase-client package"),s={value:s,context:{}});const a=this.db.types.deserialize(this.path,s.value),c=new ye(this,a,void 0,void 0,s.context);return(u=s.context)!=null&&u.acebase_cursor&&(this.cursor=s.context.acebase_cursor),c});if(t){i.then(t).catch(s=>{console.error("Uncaught error:",s)});return}else return i}once(e,t){return e==="value"&&!this.isWildcardPath?this.get(t):new Promise(n=>{const i=s=>{this.off(e,i),n(s)};this.on(e,i)})}push(e,t){if(this.isWildcardPath){const s=new Error(`Cannot push to wildcard path "/${this.path}"`);if(typeof e=="undefined"||typeof t=="function")throw s;return Promise.reject(s)}const n=Ne.generate(),i=this.child(n);return i[Z].pushed=!0,typeof e!="undefined"?i.set(e,t).then(()=>i):i}remove(){return I(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot remove wildcard path "/${this.path}". Use query().remove instead`);if(this.parent===null)throw new Error("Cannot remove the root node");return this.set(null)})}exists(){return I(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot check wildcard path "/${this.path}" existence`);return this.db.isReady||(yield this.db.ready()),this.db.api.exists(this.path)})}get isWildcardPath(){return this.path.indexOf("*")>=0||this.path.indexOf("$")>=0}query(){return new Io(this)}count(){return I(this,null,function*(){return(yield this.reflect("info",{child_count:!0})).children.count})}reflect(e,t){return I(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot reflect on wildcard path "/${this.path}"`);return this.db.isReady||(yield this.db.ready()),this.db.api.reflect(this.path,e,t)})}export(n){return I(this,arguments,function*(e,t={format:"json",type_safe:!0}){if(this.isWildcardPath)throw new Error(`Cannot export wildcard path "/${this.path}"`);this.db.isReady||(yield this.db.ready());const i=typeof e=="function"?e:e.write.bind(e);return this.db.api.export(this.path,i,t)})}import(n){return I(this,arguments,function*(e,t={format:"json",suppress_events:!1}){if(this.isWildcardPath)throw new Error(`Cannot import to wildcard path "/${this.path}"`);return this.db.isReady||(yield this.db.ready()),this.db.api.import(this.path,e,t)})}proxy(e){const t=typeof e=="object"&&(typeof e.cursor!="undefined"||typeof e.defaultValue!="undefined");return typeof e!="undefined"&&!t&&(this.db.debug.warn("Warning: live data proxy is being initialized with a deprecated method signature. Use ref.proxy(options) instead of ref.proxy(defaultValue)"),e={defaultValue:e}),Nl.create(this,e)}observe(e){if(e)throw new Error("observe does not support data retrieval options yet");if(this.isWildcardPath)throw new Error(`Cannot observe wildcard path "/${this.path}"`);const t=ci();return new t(n=>{let i,s=!1,o=this.get(e).then(c=>{s=!0,i=c.val(),n.next(i)});const a=c=>{if(!s){o=o.then(()=>a(c));return}const u=c.ref.path;if(u===this.path)return i=c.val(),n.next(i);const l=$.getPathKeys(u).slice($.getPathKeys(this.path).length);let f=i;for(;l.length>1;){const y=l.shift();y in f||(f[y]=typeof l[0]=="number"?[]:{}),f=f[y]}const m=l.shift(),d=c.val();d===null?f instanceof Array&&typeof m=="number"?f.splice(m,1):delete f[m]:f[m]=d,n.next(i)};return this.on("mutated",a),()=>{this.off("mutated",a)}})}forEach(e,t){return I(this,null,function*(){let n;if(typeof e=="function"?t=e:n=e,typeof t!="function")throw new TypeError("No callback function given");const i=yield this.reflect("children",{limit:0,skip:0}),s={canceled:!1,total:i.list.length,processed:0};for(let o=0;o<i.list.length;o++){const a=i.list[o].key,c=yield this.child(a).get(n);if(s.processed++,!c.exists())continue;if((yield t(c))===!1){s.canceled=!0;break}}return s})}getMutations(e){return I(this,null,function*(){const t=typeof e=="string"?e:void 0,n=e===null||typeof e=="undefined"?0:e instanceof Date?e.getTime():void 0;return this.db.api.getMutations({path:this.path,cursor:t,timestamp:n})})}getChanges(e){return I(this,null,function*(){const t=typeof e=="string"?e:void 0,n=e===null||typeof e=="undefined"?0:e instanceof Date?e.getTime():void 0;return this.db.api.getChanges({path:this.path,cursor:t,timestamp:n})})}}class Io{constructor(e){this.ref=e,this[Z]={filters:[],skip:0,take:0,order:[],events:{}}}filter(e,t,n){if((t==="in"||t==="!in")&&(!(n instanceof Array)||n.length===0))throw new Error(`${t} filter for ${e} must supply an Array compare argument containing at least 1 value`);if((t==="between"||t==="!between")&&(!(n instanceof Array)||n.length!==2))throw new Error(`${t} filter for ${e} must supply an Array compare argument containing 2 values`);if((t==="matches"||t==="!matches")&&!(n instanceof RegExp))throw new Error(`${t} filter for ${e} must supply a RegExp compare argument`);return this[Z].filters.push({key:e,op:t,compare:n}),this}where(e,t,n){return this.filter(e,t,n)}take(e){return this[Z].take=e,this}skip(e){return this[Z].skip=e,this}sort(e,t=!0){if(!["string","number"].includes(typeof e))throw"key must be a string or number";return this[Z].order.push({key:e,ascending:t}),this}order(e,t=!0){return this.sort(e,t)}get(e,t){if(!this.ref.db.isReady){const s=this.ref.db.ready().then(()=>this.get(e,t));return typeof e!="function"&&typeof t!="function"?s:void 0}t=typeof e=="function"?e:typeof t=="function"?t:void 0;const n=new Cl(typeof e=="object"?e:{snapshots:!0,cache_mode:"allow"});n.allow_cache=n.cache_mode!=="bypass",n.eventHandler=s=>{if(!this[Z].events[s.name])return!1;const o=this[Z].events[s.name];if(typeof o!="object"||o.length===0)return!1;if(["add","change","remove"].includes(s.name)){const a={name:s.name,ref:new tt(this.ref.db,s.path)};if(n.snapshots&&s.name!=="remove"){const c=i.types.deserialize(s.path,s.value);a.snapshot=new ye(a.ref,c,!1)}s=a}o.forEach(a=>{var c,u;try{a(s)}catch(l){this.ref.db.debug.error(`Error executing "${s.name}" event handler of realtime query on path "${this.ref.path}": ${(u=(c=l==null?void 0:l.stack)!=null?c:l==null?void 0:l.message)!=null?u:l}`)}})},n.monitor={add:!1,change:!1,remove:!1},this[Z].events&&(this[Z].events.add&&this[Z].events.add.length>0&&(n.monitor.add=!0),this[Z].events.change&&this[Z].events.change.length>0&&(n.monitor.change=!0),this[Z].events.remove&&this[Z].events.remove.length>0&&(n.monitor.remove=!0)),this.stop();const i=this.ref.db;return i.api.query(this.ref.path,this[Z],n).catch(s=>{throw new Error(s)}).then(s=>{const{stop:o}=s;let{results:a,context:c}=s;if(this.stop=()=>I(this,null,function*(){yield o()}),"results"in s&&"context"in s||(console.warn("Query results missing context. Update your acebase and/or acebase-client packages"),a=s,c={}),n.snapshots){const u=a.map(l=>{const f=i.types.deserialize(l.path,l.val);return new ye(i.ref(l.path),f,!1,void 0,c)});return Zn.from(u)}else{const u=a.map(l=>i.ref(l));return li.from(u)}}).then(s=>(t&&t(s),s))}stop(){return I(this,null,function*(){})}getRefs(e){return this.get({snapshots:!1},e)}find(){return this.get({snapshots:!1})}count(){return I(this,null,function*(){return(yield this.find()).length})}exists(){return I(this,null,function*(){const e=this[Z].take,t=this.take(1).find();return this.take(e),(yield t).length!==0})}remove(e){return I(this,null,function*(){const t=yield this.find(),n=t.reduce((a,c)=>{const u=a[c.parent.path];return u?u.push(c):a[c.parent.path]=[c],a},{}),i=this.ref.db,s=Object.keys(n).map(a=>I(this,null,function*(){const c=t.reduce((l,f)=>(l[f.key]=null,l),{}),u=i.ref(a);try{return yield u.update(c),{ref:u,success:!0}}catch(l){return{ref:u,success:!1,error:l}}})),o=yield Promise.all(s);return e&&e(o),o})}on(e,t){return this[Z].events[e]||(this[Z].events[e]=[]),this[Z].events[e].push(t),this}off(e,t){if(typeof e=="undefined")return this[Z].events={},this;if(!this[Z].events[e])return this;if(typeof t=="undefined")return delete this[Z].events[e],this;const n=this[Z].events[e].indexOf(t);return~n?(this[Z].events[e].splice(n,1),this):this}forEach(e,t){return I(this,null,function*(){let n;if(typeof e=="function"?t=e:n=e,typeof t!="function")throw new TypeError("No callback function given");const i=yield this.find(),s={canceled:!1,total:i.length,processed:0};for(let o=0;o<i.length;o++){const c=yield i[o].get(n);if(s.processed++,!c.exists())continue;if((yield t(c))===!1){s.canceled=!0;break}}return s})}}class Zn extends Array{static from(e){const t=new Zn(e.length);return e.forEach((n,i)=>t[i]=n),t}getValues(){return this.map(e=>e.val())}}class li extends Array{static from(e){const t=new li(e.length);return e.forEach((n,i)=>t[i]=n),t}getPaths(){return this.map(e=>e.path)}}function Bl(r,e){e=e.replace(/^\/|\/$/g,"");const t=$.getPathKeys(e),n=Object.keys(r).find(s=>{const o=$.getPathKeys(s);return o.length!==t.length?!1:o.every((a,c)=>a==="*"||typeof a=="string"&&a[0]==="$"?!0:a===t[c])});return r[n]}function jl(r,e){const t=$.get(e).parentPath;if(t!==null)return Bl(r,t)}function Ll(r,e){e=e.replace(/^\/|\/$/g,"");const n=$.get(e).parentPath,i=n?$.getPathKeys(n):[];return Object.keys(r).reduce((o,a)=>{const c=$.getPathKeys(a);if(c.length<i.length)return o;let u=!0;if(i.length===0&&n!==null?u=c.length===1&&(c[0]==="*"||typeof c[0]=="string"&&c[0][0]==="$"):c.every((l,f)=>f>=i.length?!1:l==="*"||typeof l=="string"&&l[0]==="$"||l===i[f]?!0:(u=!1,!1)),u){const l=r[a];o.push({path:a,type:l})}return o},[])}function gs(r,e,t,n,i){if(n===null||typeof n!="object")return n;const s=$.getPathKeys(t),o=Ll(e,t),a=[];return o.sort((c,u)=>$.getPathKeys(c.path).length>$.getPathKeys(u.path).length?-1:1),o.forEach(c=>{const u=$.getPathKeys(c.path);u.push("*");const l=u.slice(s.length);if(l.length===0){const m=$.extractVariables(c.path,t),d=new tt(r,t,m);if(i==="serialize")n=c.type.serialize(n,d);else if(i==="deserialize"){const y=new ye(d,n);n=c.type.deserialize(y)}return}const f=(m,d,y)=>{if(n===null||typeof n!="object")return n;const v=y[0];let A=[];if(v==="*"||typeof v=="string"&&v[0]==="$")d instanceof Array?A=d.map((O,C)=>({key:C,val:O})):A=Object.keys(d).map(O=>({key:O,val:d[O]}));else{const O=d[v];typeof O=="object"&&A.push({key:v,val:O})}A.forEach(O=>{const C=$.getChildPath(m,O.key),R=$.extractVariables(c.path,C),U=new tt(r,C,R);if(y.length===1){if(i==="serialize")a.push({parent:d,key:O.key,original:d[O.key]}),d[O.key]=c.type.serialize(O.val,U);else if(i==="deserialize"){const z=new ye(U,O.val);d[O.key]=c.type.deserialize(z)}}else f(C,O.val,y.slice(1))})};f(t,n,l)}),i==="serialize"&&(n=et(n),a.length>0&&a.forEach(c=>{c.parent[c.key]=c.original})),n}const Dt=Symbol("mappings");class Ro{constructor(e){this.db=e,this[Dt]={}}get mappings(){return this[Dt]}map(e){return jl(this[Dt],e)}bind(e,t,n={}){if(typeof e!="string")throw new TypeError("path must be a string");if(typeof t!="function")throw new TypeError("constructor must be a function");if(typeof n.serializer!="undefined"){if(typeof n.serializer=="string")if(typeof t.prototype[n.serializer]=="function")n.serializer=t.prototype[n.serializer];else throw new TypeError(`${t.name}.prototype.${n.serializer} is not a function, cannot use it as serializer`);else if(typeof n.serializer!="function")throw new TypeError(`serializer for class ${t.name} must be a function, or the name of a prototype method`)}if(typeof n.creator=="undefined")typeof t.create=="function"&&(n.creator=t.create);else if(typeof n.creator=="string")if(typeof t[n.creator]=="function")n.creator=t[n.creator];else throw new TypeError(`${t.name}.${n.creator} is not a function, cannot use it as creator`);else if(typeof n.creator!="function")throw new TypeError(`creator for class ${t.name} must be a function, or the name of a static method`);e=e.replace(/^\/|\/$/g,""),this[Dt][e]={db:this.db,type:t,creator:n.creator,serializer:n.serializer,deserialize(i){let s;return this.creator?s=this.creator.call(this.type,i):s=new this.type(i),s},serialize(i,s){return this.serializer?i=this.serializer.call(i,s,i):i&&typeof i.serialize=="function"&&(i=i.serialize(s,i)),i}}}serialize(e,t){return gs(this.db,this[Dt],e,t,"serialize")}deserialize(e,t){return gs(this.db,this[Dt],e,t,"deserialize")}}const bn=()=>{};class No{constructor(e="log",t=""){this.level=e,this.prefix=t,this.setLevel(e)}setLevel(e){const t=this.prefix?this.prefix+" %s":"";this.verbose=["verbose"].includes(e)?t?console.log.bind(console,t):console.log.bind(console):bn,this.log=["verbose","log"].includes(e)?t?console.log.bind(console,t):console.log.bind(console):bn,this.warn=["verbose","log","warn"].includes(e)?t?console.warn.bind(console,t):console.warn.bind(console):bn,this.error=["verbose","log","warn","error"].includes(e)?t?console.error.bind(console,t):console.error.bind(console):bn,this.write=n=>{const i=typeof Ye!="undefined"&&Ye.env&&typeof{}.RUNKIT_ENDPOINT_PATH=="string";n&&i?n.split(`
`).forEach(s=>console.log(s)):console.log(n)}}}const vs={bold:1,dim:2,italic:3,underline:4,inverse:7,hidden:8,strikethrough:94},ws={black:30,red:31,green:32,yellow:33,blue:34,magenta:35,cyan:36,white:37,grey:90,brightRed:91},bs={bgBlack:40,bgRed:41,bgGreen:42,bgYellow:43,bgBlue:44,bgMagenta:45,bgCyan:46,bgWhite:47,bgGrey:100,bgBrightRed:101},xn={all:0,color:39,background:49,bold:22,dim:22,italic:23,underline:24,inverse:27,hidden:28,strikethrough:29};var Oe;(function(r){r.reset="reset",r.bold="bold",r.dim="dim",r.italic="italic",r.underline="underline",r.inverse="inverse",r.hidden="hidden",r.strikethrough="strikethrough",r.black="black",r.red="red",r.green="green",r.yellow="yellow",r.blue="blue",r.magenta="magenta",r.cyan="cyan",r.grey="grey",r.bgBlack="bgBlack",r.bgRed="bgRed",r.bgGreen="bgGreen",r.bgYellow="bgYellow",r.bgBlue="bgBlue",r.bgMagenta="bgMagenta",r.bgCyan="bgCyan",r.bgWhite="bgWhite",r.bgGrey="bgGrey"})(Oe||(Oe={}));function $o(){if(typeof Ye=="undefined"||!Ye.stdout||!Ye.env||!Ye.platform||Ye.platform==="browser")return!1;if(Ye.platform==="win32")return!0;const r=Ye.env;return r.COLORTERM?!0:r.TERM==="dumb"?!1:r.CI||r.TEAMCITY_VERSION?!!r.TRAVIS:!!(["iTerm.app","HyperTerm","Hyper","MacTerm","Apple_Terminal","vscode"].includes(r.TERM_PROGRAM)||/^xterm-256|^screen|^xterm|^vt100|color|ansi|cygwin|linux/i.test(r.TERM))}let Co=$o();function Dl(r){Co=$o()&&r}function Ul(r,e){if(!Co)return r;const t=[],n=[],i=a=>{a===Oe.reset?t.push(xn.all):a in vs?(t.push(vs[a]),n.push(xn[a])):a in ws?(t.push(ws[a]),n.push(xn.color)):a in bs&&(t.push(bs[a]),n.push(xn.background))};e instanceof Array?e.forEach(i):i(e);const s=t.map(a=>"\x1B["+a+"m").join(""),o=n.map(a=>"\x1B["+a+"m").join("");return r.split(`
`).map(a=>s+a+o).join(`
`)}String.prototype.colorize=function(r){return Ul(this,r)};class Bo{constructor(e){this.logLevel="log",this.logColors=!0,this.info="realtime database",this.sponsor=!1,typeof e!="object"&&(e={}),typeof e.logLevel=="string"&&(this.logLevel=e.logLevel),typeof e.logColors=="boolean"&&(this.logColors=e.logColors),typeof e.info=="string"&&(this.info=e.info),typeof e.sponsor=="boolean"&&(this.sponsor=e.sponsor)}}class Fl extends Ht{constructor(e,t={}){super(),this._ready=!1,t=new Bo(t),this.name=e,this.debug=new No(t.logLevel,`[${e}]`),Dl(t.logColors);const n=[Oe.magenta,Oe.bold],i=`     ___          ______                
    / _ \\         | ___ \\               
   / /_\\ \\ ___ ___| |_/ / __ _ ___  ___ 
   |  _  |/ __/ _ \\ ___ \\/ _\` / __|/ _ \\
   | | | | (_|  __/ |_/ / (_| \\__ \\  __/
   \\_| |_/\\___\\___\\____/ \\__,_|___/\\___|`,s=t.info?"".padStart(40-t.info.length," ")+t.info+`
`:"";t.sponsor||(this.debug.write(i.colorize(n)),s&&this.debug.write(s.colorize(Oe.magenta))),this.types=new Ro(this),this.once("ready",()=>{this._ready=!0})}ready(e){return I(this,null,function*(){this._ready||(yield new Promise(t=>this.on("ready",t))),e==null||e()})}get isReady(){return this._ready}setObservable(e){Rl(e)}ref(e){return new tt(this,e)}get root(){return this.ref("")}query(e){const t=new tt(this,e);return new Io(t)}get indexes(){return{get:()=>this.api.getIndexes(),create:(e,t,n)=>this.api.createIndex(e,t,n),delete:e=>I(this,null,function*(){return this.api.deleteIndex(e)})}}get schema(){return{get:e=>this.api.getSchema(e),set:(e,t,n=!1)=>this.api.setSchema(e,t,n),all:()=>this.api.getSchemas(),check:(e,t,n)=>this.api.validateSchema(e,t,n)}}}class ge extends Error{constructor(e){super(`${e} is not implemented`)}}class Ml extends Ht{constructor(){super()}stats(e){throw new ge("stats")}subscribe(e,t,n,i){throw new ge("subscribe")}unsubscribe(e,t,n){throw new ge("unsubscribe")}update(e,t,n){throw new ge("update")}set(e,t,n){throw new ge("set")}get(e,t){throw new ge("get")}transaction(e,t,n){throw new ge("transaction")}exists(e){throw new ge("exists")}query(e,t,n){throw new ge("query")}reflect(e,t,n){throw new ge("reflect")}export(e,t,n){throw new ge("export")}import(e,t,n){throw new ge("import")}createIndex(e,t,n){throw new ge("createIndex")}getIndexes(){throw new ge("getIndexes")}deleteIndex(e){throw new ge("deleteIndex")}setSchema(e,t,n){throw new ge("setSchema")}getSchema(e){throw new ge("getSchema")}getSchemas(){throw new ge("getSchemas")}validateSchema(e,t,n){throw new ge("validateSchema")}getMutations(e){throw new ge("getMutations")}getChanges(e){throw new ge("getChanges")}}function xs(r,e,t){const n=[0,0,0,0,0];for(let i=0;i<e;i+=4){let s=((r[i]*256+r[i+1])*256+r[i+2])*256+r[i+3];if(!s)t.push("z");else{for(let o=0;o<5;n[o++]=s%85+33,s=Math.floor(s/85));t.push(String.fromCharCode(n[4],n[3],n[2],n[1],n[0]))}}}function Kl(r){const e=r,t=[],n=e.length%4,i=e.length-n;if(xs(e,i,t),n){const o=new Uint8Array(4);o.set(e.slice(i),0),xs(o,4,t);let a=t.pop();a=="z"&&(a="!!!!!"),t.push(a.substr(0,n+1))}let s=t.join("");return s="<~"+s+"~>",s}const lt={encode:function(r){return r instanceof ArrayBuffer&&(r=new Uint8Array(r,0,r.byteLength)),Kl(r)},decode:function(r){if(!r.startsWith("<~")||!r.endsWith("~>"))throw new Error("Invalid input string");r=r.substr(2,r.length-4);const e=r.length,t=[],n=[0,0,0,0,0];let i,s,o,a;for(let u=0;u<e;++u){if(r.charAt(u)=="z"){t.push(0,0,0,0);continue}for(let l=0;l<5;++l)n[l]=r.charCodeAt(u+l)-33;if(a=e-u,a<5){for(let l=a;l<4;n[++l]=0);n[a]=85}i=(((n[0]*85+n[1])*85+n[2])*85+n[3])*85+n[4],s=i&255,i>>>=8,o=i&255,i>>>=8,t.push(i>>>8,i&255,o,s);for(let l=a;l<5;++l,t.pop());u+=4}const c=new Uint8Array(t);return c.buffer.slice(c.byteOffset,c.byteOffset+c.byteLength)}},Wl=r=>{if(r.map===null||typeof r.map=="undefined"){if(typeof r.val=="undefined")throw new Error("serialized value must have a val property");return r.val}const e=(t,n)=>t==="date"?new Date(n):t==="binary"?lt.decode(n):t==="reference"?new me(n):t==="regexp"?new RegExp(n.pattern,n.flags):t==="array"?new Fn(n):t==="bigint"?BigInt(n):n;return typeof r.map=="string"?e(r.map,r.val):(Object.keys(r.map).forEach(t=>{const n=r.map[t],i=$.getPathKeys(t);let s=r,o="val",a=r.val;i.forEach(c=>{o=c,s=a,a=a[o]}),s[o]=e(n,a)}),r.val)},jo=r=>{var i;if(r===null||typeof r!="object"||r instanceof Date||r instanceof ArrayBuffer||r instanceof me||r instanceof RegExp){const s=jo({value:r});return{map:(i=s.map)==null?void 0:i.value,val:s.val.value}}r=et(r);const e=(s,o,a)=>{s instanceof Fn&&(o[a]="array"),Object.keys(s).forEach(c=>{const u=s[c],l=a.length===0?c:`${a}/${c}`;typeof u=="bigint"?(s[c]=u.toString(),o[l]="bigint"):u instanceof Date?(s[c]=u.toISOString(),o[l]="date"):u instanceof ArrayBuffer?(s[c]=lt.encode(u),o[l]="binary"):u instanceof me?(s[c]=u.path,o[l]="reference"):u instanceof RegExp?(s[c]={pattern:u.source,flags:u.flags},o[l]="regexp"):typeof u=="object"&&u!==null&&e(u,o,l)})},t={};e(r,t,"");const n={val:r};return Object.keys(t).length>0&&(n.map=t),n},Es=r=>r>0?Date.now()+r*1e3:1/0;class zl{get size(){return this.cache.size}constructor(e){var n;if(this.enabled=!0,typeof e=="number"&&(e={expirySeconds:e}),e.cloneValues=e.cloneValues!==!1,typeof e.expirySeconds!="number"&&typeof e.maxEntries!="number")throw new Error("Either expirySeconds or maxEntries must be specified");this.options=e,this.cache=new Map;const t=setInterval(()=>{this.cleanUp()},60*1e3);(n=t.unref)==null||n.call(t)}has(e){return this.enabled?this.cache.has(e):!1}get(e){if(!this.enabled)return null;const t=this.cache.get(e);return t?(t.expires=Es(this.options.expirySeconds),t.accessed=Date.now(),this.options.cloneValues?et(t.value):t.value):null}set(e,t){if(this.options.maxEntries>0&&this.cache.size>=this.options.maxEntries&&!this.cache.has(e)){let n=null;const i=Date.now();for(const[s,o]of this.cache.entries()){if(o.expires<=i){this.cache.delete(s),n=null;break}(!n||o.accessed<n.accessed)&&(n={key:s,accessed:o.accessed})}n!==null&&this.cache.delete(n.key)}this.cache.set(e,{value:this.options.cloneValues?et(t):t,added:Date.now(),accessed:Date.now(),expires:Es(this.options.expirySeconds)})}remove(e){this.cache.delete(e)}cleanUp(){const e=Date.now();this.cache.forEach((t,n)=>{t.expires<=e&&this.cache.delete(n)})}}function Vl(r){let e=0;function t(){let a;for(;a=r[e],[" ","\r",`
`,"	"].includes(a);)e++}function n(a){if(r[e]!==a)throw new Error(`Unexpected character at position ${e}. Expected: '${a}', found '${r[e]}'`);e++}function i(){t();const a={name:"",optional:!1,wildcard:!1};let c;for(;c=r[e],c==="_"||c==="$"||c>="a"&&c<="z"||c>="A"&&c<="Z"||a.name.length>0&&c>="0"&&c<="9"||a.name.length===0&&c==="*";)a.name+=c,e++;if(a.name.length===0)throw new Error(`Property name expected at position ${e}, found: ${r.slice(e,e+10)}..`);return r[e]==="?"&&(a.optional=!0,e++),(a.name==="*"||a.name[0]==="$")&&(a.optional=!0,a.wildcard=!0),t(),n(":"),a}function s(){t();let a={typeOf:"any"},c,u="";for(;c=r[e],c>="a"&&c<="z"||c>="A"&&c<="Z";)u+=c,e++;if(u.length===0)if(r[e]==="*")n("*"),a.typeOf="any";else if(["'",'"',"`"].includes(r[e])){a.typeOf="string",a.value="";const l=r[e];for(n(l);c=r[e],c&&c!==l;)a.value+=c,e++;n(l)}else if(r[e]>="0"&&r[e]<="9"){a.typeOf="number";let l="";for(;c=r[e],c==="."||c==="n"||c>="0"&&c<="9";)l+=c,e++;l.endsWith("n")?a.value=BigInt(l):l.includes(".")?a.value=parseFloat(l):a.value=parseInt(l)}else if(r[e]==="{"){for(n("{"),a.typeOf="object",a.instanceOf=Object,a.children=[];;){const l=i(),f=o();if(a.children.push({name:l.name,optional:l.optional,wildcard:l.wildcard,types:f}),t(),(r[e]===";"||r[e]===",")&&(n(r[e]),t()),r[e]==="}")break}n("}")}else if(r[e]==="/"){n("/");let l="",f="";for(;c=r[e],c!=="/"||l.endsWith("\\");)l+=c,e++;for(n("/");c=r[e],["g","i","m","s","u","y","d"].includes(c);)f+=c,e++;a.typeOf="string",a.matches=new RegExp(l,f)}else throw new Error(`Expected a type definition at position ${e}, found character '${r[e]}'`);else if(["string","number","boolean","bigint","undefined","String","Number","Boolean","BigInt"].includes(u))a.typeOf=u.toLowerCase();else if(u==="Object"||u==="object")a.typeOf="object",a.instanceOf=Object;else if(u==="Date")a.typeOf="object",a.instanceOf=Date;else if(u==="Binary"||u==="binary")a.typeOf="object",a.instanceOf=ArrayBuffer;else if(u==="any")a.typeOf="any";else if(u==="null")a.typeOf="object",a.value=null;else if(u==="Array")n("<"),a.typeOf="object",a.instanceOf=Array,a.genericTypes=o(),n(">");else if(["true","false"].includes(u))a.typeOf="boolean",a.value=u==="true";else throw new Error(`Unknown type at position ${e}: "${a}"`);for(t();r[e]==="[";)n("["),n("]"),a={typeOf:"object",instanceOf:Array,genericTypes:[a]};return a}function o(){t();const a=[s()];for(;r[e]==="|";)n("|"),a.push(s()),t();return a}return s()}function Hl(r,e,t,n){const i=e.find(f=>f.name==="*"||f.name[0]==="$")?[]:Object.keys(t).filter(f=>![null,void 0].includes(t[f])&&!e.find(m=>m.name===f));if(i.length>0)return{ok:!1,reason:`Object at path "${r}" cannot have propert${i.length===1?"y":"ies"} ${i.map(f=>`"${f}"`).join(", ")}`};function s(f){const m=![null,void 0].includes(t[f.name]);return!f.optional&&(n?t[f.name]===null:!m)?{ok:!1,reason:`Property at path "${r}/${f.name}" is not optional`}:m&&f.types.length===1?nn(`${r}/${f.name}`,f.types[0],t[f.name],!1):m&&!f.types.some(d=>nn(`${r}/${f.name}`,d,t[f.name],!1).ok)?{ok:!1,reason:`Property at path "${r}/${f.name}" does not match any of ${f.types.length} allowed types`}:{ok:!0}}const o=e.filter(f=>!f.wildcard),a=o.find(f=>!s(f).ok);if(a)return{ok:!1,reason:s(a).reason};const c=e.find(f=>f.wildcard);if(!c)return{ok:!0};const u=Object.keys(t).filter(f=>!o.find(m=>m.name===f));let l={ok:!0};for(let f=0;f<u.length&&l.ok;f++){const m=u[f];l=s({name:m,types:c.types,optional:!0,wildcard:!0})}return l}function nn(r,e,t,n,i){const s={ok:!0};if(e.typeOf==="any")return s;if(i instanceof Array&&i.length>0){if(e.typeOf!=="object")return{ok:!1,reason:`path "${r}" must be typeof ${e.typeOf}`};if(!e.children)return s;const o=i[0];let a=e.children.find(u=>u.name===o);if(a||(a=e.children.find(u=>u.name==="*"||u.name[0]==="$")),!a)return{ok:!1,reason:`Object at path "${r}" cannot have property "${o}"`};if(a.optional&&t===null&&i.length===1)return s;let c;return a.types.some(u=>{const l=typeof o=="number"?`${r}[${o}]`:`${r}/${o}`;return c=nn(l,u,t,n,i.slice(1)),c.ok}),c}return t===null?s:e.instanceOf===Object&&(typeof t!="object"||t instanceof Array||t instanceof Date)?{ok:!1,reason:`path "${r}" must be an object collection`}:e.instanceOf&&(typeof t!="object"||t.constructor!==e.instanceOf)?{ok:!1,reason:`path "${r}" must be an instance of ${e.instanceOf.name}`}:"value"in e&&t!==e.value?{ok:!1,reason:`path "${r}" must be value: ${e.value}`}:typeof t!==e.typeOf?{ok:!1,reason:`path "${r}" must be typeof ${e.typeOf}`}:e.instanceOf===Array&&e.genericTypes&&!t.every(o=>e.genericTypes.some(a=>nn(r,a,o,!1).ok))?{ok:!1,reason:`every array value of path "${r}" must match one of the specified types`}:e.typeOf==="object"&&e.children?Hl(r,e.children,t,n):e.matches&&!e.matches.test(t)?{ok:!1,reason:`path "${r}" must match regular expression /${e.matches.source}/${e.matches.flags}`}:s}function Jl(r){switch(r){case String:return"string";case Number:return"number";case Boolean:return"boolean";case Date:return"Date";case BigInt:return"bigint";case Array:throw new Error("Schema error: Array cannot be used without a type. Use string[] or Array<string> instead");default:throw new Error(`Schema error: unknown type used: ${r.name}`)}}class Yl{constructor(e,t={warnOnly:!1}){if(this.handling=t,this.source=e,typeof e=="object"){const n=i=>"{"+Object.keys(i).map(s=>{let o=i[s];if(o===void 0)o="undefined";else if(o instanceof RegExp)o=`/${o.source}/${o.flags}`;else if(typeof o=="object")o=n(o);else if(typeof o=="function")o=Jl(o);else if(!["string","number","boolean","bigint"].includes(typeof o))throw new Error(`Type definition for key "${s}" must be a string, number, boolean, bigint, object, regular expression, or one of these classes: String, Number, Boolean, Date, BigInt`);return`${s}:${o}`}).join(",")+"}";this.text=n(e)}else if(typeof e=="string")this.text=e;else throw new Error("Type definiton must be a string or an object");this.type=Vl(this.text)}check(e,t,n,i){const s=nn(e,this.type,t,n,i);return!s.ok&&this.handling.warnOnly&&(s.warning=`${n?"Partial schema":"Schema"} check on path "${e}"${i?` for child "${i.join("/")}"`:""} failed: ${s.reason}`,s.ok=!0,this.handling.warnCallback(s.warning)),s}}class Ue{constructor(e="browser"){throw new Error(`This feature is not supported in ${e} context`)}}class xr extends Ue{}class Mr extends Ue{}class ks extends Ue{}class Gl extends Ue{}class As extends Ue{}class Ql extends Ue{}const ql={OBJECT:1,ARRAY:2,NUMBER:3,BOOLEAN:4,STRING:5,BIGINT:7,DATETIME:6,BINARY:8,REFERENCE:9},K=ql;function Xl(r){switch(r){case K.ARRAY:return"array";case K.BINARY:return"binary";case K.BOOLEAN:return"boolean";case K.DATETIME:return"date";case K.NUMBER:return"number";case K.OBJECT:return"object";case K.REFERENCE:return"reference";case K.STRING:return"string";case K.BIGINT:return"bigint"}}class Lo{constructor(e){if(this.path=e.path,this.type=e.type,this.index=e.index,this.key=e.key,this.exists=e.exists,this.address=e.address,this.value=e.value,this.childCount=e.childCount,typeof this.path=="string"&&typeof this.key=="undefined"&&typeof this.index=="undefined"){const t=$.get(this.path);typeof t.key=="number"?this.index=t.key:this.key=t.key}typeof this.exists=="undefined"&&(this.exists=!0)}get valueType(){return this.type}get valueTypeName(){return Xl(this.valueType)}toString(){return this.exists?this.address?`"${this.path}" is ${this.valueTypeName} stored at ${this.address.toString()}`:`"${this.path}" is ${this.valueTypeName} with value ${this.value}`:`"${this.path}" doesn't exist`}}function Le(r,e){if(!r)throw new Error(`Assertion failed: ${e!=null?e:"check your code"}`)}const Zl=120,De={PENDING:"pending",LOCKED:"locked",EXPIRED:"expired",DONE:"done"};class Do{constructor(e,t=Zl){this._locks=[],this._lastTid=0,this.debug=e,this.timeout=t*1e3}setTimeout(e){this.timeout=e*1e3}createTid(){return Ne.generate()}_allowLock(e,t,n){const i=this._locks.find(s=>s.tid!==t&&s.state===De.LOCKED&&(n||s.forWriting));return{allow:!i,conflict:i}}quit(){return new Promise(e=>{if(this._locks.length===0)return e();this._quit=e})}_rejectLock(e,t){this._locks.splice(this._locks.indexOf(e),1),clearTimeout(e.timeout);try{e.reject(t)}catch(n){console.error("Unhandled promise rejection:",n)}}_processLockQueue(){if(this._quit){const t=new Error("Quitting");this._locks.filter(n=>n.state===De.PENDING).forEach(n=>this._rejectLock(n,t)),this._locks.length===0&&this._quit()}this._locks.filter(t=>t.state===De.PENDING).sort((t,n)=>t.priority&&!n.priority?-1:!t.priority&&n.priority?1:t.requested-n.requested).forEach(t=>{const n=this._allowLock(t.path,t.tid,t.forWriting);t.waitingFor=n.conflict||null,n.allow&&this.lock(t).then(t.resolve).catch(i=>this._rejectLock(t,i))})}lock(o,a){return I(this,arguments,function*(e,t,n=!0,i="",s={withPriority:!1,noTimeout:!1}){let c,u;if(e instanceof Er)c=e,u=!0;else{if(this._locks.findIndex(l=>l.tid===t&&l.state===De.EXPIRED)>=0)throw new Error(`lock on tid ${t} has expired, not allowed to continue`);if(this._quit&&!s.withPriority)throw new Error("Quitting");{c=new Er(this,e,t,n,s.withPriority===!0),c.comment=i,this._locks.push(c);const l=this._allowLock(e,t,n);c.waitingFor=l.conflict||null,u=l.allow}}if(u){if(c.state=De.LOCKED,typeof c.granted!="number"){if(c.granted=Date.now(),s.noTimeout!==!0){c.expires=Date.now()+this.timeout;let l=0;const f=()=>{if(c.state===De.LOCKED){if(l++,l<=3){this.debug.warn(`${c.forWriting?"write":"read"} lock on path "/${c.path}" by tid ${c.tid} (${c.comment}) is taking a long time to complete [${l}]`),c.timeout=setTimeout(f,this.timeout/4);return}this.debug.error(`lock :: ${c.forWriting?"write":"read"} lock on path "/${c.path}" by tid ${c.tid} (${c.comment}) took too long`),c.state=De.EXPIRED,this._processLockQueue()}};c.timeout=setTimeout(f,this.timeout/4)}}return c}else return Le(c.state===De.PENDING),new Promise((l,f)=>{c.resolve=l,c.reject=f})})}unlock(e,t,n=!0){let i,s;if(e instanceof Er)i=e,s=this._locks.indexOf(i);else{const o=e;s=this._locks.findIndex(a=>a.id===o),i=this._locks[s]}if(s<0){const o=`lock on "/${i.path}" for tid ${i.tid} wasn't found; ${t}`;throw new Error(o)}return i.state=De.DONE,clearTimeout(i.timeout),this._locks.splice(s,1),n&&this._processLockQueue(),i}list(){return this._locks||[]}isAllowed(e,t,n){return this._allowLock(e,t,n).allow}}let ef=0;class Er{static get LOCK_STATE(){return De}constructor(e,t,n,i,s=!1){this.locker=e,this.path=t,this.tid=n,this.forWriting=i,this.priority=s,this.state=De.PENDING,this.requested=Date.now(),this.comment="",this.waitingFor=null,this.id=++ef,this.history=[]}release(e){return I(this,null,function*(){return this.history.push({action:"release",path:this.path,forWriting:this.forWriting,comment:e}),this.locker.unlock(this,e||this.comment)})}moveToParent(){return I(this,null,function*(){const e=$.get(this.path).parentPath;if(this.locker.isAllowed(e,this.tid,this.forWriting))return this.history.push({path:this.path,forWriting:this.forWriting,action:"moving to parent"}),this.waitingFor=null,this.path=e,this;{this.locker.unlock(this,`moveLockToParent: ${this.comment}`,!1);const n=yield this.locker.lock(e,this.tid,this.forWriting,this.comment,{withPriority:!0});return n.history=this.history,n.history.push({path:this.path,forWriting:this.forWriting,action:"moving to parent through queue (priority)"}),n}})}}class fi extends Error{}class Kr extends Error{}class tf extends Error{constructor(e){super(`Exiting: ${e}`)}}class nf extends Ht{get isMaster(){return this.masterPeerId===this.id}constructor(e,t,n=e.name){super(),this.storage=e,this.id=t,this.dbname=n,this.ipcType="ipc",this.ourSubscriptions=[],this.remoteSubscriptions=[],this.peers=[],this._exiting=!1,this._locks=[],this._requests=new Map,this._eventsEnabled=!0,this._nodeLocker=new Do(e.debug,e.settings.lockTimeout),e.on("subscribe",i=>{if(e.debug.verbose(`database subscription being added on peer ${this.id}`),this.remoteSubscriptions.find(c=>c.callback===i.callback))return;const o=this.ourSubscriptions.some(c=>c.event===i.event&&c.path===i.path);if(this.ourSubscriptions.push(i),o)return;const a={type:"subscribe",from:this.id,data:{path:i.path,event:i.event}};this.sendMessage(a)}),e.on("unsubscribe",i=>{const s=this.remoteSubscriptions.find(o=>o.callback===i.callback);if(s){this.remoteSubscriptions.splice(this.remoteSubscriptions.indexOf(s),1);return}this.ourSubscriptions.filter(o=>o.path===i.path&&(!i.event||o.event===i.event)&&(!i.callback||o.callback===i.callback)).forEach(o=>{this.ourSubscriptions.splice(this.ourSubscriptions.indexOf(o),1);const a={type:"unsubscribe",from:this.id,data:{path:o.path,event:o.event}};this.sendMessage(a)})})}exit(e=0){return I(this,null,function*(){if(this._exiting)return this.once("exit");this._exiting=!0,this.storage.debug.warn(`Received ${this.isMaster?"master":"worker "+this.id} process exit request`),this._locks.length>0&&(this.storage.debug.warn(`Waiting for ${this.isMaster?"master":"worker"} ${this.id} locks to clear`),yield this.once("locks-cleared")),this.sayGoodbye(this.id),this.storage.debug.warn(`${this.isMaster?"Master":"Worker "+this.id} will now exit`),this.emitOnce("exit",e)})}sayGoodbye(e){const t={type:"bye",from:e,data:void 0};this.sendMessage(t)}addPeer(e,t=!0){if(this._exiting)return;if(this.peers.find(i=>i.id===e)||this.peers.push({id:e,lastSeen:Date.now()}),t){const i={type:"hello",from:this.id,to:e,data:void 0};this.sendMessage(i),this.ourSubscriptions.forEach(s=>{const o={type:"subscribe",from:this.id,to:e,data:{path:s.path,event:s.event}};this.sendMessage(o)})}}removePeer(e,t=!1){if(this._exiting)return;const n=this.peers.find(s=>s.id===e);if(!n){if(!t)throw new Error("We are supposed to know this peer!");return}this.peers.splice(this.peers.indexOf(n),1),this.remoteSubscriptions.filter(s=>s.for===e).forEach(s=>{this.remoteSubscriptions.splice(this.remoteSubscriptions.indexOf(s),1),this.storage.subscriptions.remove(s.path,s.event,s.callback)})}addRemoteSubscription(e,t){if(this._exiting||this.remoteSubscriptions.some(i=>i.for===e&&i.event===t.event&&i.path===t.path))return;const n=(i,s,o,a,c)=>{const u={type:"event",from:this.id,to:e,path:t.path,event:t.event,data:{path:s,val:o,previous:a,context:c}};this.sendMessage(u)};this.remoteSubscriptions.push({for:e,event:t.event,path:t.path,callback:n}),this.storage.subscriptions.add(t.path,t.event,n)}cancelRemoteSubscription(e,t){const n=this.remoteSubscriptions.find(i=>i.for===e&&i.event===t.event&&i.path===t.event);!n||this.storage.subscriptions.remove(t.path,t.event,n.callback)}handleMessage(e){return I(this,null,function*(){switch(e.type){case"hello":return this.addPeer(e.from,e.to!==this.id);case"bye":return this.removePeer(e.from,!0);case"subscribe":return this.addRemoteSubscription(e.from,e.data);case"unsubscribe":return this.cancelRemoteSubscription(e.from,e.data);case"event":{if(!this._eventsEnabled)break;const t=e,n=t.data.context||{};n.acebase_ipc={type:this.ipcType,origin:t.from},this.ourSubscriptions.filter(s=>s.event===t.event&&s.path===t.path).forEach(s=>{s.callback(null,t.data.path,t.data.val,t.data.previous,n)});break}case"lock-request":{if(!this.isMaster)throw new Error("Workers are not supposed to receive lock requests!");const t=e,n={type:"lock-result",id:t.id,from:this.id,to:t.from,ok:!0,data:void 0};try{const i=yield this.lock(t.data);n.data={id:i.id,path:i.path,tid:i.tid,write:i.forWriting,expires:i.expires,comment:i.comment}}catch(i){n.ok=!1,n.reason=i.stack||i.message||i}return this.sendMessage(n)}case"lock-result":{if(this.isMaster)throw new Error("Masters are not supposed to receive results for lock requests!");const t=e,n=this._requests.get(t.id);if(typeof n!="object")throw new Error("The request must be known to us!");t.ok?n.resolve(t.data):n.reject(new Error(t.reason));return}case"unlock-request":{if(!this.isMaster)throw new Error("Workers are not supposed to receive unlock requests!");const t=e,n={type:"unlock-result",id:t.id,from:this.id,to:t.from,ok:!0,data:{id:t.data.id}};try{yield this._locks.find(s=>{var o;return((o=s.lock)==null?void 0:o.id)===t.data.id}).lock.release()}catch(i){n.ok=!1,n.reason=i.stack||i.message||i}return this.sendMessage(n)}case"unlock-result":{if(this.isMaster)throw new Error("Masters are not supposed to receive results for unlock requests!");const t=e,n=this._requests.get(t.id);if(typeof n!="object")throw new Error("The request must be known to us!");t.ok?n.resolve(t.data):n.reject(new Error(t.reason));return}case"move-lock-request":{if(!this.isMaster)throw new Error("Workers are not supposed to receive move lock requests!");const t=e,n={type:"lock-result",id:t.id,from:this.id,to:t.from,ok:!0,data:void 0};try{let i;const s=this._locks.find(o=>{var a;return((a=o.lock)==null?void 0:a.id)===t.data.id});if(t.data.move_to==="parent")i=yield s.lock.moveToParent();else throw new Error(`Unknown lock move_to "${t.data.move_to}"`);s.lock=i,n.data={id:i.id,path:i.path,tid:i.tid,write:i.forWriting,expires:i.expires,comment:i.comment}}catch(i){n.ok=!1,n.reason=i.stack||i.message||i}return this.sendMessage(n)}case"notification":return this.emit("notification",e);case"request":return this.emit("request",e);case"result":{const t=e,n=this._requests.get(t.id);if(typeof n!="object")throw new Error("Result of unknown request received");t.ok?n.resolve(t.data):n.reject(new Error(t.reason))}}})}lock(e){return I(this,null,function*(){if(this._exiting&&!this._locks.find(i=>i.tid===e.tid&&i.granted))throw new tf("new transaction lock denied because the IPC peer is exiting");const t=n=>{this._locks.splice(this._locks.indexOf(n),1),this._locks.length===0&&this.emit("locks-cleared")};if(this.isMaster){const n={tid:e.tid,granted:!1,request:e,lock:null};this._locks.push(n);const i=yield this._nodeLocker.lock(e.path,e.tid,e.write,e.comment);n.tid=i.tid,n.granted=!0;const s=o=>({get id(){return o.id},get tid(){return o.tid},get path(){return o.path},get forWriting(){return o.forWriting},get expires(){return o.expires},get comment(){return o.comment},get state(){return o.state},release:()=>I(this,null,function*(){yield o.release(),t(n)}),moveToParent:()=>I(this,null,function*(){const a=yield o.moveToParent();return n.lock=s(a),n.lock})});return n.lock=s(i),n.lock}else{const n={tid:e.tid,granted:!1,request:e,lock:null};this._locks.push(n);const i=c=>(n.granted=!0,n.tid=c.tid,n.lock={id:c.id,tid:c.tid,path:c.path,forWriting:c.write,state:De.LOCKED,expires:c.expires,comment:c.comment,release:()=>I(this,null,function*(){const u={type:"unlock-request",id:Ne.generate(),from:this.id,to:this.masterPeerId,data:{id:n.lock.id}};yield this.request(u),n.lock.state=De.DONE,this.storage.debug.verbose(`Worker ${this.id} released lock ${n.lock.id} (tid ${n.lock.tid}, ${n.lock.comment}, "/${n.lock.path}", ${n.lock.forWriting?"write":"read"})`),t(n)}),moveToParent:()=>I(this,null,function*(){const u={type:"move-lock-request",id:Ne.generate(),from:this.id,to:this.masterPeerId,data:{id:n.lock.id,move_to:"parent"}};let l;try{l=yield this.request(u)}catch(f){throw n.lock.state=De.DONE,t(n),f}return n.lock=i(l),n.lock})},n.lock),s={type:"lock-request",id:Ne.generate(),from:this.id,to:this.masterPeerId,data:e};let o,a;try{o=yield this.request(s)}catch(c){a=c,o=null}if(a)throw t(n),a;return i(o)}})}request(e){return I(this,null,function*(){let t,n;const i=new Promise((s,o)=>{t=a=>{this._requests.delete(e.id),s(a)},n=a=>{this._requests.delete(e.id),o(a)}});return this._requests.set(e.id,{resolve:t,reject:n,request:e}),this.sendMessage(e),i})}sendRequest(e){const t={type:"request",from:this.id,to:this.masterPeerId,id:Ne.generate(),data:e};return this.request(t).catch(n=>{throw this.storage.debug.error(n),n})}replyRequest(e,t){const n={type:"result",id:e.id,ok:!0,from:this.id,to:e.from,data:t};this.sendMessage(n)}sendNotification(e){const t={type:"notification",from:this.id,data:e};this.sendMessage(t)}get eventsEnabled(){return this._eventsEnabled}set eventsEnabled(e){this.storage.debug.log(`ipc events ${e?"enabled":"disabled"}`),this._eventsEnabled=e}}class rf extends nf{constructor(e){if(super(e,Ne.generate()),this.masterPeerId=this.id,this.ipcType="browser.bcc",window.addEventListener("beforeunload",()=>{this.exit()}),typeof window.BroadcastChannel!="undefined")this.channel=new BroadcastChannel(`acebase:${e.name}`);else{const n=[null],i=()=>{throw new Error("Not implemented")};this.channel={name:`acebase:${e.name}`,postMessage:s=>{const o=Ne.generate(),a=`acebase:${e.name}:${this.id}:${o}`,c=JSON.stringify(jo(s));localStorage.setItem(a,c),setTimeout(()=>localStorage.removeItem(a),10)},set onmessage(s){n[0]=s},set onmessageerror(s){i()},close(){i()},addEventListener(s,o){s!=="message"&&i(),n.push(o)},removeEventListener(s,o){const a=n.indexOf(o);a>=1&&n.splice(a,1)},dispatchEvent(s){return n.forEach(o=>{try{o&&o(s)}catch(a){console.error(a)}}),!0}},window.addEventListener("storage",s=>{const[o,a,c,u]=s.key.split(":");if(o!=="acebase"||a!==e.name||c===this.id||s.newValue===null)return;const l=Wl(JSON.parse(s.newValue));this.channel.dispatchEvent({data:l})})}this.channel.addEventListener("message",n=>I(this,null,function*(){const i=n.data;if(!(i.to&&i.to!==this.id)){if(e.debug.verbose("[BroadcastChannel] received: ",i),i.type==="hello"&&i.from<this.masterPeerId)this.masterPeerId=i.from,e.debug.log(`[BroadcastChannel] Tab ${this.masterPeerId} is the master.`);else if(i.type==="bye"&&i.from===this.masterPeerId){e.debug.log(`[BroadcastChannel] Master tab ${this.masterPeerId} is leaving`);const s=this.peers.map(a=>a.id).concat(this.id).filter(a=>a!==this.masterPeerId);this.masterPeerId=s.sort()[0],e.debug.log(`[BroadcastChannel] ${this.masterPeerId===this.id?"We are":`tab ${this.masterPeerId} is`} the new master. Requesting ${this._locks.length} locks (${this._locks.filter(a=>!a.granted).length} pending)`);const o=this._locks.splice(0);yield Promise.all(o.filter(a=>a.granted).map(a=>I(this,null,function*(){let c,u;a.lock.release=()=>new Promise(f=>c=f),a.lock.moveToParent=()=>new Promise(f=>u=f);const l=yield this.lock({path:a.lock.path,write:a.lock.forWriting,tid:a.lock.tid,comment:a.lock.comment});if(u){const f=yield l.moveToParent();u(f)}c&&(yield l.release(),c())}))),yield Promise.all(o.filter(a=>!a.granted).map(a=>I(this,null,function*(){yield this.lock(a.request)})))}return this.handleMessage(i)}}));const t={type:"hello",from:this.id,data:void 0};this.sendMessage(t)}sendMessage(e){this.storage.debug.verbose("[BroadcastChannel] sending: ",e),this.channel.postMessage(e)}}class Ut{static get hasFileSystem(){return!1}static get fs(){return null}}class hi extends Ue{}class Uo extends Ue{}class sf extends Ue{}class of extends Ue{}function af(r,e,t,n){return I(this,null,function*(){if(!r.storage.indexes.supported)throw new Error("Indexes are not supported in current environment because it requires Node.js fs");const{ipc:i,debug:s,indexes:o,storage:a}=r,c=n&&n.rebuild===!0,u=n&&n.type||"normal";let l=n&&n.include||[];typeof l=="string"&&(l=[l]);const f=o.find(d=>d.path===e&&d.key===t&&d.type===u&&d.includeKeys.length===l.length&&d.includeKeys.every((y,v)=>l[v]===y));if(f&&n.config&&(f.config=n.config),f&&c!==!0)return s.log(`Index on "/${e}/*/${t}" already exists`.colorize(Oe.inverse)),f;if(!i.isMaster){const d=yield i.sendRequest({type:"index.create",path:e,key:t,options:n});if(d.ok)return a.indexes.add(d.fileName);throw new Error(d.reason)}yield Ut.mkdir(`${a.settings.path}/${a.name}.acebase`).catch(d=>{if(d.code!=="EEXIST")throw d});const m=f||(()=>{const{include:d,caseSensitive:y,textLocale:v,textLocaleKey:A}=n,O={include:d,caseSensitive:y,textLocale:v,textLocaleKey:A};switch(u){case"array":return new of(a,e,t,N({},O));case"fulltext":return new Uo(a,e,t,ne(N({},O),{config:n.config}));case"geo":return new sf(a,e,t,N({},O));default:return new hi(a,e,t,N({},O))}})();f||o.push(m);try{yield m.build()}catch(d){throw r.debug.error(`Index build on "/${e}/*/${t}" failed: ${d.message} (code: ${d.code})`.colorize(Oe.red)),f||o.splice(o.indexOf(m),1),d}return i.sendNotification({type:"index.created",fileName:m.fileName,path:e,key:t,options:n}),m})}const{compareValues:En,getChildValues:St,encodeString:Ss,defer:cf}=_o,Wr=["value","child_added","child_changed","child_removed","mutated","mutations"];Wr.push(...Wr.map(r=>`notify_${r}`));const uf=()=>{};class lf extends Error{constructor(e){super(`Schema validation failed: ${e}`),this.reason=e}}class di{constructor(e={}){this.maxInlineValueSize=50,this.removeVoidProperties=!1,this.path=".",this.lockTimeout=120,this.type="data",this.readOnly=!1,typeof e.maxInlineValueSize=="number"&&(this.maxInlineValueSize=e.maxInlineValueSize),typeof e.removeVoidProperties=="boolean"&&(this.removeVoidProperties=e.removeVoidProperties),typeof e.path=="string"&&(this.path=e.path),this.path.endsWith("/")&&(this.path=this.path.slice(0,-1)),typeof e.lockTimeout=="number"&&(this.lockTimeout=e.lockTimeout),typeof e.type=="string"&&(this.type=e.type),typeof e.readOnly=="boolean"&&(this.readOnly=e.readOnly),["object","string"].includes(typeof e.ipc)&&(this.ipc=e.ipc)}}class ff extends Ht{createTid(){return Ne.generate()}constructor(e,t,n){super(),this.name=e,this.settings=t,this._schemas=[],this._indexes=[],this._annoucedIndexes=new Map,this.indexes={get supported(){return Ut==null?void 0:Ut.hasFileSystem},create:(s,o,a={rebuild:!1})=>{const c={storage:this,debug:this.debug,indexes:this._indexes,ipc:this.ipc};return af(c,s,o,a)},get:(s,o=null)=>{if(s.includes("$")){const a=$.getPathKeys(s).map(c=>typeof c=="string"&&c.startsWith("$")?"*":c);s=new $(a).path}return this._indexes.filter(a=>a.path===s&&(o===null||o===a.key))},getAll:(s,o={parentPaths:!0,childPaths:!0})=>{const a=$.getPathKeys(s);return this._indexes.filter(c=>{const u=$.getPathKeys(c.path+"/*");return o.parentPaths&&u.every((l,f)=>l==="*"||a[f]===l)&&[c.key].concat(...c.includeKeys).includes(a[u.length])?!0:u.length<a.length||!o.childPaths&&u.length!==a.length?!1:a.every((l,f)=>[l,"*"].includes(u[f]))})},list:()=>this._indexes.slice(),load:()=>I(this,null,function*(){if(this._indexes.splice(0),!Ut.hasFileSystem)return;let s=[];try{s=yield Ut.readdir(`${this.settings.path}/${this.name}.acebase`)}catch(a){a.code!=="ENOENT"&&this.debug.error(a)}const o=[];s.forEach(a=>{if(!a.endsWith(".idx"))return;const c=this.settings.type!=="data",u=/^\[[a-z]+\]-/.test(a);if(!c&&!u||c&&a.startsWith(`[${this.settings.type}]-`)){const l=this.indexes.add(a);o.push(l)}}),yield Promise.all(o)}),add:s=>I(this,null,function*(){const o=this._indexes.find(a=>a.fileName===s);if(o)return o;if(this._annoucedIndexes.has(s))return yield this._annoucedIndexes.get(s);try{const a=hi.readFromFile(this,s);this._annoucedIndexes.set(s,a);const c=yield a;return this._indexes.push(c),this._annoucedIndexes.delete(s),c}catch(a){return this.debug.error(a),null}}),delete:s=>I(this,null,function*(){const o=yield this.indexes.remove(s);yield o.delete(),this.ipc.sendNotification({type:"index.deleted",fileName:o.fileName,path:o.path,keys:o.key})}),remove:s=>I(this,null,function*(){const o=this._indexes.find(a=>a.fileName===s);if(!o)throw new Error(`Index ${s} not found`);return this._indexes.splice(this._indexes.indexOf(o),1),o}),close:()=>I(this,null,function*(){const s=this.indexes.list().map(o=>o.close().catch(a=>this.debug.error(a)));yield Promise.all(s)})},this._eventSubscriptions={},this.subscriptions={add:(s,o,a)=>{if(Wr.indexOf(o)<0)throw new TypeError(`Invalid event type "${o}"`);let c=this._eventSubscriptions[s];c||(c=this._eventSubscriptions[s]=[]),c.push({created:Date.now(),type:o,callback:a}),this.emit("subscribe",{path:s,event:o,callback:a})},remove:(s,o,a)=>{const c=this._eventSubscriptions[s];if(!c)return;const u=()=>c.findIndex(f=>(o?f.type===o:!0)&&(a?f.callback===a:!0));let l;for(;(l=u())>=0;)c.splice(l,1);this.emit("unsubscribe",{path:s,event:o,callback:a})},hasValueSubscribersForPath(s){return!!this.getValueSubscribersForPath(s)},getValueSubscribersForPath:s=>{const o=new $(s),a=[];return Object.keys(this._eventSubscriptions).forEach(c=>{if(o.equals(c)||o.isDescendantOf(c)){const u=this._eventSubscriptions[c],l=$.fillVariables(c,s);u.filter(f=>!f.type.startsWith("notify_")).forEach(f=>{let m=null;if(f.type==="value")m=l;else if(["mutated","mutations"].includes(f.type)&&o.isDescendantOf(l))m=s;else if(f.type==="child_changed"&&s!==l){const d=$.getPathKeys(s.slice(l.length).replace(/^\//,""))[0];m=$.getChildPath(l,d)}else if(["child_added","child_removed"].includes(f.type)&&o.isChildOf(l)){const d=$.getPathKeys(s.slice(l.length).replace(/^\//,""))[0];m=$.getChildPath(l,d)}m!==null&&!a.some(d=>d.type===f.type&&d.eventPath===l)&&a.push({type:f.type,eventPath:l,dataPath:m,subscriptionPath:c})})}}),a},getAllSubscribersForPath:s=>{const o=$.get(s),a=[];return Object.keys(this._eventSubscriptions).forEach(c=>{if(o.isOnTrailOf(c)){const u=this._eventSubscriptions[c],l=$.fillVariables(c,s);u.forEach(f=>{let m=null;if(f.type==="value"||f.type==="notify_value")m=l;else if(["child_changed","notify_child_changed"].includes(f.type)){const d=s===l||o.isAncestorOf(l)?"*":$.getPathKeys(s.slice(l.length).replace(/^\//,""))[0];m=$.getChildPath(l,d)}else if(["mutated","mutations","notify_mutated","notify_mutations"].includes(f.type))m=s;else if(["child_added","child_removed","notify_child_added","notify_child_removed"].includes(f.type)&&(o.isChildOf(l)||s===l||o.isAncestorOf(l))){const d=s===l||o.isAncestorOf(l)?"*":$.getPathKeys(s.slice(l.length).replace(/^\//,""))[0];m=$.getChildPath(l,d)}m!==null&&!a.some(d=>d.type===f.type&&d.eventPath===l&&d.subscriptionPath===c)&&a.push({type:f.type,eventPath:l,dataPath:m,subscriptionPath:c})})}}),a},trigger:(s,o,a,c,u,l)=>{(this._eventSubscriptions[o]||[]).filter(m=>m.type===s).forEach(m=>{m.callback(null,a,u,c,l)})}},this.debug=new No(n.logLevel,`[${e}${typeof t.type=="string"&&t.type!=="data"?`:${t.type}`:""}]`);const i=e+(typeof t.type=="string"?`_${t.type}`:"");if(t.ipc==="socket"||t.ipc instanceof Ue){const s={ipcName:i,server:t.ipc instanceof Ue?t.ipc:null};this.ipc=new Ue(this,s)}else if(t.ipc){if(typeof t.ipc.port!="number")throw new Error("IPC port number must be a number");if(!["master","worker"].includes(t.ipc.role))throw new Error(`IPC client role must be either "master" or "worker", not "${t.ipc.role}"`);const s=Object.assign({dbname:i},t.ipc);this.ipc=new Ue(this,s)}else this.ipc=new rf(this,i);this.ipc.once("exit",s=>{this.indexes.supported&&this.indexes.close()}),this.nodeLocker={lock:(s,o,a,c)=>this.ipc.lock({path:s,tid:o,write:a,comment:c})},this._lastTid=0}close(){return I(this,null,function*(){yield this.ipc.exit()})}get path(){return`${this.settings.path}/${this.name}.acebase`}valueFitsInline(e){if(typeof e=="number"||typeof e=="boolean"||e instanceof Date)return!0;if(typeof e=="string")return e.length>this.settings.maxInlineValueSize?!1:Ss(e).length<this.settings.maxInlineValueSize;if(e instanceof me)return e.path.length>this.settings.maxInlineValueSize?!1:Ss(e.path).length<this.settings.maxInlineValueSize;if(e instanceof ArrayBuffer)return e.byteLength<this.settings.maxInlineValueSize;if(e instanceof Array)return e.length===0;if(typeof e=="object")return Object.keys(e).length===0;throw new TypeError("What else is there?")}_writeNode(e,t,n){throw new Error("This method must be implemented by subclass")}getUpdateImpact(e,t){let n=e,i=!1;const s=t?[]:this.subscriptions.getAllSubscribersForPath(e),o=t?[]:this.subscriptions.getValueSubscribersForPath(e);o.length>0&&(i=!0,n=o.map(f=>({path:f.dataPath,keys:$.getPathKeys(f.dataPath)})).sort((f,m)=>f.keys.length<m.keys.length?-1:f.keys.length>m.keys.length?1:0)[0].path,o.filter(f=>f.dataPath===n).every(f=>f.type==="mutated"||f.type.startsWith("notify_"))&&(i=!1),n=$.fillVariables(n,e));const a=this.indexes.getAll(e,{childPaths:!0,parentPaths:!0}).map(u=>({index:u,keys:$.getPathKeys(u.path)})).sort((u,l)=>u.keys.length<l.keys.length?-1:u.keys.length>l.keys.length?1:0).map(u=>u.index),c=[];if(a.length>0){a.sort((f,m)=>(typeof f._pathKeys=="undefined"&&(f._pathKeys=$.getPathKeys(f.path)),typeof m._pathKeys=="undefined"&&(m._pathKeys=$.getPathKeys(m.path)),f._pathKeys.length<m._pathKeys.length?-1:f._pathKeys.length>m._pathKeys.length?1:0));const u=a[0],l=u.path===e?e:$.fillVariables(`${u.path}/*`,e);l.length<n.length&&(n=l,a.filter(f=>f.path===u.path).forEach(f=>{[f.key].concat(f.includeKeys).forEach(d=>!c.includes(d)&&c.push(d))}))}return{topEventPath:n,eventSubscriptions:s,valueSubscribers:o,hasValueSubscribers:i,indexes:a,keysFilter:c}}_writeNodeWithTracking(i,s){return I(this,arguments,function*(e,t,n={merge:!1,waitForIndexUpdates:!0,suppress_events:!1,context:null,impact:null}){if(n=n||{},!n.tid&&!n.transaction)throw new Error("_writeNodeWithTracking MUST be executed with a tid OR transaction!");n.merge=n.merge===!0;const o=this.validateSchema(e,t,{updates:n.merge});if(!o.ok)throw new lf(o.reason);const a=n.tid,c=n.transaction;let u=null;const l=n.impact?n.impact:this.getUpdateImpact(e,n.suppress_events),{topEventPath:f,eventSubscriptions:m,hasValueSubscribers:d,indexes:y}=l;let{keysFilter:v}=l;const A=()=>{if(typeof n._customWriteFunction=="function")return n._customWriteFunction();if(u){const P=$.getPathKeys(e),g=$.getPathKeys(f),h=P.slice(g.length);let p=u;for(;h.length>0&&p!==null;){const w=h.shift();p=typeof p=="object"&&w in p?p[w]:null}n.currentValue=p}return this._writeNode(e,t,n)},O=this.settings.transactions&&this.settings.transactions.log===!0;if(m.length===0&&y.length===0&&!O)return A();if(!d&&n.merge===!0&&v.length===0&&(v=Object.keys(t),f!==e)){const P=e.slice(f.length);v=v.map(g=>`${P}/${g}`)}const C=yield this.getNodeInfo(f,{transaction:c,tid:a});let R=null;if(C.exists){const P={transaction:c,tid:a};v.length>0&&(P.include=v),f===""&&typeof P.include=="undefined"&&this.debug.warn('WARNING: One or more value event listeners on the root node are causing the entire database value to be read to facilitate change tracking. Using "value", "notify_value", "child_changed" and "notify_child_changed" events on the root node are a bad practice because of the significant performance impact. Use "mutated" or "mutations" events instead'),R=(yield this.getNode(f,P)).value}u=R;const U=(yield A())||{};let z,W;if(e===f)n.merge?u===null?z=t instanceof Array?[]:{}:(z=u instanceof Array?[]:{},Object.keys(u).forEach(P=>{z[P]=u[P]})):z=t,W=z;else{const P=e.slice(f.length).replace(/^\//,""),g=$.getPathKeys(P);for(u===null?z=typeof g[0]=="number"?[]:{}:(z=u instanceof Array?[]:{},Object.keys(u).forEach(h=>{z[h]=u[h]})),W=z;g.length>0;){const h=g.shift();if(!n.merge&&g.length===0)W[h]=t;else{const p=W[h],w=typeof h=="number"?[...p]:N({},p);W[h]=w}W=W[h]}}n.merge&&Object.keys(t).forEach(P=>{W[P]=t[P]});const te=En(u,z);if(te==="identical")return U.mutations=[],U;function le(P){if(P===null||typeof P!="object")return P;Object.keys(P).forEach(g=>{const h=P[g];h===null&&(delete P[g],P instanceof Array&&P.length--),typeof h=="object"&&le(h)})}le(z);const ce=[];y.map(P=>({index:P,keys:$.getPathKeys(P.path)})).sort((P,g)=>P.keys.length<g.keys.length?1:P.keys.length>g.keys.length?-1:0).forEach(({index:P})=>{const g=$.getPathKeys(f),h=$.getPathKeys(P.path+"/*"),p=h.slice(g.length),w=u,b=z;if(p.length===0){Le(g.length===h.length,"check logic");const k=this.ipc.isMaster?P.handleRecordUpdate(f,w,b):this.ipc.sendRequest({type:"index.update",fileName:P.fileName,path:f,oldValue:w,newValue:b});ce.push(k);return}const E=(k,_,S)=>{if(_===null&&S===null)return[];const T=$.getPathKeys(k),D=$.getPathKeys(P.path+"/*"),L=D.slice(T.length);if(L.length===0)return Le(T.length===D.length,"check logic"),[{path:k,oldValue:_,newValue:S}];let B=[],Y="";for(;L.length>0;){const re=L.shift();if(typeof re=="string"&&(re==="*"||re.startsWith("$"))){const Q=_===null?[]:Object.keys(_);S!==null&&Object.keys(S).forEach(oe=>{Q.indexOf(oe)<0&&Q.push(oe)}),Q.forEach(oe=>{const X=$.getChildPath(Y,oe),ue=St(oe,_,S),Ie=$.getChildPath(k,X),fe=E(Ie,ue.oldValue,ue.newValue);B=B.concat(fe)});break}else{const Q=St(re,_,S);if(_=Q.oldValue,S=Q.newValue,_===null&&S===null)break;Y=$.getChildPath(Y,re)}}return B};E(f,w,b).forEach(k=>{const _=this.ipc.isMaster?P.handleRecordUpdate(k.path,k.oldValue,k.newValue):this.ipc.sendRequest({type:"index.update",fileName:P.fileName,path:k.path,oldValue:k.oldValue,newValue:k.newValue});ce.push(_)})});const F=(P,g,h,p=[])=>{let w=!0,b=P.type;if(b.startsWith("notify_")&&(b=b.slice(7)),b==="mutated"||(b==="child_changed"&&(g===null||h===null)?w=!1:b==="value"||b==="child_changed"?w=En(g,h)!=="identical":b==="child_added"?w=g===null&&h!==null:b==="child_removed"&&(w=g!==null&&h===null),!w))return;const E=$.getPathKeys(P.dataPath);p.forEach(k=>{const _=E.indexOf(k.name);Le(_>=0,`Variable "${k.name}" not found in subscription dataPath "${P.dataPath}"`),E[_]=k.value});const x=E.reduce((k,_)=>$.getChildPath(k,_),"");this.subscriptions.trigger(P.type,P.subscriptionPath,x,g,h,n.context)},M=(P,g,h,p)=>{const w=[],b=p||En(g,h);return b==="identical"||(typeof b=="string"?w.push({path:P,oldValue:g,newValue:h}):(b.changed.forEach(E=>{const x=$.getChildPath(P,E.key),k=St(E.key,g,h),_=M(x,k.oldValue,k.newValue,E.change);w.push(..._)}),b.added.forEach(E=>{const x=$.getChildPath(P,E);w.push({path:x,oldValue:null,newValue:h[E]})}),g instanceof Array&&h instanceof Array&&b.removed.sort((E,x)=>E<x?1:-1),b.removed.forEach(E=>{const x=$.getChildPath(P,E);w.push({path:x,oldValue:g[E],newValue:null})}))),w};O&&this.settings.type!=="transaction"&&(U.mutations=(()=>{const P=e.slice(f.length).replace(/^\//,""),g=$.getPathKeys(P);let h=u,p=z;for(;g.length>0;){const x=g.shift();({oldValue:h,newValue:p}=St(x,h,p))}const w=En(h,p);return M(e,h,p,w).map(x=>({target:$.getPathKeys(x.path.slice(e.length)),prev:x.oldValue,val:x.newValue}))})());const G=()=>{m.filter(g=>!["mutated","mutations","notify_mutated","notify_mutations"].includes(g.type)).map(g=>{const h=$.getPathKeys(g.dataPath);return{sub:g,keys:h}}).sort((g,h)=>g.keys.length<h.keys.length?1:g.keys.length>h.keys.length?-1:0).forEach(({sub:g})=>{const h=(p,w,b,E=[])=>{const x=g.dataPath.slice(p.length).replace(/^\//,""),k=$.getPathKeys(x);for(;k.length>0;){const _=k.shift();if(typeof _=="string"&&(_==="*"||_[0]==="$")){const S=w===null?[]:Object.keys(w).map(T=>w instanceof Array?parseInt(T):T);b!==null&&Object.keys(b).forEach(T=>{const D=b instanceof Array?parseInt(T):T;!S.includes(D)&&S.push(T)}),S.forEach(T=>{const D=St(T,w,b),L=E.concat({name:_,value:T});k.length===0?F(g,D.oldValue,D.newValue,L):h($.getChildPath(p,_),D.oldValue,D.newValue,L)});return}else{p=$.getChildPath(p,_);const S=St(_,w,b);w=S.oldValue,b=S.newValue}}F(g,w,b,E)};if(g.type.startsWith("notify_")&&$.get(g.eventPath).isAncestorOf(f)){const p=$.get(g.eventPath).isParentOf(f);(g.type==="notify_value"||g.type==="notify_child_changed"&&(!p||!["added","removed"].includes(te))||g.type==="notify_child_removed"&&te==="removed"&&p||g.type==="notify_child_added"&&te==="added"&&p)&&this.subscriptions.trigger(g.type,g.subscriptionPath,g.dataPath,null,null,n.context)}else h(f,u,z)}),m.filter(g=>["mutated","mutations","notify_mutated","notify_mutations"].includes(g.type)).forEach(g=>{let h=f;const p=g.eventPath.slice(h.length).replace(/^\//,""),w=$.getPathKeys(p);let b=u,E=z;for(;w.length>0;){const _=w.shift();h=$.getChildPath(h,_);const S=St(_,b,E);b=S.oldValue,E=S.newValue}const x=M(h,b,E);if(x.length===0)return;const k=g.type.startsWith("notify_");if(["mutated","notify_mutated"].includes(g.type))x.forEach((_,S)=>{const T=n.context,D=k?null:_.oldValue,L=k?null:_.newValue;this.subscriptions.trigger(g.type,g.subscriptionPath,_.path,D,L,T)});else if(["mutations","notify_mutations"].includes(g.type)){const _=k?null:x.map(S=>({target:$.getPathKeys(S.path.slice(g.subscriptionPath.length)),prev:S.oldValue,val:S.newValue}));this.subscriptions.trigger(g.type,g.subscriptionPath,g.subscriptionPath,null,_,n.context)}})};return n.waitForIndexUpdates===!1&&ce.splice(0),yield Promise.all(ce),cf(G),U})}getChildren(e,t){throw new Error("This method must be implemented by subclass")}getNodeValue(n){return I(this,arguments,function*(e,t={}){return(yield this.getNode(e,t)).value})}getNode(e,t){throw new Error("This method must be implemented by subclass")}getNodeInfo(e,t){throw new Error("This method must be implemented by subclass")}setNode(e,t,n){throw new Error("This method must be implemented by subclass")}updateNode(e,t,n){throw new Error("This method must be implemented by subclass")}transactNode(i,s){return I(this,arguments,function*(e,t,n={no_lock:!1,suppress_events:!1,context:null}){const o=n&&n.no_lock===!0,a=this.createTid(),c=o?{tid:a,release:uf}:yield this.nodeLocker.lock(e,a,!0,"transactNode");try{let u=!1;const l=()=>{u=!0};o&&this.subscriptions.add(e,"notify_value",l);const f=yield this.getNode(e,{tid:a}),m=f.revision;let d;try{d=t(f.value),d instanceof Promise&&(d=yield d.catch(v=>{this.debug.error(`Error in transaction callback: ${v.message}`)}))}catch(v){this.debug.error(`Error in transaction callback: ${v.message}`)}if(typeof d=="undefined")return;if(o&&this.subscriptions.remove(e,"notify_value",l),u)throw new Kr("Node changed");return yield this.setNode(e,d,{assert_revision:m,tid:c.tid,suppress_events:n.suppress_events,context:n.context})}catch(u){if(u instanceof Kr)return console.warn(`node value changed, running again. Error: ${u.message}`),this.transactNode(e,t,n);throw u}finally{c.release()}})}matchNode(e,t,n){return I(this,null,function*(){var a;const i=(a=n==null?void 0:n.tid)!=null?a:Ne.generate(),s=(c,u)=>I(this,null,function*(){if(u.length===0)return Promise.resolve(!0);const l=u.reduce((y,v)=>{let A=v.key;return typeof A=="string"&&A.includes("/")&&(A=A.slice(0,A.indexOf("/"))),y.indexOf(A)<0&&y.push(A),y},[]),f=l.slice();let m=!0;const d=[];try{return yield this.getChildren(c,{tid:i,keyFilter:l}).next(y=>{var C;const v=(C=y.key)!=null?C:y.index;f.includes(v)&&f.splice(f.indexOf(y.key),1);const A=u.filter(R=>R.key===v).map(R=>({op:R.op,compare:R.compare})),O=A.length>0?o(y,A):{isMatch:!0,promises:[]};if(m=O.isMatch,m){d.push(...O.promises);const R=u.filter(U=>typeof U.key=="string"&&U.key.startsWith(`${typeof v=="number"?`[${v}]`:v}/`)).map(U=>({key:U.key.slice(U.key.indexOf("/")+1),op:U.op,compare:U.compare}));if(R.length>0){const U=$.getChildPath(c,y.key),z=s(U,R).then(W=>({isMatch:W}));d.push(z)}}if(!m||f.length===0)return!1}),m&&(m=(yield Promise.all(d)).every(v=>v.isMatch)),m?(m=f.every(y=>{const v=new Lo(ne(N(N({},typeof y=="number"&&{index:y}),typeof y=="string"&&{key:y}),{exists:!1})),A=u.filter(R=>typeof R.key=="string"&&R.key.startsWith(`${typeof y=="number"?`[${y}]`:y}/`)).map(R=>({op:R.op,compare:R.compare}));if(A.length>0&&!o(v,A).isMatch)return!1;const O=u.filter(R=>R.key===y).map(R=>({op:R.op,compare:R.compare}));return O.length===0?!0:o(v,O).isMatch}),m):!1}catch(y){throw this.debug.error(`Error matching on "${c}": `,y),y}}),o=(c,u)=>{const l=[];return{isMatch:u.every(m=>{let d=!0;if(m.op==="!exists"||m.op==="=="&&(typeof m.compare=="undefined"||m.compare===null))d=!c.exists;else if(m.op==="exists"||m.op==="!="&&(typeof m.compare=="undefined"||m.compare===null))d=c.exists;else if((m.op==="contains"||m.op==="!contains")&&m.compare instanceof Array&&m.compare.length===0)d=!0;else if(!c.exists)d=!1;else if(c.address)if(c.valueType===K.OBJECT&&["has","!has"].indexOf(m.op)>=0){const y=m.op==="has"?"exists":"!exists",v=s(c.path,[{key:m.compare,op:y}]).then(A=>({key:c.key,isMatch:A}));l.push(v),d=!0}else if(c.valueType===K.ARRAY&&["contains","!contains"].indexOf(m.op)>=0){const y=this.getNode(c.path,{tid:i}).then(({value:v})=>{const A=m.op==="contains"?m.compare instanceof Array?m.compare.every(O=>v.includes(O)):v.includes(m.compare):m.compare instanceof Array?!m.compare.some(O=>v.includes(O)):!v.includes(m.compare);return{key:c.key,isMatch:A}});l.push(y),d=!0}else if(c.valueType===K.STRING){const y=this.getNode(c.path,{tid:i}).then(v=>({key:c.key,isMatch:this.test(v.value,m.op,m.compare)}));l.push(y),d=!0}else d=!1;else if(c.type===K.OBJECT&&["has","!has"].indexOf(m.op)>=0){const y=m.compare in c.value;d=y&&m.op==="has"||!y&&m.op==="!has"}else if(c.type===K.ARRAY&&["contains","!contains"].indexOf(m.op)>=0){const y=c.value.indexOf(m.compare)>=0;d=y&&m.op==="contains"||!y&&m.op==="!contains"}else{let y=this.test(c.value,m.op,m.compare);y instanceof Promise&&(l.push(y),y=!0),d=y}return d}),promises:l}};return s(e,t)})}test(e,t,n){if(t==="<")return e<n;if(t==="<=")return e<=n;if(t==="==")return e===n;if(t==="!=")return e!==n;if(t===">")return e>n;if(t===">=")return e>=n;if(t==="in")return n.indexOf(e)>=0;if(t==="!in")return n.indexOf(e)<0;if(t==="like"||t==="!like"){const i="^"+n.replace(/[-[\]{}()+.,\\^$|#\s]/g,"\\$&").replace(/\?/g,".").replace(/\*/g,".*?")+"$",o=new RegExp(i,"i").test(e.toString());return t==="like"?o:!o}if(t==="matches")return n.test(e.toString());if(t==="!matches")return!n.test(e.toString());if(t==="between")return e>=n[0]&&e<=n[1];if(t==="!between")return e<n[0]||e>n[1];if(t==="has"||t==="!has"){const i=typeof e=="object"&&n in e;return t==="has"?i:!i}if(t==="contains"||t==="!contains"){const i=typeof e=="object"&&e instanceof Array&&e.includes(n);return t==="contains"?i:!i}return!1}exportNode(i,s){return I(this,arguments,function*(e,t,n={format:"json",type_safe:!0}){if((n==null?void 0:n.format)!=="json")throw new Error("Only json output is currently supported");const o=typeof t!="function"?t.write.bind(t):t,a=(y,v)=>{const A=O=>O.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/[\u0000-\u001f]/g,C=>`\\u${C.charCodeAt(0).toString(16).padStart(4,"0")}`);return y===K.DATETIME?(v=`"${v.toISOString()}"`,n.type_safe&&(v=`{".type":"date",".val":${v}}`)):y===K.STRING?v=`"${A(v)}"`:y===K.ARRAY?v="[]":y===K.OBJECT?v="{}":y===K.BINARY?(v=`"${A(lt.encode(v))}"`,n.type_safe&&(v=`{".type":"binary",".val":${v}}`)):y===K.REFERENCE?(v=`"${v.path}"`,n.type_safe&&(v=`{".type":"reference",".val":${v}}`)):y===K.BIGINT&&(v=`"${v}"`,n.type_safe&&(v=`{".type":"bigint",".val":${v}}`)),v};let c="",u="";const l=yield this.getNodeInfo(e);if(l.exists)if(l.type===K.OBJECT)c="{",u="}";else if(l.type===K.ARRAY)c="[",u="]";else{const y=yield this.getNode(e),v=a(l.type,y.value);return o(v)}else return o("null");if(c){const y=o(c);y instanceof Promise&&(yield y)}let f="",m=0;const d=[];if(yield this.getChildren(e).next(y=>{y.address?d.push(y):(m++>0&&(f+=","),typeof y.key=="string"&&(f+=`"${y.key}":`),f+=a(y.type,y.value))}),f){const y=o(f);y instanceof Promise&&(yield y)}for(;d.length>0;){const y=d.shift();let v=m++>0?",":"";const A=typeof y.index=="number"?y.index:y.key;if(typeof A=="string"&&(v+=`"${A}":`),v){const O=o(v);O instanceof Promise&&(yield O)}yield this.exportNode($.getChildPath(e,A),o,n)}if(u){const y=o(u);y instanceof Promise&&(yield y)}})}importNode(i,s){return I(this,arguments,function*(e,t,n={format:"json",method:"set"}){const a={data:"",index:0,offset:0,queue:[],queueStartByte:0,timesFlushed:0,get processedBytes(){return this.offset+this.index}},c=(F=!1)=>I(this,null,function*(){let M=yield t(262144);if(M===null)throw a.data?new Error(`Unexpected EOF at index ${a.offset+a.data.length}`):new Error("Unable to read data from stream");typeof M=="object"&&(M=Eo(M)),F?a.data+=M:(a.offset+=a.data.length,a.data=M,a.index=0)}),u=F=>I(this,null,function*(){let M="";return a.index+F>=a.data.length&&(M=a.data.slice(a.index),F-=M.length,yield c()),M+=a.data.slice(a.index,a.index+F),a.index+=F,M}),l=F=>I(this,null,function*(){if(a.index+F>a.data.length&&(yield c(!0)),a.index+F>a.data.length)throw new Error("Not enough data available from stream")}),f=F=>I(this,null,function*(){const M=yield u(F.length);if(M!==F)throw new Error(`Unexpected character "${M[0]}" at index ${a.offset+a.index}, expected "${F}"`)}),m=()=>I(this,null,function*(){const F=[" ","	","\r",`
`];for(;a.index>=a.data.length&&(yield c()),F.includes(a.data[a.index]);)a.index++}),d=F=>I(this,null,function*(){yield l(F);const M=a.index;return a.data.slice(M,M+F)}),y=()=>I(this,null,function*(){yield m();const F=yield d(1);switch(F){case'"':return"string";case"{":return"object";case"[":return"array";case"n":return"null";case"u":return"undefined";case"t":case"f":return"boolean";default:{if(F==="-"||F>="0"&&F<="9")return"number";throw new Error(`Unknown value at index ${a.offset+a.index}`)}}}),v=()=>I(this,null,function*(){yield f('"');let F="",M=a.index;for(;a.data[M]!=='"'||a.data[M-1]==="\\";)M++,M>=a.data.length&&(F+=a.data.slice(a.index),yield c(),M=0);return F+=a.data.slice(a.index,M),a.index=M+1,R(F)}),A=()=>I(this,null,function*(){throw a.data[a.index]==="t"?yield f("true"):a.data[a.index]==="f"&&(yield f("false")),new Error(`Expected true or false at index ${a.offset+a.index}`)}),O=()=>I(this,null,function*(){let F="",M=a.index;const G=["-","0","1","2","3","4","5","6","7","8","9",".","e","b","f","x","o","n"];for(;G.includes(a.data[M]);)M++,M>=a.data.length&&(F+=a.data.slice(a.index),yield c(),M=0);return F+=a.data.slice(a.index,M),a.index=M,F.endsWith("n")?BigInt(F.slice(0,-1)):F.includes(".")?parseFloat(F):parseInt(F)}),C=()=>I(this,null,function*(){yield m();const F=yield y(),M=yield(()=>{switch(F){case"string":return v();case"object":return{};case"array":return[];case"number":return O();case"null":return null;case"undefined":return;case"boolean":return A()}})();return{type:F,value:M}}),R=F=>F.replace(/\\n/g,`
`).replace(/\\"/g,'"'),U=(F,M)=>{const G=M[".type"];let P=M[".val"];switch(G){case"Date":case"date":{P=new Date(P);break}case"Buffer":case"binary":{if(P=R(P),P.startsWith("<~"))P=lt.decode(P);else throw new Error(`Import error: Unexpected encoding for value for value at path "/${F}"`);break}case"PathReference":case"reference":{P=new me(P);break}case"bigint":{P=BigInt(P);break}default:throw new Error(`Import error: Unsupported type "${G}" for value at path "/${F}"`)}return P},z={acebase_import_id:Ne.generate()},W={suppress_events:n.suppress_events,context:z},te=F=>I(this,null,function*(){if(yield f("{"),yield m(),(yield d(1))==="}")return a.index++,this.setNode(F.path,{},W);let G=0,P={},g=!1;const h=()=>I(this,null,function*(){let b;g?Object.keys(P).length>0&&(b=this.updateNode(F.path,P,W)):(g=!0,b=this.setNode(F.path,P,W)),P={},b&&(yield b)}),p=[];for(;;){yield m();const b=yield v();yield m(),yield f(":"),yield m();const{value:E,type:x}=yield C();if(P[b]=E,G++,["object","array"].includes(x)&&(p.push(h()),x==="object"?yield te(F.child(b)):yield le(F.child(b))),yield m(),(yield d(1))==="}"){a.index++;break}yield f(",")}if(G===2&&".type"in P&&".val"in P){const b=U(F.path,P);return this.setNode(F.path,b,W)}p.push(h()),yield Promise.all(p)}),le=F=>I(this,null,function*(){if(yield f("["),yield m(),(yield d(1))==="]")return a.index++,this.setNode(F.path,[],W);let G=!1,P=[],g={};const h=()=>I(this,null,function*(){let E;G?Object.keys(g).length>0&&(E=this.updateNode(F.path,g,W),g={}):(G=!0,E=this.setNode(F.path,P,W),P=null),E&&(yield E)}),p=(E,x)=>{G?g[x]=E:P.push(E)},w=[];let b=0;for(;;){yield m();const{value:E,type:x}=yield C();if(p(E,b),["object","array"].includes(x)&&(w.push(h()),x==="object"?yield te(F.child(b)):yield le(F.child(b))),yield m(),(yield d(1))==="]"){a.index++;break}yield f(","),b++}w.push(h()),yield Promise.all(w)});return(()=>I(this,null,function*(){const{value:F,type:M}=yield C();if(["object","array"].includes(M)){const G=$.get(e);M==="object"?yield te(G):yield le(G)}else yield this.setNode(e,F,W)}))()})}setSchema(e,t,n=!1){if(typeof t=="undefined")throw new TypeError("schema argument must be given");if(t===null){const o=this._schemas.findIndex(a=>a.path===e);o>=0&&this._schemas.splice(o,1);return}const i=new Yl(t,{warnOnly:n,warnCallback:o=>this.debug.warn(o)}),s=this._schemas.find(o=>o.path===e);s?s.schema=i:(this._schemas.push({path:e,schema:i}),this._schemas.sort((o,a)=>{const c=$.getPathKeys(o.path),u=$.getPathKeys(a.path);return c.length===u.length?0:c.length<u.length?-1:1}))}getSchema(e){const t=this._schemas.find(n=>n.path===e);return t?{path:e,schema:t.schema.source,text:t.schema.text}:null}getSchemas(){return this._schemas.map(e=>({path:e.path,schema:e.schema.source,text:e.schema.text}))}validateSchema(e,t,n={updates:!1}){let i={ok:!0};const s=$.get(e);return this._schemas.filter(o=>s.isOnTrailOf(o.path)).every(o=>{if(s.isDescendantOf(o.path)){const l=$.fillVariables(o.path,e),f=s.keys.slice($.getPathKeys(o.path).length);return i=o.schema.check(l,t,n.updates,f),i.ok}const a=$.getPathKeys(o.path).slice(s.keys.length);if(n.updates===!0&&a.length>0&&!(a[0]in t))return i.ok;const c=n.updates===!0&&a.length===0,u=(l,f,m)=>{if(m.length===0)return o.schema.check(l,f,c);if(f===null)return{ok:!0};const d=m[0];if(typeof d=="string"&&(d==="*"||d[0]==="$")){if(f===null||typeof f!="object")return{ok:!0};let y;return Object.keys(f).every(v=>{const A=$.getChildPath(l,v),O=f[v];return y=u(A,O,m.slice(1)),y.ok}),y}else{const y=$.getChildPath(l,d),v=f[d];return u(y,v,m.slice(1))}};return i=u(e,t,a),i.ok}),i}}class rn{static ChildPathsSql(e,t="path"){return e===""?`${t} <> '' AND ${t} NOT LIKE '%/%'`:`(${t} LIKE '${e}/%' OR ${t} LIKE '${e}[%') AND ${t} NOT LIKE '${e}/%/%' AND ${t} NOT LIKE '${e}[%]/%' AND ${t} NOT LIKE '${e}[%][%'`}static ChildPathsRegex(e){return new RegExp(`^${e}(?:/[^/[]+|\\[[0-9]+\\])$`)}static DescendantPathsSql(e,t="path"){return e===""?`${t} <> ''`:`${t} LIKE '${e}/%' OR ${t} LIKE '${e}[%'`}static DescendantPathsRegex(e){return new RegExp(`^${e}(?:/[^/[]+|\\[[0-9]+\\])`)}static get PathInfo(){return $}}class _s{constructor(e){this.path=e}toString(){return`"/${this.path}"`}equals(e){return this.path===e.path}}const{compareValues:hf}=_o;class pi{constructor(e){this.production=!1,this.target={get originalPath(){return e.path},path:e.path,get write(){return e.write}},this.id=Ne.generate()}getChildCount(e){return I(this,null,function*(){let t=0;return yield this.childrenOf(e,{metadata:!1,value:!1},()=>(t++,!1)),t})}getMultiple(e){return I(this,null,function*(){const t=new Map;return yield Promise.all(e.map(n=>this.get(n).then(i=>t.set(n,i)))),t})}setMultiple(e){return I(this,null,function*(){yield Promise.all(e.map(({path:t,node:n})=>this.set(t,n)))})}removeMultiple(e){return I(this,null,function*(){yield Promise.all(e.map(t=>this.remove(t)))})}commit(){return I(this,null,function*(){throw new Error("CustomStorageTransaction.rollback must be overridden by subclass")})}moveToParentPath(e){return I(this,null,function*(){const t=this._lock&&this._lock.path||this.target.path;if(t===e)return e;if(rn.PathInfo.get(e).isParentOf(t))this._lock&&(this._lock=yield this._lock.moveToParent());else throw new Error(`Locking issue. Locked path "${this._lock.path}" is not a child/descendant of "${e}"`);return this.target.path=e,e})}}class sn extends di{constructor(e){if(super(e),this.locking=!0,typeof e!="object")throw new Error("settings missing");if(typeof e.ready!="function")throw new Error("ready must be a function");if(typeof e.getTransaction!="function")throw new Error("getTransaction must be a function");this.name=e.name,this.locking=e.locking!==!1,this.locking&&(this.lockTimeout=typeof e.lockTimeout=="number"?e.lockTimeout:120),this.ready=e.ready;const t=this.locking,n=t?new Do(console,this.lockTimeout):null;this.getTransaction=o=>I(this,[o],function*({path:i,write:s}){const a=yield e.getTransaction({path:i,write:s});Le(typeof a.id=="string","transaction id not set");const c=a.rollback,u=a.commit;return a.commit=()=>I(this,null,function*(){const l=yield u.call(a);return t&&(yield a._lock.release("commit")),l}),a.rollback=l=>I(this,null,function*(){const f=yield c.call(a,l);return t&&(yield a._lock.release("rollback")),f}),t&&(a._lock=yield n.lock(i,a.id,s,`${this.name}::getTransaction`)),a})}}class kr extends Lo{constructor(e){super(e),this.revision=e.revision,this.revision_nr=e.revision_nr,this.created=e.created,this.modified=e.modified}}class df extends ff{constructor(e,t,n){super(e,t,n),this._customImplementation=t,this._init()}_init(){return I(this,null,function*(){this.debug.log(`Database "${this.name}" details:`.colorize(Oe.dim)),this.debug.log("- Type: CustomStorage".colorize(Oe.dim)),this.debug.log(`- Path: ${this.settings.path}`.colorize(Oe.dim)),this.debug.log(`- Max inline value size: ${this.settings.maxInlineValueSize}`.colorize(Oe.dim)),this.debug.log(`- Autoremove undefined props: ${this.settings.removeVoidProperties}`.colorize(Oe.dim)),yield this._customImplementation.ready();const e=yield this._customImplementation.getTransaction({path:"",write:!0});(yield this.getNodeInfo("",{transaction:e})).exists||(yield this._writeNode("",{},{transaction:e})),yield e.commit(),this.indexes.supported&&(yield this.indexes.load()),this.emit("ready")})}throwImplementationError(e){throw new Error(`CustomStorage "${this._customImplementation.name}" ${e}`)}_storeNode(e,t,n){const i=o=>{if(o===null)throw new Error("Not allowed to store null values. remove the property");if(["string","number","boolean"].includes(typeof o))return o;if(o instanceof Date)return{type:K.DATETIME,value:o.getTime()};if(o instanceof me)return{type:K.REFERENCE,value:o.path};if(o instanceof ArrayBuffer)return{type:K.BINARY,value:lt.encode(o)};if(typeof o=="object")return Le(Object.keys(o).length===0,"child object stored in parent can only be empty"),o},s="Caller should have pre-processed the value by converting it to a string";if(t.type===K.ARRAY&&t.value instanceof Array){console.warn(`Unprocessed array. ${s}`);const o={};for(let a=0;a<t.value.length;a++)o[a]=t.value[a];t.value=o}if(t.type===K.BINARY&&typeof t.value!="string"&&(console.warn(`Unprocessed binary value. ${s}`),t.value=lt.encode(t.value)),t.type===K.REFERENCE&&t.value instanceof me&&(console.warn(`Unprocessed path reference. ${s}`),t.value=t.value.path),[K.OBJECT,K.ARRAY].includes(t.type)){const o=t.value;t.value={},Object.keys(o).forEach(a=>{t.value[a]=i(o[a])})}return n.transaction.set(e,t)}_processReadNodeValue(e){const t=n=>{if(n.type===K.BINARY)return lt.decode(n.value);if(n.type===K.DATETIME)return new Date(n.value);if(n.type===K.REFERENCE)return new me(n.value);throw new Error(`Unhandled child value type ${n.type}`)};switch(e.type){case K.ARRAY:case K.OBJECT:{const n=e.value;Object.keys(n).forEach(i=>{const s=n[i];typeof s=="object"&&"type"in s&&(n[i]=t(s))}),e.value=n;break}case K.BINARY:{e.value=lt.decode(e.value);break}case K.REFERENCE:{e.value=new me(e.value);break}case K.STRING:break;default:throw new Error("Invalid standalone record value type")}}_readNode(e,t){return I(this,null,function*(){const n=yield t.transaction.get(e);return n===null?null:(typeof n!="object"&&this.throwImplementationError("transaction.get must return an ICustomStorageNode object. Use JSON.parse if your set function stored it as a string"),this._processReadNodeValue(n),n)})}_getTypeFromStoredValue(e){let t;if(typeof e=="string")t=K.STRING;else if(typeof e=="number")t=K.NUMBER;else if(typeof e=="boolean")t=K.BOOLEAN;else if(e instanceof Array)t=K.ARRAY;else if(typeof e=="object")if("type"in e){const n=e;t=n.type,e=n.value,t===K.DATETIME?e=new Date(e):t===K.REFERENCE&&(e=new me(e))}else t=K.OBJECT;else throw new Error("Unknown value type");return{type:t,value:e}}_writeNode(e,t,n){return I(this,null,function*(){if(!n.merge&&this.valueFitsInline(t)&&e!=="")throw new Error("invalid value to store in its own node");if(e===""&&(typeof t!="object"||t instanceof Array))throw new Error("Invalid root node value. Must be an object");if(typeof n.diff=="undefined"&&typeof n.currentValue!="undefined"){const y=hf(n.currentValue,t);n.merge&&typeof y=="object"&&(y.removed=y.removed.filter(v=>t[v]===null)),n.diff=y}if(n.diff==="identical")return;const i=n.transaction,s=n.currentValue===null?null:yield this._readNode(e,{transaction:i});if(n.merge&&s){if(s.type===K.ARRAY&&!(t instanceof Array)&&typeof t=="object"&&Object.keys(t).some(y=>isNaN(parseInt(y))))throw new Error(`Cannot merge existing array of path "${e}" with an object`);if(t instanceof Array&&s.type!==K.ARRAY)throw new Error(`Cannot merge existing object of path "${e}" with an array`)}const o=n.revision||Ne.generate(),a={type:s&&s.type===K.ARRAY?K.ARRAY:K.OBJECT,value:{}},c={};if(t instanceof Array){a.type=K.ARRAY;const y={};for(let v=0;v<t.length;v++)y[v]=t[v];t=y}else t instanceof me?(a.type=K.REFERENCE,a.value=t.path):t instanceof ArrayBuffer?(a.type=K.BINARY,a.value=lt.encode(t)):typeof t=="string"&&(a.type=K.STRING,a.value=t);const u=s?[K.OBJECT,K.ARRAY].includes(s.type):!1,l=[K.OBJECT,K.ARRAY].includes(a.type),f={current:[],new:[]};let m=null;u&&(m=s.value,f.current=Object.keys(m),l&&(a.value=m)),l&&(n.merge||Object.keys(a.value).forEach(y=>{y in t||(t[y]=null)}),Object.keys(t).forEach(y=>{const v=t[y];if(delete a.value[y],v!==null){if(typeof v=="undefined")if(this.settings.removeVoidProperties===!0){delete t[y];return}else throw new Error(`Property "${y}" has invalid value. Cannot store undefined values. Set removeVoidProperties option to true to automatically remove undefined properties`);this.valueFitsInline(v)?a.value[y]=v:c[y]=v}}));const d=a.type===K.ARRAY;if(s){if(this.debug.log(`Node "/${e}" is being ${n.merge?"updated":"overwritten"}`.colorize(Oe.cyan)),u||l){const v=$.get(e),A=[];let O=!1;const C=F=>(O=!0,!i.production&&!v.isParentOf(F)&&this.throwImplementationError(`"${F}" is not a child of "${e}" - childrenOf must only check and return paths that are children`),!0),R=F=>{O||this.throwImplementationError("childrenOf did not call checkCallback before addCallback");const M=$.get(F).key;return A.push(M.toString()),!0};yield i.childrenOf(e,{metadata:!1,value:!1},C,R),f.current=f.current.concat(A),l&&(n&&n.merge&&(f.new=f.current.slice()),Object.keys(t).forEach(F=>{f.new.includes(F)||f.new.push(F)}));const U={insert:f.new.filter(F=>!f.current.includes(F)),update:[],delete:n&&n.merge?Object.keys(t).filter(F=>t[F]===null):f.current.filter(F=>!f.new.includes(F))};if(U.update=f.new.filter(F=>f.current.includes(F)&&!U.delete.includes(F)),d&&n.merge&&(U.insert.length>0||U.delete.length>0)&&!U.update.concat(U.insert).every((G,P,g)=>g.includes(P.toString())))throw new Error(`Elements cannot be inserted beyond, or removed before the end of an array. Rewrite the whole array at path "${e}" or change your schema to use an object collection instead`);const z=Object.keys(c).map(F=>{const M=d?parseInt(F):F,G=typeof n.diff=="object"?n.diff.forChild(M):void 0;if(G==="identical")return;const P=v.childPath(M),g=c[M],h=typeof n.currentValue=="undefined"?void 0:n.currentValue!==null&&typeof n.currentValue=="object"&&M in n.currentValue?n.currentValue[M]:null;return this._writeNode(P,g,{transaction:i,revision:o,merge:!1,currentValue:h,diff:G})}),W=l?A.filter(F=>F in a.value):[],le=U.delete.concat(W).map(F=>{const M=d?parseInt(F):F,G=v.childPath(M);return this._deleteNode(G,{transaction:i})}),ce=z.concat(le);yield Promise.all(ce)}const y=this._storeNode(e,{type:a.type,value:a.value,revision:s.revision,revision_nr:s.revision_nr+1,created:s.created,modified:Date.now()},{transaction:i});if(y instanceof Promise)return yield y}else{if(this.debug.log(`Node "/${e}" is being created`.colorize(Oe.cyan)),d&&!Object.keys(a.value).concat(Object.keys(c)).every((C,R,U)=>U.includes(R.toString())))throw new Error("Cannot store arrays with missing entries");const y=Object.keys(c).map(A=>{const O=d?parseInt(A):A,C=$.getChildPath(e,O),R=c[O];return this._writeNode(C,R,{transaction:i,revision:o,merge:!1,currentValue:null})}),v=this._storeNode(e,{type:a.type,value:a.value,revision:o,revision_nr:1,created:Date.now(),modified:Date.now()},{transaction:i});v instanceof Promise&&y.push(v),yield Promise.all(y)}})}_deleteNode(e,t){return I(this,null,function*(){const n=$.get(e);this.debug.log(`Node "/${e}" is being deleted`.colorize(Oe.cyan));const i=[e];let s=!1;const o=u=>(s=!0,!c.production&&!n.isAncestorOf(u)&&this.throwImplementationError(`"${u}" is not a descendant of "${e}" - descendantsOf must only check and return paths that are descendants`),!0),a=u=>(s||this.throwImplementationError("descendantsOf did not call checkCallback before addCallback"),i.push(u),!0),c=t.transaction;return yield c.descendantsOf(e,{metadata:!1,value:!1},o,a),this.debug.log(`Nodes ${i.map(u=>`"/${u}"`).join(",")} are being deleted`.colorize(Oe.cyan)),c.removeMultiple(i)})}getChildren(e,t={}){let n;const i={next(o){return n=o,s()}},s=()=>I(this,null,function*(){const o=t.transaction||(yield this._customImplementation.getTransaction({path:e,write:!1}));try{let a=!1;return yield(()=>I(this,null,function*(){const c=yield this._readNode(e,{transaction:o});if(!c)throw new fi(`Node "/${e}" does not exist`);if(![K.OBJECT,K.ARRAY].includes(c.type))return;const u=c.type===K.ARRAY,l=c.value;let f=Object.keys(l).map(A=>u?parseInt(A):A);t.keyFilter&&(f=f.filter(A=>t.keyFilter.includes(A)));const m=$.get(e);if(f.length>0&&f.every(A=>{const O=this._getTypeFromStoredValue(l[A]),C=new kr({path:m.childPath(A),key:u?null:A,index:u?A:null,type:O.type,address:null,exists:!0,value:O.value,revision:c.revision,revision_nr:c.revision_nr,created:new Date(c.created),modified:new Date(c.modified)});return a=n(C)===!1,!a}),a)return;let d=!1;const y=A=>{if(d=!0,!o.production&&!m.isParentOf(A)&&this.throwImplementationError(`"${A}" is not a child of "${e}" - childrenOf must only check and return paths that are children`),t.keyFilter){const O=$.get(A).key;return t.keyFilter.includes(O)}return!0},v=(A,O)=>{d||this.throwImplementationError("childrenOf did not call checkCallback before addCallback");const C=$.get(A).key,R=new kr({path:A,type:O.type,key:u?null:C,index:u?C:null,address:new _s(A),exists:!0,value:null,revision:O.revision,revision_nr:O.revision_nr,created:new Date(O.created),modified:new Date(O.modified)});return a=n(R)===!1,!a};yield o.childrenOf(e,{metadata:!0,value:!1},y,v)}))(),t.transaction||(yield o.commit()),a}catch(a){throw t.transaction||(yield o.rollback(a)),a}});return i}getNode(e,t){return I(this,null,function*(){t=t||{};const n=t.transaction||(yield this._customImplementation.getTransaction({path:e,write:!1}));try{const i=yield(()=>I(this,null,function*(){const s=t.include&&t.include.length>0||t.exclude&&t.exclude.length>0||t.child_objects===!1,o=$.get(e),a=yield this._readNode(e,{transaction:n});if(!a){if(e==="")return{value:null};const R=yield n.moveToParentPath(o.parentPath);Le(R===o.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${e}"`);const U=yield this._readNode(o.parentPath,{transaction:n});if(U&&[K.OBJECT,K.ARRAY].includes(U.type)&&o.key in U.value){const z=this._getTypeFromStoredValue(U.value[o.key]);return{revision:U.revision,revision_nr:U.revision_nr,created:U.created,modified:U.modified,type:z.type,value:z.value}}return{value:null}}const c=a.type===K.ARRAY,u=R=>{const U=z=>/^[0-9]+$/.test(z);return R.map(z=>$.get(c&&U(z)?`[${z}]`:z))},l=t.include?u(t.include):[],f=t.exclude?u(t.exclude):[],m=(R,U)=>{if([K.OBJECT,K.ARRAY].includes(U.type)&&l.length>0){const z=$.getPathKeys(R).slice(o.keys.length),W=new $(z),te=[],le=l.filter(M=>M.isDescendantOf(W));if(le.length>0){const M=U.type===K.ARRAY;te.push(...Object.keys(U.value).map(G=>M?+G:G));for(const G of le){const P=G.keys[z.length];if(typeof P=="string"&&(P==="*"||P.startsWith("$"))){te.splice(0);break}const g=te.indexOf(P);g>=0&&te.splice(g,1)}}const ce=l.some(M=>M.isChildOf(W));if(f.some(M=>M.isChildOf(W))&&!ce){const M=f.filter(G=>G.isChildOf(W));for(let G=0;G<te.length;G++)M.find(P=>P.equals(te[G]))||(te.splice(G,1),G--)}for(const M of te)delete U.value[M]}};m(e,a);let d=!1;const y=(R,U)=>{if(d=!0,!n.production&&!o.isAncestorOf(R)&&this.throwImplementationError(`"${R}" is not a descendant of "${e}" - descendantsOf must only check and return paths that are descendants`),!s)return!0;const W=$.getPathKeys(R).slice(o.keys.length),te=new $(W);let le=(l.length>0?l.some(ce=>te.isOnTrailOf(ce)):!0)&&(f.length>0?!f.some(ce=>ce.equals(te)||ce.isAncestorOf(te)):!0);return le&&t.child_objects===!1&&(o.isParentOf(R)&&[K.OBJECT,K.ARRAY].includes(U?U.type:-1)||$.getPathKeys(R).length>o.pathKeys.length+1)&&(le=!1),le},v=[],A=(R,U)=>{if(d||this.throwImplementationError("descendantsOf did not call checkCallback before addCallback"),t.child_objects===!1&&[K.OBJECT,K.ARRAY].includes(U.type))return!0;m(R,U),this._processReadNodeValue(U);const z=U;return z.path=R,v.push(z),!0};yield n.descendantsOf(e,{metadata:!0,value:!0},y,A),this.debug.log(`Read node "/${e}" and ${s?"(filtered) ":""}descendants from ${v.length+1} records`.colorize(Oe.magenta));const O=a,C=R=>{const U=[];return Object.keys(R).forEach(z=>{const W=parseInt(z);U[W]=R[W]}),U};if(a.type===K.ARRAY&&(O.value=C(O.value)),a.type===K.OBJECT||a.type===K.ARRAY){const R=$.getPathKeys(e),U=a.value;for(let z=0;z<v.length;z++){const W=v[z],le=$.getPathKeys(W.path).slice(R.length);let ce=U;for(let F=0;F<le.length;F++){Le(typeof ce=="object","parent must be an object/array to have children!!");const M=le[F],G=F===le.length-1,P=G?W.type:typeof le[F+1]=="number"?K.ARRAY:K.OBJECT;let g;G?(g=W.value,P===K.ARRAY&&(g=C(g))):g=P===K.OBJECT?{}:[],M in ce?typeof ce[M]==typeof g&&[K.OBJECT,K.ARRAY].includes(P)?Object.keys(g).forEach(p=>{p in ce[M]&&this.throwImplementationError(`Custom storage merge error: child key "${p}" is in parent value already! Make sure the get/childrenOf/descendantsOf methods of the custom storage class return values that can be modified by AceBase without affecting the stored source`),ce[M][p]=g[p]}):this.debug.error(`The value stored in node "${W.path}" cannot be merged with the parent node, value will be ignored. This error should disappear once the target node value is updated. See issue #20 for more information`,{path:e,parent:ce,key:M,nodeType:P,nodeValue:g}):ce[M]=g,ce=ce[M]}}}else v.length>0&&this.throwImplementationError("multiple records found for non-object value!");if(t.child_objects===!1&&Object.keys(O.value).forEach(R=>{typeof O.value[R]=="object"&&O.value[R].constructor===Object&&(Le(Object.keys(O.value[R]).length===0),delete O.value[R])}),t.include,t.exclude){const R=(U,z)=>{if(typeof U!="object")return;const W=z[0];W==="*"?Object.keys(U).forEach(te=>{R(U[te],z.slice(1))}):z.length>1?W in U&&R(U[W],z.slice(1)):delete U[W]};t.exclude.forEach(U=>{const z=$.getPathKeys(U);R(O.value,z)})}return O}))();return t.transaction||(yield n.commit()),i}catch(i){throw t.transaction||(yield n.rollback(i)),i}})}getNodeInfo(n){return I(this,arguments,function*(e,t={}){t=t||{};const i=$.get(e),s=t.transaction||(yield this._customImplementation.getTransaction({path:e,write:!1}));try{const o=yield this._readNode(e,{transaction:s}),a=new kr({path:e,key:typeof i.key=="string"?i.key:null,index:typeof i.key=="number"?i.key:null,type:o?o.type:0,exists:o!==null,address:o?new _s(e):null,created:o?new Date(o.created):null,modified:o?new Date(o.modified):null,revision:o?o.revision:null,revision_nr:o?o.revision_nr:null});if(!o&&e!==""){const c=yield s.moveToParentPath(i.parentPath);Le(c===i.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${e}"`);const u=yield this._readNode(i.parentPath,{transaction:s});u&&[K.OBJECT,K.ARRAY].includes(u.type)&&i.key in u.value?(a.exists=!0,a.value=u.value[i.key],a.address=null,a.type=u.type,a.created=new Date(u.created),a.modified=new Date(u.modified),a.revision=u.revision,a.revision_nr=u.revision_nr):a.address=null}return t.include_child_count&&(a.childCount=0,[K.OBJECT,K.ARRAY].includes(a.valueType)&&a.address&&(a.childCount=o.value?Object.keys(o.value).length:0,a.childCount+=yield s.getChildCount(e))),t.transaction||(yield s.commit()),a}catch(o){throw t.transaction||(yield s.rollback(o)),o}})}setNode(i,s){return I(this,arguments,function*(e,t,n={suppress_events:!1,context:null}){if(this.settings.readOnly)throw new Error("Database is opened in read-only mode");const o=$.get(e),a=n.transaction||(yield this._customImplementation.getTransaction({path:e,write:!0}));try{if(e===""){if(t===null||typeof t!="object"||t instanceof Array||t instanceof ArrayBuffer||"buffer"in t&&t.buffer instanceof ArrayBuffer)throw new Error(`Invalid value for root node: ${t}`);yield this._writeNodeWithTracking("",t,{merge:!1,transaction:a,suppress_events:n.suppress_events,context:n.context})}else if(typeof n.assert_revision!="undefined"){const c=yield this.getNodeInfo(e,{transaction:a});if(c.revision!==n.assert_revision)throw new Kr(`revision '${c.revision}' does not match requested revision '${n.assert_revision}'`);if(c.address&&c.address.path===e&&t!==null&&!this.valueFitsInline(t))yield this._writeNodeWithTracking(e,t,{merge:!1,transaction:a,suppress_events:n.suppress_events,context:n.context});else{const u=yield a.moveToParentPath(o.parentPath);Le(u===o.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${e}"`),yield this._writeNodeWithTracking(o.parentPath,{[o.key]:t},{merge:!0,transaction:a,suppress_events:n.suppress_events,context:n.context})}}else{const c=yield a.moveToParentPath(o.parentPath);Le(c===o.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${e}"`),yield this.updateNode(o.parentPath,{[o.key]:t},{transaction:a,suppress_events:n.suppress_events,context:n.context})}n.transaction||(yield a.commit())}catch(c){throw n.transaction||(yield a.rollback(c)),c}})}updateNode(i,s){return I(this,arguments,function*(e,t,n={suppress_events:!1,context:null}){if(this.settings.readOnly)throw new Error("Database is opened in read-only mode");if(typeof t!="object")throw new Error("invalid updates argument");if(Object.keys(t).length===0)return;const o=n.transaction||(yield this._customImplementation.getTransaction({path:e,write:!0}));try{const a=yield this.getNodeInfo(e,{transaction:o}),c=$.get(e);if(a.exists&&a.address&&a.address.path===e)yield this._writeNodeWithTracking(e,t,{transaction:o,merge:!0,suppress_events:n.suppress_events,context:n.context});else if(a.exists){const u=$.get(e),l=yield o.moveToParentPath(u.parentPath);Le(l===u.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${e}"`),yield this._writeNodeWithTracking(u.parentPath,{[u.key]:t},{transaction:o,merge:!0,suppress_events:n.suppress_events,context:n.context})}else{const u=yield o.moveToParentPath(c.parentPath);Le(u===c.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${e}"`),yield this.updateNode(c.parentPath,{[c.key]:t},{transaction:o,suppress_events:n.suppress_events,context:n.context})}n.transaction||(yield o.commit())}catch(a){throw n.transaction||(yield o.rollback(a)),a}})}}class pf{constructor(e=1e3,t){this.limit=e,this.options=t,this.added=0,this.scheduled=[],this.running=0,this.results=[],this.done=!1}execute(e,t){return I(this,null,function*(){var n,i;try{this.running++;const s=yield e();if(this.results[t]=s,this.running--,this.running===0&&this.scheduled.length===0)this.done=!0,(n=this.doneCallback)==null||n.call(this,this.results);else if(this.scheduled.length>0){const o=this.scheduled.shift();this.execute(o.task,o.index)}}catch(s){this.done=!0,(i=this.errorCallback)==null||i.call(this,s)}})}add(e){var n;if(this.done)throw new Error("Cannot add to a batch that has already finished. Use wait option and start batch processing manually if you are adding tasks in an async loop");const t=this.added++;((n=this.options)==null?void 0:n.wait)!==!0&&this.running<this.limit?this.execute(e,t):this.scheduled.push({task:e,index:t})}start(){for(;this.running<this.limit;){const e=this.scheduled.shift();this.execute(e.task,e.index)}}finish(){return I(this,null,function*(){return this.running===0&&this.scheduled.length===0?this.results:(yield new Promise((e,t)=>{this.doneCallback=e,this.errorCallback=t}),this.results)})}}const yf=()=>{};function Fo(i,s,o){return I(this,arguments,function*(r,e,t,n={snapshots:!1,include:void 0,exclude:void 0,child_objects:void 0,eventHandler:yf}){var te,le,ce,F,M,G;typeof n!="object"&&(n={}),typeof n.snapshots=="undefined"&&(n.snapshots=!1);const a={};(te=r.storage.settings.transactions)!=null&&te.log&&(a.acebase_cursor=Ne.generate());const c=t.filters.map(P=>N({},P)),u=t.order.map(P=>N({},P)),l=P=>{P.sort((g,h)=>{const p=w=>{const b=u[w],E=$.getPathKeys(typeof b.key=="number"?`[${b.key}]`:b.key),x=E.reduce((_,S)=>_!==null&&typeof _=="object"&&S in _?_[S]:null,g.val),k=E.reduce((_,S)=>_!==null&&typeof _=="object"&&S in _?_[S]:null,h.val);return x===null?k===null?0:b.ascending?-1:1:k===null?b.ascending?1:-1:x==k?w<u.length-1?p(w+1):g.path<h.path?-1:1:x<k?b.ascending?-1:1:b.ascending?1:-1};return p(0)})},f=(P,g)=>I(this,null,function*(){if(P.length===0)return[];const h=50,p=new pf(h),w=[];return P.forEach(({path:b},E)=>p.add(()=>I(this,null,function*(){const k=(yield r.storage.getNode(b,g)).value;if(k===null){r.storage.debug.warn(`Indexed result "/${b}" does not have a record!`);return}const _={path:b,val:k};W.sorted?w[E]=_:(w.push(_),!W.skipped&&w.length>t.skip+Math.abs(t.take)&&(l(w),w.pop()))}))),yield p.finish(),w}),m=$.get(e),d=m.keys.some(P=>P==="*"||P.toString().startsWith("$")),y=r.storage.indexes.get(e),v=[];let A=()=>I(this,null,function*(){});if(d){const P=m.keys.filter(p=>typeof p=="string"&&p.startsWith("$")),g=P.length>0&&P.every(p=>t.filters.some(w=>w.key===p&&["==","in"].includes(w.op))),h=typeof n.monitor=="object"&&[(le=n.monitor)==null?void 0:le.add,(ce=n.monitor)==null?void 0:ce.change,(F=n.monitor)==null?void 0:F.remove].some(p=>p===!0);if(g&&!h){const p=[];for(const S of P){const D=t.filters.filter(B=>B.key===S).reduce((B,Y)=>{if(Y.op==="=="&&B.push(Y.compare),Y.op==="in"){if(!(Y.compare instanceof Array))throw new Error("compare argument for 'in' operator must be an Array");B.push(...Y.compare)}return B},[]),L=p.splice(0);D.forEach(B=>{L.length===0?p.push({[S]:B}):p.push(...L.map(Y=>ne(N({},Y),{[S]:B})))})}const w=t.filters.filter(S=>!P.includes(S.key)),b=p.map(S=>$.get($.getPathKeys(e).map(T=>{var D;return(D=S[T])!=null?D:T})).path),E=t.order.length>0,x=b.map(S=>{var T;return Fo(r,S,{filters:w,take:0,skip:0,order:[]},{snapshots:E,cache_mode:n.cache_mode,include:[...(T=n.include)!=null?T:[],...t.order.map(D=>D.key)],exclude:n.exclude})});let _=(yield Promise.all(x)).reduce((S,T)=>(S.push(...T.results),S),[]);if(E&&l(_),t.skip>0&&_.splice(0,t.skip),t.take>0&&_.splice(t.take),n.snapshots&&(!E||((M=n.include)==null?void 0:M.length)>0||((G=n.exclude)==null?void 0:G.length)>0||!n.child_objects)){const{include:S,exclude:T,child_objects:D}=n;_=yield f(_,{include:S,exclude:T,child_objects:D})}return{results:_,context:null,stop:A}}else if(y.length===0){const p=new Error(`Query on wildcard path "/${e}" requires an index`);return Promise.reject(p)}if(c.length===0){const p=y.filter(w=>w.type==="normal")[0];c.push({key:p.key,op:"!=",compare:null})}}c.forEach(P=>{if(P.index)return;const g=y.filter(h=>h.key===P.key).filter(h=>h.validOperators.includes(P.op));if(g.length>=1){const h=c.filter(E=>E!==P).map(E=>E.key),p=u.map(E=>E.key).filter(E=>E!==P.key),w=g.map(E=>{const x=E.includeKeys.concat(E.key),k=x.filter(D=>h.includes(D)),_=x.filter(D=>p.includes(D)),S=k.concat(_.filter(D=>!k.includes(D))),T={filters:k.length,sorting:_.length*(t.take!==0?_.length:1),both:S.length*S.length,get total(){return this.filters+this.sorting+this.both}};return{index:E,points:T.total,filterKeys:k,sortKeys:_}});w.sort((E,x)=>E.points>x.points?-1:1);const b=w[0];P.index=b.index,b.filterKeys.forEach(E=>{c.filter(x=>x!==P&&x.key===E).forEach(x=>{!hi.validOperators.includes(x.op)||(x.indexUsage="filter",x.index=b.index)})}),b.sortKeys.forEach(E=>{u.filter(x=>x.key===E).forEach(x=>{x.index=b.index})})}P.index&&v.push({index:P.index,description:P.index.description})}),u.length>0&&t.take!==0&&c.length===0&&u.forEach(P=>{P.index||(P.index=y.filter(g=>g.key===P.key).find(g=>g.type==="normal"))});const O=v.map(P=>P.description).join(", ");v.length>0&&r.storage.debug.log(`Using indexes for query: ${O}`);const C=c.filter(P=>!P.index),R=/^[a-z]+:/i;if(C.some(P=>R.test(P.op))){const P=C.find(h=>R.test(h.op)),g=new Error(`query contains operator "${P.op}" which requires a special index that was not found on path "${e}", key "${P.key}"`);return Promise.reject(g)}const U=["<","<=","==","!=",">=",">","like","!like","in","!in","matches","!matches","between","!between","has","!has","contains","!contains","exists","!exists"];for(let P=0;P<C.length;P++){const g=C[P];if(!U.includes(g.op))return Promise.reject(new Error(`query contains unknown filter operator "${g.op}" on path "${e}", key "${g.key}"`))}if(d&&C.length>0){const P=C.reduce((h,p)=>(h.indexOf(p.key)<0&&h.push(p.key),h),[]).map(h=>`"${h}"`),g=new Error(`This wildcard path query on "/${e}" requires index(es) on key(s): ${P.join(", ")}. Create the index(es) and retry`);return Promise.reject(g)}const z=[];c.forEach(P=>{if(P.index&&P.indexUsage!=="filter"){let g=P.index.query(P.op,P.compare).then(p=>(n.eventHandler&&n.eventHandler({name:"stats",type:"index_query",source:P.index.description,stats:p.stats}),p.hints.length>0&&n.eventHandler&&n.eventHandler({name:"hints",type:"index_query",source:P.index.description,hints:p.hints}),p));const h=c.filter(p=>p.index===P.index&&p.indexUsage==="filter");h.length>0&&(g=g.then(p=>(h.forEach(w=>{const{key:b,op:E,index:x}=w;let{compare:k}=w;typeof k=="string"&&!x.caseSensitive&&(k=k.toLocaleLowerCase(x.textLocale)),p=p.filterMetadata(b,E,k)}),p))),z.push(g)}});const W={filtered:c.length===0,skipped:t.skip===0,taken:t.take===0,sorted:u.length===0,preDataLoaded:!1,dataLoaded:!1};if(c.length===0&&t.take===0&&(r.storage.debug.warn(`Filterless queries must use .take to limit the results. Defaulting to 100 for query on path "${e}"`),t.take=100),u.length>0&&u[0].index){const P=u[0].index,g=t.take<0?!u[0].ascending:u[0].ascending;if(c.length===0&&u.slice(1).every(h=>P.allMetadataKeys.includes(h.key))){r.storage.debug.log(`Using index for sorting: ${P.description}`);const h=u.slice(1).map(w=>(w.index=P,{key:w.key,ascending:w.ascending})),p=P.take(t.skip,Math.abs(t.take),{ascending:g,metadataSort:h}).then(w=>(n.eventHandler&&n.eventHandler({name:"stats",type:"sort_index_take",source:P.description,stats:w.stats}),w.hints.length>0&&n.eventHandler&&n.eventHandler({name:"hints",type:"sort_index_take",source:P.description,hints:w.hints}),w));z.push(p),W.skipped=!0,W.taken=!0,W.sorted=!0}}return Promise.all(z).then(P=>I(this,null,function*(){let g=[];if(P.length===1){const k=P[0];g=k.map(_=>{const S={key:_.key,path:_.path,val:{[k.filterKey]:_.value}};return _.metadata&&Object.assign(S.val,_.metadata),S}),W.filtered=!0}else if(P.length>1){P.sort((S,T)=>S.length<T.length?-1:1);const k=P[0],_=P.slice(1);g=k.reduce((S,T)=>{const D={key:T.key,path:T.path,val:{[k.filterKey]:T.value}};return _.every(B=>B.findIndex(Y=>Y.path===T.path)>=0)&&(T.metadata&&Object.assign(D.val,T.metadata),_.forEach(B=>{const Y=B.find(re=>re.path===D.path);D.val[B.filterKey]=Y.value,Y.metadata&&Object.assign(D.val,Y.metadata)}),S.push(D)),S},[]),W.filtered=!0}if(d||z.length>0&&C.length===0){if(u.length===0||u.every(k=>k.index)){if(W.preDataLoaded=!0,!W.sorted&&u.length>0&&l(g),W.sorted=!0,!W.skipped&&t.skip>0&&(g=t.take<0?g.slice(0,-t.skip):g.slice(t.skip)),!W.taken&&t.take!==0&&(g=t.take<0?g.slice(t.take):g.slice(0,t.take)),W.skipped=!0,W.taken=!0,!n.snapshots)return g;const k={include:n.include,exclude:n.exclude,child_objects:n.child_objects};return f(g,k).then(_=>(W.dataLoaded=!0,_))}if(n.snapshots||!W.sorted){const k=u.length>0,_=k?{include:u.map(S=>S.key)}:{include:n.include,exclude:n.exclude,child_objects:n.child_objects};return f(g,_).then(S=>(u.length>0&&l(S),W.sorted=!0,t.skip>0&&(S=t.take<0?S.slice(0,-t.skip):S.slice(t.skip)),t.take!==0&&(S=t.take<0?S.slice(t.take):S.slice(0,t.take)),W.skipped=!0,W.taken=!0,n.snapshots&&k?f(S,{include:n.include,exclude:n.exclude,child_objects:n.child_objects}):S))}else return g}let h;g.length>0&&(h=g.map(k=>k.key));let p=[],w=!1;const b=u.length>0,E=b?{include:u.map(k=>k.key)}:{include:n.include,exclude:n.exclude,child_objects:n.child_objects},x={promises:[],add(k){if(this.promises.push(k),this.promises.length>=1e3)return Promise.all(this.promises.splice(0)).then(_=>{})}};try{yield r.storage.getChildren(e,{keyFilter:h,async:!0}).next(k=>{if(k.type!==K.OBJECT||!k.address)return;if(w)return!1;const _=()=>I(this,null,function*(){if(!(yield r.storage.matchNode(k.address.path,C)))return;const D=k.address.path;let L;if(n.snapshots||u.length>0){const B=yield r.storage.getNode(D,E);L={path:D,val:B.value}}else L={path:D};p.push(L),t.take!==0&&p.length>Math.abs(t.take)+t.skip&&(u.length>0?l(p):t.take>0&&(w=!0),p.pop())}),S=x.add(_());if(S instanceof Promise)return S})}catch(k){return k instanceof fi||r.storage.debug.warn(`Error getting child stream: ${k}`),[]}return yield Promise.all(x.promises),W.preDataLoaded=b,W.dataLoaded=!b,u.length>0&&l(p),W.sorted=!0,t.skip>0&&(p=t.take<0?p.slice(0,-t.skip):p.slice(t.skip)),W.skipped=!0,t.take!==0&&(p=t.take<0?p.slice(t.take):p.slice(0,t.take)),W.taken=!0,W.dataLoaded||(p=yield f(p,{include:n.include,exclude:n.exclude,child_objects:n.child_objects}),W.dataLoaded=!0),p})).then(P=>{if(!W.sorted&&u.length>0&&l(P),n.snapshots||(P=P.map(g=>g.path)),!W.skipped&&t.skip>0&&(P=t.take<0?P.slice(0,-t.skip):P.slice(t.skip)),!W.taken&&t.take!==0&&(P=t.take<0?P.slice(t.take):P.slice(0,t.take)),n.monitor===!0&&(n.monitor={add:!0,change:!0,remove:!0}),typeof n.monitor=="object"&&(n.monitor.add||n.monitor.change||n.monitor.remove)){const g=n.monitor,h=n.snapshots?P.map(S=>S.path):P.slice(),p=r.db.ref(e),w=S=>{const T=h.indexOf(S);T<0||h.splice(T,1)},b=S=>{h.includes(S)||h.push(S)},E=()=>{r.unsubscribe(p.path,"child_changed",x),r.unsubscribe(p.path,"child_added",k),r.unsubscribe(p.path,"notify_child_removed",_)};A=()=>I(this,null,function*(){E()});const x=(S,T,D,L)=>I(this,null,function*(){const B=h.includes(T);let Y=!0;const re=[];c.forEach(ue=>!re.includes(ue.key)&&re.push(ue.key));const Q=[];typeof L=="object"&&Object.keys(L).forEach(ue=>!Q.includes(ue)&&Q.push(ue)),typeof D=="object"&&Object.keys(D).forEach(ue=>!Q.includes(ue)&&Q.push(ue));const oe=[];let X=Q.every(ue=>re.includes(ue)?c.filter(fe=>fe.key===ue).every(fe=>{var $e;return(($e=fe.index)==null?void 0:$e.textLocaleKey)&&!Q.includes(fe.index.textLocaleKey)?(oe.push(fe.index.textLocaleKey),!0):U.includes(fe.op)?r.storage.test(D[ue],fe.op,fe.compare):fe.index.test(D,fe.op,fe.compare)}):!0);if(X&&(oe.push(...re.filter(ue=>!Q.includes(ue))),!B&&oe.length>0)){const ue=c.filter($e=>oe.includes($e.key)),Ie=ue.filter($e=>U.includes($e.op)),fe=ue.filter($e=>!U.includes($e.op));if(Ie.length>0&&(X=yield r.storage.matchNode(T,Ie)),X&&fe.length>0){const $e=fe.reduce((He,ut)=>(He.includes(ut.key)||He.push(ut.key),ut.index instanceof Uo&&ut.index.config.localeKey&&!He.includes(ut.index.config.localeKey)&&He.push(ut.index.config.localeKey),He),[]),Se=yield r.storage.getNode(T,{include:$e});if(Se.value===null)return!1;X=fe.every(He=>He.index.test(Se.value,He.op,He.compare))}}if(X){if(B||b(T),n.snapshots){const ue={include:n.include,exclude:n.exclude,child_objects:n.child_objects};D=(yield r.storage.getNode(T,ue)).value}B&&g.change?Y=n.eventHandler({name:"change",path:T,value:D})!==!1:!B&&g.add&&(Y=n.eventHandler({name:"add",path:T,value:D})!==!1)}else B&&(w(T),g.remove&&(Y=n.eventHandler({name:"remove",path:T,value:L})!==!1));Y===!1&&E()}),k=(S,T,D)=>{const L=c.every(Y=>U.includes(Y.op)?r.storage.test(D[Y.key],Y.op,Y.compare):Y.index.test(D,Y.op,Y.compare));let B=!0;L&&(b(T),g.add&&(B=n.eventHandler({name:"add",path:T,value:n.snapshots?D:null})!==!1)),B===!1&&E()},_=(S,T,D,L)=>{let B=!0;w(T),g.remove&&(B=n.eventHandler({name:"remove",path:T,value:n.snapshots?L:null})!==!1),B===!1&&E()};(n.monitor.add||n.monitor.change||n.monitor.remove)&&r.subscribe(p.path,"child_changed",x),n.monitor.remove&&r.subscribe(p.path,"notify_child_removed",_),n.monitor.add&&r.subscribe(p.path,"child_added",k)}return{results:P,context:a,stop:A}})})}class mf extends Ml{constructor(e="default",t,n){super(),this.db=t.db;const i={logLevel:t.settings.logLevel};if(typeof t.settings.storage=="object")if(ks&&t.settings.storage instanceof ks)this.storage=new Gl(e,t.settings.storage,i);else if(As&&t.settings.storage instanceof As)this.storage=new Ql(e,t.settings.storage,i);else if(sn&&t.settings.storage instanceof sn)this.storage=new df(e,t.settings.storage,i);else{const s=t.settings.storage instanceof xr?t.settings.storage:new xr(t.settings.storage);this.storage=new Mr(e,s,i)}else this.storage=new Mr(e,new xr,i);this.storage.on("ready",n)}stats(e){return I(this,null,function*(){return this.storage.stats})}subscribe(e,t,n){this.storage.subscriptions.add(e,t,n)}unsubscribe(e,t,n){this.storage.subscriptions.remove(e,t,n)}set(i,s){return I(this,arguments,function*(e,t,n={suppress_events:!1,context:null}){const o=yield this.storage.setNode(e,t,{suppress_events:n.suppress_events,context:n.context});return N({},o&&{cursor:o})})}update(i,s){return I(this,arguments,function*(e,t,n={suppress_events:!1,context:null}){const o=yield this.storage.updateNode(e,t,{suppress_events:n.suppress_events,context:n.context});return N({},o&&{cursor:o})})}get transactionLoggingEnabled(){return this.storage.settings.transactions&&this.storage.settings.transactions.log===!0}get(e,t){return I(this,null,function*(){if(t||(t={}),typeof t.include!="undefined"&&!(t.include instanceof Array))throw new TypeError("options.include must be an array of key names");if(typeof t.exclude!="undefined"&&!(t.exclude instanceof Array))throw new TypeError("options.exclude must be an array of key names");if(["undefined","boolean"].indexOf(typeof t.child_objects)<0)throw new TypeError("options.child_objects must be a boolean");const n=yield this.storage.getNode(e,t);return{value:n.value,context:{acebase_cursor:n.cursor},cursor:n.cursor}})}transaction(i,s){return I(this,arguments,function*(e,t,n={suppress_events:!1,context:null}){const o=yield this.storage.transactNode(e,t,{suppress_events:n.suppress_events,context:n.context});return N({},o&&{cursor:o})})}exists(e){return I(this,null,function*(){return(yield this.storage.getNodeInfo(e)).exists})}query(i,s){return I(this,arguments,function*(e,t,n={snapshots:!1}){return yield Fo(this,e,t,n)})}createIndex(e,t,n){return this.storage.indexes.create(e,t,n)}getIndexes(){return I(this,null,function*(){return this.storage.indexes.list()})}deleteIndex(e){return I(this,null,function*(){return this.storage.indexes.delete(e)})}reflect(e,t,n){return I(this,null,function*(){n=n||{};const i=(s,o=50,a=0,c=null)=>I(this,null,function*(){typeof o=="string"&&(o=parseInt(o)),typeof a=="string"&&(a=parseInt(a)),["null","undefined"].includes(c)&&(c=null);const u=[];let l=0,f=!1,m=!1;return yield this.storage.getChildren(s).next(d=>{if(f)return m=!0,!1;l++,(c!==null?d.key>c:a===0||l>a)&&u.push(N({key:typeof d.key=="string"?d.key:d.index,type:d.valueTypeName,value:d.value},typeof d.address=="object"&&"pageNr"in d.address&&{address:{pageNr:d.address.pageNr,recordNr:d.address.recordNr}})),f=o>0&&u.length===o}).catch(d=>{if(!(d instanceof fi))throw d}),{more:m,list:u}});switch(t){case"children":return yield i(e,n.limit,n.skip,n.from);case"info":{const s={key:"",exists:!1,type:"unknown",value:void 0,address:void 0,children:{count:0,more:!1,list:[]}},o=yield this.storage.getNodeInfo(e,{include_child_count:n.child_count===!0});s.key=typeof o.key!="undefined"?o.key:o.index,s.exists=o.exists,s.type=o.exists?o.valueTypeName:void 0,s.value=o.value,s.address=typeof o.address=="object"&&"pageNr"in o.address?{pageNr:o.address.pageNr,recordNr:o.address.recordNr}:void 0;const a=o.exists&&o.address&&[K.OBJECT,K.ARRAY].includes(o.type);return n.child_count===!0?s.children={count:a?o.childCount:0}:typeof n.child_limit=="number"&&n.child_limit>0&&a&&(s.children=yield i(e,n.child_limit,n.child_skip,n.child_from)),s}}})}export(e,t,n={format:"json",type_safe:!0}){return this.storage.exportNode(e,t,n)}import(e,t,n={format:"json",suppress_events:!1,method:"set"}){return this.storage.importNode(e,t,n)}setSchema(e,t,n=!1){return I(this,null,function*(){return this.storage.setSchema(e,t,n)})}getSchema(e){return I(this,null,function*(){return this.storage.getSchema(e)})}getSchemas(){return I(this,null,function*(){return this.storage.getSchemas()})}validateSchema(e,t,n){return I(this,null,function*(){return this.storage.validateSchema(e,t,{updates:n})})}getMutations(e){return I(this,null,function*(){if(typeof this.storage.getMutations!="function")throw new Error("Used storage type does not support getMutations");if(typeof e!="object")throw new Error("No filter specified");if(typeof e.cursor!="string"&&typeof e.timestamp!="number")throw new Error("No cursor or timestamp given");return this.storage.getMutations(e)})}getChanges(e){return I(this,null,function*(){if(typeof this.storage.getChanges!="function")throw new Error("Used storage type does not support getChanges");if(typeof e!="object")throw new Error("No filter specified");if(typeof e.cursor!="string"&&typeof e.timestamp!="number")throw new Error("No cursor or timestamp given");return this.storage.getChanges(e)})}}class gf extends di{constructor(e){super(e),this.temp=!1,this.multipleTabs=!1,typeof e.temp=="boolean"&&(this.temp=e.temp),typeof e.provider=="object"&&(this.provider=e.provider),typeof e.multipleTabs=="boolean"&&(this.multipleTabs=e.multipleTabs),typeof e.logLevel=="string"&&(this.logLevel=e.logLevel),typeof e.sponsor=="boolean"&&(this.sponsor=e.sponsor),["type","ipc","path"].forEach(t=>{t in e&&console.warn(`${t} setting is not supported for AceBase LocalStorage`)})}}class vf extends pi{constructor(e,t){super(t),this.context=e,this._storageKeysPrefix=`${this.context.dbname}.acebase::`}commit(){return I(this,null,function*(){})}rollback(e){return I(this,null,function*(){})}get(e){return I(this,null,function*(){const t=this.context.localStorage.getItem(this.getStorageKeyForPath(e));return JSON.parse(t)})}set(e,t){return I(this,null,function*(){const n=JSON.stringify(t);this.context.localStorage.setItem(this.getStorageKeyForPath(e),n)})}remove(e){return I(this,null,function*(){this.context.localStorage.removeItem(this.getStorageKeyForPath(e))})}childrenOf(e,t,n,i){return I(this,null,function*(){const s=rn.PathInfo.get(e);for(let o=0;o<this.context.localStorage.length;o++){const a=this.context.localStorage.key(o);if(!a.startsWith(this._storageKeysPrefix))continue;const c=this.getPathFromStorageKey(a);if(s.isParentOf(c)&&n(c)){let u;if(t.metadata||t.value){const f=this.context.localStorage.getItem(a);u=JSON.parse(f)}if(!i(c,u))break}}})}descendantsOf(e,t,n,i){return I(this,null,function*(){const s=rn.PathInfo.get(e);for(let o=0;o<this.context.localStorage.length;o++){const a=this.context.localStorage.key(o);if(!a.startsWith(this._storageKeysPrefix))continue;const c=this.getPathFromStorageKey(a);if(s.isAncestorOf(c)&&n(c)){let u;if(t.metadata||t.value){const f=this.context.localStorage.getItem(a);u=JSON.parse(f)}if(!i(c,u))break}}})}getPathFromStorageKey(e){return e.slice(this._storageKeysPrefix.length)}getStorageKeyForPath(e){return`${this._storageKeysPrefix}${e}`}}function wf(r,e={}){const t=new gf(e),n=t.provider?t.provider:t.temp?window.localStorage:window.sessionStorage,i=new sn({name:"LocalStorage",locking:!0,removeVoidProperties:t.removeVoidProperties,maxInlineValueSize:t.maxInlineValueSize,ready(){return I(this,null,function*(){})},getTransaction(a){return I(this,null,function*(){const c={debug:!0,dbname:r,localStorage:n};return new vf(c,a)})}}),s=new hn(r,{logLevel:t.logLevel,storage:i,sponsor:t.sponsor});return s.settings.ipcEvents=t.multipleTabs===!0,s}class bf extends di{constructor(e){super(e),this.multipleTabs=!1,this.cacheSeconds=60,this.sponsor=!1,typeof e.logLevel=="string"&&(this.logLevel=e.logLevel),typeof e.multipleTabs=="boolean"&&(this.multipleTabs=e.multipleTabs),typeof e.cacheSeconds=="number"&&(this.cacheSeconds=e.cacheSeconds),typeof e.sponsor=="boolean"&&(this.sponsor=e.sponsor),["type","ipc","path"].forEach(t=>{t in e&&console.warn(`${t} setting is not supported for AceBase IndexedDBStorage`)})}}class Mo extends Bo{constructor(e={}){super(e),e.storage&&(this.storage=e.storage,e.ipc&&(this.storage.ipc=e.ipc),e.transactions&&(this.storage.transactions=e.transactions))}}class xf extends Fl{constructor(e,t={}){const n=new Mo(t);super(e,n),this.recovery={repairNode:(s,o)=>I(this,null,function*(){if(yield this.ready(),this.api.storage instanceof Mr)yield this.api.storage.repairNode(s,o);else if(!this.api.storage.repairNode)throw new Error("repairNode is not supported with chosen storage engine")}),repairNodeTree:s=>I(this,null,function*(){yield this.ready(),yield this.api.storage.repairNodeTree(s)})};const i={db:this,settings:n};this.api=new mf(e,i,()=>{this.emit("ready")})}close(){return I(this,null,function*(){yield this.api.storage.close()})}get settings(){const e=this.api.storage.ipc,t=this.debug;return{get logLevel(){return t.level},set logLevel(n){t.setLevel(n)},get ipcEvents(){return e.eventsEnabled},set ipcEvents(n){e.eventsEnabled=n}}}static WithLocalStorage(e,t={}){return wf(e,t)}static WithIndexedDB(e,t={}){throw new Error("IndexedDB storage can only be used in browser contexts")}}function Ts(r){return new Promise((e,t)=>{r.onsuccess=n=>e(r.result||null),r.onerror=t})}class Ef extends pi{constructor(e,t){super(t),this.context=e,this.production=!0,this._pending=[]}_createTransaction(e=!1){return this.context.db.transaction(["nodes","content"],e?"readwrite":"readonly")}_splitMetadata(e){const t=e.value,n=N({},e);return delete n.value,{metadata:n,value:t}}commit(){return I(this,null,function*(){if(this._pending.length===0)return;const e=this._pending.splice(0);this.context.ipc.sendNotification({action:"cache.invalidate",paths:e.map(n=>n.path)});const t=this._createTransaction(!0);try{yield new Promise((n,i)=>{let s=!1,o=0;const a=u=>{s=!0,i(u)},c=()=>{++o===e.length&&n()};e.forEach((u,l)=>{if(s)return;let f,m;const d=u.path;if(u.action==="set"){const{metadata:v,value:A}=this._splitMetadata(u.node),O={path:d,metadata:v};f=t.objectStore("nodes").put(O),m=t.objectStore("content").put(A,d),this.context.cache.set(d,u.node)}else u.action==="remove"?(f=t.objectStore("content").delete(d),m=t.objectStore("nodes").delete(d),this.context.cache.set(d,null)):a(new Error(`Unknown pending operation "${u.action}" on path "${d}" `));let y=0;f.onsuccess=m.onsuccess=()=>{++y===2&&c()},f.onerror=m.onerror=a})}),t.commit&&t.commit()}catch(n){throw console.error(n),t.abort&&t.abort(),n}})}rollback(e){return I(this,null,function*(){this._pending=[]})}get(e){return I(this,null,function*(){if(this.context.cache.has(e))return this.context.cache.get(e);const t=this._createTransaction(!1),n=Ts(t.objectStore("nodes").get(e)),i=Ts(t.objectStore("content").get(e));try{const s=yield Promise.all([n,i]);t.commit&&t.commit();const o=s[0];if(!o)return this.context.cache.set(e,null),null;const a=o.metadata;return a.value=s[1],this.context.cache.set(e,a),a}catch(s){throw console.error("IndexedDB get error",s),t.abort&&t.abort(),s}})}set(e,t){this._pending.push({action:"set",path:e,node:t})}remove(e){this._pending.push({action:"remove",path:e})}removeMultiple(e){return I(this,null,function*(){e.forEach(t=>{this._pending.push({action:"remove",path:t})})})}childrenOf(e,t,n,i){return this._getChildrenOf(e,ne(N({},t),{descendants:!1}),n,i)}descendantsOf(e,t,n,i){return this._getChildrenOf(e,ne(N({},t),{descendants:!0}),n,i)}_getChildrenOf(e,t,n,i){return new Promise((s,o)=>{const a=rn.PathInfo.get(e),c=this._createTransaction(!1),u=c.objectStore("nodes"),l=IDBKeyRange.lowerBound(e,!0),f=t.metadata?u.openCursor(l):u.openKeyCursor(l);f.onerror=m=>{var d;(d=c.abort)==null||d.call(c),o(m)},f.onsuccess=m=>I(this,null,function*(){var v,A,O;const d=(A=(v=f.result)==null?void 0:v.key)!=null?A:null;let y=!0;if(d===null)y=!1;else if(!a.isAncestorOf(d))y=!1;else if(t.descendants||a.isParentOf(d)){let C;if(t.metadata&&(C=f.result.value.metadata),n(d,C)){if(t.value)if(this.context.cache.has(d)){const U=this.context.cache.get(d);C.value=U.value}else{const U=c.objectStore("content").get(d);C.value=yield new Promise((z,W)=>{U.onerror=te=>{z(null)},U.onsuccess=te=>{z(U.result)}}),this.context.cache.set(d,C.value===null?null:C)}y=i(d,C)}}if(y)try{f.result.continue()}catch(C){y=!1}y||((O=c.commit)==null||O.call(c),s())})})}}function kf(r,e={}){const t=new bf(e),i=(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB).open(`${r}.acebase`,1);i.onupgradeneeded=m=>{const d=i.result;d.createObjectStore("nodes",{keyPath:"path"}),d.createObjectStore("content")};let s;const o=new Promise((m,d)=>{i.onsuccess=y=>{s=i.result,m()},i.onerror=y=>{d(y)}}),a=new zl(typeof t.cacheSeconds=="number"?t.cacheSeconds:60),c=new sn({name:"IndexedDB",locking:!0,removeVoidProperties:t.removeVoidProperties,maxInlineValueSize:t.maxInlineValueSize,lockTimeout:t.lockTimeout,ready(){return o},getTransaction(m){return I(this,null,function*(){yield o;const d={debug:!1,db:s,cache:a,ipc:l};return new Ef(d,m)})}}),u=new hn(r,{logLevel:t.logLevel,storage:c,sponsor:t.sponsor}),l=u.api.storage.ipc;return u.settings.ipcEvents=t.multipleTabs===!0,l.on("notification",m=>I(this,null,function*(){const d=m.data;if(typeof d=="object"&&d.action==="cache.invalidate")for(const y of d.paths)a.remove(y)})),u}const Af=`Using AceBase constructor in the browser to use localStorage is deprecated!
Switch to:
IndexedDB implementation (FASTER, MORE RELIABLE):
    let db = AceBase.WithIndexedDB(name, settings)
Or, new LocalStorage implementation:
    let db = AceBase.WithLocalStorage(name, settings)
Or, write your own CustomStorage adapter:
    let myCustomStorage = new CustomStorageSettings({ ... });
    let db = new AceBase(name, { storage: myCustomStorage })`;class hn extends xf{constructor(e,t){if(typeof t!="object"||typeof t.storage!="object")throw new Error(Af);super(e,t),this.settings.ipcEvents=t.multipleTabs===!0}static WithIndexedDB(e,t={}){return kf(e,t)}}const Sf={AceBase:hn,AceBaseLocalSettings:Mo,DataReference:tt,DataSnapshot:ye,EventSubscription:bo,PathReference:me,TypeMappings:Ro,CustomStorageSettings:sn,CustomStorageTransaction:pi,CustomStorageHelpers:rn,ID:Ne,proxyAccess:$n,DataSnapshotsArray:Zn};window.acebase=Sf;window.AceBase=hn;let _f=()=>Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),Ar=(()=>"/ps"+_f()+"/pe")();const xe={req:"/custom",create:{one:"/create-one",many:"/create-many"},send:{one:"/send-one",many:"/send-many"},find:{one:"/find-one",many:"/find-many"},get:{one:"/get-one",many:"/get-many"},query:{many:"/get-many"},update:{one:"/update-one",many:"/update-many"},delete:{one:"/delete-one",many:"/delete-many"}},Ee={create:"/create",find:"/find",get:"/get",query:"/get",update:"/update",delete:"/delete",req:"/custom",upload:"/upload",send:"/send",user:{base:"/user",example:"/user/device-connected",join:"",status:"/user/status",device:{connected:"/user/device-connected",removed:"/user/device-removed",disconnected:"/user/device-disconnected"}}},kn={user:{base:"/user",device:{remove:"/user/device-remove",list:"/user/device-list"}},users:{base:"/users",device:{list:"/users/device-list"}}},Xe={base:"/auth",login:"/login/get-one",verify_token_code:"/verify-token-code/get-one",verify_pass_code:"/verify-pass-code/get-one",verify_email_code:"/verify-email-code/get-one",req:"/custom",user:"/user/"+Ar+"/get-one",register:"/register/get-one",forgotPassword:"/forgot-password/get-one"+Ar+"/get-one",deleteAccount:"/delete-account/get-one",refreshToken:"/refresh-token"+Ar+"/get-one",users:{base:"/users"}},Os={base:"/data"},An={base:"/storage",upload:"/upload",download:{one:"download-one",many:"download-many"}},Tf={base:"/mail"};var Kt,rt,xt,Wt,Ce,qr,zt,Ot,un,Je,Be,Pt,Te;class Of{constructor(e={}){je(this,Kt,"/on");je(this,rt,!0);je(this,xt,void 0);je(this,Wt,void 0);je(this,Ce,void 0);je(this,qr,void 0);je(this,zt,void 0);je(this,Ot,void 0);je(this,un,new ul);je(this,Je,void 0);je(this,Be,void 0);je(this,Pt,void 0);je(this,Te,void 0);zi(this,"init",e=>{var W,te,le,ce,F,M,G,P;let{ENV:t,HOST_SERVER:n,API_VERSION:i}=J(this,Pt),s=()=>I(this,null,function*(){var b,E,x,k,_,S,T,D,L,B,Y,re;let g="/transaction",h="/database",p=yield(x=(E=(b=J(this,Te))==null?void 0:b.ref(g))==null?void 0:E.get())==null?void 0:x.catch(Q=>{}),w=yield(S=(_=(k=J(this,Te))==null?void 0:k.ref(h))==null?void 0:_.get())==null?void 0:S.catch(Q=>{});if(p.exists()){p=p.val();let Q=Object.keys(p);if((Q==null?void 0:Q.length)>0){for(let oe in Q){let X=p[oe];(X==null?void 0:X.path)&&(X==null?void 0:X.method)&&(X==null?void 0:X.value)&&(yield this.init(e).database().ref(X==null?void 0:X.path).req(X==null?void 0:X.method,X==null?void 0:X.path,X==null?void 0:X.value).val())}w.exists()&&(yield(L=(D=(T=J(this,Te))==null?void 0:T.ref(h))==null?void 0:D.remove())==null?void 0:L.catch(oe=>{})),yield(re=(Y=(B=J(this,Te))==null?void 0:B.ref(g))==null?void 0:Y.remove())==null?void 0:re.catch(oe=>{})}}});(te=(W=e==null?void 0:e.socket)==null?void 0:W.database)==null||te.on("connect",()=>{_e(this,Be,!0),s()}),(ce=(le=e==null?void 0:e.socket)==null?void 0:le.database)==null||ce.on("disconnect",()=>{_e(this,Be,!1)});const o=(g={})=>{var p,w,b;let h={};if(g&&Object.keys(g).length>0&&(h.data=g),J(this,Ce)&&(h.storage=J(this,Ce),h.config=J(this,zt)),J(this,Ot)){let E=new FormData;Array.isArray(g)?(g.map((x,k)=>{typeof x=="object"&&(x.attachmentName="attachment"+k,x==null||x.attachments.forEach(_=>{_!=null&&_.data?E.append("attachments"+k,_==null?void 0:_.data,_==null?void 0:_.name):E.append("attachments"+k,_)}))}),E.append("field",JSON.stringify(h))):Array.isArray(g==null?void 0:g.attachments)&&(g==null||g.attachments.forEach(x=>{x!=null&&x.data?E.append("attachments",x==null?void 0:x.data,x==null?void 0:x.name):E.append("attachments",x)}),delete h.data.attachments,E.append("field",JSON.stringify(h))),h=E}else if(J(this,Ce)&&(g==null?void 0:g.file)){let E=new FormData;g!=null&&g.file?((p=g.file)!=null&&p.data?E.append("file",(w=g.file)==null?void 0:w.data,(b=g.file)==null?void 0:b.name):E.append("file",g.file),delete h.data.file,E.append("field",JSON.stringify(h))):Array.isArray(g==null?void 0:g.directory)&&(g==null||g.directory.forEach(x=>{x!=null&&x.data?E.append("file",x==null?void 0:x.data,x==null?void 0:x.name):E.append("file",x)}),delete h.data.directory,E.append("field",JSON.stringify(h)),h=E),h=E}return h};let a=(g,h)=>I(this,null,function*(){var p,w,b,E,x,k,_,S;if(((p=g==null?void 0:g.error)==null?void 0:p.token)&&J(this,rt)){if(_e(this,rt,!1),localStorage.getItem("refreshToken")){t==="dev"&&console.log("Token expired or not found: ",(w=g.error)==null?void 0:w.token," Trying to request a new refresh token");let T=yield(E=(b=this==null?void 0:this.init(e))==null?void 0:b.auth())==null?void 0:E.req(Xe.refreshToken,{token:localStorage.getItem("refreshToken")}).val();if(T!=null&&T.error)return t==="dev"&&console.log("Refresh token expired or not found: ",T),J(this,xt)&&(window.top.location.href=J(this,xt)),T;if(T!=null&&T.data&&(t==="dev"&&console.log("We got a new refresh token ,",T==null?void 0:T.data),(x=T==null?void 0:T.data)!=null&&x.token&&localStorage.setItem("accessToken",(k=T==null?void 0:T.data)==null?void 0:k.token),(_=T==null?void 0:T.data)!=null&&_.refreshToken&&localStorage.setItem("refreshToken",(S=T==null?void 0:T.data)==null?void 0:S.refreshToken),t==="dev"&&console.log("Trying to restart your request..."),typeof h=="function"))return yield h()}}else return g});const c=(g,h,p,w=()=>{})=>{const b=J(this,Kt);let E=h.version+b+h.base+p;E=E.replace(/\/\//g,"/"),t==="dev"&&console.log("socket listen local path: ",E),g==null||g.on(E,w)},u=(g,h=()=>{})=>{var b;const p=J(this,Kt);let w=(i==null?void 0:i.DATABASE)+p+g;w=w.replace(/\/\//g,"/"),t==="dev"&&console.log("emitter listen local path: ",w),(b=J(this,un))==null||b.on(w,h)};let l=(g,h,p,w)=>{J(this,Wt)&&(w=w+J(this,Wt));let b={req:E=>(c(g,h,w+Ee.req,x=>{var k,_,S;(!((_=(k=x==null?void 0:x.error)==null?void 0:k.error)!=null&&_.token)&&!((S=x==null?void 0:x.error)!=null&&S.token)||(x==null?void 0:x.data))&&typeof E=="function"&&E(ne(N({},p),{value:x}))}),p),create:E=>(c(g,h,w+Ee.create,x=>{var k,_,S;(!((_=(k=x==null?void 0:x.error)==null?void 0:k.error)!=null&&_.token)&&!((S=x==null?void 0:x.error)!=null&&S.token)||(x==null?void 0:x.data))&&typeof E=="function"&&E(ne(N({},p),{value:x}))}),p),find:E=>(c(g,h,w+Ee.find,x=>{var k,_,S;(!((_=(k=x==null?void 0:x.error)==null?void 0:k.error)!=null&&_.token)&&!((S=x==null?void 0:x.error)!=null&&S.token)||(x==null?void 0:x.data))&&typeof E=="function"&&E(ne(N({},p),{value:x}))}),p),get:E=>(c(g,h,w+Ee.get,x=>{var k,_,S;(!((_=(k=x==null?void 0:x.error)==null?void 0:k.error)!=null&&_.token)&&!((S=x==null?void 0:x.error)!=null&&S.token)||(x==null?void 0:x.data))&&typeof E=="function"&&E(ne(N({},p),{value:x}))}),p),query:E=>(c(g,h,w+Ee.query,x=>{var k,_,S;(!((_=(k=x==null?void 0:x.error)==null?void 0:k.error)!=null&&_.token)&&!((S=x==null?void 0:x.error)!=null&&S.token)||(x==null?void 0:x.data))&&typeof E=="function"&&E(ne(N({},p),{value:x}))}),p),update:E=>(c(g,h,w+Ee.update,x=>{var k,_,S;(!((_=(k=x==null?void 0:x.error)==null?void 0:k.error)!=null&&_.token)&&!((S=x==null?void 0:x.error)!=null&&S.token)||(x==null?void 0:x.data))&&typeof E=="function"&&E(ne(N({},p),{value:x}))}),p),delete:E=>(c(g,h,w+Ee.delete,x=>{var k,_,S;(!((_=(k=x==null?void 0:x.error)==null?void 0:k.error)!=null&&_.token)&&!((S=x==null?void 0:x.error)!=null&&S.token)||(x==null?void 0:x.data))&&typeof E=="function"&&E(ne(N({},p),{value:x}))}),p)};return J(this,Ce)&&(b.upload=E=>(c(g,h,w+Ee.upload,x=>{var k,_,S;(!((_=(k=x==null?void 0:x.error)==null?void 0:k.error)!=null&&_.token)&&!((S=x==null?void 0:x.error)!=null&&S.token)||(x==null?void 0:x.data))&&typeof E=="function"&&E(ne(N({},p),{value:x}))}),p)),J(this,Ot)&&(b.send=E=>(c(g,h,w+Ee.send,x=>{var k,_,S;(!((_=(k=x==null?void 0:x.error)==null?void 0:k.error)!=null&&_.token)&&!((S=x==null?void 0:x.error)!=null&&S.token)||(x==null?void 0:x.data))&&typeof E=="function"&&E(ne(N({},p),{value:x}))}),p)),b},f=(g,h)=>({create:w=>(u(g+Ee.create,b=>{(!(b!=null&&b.error)||(b==null?void 0:b.data))&&typeof w=="function"&&w(ne(N({},h),{value:b}))}),h),find:w=>(u(g+Ee.find,b=>{(!(b!=null&&b.error)||(b==null?void 0:b.data))&&typeof w=="function"&&w(ne(N({},h),{value:b}))}),h),get:w=>(u(g+Ee.get,b=>{(!(b!=null&&b.error)||(b==null?void 0:b.data))&&typeof w=="function"&&w(ne(N({},h),{value:b}))}),h),query:w=>(u(g+Ee.query,b=>{(!(b!=null&&b.error)||(b==null?void 0:b.data))&&typeof w=="function"&&w(ne(N({},h),{value:b}))}),h),update:w=>(u(g+Ee.update,b=>{(!(b!=null&&b.error)||(b==null?void 0:b.data))&&typeof w=="function"&&w(ne(N({},h),{value:b}))}),h),delete:w=>(u(g+Ee.delete,b=>{(!(b!=null&&b.error)||(b==null?void 0:b.data))&&typeof w=="function"&&w(ne(N({},h),{value:b}))}),h)}),m=hs.init(J(this,Pt)),d=(g="",h={},p={},w={},b)=>{g=g.trim(),g.charAt(g.length-1)==="/"&&(g=g.slice(0,-1));let x=(()=>I(this,null,function*(){let k=()=>I(this,null,function*(){return yield m("post",n.AUTH+i.AUTH+Xe.base+g,o(h))}),_=yield k();return J(this,rt)&&(_=yield a(_,()=>I(this,null,function*(){return yield k()}))),typeof b=="function"&&b(ne(N({},w),{value:_})),_}))();return ne(N({},w),{val:()=>x})},y=(g,h,p,w={},b={},E)=>{let k=(()=>I(this,null,function*(){let _=()=>I(this,null,function*(){return yield m(g,h,o(p),w)}),S=yield _();return J(this,rt)&&(S=yield a(S,()=>I(this,null,function*(){return yield _()}))),typeof E=="function"&&E(ne(N({},b),{value:S})),S}))();return ne(N({},b),{val:()=>k})},v=g=>{let h={},p,[w={},,,]=g;if(g.length===1&&typeof w=="function"&&(p=g[0],w={}),g.length===2&&(typeof g[1]=="object"?h=g[1]:typeof g[1]=="function"&&(p=g[1])),g.length>=3){let[,b,E]=g;typeof b=="object"&&(h=b),p=E}return{data:w,onRequest:h,callback:p}},A=()=>Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),O=(g,h,p={},w,b)=>{h=h.replace(/\/\//g,"/");let x=(()=>I(this,null,function*(){var B,Y,re,Q,oe,X,ue,Ie,fe,$e,Se,He,ut,$i,Ci,Bi,ji,Li,Di,Ui,Fi,Mi,Ki;let k="/transaction",_,S,T={error:{message:"We could not execute the "+g+" method for path: "+h}};switch(g){case"create":yield(re=(Y=(B=J(this,Te))==null?void 0:B.ref(h))==null?void 0:Y.set(p))==null?void 0:re.catch(We=>T);break;case"update":yield(X=(oe=(Q=J(this,Te))==null?void 0:Q.ref(h))==null?void 0:oe.update(p))==null?void 0:X.catch(We=>T);break;case"query":let pe=(ue=J(this,Te))==null?void 0:ue.query(h);Array.isArray(p==null?void 0:p.where)&&(yield Promise.all(p==null?void 0:p.where.map(We=>I(this,null,function*(){return yield new Promise(Lt=>{pe==null||pe.filter(...We),Lt()})})))),p!=null&&p.take&&(pe==null||pe.take(p==null?void 0:p.take)),p!=null&&p.skip&&(pe==null||pe.take(p==null?void 0:p.skip)),p!=null&&p.order&&Array.isArray(p==null?void 0:p.order)&&(yield Promise.all(p==null?void 0:p.order.map(We=>I(this,null,function*(){return yield new Promise(Lt=>{pe==null||pe.sort(...We),Lt()})})))),S=yield pe==null?void 0:pe.count(),_=yield(Ie=pe==null?void 0:pe.get(N({},p==null?void 0:p.$option)))==null?void 0:Ie.catch(We=>T);break;case"delete":_=yield(Se=($e=(fe=J(this,Te))==null?void 0:fe.ref(h))==null?void 0:$e.get())==null?void 0:Se.catch(We=>T),yield($i=(ut=(He=J(this,Te))==null?void 0:He.ref(h))==null?void 0:ut.remove())==null?void 0:$i.catch(We=>T);break}if(g!=="delete"&&g!=="query"&&(_=yield(ji=(Bi=(Ci=J(this,Te))==null?void 0:Ci.ref(h))==null?void 0:Bi.get(N({},p==null?void 0:p.$option)))==null?void 0:ji.catch(pe=>T)),g==="query"?_.exists()?(_=_==null?void 0:_.getValues(),_={data:_,max:S,take:p==null?void 0:p.take,skip:p==null?void 0:p.skip}):_=N({},T):_.exists()?(_=_==null?void 0:_.val(),_={data:_}):_=N({},T),J(this,Je)&&w.auth().$currentUserId&&!J(this,Be)&&["create","delete","update"].includes(g)&&_!=null&&_.data){let pe=yield(Ui=(Di=(Li=J(this,Te))==null?void 0:Li.ref(k))==null?void 0:Di.get())==null?void 0:Ui.catch(Ja=>T);pe.exists()?pe=pe.val():pe={};let We,Lt=Object.keys(pe);switch(Lt.length>0?We=Lt.length+1:We=0,g){case"create":g="post";break;case"update":g="put";break;case"delete":g="delete";break}g!=="get"&&(yield(Ki=(Mi=(Fi=J(this,Te))==null?void 0:Fi.ref(k+"/"+We))==null?void 0:Mi.set({path:h,method:g,uid:We,value:_.data}))==null?void 0:Ki.catch(Ja=>T))}const D=J(this,Kt);let L=(i==null?void 0:i.DATABASE)+D+h+"/"+g;return L=L.replace(/\/\//g,"/"),J(this,un).emit(L,_),typeof b=="function"&&b(ne(N({},w),{value:_})),_}))();return ne(N({},w),{val:()=>x})},C=({value:g},h)=>{var w,b,E,x;let p=g;if((w=p==null?void 0:p.data)!=null&&w.data){let k=(b=p==null?void 0:p.data)==null?void 0:b.data,_=(E=p==null?void 0:p.data)==null?void 0:E.refreshToken,S=(x=p==null?void 0:p.data)==null?void 0:x.token;S&&localStorage.setItem("accessToken",S),_&&localStorage.setItem("refreshToken",_),k&&localStorage.setItem("userInfo",JSON.stringify(k))}typeof h=="function"&&h(ne(N({},node),{value:p}))},R=(g,h)=>{typeof g=="function"&&(h==null||h.on("connect",g))},U=(g,h)=>{let p="%"+g,w=this.init(e);return delete w.auth().login,delete w.auth().register,{private:(b=A())=>w.event(g+b),child:b=>w.event(g+b),emit:(b,E)=>(h==null||h.emit(p,b),typeof E=="function"&&w.event(g).do(E),N(N({},w.event(g)),w)),do:b=>(h==null||h.on(p,E=>{typeof b=="function"&&b(ne(N(N({},w.event(g)),w),{value:E}))}),N(N({},w.event(g)),w)),onAny:b=>{h==null||h.onAny((E,x)=>{typeof b=="function"&&b(E,N(N({value:x},w.event(E)),w))})}}},z=(g,h,p)=>ne(N({},g),{$io:p,connected:()=>p==null?void 0:p.connected,event:w=>U(w,p),ready:w=>R(w,p),ref:(w="")=>g.ref(w,h,p)});return{activity:()=>{let g=this.init(e);return{onStart:h=>(typeof h=="function"&&document.addEventListener("DOMContentLoaded",h),N(N({},g),g.activity())),onCreate:h=>(typeof h=="function"&&(window.onload=h),N(N({},g),g.activity())),onPause:h=>(window.addEventListener("beforeunload",function(p){typeof h=="function"&&h(),p.returnValue="onbeforeunload"}),N(N({},g),g.activity())),onResume:()=>N(N({},g),g.activity()),onLeave:h=>(typeof h=="function"&&(window.onunload=h),N(N({},g),g.activity()))}},socket:{auth:(F=e==null?void 0:e.socket)==null?void 0:F.auth,database:(M=e==null?void 0:e.socket)==null?void 0:M.database,storage:(G=e==null?void 0:e.socket)==null?void 0:G.storage,mail:(P=e==null?void 0:e.socket)==null?void 0:P.mail},$randomUID:()=>mr(),$randomId:()=>A(),$axios:hs,local:(g={})=>{const h=this.init(e);return delete h.local,delete h.auth().register,delete h.auth().login,{database:(p="/database")=>({ref:(w="/database")=>{let b=this.init(e);return delete b.auth().login,delete b.auth().register,w=w.trim(),w=w.replace(/\/\//g,"/"),p=p+"/"+w,p=p.replace(/\/\//g,"/"),w.charAt(w.length-1)==="/"&&(w=w.slice(0,-1)),{child:(E="")=>{var x,k;return E=E.trim(),E=E.replace(/\/\//g,"/"),E.charAt(E.length-1)==="/"&&(E=E.slice(0,-1)),E.charAt(0)!=="/"&&(E="/"+E),(k=(x=b.local())==null?void 0:x.database())==null?void 0:k.ref(w+E)},push:(...E)=>{var k,_;let x=mr();return!E.length>0?{getKey:()=>x}:(_=(k=b.local())==null?void 0:k.database())==null?void 0:_.ref(w+"/"+x).create(E)},create:(...E)=>{var S,T;let x=N(N({},(T=(S=b.local(g))==null?void 0:S.database())==null?void 0:T.ref(w)),b),{data:k,callback:_}=v(E);return O(g,"create",p,k,x)},get:(...E)=>{var S,T;let x=N(N({},(T=(S=b.local())==null?void 0:S.database())==null?void 0:T.ref(w)),b),{data:k,callback:_}=v(E);return O("get",p,k,x,_)},find:(...E)=>{var S,T;let x=N(N({},(T=(S=b.local())==null?void 0:S.database())==null?void 0:T.ref(w)),b),{data:k,callback:_}=v(E);return O("get",p,k,x,_)},query:()=>{},update:(...E)=>{var S,T;let x=N(N({},(T=(S=b.local())==null?void 0:S.database())==null?void 0:T.ref(w)),b),{data:k,callback:_}=v(E);return O("update",p,k,x,_)},delete:(...E)=>{var S,T;let x=N(N({},(T=(S=b.local())==null?void 0:S.database())==null?void 0:T.ref(w)),b),{data:k,callback:_}=v(E);return O("delete",p,k,x,_)},on:()=>{var x,k;let E=N(N({},(k=(x=b.local())==null?void 0:x.database())==null?void 0:k.ref(w)),b);return f(w,E)},onValue:E=>{var _,S,T,D,L,B,Y;let x=N(N({},(S=(_=b.local())==null?void 0:_.database())==null?void 0:S.ref(w)),b),k=(D=(T=b.local())==null?void 0:T.database())==null?void 0:D.ref(w);return(L=k==null?void 0:k.on())==null||L.create(E),(B=k==null?void 0:k.on())==null||B.update(E),(Y=k==null?void 0:k.on())==null||Y.delete(E),x}}}}),cache:(p="/cache")=>{var b;let w=this.init(e);return delete w.auth().login,delete w.auth().register,(b=w.local())==null?void 0:b.database(p)},storage:()=>({})}},database:()=>{var h,p,w;const g=this.init(e);return delete g.database,delete g.auth().register,delete g.auth().login,(h=e==null?void 0:e.socket)==null||h.database.on("connect",()=>{_e(this,Be,!0),s()}),(p=e==null?void 0:e.socket)==null||p.database.on("disconnect",()=>{_e(this,Be,!1)}),z(g,{host:n.DATABASE,version:i.DATABASE,base:Os.base},(w=e==null?void 0:e.socket)==null?void 0:w.database)},mail:g=>{var w,b;_e(this,Ot,!0);let h=this.init(e);delete h.mail,delete h.auth().register,delete h.auth().login;let p=h.ref("",{host:n.MAIL,version:i.MAIL,base:Tf.base},(w=e==null?void 0:e.socket)==null?void 0:w.mail);return delete h.ref,N({$io:(b=e==null?void 0:e.socket)==null?void 0:b.mail,connected:()=>{var E,x;return(x=(E=e==null?void 0:e.socket)==null?void 0:E.mail)==null?void 0:x.connected},event:E=>{var x;return U(E,(x=e==null?void 0:e.socket)==null?void 0:x.mail)},send:p.send,ready:E=>{var x;return R(E,(x=e==null?void 0:e.socket)==null?void 0:x.mail)},on:()=>({send:p.on().send})},h)},phone:g=>{},cron:g=>{},task:g=>{},storage:(g="local",h)=>{var w;switch(_e(this,Je,!1),_e(this,Ce,g),g){case"aws":break;case"discord":_e(this,zt,{token:h==null?void 0:h.token,channelId:h==null?void 0:h.channelId});break}const p=this.init(e);return delete p.storage,delete p.auth().register,delete p.auth().login,z(p,{host:n.STORAGE,version:i.STORAGE,base:An.base},(w=e==null?void 0:e.socket)==null?void 0:w.storage)},hasAuth:(...g)=>{let h=!0,p;if(g.length===1)typeof g[0]=="boolean"&&(h=g[0]),typeof g[0]=="string"&&(p=g[0]);else if(g>=1){const[b,E]=g;typeof b=="boolean"&&(h=b),typeof E=="string"&&(p=E)}_e(this,rt,h),_e(this,xt,p);const w=this.init(e);return delete w.hasAuth,w},$online:navigator==null?void 0:navigator.onLine,auth:()=>{var g;return{$io:(g=e==null?void 0:e.socket)==null?void 0:g.auth,connected:()=>{var h,p;return(p=(h=e==null?void 0:e.socket)==null?void 0:h.auth)==null?void 0:p.connected},event:h=>{var p;return U(h,(p=e==null?void 0:e.socket)==null?void 0:p.auth)},ready:h=>{var p;return R(h,(p=e==null?void 0:e.socket)==null?void 0:p.auth)},$currentUserId:(()=>{let h=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");return h.uid?h.uid:!1})(),$status:(()=>{let h=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");if(h.status)return h.status})(),status:(...h)=>{var x,k,_,S;let p,w,b=this.init(e);if(delete b.auth().login,delete b.auth().register,h.length===1)typeof h[0]=="string"?p=h[0]:typeof h[0]=="function"&&(w=h[0]);else if(h.length>=2){const[T,D]=h;typeof T=="string"&&(p=T),w=D}let E=(k=(x=e==null?void 0:e.socket)==null?void 0:x.auth)==null?void 0:k.id;if(E){if(!p){let T=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");T.uid&&(p=T.uid)}p&&E&&((S=(_=e==null?void 0:e.socket)==null?void 0:_.auth)==null||S.on((i==null?void 0:i.AUTH)+Ee.user.status,T=>{t==="dev"&&console.log("The user with id: ",p," is disconnected/connected: ",T==null?void 0:T.value),typeof w=="function"&&w(N({value:T},b))}))}return N({},b)},device:{connected:(...h)=>{var x,k,_,S;let p=this.init(e);delete p.auth().login,delete p.auth().register;let w,b;if(h.length===1)typeof h[0]=="string"?w=h[0]:typeof h[0]=="function"&&(b=h[0]);else if(h.length>=2){const[T,D]=h;typeof T=="string"&&(w=T),b=D}let E=(k=(x=e==null?void 0:e.socket)==null?void 0:x.auth)==null?void 0:k.id;if(E){if(!w){let T=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");T.uid&&(w=T.uid)}w&&E&&((S=(_=e==null?void 0:e.socket)==null?void 0:_.auth)==null||S.on((i==null?void 0:i.AUTH)+Ee.user.device.connected,T=>{t==="dev"&&console.log("The user with id: ",w," has this device connected: ",T==null?void 0:T.value),typeof b=="function"&&b(ne(N(N({},p.auth().device),p),{value:T}))}))}return N(N({},p.auth().device),p)},disconnected:(...h)=>{var x,k,_,S;let p=this.init(e);delete p.auth().login,delete p.auth().register;let w,b;if(h.length===1)typeof h[0]=="string"?w=h[0]:typeof h[0]=="function"&&(b=h[0]);else if(h.length>=2){const[T,D]=h;typeof T=="string"&&(w=T),b=D}let E=(k=(x=e==null?void 0:e.socket)==null?void 0:x.auth)==null?void 0:k.id;if(E){if(!w){let T=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");T.uid&&(w=T.uid)}w&&E&&((S=(_=e==null?void 0:e.socket)==null?void 0:_.auth)==null||S.on((i==null?void 0:i.AUTH)+Ee.user.device.disconnected,T=>{t==="dev"&&console.log("The user with id: ",w," has this device connected: ",T==null?void 0:T.value),typeof b=="function"&&b(ne(N(N({},p.auth().device),p),{value:T}))}))}return N(N({},p.auth().device),p)},remove:(...h)=>{var k,_,S,T,D,L;let p=this.init(e);delete p.auth().login,delete p.auth().register;let w,b;if(h.length===1)typeof h[0]=="string"?w=h[0]:typeof h[0]=="function"&&(b=h[0]);else if(h.length>=2){const[B,Y]=h;(typeof B=="string"||Array.isArray(B))&&(w=B),b=Y}let E=(_=(k=e==null?void 0:e.socket)==null?void 0:k.auth)==null?void 0:_.id,x=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");return w&&x.uid&&E&&((T=(S=e==null?void 0:e.socket)==null?void 0:S.auth)==null||T.emit((i==null?void 0:i.AUTH)+kn.user.device.remove,{socketId:E,userId:w,currentUserId:x.uid}),(L=(D=e==null?void 0:e.socket)==null?void 0:D.auth)==null||L.on((i==null?void 0:i.AUTH)+Ee.user.device.removed,B=>{t==="dev"&&console.log("The user with id: ",w," has this device connected: ",B==null?void 0:B.value),typeof b=="function"&&b(ne(N(N({},p.auth().device),p),{value:B}))})),N(N({},p.auth().device),p)},list:(...h)=>{var _,S,T,D;let p=this.init(e);delete p.auth().login,delete p.auth().register;let w=kn.users.device.list,b,E;if(h.length===1)typeof h[0]=="string"?b=h[0]:typeof h[0]=="function"&&(E=h[0]);else if(h.length>=2){const[L,B]=h;typeof L=="string"&&(b=L,w=kn.user.device.list),E=B}let x=(S=(_=e==null?void 0:e.socket)==null?void 0:_.auth)==null?void 0:S.id,k=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");return x&&k.uid&&(b||(w=kn.user.device.list,b=k.uid),b&&x&&((T=e==null?void 0:e.socket.auth)==null||T.emit((i==null?void 0:i.AUTH)+w,{socketId:x,userId:b,currenUserId:k.uid}),(D=e==null?void 0:e.socket.auth)==null||D.on((i==null?void 0:i.AUTH)+w+"/",L=>{t==="dev"&&console.log("The user with id: ",b," has these devices connected: ",res==null?void 0:res.value),typeof E=="function"&&E(ne(N(N({},p.auth().device),p),{value:L}))}))),N(N({},p.auth().device),p)}},req:(h,p,w)=>{let b=this.init(e);delete b.auth().login,delete b.auth().register;let E=N(N({},b),b.auth());return d(h+Xe.req,p,null,E,w)},$user:(()=>{let h=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");if(h.uid)return h})(),user:(...h)=>{let p,w;h.length>1?(typeof h[0]=="string"&&(p=h[0]),typeof h[1]=="function"&&(w=h[1])):h.length===1&&(typeof h[0]=="string"&&(p=h[0]),typeof h[0]=="function"&&(w=h[0]));let b=this.init(e);delete b.auth().login,delete b.auth().register;let E=N(N({},b),b.auth());if(!p||typeof p!="string"){let x=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}"),k=localStorage.getItem("accessToken"),_=(()=>{var S;try{let T=ts(k);return(Date==null?void 0:Date.parse((S=new Date((T==null?void 0:T.exp)*1e3))==null?void 0:S.toString()))>Date.now()}catch(T){return!1}})();return x.uid&&_?(typeof w=="function"&&w(ne(N({},E),{value:x})),ne(N({},E),{val:()=>x})):d(Xe.user,{},null,null,({value:S})=>{var D;let T=S;T!=null&&T.data&&(T={data:(D=T==null?void 0:T.data)==null?void 0:D.data},T.data&&localStorage.setItem("userInfo",JSON.stringify(T.data))),typeof w=="function"&&w(ne(N({},E),{value:T}))})}else return d(Xe.user,{uid:p},null,null,({value:x})=>{var _;let k=x;k!=null&&k.data&&(k={data:(_=k==null?void 0:k.data)==null?void 0:_.data}),typeof w=="function"&&w(ne(N({},E),{value:k}))})},verifyEmailCode:(h,p)=>{let w=this.init(e);return delete w.auth().login,delete w.auth().register,d(Xe.verify_email_code,h,null,null,({value:b})=>{C({value:b},p)})},verifyTokenCode:(h,p)=>{let w=this.init(e);return delete w.auth().login,delete w.auth().register,d(Xe.verify_token_code,h,null,null,({value:b})=>{C({value:b},p)})},verifyPassCode:(h,p)=>{let w=this.init(e);return delete w.auth().login,delete w.auth().register,d(Xe.verify_pass_code,h,null,null,({value:b})=>{C({value:b},p)})},login:(h,p)=>{let w=this.init(e);return delete w.auth().login,delete w.auth().register,d(Xe.login,h,null,null,({value:b})=>{C({value:b},p)})},loginWithToken:(h,p)=>{let w=this.init(e);return delete w.auth().login,delete w.auth().register,localStorage.setItem("userInfo","{}"),localStorage.setItem("accessToken",""),localStorage.setItem("refreshToken",h),this.init(e).auth.user(null,p)},logout:h=>{let p=this.init(e);return localStorage.removeItem("refreshToken"),localStorage.removeItem("userInfo"),localStorage.removeItem("accessToken"),(()=>I(this,null,function*(){var b,E,x,k,_,S;yield(x=(E=(b=J(this,Te))==null?void 0:b.ref("/database"))==null?void 0:E.remove())==null?void 0:x.catch(T=>{}),yield(S=(_=(k=J(this,Te))==null?void 0:k.ref("/transaction"))==null?void 0:_.remove())==null?void 0:S.catch(T=>{})}))().then(b=>{}).catch(b=>{}),typeof h=="function"&&h(N(N({},p),p.auth())),N(N({},p),p.auth())},register:(h,p)=>{let w=this.init(e);return delete w.auth().login,delete w.auth().register,d(Xe.register,h,null,null,({value:b})=>{C({value:b},p)})},forgotPassword:(h,p)=>d(Xe.forgotPassword,h,null,null,p)}},syncDatabase:(g=!0)=>{const h=this.init(e);return _e(this,Je,typeof g=="boolean"?g:!0),h.database()},ref:(g="",h={host:n.DATABASE,version:i.DATABASE,base:Os.base},p=(w=>(w=e==null?void 0:e.socket)==null?void 0:w.database)())=>{g=g.trim(),g=g.replace(/\/\//g,"/"),g.charAt(0)==="/"&&g.length<=1&&(g="/root"),g.charAt(g.length-1)==="/"&&(g=g.slice(0,-1));const b=h.host+h.version+h.base+g;let E=this.init(e);delete E.auth().login,delete E.auth().register,_e(this,rt,!0);let x={push:(...k)=>{let _=mr();return!k.length>0?{getKey:()=>_}:E.ref(g+"/"+_,h,p).create(k)},private:(k=A())=>E.ref(g+"/ps"+k+"/pe",h,p),hasAccess:(k=!0,_=J(this,xt))=>(_e(this,rt,k),_e(this,xt,_),E.ref(g,h,p)),req:(...k)=>{let _=N(N({},E.ref(g,h,p)),E);if(k.length>=2){let[S="post",T={},D={},L]=k;if(typeof S=="string"&&["post","put","delete","get"].includes(S)){let B=xe.req;return y(S,b+B,T,D,_,L)}return _}else{let S=k.filter(T=>typeof T=="function");if(S.length>0)S=S[0],typeof S=="function"&&S(_);else return _}},child:(k="")=>(k=k.trim(),k=k.replace(/\/\//g,"/"),k.charAt(k.length-1)==="/"&&(k=k.slice(0,-1)),k.charAt(0)!=="/"&&(k="/"+k),E.ref(g+k,h,p)),set:(...k)=>{var _;return(_=E.ref(g,h,p))==null?void 0:_.create(...k)},create:(...k)=>{var S,T,D,L;let _=N(N({},E.ref(g,h,p)),E);if(E.auth().$currentUserId&&(h==null?void 0:h.host)===(n==null?void 0:n.DATABASE)&&J(this,Je)&&!J(this,Be))return(D=(T=(S=E.local())==null?void 0:S.database())==null?void 0:T.ref(g))==null?void 0:D.create(...k);{let{data:B,onRequest:Y,callback:re}=v(k),Q=xe.create.one;if(J(this,Ce)){if((B==null?void 0:B.file)||(B==null?void 0:B.directory))return(L=E.ref(g))==null?void 0:L.upload(B,null,re);Array.isArray(B.folders)&&(Q=xe.create.many)}else Array!=null&&Array.isArray(B)&&(Q=xe.create.many);return y("post",b+Q,B,Y,_,re)}},find:(...k)=>{var _,S,T,D;if(console.log("Database connected: ",J(this,Be)),E.auth().$currentUserId&&(h==null?void 0:h.host)===(n==null?void 0:n.DATABASE)&&J(this,Je)&&!J(this,Be))return t==="dev"&&console.log("Find: We are offline"),(T=(S=(_=E.local())==null?void 0:_.database())==null?void 0:S.ref(g))==null?void 0:T.find(...k);{t==="dev"&&console.log("Find: We are online");let L=N(N({},E.ref(g,h,p)),E),{data:B,onRequest:Y,callback:re}=v(k),Q=xe.find.one;return J(this,Ce)?(Array.isArray(B==null?void 0:B.files)||Array.isArray(B==null?void 0:B.folders))&&(Array.isArray(B==null?void 0:B.files)&&(B.isFolder=!1),Array.isArray(B==null?void 0:B.folders)&&(B.isFolder=!0),Q=xe.find.many):(((D=Object.keys(B))==null?void 0:D.length)<=0||B.order||B.where||B.$option||B.skip||B.take)&&(Q=xe.find.many),y("post",b+Q,B,Y,L,re)}},get:(...k)=>{var _,S,T,D;if(E.auth().$currentUserId&&(h==null?void 0:h.host)===(n==null?void 0:n.DATABASE)&&J(this,Je)&&!J(this,Be))return(T=(S=(_=E.local())==null?void 0:_.database())==null?void 0:S.ref(g))==null?void 0:T.get(...k);{let L=N(N({},E.ref(g,h,p)),E),{data:B,onRequest:Y,callback:re}=v(k),Q=xe.get.one;return J(this,Ce)?(Array.isArray(B==null?void 0:B.files)||Array.isArray(B==null?void 0:B.folders))&&(Array.isArray(B==null?void 0:B.files)&&(B.isFolder=!1),Array.isArray(B==null?void 0:B.folders)&&(B.isFolder=!0),Q=xe.get.many):(((D=Object.keys(B))==null?void 0:D.length)<=0||B.order||B.where||B.$option||B.skip||B.take)&&(Q=xe.get.many),y("get",b+Q+"?query="+JSON.stringify(o(B)),null,Y,L,re)}},query:(...k)=>{var _,S,T;if(E.auth().$currentUserId&&(h==null?void 0:h.host)===(n==null?void 0:n.DATABASE)&&J(this,Je)&&!J(this,Be))return(T=(S=(_=E.local())==null?void 0:_.database())==null?void 0:S.ref(g))==null?void 0:T.query(...k);{let D=N(N({},E.ref(g,h,p)),E),{data:L,onRequest:B,callback:Y}=v(k);return(!L||L==="")&&(L={take:15},!J(this,Wt)&&!L.order&&(L.order={uid:"ASC"})),y("get",b+xe.get.many+"?query="+JSON.stringify(o(L)),null,B,D,Y)}},update:(...k)=>{var _,S,T;if(E.auth().$currentUserId&&(h==null?void 0:h.host)===(n==null?void 0:n.DATABASE)&&J(this,Je)&&!J(this,Be))return(T=(S=(_=E.local())==null?void 0:_.database())==null?void 0:S.ref(g))==null?void 0:T.update(...k);{let D=N(N({},E.ref(g,h,p)),E),{data:L,onRequest:B,callback:Y}=v(k),re=xe.update.one;return J(this,Ce)?(Array.isArray(L==null?void 0:L.files)||Array.isArray(L==null?void 0:L.folders))&&(Array.isArray(L==null?void 0:L.files)&&(L.isFolder=!1),Array.isArray(L==null?void 0:L.folders)&&(L.isFolder=!0),re=xe.update.many):Array.isArray(L)&&(re=xe.find.many),y("put",b+re,L,B,D,Y)}},delete:(...k)=>{var _,S,T;if(E.auth().$currentUserId&&(h==null?void 0:h.host)===(n==null?void 0:n.DATABASE)&&J(this,Je)&&!J(this,Be))return(T=(S=(_=E.local())==null?void 0:_.database())==null?void 0:S.ref(g))==null?void 0:T.delete(...k);{let D=N(N({},E.ref(g,h,p)),E),{data:L,onRequest:B,callback:Y}=v(k),re=xe.delete.one;return J(this,Ce)?(Array.isArray(L==null?void 0:L.files)||Array.isArray(L==null?void 0:L.folders))&&(Array.isArray(L==null?void 0:L.files)&&(L.isFolder=!1),Array.isArray(L==null?void 0:L.folders)&&(L.isFolder=!0),Object.keys(L).length<=0&&(L.isFolder=!0),re=xe.delete.many):(Array.isArray(L)||L.where)&&(re=xe.delete.many),y("delete",b+re,L,B,D,Y)}},on:()=>{let k=N(N({},E.ref(g,h,p)),E);return l(p,h,k,g)},onValue:k=>{let _=N(N({},E.ref(g,h,p)),E),S=E.ref(g,h,p);return S==null||S.on().create(k),S==null||S.on().update(k),S==null||S.on().delete(k),S==null||S.on().upload(k),_}};return J(this,Ot)&&(x.send=(...k)=>{let _=N(N({},E.ref(g,h,p)),E),{data:S,onRequest:T,callback:D}=v(k),L=xe.send.one;return Array.isArray(S)&&(L=xe.send.many),y("post",b+L,S,T,_,D)}),J(this,Ce)&&(x.download=(...k)=>{let _=N(N({},E.ref(g,h,p)),E),{data:S,onRequest:T,callback:D}=v(k),L=An.download.one;return(Array.isArray(S==null?void 0:S.files)||Array.isArray(S==null?void 0:S.folders))&&(L=An.download.many),y("get",b+L+"?query="+JSON.stringify(o(S)),null,T,_,D)},x.upload=(...k)=>{let _=N(N({},E.ref(g,h,p)),E),{data:S,onRequest:T,callback:D}=v(k),L=An.upload+"?query="+JSON.stringify({storage:J(this,Ce),config:J(this,zt)});return y("post",b+L,S,T,_,D)}),x}}});_e(this,Pt,e);let{ENV:t,OFFLINE_DB_NAME:n}=J(this,Pt);_e(this,Te,hn.WithIndexedDB(n));let i=()=>I(this,null,function*(){try{let s,o=localStorage.getItem("accessToken");if((()=>{var c;try{s=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");let u=ts(o);return(Date==null?void 0:Date.parse((c=new Date((u==null?void 0:u.exp)*1e3))==null?void 0:c.toString()))<Date.now()}catch(u){return!1}})()&&s.uid)try{t==="dev"&&console.log("Token expired on inactivity, Trying to request a new refresh token")}catch(c){}}catch(s){}});"requestIdleCallback"in window&&requestIdleCallback(i)}}Kt=new WeakMap,rt=new WeakMap,xt=new WeakMap,Wt=new WeakMap,Ce=new WeakMap,qr=new WeakMap,zt=new WeakMap,Ot=new WeakMap,un=new WeakMap,Je=new WeakMap,Be=new WeakMap,Pt=new WeakMap,Te=new WeakMap;const Pf={init:r=>{try{return(e={})=>new Of(r).init(e)}catch(e){return{}}}};let If={init:r=>{var e,t,n,i,s,o,a,c;return{OFFLINE_DB_NAME:(r==null?void 0:r.OFFLINE_DB_NAME)||"swyger_database",ENV:(r==null?void 0:r.ENV)||"prod",HOST_SERVER:{AUTH:((e=r==null?void 0:r.HOST_SERVER)==null?void 0:e.AUTH)||"http://localhost:4100",DATABASE:((t=r==null?void 0:r.HOST_SERVER)==null?void 0:t.DATABASE)||"http://localhost:4400",STORAGE:((n=r==null?void 0:r.HOST_SERVER)==null?void 0:n.STORAGE)||"http://localhost:4500",MAIL:((i=r==null?void 0:r.HOST_SERVER)==null?void 0:i.MAIL)||"http://localhost:4200"},API_VERSION:{AUTH:((s=r==null?void 0:r.API_VERSION)==null?void 0:s.AUTH)||"/api/v1",DATABASE:((o=r==null?void 0:r.API_VERSION)==null?void 0:o.DATABASE)||"/api/v1",STORAGE:((a=r==null?void 0:r.API_VERSION)==null?void 0:a.STORAGE)||"/api/v1",MAIL:((c=r==null?void 0:r.API_VERSION)==null?void 0:c.MAIL)||"/api/v1"},AUTO_REFRESH_TOKEN_TIMEOUT:(r==null?void 0:r.AUTO_REFRESH_TOKEN_TIMEOUT)||15e5,API_KEY:(r==null?void 0:r.API_KEY)||"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJzd3lnZXIuY29tIiwiaWF0IjoxNjUzNDQwOTkxLCJleHAiOjE2ODQ5NzY5OTEsImF1ZCI6ImRheW52ZXIuY29tIiwic3ViIjoidGVhbUBzd3lnZXIuY29tIiwiR2l2ZW5OYW1lIjoiSXZhbiBKb2VsIiwiU3VybmFtZSI6IlNvYmd1aSIsIkVtYWlsIjoidGVhbUBhZ2dsb215LmNvbSIsIlJvbGUiOlsiQWRtaW4iLCJQcm9qZWN0IEFkbWluaXN0cmF0b3IiXX0.UvlcjBahR9G8dKxIeENJ7k4I87t3_oNJQ16eyPsRcSE"}}};const Rp={init:r=>{let e=If.init(r);const t=Fc.init(e),n={socket:{auth:t==null?void 0:t.auth,database:t==null?void 0:t.database,storage:t==null?void 0:t.storage}};return Pf.init(e)(n)}};var zr=function(r,e){return zr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])},zr(r,e)};function be(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");zr(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Rf(r,e,t,n){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(l){try{u(n.next(l))}catch(f){o(f)}}function c(l){try{u(n.throw(l))}catch(f){o(f)}}function u(l){l.done?s(l.value):i(l.value).then(a,c)}u((n=n.apply(r,e||[])).next())})}function yi(r,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(l){return c([u,l])}}function c(u){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(t=0)),t;)try{if(n=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){t.label=u[1];break}if(u[0]===6&&t.label<s[1]){t.label=s[1],s=u;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(u);break}s[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(l){u=[6,l],i=0}finally{n=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function Fe(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function he(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return s}function de(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,s;n<i;n++)(s||!(n in e))&&(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return r.concat(s||Array.prototype.slice.call(e))}function Mt(r){return this instanceof Mt?(this.v=r,this):new Mt(r)}function Nf(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(r,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(m){n[m]&&(i[m]=function(d){return new Promise(function(y,v){s.push([m,d,y,v])>1||a(m,d)})})}function a(m,d){try{c(n[m](d))}catch(y){f(s[0][3],y)}}function c(m){m.value instanceof Mt?Promise.resolve(m.value.v).then(u,l):f(s[0][2],m)}function u(m){a("next",m)}function l(m){a("throw",m)}function f(m,d){m(d),s.shift(),s.length&&a(s[0][0],s[0][1])}}function $f(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof Fe=="function"?Fe(r):r[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(s){t[s]=r[s]&&function(o){return new Promise(function(a,c){o=r[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(u){s({value:u,done:a})},o)}}function ee(r){return typeof r=="function"}function Nt(r){var e=function(n){Error.call(n),n.stack=new Error().stack},t=r(e);return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var Cn=Nt(function(r){return function(t){r(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(n,i){return i+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t}});function ht(r,e){if(r){var t=r.indexOf(e);0<=t&&r.splice(t,1)}}var Ke=function(){function r(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return r.prototype.unsubscribe=function(){var e,t,n,i,s;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var a=Fe(o),c=a.next();!c.done;c=a.next()){var u=c.value;u.remove(this)}}catch(v){e={error:v}}finally{try{c&&!c.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}else o.remove(this);var l=this.initialTeardown;if(ee(l))try{l()}catch(v){s=v instanceof Cn?v.errors:[v]}var f=this._finalizers;if(f){this._finalizers=null;try{for(var m=Fe(f),d=m.next();!d.done;d=m.next()){var y=d.value;try{Ps(y)}catch(v){s=s!=null?s:[],v instanceof Cn?s=de(de([],he(s)),he(v.errors)):s.push(v)}}}catch(v){n={error:v}}finally{try{d&&!d.done&&(i=m.return)&&i.call(m)}finally{if(n)throw n.error}}}if(s)throw new Cn(s)}},r.prototype.add=function(e){var t;if(e&&e!==this)if(this.closed)Ps(e);else{if(e instanceof r){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}},r.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},r.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},r.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&ht(t,e)},r.prototype.remove=function(e){var t=this._finalizers;t&&ht(t,e),e instanceof r&&e._removeParent(this)},r.EMPTY=function(){var e=new r;return e.closed=!0,e}(),r}(),Ko=Ke.EMPTY;function Wo(r){return r instanceof Ke||r&&"closed"in r&&ee(r.remove)&&ee(r.add)&&ee(r.unsubscribe)}function Ps(r){ee(r)?r():r.unsubscribe()}var At={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Kn={setTimeout:function(r,e){for(var t=[],n=2;n<arguments.length;n++)t[n-2]=arguments[n];var i=Kn.delegate;return i!=null&&i.setTimeout?i.setTimeout.apply(i,de([r,e],he(t))):setTimeout.apply(void 0,de([r,e],he(t)))},clearTimeout:function(r){var e=Kn.delegate;return((e==null?void 0:e.clearTimeout)||clearTimeout)(r)},delegate:void 0};function zo(r){Kn.setTimeout(function(){var e=At.onUnhandledError;if(e)e(r);else throw r})}function we(){}var Cf=function(){return mi("C",void 0,void 0)}();function Bf(r){return mi("E",void 0,r)}function jf(r){return mi("N",r,void 0)}function mi(r,e,t){return{kind:r,value:e,error:t}}var Tt=null;function Bn(r){if(At.useDeprecatedSynchronousErrorHandling){var e=!Tt;if(e&&(Tt={errorThrown:!1,error:null}),r(),e){var t=Tt,n=t.errorThrown,i=t.error;if(Tt=null,n)throw i}}else r()}function Lf(r){At.useDeprecatedSynchronousErrorHandling&&Tt&&(Tt.errorThrown=!0,Tt.error=r)}var er=function(r){be(e,r);function e(t){var n=r.call(this)||this;return n.isStopped=!1,t?(n.destination=t,Wo(t)&&t.add(n)):n.destination=Mf,n}return e.create=function(t,n,i){return new Jt(t,n,i)},e.prototype.next=function(t){this.isStopped?_r(jf(t),this):this._next(t)},e.prototype.error=function(t){this.isStopped?_r(Bf(t),this):(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped?_r(Cf,this):(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,r.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(Ke),Df=Function.prototype.bind;function Sr(r,e){return Df.call(r,e)}var Uf=function(){function r(e){this.partialObserver=e}return r.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(n){Sn(n)}},r.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(n){Sn(n)}else Sn(e)},r.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(t){Sn(t)}},r}(),Jt=function(r){be(e,r);function e(t,n,i){var s=r.call(this)||this,o;if(ee(t)||!t)o={next:t!=null?t:void 0,error:n!=null?n:void 0,complete:i!=null?i:void 0};else{var a;s&&At.useDeprecatedNextContext?(a=Object.create(t),a.unsubscribe=function(){return s.unsubscribe()},o={next:t.next&&Sr(t.next,a),error:t.error&&Sr(t.error,a),complete:t.complete&&Sr(t.complete,a)}):o=t}return s.destination=new Uf(o),s}return e}(er);function Sn(r){At.useDeprecatedSynchronousErrorHandling?Lf(r):zo(r)}function Ff(r){throw r}function _r(r,e){var t=At.onStoppedNotification;t&&Kn.setTimeout(function(){return t(r,e)})}var Mf={closed:!0,next:we,error:Ff,complete:we},tr=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Pe(r){return r}function gi(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return Vo(r)}function Vo(r){return r.length===0?Pe:r.length===1?r[0]:function(t){return r.reduce(function(n,i){return i(n)},t)}}var se=function(){function r(e){e&&(this._subscribe=e)}return r.prototype.lift=function(e){var t=new r;return t.source=this,t.operator=e,t},r.prototype.subscribe=function(e,t,n){var i=this,s=Wf(e)?e:new Jt(e,t,n);return Bn(function(){var o=i,a=o.operator,c=o.source;s.add(a?a.call(s,c):c?i._subscribe(s):i._trySubscribe(s))}),s},r.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},r.prototype.forEach=function(e,t){var n=this;return t=Is(t),new t(function(i,s){var o=new Jt({next:function(a){try{e(a)}catch(c){s(c),o.unsubscribe()}},error:s,complete:i});n.subscribe(o)})},r.prototype._subscribe=function(e){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(e)},r.prototype[tr]=function(){return this},r.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Vo(e)(this)},r.prototype.toPromise=function(e){var t=this;return e=Is(e),new e(function(n,i){var s;t.subscribe(function(o){return s=o},function(o){return i(o)},function(){return n(s)})})},r.create=function(e){return new r(e)},r}();function Is(r){var e;return(e=r!=null?r:At.Promise)!==null&&e!==void 0?e:Promise}function Kf(r){return r&&ee(r.next)&&ee(r.error)&&ee(r.complete)}function Wf(r){return r&&r instanceof er||Kf(r)&&Wo(r)}function Ho(r){return ee(r==null?void 0:r.lift)}function H(r){return function(e){if(Ho(e))return e.lift(function(t){try{return r(t,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}function V(r,e,t,n,i){return new vi(r,e,t,n,i)}var vi=function(r){be(e,r);function e(t,n,i,s,o,a){var c=r.call(this,t)||this;return c.onFinalize=o,c.shouldUnsubscribe=a,c._next=n?function(u){try{n(u)}catch(l){t.error(l)}}:r.prototype._next,c._error=s?function(u){try{s(u)}catch(l){t.error(l)}finally{this.unsubscribe()}}:r.prototype._error,c._complete=i?function(){try{i()}catch(u){t.error(u)}finally{this.unsubscribe()}}:r.prototype._complete,c}return e.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;r.prototype.unsubscribe.call(this),!n&&((t=this.onFinalize)===null||t===void 0||t.call(this))}},e}(er);function Jo(){return H(function(r,e){var t=null;r._refCount++;var n=V(e,void 0,void 0,void 0,function(){if(!r||r._refCount<=0||0<--r._refCount){t=null;return}var i=r._connection,s=t;t=null,i&&(!s||i===s)&&i.unsubscribe(),e.unsubscribe()});r.subscribe(n),n.closed||(t=r.connect())})}var nr=function(r){be(e,r);function e(t,n){var i=r.call(this)||this;return i.source=t,i.subjectFactory=n,i._subject=null,i._refCount=0,i._connection=null,Ho(t)&&(i.lift=t.lift),i}return e.prototype._subscribe=function(t){return this.getSubject().subscribe(t)},e.prototype.getSubject=function(){var t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject},e.prototype._teardown=function(){this._refCount=0;var t=this._connection;this._subject=this._connection=null,t==null||t.unsubscribe()},e.prototype.connect=function(){var t=this,n=this._connection;if(!n){n=this._connection=new Ke;var i=this.getSubject();n.add(this.source.subscribe(V(i,void 0,function(){t._teardown(),i.complete()},function(s){t._teardown(),i.error(s)},function(){return t._teardown()}))),n.closed&&(this._connection=null,n=Ke.EMPTY)}return n},e.prototype.refCount=function(){return Jo()(this)},e}(se),Yo={now:function(){return(Yo.delegate||performance).now()},delegate:void 0},It={schedule:function(r){var e=requestAnimationFrame,t=cancelAnimationFrame,n=It.delegate;n&&(e=n.requestAnimationFrame,t=n.cancelAnimationFrame);var i=e(function(s){t=void 0,r(s)});return new Ke(function(){return t==null?void 0:t(i)})},requestAnimationFrame:function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=It.delegate;return((t==null?void 0:t.requestAnimationFrame)||requestAnimationFrame).apply(void 0,de([],he(r)))},cancelAnimationFrame:function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=It.delegate;return((t==null?void 0:t.cancelAnimationFrame)||cancelAnimationFrame).apply(void 0,de([],he(r)))},delegate:void 0};function zf(r){return r?Go(r):Vf}function Go(r){return new se(function(e){var t=r||Yo,n=t.now(),i=0,s=function(){e.closed||(i=It.requestAnimationFrame(function(o){i=0;var a=t.now();e.next({timestamp:r?a:o,elapsed:a-n}),s()}))};return s(),function(){i&&It.cancelAnimationFrame(i)}})}var Vf=Go(),Qo=Nt(function(r){return function(){r(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),Ae=function(r){be(e,r);function e(){var t=r.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return e.prototype.lift=function(t){var n=new Rs(this,this);return n.operator=t,n},e.prototype._throwIfClosed=function(){if(this.closed)throw new Qo},e.prototype.next=function(t){var n=this;Bn(function(){var i,s;if(n._throwIfClosed(),!n.isStopped){n.currentObservers||(n.currentObservers=Array.from(n.observers));try{for(var o=Fe(n.currentObservers),a=o.next();!a.done;a=o.next()){var c=a.value;c.next(t)}}catch(u){i={error:u}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}}})},e.prototype.error=function(t){var n=this;Bn(function(){if(n._throwIfClosed(),!n.isStopped){n.hasError=n.isStopped=!0,n.thrownError=t;for(var i=n.observers;i.length;)i.shift().error(t)}})},e.prototype.complete=function(){var t=this;Bn(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var n=t.observers;n.length;)n.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(t){return this._throwIfClosed(),r.prototype._trySubscribe.call(this,t)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var n=this,i=this,s=i.hasError,o=i.isStopped,a=i.observers;return s||o?Ko:(this.currentObservers=null,a.push(t),new Ke(function(){n.currentObservers=null,ht(a,t)}))},e.prototype._checkFinalizedStatuses=function(t){var n=this,i=n.hasError,s=n.thrownError,o=n.isStopped;i?t.error(s):o&&t.complete()},e.prototype.asObservable=function(){var t=new se;return t.source=this,t},e.create=function(t,n){return new Rs(t,n)},e}(se),Rs=function(r){be(e,r);function e(t,n){var i=r.call(this)||this;return i.destination=t,i.source=n,i}return e.prototype.next=function(t){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.next)===null||i===void 0||i.call(n,t)},e.prototype.error=function(t){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.error)===null||i===void 0||i.call(n,t)},e.prototype.complete=function(){var t,n;(n=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||n===void 0||n.call(t)},e.prototype._subscribe=function(t){var n,i;return(i=(n=this.source)===null||n===void 0?void 0:n.subscribe(t))!==null&&i!==void 0?i:Ko},e}(Ae),qo=function(r){be(e,r);function e(t){var n=r.call(this)||this;return n._value=t,n}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(t){var n=r.prototype._subscribe.call(this,t);return!n.closed&&t.next(this._value),n},e.prototype.getValue=function(){var t=this,n=t.hasError,i=t.thrownError,s=t._value;if(n)throw i;return this._throwIfClosed(),s},e.prototype.next=function(t){r.prototype.next.call(this,this._value=t)},e}(Ae),rr={now:function(){return(rr.delegate||Date).now()},delegate:void 0},wi=function(r){be(e,r);function e(t,n,i){t===void 0&&(t=1/0),n===void 0&&(n=1/0),i===void 0&&(i=rr);var s=r.call(this)||this;return s._bufferSize=t,s._windowTime=n,s._timestampProvider=i,s._buffer=[],s._infiniteTimeWindow=!0,s._infiniteTimeWindow=n===1/0,s._bufferSize=Math.max(1,t),s._windowTime=Math.max(1,n),s}return e.prototype.next=function(t){var n=this,i=n.isStopped,s=n._buffer,o=n._infiniteTimeWindow,a=n._timestampProvider,c=n._windowTime;i||(s.push(t),!o&&s.push(a.now()+c)),this._trimBuffer(),r.prototype.next.call(this,t)},e.prototype._subscribe=function(t){this._throwIfClosed(),this._trimBuffer();for(var n=this._innerSubscribe(t),i=this,s=i._infiniteTimeWindow,o=i._buffer,a=o.slice(),c=0;c<a.length&&!t.closed;c+=s?1:2)t.next(a[c]);return this._checkFinalizedStatuses(t),n},e.prototype._trimBuffer=function(){var t=this,n=t._bufferSize,i=t._timestampProvider,s=t._buffer,o=t._infiniteTimeWindow,a=(o?1:2)*n;if(n<1/0&&a<s.length&&s.splice(0,s.length-a),!o){for(var c=i.now(),u=0,l=1;l<s.length&&s[l]<=c;l+=2)u=l;u&&s.splice(0,u+1)}},e}(Ae),bi=function(r){be(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t._value=null,t._hasValue=!1,t._isComplete=!1,t}return e.prototype._checkFinalizedStatuses=function(t){var n=this,i=n.hasError,s=n._hasValue,o=n._value,a=n.thrownError,c=n.isStopped,u=n._isComplete;i?t.error(a):(c||u)&&(s&&t.next(o),t.complete())},e.prototype.next=function(t){this.isStopped||(this._value=t,this._hasValue=!0)},e.prototype.complete=function(){var t=this,n=t._hasValue,i=t._value,s=t._isComplete;s||(this._isComplete=!0,n&&r.prototype.next.call(this,i),r.prototype.complete.call(this))},e}(Ae),Hf=function(r){be(e,r);function e(t,n){return r.call(this)||this}return e.prototype.schedule=function(t,n){return this},e}(Ke),Wn={setInterval:function(r,e){for(var t=[],n=2;n<arguments.length;n++)t[n-2]=arguments[n];var i=Wn.delegate;return i!=null&&i.setInterval?i.setInterval.apply(i,de([r,e],he(t))):setInterval.apply(void 0,de([r,e],he(t)))},clearInterval:function(r){var e=Wn.delegate;return((e==null?void 0:e.clearInterval)||clearInterval)(r)},delegate:void 0},dn=function(r){be(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.scheduler=t,i.work=n,i.pending=!1,i}return e.prototype.schedule=function(t,n){var i;if(n===void 0&&(n=0),this.closed)return this;this.state=t;var s=this.id,o=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(o,s,n)),this.pending=!0,this.delay=n,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(o,this.id,n),this},e.prototype.requestAsyncId=function(t,n,i){return i===void 0&&(i=0),Wn.setInterval(t.flush.bind(t,this),i)},e.prototype.recycleAsyncId=function(t,n,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return n;n!=null&&Wn.clearInterval(n)},e.prototype.execute=function(t,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(t,n);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,n){var i=!1,s;try{this.work(t)}catch(o){i=!0,s=o||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),s},e.prototype.unsubscribe=function(){if(!this.closed){var t=this,n=t.id,i=t.scheduler,s=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,ht(s,this),n!=null&&(this.id=this.recycleAsyncId(i,n,null)),this.delay=null,r.prototype.unsubscribe.call(this)}},e}(Hf),Jf=1,Tr,Vr={};function Ns(r){return r in Vr?(delete Vr[r],!0):!1}var Xo={setImmediate:function(r){var e=Jf++;return Vr[e]=!0,Tr||(Tr=Promise.resolve()),Tr.then(function(){return Ns(e)&&r()}),e},clearImmediate:function(r){Ns(r)}},Yf=Xo.setImmediate,Gf=Xo.clearImmediate,zn={setImmediate:function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=zn.delegate;return((t==null?void 0:t.setImmediate)||Yf).apply(void 0,de([],he(r)))},clearImmediate:function(r){var e=zn.delegate;return((e==null?void 0:e.clearImmediate)||Gf)(r)},delegate:void 0},Qf=function(r){be(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.scheduler=t,i.work=n,i}return e.prototype.requestAsyncId=function(t,n,i){return i===void 0&&(i=0),i!==null&&i>0?r.prototype.requestAsyncId.call(this,t,n,i):(t.actions.push(this),t._scheduled||(t._scheduled=zn.setImmediate(t.flush.bind(t,void 0))))},e.prototype.recycleAsyncId=function(t,n,i){var s;if(i===void 0&&(i=0),i!=null?i>0:this.delay>0)return r.prototype.recycleAsyncId.call(this,t,n,i);var o=t.actions;n!=null&&((s=o[o.length-1])===null||s===void 0?void 0:s.id)!==n&&(zn.clearImmediate(n),t._scheduled===n&&(t._scheduled=void 0))},e}(dn),Hr=function(){function r(e,t){t===void 0&&(t=r.now),this.schedulerActionCtor=e,this.now=t}return r.prototype.schedule=function(e,t,n){return t===void 0&&(t=0),new this.schedulerActionCtor(this,e).schedule(n,t)},r.now=rr.now,r}(),pn=function(r){be(e,r);function e(t,n){n===void 0&&(n=Hr.now);var i=r.call(this,t,n)||this;return i.actions=[],i._active=!1,i}return e.prototype.flush=function(t){var n=this.actions;if(this._active){n.push(t);return}var i;this._active=!0;do if(i=t.execute(t.state,t.delay))break;while(t=n.shift());if(this._active=!1,i){for(;t=n.shift();)t.unsubscribe();throw i}},e}(Hr),qf=function(r){be(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.flush=function(t){this._active=!0;var n=this._scheduled;this._scheduled=void 0;var i=this.actions,s;t=t||i.shift();do if(s=t.execute(t.state,t.delay))break;while((t=i[0])&&t.id===n&&i.shift());if(this._active=!1,s){for(;(t=i[0])&&t.id===n&&i.shift();)t.unsubscribe();throw s}},e}(pn),Zo=new qf(Qf),Xf=Zo,qe=new pn(dn),xi=qe,Zf=function(r){be(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.scheduler=t,i.work=n,i}return e.prototype.schedule=function(t,n){return n===void 0&&(n=0),n>0?r.prototype.schedule.call(this,t,n):(this.delay=n,this.state=t,this.scheduler.flush(this),this)},e.prototype.execute=function(t,n){return n>0||this.closed?r.prototype.execute.call(this,t,n):this._execute(t,n)},e.prototype.requestAsyncId=function(t,n,i){return i===void 0&&(i=0),i!=null&&i>0||i==null&&this.delay>0?r.prototype.requestAsyncId.call(this,t,n,i):(t.flush(this),0)},e}(dn),eh=function(r){be(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(pn),ea=new eh(Zf),th=ea,nh=function(r){be(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.scheduler=t,i.work=n,i}return e.prototype.requestAsyncId=function(t,n,i){return i===void 0&&(i=0),i!==null&&i>0?r.prototype.requestAsyncId.call(this,t,n,i):(t.actions.push(this),t._scheduled||(t._scheduled=It.requestAnimationFrame(function(){return t.flush(void 0)})))},e.prototype.recycleAsyncId=function(t,n,i){var s;if(i===void 0&&(i=0),i!=null?i>0:this.delay>0)return r.prototype.recycleAsyncId.call(this,t,n,i);var o=t.actions;n!=null&&((s=o[o.length-1])===null||s===void 0?void 0:s.id)!==n&&(It.cancelAnimationFrame(n),t._scheduled=void 0)},e}(dn),rh=function(r){be(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.flush=function(t){this._active=!0;var n=this._scheduled;this._scheduled=void 0;var i=this.actions,s;t=t||i.shift();do if(s=t.execute(t.state,t.delay))break;while((t=i[0])&&t.id===n&&i.shift());if(this._active=!1,s){for(;(t=i[0])&&t.id===n&&i.shift();)t.unsubscribe();throw s}},e}(pn),ta=new rh(nh),ih=ta,sh=function(r){be(e,r);function e(t,n){t===void 0&&(t=na),n===void 0&&(n=1/0);var i=r.call(this,t,function(){return i.frame})||this;return i.maxFrames=n,i.frame=0,i.index=-1,i}return e.prototype.flush=function(){for(var t=this,n=t.actions,i=t.maxFrames,s,o;(o=n[0])&&o.delay<=i&&(n.shift(),this.frame=o.delay,!(s=o.execute(o.state,o.delay))););if(s){for(;o=n.shift();)o.unsubscribe();throw s}},e.frameTimeFactor=10,e}(pn),na=function(r){be(e,r);function e(t,n,i){i===void 0&&(i=t.index+=1);var s=r.call(this,t,n)||this;return s.scheduler=t,s.work=n,s.index=i,s.active=!0,s.index=t.index=i,s}return e.prototype.schedule=function(t,n){if(n===void 0&&(n=0),Number.isFinite(n)){if(!this.id)return r.prototype.schedule.call(this,t,n);this.active=!1;var i=new e(this.scheduler,this.work);return this.add(i),i.schedule(t,n)}else return Ke.EMPTY},e.prototype.requestAsyncId=function(t,n,i){i===void 0&&(i=0),this.delay=t.frame+i;var s=t.actions;return s.push(this),s.sort(e.sortActions),1},e.prototype.recycleAsyncId=function(t,n,i){},e.prototype._execute=function(t,n){if(this.active===!0)return r.prototype._execute.call(this,t,n)},e.sortActions=function(t,n){return t.delay===n.delay?t.index===n.index?0:t.index>n.index?1:-1:t.delay>n.delay?1:-1},e}(dn),ct=new se(function(r){return r.complete()});function oh(r){return r?ah(r):ct}function ah(r){return new se(function(e){return r.schedule(function(){return e.complete()})})}function ir(r){return r&&ee(r.schedule)}function Ei(r){return r[r.length-1]}function yn(r){return ee(Ei(r))?r.pop():void 0}function dt(r){return ir(Ei(r))?r.pop():void 0}function ra(r,e){return typeof Ei(r)=="number"?r.pop():e}var ki=function(r){return r&&typeof r.length=="number"&&typeof r!="function"};function ia(r){return ee(r==null?void 0:r.then)}function sa(r){return ee(r[tr])}function oa(r){return Symbol.asyncIterator&&ee(r==null?void 0:r[Symbol.asyncIterator])}function aa(r){return new TypeError("You provided "+(r!==null&&typeof r=="object"?"an invalid object":"'"+r+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function ch(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var ca=ch();function ua(r){return ee(r==null?void 0:r[ca])}function la(r){return Nf(this,arguments,function(){var t,n,i,s;return yi(this,function(o){switch(o.label){case 0:t=r.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,Mt(t.read())];case 3:return n=o.sent(),i=n.value,s=n.done,s?[4,Mt(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,Mt(i)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}function fa(r){return ee(r==null?void 0:r.getReader)}function q(r){if(r instanceof se)return r;if(r!=null){if(sa(r))return uh(r);if(ki(r))return lh(r);if(ia(r))return fh(r);if(oa(r))return ha(r);if(ua(r))return hh(r);if(fa(r))return dh(r)}throw aa(r)}function uh(r){return new se(function(e){var t=r[tr]();if(ee(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function lh(r){return new se(function(e){for(var t=0;t<r.length&&!e.closed;t++)e.next(r[t]);e.complete()})}function fh(r){return new se(function(e){r.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,zo)})}function hh(r){return new se(function(e){var t,n;try{for(var i=Fe(r),s=i.next();!s.done;s=i.next()){var o=s.value;if(e.next(o),e.closed)return}}catch(a){t={error:a}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}e.complete()})}function ha(r){return new se(function(e){ph(r,e).catch(function(t){return e.error(t)})})}function dh(r){return ha(la(r))}function ph(r,e){var t,n,i,s;return Rf(this,void 0,void 0,function(){var o,a;return yi(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),t=$f(r),c.label=1;case 1:return[4,t.next()];case 2:if(n=c.sent(),!!n.done)return[3,4];if(o=n.value,e.next(o),e.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),i={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),n&&!n.done&&(s=t.return)?[4,s.call(t)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function Me(r,e,t,n,i){n===void 0&&(n=0),i===void 0&&(i=!1);var s=e.schedule(function(){t(),i?r.add(this.schedule(null,n)):this.unsubscribe()},n);if(r.add(s),!i)return s}function sr(r,e){return e===void 0&&(e=0),H(function(t,n){t.subscribe(V(n,function(i){return Me(n,r,function(){return n.next(i)},e)},function(){return Me(n,r,function(){return n.complete()},e)},function(i){return Me(n,r,function(){return n.error(i)},e)}))})}function or(r,e){return e===void 0&&(e=0),H(function(t,n){n.add(r.schedule(function(){return t.subscribe(n)},e))})}function yh(r,e){return q(r).pipe(or(e),sr(e))}function mh(r,e){return q(r).pipe(or(e),sr(e))}function gh(r,e){return new se(function(t){var n=0;return e.schedule(function(){n===r.length?t.complete():(t.next(r[n++]),t.closed||this.schedule())})})}function da(r,e){return new se(function(t){var n;return Me(t,e,function(){n=r[ca](),Me(t,e,function(){var i,s,o;try{i=n.next(),s=i.value,o=i.done}catch(a){t.error(a);return}o?t.complete():t.next(s)},0,!0)}),function(){return ee(n==null?void 0:n.return)&&n.return()}})}function pa(r,e){if(!r)throw new Error("Iterable cannot be null");return new se(function(t){Me(t,e,function(){var n=r[Symbol.asyncIterator]();Me(t,e,function(){n.next().then(function(i){i.done?t.complete():t.next(i.value)})},0,!0)})})}function vh(r,e){return pa(la(r),e)}function ya(r,e){if(r!=null){if(sa(r))return yh(r,e);if(ki(r))return gh(r,e);if(ia(r))return mh(r,e);if(oa(r))return pa(r,e);if(ua(r))return da(r,e);if(fa(r))return vh(r,e)}throw aa(r)}function pt(r,e){return e?ya(r,e):q(r)}function Ai(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=dt(r);return pt(r,t)}function ma(r,e){var t=ee(r)?r:function(){return r},n=function(i){return i.error(t())};return new se(e?function(i){return e.schedule(n,0,i)}:n)}var Jr;(function(r){r.NEXT="N",r.ERROR="E",r.COMPLETE="C"})(Jr||(Jr={}));var jn=function(){function r(e,t,n){this.kind=e,this.value=t,this.error=n,this.hasValue=e==="N"}return r.prototype.observe=function(e){return ga(this,e)},r.prototype.do=function(e,t,n){var i=this,s=i.kind,o=i.value,a=i.error;return s==="N"?e==null?void 0:e(o):s==="E"?t==null?void 0:t(a):n==null?void 0:n()},r.prototype.accept=function(e,t,n){var i;return ee((i=e)===null||i===void 0?void 0:i.next)?this.observe(e):this.do(e,t,n)},r.prototype.toObservable=function(){var e=this,t=e.kind,n=e.value,i=e.error,s=t==="N"?Ai(n):t==="E"?ma(function(){return i}):t==="C"?ct:0;if(!s)throw new TypeError("Unexpected notification kind "+t);return s},r.createNext=function(e){return new r("N",e)},r.createError=function(e){return new r("E",void 0,e)},r.createComplete=function(){return r.completeNotification},r.completeNotification=new r("C"),r}();function ga(r,e){var t,n,i,s=r,o=s.kind,a=s.value,c=s.error;if(typeof o!="string")throw new TypeError('Invalid notification, missing "kind"');o==="N"?(t=e.next)===null||t===void 0||t.call(e,a):o==="E"?(n=e.error)===null||n===void 0||n.call(e,c):(i=e.complete)===null||i===void 0||i.call(e)}function wh(r){return!!r&&(r instanceof se||ee(r.lift)&&ee(r.subscribe))}var $t=Nt(function(r){return function(){r(this),this.name="EmptyError",this.message="no elements in sequence"}});function bh(r,e){var t=typeof e=="object";return new Promise(function(n,i){var s=!1,o;r.subscribe({next:function(a){o=a,s=!0},error:i,complete:function(){s?n(o):t?n(e.defaultValue):i(new $t)}})})}function xh(r,e){var t=typeof e=="object";return new Promise(function(n,i){var s=new Jt({next:function(o){n(o),s.unsubscribe()},error:i,complete:function(){t?n(e.defaultValue):i(new $t)}});r.subscribe(s)})}var Yr=Nt(function(r){return function(){r(this),this.name="ArgumentOutOfRangeError",this.message="argument out of range"}}),va=Nt(function(r){return function(t){r(this),this.name="NotFoundError",this.message=t}}),wa=Nt(function(r){return function(t){r(this),this.name="SequenceError",this.message=t}});function Si(r){return r instanceof Date&&!isNaN(r)}var ba=Nt(function(r){return function(t){t===void 0&&(t=null),r(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=t}});function xa(r,e){var t=Si(r)?{first:r}:typeof r=="number"?{each:r}:r,n=t.first,i=t.each,s=t.with,o=s===void 0?Eh:s,a=t.scheduler,c=a===void 0?e!=null?e:qe:a,u=t.meta,l=u===void 0?null:u;if(n==null&&i==null)throw new TypeError("No timeout provided.");return H(function(f,m){var d,y,v=null,A=0,O=function(C){y=Me(m,c,function(){try{d.unsubscribe(),q(o({meta:l,lastValue:v,seen:A})).subscribe(m)}catch(R){m.error(R)}},C)};d=f.subscribe(V(m,function(C){y==null||y.unsubscribe(),A++,m.next(v=C),i>0&&O(i)},void 0,void 0,function(){y!=null&&y.closed||y==null||y.unsubscribe(),v=null})),!A&&O(n!=null?typeof n=="number"?n:+n-c.now():i)})}function Eh(r){throw new ba(r)}function Ct(r,e){return H(function(t,n){var i=0;t.subscribe(V(n,function(s){n.next(r.call(e,s,i++))}))})}var kh=Array.isArray;function Ah(r,e){return kh(e)?r.apply(void 0,de([],he(e))):r(e)}function Bt(r){return Ct(function(e){return Ah(r,e)})}function Vn(r,e,t,n){if(t)if(ir(t))n=t;else return function(){for(var i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];return Vn(r,e,n).apply(this,i).pipe(Bt(t))};return n?function(){for(var i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];return Vn(r,e).apply(this,i).pipe(or(n),sr(n))}:function(){for(var i=this,s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];var a=new bi,c=!0;return new se(function(u){var l=a.subscribe(u);if(c){c=!1;var f=!1,m=!1;e.apply(i,de(de([],he(s)),[function(){for(var d=[],y=0;y<arguments.length;y++)d[y]=arguments[y];if(r){var v=d.shift();if(v!=null){a.error(v);return}}a.next(1<d.length?d:d[0]),m=!0,f&&a.complete()}])),m&&a.complete(),f=!0}return l})}}function Sh(r,e,t){return Vn(!1,r,e,t)}function _h(r,e,t){return Vn(!0,r,e,t)}var Th=Array.isArray,Oh=Object.getPrototypeOf,Ph=Object.prototype,Ih=Object.keys;function Ea(r){if(r.length===1){var e=r[0];if(Th(e))return{args:e,keys:null};if(Rh(e)){var t=Ih(e);return{args:t.map(function(n){return e[n]}),keys:t}}}return{args:r,keys:null}}function Rh(r){return r&&typeof r=="object"&&Oh(r)===Ph}function ka(r,e){return r.reduce(function(t,n,i){return t[n]=e[i],t},{})}function Aa(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=dt(r),n=yn(r),i=Ea(r),s=i.args,o=i.keys;if(s.length===0)return pt([],t);var a=new se(Sa(s,t,o?function(c){return ka(o,c)}:Pe));return n?a.pipe(Bt(n)):a}function Sa(r,e,t){return t===void 0&&(t=Pe),function(n){$s(e,function(){for(var i=r.length,s=new Array(i),o=i,a=i,c=function(l){$s(e,function(){var f=pt(r[l],e),m=!1;f.subscribe(V(n,function(d){s[l]=d,m||(m=!0,a--),a||n.next(t(s.slice()))},function(){--o||n.complete()}))},n)},u=0;u<i;u++)c(u)},n)}}function $s(r,e,t){r?Me(t,r,e):e()}function _i(r,e,t,n,i,s,o,a){var c=[],u=0,l=0,f=!1,m=function(){f&&!c.length&&!u&&e.complete()},d=function(v){return u<n?y(v):c.push(v)},y=function(v){s&&e.next(v),u++;var A=!1;q(t(v,l++)).subscribe(V(e,function(O){i==null||i(O),s?d(O):e.next(O)},function(){A=!0},void 0,function(){if(A)try{u--;for(var O=function(){var C=c.shift();o?Me(e,o,function(){return y(C)}):y(C)};c.length&&u<n;)O();m()}catch(C){e.error(C)}}))};return r.subscribe(V(e,d,function(){f=!0,m()})),function(){a==null||a()}}function nt(r,e,t){return t===void 0&&(t=1/0),ee(e)?nt(function(n,i){return Ct(function(s,o){return e(n,s,i,o)})(q(r(n,i)))},t):(typeof e=="number"&&(t=e),H(function(n,i){return _i(n,i,r,t)}))}function ar(r){return r===void 0&&(r=1/0),nt(Pe,r)}function Ti(){return ar(1)}function on(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return Ti()(pt(r,dt(r)))}function cr(r){return new se(function(e){q(r()).subscribe(e)})}var Nh={connector:function(){return new Ae},resetOnDisconnect:!0};function $h(r,e){e===void 0&&(e=Nh);var t=null,n=e.connector,i=e.resetOnDisconnect,s=i===void 0?!0:i,o=n(),a=new se(function(c){return o.subscribe(c)});return a.connect=function(){return(!t||t.closed)&&(t=cr(function(){return r}).subscribe(o),s&&t.add(function(){return o=n()})),t},a}function Ch(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=yn(r),n=Ea(r),i=n.args,s=n.keys,o=new se(function(a){var c=i.length;if(!c){a.complete();return}for(var u=new Array(c),l=c,f=c,m=function(y){var v=!1;q(i[y]).subscribe(V(a,function(A){v||(v=!0,f--),u[y]=A},function(){return l--},void 0,function(){(!l||!v)&&(f||a.next(s?ka(s,u):u),a.complete())}))},d=0;d<c;d++)m(d)});return t?o.pipe(Bt(t)):o}var Bh=["addListener","removeListener"],jh=["addEventListener","removeEventListener"],Lh=["on","off"];function Gr(r,e,t,n){if(ee(t)&&(n=t,t=void 0),n)return Gr(r,e,t).pipe(Bt(n));var i=he(Fh(r)?jh.map(function(a){return function(c){return r[a](e,c,t)}}):Dh(r)?Bh.map(Cs(r,e)):Uh(r)?Lh.map(Cs(r,e)):[],2),s=i[0],o=i[1];if(!s&&ki(r))return nt(function(a){return Gr(a,e,t)})(q(r));if(!s)throw new TypeError("Invalid event target");return new se(function(a){var c=function(){for(var u=[],l=0;l<arguments.length;l++)u[l]=arguments[l];return a.next(1<u.length?u:u[0])};return s(c),function(){return o(c)}})}function Cs(r,e){return function(t){return function(n){return r[t](e,n)}}}function Dh(r){return ee(r.addListener)&&ee(r.removeListener)}function Uh(r){return ee(r.on)&&ee(r.off)}function Fh(r){return ee(r.addEventListener)&&ee(r.removeEventListener)}function _a(r,e,t){return t?_a(r,e).pipe(Bt(t)):new se(function(n){var i=function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];return n.next(o.length===1?o[0]:o)},s=r(i);return ee(e)?function(){return e(i,s)}:void 0})}function Mh(r,e,t,n,i){var s,o,a,c;arguments.length===1?(s=r,c=s.initialState,e=s.condition,t=s.iterate,o=s.resultSelector,a=o===void 0?Pe:o,i=s.scheduler):(c=r,!n||ir(n)?(a=Pe,i=n):a=n);function u(){var l;return yi(this,function(f){switch(f.label){case 0:l=c,f.label=1;case 1:return!e||e(l)?[4,a(l)]:[3,4];case 2:f.sent(),f.label=3;case 3:return l=t(l),[3,1];case 4:return[2]}})}return cr(i?function(){return da(u(),i)}:u)}function Kh(r,e,t){return cr(function(){return r()?e:t})}function jt(r,e,t){r===void 0&&(r=0),t===void 0&&(t=xi);var n=-1;return e!=null&&(ir(e)?t=e:n=e),new se(function(i){var s=Si(r)?+r-t.now():r;s<0&&(s=0);var o=0;return t.schedule(function(){i.closed||(i.next(o++),0<=n?this.schedule(void 0,n):i.complete())},s)})}function Ta(r,e){return r===void 0&&(r=0),e===void 0&&(e=qe),r<0&&(r=0),jt(r,r,e)}function Wh(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=dt(r),n=ra(r,1/0),i=r;return i.length?i.length===1?q(i[0]):ar(n)(pt(i,t)):ct}var Oa=new se(we);function zh(){return Oa}var Vh=Array.isArray;function Qt(r){return r.length===1&&Vh(r[0])?r[0]:r}function Pa(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=Qt(r);return new se(function(n){var i=0,s=function(){if(i<t.length){var o=void 0;try{o=q(t[i++])}catch(c){s();return}var a=new vi(n,void 0,we,we);o.subscribe(a),a.add(s)}else n.complete()};s()})}function Hh(r,e){return pt(Object.entries(r),e)}function Jh(r,e){return function(t,n){return!r.call(e,t,n)}}function Rt(r,e){return H(function(t,n){var i=0;t.subscribe(V(n,function(s){return r.call(e,s,i++)&&n.next(s)}))})}function Yh(r,e,t){return[Rt(e,t)(q(r)),Rt(Jh(e,t))(q(r))]}function Gh(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return r=Qt(r),r.length===1?q(r[0]):new se(Ia(r))}function Ia(r){return function(e){for(var t=[],n=function(s){t.push(q(r[s]).subscribe(V(e,function(o){if(t){for(var a=0;a<t.length;a++)a!==s&&t[a].unsubscribe();t=null}e.next(o)})))},i=0;t&&!e.closed&&i<r.length;i++)n(i)}}function Qh(r,e,t){if(e==null&&(e=r,r=0),e<=0)return ct;var n=e+r;return new se(t?function(i){var s=r;return t.schedule(function(){s<n?(i.next(s++),this.schedule()):i.complete()})}:function(i){for(var s=r;s<n&&!i.closed;)i.next(s++);i.complete()})}function qh(r,e){return new se(function(t){var n=r(),i=e(n),s=i?q(i):ct;return s.subscribe(t),function(){n&&n.unsubscribe()}})}function Oi(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=yn(r),n=Qt(r);return n.length?new se(function(i){var s=n.map(function(){return[]}),o=n.map(function(){return!1});i.add(function(){s=o=null});for(var a=function(u){q(n[u]).subscribe(V(i,function(l){if(s[u].push(l),s.every(function(m){return m.length})){var f=s.map(function(m){return m.shift()});i.next(t?t.apply(void 0,de([],he(f))):f),s.some(function(m,d){return!m.length&&o[d]})&&i.complete()}},function(){o[u]=!0,!s[u].length&&i.complete()}))},c=0;!i.closed&&c<n.length;c++)a(c);return function(){s=o=null}}):ct}function Ra(r){return H(function(e,t){var n=!1,i=null,s=null,o=!1,a=function(){if(s==null||s.unsubscribe(),s=null,n){n=!1;var u=i;i=null,t.next(u)}o&&t.complete()},c=function(){s=null,o&&t.complete()};e.subscribe(V(t,function(u){n=!0,i=u,s||q(r(u)).subscribe(s=V(t,a,c))},function(){o=!0,(!n||!s||s.closed)&&t.complete()}))})}function Xh(r,e){return e===void 0&&(e=qe),Ra(function(){return jt(r,e)})}function Zh(r){return H(function(e,t){var n=[];return e.subscribe(V(t,function(i){return n.push(i)},function(){t.next(n),t.complete()})),q(r).subscribe(V(t,function(){var i=n;n=[],t.next(i)},we)),function(){n=null}})}function ed(r,e){return e===void 0&&(e=null),e=e!=null?e:r,H(function(t,n){var i=[],s=0;t.subscribe(V(n,function(o){var a,c,u,l,f=null;s++%e===0&&i.push([]);try{for(var m=Fe(i),d=m.next();!d.done;d=m.next()){var y=d.value;y.push(o),r<=y.length&&(f=f!=null?f:[],f.push(y))}}catch(O){a={error:O}}finally{try{d&&!d.done&&(c=m.return)&&c.call(m)}finally{if(a)throw a.error}}if(f)try{for(var v=Fe(f),A=v.next();!A.done;A=v.next()){var y=A.value;ht(i,y),n.next(y)}}catch(O){u={error:O}}finally{try{A&&!A.done&&(l=v.return)&&l.call(v)}finally{if(u)throw u.error}}},function(){var o,a;try{for(var c=Fe(i),u=c.next();!u.done;u=c.next()){var l=u.value;n.next(l)}}catch(f){o={error:f}}finally{try{u&&!u.done&&(a=c.return)&&a.call(c)}finally{if(o)throw o.error}}n.complete()},void 0,function(){i=null}))})}function td(r){for(var e,t,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];var s=(e=dt(n))!==null&&e!==void 0?e:qe,o=(t=n[0])!==null&&t!==void 0?t:null,a=n[1]||1/0;return H(function(c,u){var l=[],f=!1,m=function(v){var A=v.buffer,O=v.subs;O.unsubscribe(),ht(l,v),u.next(A),f&&d()},d=function(){if(l){var v=new Ke;u.add(v);var A=[],O={buffer:A,subs:v};l.push(O),Me(v,s,function(){return m(O)},r)}};o!==null&&o>=0?Me(u,s,d,o,!0):f=!0,d();var y=V(u,function(v){var A,O,C=l.slice();try{for(var R=Fe(C),U=R.next();!U.done;U=R.next()){var z=U.value,W=z.buffer;W.push(v),a<=W.length&&m(z)}}catch(te){A={error:te}}finally{try{U&&!U.done&&(O=R.return)&&O.call(R)}finally{if(A)throw A.error}}},function(){for(;l!=null&&l.length;)u.next(l.shift().buffer);y==null||y.unsubscribe(),u.complete(),u.unsubscribe()},void 0,function(){return l=null});c.subscribe(y)})}function nd(r,e){return H(function(t,n){var i=[];q(r).subscribe(V(n,function(s){var o=[];i.push(o);var a=new Ke,c=function(){ht(i,o),n.next(o),a.unsubscribe()};a.add(q(e(s)).subscribe(V(n,c,we)))},we)),t.subscribe(V(n,function(s){var o,a;try{for(var c=Fe(i),u=c.next();!u.done;u=c.next()){var l=u.value;l.push(s)}}catch(f){o={error:f}}finally{try{u&&!u.done&&(a=c.return)&&a.call(c)}finally{if(o)throw o.error}}},function(){for(;i.length>0;)n.next(i.shift());n.complete()}))})}function rd(r){return H(function(e,t){var n=null,i=null,s=function(){i==null||i.unsubscribe();var o=n;n=[],o&&t.next(o),q(r()).subscribe(i=V(t,s,we))};s(),e.subscribe(V(t,function(o){return n==null?void 0:n.push(o)},function(){n&&t.next(n),t.complete()},void 0,function(){return n=i=null}))})}function Na(r){return H(function(e,t){var n=null,i=!1,s;n=e.subscribe(V(t,void 0,void 0,function(o){s=q(r(o,Na(r)(e))),n?(n.unsubscribe(),n=null,s.subscribe(t)):i=!0})),i&&(n.unsubscribe(),n=null,s.subscribe(t))})}function $a(r,e,t,n,i){return function(s,o){var a=t,c=e,u=0;s.subscribe(V(o,function(l){var f=u++;c=a?r(c,l,f):(a=!0,l),n&&o.next(c)},i&&function(){a&&o.next(c),o.complete()}))}}function mn(r,e){return H($a(r,e,arguments.length>=2,!1,!0))}var id=function(r,e){return r.push(e),r};function Ca(){return H(function(r,e){mn(id,[])(r).subscribe(e)})}function Ba(r,e){return gi(Ca(),nt(function(t){return r(t)}),e?Bt(e):Pe)}function ja(r){return Ba(Aa,r)}var sd=ja;function La(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=yn(r);return t?gi(La.apply(void 0,de([],he(r))),Bt(t)):H(function(n,i){Sa(de([n],he(Qt(r))))(i)})}function od(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return La.apply(void 0,de([],he(r)))}function Qr(r,e){return ee(e)?nt(r,e,1):nt(r,1)}function ad(r,e){return ee(e)?Qr(function(){return r},e):Qr(function(){return r})}function cd(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=dt(r);return H(function(n,i){Ti()(pt(de([n],he(r)),t)).subscribe(i)})}function ud(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return cd.apply(void 0,de([],he(r)))}function ld(r){return new se(function(e){return r.subscribe(e)})}var fd={connector:function(){return new Ae}};function Pi(r,e){e===void 0&&(e=fd);var t=e.connector;return H(function(n,i){var s=t();q(r(ld(s))).subscribe(i),i.add(n.subscribe(s))})}function hd(r){return mn(function(e,t,n){return!r||r(t,n)?e+1:e},0)}function dd(r){return H(function(e,t){var n=!1,i=null,s=null,o=function(){if(s==null||s.unsubscribe(),s=null,n){n=!1;var a=i;i=null,t.next(a)}};e.subscribe(V(t,function(a){s==null||s.unsubscribe(),n=!0,i=a,s=V(t,o,we),q(r(a)).subscribe(s)},function(){o(),t.complete()},void 0,function(){i=s=null}))})}function pd(r,e){return e===void 0&&(e=qe),H(function(t,n){var i=null,s=null,o=null,a=function(){if(i){i.unsubscribe(),i=null;var u=s;s=null,n.next(u)}};function c(){var u=o+r,l=e.now();if(l<u){i=this.schedule(void 0,u-l),n.add(i);return}a()}t.subscribe(V(n,function(u){s=u,o=e.now(),i||(i=e.schedule(c,r),n.add(i))},function(){a(),n.complete()},void 0,function(){s=i=null}))})}function ur(r){return H(function(e,t){var n=!1;e.subscribe(V(t,function(i){n=!0,t.next(i)},function(){n||t.next(r),t.complete()}))})}function an(r){return r<=0?function(){return ct}:H(function(e,t){var n=0;e.subscribe(V(t,function(i){++n<=r&&(t.next(i),r<=n&&t.complete())}))})}function Da(){return H(function(r,e){r.subscribe(V(e,we))})}function Ua(r){return Ct(function(){return r})}function Ii(r,e){return e?function(t){return on(e.pipe(an(1),Da()),t.pipe(Ii(r)))}:nt(function(t,n){return q(r(t,n)).pipe(an(1),Ua(t))})}function yd(r,e){e===void 0&&(e=qe);var t=jt(r,e);return Ii(function(){return t})}function md(){return H(function(r,e){r.subscribe(V(e,function(t){return ga(t,e)}))})}function gd(r,e){return H(function(t,n){var i=new Set;t.subscribe(V(n,function(s){var o=r?r(s):s;i.has(o)||(i.add(o),n.next(s))})),e&&q(e).subscribe(V(n,function(){return i.clear()},we))})}function Fa(r,e){return e===void 0&&(e=Pe),r=r!=null?r:vd,H(function(t,n){var i,s=!0;t.subscribe(V(n,function(o){var a=e(o);(s||!r(i,a))&&(s=!1,i=a,n.next(o))}))})}function vd(r,e){return r===e}function wd(r,e){return Fa(function(t,n){return e?e(t[r],n[r]):t[r]===n[r]})}function lr(r){return r===void 0&&(r=bd),H(function(e,t){var n=!1;e.subscribe(V(t,function(i){n=!0,t.next(i)},function(){return n?t.complete():t.error(r())}))})}function bd(){return new $t}function xd(r,e){if(r<0)throw new Yr;var t=arguments.length>=2;return function(n){return n.pipe(Rt(function(i,s){return s===r}),an(1),t?ur(e):lr(function(){return new Yr}))}}function Ed(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return function(t){return on(t,Ai.apply(void 0,de([],he(r))))}}function kd(r,e){return H(function(t,n){var i=0;t.subscribe(V(n,function(s){r.call(e,s,i++,t)||(n.next(!1),n.complete())},function(){n.next(!0),n.complete()}))})}function Ri(r,e){return e?function(t){return t.pipe(Ri(function(n,i){return q(r(n,i)).pipe(Ct(function(s,o){return e(n,s,i,o)}))}))}:H(function(t,n){var i=0,s=null,o=!1;t.subscribe(V(n,function(a){s||(s=V(n,void 0,function(){s=null,o&&n.complete()}),q(r(a,i++)).subscribe(s))},function(){o=!0,!s&&n.complete()}))})}function Ma(){return Ri(Pe)}var Ad=Ma;function Sd(r,e,t){return e===void 0&&(e=1/0),e=(e||0)<1?1/0:e,H(function(n,i){return _i(n,i,r,e,void 0,!0,t)})}function _d(r){return H(function(e,t){try{e.subscribe(t)}finally{t.add(r)}})}function Td(r,e){return H(Ka(r,e,"value"))}function Ka(r,e,t){var n=t==="index";return function(i,s){var o=0;i.subscribe(V(s,function(a){var c=o++;r.call(e,a,c,i)&&(s.next(n?c:a),s.complete())},function(){s.next(n?-1:void 0),s.complete()}))}}function Od(r,e){return H(Ka(r,e,"index"))}function Pd(r,e){var t=arguments.length>=2;return function(n){return n.pipe(r?Rt(function(i,s){return r(i,s,n)}):Pe,an(1),t?ur(e):lr(function(){return new $t}))}}function Id(r,e,t,n){return H(function(i,s){var o;!e||typeof e=="function"?o=e:(t=e.duration,o=e.element,n=e.connector);var a=new Map,c=function(y){a.forEach(y),y(s)},u=function(y){return c(function(v){return v.error(y)})},l=0,f=!1,m=new vi(s,function(y){try{var v=r(y),A=a.get(v);if(!A){a.set(v,A=n?n():new Ae);var O=d(v,A);if(s.next(O),t){var C=V(A,function(){A.complete(),C==null||C.unsubscribe()},void 0,void 0,function(){return a.delete(v)});m.add(q(t(O)).subscribe(C))}}A.next(o?o(y):y)}catch(R){u(R)}},function(){return c(function(y){return y.complete()})},u,function(){return a.clear()},function(){return f=!0,l===0});i.subscribe(m);function d(y,v){var A=new se(function(O){l++;var C=v.subscribe(O);return function(){C.unsubscribe(),--l===0&&f&&m.unsubscribe()}});return A.key=y,A}})}function Rd(){return H(function(r,e){r.subscribe(V(e,function(){e.next(!1),e.complete()},function(){e.next(!0),e.complete()}))})}function Wa(r){return r<=0?function(){return ct}:H(function(e,t){var n=[];e.subscribe(V(t,function(i){n.push(i),r<n.length&&n.shift()},function(){var i,s;try{for(var o=Fe(n),a=o.next();!a.done;a=o.next()){var c=a.value;t.next(c)}}catch(u){i={error:u}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}t.complete()},void 0,function(){n=null}))})}function Nd(r,e){var t=arguments.length>=2;return function(n){return n.pipe(r?Rt(function(i,s){return r(i,s,n)}):Pe,Wa(1),t?ur(e):lr(function(){return new $t}))}}function $d(){return H(function(r,e){r.subscribe(V(e,function(t){e.next(jn.createNext(t))},function(){e.next(jn.createComplete()),e.complete()},function(t){e.next(jn.createError(t)),e.complete()}))})}function Cd(r){return mn(ee(r)?function(e,t){return r(e,t)>0?e:t}:function(e,t){return e>t?e:t})}var Bd=nt;function jd(r,e,t){return t===void 0&&(t=1/0),ee(e)?nt(function(){return r},e,t):(typeof e=="number"&&(t=e),nt(function(){return r},t))}function Ld(r,e,t){return t===void 0&&(t=1/0),H(function(n,i){var s=e;return _i(n,i,function(o,a){return r(s,o,a)},t,function(o){s=o},!1,void 0,function(){return s=null})})}function Dd(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=dt(r),n=ra(r,1/0);return r=Qt(r),H(function(i,s){ar(n)(pt(de([i],he(r)),t)).subscribe(s)})}function Ud(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return Dd.apply(void 0,de([],he(r)))}function Fd(r){return mn(ee(r)?function(e,t){return r(e,t)<0?e:t}:function(e,t){return e<t?e:t})}function Ni(r,e){var t=ee(r)?r:function(){return r};return ee(e)?Pi(e,{connector:t}):function(n){return new nr(n,t)}}function Md(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=Qt(r);return function(n){return Pa.apply(void 0,de([n],he(t)))}}function Kd(){return H(function(r,e){var t,n=!1;r.subscribe(V(e,function(i){var s=t;t=i,n&&e.next([s,i]),n=!0}))})}function Wd(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=r.length;if(t===0)throw new Error("list of properties cannot be empty.");return Ct(function(n){for(var i=n,s=0;s<t;s++){var o=i==null?void 0:i[r[s]];if(typeof o!="undefined")i=o;else return}return i})}function zd(r){return r?function(e){return Pi(r)(e)}:function(e){return Ni(new Ae)(e)}}function Vd(r){return function(e){var t=new qo(r);return new nr(e,function(){return t})}}function Hd(){return function(r){var e=new bi;return new nr(r,function(){return e})}}function Jd(r,e,t,n){t&&!ee(t)&&(n=t);var i=ee(t)?t:void 0;return function(s){return Ni(new wi(r,e,n),i)(s)}}function Yd(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return r.length?H(function(t,n){Ia(de([t],he(r)))(n)}):Pe}function Gd(r){var e,t=1/0,n;return r!=null&&(typeof r=="object"?(e=r.count,t=e===void 0?1/0:e,n=r.delay):t=r),t<=0?function(){return ct}:H(function(i,s){var o=0,a,c=function(){if(a==null||a.unsubscribe(),a=null,n!=null){var l=typeof n=="number"?jt(n):q(n(o)),f=V(s,function(){f.unsubscribe(),u()});l.subscribe(f)}else u()},u=function(){var l=!1;a=i.subscribe(V(s,void 0,function(){++o<t?a?c():l=!0:s.complete()})),l&&c()};u()})}function Qd(r){return H(function(e,t){var n,i=!1,s,o=!1,a=!1,c=function(){return a&&o&&(t.complete(),!0)},u=function(){return s||(s=new Ae,q(r(s)).subscribe(V(t,function(){n?l():i=!0},function(){o=!0,c()}))),s},l=function(){a=!1,n=e.subscribe(V(t,void 0,function(){a=!0,!c()&&u().next()})),i&&(n.unsubscribe(),n=null,i=!1,l())};l()})}function qd(r){r===void 0&&(r=1/0);var e;r&&typeof r=="object"?e=r:e={count:r};var t=e.count,n=t===void 0?1/0:t,i=e.delay,s=e.resetOnSuccess,o=s===void 0?!1:s;return n<=0?Pe:H(function(a,c){var u=0,l,f=function(){var m=!1;l=a.subscribe(V(c,function(d){o&&(u=0),c.next(d)},void 0,function(d){if(u++<n){var y=function(){l?(l.unsubscribe(),l=null,f()):m=!0};if(i!=null){var v=typeof i=="number"?jt(i):q(i(d,u)),A=V(c,function(){A.unsubscribe(),y()},function(){c.complete()});v.subscribe(A)}else y()}else c.error(d)})),m&&(l.unsubscribe(),l=null,f())};f()})}function Xd(r){return H(function(e,t){var n,i=!1,s,o=function(){n=e.subscribe(V(t,void 0,void 0,function(a){s||(s=new Ae,q(r(s)).subscribe(V(t,function(){return n?o():i=!0}))),s&&s.next(a)})),i&&(n.unsubscribe(),n=null,i=!1,o())};o()})}function za(r){return H(function(e,t){var n=!1,i=null;e.subscribe(V(t,function(s){n=!0,i=s})),q(r).subscribe(V(t,function(){if(n){n=!1;var s=i;i=null,t.next(s)}},we))})}function Zd(r,e){return e===void 0&&(e=qe),za(Ta(r,e))}function ep(r,e){return H($a(r,e,arguments.length>=2,!0))}function tp(r,e){return e===void 0&&(e=function(t,n){return t===n}),H(function(t,n){var i=Bs(),s=Bs(),o=function(c){n.next(c),n.complete()},a=function(c,u){var l=V(n,function(f){var m=u.buffer,d=u.complete;m.length===0?d?o(!1):c.buffer.push(f):!e(f,m.shift())&&o(!1)},function(){c.complete=!0;var f=u.complete,m=u.buffer;f&&o(m.length===0),l==null||l.unsubscribe()});return l};t.subscribe(a(i,s)),q(r).subscribe(a(s,i))})}function Bs(){return{buffer:[],complete:!1}}function Va(r){r===void 0&&(r={});var e=r.connector,t=e===void 0?function(){return new Ae}:e,n=r.resetOnError,i=n===void 0?!0:n,s=r.resetOnComplete,o=s===void 0?!0:s,a=r.resetOnRefCountZero,c=a===void 0?!0:a;return function(u){var l,f,m,d=0,y=!1,v=!1,A=function(){f==null||f.unsubscribe(),f=void 0},O=function(){A(),l=m=void 0,y=v=!1},C=function(){var R=l;O(),R==null||R.unsubscribe()};return H(function(R,U){d++,!v&&!y&&A();var z=m=m!=null?m:t();U.add(function(){d--,d===0&&!v&&!y&&(f=Or(C,c))}),z.subscribe(U),!l&&d>0&&(l=new Jt({next:function(W){return z.next(W)},error:function(W){v=!0,A(),f=Or(O,i,W),z.error(W)},complete:function(){y=!0,A(),f=Or(O,o),z.complete()}}),q(R).subscribe(l))})(u)}}function Or(r,e){for(var t=[],n=2;n<arguments.length;n++)t[n-2]=arguments[n];if(e===!0){r();return}if(e!==!1){var i=new Jt({next:function(){i.unsubscribe(),r()}});return q(e.apply(void 0,de([],he(t)))).subscribe(i)}}function np(r,e,t){var n,i,s,o,a=!1;return r&&typeof r=="object"?(n=r.bufferSize,o=n===void 0?1/0:n,i=r.windowTime,e=i===void 0?1/0:i,s=r.refCount,a=s===void 0?!1:s,t=r.scheduler):o=r!=null?r:1/0,Va({connector:function(){return new wi(o,e,t)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:a})}function rp(r){return H(function(e,t){var n=!1,i,s=!1,o=0;e.subscribe(V(t,function(a){s=!0,(!r||r(a,o++,e))&&(n&&t.error(new wa("Too many matching values")),n=!0,i=a)},function(){n?(t.next(i),t.complete()):t.error(s?new va("No matching values"):new $t)}))})}function ip(r){return Rt(function(e,t){return r<=t})}function sp(r){return r<=0?Pe:H(function(e,t){var n=new Array(r),i=0;return e.subscribe(V(t,function(s){var o=i++;if(o<r)n[o]=s;else{var a=o%r,c=n[a];n[a]=s,t.next(c)}})),function(){n=null}})}function op(r){return H(function(e,t){var n=!1,i=V(t,function(){i==null||i.unsubscribe(),n=!0},we);q(r).subscribe(i),e.subscribe(V(t,function(s){return n&&t.next(s)}))})}function ap(r){return H(function(e,t){var n=!1,i=0;e.subscribe(V(t,function(s){return(n||(n=!r(s,i++)))&&t.next(s)}))})}function cp(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=dt(r);return H(function(n,i){(t?on(r,n,t):on(r,n)).subscribe(i)})}function cn(r,e){return H(function(t,n){var i=null,s=0,o=!1,a=function(){return o&&!i&&n.complete()};t.subscribe(V(n,function(c){i==null||i.unsubscribe();var u=0,l=s++;q(r(c,l)).subscribe(i=V(n,function(f){return n.next(e?e(c,f,l,u++):f)},function(){i=null,a()}))},function(){o=!0,a()}))})}function up(){return cn(Pe)}function lp(r,e){return ee(e)?cn(function(){return r},e):cn(function(){return r})}function fp(r,e){return H(function(t,n){var i=e;return cn(function(s,o){return r(i,s,o)},function(s,o){return i=o,o})(t).subscribe(n),function(){i=null}})}function hp(r){return H(function(e,t){q(r).subscribe(V(t,function(){return t.complete()},we)),!t.closed&&e.subscribe(t)})}function dp(r,e){return e===void 0&&(e=!1),H(function(t,n){var i=0;t.subscribe(V(n,function(s){var o=r(s,i++);(o||e)&&n.next(s),!o&&n.complete()}))})}function pp(r,e,t){var n=ee(r)||e||t?{next:r,error:e,complete:t}:r;return n?H(function(i,s){var o;(o=n.subscribe)===null||o===void 0||o.call(n);var a=!0;i.subscribe(V(s,function(c){var u;(u=n.next)===null||u===void 0||u.call(n,c),s.next(c)},function(){var c;a=!1,(c=n.complete)===null||c===void 0||c.call(n),s.complete()},function(c){var u;a=!1,(u=n.error)===null||u===void 0||u.call(n,c),s.error(c)},function(){var c,u;a&&((c=n.unsubscribe)===null||c===void 0||c.call(n)),(u=n.finalize)===null||u===void 0||u.call(n)}))}):Pe}function Ha(r,e){return H(function(t,n){var i=e!=null?e:{},s=i.leading,o=s===void 0?!0:s,a=i.trailing,c=a===void 0?!1:a,u=!1,l=null,f=null,m=!1,d=function(){f==null||f.unsubscribe(),f=null,c&&(A(),m&&n.complete())},y=function(){f=null,m&&n.complete()},v=function(O){return f=q(r(O)).subscribe(V(n,d,y))},A=function(){if(u){u=!1;var O=l;l=null,n.next(O),!m&&v(O)}};t.subscribe(V(n,function(O){u=!0,l=O,!(f&&!f.closed)&&(o?A():v(O))},function(){m=!0,!(c&&u&&f&&!f.closed)&&n.complete()}))})}function yp(r,e,t){e===void 0&&(e=qe);var n=jt(r,e);return Ha(function(){return n},t)}function mp(r){return r===void 0&&(r=qe),H(function(e,t){var n=r.now();e.subscribe(V(t,function(i){var s=r.now(),o=s-n;n=s,t.next(new gp(i,o))}))})}var gp=function(){function r(e,t){this.value=e,this.interval=t}return r}();function vp(r,e,t){var n,i,s;if(t=t!=null?t:xi,Si(r)?n=r:typeof r=="number"&&(i=r),e)s=function(){return e};else throw new TypeError("No observable provided to switch to");if(n==null&&i==null)throw new TypeError("No timeout provided.");return xa({first:n,each:i,scheduler:t,with:s})}function wp(r){return r===void 0&&(r=rr),Ct(function(e){return{value:e,timestamp:r.now()}})}function bp(r){return H(function(e,t){var n=new Ae;t.next(n.asObservable());var i=function(s){n.error(s),t.error(s)};return e.subscribe(V(t,function(s){return n==null?void 0:n.next(s)},function(){n.complete(),t.complete()},i)),q(r).subscribe(V(t,function(){n.complete(),t.next(n=new Ae)},we,i)),function(){n==null||n.unsubscribe(),n=null}})}function xp(r,e){e===void 0&&(e=0);var t=e>0?e:r;return H(function(n,i){var s=[new Ae],o=[],a=0;i.next(s[0].asObservable()),n.subscribe(V(i,function(c){var u,l;try{for(var f=Fe(s),m=f.next();!m.done;m=f.next()){var d=m.value;d.next(c)}}catch(A){u={error:A}}finally{try{m&&!m.done&&(l=f.return)&&l.call(f)}finally{if(u)throw u.error}}var y=a-r+1;if(y>=0&&y%t===0&&s.shift().complete(),++a%t===0){var v=new Ae;s.push(v),i.next(v.asObservable())}},function(){for(;s.length>0;)s.shift().complete();i.complete()},function(c){for(;s.length>0;)s.shift().error(c);i.error(c)},function(){o=null,s=null}))})}function Ep(r){for(var e,t,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];var s=(e=dt(n))!==null&&e!==void 0?e:qe,o=(t=n[0])!==null&&t!==void 0?t:null,a=n[1]||1/0;return H(function(c,u){var l=[],f=!1,m=function(A){var O=A.window,C=A.subs;O.complete(),C.unsubscribe(),ht(l,A),f&&d()},d=function(){if(l){var A=new Ke;u.add(A);var O=new Ae,C={window:O,subs:A,seen:0};l.push(C),u.next(O.asObservable()),Me(A,s,function(){return m(C)},r)}};o!==null&&o>=0?Me(u,s,d,o,!0):f=!0,d();var y=function(A){return l.slice().forEach(A)},v=function(A){y(function(O){var C=O.window;return A(C)}),A(u),u.unsubscribe()};return c.subscribe(V(u,function(A){y(function(O){O.window.next(A),a<=++O.seen&&m(O)})},function(){return v(function(A){return A.complete()})},function(A){return v(function(O){return O.error(A)})})),function(){l=null}})}function kp(r,e){return H(function(t,n){var i=[],s=function(o){for(;0<i.length;)i.shift().error(o);n.error(o)};q(r).subscribe(V(n,function(o){var a=new Ae;i.push(a);var c=new Ke,u=function(){ht(i,a),a.complete(),c.unsubscribe()},l;try{l=q(e(o))}catch(f){s(f);return}n.next(a.asObservable()),c.add(l.subscribe(V(n,u,we,s)))},we)),t.subscribe(V(n,function(o){var a,c,u=i.slice();try{for(var l=Fe(u),f=l.next();!f.done;f=l.next()){var m=f.value;m.next(o)}}catch(d){a={error:d}}finally{try{f&&!f.done&&(c=l.return)&&c.call(l)}finally{if(a)throw a.error}}},function(){for(;0<i.length;)i.shift().complete();n.complete()},s,function(){for(;0<i.length;)i.shift().unsubscribe()}))})}function Ap(r){return H(function(e,t){var n,i,s=function(a){n.error(a),t.error(a)},o=function(){i==null||i.unsubscribe(),n==null||n.complete(),n=new Ae,t.next(n.asObservable());var a;try{a=q(r())}catch(c){s(c);return}a.subscribe(i=V(t,o,o,s))};o(),e.subscribe(V(t,function(a){return n.next(a)},function(){n.complete(),t.complete()},s,function(){i==null||i.unsubscribe(),n=null}))})}function Sp(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=yn(r);return H(function(n,i){for(var s=r.length,o=new Array(s),a=r.map(function(){return!1}),c=!1,u=function(f){q(r[f]).subscribe(V(i,function(m){o[f]=m,!c&&!a[f]&&(a[f]=!0,(c=a.every(Pe))&&(a=null))},we))},l=0;l<s;l++)u(l);n.subscribe(V(i,function(f){if(c){var m=de([f],he(o));i.next(t?t.apply(void 0,de([],he(m))):m)}}))})}function _p(r){return Ba(Oi,r)}function Tp(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return H(function(t,n){Oi.apply(void 0,de([t],he(r))).subscribe(n)})}function Op(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return Tp.apply(void 0,de([],he(r)))}const Pp=Object.freeze(Object.defineProperty({__proto__:null,Observable:se,ConnectableObservable:nr,observable:tr,animationFrames:zf,Subject:Ae,BehaviorSubject:qo,ReplaySubject:wi,AsyncSubject:bi,asap:Xf,asapScheduler:Zo,async:xi,asyncScheduler:qe,queue:th,queueScheduler:ea,animationFrame:ih,animationFrameScheduler:ta,VirtualTimeScheduler:sh,VirtualAction:na,Scheduler:Hr,Subscription:Ke,Subscriber:er,Notification:jn,get NotificationKind(){return Jr},pipe:gi,noop:we,identity:Pe,isObservable:wh,lastValueFrom:bh,firstValueFrom:xh,ArgumentOutOfRangeError:Yr,EmptyError:$t,NotFoundError:va,ObjectUnsubscribedError:Qo,SequenceError:wa,TimeoutError:ba,UnsubscriptionError:Cn,bindCallback:Sh,bindNodeCallback:_h,combineLatest:Aa,concat:on,connectable:$h,defer:cr,empty:oh,forkJoin:Ch,from:pt,fromEvent:Gr,fromEventPattern:_a,generate:Mh,iif:Kh,interval:Ta,merge:Wh,never:zh,of:Ai,onErrorResumeNext:Pa,pairs:Hh,partition:Yh,race:Gh,range:Qh,throwError:ma,timer:jt,using:qh,zip:Oi,scheduled:ya,EMPTY:ct,NEVER:Oa,config:At,audit:Ra,auditTime:Xh,buffer:Zh,bufferCount:ed,bufferTime:td,bufferToggle:nd,bufferWhen:rd,catchError:Na,combineAll:sd,combineLatestAll:ja,combineLatestWith:od,concatAll:Ti,concatMap:Qr,concatMapTo:ad,concatWith:ud,connect:Pi,count:hd,debounce:dd,debounceTime:pd,defaultIfEmpty:ur,delay:yd,delayWhen:Ii,dematerialize:md,distinct:gd,distinctUntilChanged:Fa,distinctUntilKeyChanged:wd,elementAt:xd,endWith:Ed,every:kd,exhaust:Ad,exhaustAll:Ma,exhaustMap:Ri,expand:Sd,filter:Rt,finalize:_d,find:Td,findIndex:Od,first:Pd,groupBy:Id,ignoreElements:Da,isEmpty:Rd,last:Nd,map:Ct,mapTo:Ua,materialize:$d,max:Cd,mergeAll:ar,flatMap:Bd,mergeMap:nt,mergeMapTo:jd,mergeScan:Ld,mergeWith:Ud,min:Fd,multicast:Ni,observeOn:sr,onErrorResumeNextWith:Md,pairwise:Kd,pluck:Wd,publish:zd,publishBehavior:Vd,publishLast:Hd,publishReplay:Jd,raceWith:Yd,reduce:mn,repeat:Gd,repeatWhen:Qd,retry:qd,retryWhen:Xd,refCount:Jo,sample:za,sampleTime:Zd,scan:ep,sequenceEqual:tp,share:Va,shareReplay:np,single:rp,skip:ip,skipLast:sp,skipUntil:op,skipWhile:ap,startWith:cp,subscribeOn:or,switchAll:up,switchMap:cn,switchMapTo:lp,switchScan:fp,take:an,takeLast:Wa,takeUntil:hp,takeWhile:dp,tap:pp,throttle:Ha,throttleTime:yp,throwIfEmpty:lr,timeInterval:mp,timeout:xa,timeoutWith:vp,timestamp:wp,toArray:Ca,window:bp,windowCount:xp,windowTime:Ep,windowToggle:kp,windowWhen:Ap,withLatestFrom:Sp,zipAll:_p,zipWith:Op},Symbol.toStringTag,{value:"Module"}));export{Rp as default};
//# sourceMappingURL=swyger-client.min.js.map
